

```text
Network Working Group                                          M. Arango
Request for Comments: 2705                                       RSL COM
Category: Informational                                         A. Dugan
                                                              I. Elliott
                                                   Level3 Communications
                                                              C. Huitema
                                                               Telcordia
                                                              S. Pickett
                                                       Vertical Networks
                                                            October 1999

                 Media Gateway Control Protocol (MGCP)
                              Version 1.0
```

---
# **Status of this Memo**

이 메모는 인터넷 커뮤니티에 대한 정보를 제공합니다. 어떤 종류의 인터넷 표준도 지정하지 않습니다. 이 메모의 배포는 무제한입니다.

---
# **Copyright Notice**

Copyright \(C\) The Internet Society \(1999\). 판권 소유.

---
# **IESG NOTE:**

이 문서는 커뮤니티에 정보를 제공하기 위해 게시되었습니다. 현재 여러 제품에 배포되고 있는 프로토콜을 설명합니다. 구현자는 현재 이 프로토콜의 잠재적인 후속 작업을 진행 중인 IETF Megaco 실무 그룹 및 ITF-T SG16의 개발 내용을 알고 있어야 합니다.

---
# **Abstract**

이 문서에서는 외부 통화 제어 요소에서 VoIP\(Voice over IP\) 게이트웨이를 제어하기 위한 애플리케이션 프로그래밍 인터페이스 및 해당 프로토콜\(MGCP\)에 대해 설명합니다. MGCP는 통화 제어 "지능"이 게이트웨이 외부에 있고 외부 통화 제어 요소에 의해 처리되는 통화 제어 아키텍처를 가정합니다.

이 문서는 6개의 주요 섹션으로 구성되어 있습니다.

\* 서론에서는 기본 가정과 H.323, RTSP, SAP, SIP 등 다른 프로토콜과의 관계를 제시합니다.

\* 인터페이스 섹션에서는 명명 규칙, 세션 설명 프로토콜 SDP의 사용 및 MGCP를 구성하는 절차\(알림 요청, 알림, 연결 생성, 연결 수정, 연결 삭제, AuditEndpoint, AuditConnection\)를 제시하는 MGCP의 개념적 개요를 제공합니다. 및 RestartInProgress.

\* 프로토콜 설명 섹션에는 간단한 텍스트 형식을 기반으로 하는 MGCP 인코딩과 UDP를 통한 전송 절차가 나와 있습니다.

\* 보안 섹션에서는 MGCP의 보안 요구사항과 IP 보안 서비스\(IPSEC\)의 사용법을 제시합니다.

\* 이벤트 패키지 섹션에서는 패키지 및 이벤트 이름의 초기 정의를 제공합니다.

\* SGCP 1.1과 IPDC를 결합하여 MGCP 1.0을 만들 때 변경된 사항에 대한 설명입니다.

---
# **Table of Contents**

```text
   1.  Introduction ..............................................  5
      1.1.  Relation with the H.323 standards ....................  7
      1.2.  Relation with the IETF standards .....................  8
      1.3.  Definitions ..........................................  9
   2.  Media Gateway Control Interface ...........................  9
      2.1.  Model and naming conventions. ........................ 10
         2.1.1.  Types of endpoints .............................. 10
            2.1.1.1.  Digital channel (DS0) ...................... 11
            2.1.1.2.  Analog line ................................ 11
            2.1.1.3.  Annoucement server access point ............ 12
            2.1.1.4.  Interactive Voice Response access point .... 12
            2.1.1.5.  Conference bridge access point ............. 13
            2.1.1.6.  Packet relay ............................... 13
            2.1.1.7.  Wiretap access point ....................... 14
            2.1.1.8.  ATM "trunk side" interface. ................ 14
         2.1.2.  Endpoint identifiers ............................ 15
         2.1.3.  Calls and connections ........................... 17
            2.1.3.1.  Names of calls ............................. 20
            2.1.3.2.  Names of connections ....................... 20
            2.1.3.3.  Management of resources, attributes of ..... 20
            2.1.3.4.  Special case of local connections .......... 23
         2.1.4.  Names of Call Agents and other entities ......... 23
         2.1.5.  Digit maps ...................................... 24
         2.1.6.  Names of events ................................. 26
      2.2.  Usage of SDP ......................................... 29
      2.3.  Gateway Control Commands ............................. 30
         2.3.1.  EndpointConfiguration ........................... 32
         2.3.2.  NotificationRequest ............................. 33
         2.3.3.  CreateConnection ................................ 38
         2.3.4.  ModifyConnection ................................ 44
         2.3.5.  DeleteConnection (from the Call Agent) .......... 46
         2.3.6.  DeleteConnection (from the VoIP gateway) ........ 51
         2.3.7.  DeleteConnection (multiple connections, from the  51
         2.3.8.  Audit Endpoint .................................. 52
         2.3.9.  Audit Connection ................................ 55
         2.3.10.  Restart in progress ............................ 56
      2.4.  Return codes and error codes. ........................ 58
      2.5.  Reason Codes ......................................... 61
   3.  Media Gateway Control Protocol ............................ 61
      3.1.  General description .................................. 62
      3.2.  Command Header ....................................... 62
         3.2.1.  Command line .................................... 62
            3.2.1.1.  Coding of the requested verb ............... 63
            3.2.1.2.  Transaction Identifiers .................... 63
            3.2.1.3.  Coding of the endpoint identifiers and ..... 64
            3.2.1.4.  Coding of the protocol version ............. 65
         3.2.2.  Parameter lines ................................. 65
            3.2.2.1.  Response Acknowledgement ................... 68
            3.2.2.2.  Local connection options ................... 68
            3.2.2.3.  Capabilities ............................... 70
            3.2.2.4.  Connection parameters ...................... 71
            3.2.2.5.  Reason Codes ............................... 72
            3.2.2.6.  Connection mode ............................ 73
            3.2.2.7.  Coding of event names ...................... 73
            3.2.2.8.  RequestedEvents ............................ 74
            3.2.2.9.  SignalRequests ............................. 76
            3.2.2.10.  ObservedEvent ............................. 76
            3.2.2.11.  RequestedInfo ............................. 76
            3.2.2.12.  QuarantineHandling ........................ 77
            3.2.2.13.  DetectEvents .............................. 77
            3.2.2.14.  EventStates ............................... 77
            3.2.2.15.  RestartMethod ............................. 78
            3.2.2.16.  Bearer Information ........................ 78
      3.3.  Format of response headers ........................... 78
      3.4.  Formal syntax description of the protocol ............ 81
      3.5.  Encoding of the session description .................. 86
         3.5.1.  Usage of SDP for an audio service ............... 86
         3.5.2.  Usage of SDP in a network access service ........ 87
         3.5.3.  Usage of SDP for ATM connections ................ 90
         3.5.4.  Usage of SDP for local connections .............. 91
      3.6.  Transmission over UDP ................................ 91
         3.6.1.  Providing the At-Most-Once functionality ........ 91
         3.6.2.  Transaction identifiers and three ways handshake. 92
         3.6.3.  Computing retransmission timers ................. 93
         3.6.4.  Piggy backing ................................... 94
         3.6.5.  Provisional responses ........................... 94
   4.  States, failover and race conditions. ..................... 95
      4.1.  Basic Asumptions ..................................... 95
      4.2.  Security, Retransmission, and Detection of Lost ...... 96
      4.3.  Race conditions ...................................... 99
         4.3.1.  Quarantine list ................................. 99
         4.3.2.  Explicit detection ..............................103
         4.3.3.  Ordering of commands, and treatment of disorder .104
         4.3.4.  Fighting the restart avalanche ..................105
         4.3.5.  Disconnected Endpoints ..........................107
   1.   A "disconnected" timer is initialized to a random value, .107
   2.   The gateway then waits for either the end of this timer, .107
   3.   When the "disconnected" timer elapses, when a command is .107
   4.   If the "disconnected" procedure still left the endpoint ..107
   5.  Security requirements .....................................108
      5.1.  Protection of media connections ......................109
   6.  Event packages and end point types ........................109
      6.1.  Basic packages .......................................110
         6.1.1.  Generic Media Package ...........................110
         6.1.2.  DTMF package ....................................112
         6.1.3.  MF Package ......................................113
         6.1.4.  Trunk Package ...................................114
         6.1.5.  Line Package ....................................116
         6.1.6.  Handset emulation package .......................119
         6.1.7.  RTP Package .....................................120
         6.1.8.  Network Access Server Package ...................121
         6.1.9.  Announcement Server Package .....................122
         6.1.10.  Script Package .................................122
      6.2.  Basic endpoint types and profiles ....................123
   7.  Versions and compatibility ................................124
      7.1.  Differences between version 1.0 and draft 0.5 ........124
      7.2.  Differences between draft-04 and draft-05 ............125
      7.3.  Differences between draft-03 and draft-04 ............125
      7.4.  Differences between draft-02 and draft-03 ............125
      7.5.  Differences between draft-01 and draft-02 ............126
      7.6.  The making of MGCP from IPDC and SGCP ................126
      7.7.  Changes between MGCP and initial versions of SGCP ....126
   8.  Security Considerations ...................................128
   9.  Acknowledgements ..........................................128
   10. References ................................................129
   11. Authors' Addresses ........................................130
   12. Appendix A: Proposed "MoveConnection" command .............132
      12.1.  Proposed syntax modification ........................133
   13. Full Copyright Statement ..................................134
```

---
## **1.  Introduction**

이 문서에서는 미디어 게이트웨이 컨트롤러 또는 통화 에이전트라고 하는 외부 통화 제어 요소에서 텔레포니 게이트웨이를 제어하기 위한 추상 애플리케이션 프로그래밍 인터페이스 및 해당 프로토콜\(MGCP\)에 대해 설명합니다. 전화 게이트웨이는 전화 회선을 통해 전달되는 오디오 신호와 인터넷이나 다른 패킷 네트워크를 통해 전달되는 데이터 패킷 간의 변환을 제공하는 네트워크 요소입니다. 게이트웨이의 예는 다음과 같습니다.

\* 전화 네트워크와 VoIP\(Voice over IP\) 네트워크 사이를 인터페이스하는 트렁킹 게이트웨이. 이러한 게이트웨이는 일반적으로 다수의 디지털 회선을 관리합니다.

\* ATM 네트워크에 접속한다는 점을 제외하면 VoIP\(Voice over IP\) 트렁킹 게이트웨이와 거의 동일한 방식으로 작동하는 Voice over ATM 게이트웨이.

\* VoIP\(Voice over IP\) 네트워크에 기존 아날로그\(RJ11\) 인터페이스를 제공하는 주거용 게이트웨이. 주거용 게이트웨이의 예로는 케이블 모뎀/케이블 셋톱박스, xDSL 장치, 광대역 무선 장치 등이 있습니다.

\* VoIP 네트워크에 기존 아날로그\(RJ11\) 또는 디지털 PBX 인터페이스를 제공하는 액세스 게이트웨이. 액세스 게이트웨이의 예로는 소규모 VoIP 게이트웨이가 있습니다.

\* 전통적인 디지털 PBX를 제공하는 비즈니스 게이트웨이

- VoIP 네트워크에 대한 인터페이스 또는 통합된 "소프트 PBX" 인터페이스.

\* "모뎀"을 전화 회선에 연결하고 인터넷에 대한 데이터 액세스를 제공할 수 있는 네트워크 액세스 서버. 우리는 미래에는 동일한 게이트웨이가 VoIP\(Voice over IP\) 서비스와 네트워크 액세스 서비스를 결합할 것으로 예상합니다.

\* 외부 호출 제어 요소에 대한 제어 인터페이스를 제공할 수 있는 회로 스위치 또는 패킷 스위치.

MGCP는 통화 제어 "지능"이 게이트웨이 외부에 있고 외부 통화 제어 요소에 의해 처리되는 통화 제어 아키텍처를 가정합니다. MGCP는 이러한 통화 제어 요소, 즉 통화 에이전트가 서로 동기화되어 자신이 제어하는 ​​게이트웨이에 일관된 명령을 보낼 것이라고 가정합니다. MGCP는 통화 에이전트 동기화 메커니즘을 정의하지 않습니다. MGCP는 본질적으로 게이트웨이가 통화 에이전트가 보낸 명령을 실행할 것으로 예상되는 마스터/슬레이브 프로토콜입니다. 결과적으로 이 문서는 게이트웨이의 예상되는 동작을 매우 자세히 지정하지만

타이머 관리와 같이 프로토콜의 올바른 작동을 위해 요구되는 통화 에이전트 구현 부분만 지정합니다.

MGCP는 기본 구성이 끝점과 연결인 연결 모델을 가정합니다. 엔드포인트는 데이터의 소스 또는 싱크이며 물리적이거나 가상일 수 있습니다. 물리적 엔드포인트의 예는 다음과 같습니다.

\* PSTN 스위치\(예: 클래스 5, 클래스 4 등\)에 연결된 트렁크를 종료하는 게이트웨이의 인터페이스입니다. 트렁크를 종료하는 게이트웨이를 트렁크 게이트웨이라고 합니다.

\* 아날로그 POTS를 종료하는 게이트웨이의 인터페이스

- 전화, 키 시스템, PBX 등에 연결. 주거용 POTS 회선\(전화\)을 종료하는 게이트웨이를 주거용 게이트웨이라고 합니다.

가상 끝점의 예로는 오디오 콘텐츠 서버의 오디오 소스가 있습니다. 물리적 엔드포인트를 생성하려면 하드웨어 설치가 필요하지만, 가상 엔드포인트 생성은 소프트웨어로 수행할 수 있습니다.

연결은 지점 간 연결이거나 다중 지점일 수 있습니다. 지점 간 연결은 두 끝점 간에 데이터를 전송하기 위한 목적으로 두 끝점 간의 연결입니다. 두 끝점 모두에 대해 이 연결이 설정되면 이러한 끝점 간의 데이터 전송이 발생할 수 있습니다. 다중 지점 연결은 끝점을 다중 지점 세션에 연결하여 설정됩니다.

여러 유형의 베어러 네트워크를 통해 연결을 설정할 수 있습니다.

\* TCP/IP 네트워크를 통해 RTP 및 UDP를 사용하여 오디오 패킷을 전송합니다.

\* ATM 네트워크를 통해 AAL2 또는 다른 적응 계층을 사용하여 오디오 패킷을 전송합니다.

\* 내부 연결\(예: TDM 백플레인 또는 게이트웨이의 상호 연결 버스\)을 통한 패킷 전송. 이는 특히 게이트웨이에서 종료되지만 전화 네트워크를 통해 즉시 경로가 변경되는 연결인 "헤어핀" 연결에 사용됩니다.

지점 간 연결의 경우 연결 끝점이 별도의 게이트웨이에 있거나 동일한 게이트웨이에 있을 수 있습니다.

---
### **1.1.  Relation with the H.323 standards**

MGCP는 외부에 단일 VoIP 게이트웨이로 나타나는 분산 시스템 내의 내부 프로토콜로 설계되었습니다. 이 시스템은 여러 컴퓨터 플랫폼에 배포되거나 배포되지 않을 수 있는 통화 에이전트와 회선과 패킷 간의 미디어 신호 변환을 수행하는 적어도 하나의 "미디어 게이트웨이"를 포함하는 게이트웨이 세트로 구성됩니다. SS7 제어 네트워크에 연결할 때 하나 이상의 "신호 게이트웨이". 일반적인 구성에서 이 분산 게이트웨이 시스템은 다음 표에 표시된 대로 한쪽은 하나 이상의 전화 통신\(예: 회선\) 스위치와 인터페이스하고 다른 쪽은 H.323 규격 시스템과 인터페이스합니다.

```text
    ___________________________________________________________________
   | Functional|  Phone     |  Terminating    |  H.323 conformant     |
   | Plane     |  switch    |  Entity         |  systems              |
   |___________|____________|_________________|_______________________|
   | Signaling |  Signaling |  Call agent     |  Signaling exchanges  |
   | Plane     |  exchanges |                 |  with the call agent  |
   |           |  through   |                 |  through H.225/RAS and|
   |           |  SS7/ISUP  |                 |  H.225/Q.931.         |
   |___________|____________|_________________|_______________________|
   |           |            |                 |  Possible negotiation |
   |           |            |                 |  of logical channels  |
   |           |            |                 |  and transmission     |
   |           |            |                 |  parameters through   |
   |           |            |                 |  H.245 with the call  |
   |           |            |                 |  agent.               |
   |___________|____________|_________________|_______________________|
   |           |            |  Internal       |                       |
   |           |            |  synchronization|                       |
   |           |            |  through MGCP   |                       |
   |___________|____________|_________________|_______________________|
   | Bearer    |  Connection|  Telephony      |  Transmission of VOIP |
   | Data      |  through   |  gateways       |  data using RTP       |
   | Transport |  high speed|                 |  directly between the |
   | Plane     |  trunk     |                 |  H.323 station and the|
   |           |  groups    |                 |  gateway.             |
   |___________|____________|_________________|_______________________|
```

MGCP 모델에서 게이트웨이는 오디오 신호 변환 기능에 중점을 두는 반면 통화 에이전트는 신호 및 통화 처리 기능을 처리합니다. 결과적으로 통화 에이전트는 H.323 표준의 "신호" 계층을 구현하고 H.323 시스템에 대해 "H.323 게이트키퍼" 또는 하나 이상의 "H.323 엔드포인트"로 표시됩니다.

---
### **1.2.  Relation with the IETF standards**

H.323은 VoIP 터미널의 표준으로 인정받고 있지만 IETF는 다른 유형의 멀티미디어 애플리케이션에 대한 사양도 개발했습니다. 기타 사양은 다음과 같습니다.

\* 세션 설명 프로토콜\(SDP\), RFC 2327,

```text
   *  the Session Announcement Protocol (SAP),

   *  the Session Initiation Protocol (SIP),
```

\* 실시간 스트리밍 프로토콜\(RTSP\), RFC 2326.

후자의 세 가지 사양은 실제로 관심 있는 당사자에게 세션 설명을 전송할 수 있는 대체 신호 표준입니다. SAP는 멀티캐스트 세션 관리자가 멀티캐스트 세션 설명을 대규모 수신자 그룹에 배포하는 데 사용되며, SIP는 개별 사용자를 지점 간 또는 유니캐스트 세션에 참여하도록 초대하는 데 사용되며, RTSP는 서버와 인터페이스하는 데 사용됩니다. 실시간 데이터를 제공합니다. 세 가지 경우 모두 세션 설명은 SDP에 따라 설명됩니다. 오디오가 전송되면 실시간 전송 프로토콜\(RTP\)을 통해 전송됩니다.

분산 게이트웨이 시스템과 MGCP를 통해 PSTN 전화 통신 사용자는 SAP, SIP 또는 RTSP를 사용하여 설정된 세션에 액세스할 수 있습니다. 통화 에이전트는 다음 표에 따라 신호 변환을 제공합니다.

```text
    _____________________________________________________________________
   | Functional|  Phone     |  Terminating    |  IETF conforming systems|
   | Plane     |  switch    |  Entity         |                         |
   |___________|____________|_________________|_________________________|
   | Signaling |  Signaling |  Call agent     |  Signaling exchanges    |
   | Plane     |  exchanges |                 |  with the call agent    |
   |           |  through   |                 |  through SAP, SIP or    |
   |           |  SS7/ISUP  |                 |  RTSP.                  |
   |___________|____________|_________________|_________________________|
   |           |            |                 |  Negotiation of session |
   |           |            |                 |  description parameters |
   |           |            |                 |  through SDP (telephony |
   |           |            |                 |  gateway terminated but |
   |           |            |                 |  passed via the call    |
   |           |            |                 |  agent to and from the  |
   |           |            |                 |  IETF conforming system)|
   |___________|____________|_________________|_________________________|
   |           |            |  Internal       |                         |
   |           |            |  synchronization|                         |
   |           |            |  through MGCP   |                         |
   |___________|____________|_________________|_________________________|
   | Bearer    |  Connection|  Telephony      |  Transmission of VoIP   |
   | Data      |  through   |  gateways       |  data using RTP,        |
   | Transport |  high speed|                 |  directly between the   |
   | Plane     |  trunk     |                 |  remote IP end system   |
   |           |  groups    |                 |  and the gateway.       |
   |___________|____________|_________________|_________________________|
```

SDP 표준은 이 아키텍처에서 중추적인 역할을 합니다. 다음 설명에서는 이를 MGCP에서 세션 설명을 전달하는 데 사용하는 방법도 살펴보겠습니다.

---
### **1.3.  Definitions**

트렁크: 두 스위칭 시스템 간의 통신 채널입니다. 예를 들어 T1 또는 E1 회선의 DS0입니다.

---
## **2.  Media Gateway Control Interface**

인터페이스 기능은 연결 제어 및 엔드포인트 제어를 제공합니다. 둘 다 동일한 시스템 모델과 동일한 명명 규칙을 사용합니다.

---
### **2.1.  Model and naming conventions**

MGCP는 기본 구성이 끝점과 연결인 연결 모델을 가정합니다. 연결은 통화로 그룹화됩니다. 하나 이상의 연결이 하나의 통화에 속할 수 있습니다. 연결 및 통화는 하나 이상의 통화 상담원이 주도하여 설정됩니다.

---
#### **2.1.1.  Types of endpoints**

소개에서 우리는 여러 종류의 게이트웨이를 제시했습니다. 그러나 그러한 분류는 오해를 불러일으킬 수 있습니다. 제조업체는 단일 패키지에 여러 유형의 서비스를 제공하기로 임의로 결정할 수 있습니다. 예를 들어, 단일 제품은 전화 스위치에 대한 일부 트렁크 연결, 일부 기본 속도 연결 및 일부 아날로그 회선 인터페이스를 제공하여 소개에서 "트렁킹", "액세스" 및 "주거용"으로 설명한 특성을 공유할 수 있습니다. 게이트웨이. MGCP는 그러한 그룹화에 대해 가정을 하지 않습니다. 우리는 단순히 미디어 게이트웨이가 엔드포인트 컬렉션을 지원한다고 가정합니다. 엔드포인트의 유형에 따라 기능이 결정됩니다. 지금까지 분석을 통해 다음과 같은 기본 엔드포인트 유형을 분리했습니다.

```text
   *    Digital channel (DS0),

   *    Analog line,

   *    Annoucement server access point,

   *    Interactive Voice Response access point,

   *    Conference bridge access point,

   *    Packet relay,

   *    Wiretap access point,

   *    ATM "trunk side" interface.
```

이 섹션에서는 이러한 엔드포인트의 예상되는 동작을 개발합니다.

이 목록은 제한적이지 않습니다. 나중에 정의되는 다른 유형의 엔드포인트가 있을 수 있습니다. 예를 들어 네트워크 품질을 확인하는 데 사용할 수 있는 테스트 엔드포인트 또는 프레임 릴레이 가상 회선을 통해 다중화되는 오디오 채널을 관리하는 데 사용할 수 있는 프레임 릴레이 엔드포인트가 있습니다.

---
##### **2.1.1.1.  Digital channel (DS0)**

디지털 채널은 8Khz\*8bit 서비스를 제공합니다. 이러한 채널은 트렁크 및 ISDN 인터페이스에서 찾을 수 있습니다. 이는 일반적으로 T1, E1, T3 또는 E3 인터페이스와 같은 디지털 멀티플렉스의 일부입니다. 이러한 채널을 지원하는 미디어 게이트웨이는 채널에서 수신된 디지털 신호를 오디오 패킷으로 변환할 수 있습니다. 이 신호는 8비트 전체 세트 또는 7비트만 사용하여 A 또는 mu-law에 따라 인코딩될 수 있습니다. 미디어 게이트웨이가 NAS 서비스도 지원하는 경우 게이트웨이는 오디오 인코딩 데이터\(모뎀 연결\) 또는 바이너리 데이터\(ISDN 연결\)를 수신하고 이를 데이터 패킷으로 변환할 수 있어야 합니다.

```text
                                         +-------
                           +------------+|
              (channel) ===|DS0 endpoint| -------- Connections
                           +------------+|
                                         +-------
```

미디어 게이트웨이는 엔드포인트와 패킷 네트워크 사이 또는 엔드포인트와 동일한 게이트웨이의 다른 엔드포인트 사이에 여러 연결을 설정할 수 있어야 합니다. 이러한 연결에서 발생하는 신호는 이 문서의 뒷부분에 지정된 대로 연결 "모드"에 따라 혼합되어야 합니다. 엔드포인트가 지원하는 정확한 연결 수는 게이트웨이의 특성이며 실제로 게이트웨이 내의 리소스 할당에 따라 달라질 수 있습니다.

어떤 경우에는 신호를 전달하기 위해 디지털 채널이 사용됩니다. 이는 SS7 "F" 링크 또는 ISDN "D" 채널의 경우입니다. 이러한 신호 기능을 지원하는 미디어 게이트웨이는 IETF의 SIGTRAN 작업 그룹에서 정의한 "백홀" 절차를 사용하여 통화 에이전트와 신호 패킷을 주고받을 수 있어야 합니다. 디지털 채널은 때때로 "MF R2"와 같은 채널 관련 신호와 함께 사용됩니다. 이러한 신호 기능을 지원하는 미디어 게이트웨이는 MGCP에 정의된 이벤트 신호 및 보고 절차에 따라 "윙크" 또는 "A"와 같은 해당 신호를 감지하고 생성할 수 있어야 합니다.

---
##### **2.1.1.2.  Analog line**

아날로그 회선은 "클라이언트" 인터페이스로 사용되어 일반 전화 장치에 서비스를 제공하거나 "서비스" 인터페이스로 사용되어 게이트웨이에서 아날로그 호출을 보내고 받을 수 있습니다. 미디어 게이트웨이가 NAS 서비스도 지원하는 경우 게이트웨이는 오디오 인코딩된 데이터\(모뎀 연결\)를 수신하고 이를 데이터 패킷으로 변환할 수 있어야 합니다.

```text
                                         +-------
                        +---------------+|
              (line) ===|analog endpoint| -------- Connections
                        +---------------+|
                                         +-------
```

미디어 게이트웨이는 엔드포인트와 패킷 네트워크 사이 또는 엔드포인트와 동일한 게이트웨이의 다른 엔드포인트 사이에 여러 연결을 설정할 수 있어야 합니다. 이러한 연결에서 발생하는 오디오 신호는 이 문서의 뒷부분에 지정된 대로 연결 "모드"에 따라 믹싱되어야 합니다. 엔드포인트가 지원하는 정확한 연결 수는 게이트웨이의 특성이며 실제로 게이트웨이 내의 리소스 할당에 따라 달라질 수 있습니다. 그러나 일반적인 게이트웨이는 "통화 대기" 또는 "3방향 통화"와 같은 서비스를 제공하기 위해 엔드포인트당 2\~3개의 연결을 지원할 수 있어야 합니다.

---
##### **2.1.1.3.  Annoucement server access point**

알림 서버 엔드포인트는 알림 서비스에 대한 액세스를 제공합니다. 통화 에이전트의 요청에 따라 알림 서버는 지정된 알림을 "재생"합니다. 통화 에이전트의 요청은 MGCP에 정의된 이벤트 신호 및 보고 절차를 따릅니다.

```text
             +----------------------+
             | Announcement endpoint| -------- Connection
             +----------------------+
```

특정 알림 끝점은 한 번에 둘 이상의 연결을 지원하지 않아야 합니다. 동일한 끝점에 여러 연결이 설정된 경우 동일한 알림이 모든 연결을 통해 동시에 재생됩니다.

알림 서버에 대한 연결은 일반적으로 단방향 또는 "반이중"입니다. 즉, 알림 서버는 연결에서 오디오 신호를 듣지 않을 것으로 예상됩니다.

---
##### **2.1.1.4.  Interactive Voice Response access point**

IVR\(대화형 음성 응답\) 끝점은 IVR 서비스에 대한 액세스를 제공합니다. 통화 에이전트의 요청에 따라 IVR 서버는 공지 사항 및 신호음을 "재생"하고 사용자의 응답을 "듣습니다". 통화 에이전트의 요청은 MGCP에 정의된 이벤트 신호 및 보고 절차를 따릅니다.

```text
                      +-------------+
                      | IVR endpoint| -------- Connection
                      +-------------+
```

특정 IVR 엔드포인트는 한 번에 둘 이상의 연결을 지원하지 않습니다. 동일한 끝점에 여러 연결이 설정된 경우 모든 연결을 통해 동일한 신호음과 알림이 동시에 재생됩니다.

---
##### **2.1.1.5.  Conference bridge access point**

컨퍼런스 브리지 엔드포인트는 특정 컨퍼런스에 대한 액세스를 제공하는 데 사용됩니다.

```text
                                         +-------
             +--------------------------+|
             |Conference bridge endpoint| -------- Connections
             +--------------------------+|
                                         +-------
```

미디어 게이트웨이는 엔드포인트와 패킷 네트워크 사이 또는 엔드포인트와 동일한 게이트웨이의 다른 엔드포인트 사이에 여러 연결을 설정할 수 있어야 합니다. 이러한 연결에서 발생하는 신호는 이 문서의 뒷부분에 지정된 대로 연결 "모드"에 따라 혼합되어야 합니다. 엔드포인트가 지원하는 정확한 연결 수는 게이트웨이의 특성이며 실제로 게이트웨이 내의 리소스 할당에 따라 달라질 수 있습니다.

---
##### **2.1.1.6.  Packet relay**

패킷 릴레이 끝점은 일반적으로 두 개의 연결만 지원하는 특정 형태의 컨퍼런스 브리지입니다. 패킷 릴레이는 보호된 네트워크와 개방형 네트워크 사이의 방화벽에서 찾을 수 있으며, 호환되지 않는 게이트웨이\(예: 호환되는 압축 알고리즘을 지원하지 않는 게이트웨이 또는 IP와 같은 다른 전송 네트워크에서 작동하는 게이트웨이\) 간의 상호 운용을 제공하는 데 사용되는 트랜스코딩 서버에서 찾을 수 있습니다. ATM.

```text
                                          +-------
                  +---------------------+ |
                  |Packet relay endpoint|  2 connections
                  +---------------------+ |
                                          +-------
```

---
##### **2.1.1.7.  Wiretap access point**

도청 액세스 포인트는 도청 서비스에 대한 액세스를 제공하여 연결의 녹음 또는 재생을 제공합니다.

```text
                  +-----------------+
                  | Wiretap endpoint| -------- Connection
                  +-----------------+
```

특정 도청 엔드포인트는 한 번에 두 개 이상의 연결을 지원해서는 안 됩니다. 동일한 끝점에 여러 연결이 설정된 경우 녹음 또는 재생 시 이 연결에서 수신된 오디오 신호가 혼합됩니다.

도청 끝점에 대한 연결은 일반적으로 단방향 또는 "반이중"입니다. 즉, 도청 서버는 통화 중에 자신의 존재 여부를 알릴 것으로 예상되지 않습니다.

---
##### **2.1.1.8.  ATM "trunk side" interface.**

ATM "트렁크 측" 엔드포인트는 일반적으로 하나 이상의 ATM 영구 가상 회선이 기존 "TDM" 트렁크 연결 스위치 대신 사용될 때 발견됩니다. ATM/AAL2를 사용하는 경우 여러 트렁크 또는 채널이 단일 가상 회선에서 다중화됩니다. 이러한 각 트렁크는 단일 끝점에 해당합니다.

```text
                                         +-------
                     +------------------+|
         (channel) = |ATM trunk endpoint| -------- Connections
                     +------------------+|
                                         +-------
```

미디어 게이트웨이는 엔드포인트와 패킷 네트워크 사이 또는 엔드포인트와 동일한 게이트웨이의 다른 엔드포인트 사이에 여러 연결을 설정할 수 있어야 합니다. 이러한 연결에서 발생하는 신호는 이 문서의 뒷부분에 지정된 대로 연결 "모드"에 따라 혼합되어야 합니다. 엔드포인트가 지원하는 정확한 연결 수는 게이트웨이의 특성이며 실제로 게이트웨이 내의 리소스 할당에 따라 달라질 수 있습니다.

---
#### **2.1.2.  Endpoint identifiers**

엔드포인트 식별자에는 대소문자를 구분하지 않는 두 가지 구성요소가 있습니다.

\* 엔드포인트를 관리하는 게이트웨이의 도메인 이름,

\* 해당 게이트웨이 내의 로컬 이름,

로컬 이름의 구문은 이름이 지정되는 엔드포인트 유형에 따라 다릅니다. 그러나 이러한 각 유형의 로컬 이름은 당연히 계층적이며, 주어진 엔드포인트를 포함하는 물리적 게이트웨이를 식별하는 용어로 시작하고 관련 개별 ​​엔드포인트를 지정하는 용어로 끝납니다. 이를 염두에 두고 이러한 엔터티 유형에 대한 엔터티 이름 필드의 구성 및 해석에 대한 다음 규칙을 지원해야 합니다.\(MUST\)

1\) 이름 지정 경로의 개별 용어는 단일 슬래시\("/", ASCII 2F 16진수\)로 구분되어야 합니다.\(MUST\)

2\) 개별 용어는 문자, 숫자 또는 기타 인쇄 가능한 문자로 구성된 문자열입니다. 단, 구분 기호로 사용되는 문자\("/", "@"\), 와일드카드에 사용되는 문자\("\*", "$"\) 및 공백.

3\) 와일드카드는 와일드카드를 사용하는 명명 경로의 용어를 별표\("\*"\) 또는 달러 기호\("$"\)로 표시합니다. 따라서 전체 이름 지정 경로가 다음과 같은 경우

```text
             term1/term2/term3
```

- 와일드카드가 사용된 용어에 따라 엔터티 이름 필드는 다음과 같습니다.

\*/term2/term3\(term1이 와일드카드인 경우\)

- term1/\*/term3 term2가 와일드카드인 경우 term1/term2/\* term3이 와일드카드인 경우 term1/\*/\* term2와 term3이 와일드카드인 경우 등

- 각 예에서는 별표 대신 달러 기호가 나타날 수 있습니다.

4\) 별표로 표시된 용어는 "미디어 게이트웨이 범위 내에서 알려진 이 용어의 모든 값을 사용합니다"로 해석됩니다. 달러 기호로 표시되는 용어는 "미디어 게이트웨이 범위 내에서 알려진 이 용어의 하나의 값을 사용하십시오"로 해석됩니다. 특정 명령에 대한 설명은 여기에 제공된 일반 규칙 내에서 선택을 위한 추가 기준을 추가할 수 있습니다.

미디어 게이트웨이가 여러 물리적 게이트웨이를 제어하는 ​​경우 명명의 첫 번째 용어는 원하는 엔터티를 포함하는 물리적 게이트웨이를 식별해야 합니다. 미디어 게이트웨이가 단일 물리적 게이트웨이만 제어하는 ​​경우 명명 문자열의 첫 번째 용어는 현지 관행에 따라 해당 물리적 ​​게이트웨이를 식별할 수 있습니다. 와일드카드 문자로만 구성된 로컬 이름은 미디어 게이트웨이 내의 모든\(\*\) 또는 임의\($\) 엔드포인트를 나타냅니다.\(MUST, MAY\)

트렁킹 게이트웨이의 경우 엔드포인트는 게이트웨이를 전화 스위치에 연결하는 트렁크 회로입니다. 이러한 회로는 일반적으로 물리적 인터페이스를 통해 게이트웨이에 연결되는 디지털 멀티플렉스로 그룹화됩니다. 이러한 회로는 세 가지 맥락에서 명명됩니다.

\* ISUP 프로토콜에서 트렁크는 그룹이 연결되는 스위치의 SS7 포인트 코드로 식별되는 트렁크 그룹으로 그룹화됩니다. 트렁크 그룹 내의 회선은 회선 번호\(ISUP의 CIC\)로 식별됩니다.

\* 게이트웨이 구성 파일에서 물리적 인터페이스는 일반적으로 임의의 텍스트 문자열인 인터페이스 이름으로 식별됩니다. 인터페이스가 여러 회로를 다중화하는 경우 개별 회로는 일반적으로 회로 번호로 식별됩니다.

\* MGCP에서 엔드포인트는 엔드포인트 식별자로 식별됩니다.

통화 에이전트는 구성 데이터베이스를 사용하여 ISUP 트렁크 그룹 내의 회선 번호 범위를 물리적 인터페이스를 통해 게이트웨이에 연결된 멀티플렉스의 해당 회선 범위에 매핑합니다. 게이트웨이는 MGCP에서 도메인 이름으로 식별됩니다. 로컬 이름은 물리적 인터페이스의 이름\(예: X35V3+A4\)과 인터페이스에 연결된 멀티플렉스 내의 회로 번호\(예: 13\)를 모두 인코딩하도록 구성됩니다. 회로 번호는 인터페이스 이름과 구분됩니다. 다음과 같이 분수 막대로:

```text
        X35V3+A4/13
```

다른 유형의 엔드포인트는 다른 규칙을 사용합니다. 예를 들어, 게이트웨이는 하나의 회선만 제어하도록 구성되어 물리적 인터페이스가 있는 경우 회선 번호는 생략됩니다. 이러한 이름의 정확한 구문은 해당 서버 사양에 지정되어야 합니다.

---
#### **2.1.3.  Calls and connections**

"통화"에 포함될 각 엔드포인트의 통화 에이전트에 연결이 생성됩니다. 두 개의 "DS0" 끝점\(EP1 및 EP2\) 간의 연결에 대한 일반적인 예에서 끝점을 제어하는 ​​통화 에이전트는 두 개의 연결\(C1 및 C2\)을 설정합니다.

```text
                 +---+                            +---+
   (channel1) ===|EP1|--(C1)--...        ...(C2)--|EP2|===(channel2)
                 +---+                            +---+
```

각 연결은 연결 식별자로 로컬로 지정되며 연결 속성으로 특징지어집니다.

두 엔드포인트가 동일한 통화 에이전트에 의해 관리되는 게이트웨이에 있는 경우 다음 세 단계를 통해 생성이 수행됩니다.

1\) 통화 에이전트는 첫 번째 엔드포인트에서 "연결 생성"을 첫 번째 게이트웨이에 요청합니다. 게이트웨이는 해당 연결에 리소스를 할당하고 "세션 설명"을 제공하여 명령에 응답합니다. 세션 설명에는 IP 주소, UDP 포트, 패킷화 매개변수 등 제3자가 새로 생성된 연결을 향해 패킷을 보내는 데 필요한 정보가 포함되어 있습니다.

```text
   2) The call agent then asks the second gateway to "create a
      connection" on the second endpoint.  The command carries the
      "session description" provided by the first gateway. The gateway
      allocates resources to that connection, and respond to the command
      by providing its own "session description."
```

3\) 통화 에이전트는 "연결 수정" 명령을 사용하여 이 두 번째 "세션 설명"을 첫 번째 끝점에 제공합니다. 이 작업이 완료되면 통신은 양방향으로 진행될 수 있습니다.

두 엔드포인트가 서로 다른 통화 에이전트에 의해 관리되는 게이트웨이에 있는 경우 이러한 두 통화 에이전트는 두 엔드포인트에서 연결 생성을 동기화하기 위해 통화 에이전트를 통해 통화 에이전트 신호 프로토콜로 정보를 교환해야 합니다.

```text
   Once established, the connection parameters can be modified at any
   time by a "modify connection" command.  The call agent may for
   example instruct the gateway to change the compression algorithm used
   on a connection, or to modify the IP address and UDP port to which
   data should be sent, if a connection is "redirected."
```

통화 에이전트는 게이트웨이에 "연결 삭제" 명령을 보내 연결을 제거합니다. 또한 게이트웨이는 일부 상황에서 연결을 유지할 수 없음을 게이트웨이에 알릴 수도 있습니다.

다음 다이어그램은 게이트웨이에서 본 연결 상태의 보기를 제공합니다.

```text
             Create connection
                received
                    |
                    V
           +-------------------+
           |resource allocation|-(failed)-+
           +-------------------+          |
                    |           (connection refused)
              (successful)
                    |
                    v
       +----------->+
       |            |
       |   +-------------------+
       |   |  remote session   |
       |   |   description     |----------(yes)--------+
       |   |    available ?    |                       |
       |   +-------------------+                       |
       |            |                                  |
       |          (no)                                 |
       |            |                                  |
       |      +-----------+                         +------+
       | +--->| half open |------> Delete   <-------| open |<----------+
       | |    |  (wait)   |      Connection         |(wait)|           |
       | |    +-----------+       received          +------+           |
       | |          |                 |              |                 |
       | |   Modify Connection        |         Modify Connection      |
       | |      received              |            received            |
       | |          |                 |                |               |
       | | +--------------------+     |       +--------------------+   |
       | | |assess modification |     |       |assess modification |   |
       | | +--------------------+     |       +--------------------+   |
       | |    |             |         |          |             |       |
       | |(failed)     (successful)   |      (failed)     (successful) |
       | |    |             |         |          |             |       |
       | +<---+             |         |          +-------------+-------+
       |                    |         |
       +<-------------------+         |
                                      |
                             +-----------------+
                             | Free connection |
                             | resources.      |
                             | Report.         |
                             +-----------------+
                                      |
                                      V
```

---
##### **2.1.3.1.  Names of calls**

```text
   One of the attributes of each connection is the "call identifier."
```

통화는 기본 플랫폼이나 에이전트와 관계없이 고유 식별자로 식별됩니다. 이러한 식별자는 통화 에이전트에 의해 생성됩니다. MGCP에서는 구조화되지 않은 옥텟 문자열로 처리됩니다.

통화 식별자는 시스템 내에서 고유하거나 최소한 동일한 게이트웨이를 제어하는 ​​통화 에이전트 모음 내에서 고유해야 합니다. 통화 에이전트가 동일한 게이트웨이 또는 다른 게이트웨이에서 동일한 통화와 관련된 여러 연결을 구축하면 동일한 통화에 속하는 이러한 연결은 동일한 통화 ID를 공유합니다. 이 식별자는 MGCP 범위를 벗어나는 회계 또는 관리 절차에서 사용될 수 있습니다.

---
##### **2.1.3.2.  Names of connections**

연결 식별자는 연결 생성을 요청받을 때 게이트웨이에 의해 생성됩니다. 엔드포인트 컨텍스트 내에서 연결을 식별합니다. MGCP에서는 구조화되지 않은 옥텟 문자열로 처리됩니다. 게이트웨이는 이 식별자를 사용한 연결 종료와 동일한 끝점에 대한 새 연결에서의 사용 사이에 적절한 대기 기간\(최소 3분\)이 경과하는지 확인해야 합니다. \(게이트웨이는 게이트웨이 컨텍스트 내에서 고유한 식별자를 사용하기로 결정할 수 있습니다.\)

---
##### **2.1.3.3.  Management of resources, attributes of connections**

특정 신호 처리 기능이나 패킷화 기능과 같은 다양한 유형의 리소스가 연결과 연관됩니다. 일반적으로 이러한 리소스는 두 가지 범주로 분류됩니다.

1\) "네트워크의 비트" 형식에 영향을 미치고 연결과 관련된 두 번째 끝점으로 전달되어야 하는 외부에서 볼 수 있는 리소스입니다.

2\) 연결을 통해 전송되는 신호와 수신된 신호가 엔드포인트에서 처리되는 방법을 결정하는 내부 리소스입니다.

연결에 할당된 리소스, 더 일반적으로는 연결 처리는 통화 에이전트의 지시에 따라 게이트웨이에 의해 선택됩니다. 통화 에이전트는 두 가지 매개변수 세트를 게이트웨이로 전송하여 이러한 지침을 제공합니다.

1\) 로컬 지시문은 연결에 사용해야 하는 리소스 선택에 대해 게이트웨이에 지시합니다.

2\) 가능한 경우, 연결의 상대방이 제공하는 "세션 설명".

로컬 지시문은 연결 모드\(예: 전송 전용, 전송-수신\), 선호하는 코딩 또는 패킷화 방법, 에코 제거 또는 묵음 억제 사용과 같은 매개변수를 지정합니다. \(자세한 목록은 CreateConnection 명령의 LocalConnectionOptions 매개 변수 사양에서 찾을 수 있습니다.\) 이러한 각 매개 변수에 대해 통화 에이전트는 값, 값 범위를 지정하거나 값을 전혀 지정하지 않을 수 있습니다. 이를 통해 통화 에이전트가 연결 처리의 세부 사항을 지정하는 매우 엄격한 제어부터 통화 에이전트가 최대 대역폭과 같은 광범위한 지침만 지정하는 매우 느슨한 제어에 이르기까지 다양한 구현을 통해 다양한 수준의 제어를 구현할 수 있습니다. 게이트웨이는 세부 값을 선택합니다.

로컬 지시문의 값에 따라 게이트웨이는 연결에 할당된 리소스를 결정합니다. 이것이 가능하면 게이트웨이는 원격 세션 설명과 일치하는 값을 선택합니다. 그러나 매개변수가 정확히 동일해야 한다는 절대적인 요구 사항은 없습니다.

리소스가 할당되면 게이트웨이는 패킷을 수신하려는 방식을 설명하는 "세션 설명"을 구성합니다. 경우에 따라 세션 설명에 다양한 값이 표시될 수 있습니다. 예를 들어 게이트웨이가 여러 압축 알고리즘 중 하나를 수락할 준비가 된 경우 이러한 허용 알고리즘 목록을 제공할 수 있습니다.

```text
                 Local Directives
                (from call agent 1)
                        |
                        V
                 +-------------+
                 | resources   |
                 | allocation  |
                 | (gateway 1) |
                 +-------------+
                   |         |
                   V         |
                 Local       |
              Parameters     V
                   |      Session
                   |    Description               Local Directives
                   |         |                   (from call agent 2)
                   |         +---> Transmission----+      |
                   |                (CA to CA)     |      |
                   |                               V      V
                   |                           +-------------+
                   |                           | resources   |
                   |                           | allocation  |
                   |                           | (gateway 2) |
                   |                           +-------------+
                   |                               |      |
                   |                               |      V
                   |                               |    Local
                   |                               |  Parameters
                   |                            Session
                   |                          Description
                   |         +---- Transmission<---+
                   |         |      (CA to CA)
                   V         V
                 +-------------+
                 | modification|
                 | (gateway 1) |
                 +-------------+
                   |
                   V
                 Local
              Parameters

      -- Information flow: local directives & session descriptions --
```

---
##### **2.1.3.4.  Special case of local connections**

대규모 게이트웨이에는 종종 다양한 유형의 엔드포인트가 많이 포함됩니다. 일부 네트워크에서는 동일한 게이트웨이 내에 있는 엔드포인트 간에 연결을 설정해야 하는 경우가 많습니다. 이러한 연결의 예는 다음과 같습니다.

\* 국선을 도청장치에 연결하고,

\* 대화형 음성 응답 장치에 통화 연결,

\* 회의 장치에 통화 연결,

\* 한 엔드포인트에서 다른 엔드포인트로 통화 라우팅\(종종 "헤어핀" 연결이라고 설명됨\)

로컬 연결은 네트워크 연결보다 설정이 훨씬 간단합니다. 대부분의 경우 연결은 TDM 버스와 같은 일부 로컬 상호 연결 장치를 통해 설정됩니다.

```text
   When two endpoints are managed by the same gateway, it is possible to
   specify the connection in a single command that conveys the name of
   the two endpoints that will be connected.  The command is essentially
   a "Create Connection" command which includes the name of the second
   endpoint in lieu of the "remote session description."
```

---
#### **2.1.4.  Names of Call Agents and other entities**

미디어 게이트웨이 제어 프로토콜은 향상된 네트워크 안정성을 위해 중복 통화 에이전트를 구현할 수 있도록 설계되었습니다. 이는 엔터티와 하드웨어 플랫폼 또는 네트워크 인터페이스 간에 고정된 바인딩이 없음을 의미합니다.

다음 예방 조치를 통해 신뢰성을 향상시킬 수 있습니다.

\* 엔드포인트나 통화 상담원과 같은 엔터티는 네트워크 주소가 아닌 도메인 이름으로 식별됩니다. 여러 주소가 도메인 이름과 연결될 수 있습니다. 명령이나 응답을 네트워크 주소 중 하나로 전달할 수 없는 경우 구현에서는 다른 주소를 사용하여 전송을 다시 시도해야 합니다.

\* 법인은 다른 플랫폼으로 이동할 수 있습니다. 논리적 이름\(도메인 이름\)과 실제 플랫폼 간의 연결은 도메인 이름 서비스에 유지됩니다. 통화 상담원과 게이트웨이는 DNS에서 읽은 레코드의 수명을 추적해야 합니다. TTL\(Time to Live\)이 만료된 경우 DNS에 쿼리하여 정보를 새로 고쳐야 합니다.

```text
   In addition to the indirection provided by the use of domain names
   and the DNS, the concept of "notified entity" is central to
   reliability and fail-over in MGCP. The "notified entity" for an
   endpoint is the Call Agent currently controlling that endpoint. At
   any point in time, an endpoint has one, and only one, "notified
   entity" associated with it, and when the endpoint needs to send a
   command to the Call Agent, it MUST send the command to the current
   "notified entity" for which endpoint(s) the command pertains. Upon
   startup, the "notified entity" MUST be set to a provisioned value.
   Most commands sent by the Call Agent include the ability to
   explicitly name the "notified entity" through the use of a
   "NotifiedEntity" parameter. The "notified entity" will stay the same
   until either a new "NotifiedEntity" parameter is received or the
   endpoint reboots. If the "notified entity" for an endpoint is empty
   or has not been set explicitly, the "notified entity" will then
   default to the source address of the last connection handling command
   or notification request received for the endpoint. Auditing will thus
   not change the "notified entity."
```

---
#### **2.1.5.  Digit maps**

통화 에이전트는 사용자가 다이얼한 숫자를 수집하도록 게이트웨이에 요청할 수 있습니다. 이 기능은 사용자가 다이얼하는 번호를 수집하기 위해 주거용 게이트웨이와 함께 사용하도록 고안되었습니다. 또한 통화 제어 서비스에서 요청하는 액세스 코드, 신용 카드 번호 및 기타 번호를 수집하기 위해 트렁킹 게이트웨이 및 액세스 게이트웨이와 함께 사용할 수도 있습니다.

대체 절차는 전화를 걸자마자 전화를 건 숫자를 게이트웨이가 통화 에이전트에게 알리는 것입니다. 그러나 이러한 절차는 많은 수의 상호 작용을 생성합니다. 전화를 건 번호를 버퍼에 모아서 단일 메시지로 전송하는 것이 바람직합니다.

그러나 이러한 누적 접근 방식의 문제점은 게이트웨이가 전송 전에 얼마나 많은 숫자를 누적해야 하는지 예측하기 어렵다는 것입니다. 예를 들어, 책상에 있는 전화기를 사용하여 다음 번호로 전화를 걸 수 있습니다.

```text
        _______________________________________________________
       |  0                     |  Local operator             |
       |  00                    |  Long distance operator     |
       |  xxxx                  |  Local extension number     |
       |  8xxxxxxx              |  Local number               |
       |  #xxxxxxx              |  Shortcut to local number at|
       |                        |  other corporate sites      |
       |  *xx                   |  Star services              |
       |  91xxxxxxxxxx          |  Long distance number       |
       |  9011 + up to 15 digits|  International number       |
       |________________________|_____________________________|
```

이 문제에 대한 해결책은 다이얼 플랜에 해당하는 숫자 맵을 게이트웨이에 로드하는 것입니다. 이 숫자 맵은 Unix 시스템 명령인 egrep에서 파생된 구문을 사용하여 표현됩니다. 예를 들어 위에서 설명한 다이얼 플랜은 다음과 같은 숫자 맵을 생성합니다.

```text
      (0T| 00T|[1-7]xxx|8xxxxxxx|#xxxxxxx|*xx|91xxxxxxxxxx|9011x.T)
```

숫자 맵의 형식적 구문은 프로토콜의 형식적 구문 설명\(섹션 3.4\)에서 DigitMap 규칙으로 설명됩니다. 이 구문에 따르면 Digit-Map은 "문자열" 또는 문자열 목록으로 정의됩니다. 목록의 각 문자열은 숫자 집합, 타이머 또는 정규식으로 지정되는 대체 번호 지정 체계입니다. 숫자, 문자 또는 타이머를 감지하는 게이트웨이는 다음을 수행합니다.

```text
   1) Add the event parameter code as a token to the end of an internal
      state variable called the "current dial string"
```

2\) 현재 다이얼 문자열을 숫자 맵 테이블에 적용하여 어휘 순서대로 숫자 맵의 각 정규식과 일치를 시도합니다.

3\) 결과가 적합하지 않은 경우\(숫자 지도의 최소 하나의 항목과 부분적으로 일치\) 더 이상 수행할 작업이 없습니다.

결과가 일치하거나 자격이 초과된 경우\(즉, 더 이상 일치하는 숫자가 없을 수 있는 경우\) 현재 숫자 문자열을 통화 상담원에게 보냅니다. 이 사양에서 일치는 지정된 대안 중 하나와 정확히 일치하는 "완벽한 일치"이거나 다이얼 문자열이 대안 중 어느 것과도 일치하지 않을 때 발생하는 불가능한 일치일 수 있습니다. 예를 들어, 예상치 못한 타이머로 인해 "불가능한 일치"가 발생할 수 있습니다. 완벽한 일치와 불가능한 일치 모두 누적된 숫자에 대한 알림을 트리거합니다.

통화 에이전트가 게이트웨이에 숫자를 수신하도록 지시할 때마다 통화 에이전트가 게이트웨이에 숫자 맵을 제공합니다.

---
#### **2.1.6.  Names of events**

이벤트와 신호의 개념은 MGCP의 핵심입니다. 통화 에이전트는 엔드포인트에서 발생하는 특정 이벤트에 대해 알림을 받도록 요청할 수 있습니다. 오프훅 이벤트, 통화 에이전트는 특정 신호가 엔드포인트에 적용되도록 요청할 수 있습니다. 발신음.

이벤트와 신호는 다음에서 이벤트 이름으로 참조할 동일한 네임스페이스를 공유하는 패키지로 그룹화됩니다. 패키지는 특정 유형의 엔드포인트에서 지원하는 이벤트 및 신호를 그룹화한 것입니다. 예를 들어, 한 패키지는 아날로그 액세스 회선에 대한 특정 이벤트 및 신호 그룹을 지원할 수 있고, 다른 패키지는 비디오 회선에 대한 다른 이벤트 및 신호 그룹을 지원할 수 있습니다. 특정 엔드포인트 유형에 대해 하나 이상의 패키지가 존재할 수 있습니다.

이벤트 이름은 대소문자를 구분하지 않으며 패키지 이름과 이벤트 이름이라는 두 가지 논리적 부분으로 구성됩니다. 두 이름 모두 문자, 하이픈, 숫자로 구성된 문자열입니다. 단, 하이픈은 이름의 첫 번째나 마지막 문자가 될 수 없습니다. 패키지 또는 이벤트 이름은 대소문자를 구분하지 않습니다. "hu", "Hu", "HU" 또는 "hU"와 같은 값은 동일한 것으로 간주되어야 합니다.

패키지 이름의 예로는 "D"\(DTMF\), "M"\(MF\), "T"\(트렁크\) 또는 "L"\(라인\)이 있습니다. 이벤트 이름의 예로는 "hu"\(오프 후크 또는 "전화 끊기" 전환\), "hf"\(플래시 후크\) 또는 "0"\(숫자 0\)이 있습니다.

텍스트 표현에서 패키지 이름은 슬래시\("/"\)로 이벤트 이름과 구분됩니다. 패키지 이름은 실제로 선택 사항입니다. 각 엔드포인트 유형에는 이와 연관된 기본 패키지가 있으며, 이벤트 이름에서 패키지 이름을 제외하면 해당 엔드포인트 유형의 기본 패키지 이름이 가정됩니다. 예를 들어, 아날로그 액세스 회선의 경우 다음 두 이벤트 이름은 동일합니다.

아날로그 액세스 회선용 회선 패키지의 l/dl 발신음.

아날로그 액세스 회선에 대한 회선 패키지\(기본값\)의 dl 발신음.

이 문서는 패키지 이름과 이벤트 이름의 기본 집합을 정의합니다. 추가 패키지 이름과 이벤트 이름을 IANA에 등록할 수 있습니다. 패키지 정의는 패키지의 이름과 패키지에 속하는 각 이벤트의 정의를 정의합니다. 이벤트 정의에는 이벤트의 정확한 이름\(예: MGCP에 사용되는 코드\), 이벤트의 일반 텍스트 정의, 그리고 적절한 경우 해당 신호의 정확한 정의\(예: 오디오 신호의 정확한 주파수\)가 포함되어야 합니다. 발신음이나 DTMF 톤과 같은 것입니다.

또한 구현자는 실험적 패키지를 사용하여 경험을 쌓을 수 있습니다. 실험 패키지의 이름은 "x-"라는 두 문자로 시작해야 합니다. IANA는 이러한 문자로 시작하는 패키지 이름을 등록하지 않습니다.

숫자나 문자는 많은 패키지, 특히 "DTMF" 및 "MF"에서 지원됩니다. 숫자와 문자는 숫자 맵 정의의 "숫자" 및 "문자" 규칙에 따라 정의됩니다. 이 정의는 숫자\(0\~9\), 별표 또는 별표\("\*"\), 직교, 숫자 또는 파운드 기호\("#"\), 문자 "A", "B", "C"를 나타냅니다. 및 "D", 타이머 표시 "T". 이러한 문자는 사용자가 다이얼을 누른 키를 나타내는 "숫자 문자열"로 결합될 수 있습니다. 또한 문자 "X"를 사용하여 모든 숫자를 나타낼 수 있으며 "$" 기호를 와일드카드 표기로 사용할 수 있습니다. 숫자 문자열을 쉽게 표현해야 하는 필요성은 이벤트 이름의 형식에 영향을 미칩니다.

숫자를 나타내지 않는 이벤트 이름은 숫자가 아닌 문자나 A, B, C, D, T, X 중 하나가 아닌 문자를 항상 하나 이상 포함해야 합니다. \(이러한 이름에는 특수 기호 "\*를 포함할 수 없습니다. ", "#", "/" 또는 "$".\)

통화 에이전트는 이벤트 그룹을 감지하기 위해 게이트웨이에 요청해야 하는 경우가 많습니다. 이러한 그룹을 나타내는 데 두 가지 규칙을 사용할 수 있습니다.

\* 와일드카드 규칙을 사용하면 패키지에 속한 이벤트, 여러 패키지의 지정된 이벤트, 게이트웨이에서 지원하는 모든 패키지의 이벤트 이벤트를 감지할 수 있습니다.

\* 정규식 범위 표기법을 사용하여 숫자 범위를 감지할 수 있습니다.

별표\(\*\)를 패키지 이름 대신 와일드카드로 사용할 수 있으며, "all" 키워드를 이벤트 이름 대신 와일드카드로 사용할 수 있습니다.

"foo/all"과 같은 이름은 "foo" 패키지의 모든 이벤트를 나타냅니다. "\*/bar"와 같은 이름은 게이트웨이에서 지원하는 모든 패키지의 "bar" 이벤트를 나타냅니다. 이름 "\*" 또는 "\*/all" 게이트 웨이에서 지원하는 모든 이벤트를 나타냅니다.

통화 에이전트는 해당 문자를 개별적으로 설명하거나 숫자 문자열 구문에 정의된 "범위" 표기법을 사용하여 일련의 숫자 또는 문자를 감지하도록 게이트웨이에 요청할 수 있습니다. 예를 들어 통화 상담원은 다음을 수행할 수 있습니다.

문자 "x"를 사용하여 "모든 문자 또는 숫자"를 나타냅니다. 숫자 0\~9와 파운드 기호를 표시하려면 "\[0-9#\]" 표기법을 사용하세요.

어떤 경우에는 통화 에이전트가 엔드포인트 자체가 아닌 연결에서 이벤트를 생성하거나 감지하도록 게이트웨이에 요청합니다. 예를 들어, 게이트웨이는 연결 시 통화 연결음을 제공하도록 요청받을 수 있습니다. 이벤트가 연결에 적용되면 다음과 같이 "at" 기호\(@\)를 구분 기호로 사용하여 연결 이름이 이벤트 이름에 추가됩니다.

```text
     G/rt@0A3F58
```

와일드카드 문자 "\*"\(별표\)를 사용하여 "모든 연결"을 나타낼 수 있습니다. 이 규칙을 사용하면 게이트웨이는 엔드포인트에 연결된 모든 연결에서 이벤트를 생성하거나 감지합니다. 이 규칙의 예는 다음과 같습니다.

```text
     R/qa@*
```

와일드카드 문자 "$"를 사용하여 "현재 연결"을 나타낼 수 있습니다. 이벤트 알림 요청이 명령 생성 또는 수정 명령 내에서 "캡슐화"된 경우 통화 에이전트에서만 사용해야 합니다. 이 규칙을 사용하면 게이트웨이는 현재 생성되거나 수정되는 연결에서 이벤트를 생성하거나 감지합니다. 이 규칙의 예는 다음과 같습니다.

```text
     G/rt@$
```

연결 ID 또는 와일드카드 대체는 "모든 패키지" 및 "모든 이벤트" 규칙과 함께 사용할 수 있습니다. 예를 들어 다음과 같은 표기법이 있습니다.

```text
     */all@*
```

모든 연결에서 모든 이벤트를 지정하는 데 사용할 수 있습니다.

이벤트와 신호는 패키지에 설명되어 있습니다. 패키지 설명은 각 이벤트에 대해 다음 정보를 제공해야 합니다.

\* 이벤트 및 해당 목적에 대한 설명은 클라이언트에서 생성된 실제 신호\(예: xxms FSK 톤\)와 사용자가 관찰한 결과\(예: MW 조명 켜기/끄기\)를 의미해야 합니다.

\* 오디오 신호의 주파수 및 진폭, 변조 및 반복과 같은 이벤트의 세부 특성,

\* 이벤트의 일반적인 및 최대 기간입니다.

신호는 동작에 따라 다양한 유형으로 구분됩니다.

\* On/Off\(OO\) 한번 적용되면 꺼질 때까지 이 신호는 영원히 지속됩니다. 이는 이벤트 또는 새로운 SignalRequests\(나중에 참조\)의 결과로 발생할 수 있습니다.

\* 타임아웃\(TO\) 일단 적용되면 이러한 신호는 \(이벤트 또는 SignalRequests에 의해\) 꺼지거나 신호 특정 기간이 경과할 때까지 지속됩니다. 패키지 사양에 따라 시간 초과 신호로 인해 "작업 완료" 이벤트가 생성될 수 있습니다.

\* Brief\(BR\) 이 신호의 지속 시간이 너무 짧아 저절로 멈춥니다. 이벤트가 발생하면 신호가 중지되지 않지만 새 SignalRequests가 적용되면 신호가 중지됩니다. \(참고: 이 점은 논의되어야 합니다. DTMF 숫자 문자열과 같은 이벤트가 실제로 완료되도록 허용해야 하는 경우를 만들 수 있습니다.\)

- TO 신호는 일반적으로 엔드포인트 사용자에게 전화를 끊는 것과 같은 특정 작업을 수행할 것으로 예상된다는 신호를 보내는 데 사용됩니다. 이러한 신호의 전송은 일반적으로 요청된 이벤트 중 첫 번째 이벤트가 생성되자마자 중단되어야 합니다.

- 패키지 설명은 모든 신호에 대해 해당 유형\(OO, TO, BR\)을 설명해야 합니다. 또한 TO 신호의 최대 지속 시간을 설명해야 합니다.

---
### **2.2.  Usage of SDP**

통화 에이전트는 MGCP를 사용하여 IP 주소, UDP 포트, RTP 프로필과 같은 연결 매개변수에 대한 설명으로 게이트웨이를 프로비저닝합니다. 이러한 설명은 RFC 2327에 문서화된 IETF 제안 표준인 세션 설명 프로토콜에 설명된 규칙을 따릅니다.

SDP는 멀티미디어 회의에 대한 설명을 허용합니다. 이 버전은 SDP 사용을 오디오 회로 및 데이터 액세스 회로 설정으로 제한합니다. 초기 세션 설명에는 오디오 연결용 "audio" 유형, 데이터 액세스용 "nas" 유형의 정확히 하나의 미디어에 대한 설명이 포함됩니다.

---
### **2.3.  Gateway Control Commands**

이 섹션에서는 MGCP의 명령에 대해 설명합니다. 서비스는 연결 처리 및 엔드포인트 처리 명령으로 구성됩니다. 프로토콜에는 9개의 명령이 있습니다.

\* 통화 에이전트는 게이트웨이에 EndpointConfiguration 명령을 발행하여 엔드포인트의 "회선 측"에서 예상되는 코딩 특성에 대해 게이트웨이에 지시할 수 있습니다.

```text
   *  The Call Agent can issue a NotificationRequest command to a
      gateway, instructing the gateway to watch for specific events such
      as hook actions or DTMF tones on a specified endpoint .
```

\* 그런 다음 게이트웨이는 Notify 명령을 사용하여 요청된 이벤트가 발생할 때 호출 에이전트에 알립니다.

\* 통화 에이전트는 CreateConnection 명령을 사용하여 게이트웨이 내부의 "엔드포인트"에서 종료되는 연결을 생성할 수 있습니다.

\* 통화 에이전트는 ModifyConnection 명령을 사용하여 이전에 설정된 연결과 관련된 매개변수를 변경할 수 있습니다.

\* 통화 에이전트는 DeleteConnection 명령을 사용하여 기존 연결을 삭제할 수 있습니다. DeleteConnection 명령은 연결이 더 이상 지속될 수 없음을 나타내기 위해 게이트웨이에서 사용될 수도 있습니다.

\* 통화 에이전트는 AuditEndpoint 및 AuditConnection 명령을 사용하여 "엔드포인트" 및 이와 관련된 모든 연결의 상태를 감사할 수 있습니다. 이러한 명령이 제공하는 기능 이상의 네트워크 관리가 일반적으로 바람직합니다. 게이트웨이 상태에 대한 정보입니다. 이러한 기능은 SNMP\(Simple Network Management Protocol\)를 사용하고 본 사양의 범위를 벗어나는 MIB 정의를 통해 지원될 것으로 예상됩니다.

\* 게이트웨이는 RestartInProgress 명령을 사용하여 게이트웨이 또는 게이트웨이가 관리하는 엔드포인트 그룹이 서비스에서 제외되거나 다시 서비스 상태로 전환됨을 통화 에이전트에 알릴 수 있습니다.

이러한 서비스를 통해 컨트롤러\(일반적으로 호출 에이전트\)는 게이트웨이에 연결된 "엔드포인트"에서 종료되는 연결 생성에 대해 게이트웨이에 지시하고 엔드포인트에서 발생하는 이벤트에 대한 정보를 받을 수 있습니다. 엔드포인트의 예는 다음과 같습니다.

\* 게이트웨이에서 끝나는 트렁크 그룹 내의 특정 트렁크 회로,

\* 공지 서버에서 처리하는 특정 공지입니다.

연결은 "통화"로 그룹화됩니다. 동일한 호출에 속하거나 속하지 않을 수 있는 여러 연결이 동일한 끝점에서 종료될 수 있습니다. 각 연결은 "보내기 전용"\(sendonly\), "수신 전용"\(recvonly\), "보내기/수신"\(sendrecv\), "회의"\(confrnce\), "데이터"로 설정할 수 있는 "모드" 매개변수로 한정됩니다. ", "비활성"\(비활성\), "루프백", "연속성 테스트"\(conttest\), "네트워크 루프백"\(netwloop\) 또는 "네트워크 연속성 테스트"\(netwtest\).

이러한 연결에서 수신된 오디오 신호의 처리는 모드 매개변수에 의해 결정됩니다.

\* "수신", "회의" 또는 "보내기/수신" 모드에서 연결을 통해 데이터 패킷으로 수신된 오디오 신호는 혼합되어 엔드포인트로 전송됩니다.

```text
   *  Audio signals originating from the endpoint are transmitted over
      all the connections whose mode is "send", "conference" or
      "send/receive."

   *  In addition to being sent to the endpoint, audio signals received
      in data packets through connections in "conference" mode are
      replicated to all the other connections whose mode is
      "conference."
```

"루프백" 및 "연속성 테스트" 모드는 유지 관리 및 연속성 테스트 작업 중에 사용됩니다. 연속성 테스트에는 두 가지 종류가 있습니다. 하나는 ITU에서 지정하고 다른 하나는 미국에서 사용됩니다. 첫 번째 경우 테스트는 루프백 테스트입니다. 원래 스위치는 베어러 회로에 톤\(진행 톤\)을 보내고 종료 스위치가 회로를 루프백할 것으로 예상합니다. 원래 스위치에서 반환된 동일한 톤\(반환 톤\)을 확인하면 COT가 통과된 것입니다. 그렇지 않은 경우 COT가 실패한 것입니다. 두 번째 경우에는 이동 톤과 복귀 톤이 다릅니다. 발신 스위치는 특정 이동 신호음을 보냅니다. 종료 스위치는 이동 톤을 감지하고 역방향으로 다른 복귀 톤을 나타냅니다. 원래 스위치가 반환 톤을 감지하면 COT가 전달됩니다. 원래 스위치가 반환 톤을 감지하지 못하면 COT가 실패한 것입니다.

모드가 "루프백"으로 설정된 경우 게이트웨이는 엔드포인트에서 들어오는 신호를 동일한 엔드포인트로 반환해야 합니다. 이 절차는 일반적으로 ITU 사양에 따라 트렁크 회로의 연속성을 테스트하는 데 사용됩니다.

모드가 "연속성 테스트"로 설정된 경우 회로의 다른 쪽 끝이 GR 사양에 따라 연속성 테스트 절차를 시작했다는 알림이 게이트웨이에 전달됩니다. 게이트웨이는 이중 톤 연속성 테스트에 필요한 응답기 모드에 회로를 배치합니다.

모드가 "네트워크 루프백"으로 설정된 경우 연결에서 수신된 오디오 신호는 동일한 연결에서 다시 에코됩니다.

모드가 "네트워크 연속성 테스트"로 설정된 경우 게이트웨이는 듀얼 톤 연속성 테스트에 필요한 트랜스폰더 모드에 따라 연결에서 수신된 패킷을 처리하고 처리된 신호를 연결로 다시 보냅니다.

---
#### **2.3.1.  EndpointConfiguration**

EndpointConfiguration 명령은 엔드포인트에서 수신할 신호의 인코딩을 지정하는 데 사용됩니다. 예를 들어, 특정 국제 전화 통신 구성에서 일부 통화는 mu-law로 인코딩된 오디오 신호를 전달하고 다른 통화는 A-law를 사용합니다. 통화 에이전트는 EndpointConfiguration 명령을 사용하여 이 정보를 게이트웨이에 전달합니다. 구성은 통화별로 다를 수 있지만 연결이 없는 경우에도 사용할 수 있습니다.

```text
           ReturnCode
           <-- EndpointConfiguration( EndpointId,
                                      BearerInformation)
```

EndpointId는 섹션 2.1.1에 정의된 대로 EndpointConfiguration이 실행되는 게이트웨이의 엔드포인트 이름입니다. "다음 중 하나" 와일드카드 규칙은 사용되지 않습니다. "모두" 와일드카드 규칙을 사용하는 경우 이름이 와일드카드와 일치하는 모든 엔드포인트에 명령이 적용됩니다.

BearerInformation은 회선측에서 수신한 데이터의 코딩을 정의하는 매개변수입니다. 이러한 정보는 하위 매개변수 목록으로 인코딩됩니다. 이 사양 버전에서 정의된 유일한 하위 매개변수는 인코딩 방법이며, 해당 값은 "A-law" 및 "mu-law"로 설정할 수 있습니다.

ReturnCode는 게이트웨이에서 반환하는 매개변수입니다. 이는 명령의 결과를 나타내며 선택적으로 설명이 뒤따르는 정수로 구성됩니다.

---
#### **2.3.2.  NotificationRequest**

NotificationRequest 명령은 엔드포인트에서 지정된 이벤트가 발생할 때 알림을 보내도록 게이트웨이에 요청하는 데 사용됩니다. 예를 들어, 엔드포인트가 팩스 통신과 관련된 신호음을 수신하고 있음을 게이트웨이가 감지한 경우 알림이 요청될 수 있습니다. 이 알림을 받는 엔터티는 이 끝점에 바인딩된 연결에서 다른 유형의 인코딩 방법을 사용하기로 결정할 수 있습니다.

```text
       ReturnCode
       <-- NotificationRequest( EndpointId,
                                [NotifiedEntity,]
                                [RequestedEvents,]
                                RequestIdentifier,
                                [DigitMap,]
                                [SignalRequests,]
                                [QuarantineHandling,]
                                [DetectEvents,]
                                [encapsulated EndpointConfiguration])
```

EndpointId는 섹션 2.1.1에 정의된 대로 NotificationRequest가 실행되는 게이트웨이의 엔드포인트 이름입니다.

NotifiedEntity는 알림을 보내야 하는 위치를 지정하는 선택적 매개변수입니다. 이 매개변수가 없으면 알림은 알림요청을 보낸 사람에게 전송되어야 합니다.

RequestIdentifier는 이 요청을 트리거하는 알림과 연관시키는 데 사용됩니다.

RequestedEvents는 게이트웨이가 감지하고 보고하도록 요청된 이벤트 목록입니다. 이러한 이벤트에는 팩스 신호음, 연속 신호음 또는 온훅 전환 등이 포함됩니다. 각 이벤트에는 다음과 같은 작업이 연결됩니다.

\* 누적된 관찰 이벤트 목록과 함께 해당 이벤트를 즉시 알려드리며,

```text
   *  Swap audio,
```

\* 이벤트 버퍼에 이벤트를 누적하지만 아직 알리지는 않습니다.

\* 숫자 지도에 따라 누적되며,

```text
   *  Keep Signal(s) active,
```

\* 포함된 알림 요청을 처리합니다.

\* 이벤트를 무시합니다.

일부 작업은 결합될 수 있습니다. 특히:

```text
   *  The "swap audio" action can be combined with "Notify",
      "Accumulate" and "Ignore."

   *  The "keep signal active" action can be combined with "Notify",
      "Accumulate", "Accumulate according to Digit Map", "Ignore" and
      "Embedded Notification Request."
```

\* "내장 알림 요청"은 다음과 결합될 수 있습니다.

- "누적" 및 "신호 활성 유지"를 사용합니다. 게이트웨이가 단일 알림 요청에 대한 응답으로 여러 알림 명령을 실행할 수 있는 경우 알림과 결합할 수도 있습니다.

명령에 지정된 requestEvents 매개변수 외에도 MGCP의 일부 프로필에는 "지속적 이벤트"라는 개념이 도입되었습니다. 이러한 프로필에 따라 영구 이벤트 목록은 MGCP 범위 외부에서 엔드포인트에 구성됩니다. 기본 MGCP 사양에서는 지속적인 이벤트를 지정하지 않습니다.

RequestedEvents 목록에 지속성 이벤트가 포함되지 않은 경우 해당 이벤트가 발생하면 해당 이벤트는 어쨌든 감지되고 마치 지속성 이벤트가 알림 작업을 통해 요청된 것처럼 다른 모든 이벤트처럼 처리됩니다. 따라서 비공식적으로 지속성 이벤트는 눈부심 감지 등이 수행되지 않더라도 알림 작업과 함께 RequestedEvents 목록에 항상 암시적으로 포함되는 것으로 볼 수 있습니다.

비지속적 이벤트는 RequestedEvents 목록에 명시적으로 포함된 이벤트입니다. 요청된 이벤트의 \(비어 있을 수도 있음\) 목록은 요청된 이벤트의 이전 목록을 완전히 대체합니다. 영구 이벤트 외에도 요청된 이벤트 목록에 지정된 이벤트만 엔드포인트에서 감지됩니다. RequestedEvents 목록에 지속적인 이벤트가 포함되어 있는 경우 지정된 작업은 RequestedEvents 목록의 수명 동안 이벤트와 관련된 기본 작업을 대체한 후 기본 작업이 복원됩니다. 예를 들어 "오프 후크 무시"가 지정되고 오프 후크 지침이 없는 새 요청이 수신된 경우 기본 "오프 후크 알림" 작업이 복원됩니다. 주어진 이벤트는 RequestedEvents에 두 번 이상 나타나서는 안 됩니다.\(MUST NOT\)

게이트웨이는 지속적 이벤트와 요청된 이벤트의 결합을 감지합니다. 이벤트가 두 목록 모두에 지정되지 않으면 무시됩니다.

오디오 교체 작업은 게이트웨이가 엔드포인트에서 둘 이상의 활성 연결을 처리할 때 사용할 수 있습니다. 이는 3자 통화, 통화 대기 및 기타 기능 시나리오의 경우입니다. 엔드포인트의 오디오 기능에 연결되는 연결을 변경할 때 호출 에이전트로의 왕복을 피하기 위해 알림 요청은 이벤트\(일반적으로 후크 플래시이지만 다른 이벤트일 수 있음\)를 로컬 기능 스왑에 매핑할 수 있습니다. 라운드 로빈 방식으로 "다음" 연결을 선택하는 오디오입니다. 연결이 하나만 있는 경우 이 작업은 사실상 아무 작업도 수행하지 않습니다.

찾고 있는 이벤트가 발생할 때 신호를 시작하려면 "EmbeddedNotificationRequest" 작업을 사용할 수 있습니다. 내장된 알림 요청에는 새로운 RequestedEvents 목록, SignalRequests 및 새로운 숫자 지도도 포함될 수 있습니다. 내장된 알림 요청의 의미는 마치 동일한 NotifiedEntity 및 RequestIdentifier를 사용하여 새 알림 요청이 방금 수신된 것과 같습니다. "내장된 알림 요청"이 활성화되면 "현재 다이얼 문자열"이 지워집니다. 관찰된 이벤트 목록과 격리 버퍼는 영향을 받지 않습니다.

MGCP 구현은 적어도 한 수준의 삽입을 지원할 수 있어야 합니다. 이 제한 사항을 존중하는 내장된 알림 요청에는 다른 내장된 알림 요청이 포함되어서는 안 됩니다.

DigitMap은 통화 에이전트가 어떤 숫자가 누적될지에 따라 숫자 맵으로 게이트웨이를 프로비저닝할 수 있도록 하는 선택적 매개변수입니다. 이 선택적 매개변수가 없으면 이전에 정의된 값이 유지됩니다. RequestedEvent 매개변수에 "숫자 지도에 따라 누적" 요청이 포함된 경우 이 매개변수는 명시적으로 또는 이전 명령을 통해 정의되어야 합니다. 이러한 숫자를 모으면 숫자 문자열이 생성됩니다. 숫자 문자열은 NotionRequest 수신 시 null 문자열로 초기화되므로 후속 알림에서는 이 요청 이후에 수집된 숫자만 반환됩니다. 숫자 맵에 따라 누적된 숫자는 발생한 순서대로 다른 누적 이벤트로 보고됩니다. 따라서 숫자 목록 사이에 다른 이벤트가 누적될 가능성이 있습니다.

SignalRequests는 벨소리 또는 연속성 신호음과 같이 게이트웨이가 엔드포인트에 적용하도록 요청하는 신호 세트를 포함하는 매개변수입니다. 신호는 이벤트 이름인 이름으로 식별되며 매개변수로 한정될 수 있습니다.

SignalRequests에 의해 트리거된 작업은 RequestedEvents 매개변수에 지정된 이벤트 컬렉션과 동기화됩니다. 예를 들어, 통지 요청이 "벨 울림"을 요구하고 이벤트 요청이 "오프 후크" 이벤트를 찾도록 요청하는 경우, 게이트웨이가 오프 후크 이벤트를 감지하는 즉시 벨 울림이 중지됩니다. 공식적인 정의는 "신호 활성 유지" 작업이 지정된 이벤트와 연결되지 않는 한 요청된 이벤트 중 하나가 감지되는 즉시 모든 "시간 초과" 신호 생성이 중지된다는 것입니다.

DTMF 숫자의 지속 시간 및 빈도와 같이 이러한 SignalRequest를 통해 요청되는 작업의 특정 정의는 MGCP 범위를 벗어납니다. 이 정의는 위치에 따라, 즉 게이트웨이마다 다를 수 있습니다.

RequestedEvents 및 SignalRequests는 동일한 이벤트 정의를 참조합니다. 어떤 경우에는 게이트웨이에게 이벤트 발생을 감지하도록 요청하고, 다른 경우에는 이벤트를 생성하도록 요청합니다. 특정 엔드포인트가 감지하거나 수행할 수 있는 특정 이벤트 및 신호는 해당 엔드포인트에서 지원하는 이벤트 패키지 목록에 따라 결정됩니다. 각 패키지는 감지하거나 수행할 수 있는 이벤트 및 작업 목록을 지정합니다. 지정된 엔드포인트에서 지원하지 않는 패키지에 속하는 이벤트를 감지하거나 수행하도록 요청된 게이트웨이는 오류를 반환해야 합니다. 이벤트 이름이 패키지 이름으로 한정되지 않은 경우 엔드포인트의 기본 패키지 이름이 가정됩니다. 이 기본 패키지에 이벤트 이름이 등록되지 않은 경우 게이트웨이는 오류를 반환합니다.

통화 에이전트는 요청된 신호 목록이 비어 있는 알림 요청을 보낼 수 있습니다. 예를 들어 톤 생성을 중지해야 할 때 그렇게 합니다.

선택 사항인 QuarantineHandling 매개 변수는 "격리" 이벤트, 즉 이NotificationRequest 명령이 도착하기 전에 게이트웨이에서 감지했지만 아직 통화 에이전트에 알리지 않은 이벤트의 처리를 지정합니다. 매개변수는 일련의 처리 옵션을 제공합니다.

\* 격리된 이벤트를 처리할지 아니면 폐기할지 여부\(기본값은 이벤트를 처리하는 것입니다.\)

\* 게이트웨이가 최대 하나를 생성할 것으로 예상되는지 여부

- 이 요청에 대한 응답으로 알림\(단계별\) 또는 여러 알림\(루프\)\(기본값은 정확히 1개입니다.\)

매개변수가 없으면 기본값이 가정됩니다.

격리 처리 매개변수는 감지되었지만 명령이 수신될 때 아직 알림을 받지 못한 이벤트의 처리도 제어한다는 점에 유의해야 합니다.

DetectEvents는 격리 기간 동안 게이트웨이가 감지하도록 요청되는 이벤트 목록을 지정하는 선택적 매개변수입니다. 이 매개변수가 없으면 격리 기간에 감지되어야 하는 이벤트는 마지막으로 수신된 DetectEvents 목록에 나열된 이벤트입니다. 또한 게이트웨이는 "무시" 작업이 지정된 이벤트를 포함하여 요청 목록에 지정된 이벤트도 감지해야 합니다.

인라인 링백 또는 품질 경고와 같은 일부 이벤트 및 신호는 엔드포인트 자체가 아닌 엔드포인트에서 종료되는 연결에서 수행되거나 감지됩니다. 이벤트 이름의 구조를 통해 호출 에이전트는 이벤트를 수행하거나 감지해야 하는 연결을 지정할 수 있습니다.

이 명령은 동일한 엔드포인트에 적용되는 캡슐화된 EndpointConfiguration 명령을 전달할 수 있습니다. 이 명령이 있는 경우 EndpointConfiguration 명령의 매개변수는 복제되지 않는 EndpointId를 제외하고 NotificationRequest의 일반 매개변수 뒤에 삽입됩니다.

캡슐화된 EndpointConfiguration 명령은NotificationRequest 명령의 운명을 공유합니다. 알림 요청이 거부되면 EndpointConfiguration이 실행되지 않습니다.

ReturnCode는 게이트웨이에서 반환하는 매개변수입니다. 이는 명령의 결과를 나타내며 선택적으로 설명이 뒤따르는 정수로 구성됩니다. .NH 3 알림

알림은 Notify 명령을 통해 전송되며 관찰된 이벤트가 발생할 때 게이트웨이에 의해 전송됩니다.

```text
               ReturnCode
               <-- Notify( EndpointId,
                           [NotifiedEntity,]
                           RequestIdentifier,
                           ObservedEvents)
```

EndpointId는 섹션 2.1.1에 정의된 대로 알림 명령을 실행하는 게이트웨이의 엔드포인트 이름입니다. 식별자는 게이트웨이의 도메인 이름을 포함하여 정규화된 엔드포인트 식별자여야 합니다. 이름의 로컬 부분에는 와일드카드 규칙을 사용할 수 없습니다.

NotifiedEntity는 알림이 전송되는 엔터티를 식별하는 선택적 매개 변수입니다. 이 매개변수는 NotifiedEntity 매개변수의 마지막 수신 값과 동일합니다. 트리거 요청에 해당 매개변수가 없으면 매개변수가 없습니다. 통지는 "현재 통지된 엔터티"로 전송되며, 해당 엔터티가 지정되지 않은 경우 요청을 받은 주소로 전송됩니다.

RequestIdentifier는 이 알림을 트리거한 NotificationRequest의 RequestIdentifier 매개변수를 반복하는 매개변수입니다. 이 알림을 이를 트리거한 요청과 연관시키는 데 사용됩니다.

ObservedEvents는 게이트웨이가 감지한 이벤트 목록입니다. 단일 알림은 감지된 순서대로 보고될 이벤트 목록을 보고할 수 있습니다. 목록에는 알림 요청을 트리거하는 RequestedEvents 매개변수에서 요청된 이벤트의 식별 정보만 포함될 수 있습니다. 여기에는 누적된\(알려지지 않음\) 또는 숫자 지도에 따라 처리된\(그러나 아직 일치하지 않음\) 이벤트와 감지를 트리거했거나 숫자 지도에서 최종 일치를 제공한 최종 이벤트가 포함됩니다.

ReturnCode는 통화 에이전트가 반환하는 매개변수입니다. 이는 명령의 결과를 나타내며 선택적으로 설명이 뒤따르는 정수로 구성됩니다.

---
#### **2.3.3.  CreateConnection**

이 명령은 두 끝점 간의 연결을 만드는 데 사용됩니다.

```text
            ReturnCode,
            ConnectionId,
            [SpecificEndPointId,]
            [LocalConnectionDescriptor,]
            [SecondEndPointId,]
            [SecondConnectionId]
            <--- CreateConnection(CallId,
                                  EndpointId,
                                  [NotifiedEntity,]
                                  [LocalConnectionOptions,]
                                  Mode,
                                  [{RemoteConnectionDescriptor |
                                    SecondEndpointId}, ]
                                  [Encapsulated NotificationRequest,]
                                  [Encapsulated EndpointConfiguration])
```

연결은 끝점에 의해 정의됩니다. CreateConnection의 입력 매개변수는 게이트웨이의 연결 "보기"를 구축하는 데 필요한 데이터를 제공합니다.

CallId는 이 연결이 속한 통화\(또는 세션\)를 식별하는 전역적으로 고유한 매개변수입니다. 동일한 통화에 속한 연결은 동일한 통화 ID를 공유합니다. 통화 ID는 보고 및 회계 목적으로 통화를 식별하는 데 사용될 수 있습니다. 게이트웨이의 연결 처리에는 영향을 주지 않습니다.

EndpointId는 CreateConnection이 실행되는 게이트웨이의 연결 끝점에 대한 식별자입니다. EndpointId는 함수 호출에서 매개 변수 EndpointId에 값을 할당하여 완전히 지정하거나 "누구나" 와일드카드 규칙을 사용하여 과소 지정될 수 있습니다. 엔드포인트가 과소 지정되면 게이트웨이가 엔드포인트 식별자를 할당하고 해당 전체 값이 응답의 특정EndPointId 매개 변수에 반환됩니다.

NotifiedEntity는 Notify 또는 DeleteConnection 명령을 보내야 하는 위치를 지정하는 선택적 매개 변수입니다. 매개변수가 없는 경우 Notify 또는 DeleteConnection 명령은 마지막으로 수신된 알림 엔터티로 전송되어야 하며, 끝점에 대해 알림 엔터티가 수신되지 않은 경우 CreateConnection 명령의 작성자에게 전송되어야 합니다.

LocalConnectionOptions는 통화 에이전트가 게이트웨이의 연결 처리를 지시하는 데 사용하는 매개 변수입니다. LocalConnectionOptions에 포함된 필드는 다음과 같습니다.

```text
   *  Encoding Method,

   *  Packetization period,

   *  Bandwidth,
```

\*  서비스 유형,

\* 반향 제거 사용법,

\* 묵음 억제 또는 음성 활동 감지 사용,

```text
   *  Usage of signal level adaptation and noise level reduction, or
      "gain control."
```

\* 예약 서비스 이용,

\* RTP 보안의 활용,

\* 연결을 전달하는 데 사용되는 네트워크 유형.

이 필드 세트는 공급업체별 선택적 또는 필수 확장으로 완성될 수 있습니다. 처음 세 필드의 인코딩은 SDP 및 RTP 프로필과 호환됩니다.

\* 인코딩 방법은 RTP AV 프로필에 정의되거나 IANA에 등록된 대로 하나 이상의 유효한 인코딩 이름을 사용하여 지정되어야 합니다.

\* 패킷화 기간은 SDP의 "ptime" 매개변수에 지정된 대로 패킷의 미디어가 나타내는 시간 길이\(밀리초\)로 인코딩되거나 허용 가능한 최소 및 최대 패킷화 기간을 모두 지정하는 범위 값으로 인코딩됩니다.

\* 대역폭은 단일 값 또는 범위로 인코딩되며 초당 킬로비트의 정수로 표시됩니다.

처음 세 필드 각각에 대해 통화 상담원에는 세 가지 옵션이 있습니다.

\* 게이트웨이가 연결에 사용할 정확히 하나의 값을 명시할 수 있습니다.

\* 허용되는 인코딩 방법 목록이나 패킷화 기간 범위 등 느슨한 사양을 제공할 수 있습니다.

\* 단순히 대역폭 표시만 제공하고 인코딩 방법과 패킷화 기간은 게이트웨이에 맡길 수도 있습니다.

대역폭 사양은 인코딩 방법 및 패킷화 주기 사양과 모순되지 않아야 합니다. 인코딩 방법이 지정되면 지정된 것보다 더 큰 대역폭을 사용하게 되더라도 게이트웨이는 이를 사용할 권한이 부여됩니다.

데이터 호출의 경우 LocalConnectionOptions 매개변수가 없을 수 있습니다.

서비스 유형은 연결에 사용될 서비스 클래스를 지정합니다. 연결이 IP 네트워크를 통해 전송되는 경우 매개변수는 IP 헤더의 8비트 유형 서비스 값 매개변수를 인코딩합니다. 서비스 유형이 지정되지 않은 경우 게이트웨이는 기본값 또는 구성된 값을 사용해야 합니다.

예를 들어 RSVP를 사용하여 지정된 연결에서 예약을 수행하도록 게이트웨이에 지시할 수 있습니다. 예약이 필요할 때 통화 에이전트는 사용해야 하는 예약 프로필\("제어된 부하" 또는 "보장된 서비스"\)을 지정합니다. 그만큼

예약이 없다는 것은 이 매개변수의 기본값인 "최선의 노력" 서비스를 요청하여 나타낼 수 있습니다. 연결에 대한 예약이 요청되면 게이트웨이는 다음을 수행합니다.

```text
   *  start emitting RSVP "PATH" messages if the connection is in
      "send-only", "send-receive", "conference", "network loop back" or
      "network continuity test" mode (if a remote connection descriptor
      has been received,)
```

\* 연결이 "수신 전용", "보내기-수신", "회의", "네트워크 루프백" 또는 "네트워크 연속성 테스트" 모드인 경우 "PATH" 메시지를 수신하자마자 RSVP "RESV" 메시지 보내기 시작 .

RSVP 필터는 연결의 특성에서 추론됩니다. RSVP 리소스 프로필은 연결의 대역폭과 패킷화 기간에서 추론됩니다.

기본적으로 전화 통신 게이트웨이는 항상 에코 제거를 수행합니다. 그러나 일부 통화의 경우 이러한 작업을 꺼야 합니다. 반향 제거 매개변수는 "on"\(반향 제거가 요청된 경우\)과 "off"\(꺼진 경우\)의 두 가지 값을 가질 수 있습니다.

전화 게이트웨이는 신호 레벨을 조정하기 위해 이득 제어를 수행할 수 있습니다. 그러나 모뎀 호출 등의 경우에는 이 기능을 꺼야 합니다. 이득 제어 매개변수는 "자동"으로 지정되거나 명시적인 이득 데시벨 수로 지정될 수 있습니다. 기본값은 게인 제어를 수행하지 않는 것이며, 이는 0데시벨의 게인을 지정하는 것과 같습니다.

```text
   The telephony gateways may perform voice activity detection, and
   avoid sending packets during periods of silence.  However, it is
   necessary, for example for modem calls, to turn off this detection.
   The silence suppression parameter can have two values, "on" (when the
   detection is requested) and "off" (when it is turned off.) The
   default is "off."
```

통화 에이전트는 오디오 패킷의 암호화를 활성화하도록 게이트웨이에 요청할 수 있습니다. RFC 2327에 지정된 대로 키 사양을 제공하여 이를 수행합니다. 기본적으로 암호화는 사용되지 않습니다.

통화 에이전트는 지정된 유형의 네트워크에서 연결을 준비하도록 게이트웨이에 지시할 수 있습니다. 네트워크 유형은 SDP 표준의 "connection-field" 매개변수와 같이 인코딩됩니다. 가능한 값은 IN\(인터넷\), ATM 및 LOCAL입니다. 매개변수는 선택사항입니다. 없는 경우 게이트웨이 유형에 따라 네트워크가 결정됩니다.

RemoteConnectionDescriptor는 IP 네트워크의 반대편에 있는 연결의 원격 측에 대한 연결 설명자입니다. 여기에는 LocalConnectionDescriptor와 동일한 필드, 즉 SDP 표준에 따라 세션을 설명하는 필드가 포함됩니다. 원격 측에 대한 정보가 아직 알려지지 않은 경우 이 매개변수는 null 값을 가질 수 있습니다. 이는 연결을 구축하는 엔터티가 관련된 두 게이트웨이 중 하나에 CreateConnection을 전송하여 시작되기 때문에 발생합니다. 처음으로 발행된 CreateConnection의 경우 연결의 반대편에 대해 사용할 수 있는 정보가 없습니다. 이 정보는 나중에 ModifyConnection 호출을 통해 제공될 수 있습니다. 데이터 연결\(mode=data\)의 경우 이 매개변수는 데이터 연결의 특성을 설명합니다.

RemoteConnectionDescriptor 대신 SecondEndpointId를 사용하여 동일한 게이트웨이에 있는 두 엔드포인트 간의 연결을 설정할 수 있습니다. 연결은 정의상 로컬 연결입니다. SecondEndpointId는 함수 호출에서 SecondEndpointId 매개 변수에 값을 할당하여 완전히 지정하거나 "누구나" 와일드카드 규칙을 사용하여 과소 지정될 수 있습니다. 두 번째 엔드포인트가 과소 지정되면 두 번째 엔드포인트 식별자가 게이트웨이에 의해 할당되고 해당 전체 값이 응답의 SecondEndPointId 매개 변수에 반환됩니다.

모드는 연결의 이쪽에 대한 작동 모드를 나타냅니다. 모드는 "보내기", "받기", "보내기/받기", "회의", "데이터", "비활성", "루프백", "연속성 테스트", "네트워크 루프백" 또는 "네트워크 연속성 테스트"입니다. 이러한 모드의 예상 처리는 "게이트웨이 처리 기능" 섹션의 소개에 지정되어 있습니다. 일부 엔드포인트는 모든 모드를 지원하지 못할 수도 있습니다. 명령이 엔드포인트가 지원할 수 없는 모드를 지정하면 오류가 반환됩니다.

게이트웨이는 한 엔드포인트 내의 연결을 고유하게 식별하는 ConnectionId와 SDP에 정의된 주소 및 RTP 포트에 대한 정보가 포함된 세션 설명인 LocalConnectionDescriptor를 반환합니다. 데이터 연결의 경우 LocalConnectionDescriptor가 반환되지 않습니다. 특정EndPointId는 응답 엔드포인트를 식별하는 선택적 매개변수입니다. EndpointId 인수가 "다음 중 하나" 와일드카드 이름을 참조하는 경우 사용할 수 있습니다. 특정EndPointId가 반환되면 통화 에이전트는 이를 사용해야 합니다. EndpointId 값은 이 호출을 참조하는 연속 명령이기 때문입니다.

SecondEndpointId가 지정되면 이 명령은 실제로 ModifyConnection 및 DeleteConnection 명령을 통해 별도로 조작할 수 있는 두 개의 연결을 생성합니다. 생성에 대한 응답은 두 번째 연결을 식별하는 SecondConnectionId 매개 변수를 제공합니다.

RemoteConnectionDescriptor 매개변수가 포함되지 않은 "CreateConnection" 요청을 수신한 후 게이트웨이는 모호한 상황에 처하게 됩니다. LocalConnectionDescriptor 매개변수를 내보냈으므로 잠재적으로 패킷을 수신할 수 있습니다. 다른 게이트웨이의 RemoteConnectionDescriptor 매개변수를 아직 수신하지 않았기 때문에 수신한 패킷이 통화 에이전트에 의해 승인되었는지 여부를 알 수 없습니다. 따라서 중요한 공지를 잘라내거나 이상한 데이터를 듣는 등 두 가지 위험 사이를 탐색해야 합니다. 게이트웨이의 동작은 Mode 매개변수의 값에 따라 결정됩니다.

\* 모드가 ReceiverOnly로 설정된 경우 게이트웨이는 음성 신호를 수신하여 엔드포인트를 통해 전송해야 합니다.

\* 모드가 Inactive, Loopback, Continuity Test로 설정된 경우 게이트웨이는 음성 신호를 거부해야 합니다.

\* 모드가 네트워크 루프백 또는 네트워크 연속성 테스트로 설정된 경우 게이트웨이는 예상되는 에코 또는 응답을 수행해야 합니다.

이 상황에서는 SendReceive, Conference, Data 및 SendOnly 모드 값이 의미가 없습니다. 이는 오류로 처리되어야 하며 명령이 거부되어야 합니다\(오류 코드 517\).

명령에는 캡슐화된 알림 요청 명령이 선택적으로 포함될 수 있습니다. 이 경우 RequestIdentifier 매개변수는 물론 선택적으로 RequestedEvents DigitMap, SignalRequests, QuarantineHandling 및 DetectEvents 매개변수도 제공됩니다. 캡슐화된 알림 요청은 연결 생성과 동시에 실행됩니다. 예를 들어 통화 에이전트가 주거용 게이트웨이에 대한 통화를 시작하려는 경우 다음을 수행해야 합니다.

\* 전화가 끊기는 즉시 사용자가 말할 수 있도록 주거용 게이트웨이에 연결 준비를 요청합니다.

\* 주거용 게이트웨이에 벨이 울리도록 요청하고,

\* 전화가 오프훅 상태가 되면 주거용 게이트웨이에 통화 상담원에게 알리도록 요청하세요.

이는 오프 후크 이벤트에 대한 RequestedEvent 매개변수와 벨소리 신호에 대한 SignalRequest 매개변수도 전송하여 단일 CreateConnection 명령으로 수행할 수 있습니다.

이러한 매개변수가 있는 경우 생성 및 알림요청이 동기화되어야 합니다. 즉, 둘 다 수락하거나 둘 다 거부해야 함을 의미합니다. 이 예에서 게이트웨이에 충분한 리소스가 없거나 로컬 네트워크 액세스에서 적절한 리소스를 얻을 수 없는 경우 CreateConnection이 거부될 수 있으며, 사용자가 이미 오프훅. 이 예에서는 연결을 설정할 수 없는 경우 전화 벨이 울리지 않아야 하며, 사용자가 이미 오프훅 상태인 경우 연결이 설정되어서는 안 됩니다.

NotifiedEntity 매개변수가 있는 경우 CreateConnection 및 NotifiedRequest 명령 모두에 적용됩니다. 엔드포인트에 대한 새로운 "알림 엔터티"를 정의합니다.

이 명령은 동일한 엔드포인트에 적용되는 캡슐화된 EndpointConfiguration 명령을 전달할 수 있습니다. 이 명령이 있으면 EndpointConfiguration 명령의 매개변수는 복제되지 않는 EndpointId를 제외하고 CreateConnection의 일반 매개변수 뒤에 삽입됩니다. EndpointConfiguration 명령은 캡슐화된NotificationRequest 명령과 함께 캡슐화될 수 있습니다.

캡슐화된 EndpointConfiguration 명령은 CreateConnection 명령의 운명을 공유합니다. CreateConnection이 거부되면 EndpointConfiguration이 실행되지 않습니다.

ReturnCode는 게이트웨이에서 반환하는 매개변수입니다. 이는 명령의 결과를 나타내며 선택적으로 설명이 뒤따르는 정수로 구성됩니다.

---
#### **2.3.4.  ModifyConnection**

이 명령은 연결에 대한 게이트웨이의 "보기" 특성을 수정하는 데 사용됩니다. 호출의 이 "보기"에는 로컬 연결 설명자와 원격 연결 설명자가 모두 포함됩니다.

```text
      ReturnCode,
      [LocalConnectionDescriptor]
       <--- ModifyConnection(CallId,
                             EndpointId,
                             ConnectionId,
                             [NotifiedEntity,]
                             [LocalConnectionOptions,]
                             [Mode,]
                             [RemoteConnectionDescriptor,]
                             [Encapsulated NotificationRequest,]
                             [Encapsulated EndpointConfiguration])
```

사용되는 매개 변수는 CreateConnection 명령과 동일하며 끝점 내에서 연결을 식별하는 ConnectionId가 추가됩니다. 이 매개변수는 로컬 연결 설명자의 일부로 CreateConnection 함수에 의해 반환됩니다. 엔드포인트 컨텍스트 내에서 연결을 고유하게 식별합니다.

EndpointId는 정규화된 엔드포인트 식별자여야 합니다. 로컬 이름은 와일드카드 규칙을 사용하면 안 됩니다.

ModifyConnection 명령을 사용하면 다음과 같은 방법으로 연결 매개변수에 영향을 줄 수 있습니다.

\* RemoteConnectionDescriptor를 통해 연결의 반대쪽에 대한 정보를 제공합니다.

\* 모드 매개변수의 값을 변경하여 연결을 활성화하거나 비활성화합니다. 이는 임의의 매개변수 값을 사용하여 연결 중 언제든지 발생할 수 있습니다.

\* 연결의 전송 매개변수를 변경합니다. 예를 들어 다른 코딩 방식으로 전환하거나, 패킷화 기간을 변경하거나, 에코 제거 처리를 수정합니다.

RemoteConnectionDescriptor가 게이트웨이에 제공된 경우에만 연결을 활성화할 수 있습니다. 그러나 수신 전용 모드는 이 설명자를 제공하지 않고도 활성화될 수 있습니다.

이 명령은 RTP 포트와 같은 로컬 연결 매개변수가 수정된 경우에만 LocalConnectionDescriptor를 반환합니다. \(이 기능의 사용은 실제로 추가 연구를 위한 것입니다.\)

명령에는 캡슐화된 알림 요청 명령이 선택적으로 포함될 수 있습니다. 이 경우 RequestIdentifier 매개변수는 물론 선택적으로 RequestedEvents DigitMap, SignalRequests, QuarantineHandling 및 DetectEvents 매개변수도 제공됩니다. 그만큼

캡슐화된 알림 요청은 연결 수정과 동시에 실행됩니다. 예를 들어, 연결이 승인되면 호출 게이트웨이는 회로를 전송-수신 모드로 설정하고 벨소리 제공을 중지하도록 지시해야 합니다.

이는 온후크 이벤트에 대한 RequestedEvent 매개변수와 벨소리 제공을 중지하기 위한 빈 SignalRequest 매개변수도 전송하여 단일 ModifyConnection 명령으로 수행할 수 있습니다.

이러한 매개변수가 있는 경우 수정 사항과NotificationRequests가 동기화되어야 합니다. 즉, 둘 다 수락하거나 둘 다 거부해야 함을 의미합니다. NotifiedEntity 매개변수\(있는 경우\)는 ModifyConnection 및 NotificationRequest 명령 모두에 적용됩니다.

이 명령은 동일한 엔드포인트에 적용되는 캡슐화된 EndpointConfiguration 명령을 전달할 수 있습니다. 이 명령이 있는 경우 EndpointConfiguration 명령의 매개변수는 복제되지 않는 EndpointId를 제외하고 ModifyConnection의 일반 매개변수 뒤에 삽입됩니다. EndpointConfiguration 명령은 캡슐화된NotificationRequest 명령과 함께 캡슐화될 수 있습니다.

캡슐화된 EndpointConfiguration 명령은 ModifyConnection 명령의 운명을 공유합니다. ModifyConnection이 거부되면 EndpointConfiguration이 실행되지 않습니다.

ReturnCode는 게이트웨이에서 반환하는 매개변수입니다. 이는 명령의 결과를 나타내며 선택적으로 설명이 뒤따르는 정수로 구성됩니다.

---
#### **2.3.5.  DeleteConnection (from the Call Agent)**

이 명령은 연결을 종료하는 데 사용됩니다. 부작용으로 연결 실행에 대한 통계를 수집합니다.

```text
        ReturnCode,
        Connection-parameters
        <-- DeleteConnection(CallId,
                             EndpointId,
                             ConnectionId,
                             [Encapsulated NotificationRequest,]
                             [Encapsulated EndpointConfiguration])
```

이 DeleteConnection 명령 형식의 엔드포인트 식별자는 정규화되어야 합니다. 와일드카드 규칙은 사용하면 안 됩니다.

연결에 두 개의 끝이 있는 일반적인 경우 이 명령은 연결에 관련된 두 게이트웨이 모두에 전송되어야 합니다. 그러나 일부 연결에서는 IP 멀티캐스트를 사용할 수 있습니다. 이 경우 개별적으로 삭제할 수 있습니다.

연결이 삭제된 후에는 해당 연결에 대해 요청된 모든 루프백을 취소해야 합니다. 엔드포인트에 대한 모든 연결이 삭제되면 해당 엔드포인트를 비활성 모드로 전환해야 합니다.

DeleteConnection 명령에 대한 응답으로 게이트웨이는 연결 상태를 설명하는 매개변수 목록을 반환합니다. 이러한 매개변수는 다음과 같습니다.

전송된 패킷 수:

이 연결에서 전송을 시작한 이후 보낸 사람이 전송한 총 RTP 데이터 패킷 수입니다. 예를 들어 수정 명령의 결과로 보낸 사람이 동기화 소스 식별자\(RTP에 정의된 SSRC\)를 변경하는 경우 카운트는 재설정되지 않습니다. 연결이 "수신 전용" 모드로 설정된 경우 값은 0입니다.

전송된 옥텟 수:

이 연결에서 전송을 시작한 이후 발신자가 RTP 데이터 패킷으로 전송한 페이로드 옥텟\(즉, 헤더 또는 패딩을 포함하지 않음\)의 총 수입니다. 예를 들어 ModifyConnection 명령의 결과로 발신자가 SSRC 식별자를 변경하는 경우 카운트가 재설정되지 않습니다. 연결이 "수신 전용" 모드로 설정된 경우 값은 0입니다.

수신된 패킷 수:

이 연결에서 수신을 시작한 이후 발신자가 수신한 총 RTP 데이터 패킷 수입니다. 보낸 사람이 여러 값을 사용한 경우 이 개수에는 다른 SSRC에서 수신한 패킷이 포함됩니다. 연결이 "전송 전용" 모드로 설정된 경우 값은 0입니다.

수신된 옥텟 수:

이 연결에서 전송을 시작한 이후 발신자가 RTP 데이터 패킷으로 전송한 페이로드 옥텟\(즉, 헤더 또는 패딩을 포함하지 않음\)의 총 수입니다. 보낸 사람이 여러 값을 사용한 경우 이 개수에는 다른 SSRC에서 수신한 패킷이 포함됩니다. 연결이 "전송 전용" 모드로 설정된 경우 값은 0입니다.

손실된 패킷 수:

수신 시작 이후 손실된 RTP 데이터 패킷의 총 개수입니다. 이 숫자는 예상되는 패킷 수에서 실제로 수신된 패킷 수를 뺀 값으로 정의됩니다. 여기서 수신된 패킷 수에는 지연되었거나 중복된 패킷이 포함됩니다. 보낸 사람이 여러 값을 사용한 경우 이 개수에는 다른 SSRC에서 수신한 패킷이 포함됩니다. 따라서 늦게 도착하는 패킷은 손실된 것으로 간주되지 않으며 중복된 패킷이 있는 경우 손실이 음수가 될 수 있습니다. 보낸 사람이 여러 값을 사용한 경우 이 개수에는 다른 SSRC에서 수신한 패킷이 포함됩니다. 예상되는 패킷 수는 다음에 정의된 것처럼 수신된 확장된 마지막 시퀀스 번호에서 수신된 초기 시퀀스 번호를 뺀 값으로 정의됩니다. 보낸 사람이 여러 값을 사용한 경우 이 개수에는 다른 SSRC에서 수신한 패킷이 포함됩니다. 연결이 "전송 전용" 모드로 설정된 경우 값은 0입니다. 연결이 "데이터" 모드로 설정된 경우 이 매개변수는 생략됩니다.

```text
   Interarrival jitter:
```

밀리초 단위로 측정되고 부호 없는 정수로 표시되는 RTP 데이터 패킷 도착 간격 시간의 통계적 차이에 대한 추정치입니다. 도착간 지터 J는 한 쌍의 패킷에 대해 송신자와 비교하여 수신자에서의 패킷 간격 차이 D의 평균 편차\(평활화된 절대값\)로 정의됩니다. 자세한 계산 알고리즘은 RFC 1889에 나와 있습니다. 보낸 사람이 여러 값을 사용한 경우 개수에는 다른 SSRC에서 수신한 패킷이 포함됩니다. 연결이 "전송 전용" 모드로 설정된 경우 값은 0입니다. 연결이 "데이터" 모드로 설정된 경우 이 매개변수는 생략됩니다.

```text
   Average transmission delay:
```

밀리초 단위로 표시되는 네트워크 대기 시간의 추정치입니다. 이는 RTCP 메시지의 발신자가 나타내는 NTP 타임스탬프와 수신자의 NTP 타임스탬프 간의 차이를 이 메시지가 수신될 때 측정된 평균값입니다. 평균은 모든 추정치를 합산한 다음 수신된 RTCP 메시지 수로 나누어 구합니다. 연결이 "데이터" 모드로 설정된 경우 이 매개변수는 생략됩니다. 게이트웨이의 시계가 NTP에 의해 동기화되지 않은 경우 대기 시간 값은 RTCP를 통해 측정된 왕복 지연의 절반으로 계산될 수 있습니다. 게이트웨이가 단방향 지연이나 왕복 지연을 계산할 수 없는 경우 매개변수는 null 값을 전달합니다.

이러한 변수에 대한 자세한 정의는 RFC 1889를 참조하세요.

ATM 네트워크를 통해 연결이 설정된 경우 이러한 매개변수의 의미가 변경될 수 있습니다.

전송된 패킷 수: 이 연결에서 전송을 시작한 이후 전송된 총 ATM 셀 수입니다.

전송된 옥텟 수:

- ATM 셀에서 전송된 페이로드 옥텟의 총 개수입니다.

수신된 패킷 수:

- 이 연결에서 수신을 시작한 이후 수신된 ATM 셀의 총 수입니다.

수신된 옥텟 수:

- ATM 셀에서 수신된 페이로드 옥텟의 총 개수입니다.

손실된 패킷 수:

- 손실된 셀 수로 결정되어야 하며, 적응 계층이 게이트웨이에서 손실을 평가할 수 없는 경우 0으로 설정되어야 합니다.

도착간 지터:

- ATM 셀 간의 도착간 지터로 이해해야 합니다.

평균 전송 지연:

- 게이트웨이는 ATM 네트워크를 통해 이 매개변수를 평가하지 못할 수도 있습니다. 단순히 null 값을 보고할 수도 있습니다.

LOCAL 상호 연결을 통해 연결이 설정된 경우 이러한 매개변수의 의미는 다음과 같이 정의됩니다.

전송된 패킷 수: 중요하지 않습니다.

전송된 옥텟 수: 로컬 연결을 통해 전송된 페이로드 옥텟의 총 수입니다.

수신된 패킷 수: 중요하지 않습니다.

수신된 옥텟 수: 연결을 통해 수신된 페이로드 옥텟의 총 수입니다.

손실된 패킷 수: 중요하지 않습니다. 0 값이 가정됩니다.

도착간 지터: 중요하지 않습니다. 0 값이 가정됩니다.

평균 전송 지연: 중요하지 않습니다. 0 값이 가정됩니다.

연결 매개변수의 표준 세트는 확장 매개변수를 생성하여 확장할 수 있습니다.

명령에는 캡슐화된 알림 요청 명령이 선택적으로 포함될 수 있습니다. 이 경우 RequestIdentifier 매개변수는 물론 선택적으로 RequestedEvents DigitMap, SignalRequests, QuarantineHandling 및 DetectEvents 매개변수도 제공됩니다. 캡슐화된 알림 요청은 연결 삭제와 동시에 실행됩니다. 예를 들어, 사용자 중단이 통보되면 게이트웨이는 연결을 삭제하고 오프 후크 이벤트 검색을 시작하도록 지시해야 합니다.

이는 오프후크 이벤트에 대한 RequestedEvent 매개변수와 빈 SignalRequest 매개변수도 전송하여 단일 DeleteConnection 명령으로 수행할 수 있습니다.

이러한 매개 변수가 있으면 DeleteConnection 및 NotificationRequests가 동기화되어야 합니다. 즉, 둘 다 수락하거나 둘 다 거부해야 합니다.

이 명령은 동일한 엔드포인트에 적용되는 캡슐화된 EndpointConfiguration 명령을 전달할 수 있습니다. 이 명령이 있는 경우 EndpointConfiguration 명령의 매개변수는 복제되지 않는 EndpointId를 제외하고 DeleteConnection의 일반 매개변수 뒤에 삽입됩니다. EndpointConfiguration 명령은 캡슐화된NotificationRequest 명령과 함께 캡슐화될 수 있습니다.

캡슐화된 EndpointConfiguration 명령은 DeleteConnection 명령의 운명을 공유합니다. DeleteConnection이 거부되면 EndpointConfiguration이 실행되지 않습니다.

ReturnCode는 게이트웨이에서 반환하는 매개변수입니다. 이는 명령의 결과를 나타내며 선택적으로 설명이 뒤따르는 정수로 구성됩니다.

---
#### **2.3.6.  DeleteConnection (from the VoIP gateway)**

어떤 상황에서는 게이트웨이가 연결을 끊어야 할 수도 있습니다. 예를 들어 연결과 관련된 리소스가 손실되었거나 엔드포인트가 더 이상 음성을 보내거나 받을 수 없다는 것을 감지했기 때문입니다. 게이트웨이는 DeleteConnection 명령의 변형을 사용하여 연결을 종료합니다.

```text
            ReturnCode,
            <-- DeleteConnection( CallId,
                                  EndpointId,
                                  ConnectionId,
                                  Reason-code,
                                  Connection-parameters)
```

통화, 엔드포인트 및 연결 식별자 외에도 게이트웨이는 DeleteConnection 명령에 대한 응답으로 통화 에이전트에 반환되었을 통화 매개변수도 보냅니다. 이유 코드는 연결 끊김의 원인을 나타냅니다.

ReturnCode는 통화 에이전트가 반환하는 매개변수입니다. 이는 명령의 결과를 나타내며 선택적으로 설명이 뒤따르는 정수로 구성됩니다.

---
#### **2.3.7.  DeleteConnection (multiple connections, from the Call Agent)**

호출 에이전트는 여러 연결을 동시에 삭제하기 위해 변형된 DeleteConnection 함수를 사용할 수 있습니다. 이 명령은 엔드포인트 호출과 관련된 모든 연결을 삭제하는 데 사용할 수 있습니다.

```text
            ReturnCode,
            <-- DeleteConnection( CallId,
                                  EndpointId)
```

특정 끝점에서 종료되는 모든 연결을 삭제하는 데에도 사용할 수 있습니다.

```text
            ReturnCode,
            <-- DeleteConnection( EndpointId)

   Finally, Call Agents can take advantage of the hierarchical naming
   structure of endoints to delete all the connections that belong to a
   group of endpoints.  In this case, the "local name" component of the
   EndpointID will be specified using the "all value" wildcarding
   convention. The "any value" convention shall not be used.  For
   example, if endpoints names are structured as the combination of a
   physical interface name and a circuit number, as in "X35V3+A4/13",
```

통화 에이전트는 "X35V3+A4/\*"와 같이 회선 번호를 와일드카드 문자 "\*"로 대체할 수 있습니다. 이 "와일드카드" 명령은 물리적 인터페이스 "X35V3+A4"에 연결된 회로에 연결된 모든 연결을 삭제하도록 게이트웨이에 지시합니다.

연결이 삭제된 후 엔드포인트는 비활성 모드로 전환되어야 합니다. 연결에 대해 요청된 모든 루프백을 취소해야 합니다.

이 명령은 개별 통계나 호출 매개변수를 반환하지 않습니다.

ReturnCode는 게이트웨이에서 반환하는 매개변수입니다. 이는 명령의 결과를 나타내며 선택적으로 설명이 뒤따르는 정수로 구성됩니다.

---
#### **2.3.8.  Audit Endpoint**

AuditEndPoint 명령은 호출 에이전트에서 특정 엔드포인트의 상태를 확인하는 데 사용할 수 있습니다.

```text
              ReturnCode,
                EndPointIdList|{
                [RequestedEvents,]
                [DigitMap,]
                [SignalRequests,]
                [RequestIdentifier,]
                [NotifiedEntity,]
                [ConnectionIdentifiers,]
                [DetectEvents,]
                [ObservedEvents,]
                [EventStates,]
                [BearerInformation,]
                [RestartReason,]
                [RestartDelay,]
                [ReasonCode,]
                [Capabilities]}
                        <--- AuditEndPoint(EndpointId,
                                                 [RequestedInfo])
```

EndpointId는 감사 중인 엔드포인트를 식별합니다. "모두" 와일드카드 규칙을 사용하여 끝점 그룹에 대한 감사를 시작할 수 있습니다. 이 규칙을 사용하는 경우 게이트웨이는 EndPointIdList 매개 변수의 와일드카드와 일치하는 엔드포인트 식별자 목록을 반환해야 합니다. 이러한 엔드포인트 중 하나와 관련된 매개변수는 반환하지 않습니다.

와일드카드가 아닌 EndpointId가 지정되면 \(비어 있을 수도 있음\) RequestedInfo 매개변수는 지정된 EndpointId에 대해 요청되는 정보를 설명합니다. 이 명령을 사용하면 다음 엔드포인트 정보를 감사할 수 있습니다.

RequestedEvents, DigitMap, SignalRequests, RequestIdentifier, NotifiedEntity, ConnectionIdentifiers, DetectEvents, ObservedEvents, EventStates, RestartReason, RestartDelay, ReasonCode 및 기능.

응답에는 감사 정보가 요청된 각 항목에 대한 정보가 포함됩니다.

\* RequestedEvents: 각 이벤트와 관련된 작업을 포함하여 엔드포인트가 사용하고 있는 RequestedEvents의 현재 값입니다. 지속적인 이벤트가 목록에 포함됩니다.

\* DigitMap: 엔드포인트가 현재 사용 중인 숫자 맵입니다.

\* SignalRequests: 다음의 목록입니다. 현재 활성화된 타임아웃 신호, 엔드포인트에 대해 현재 "켜져 있는" 켜짐/꺼짐 신호\(매개변수 유무와 상관없이\), 보류 중인 간략 신호. 타임아웃된 신호와 현재 재생 중인 짧은 신호는 포함되지 않습니다.

\* RequestIdentifier, 이 끝점에서 수신한 마지막 알림 요청에 대한 RequestIdentifier\(연결 처리 프리미티브에 캡슐화된 알림 요청 포함\). 알림 요청이 수신되지 않은 경우 0 값이 반환됩니다.

\* QuarantineHandling, 마지막에 대한 QuarantineHandling

- 이 끝점에서 알림 요청을 받았습니다.

\* DetectEvents는 현재 검역 모드에서 감지된 이벤트 목록입니다.

\* NotifiedEntity, 엔드포인트에 대해 현재 통지된 엔터티입니다.

\* ConnectionIdentifiers, 지정된 끝점에 대해 현재 존재하는 모든 연결에 대한 ConnectionIdentifiers 목록입니다.

\* ObservedEvents: 엔드포인트에 대해 관찰된 이벤트의 현재 목록입니다.

\* EventStates: 감사 가능한 상태가 연결된 이벤트의 경우 엔드포인트의 상태에 해당하는 이벤트입니다\(예: 엔드포인트가 오프후크인 ​​경우 오프후크\). 개별 이벤트의 정의에는 해당 이벤트에 감사 가능한 상태가 연결되어 있는지 명시되어 있습니다.

\* BearerInformation: 마지막으로 수신된 값

- 이 엔드포인트에 대한 BearerInformation 매개변수입니다.

\* RestartReason: 엔드포인트에서 실행한 마지막 RestartInProgress 명령의 다시 시작 이유 매개변수 값입니다. "restart"는 완전히 작동하는 엔드포인트를 나타냅니다.

\* RestartDelay: 응답 시 엔드포인트에서 RestartInProgress 명령을 실행한 경우 재시작 지연 매개변수의 값이고, 명령에 이 매개변수가 포함되지 않은 경우 0입니다.

\* ReasonCode: 엔드포인트에 대해 게이트웨이가 실행한 마지막 RestartInProgress 또는 DeleteConnection 명령의 Reason-Code 매개변수 값 또는 엔드포인트의 상태가 명목인 경우 특수 값 000입니다.

\* 엔드포인트의 기능은 다음과 유사합니다.

- LocalConnectionOptions 매개변수 및 이벤트 패키지 및 연결 모드를 포함합니다. 침묵 억제와 같은 일부 매개변수가 일부 매개변수와만 호환되도록 지정해야 하는 경우

\* 코덱을 사용하면 게이트웨이는 여러 기능 세트를 반환합니다.

- 압축 알고리즘: 지원되는 코덱 목록입니다. 나머지 매개변수는 이 목록에 지정된 모든 코덱에 적용됩니다.

패킷화 기간: 단일 값 또는 범위가 포함될 수 있습니다.

- 지정됨.

- 대역폭: 단일 값 또는 패킷화 기간 범위에 해당하는 범위가 지정될 수 있습니다\(무음 억제가 없다고 가정\).

- 반향 제거: 반향 제거 지원 여부.

- 무음 억제: 무음 억제를 지원하는지 여부입니다.

- 서비스 유형: 서비스 유형이 지원되는지 여부입니다.

- 이벤트 패키지: 지원되는 이벤트 패키지 목록입니다. 목록의 첫 번째 이벤트 패키지가 기본 패키지가 됩니다.

- 모드: 지원되는 연결 모드 목록입니다.

그런 다음 통화 에이전트는 AuditConnection 명령을 사용하여 연결에 대한 추가 정보를 얻기로 결정할 수 있습니다.

요청된 정보가 없고 EndpointId가 유효한 엔드포인트를 참조하는 경우 게이트웨이는 단순히 긍정적인 승인을 반환합니다.

마지막 알림 요청에 NotifiedEntity가 지정되지 않은 경우 알림 엔터티는 이 연결에 대해 수신된 마지막 알림 요청 명령의 소스 주소로 기본 설정됩니다.

ReturnCode는 게이트웨이에서 반환하는 매개변수입니다. 이는 명령의 결과를 나타내며 선택적으로 설명이 뒤따르는 정수로 구성됩니다.

---
#### **2.3.9.  Audit Connection**

호출 에이전트는 AuditConnection 명령을 사용하여 연결에 연결된 매개변수를 검색할 수 있습니다.

```text
              ReturnCode,
              [CallId,]
              [NotifiedEntity,]
              [LocalConnectionOptions,]
              [Mode,]
              [RemoteConnectionDescriptor,]
              [LocalConnectionDescriptor,]
              [ConnectionParameters]
                        <--- AuditConnection(EndpointId,
                                         ConnectionId,
                                         RequestedInfo)
```

EndpointId 매개변수는 연결을 처리하는 엔드포인트를 지정합니다. 와일드카드 규칙은 사용되지 않습니다.

ConnectionId 매개 변수는 지정된 끝점의 컨텍스트 내에서 감사된 연결의 식별자입니다.

\(비어 있을 수도 있음\) RequestedInfo는 지정된 EndpointId 내의 ConnectionId에 대해 요청된 정보를 설명합니다. 이 명령을 사용하면 다음 연결 정보를 감사할 수 있습니다.

```text
      CallId, NotifiedEntity, LocalConnectionOptions, Mode,
      RemoteConnectionDescriptor, LocalConnectionDescriptor,
      ConnectionParameters
```

AuditConnectionResponse에는 다음과 같은 감사 정보가 요청된 각 항목에 대한 정보가 포함됩니다.

\* CallId, 연결이 속한 통화에 대한 CallId입니다.

\* NotifiedEntity, 연결에 대해 현재 통지된 엔터티입니다.

\* LocalConnectionOptions, 연결을 위해 제공된 LocalConnectionOptions입니다.

\* 모드, 현재 연결 모드입니다.

\* RemoteConnectionDescriptor, 연결을 위해 게이트웨이에 제공된 RemoteConnectionDescriptor입니다.

\* LocalConnectionDescriptor, 연결을 위해 제공된 게이트웨이인 LocalConnectionDescriptor.

\* ConnectionParameters, 연결의 현재 값

- 연결 매개변수.

요청된 정보가 없고 EndpointId가 유효한 경우 게이트웨이는 단순히 연결이 존재하는지 확인하고, 그렇다면 긍정적인 승인을 반환합니다.

연결에 대해 NotifiedEntity가 지정되지 않은 경우 알림 엔터티는 이 연결에 대해 수신된 마지막 연결 처리 명령의 소스 주소로 기본 설정됩니다.

ReturnCode는 게이트웨이에서 반환하는 매개변수입니다. 이는 명령의 결과를 나타내며 선택적으로 설명이 뒤따르는 정수로 구성됩니다.

---
#### **2.3.10.  Restart in progress**

RestartInProgress 명령은 엔드포인트 또는 엔드포인트 그룹이 서비스를 시작하거나 중단했음을 알리기 위해 게이트웨이에서 사용됩니다.

```text
          ReturnCode,
          [NotifiedEntity]
                <------- RestartInProgress ( EndPointId,
                                             RestartMethod,
                                             [RestartDelay,]
                                             [Reason-code])
```

EndPointId는 서비스가 시작되거나 중단되는 엔드포인트를 식별합니다. "모두" 와일드카드 규칙을 사용하여 엔드포인트 그룹\(예: 지정된 인터페이스에 연결된 모든 엔드포인트 또는 지정된 게이트웨이에 연결된 모든 엔드포인트\)에 명령을 적용할 수 있습니다. "다음 중 하나" 와일드카드 규칙은 사용되지 않습니다.

RestartMethod 매개변수는 다시 시작 유형을 지정했습니다. 세 가지 값이 정의되었습니다.

\* "정상적인" 다시 시작 방법은 지정된 지연 후에 지정된 엔드포인트의 서비스가 중단됨을 나타냅니다. 설정된 연결은 아직 영향을 받지 않지만 통화 에이전트는 새 연결 설정을 자제하고 기존 연결을 정상적으로 해제해야 합니다.

\* "강제" 다시 시작 방법은 지정된 엔드포인트의 서비스가 갑자기 중단됨을 나타냅니다. 설정된 연결이 있는 경우 손실됩니다.

\* "다시 시작" 방법은 지정된 "다시 시작 지연" 후에 엔드포인트에서 서비스가 복원됨을 나타냅니다. 현재 끝점에 설정된 연결이 없습니다.

\* "연결 끊김" 방법은 엔드포인트의 연결이 끊어졌고 이제 연결을 설정하려고 시도하고 있음을 나타냅니다. "다시 시작 지연"은 엔드포인트의 연결이 끊어진 시간\(초\)을 지정합니다. 설정된 연결은 영향을 받지 않습니다.

\* "cancel-graceful" 방법은 게이트웨이가 이전에 실행된 "graceful" 재시작 명령을 취소하고 있음을 나타냅니다.

선택적 "재시작 지연" 매개변수는 초 단위로 표시됩니다. 숫자가 없으면 지연 값은 null로 간주됩니다. "graceful" 방법의 경우 null 지연은 호출 에이전트가 새 연결을 설정하지 않고 기존 연결이 자연스럽게 종료될 때까지 기다려야 함을 나타냅니다. "forced" 방법의 경우 재시작 지연은 항상 null로 간주됩니다.

"restart" 메소드에 대한 재시작 지연이 null이면 서비스가 이미 복원되었음을 나타냅니다. 이는 일반적으로 게이트웨이 시작/재부팅 후에 발생합니다.

선택적 이유 코드 매개변수는 다시 시작의 원인입니다.

게이트웨이는 서비스가 중단될 때\(예: 종료되거나 네트워크 관리 시스템에 의해 서비스가 중단되는 경우\) 통화 에이전트에 대한 호의로 "정상적" 또는 "강제" RestartInProgress 메시지를 보내야 합니다. 항상 그런 메시지를 받는 것에 의존하세요. 게이트웨이는 섹션 4.3.4에 지정된 다시 시작 절차에 따라 서비스가 다시 시작될 때 호출 에이전트에 null 지연이 포함된 "다시 시작" RestartInProgress 메시지를 보내야 합니다. 호출 에이전트는 이 메시지 수신에 의존할 수 있습니다. 또한 게이트웨이는 섹션 4.3.5에 지정된 "연결 끊김" 절차에 따라 현재 "통지된 엔터티"에 "연결 끊김" RestartInProgress 메시지를 보내야 합니다. "재시작 지연" 매개변수는 "강제" 재시작 방법과 함께 사용되어서는 안 됩니다.\(SHOULD, MUST, MUST, MUST NOT\)

RestartInProgress 메시지는 문제의 EndpointId에 대해 현재 알림을 받은 엔터티로 전송됩니다. 기본 통화 에이전트, 즉 알림 엔터티가 각 엔드포인트에 대해 프로비저닝되었으므로 재부팅 후 기본 통화 에이전트가 각 엔드포인트에 대한 알림 엔터티가 될 것으로 예상됩니다. 게이트웨이는 와일드카드를 최대한 활용하여 게이트웨이의 여러 엔드포인트가 다시 시작되고 해당 엔드포인트가 동일한 통화 에이전트에 의해 관리될 때 생성되는 RestartInProgress 메시지 수를 최소화해야 합니다.

ReturnCode는 게이트웨이에서 반환하는 매개변수입니다. 이는 명령의 결과를 나타내며 선택적으로 설명이 뒤따르는 정수로 구성됩니다.

NotifiedEntity는 통화 에이전트의 응답과 함께 추가로 반환될 수 있습니다.

\* 응답에 성공\(반환 코드 200 - 트랜잭션 실행\)이 표시되면 다시 시작 절차가 완료된 것이며 반환된 NotifiedEntity는 엔드포인트에 대한 새로운 "알림 엔터티"입니다.

\* 통화 에이전트의 응답에 오류가 표시된 경우 재시작 절차가 아직 완료되지 않았으므로 다시 시작해야 합니다. NotifiedEntity 매개변수가 반환된 경우 엔드포인트에 대한 새로운 "알림 엔터티"를 지정합니다. 이는 결과적으로 다시 시작 절차를 재시도할 때 사용해야 합니다.

---
### **2.4.  Return codes and error codes.**

모든 MGCP 명령이 승인됩니다. 승인에는 명령 상태를 나타내는 반환 코드가 포함됩니다. 반환 코드는 정수이며, 이에 대해 네 가지 값 범위가 정의되었습니다.

\* 100에서 199 사이의 값은 잠정적 반응을 나타냅니다.

\* 200에서 299 사이의 값은 성공적인 완료를 나타냅니다.

\* 400에서 499 사이의 값은 일시적인 오류를 나타냅니다.

\* 500에서 599 사이의 값은 영구적인 오류를 나타냅니다.

이미 정의된 값은 다음 목록에 나열됩니다.

100 현재 트랜잭션이 실행 중입니다. 실제

- 완료 메시지는 추후에 이어집니다.

200 요청한 트랜잭션이 정상적으로 실행되었습니다.

250 연결이 삭제되었습니다.

400 일시적인 오류로 인해 트랜잭션을 실행할 수 없습니다.

401 전화가 이미 끊어졌습니다.

402 전화가 이미 연결되어 있습니다.

403 현재 엔드포인트에 충분한 리소스가 없기 때문에 트랜잭션을 실행할 수 없습니다.

404 현재 대역폭이 부족합니다.

500 엔드포인트를 알 수 없기 때문에 트랜잭션을 실행할 수 없습니다.

01 엔드포인트가 준비되지 않아 트랜잭션을 실행할 수 없습니다.

502 엔드포인트에 리소스가 부족하여 트랜잭션을 실행할 수 없습니다.

510 프로토콜 오류가 감지되어 트랜잭션을 실행할 수 없습니다.

11 명령에 인식할 수 없는 확장자가 포함되어 있어 트랜잭션을 실행할 수 없습니다.

512 요청된 이벤트 중 하나를 감지할 수 있는 장치가 게이트웨이에 없기 때문에 트랜잭션을 실행할 수 없습니다.

513 요청된 신호 중 하나를 생성할 수 있는 장비가 게이트웨이에 없기 때문에 트랜잭션을 실행할 수 없습니다.

514 게이트웨이가 지정된 알림을 보낼 수 없기 때문에 트랜잭션을 실행할 수 없습니다.

```text
   515  The transaction refers to an incorrect connection-id (may have
        been already deleted)
```

516 트랜잭션이 알 수 없는 호출 ID를 참조하고 있습니다.

517 지원되지 않거나 잘못된 모드입니다.

518 지원되지 않거나 알 수 없는 패키지입니다.

519 끝점에 숫자 맵이 없습니다.

520 엔드포인트가 "다시 시작" 중이므로 트랜잭션을 실행할 수 없습니다.

521 엔드포인트가 다른 통화 에이전트로 리디렉션되었습니다.

522 해당 이벤트나 신호가 없습니다.

523 알 수 없는 동작 또는 불법적인 동작의 조합

524 LocalConnectionOptions의 내부 불일치

525 LocalConnectionOptions의 알 수 없는 확장

```text
   526  Insufficient bandwidth

   527  Missing RemoteConnectionDescriptor

   528  Incompatible protocol version

   529  Internal hardware failure

   530  CAS signaling protocol error.
```

531 트렁크 그룹화 오류\(예: 시설 오류\)

---
### **2.5.  Reason Codes**

이유 코드는 연결을 삭제할 때 게이트웨이에서 연결 삭제 이유를 통화 에이전트에 알리는 데 사용됩니다. RestartInProgress 명령에서 다시 시작 이유를 게이트웨이에 알리는 데 사용될 수도 있습니다. 이유 코드는 정수이며 다음 값이 정의되었습니다.

000 끝점 상태가 명목상입니다. \(이 코드는 감사 요청에 대한 응답으로만 사용됩니다.\)

```text
   900  Endpoint malfunctioning
```

901 서비스가 중단된 엔드포인트

```text
   902  Loss of lower layer connectivity (e.g., downstream sync)
```

---
## **3.  Media Gateway Control Protocol**

MGCP는 미디어 게이트웨이 제어 인터페이스를 일련의 트랜잭션으로 구현합니다. 트랜잭션은 명령과 필수 응답으로 구성됩니다. 명령에는 8가지 유형이 있습니다.

```text
   *  CreateConnection

   *  ModifyConnection

   *  DeleteConnection

   *  NotificationRequest

   *  Notify

   *  AuditEndpoint

   *  AuditConnection

   *  RestartInProgress
```

처음 네 개의 명령은 통화 에이전트에 의해 게이트웨이로 전송됩니다. 알림 명령은 게이트웨이를 통해 통화 에이전트로 전송됩니다. 게이트웨이는 2.3.6에 정의된 대로 DeleteConnection을 보낼 수도 있습니다. 통화 에이전트는 감사 명령 중 하나를 게이트웨이로 보낼 수 있습니다. 게이트웨이는 RestartInProgress 명령을 통화 에이전트에 보낼 수 있습니다.

---
### **3.1.  General description**

모든 명령은 명령 헤더와 선택적으로 세션 설명으로 구성됩니다.

모든 응답은 응답 헤더와 선택적으로 세션 설명으로 구성됩니다.

헤더 및 세션 설명은 캐리지 리턴 및 줄 바꿈 문자\(또는 선택적으로 단일 줄 바꿈 문자\)로 구분된 일련의 텍스트 줄로 인코딩됩니다. 헤더는 빈 줄로 세션 설명과 구분됩니다.

MGCP는 트랜잭션 식별자를 사용하여 명령과 응답을 연관시킵니다. 트랜잭션 식별자는 명령 헤더의 구성 요소로 인코딩되고 응답 헤더의 구성 요소로 반복됩니다\(섹션 3.2.1, 3.2.1.2 및 3.3 참조\).

---
### **3.2.  Command Header**

명령 헤더는 다음으로 구성됩니다.

\* 요청된 작업 또는 동사, 트랜잭션 식별자, 작업이 요청된 엔드포인트 및 MGCP 프로토콜 버전을 식별하는 명령줄,

\* 매개변수 이름과 매개변수 값으로 구성된 매개변수 라인 세트입니다.

다른 참조 표준에서 달리 명시하거나 지시하지 않는 한 명령 헤더의 각 구성 요소는 대소문자를 구분하지 않습니다. 이는 동사는 물론 매개변수와 값에도 적용되며, 모든 비교에서는 대문자와 소문자뿐 아니라 이들의 조합도 동일한 것으로 취급해야 합니다.\(MUST\)

---
#### **3.2.1.  Command line**

명령줄은 다음으로 구성됩니다.

\* 요청된 동사의 이름,

\* 거래 신원,

```text
   *  The name of the endpoint that should execute the command (in
      notifications or restarts, the name of the endpoint that is
      issuing the command),
```

\* 프로토콜 버전.

이 4개 항목은 공백\(예: ASCII 공백\(0x20\) 또는 표 형식\(0x09\) 문자\)으로 구분된 인쇄 가능한 ASCII 문자의 문자열로 인코딩됩니다. 정확히 하나의 ASCII 공백 구분 기호를 사용하는 것이 좋습니다.

---
##### **3.2.1.1.  Coding of the requested verb**

요청할 수 있는 동사는 다음 표에 정의된 대로 4자리 대문자 또는 소문자 ASCII 코드\(비교는 대소문자를 구분하지 않아야 함\)로 인코딩됩니다.

```text
                    ______________________________
                   | Verb                 |  Code|
                   |______________________|______|
                   | EndpointConfiguration|  EPCF|
                   | CreateConnection     |  CRCX|
                   | ModifyConnection     |  MDCX|
                   | DeleteConnection     |  DLCX|
                   | NotificationRequest  |  RQNT|
                   | Notify               |  NTFY|
                   | AuditEndpoint        |  AUEP|
                   | AuditConnection      |  AUCX|
                   | RestartInProgress    |  RSIP|
                   |______________________|______|
```

거래 식별자는 최대 9자리의 십진수 문자열로 인코딩됩니다. 명령줄에서는 동사 코딩 바로 뒤에 옵니다.

프로토콜의 추가 버전에서는 새로운 동사가 정의될 ​​수 있습니다. 실험 목적으로 이 프로토콜의 게시된 버전에서 승인되기 전에 새로운 동사를 사용해야 할 수도 있습니다. 실험 동사는 XPER와 같이 문자 X로 시작하는 4자 코드로 식별되어야 합니다.

---
##### **3.2.1.2.  Transaction Identifiers**

MGCP는 트랜잭션 식별자를 사용하여 명령과 응답을 연관시킵니다. 게이트웨이는 두 개의 별도 트랜잭션 식별자 네임스페이스를 지원합니다.

```text
     a transaction identifier name space for sending transactions, and
```

트랜잭션을 수신하기 위한 트랜잭션 식별자 네임스페이스.

최소한 지정된 게이트웨이로 전송된 명령에 대한 트랜잭션 식별자는 해당 게이트웨이를 제어하는 ​​호출 에이전트 모음 내에서 트랜잭션의 최대 수명 동안 고유해야 합니다. 따라서,\(MUST\)

송신 호출 에이전트에 관계없이 게이트웨이는 단순히 트랜잭션 식별자를 검사하여 항상 중복 트랜잭션을 감지할 수 있습니다. 그러나 통화 에이전트 간의 이러한 트랜잭션 식별자 조정은 이 사양의 범위를 벗어납니다.

지정된 게이트웨이에서 전송된 모든 명령에 대한 트랜잭션 식별자는 명령이 전송된 호출 에이전트에 관계없이 트랜잭션의 최대 수명 동안 고유해야 합니다. 따라서 통화 에이전트는 엔드포인트의 도메인 이름과 트랜잭션 식별자의 조합을 통해 항상 게이트웨이에서 중복 트랜잭션을 감지할 수 있습니다.\(MUST\)

거래 식별자는 최대 9자리의 십진수 문자열로 인코딩됩니다. 명령줄에서는 동사 코딩 바로 뒤에 옵니다.

트랜잭션 식별자는 1에서 999999999 사이의 값을 갖습니다. MGCP 엔터티는 식별자가 사용된 이전 명령이 완료된 후 3분 이상 빠르게 트랜잭션 식별자를 재사용해서는 안 됩니다.\(MUST NOT\)

---
##### **3.2.1.3.  Coding of the endpoint identifiers and entity names**

엔드포인트 식별자와 엔터티 이름은 RFC 821에 정의된 대로 대소문자를 구분하지 않는 이메일 주소로 인코딩됩니다. 이러한 주소에서 도메인 이름은 엔드포인트가 연결된 시스템을 식별하고 왼쪽은 해당 시스템의 특정 엔드포인트를 식별합니다.

이러한 주소의 예는 다음과 같습니다.

```text
    ______________________________________________________________________
   | hrd4/56@gw23.example.net     |  Circuit number 56 in                |
   |                              |  interface "hrd4" of the Gateway 23  |
   |                              |  of the "Example" network            |
   | Call-agent@ca.example.net    |  Call Agent for the                  |
   |                              |  "example" network                   |
   | Busy-signal@ann12.example.net|  The "busy signal" virtual           |
   |                              |  endpoint in the announcement        |
   |                              |  server number 12.                   |
   |______________________________|______________________________________|
```

통지된 엔터티의 이름은 다음과 같이 포트 번호를 추가하여 동일한 구문으로 표현됩니다.

```text
     Call-agent@ca.example.net:5234
```

포트 번호를 생략하는 경우 기본 MGCP 포트\(2427\)가 사용됩니다.

---
##### **3.2.1.4.  Coding of the protocol version**

프로토콜 버전은 키워드 MGCP, 공백 및 버전 번호, 선택적으로 프로필 이름으로 코딩됩니다. 버전 번호는 십진수, 점 및 기호로 코딩된 메이저 버전으로 구성됩니다. 소수로 코딩된 부 버전 번호입니다. 이 문서에 설명된 버전은 버전 1.0입니다.

프로필 이름\(있는 경우\)은 줄 끝까지 확장되는 표시\(인쇄 가능\) 문자의 공백으로 구분된 문자열로 표시됩니다. MGCP에 제한 사항이나 기타 프로파일링을 적용하려는 사용자 커뮤니티에 대해 프로필 이름을 정의할 수 있습니다.

초기 메시지에서 버전은 다음과 같이 코딩됩니다.

```text
        MGCP 1.0
```

---
#### **3.2.2.  Parameter lines**

매개변수 줄은 매개변수 이름으로 구성되며, 대부분의 경우 단일 대문자와 콜론, 공백, 매개변수 값으로 구성됩니다. 명령에 포함될 수 있는 매개변수는 다음 표에 정의되어 있습니다.

```text
 _______________________________________________________________________
 |Parameter name        |  Code|  Parameter value                      |
 |______________________|______|_______________________________________|
 |ResponseAck           |   K  |  see description                      |
 |BearerInformation     |   B  |  see description                      |
 |CallId                |   C  |  Hexadecimal string, at most 32 chars.|
 |ConnectionId          |   I  |  Hexadecimal string, at most 32 chars.|
 |NotifiedEntity        |   N  |  An identifier, in RFC 821 format,    |
 |                      |      |  composed of an arbitrary string and  |
 |                      |      |  of the domain name of the requesting |
 |                      |      |  entity, possibly completed by a port |
 |                      |      |  number, as in:                       |
 |                      |      |   Call-agent@ca.example.net:5234      |
 |RequestIdentifier     |   X  |  Hexadecimal string, at most 32 chars.|
 |LocalConnectionOptions|   L  |  See description                      |
 |Connection Mode       |   M  |  See description                      |
 |RequestedEvents       |   R  |  See description                      |
 |SignalRequests        |   S  |  See description                      |
 |DigitMap              |   D  |  A text encoding of a digit map       |
 |ObservedEvents        |   O  |  See description                      |
 |ConnectionParameters  |   P  |  See description                      |
 |ReasonCode            |   E  |  An arbitrary character string        |
 |SpecificEndpointID    |   Z  |  An identifier, in RFC 821 format,    |
 |                      |      |  composed of an arbitrary string,     |
 |                      |      |  followed by an "@" followed by the   |
 |                      |      |  domain name of the gateway to which  |
 |                      |      |  this endpoint is attached.           |
 |Second Endpoint ID    |   Z2 |  Endpoint Id.                         |
 |SecondConnectionId    |   I2 |  Connection Id.                       |
 |RequestedInfo         |   F  |  See description                      |
 |QuarantineHandling    |   Q  |  See description                      |
 |DetectEvents          |   T  |  See Description                      |
 |RestartMethod         |   RM |  See description                      |
 |RestartDelay          |   RD |  A number of seconds, encoded as      |
 |                      |      |  a decimal number                     |
 |EventStates           |   ES |  See description                      |
 |Capabilities          |   A  |  See description                      |
 |______________________|______|_______________________________________|
 |RemoteConnection      |   RC |  Session Description                  |
 |Descriptor            |      |                                       |
 |LocalConnection       |   LC |  Session Description                  |
 |Descriptor            |      |                                       |
 |______________________|______|_______________________________________|
```

매개변수가 반드시 모든 명령에 존재하는 것은 아닙니다. 다음 표에서는 매개변수와 명령 간의 연관성을 제공합니다. 문자 M은 필수, O는 선택, F는 금지를 나타냅니다.

```text
   ___________________________________________________________________
  | Parameter name      |  EP|  CR|  MD|  DL|  RQ|  NT|  AU|  AU|  RS|
  |                     |  CF|  CX|  CX|  CX|  NT|  FY|  EP|  CX|  IP|
  |_____________________|____|____|____|____|____|____|____|____|____|
  | ResponseAck         |  O |  O |  O |  O |  O |  O |  O |  O |  O |
  | BearerInformation   |  M |  O |  O |  O |  O |  F |  F |  F |  F |
  | CallId              |  F |  M |  M |  O |  F |  F |  F |  F |  F |
  | ConnectionId        |  F |  F |  M |  O |  F |  F |  F |  M |  F |
  | RequestIdentifier   |  F |  O+|  O+|  O+|  M |  M |  F |  F |  F |
  | LocalConnection     |  F |  O |  O |  F |  F |  F |  F |  F |  F |
  | Options             |    |    |    |    |    |    |    |    |    |
  | Connection Mode     |  F |  M |  M |  F |  F |  F |  F |  F |  F |
  | RequestedEvents     |  F |  O |  O |  O |  O*|  F |  F |  F |  F |
  | SignalRequests      |  F |  O |  O |  O |  O*|  F |  F |  F |  F |
  | NotifiedEntity      |  F |  O |  O |  O |  O |  O |  F |  F |  F |
  | ReasonCode          |  F |  F |  F |  O |  F |  F |  F |  F |  O |
  | ObservedEvents      |  F |  F |  F |  F |  F |  M |  F |  F |  F |
  | DigitMap            |  F |  O |  O |  O |  O |  F |  F |  F |  F |
  | Connection          |  F |  F |  F |  O |  F |  F |  F |  F |  F |
  | parameters          |    |    |    |    |    |    |    |    |    |
  | Specific Endpoint ID|  F |  F |  F |  F |  F |  F |  F |  F |  F |
  | Second Endpoint ID  |  F |  O |  F |  F |  F |  F |  F |  F |  F |
  | RequestedInfo       |  F |  F |  F |  F |  F |  F |  M |  M |  F |
  | QuarantineHandling  |  F |  O |  O |  O |  O |  F |  F |  F |  F |
  | DetectEvents        |  F |  O |  O |  O |  O |  F |  F |  F |  F |
  | EventStates         |  F |  F |  F |  F |  F |  F |  F |  F |  F |
  | RestartMethod       |  F |  F |  F |  F |  F |  F |  F |  F |  M |
  | RestartDelay        |  F |  F |  F |  F |  F |  F |  F |  F |  O |
  | SecondConnectionID  |  F |  F |  F |  F |  F |  F |  F |  F |  F |
  | Capabilities        |  F |  F |  F |  F |  F |  F |  F |  F |  F |
  |_____________________|____|____|____|____|____|____|____|____|____|
  | RemoteConnection    |  F |  O |  O |  F |  F |  F |  F |  F |  F |
  | Descriptor          |    |    |    |    |    |    |    |    |    |
  | LocalConnection     |  F |  F |  F |  F |  F |  F |  F |  F |  F |
  | Descriptor          |    |    |    |    |    |    |    |    |    |
  |_____________________|____|____|____|____|____|____|____|____|____|
```

\(+\) RequestIdentifier 매개변수는 연결 생성, 수정 및 삭제 명령에서 선택 사항이지만 명령에 캡슐화된 알림 요청이 포함된 경우 필수가 됩니다.

\(\*\) RequestedEvents 및 SignalRequests 매개변수는 알림요청에서 선택사항입니다. 이러한 매개변수가 생략되면 해당 목록은 비어 있는 것으로 간주됩니다.

구현자가 새로운 매개변수를 실험해야 하는 경우\(예: MGCP의 새 애플리케이션을 개발할 때\) 문자열 "X-" 또는 "X+"로 시작하는 이름으로 이러한 매개변수를 식별해야 합니다. 예를 들면 다음과 같습니다.

```text
             X-FlowerOfTheDay: Daisy
```

"X+"로 시작하는 매개변수 이름은 중요한 매개변수 확장입니다. 이해할 수 없는 중요한 매개변수 확장을 수신한 MGCP 엔터티는 명령 실행을 거부해야 합니다. 오류 코드 511\(인식할 수 없는 확장명\)으로 응답해야 합니다.

"X-"로 시작하는 매개변수 이름은 중요하지 않은 매개변수 확장입니다. 이해할 수 없는 중요하지 않은 매개변수 확장을 수신하는 MGCP 엔터티는 해당 매개변수를 안전하게 무시할 수 있습니다.

---
##### **3.2.2.1.  Response Acknowledgement**

응답 승인 속성은 "UDP를 통한 전송" 섹션에 설명된 "최대 1회" 기능을 관리하는 데 사용됩니다. 여기에는 "확인된 거래 ID 범위"의 쉼표로 구분된 목록이 포함되어 있습니다.

각 "확인된 거래 ID 범위"는 범위에 정확히 하나의 거래가 포함된 경우 하나의 십진수로 구성되거나 범위에 포함된 하위 및 상위 거래 식별자를 설명하는 단일 하이픈으로 구분된 두 개의 십진수로 구성됩니다.

응답 확인의 예는 다음과 같습니다.

```text
        K: 6234-6255, 6257, 19030-19044
```

---
##### **3.2.2.2.  Local connection options**

로컬 연결 옵션은 통화 에이전트가 게이트웨이에 제안하는 작동 매개변수를 설명합니다. 이러한 매개변수는 다음과 같습니다.

\* 패킷화 기간\(밀리초\)은 키워드 "p"로 인코딩되고 그 뒤에 콜론과 십진수가 옵니다. 통화 상담원이 값 범위를 지정하는 경우 범위는 하이픈으로 구분된 두 개의 십진수로 지정됩니다.

\* 선호되는 압축 알고리즘 유형으로, 키워드 "a"로 인코딩되고 그 뒤에 콜론과 문자열이 옵니다. 통화 상담원이 값 목록을 지정하는 경우 이러한 값은 세미콜론으로 구분됩니다.

\* 대역폭은 초당 킬로비트\(초당 1000비트\)로, 키워드 "b"로 인코딩되고 그 뒤에 콜론과 십진수가 옵니다. 통화 상담원이 값 범위를 지정하는 경우 범위는 하이픈으로 구분된 두 개의 십진수로 지정됩니다.

\* 에코 제거 매개변수는 키워드 "e"로 인코딩되고 그 뒤에 콜론과 "on" 또는 "off" 값이 옵니다.

\* 게인 제어 매개변수는 키워드 "gc"로 인코딩되고 그 뒤에는 게인 데시벨 수를 나타내는 키워드 "auto" 또는 십진수\(양수 또는 음수\)일 수 있는 값인 콜론이 옵니다.

\* 묵음 억제 매개변수는 키워드 "s"로 인코딩되고 그 뒤에 콜론과 "on" 또는 "off" 값이 옵니다.

\* 서비스 매개변수 유형은 키워드 "t"로 인코딩되고 그 뒤에 콜론과 두 개의 16진수 숫자로 인코딩된 값이 옵니다.

\* 리소스 예약 매개변수는 키워드 "r"로 인코딩되고 그 뒤에 콜론과 값 "g"\(서비스 보장\), "cl"\(제어된 로드\) 또는 "be"\(최선의 노력\)가 옵니다.

\* 암호화 키는 SDP\(RFC 2327\)의 매개변수 "K"에 대해 정의된 대로 키워드 "k" 뒤에 콜론과 키 사양이 오는 방식으로 인코딩됩니다.

\* 네트워크 유형은 키워드 "nt" 다음에 콜론으로 인코딩되고 네트워크 유형은 키워드 "IN", "ATM" 또는 "LOCAL"로 인코딩됩니다.

각 매개변수는 선택사항입니다. 여러 매개변수가 있는 경우 값은 쉼표로 구분됩니다.

연결 설명자의 예는 다음과 같습니다.

```text
             L: p:10, a:PCMU
             L: p:10, a:G726-32
             L: p:10-20, b:64
             L: b:32-64, e:off
```

이러한 속성 세트는 확장 속성에 의해 확장될 수 있습니다.

확장 속성은 속성 이름, 세미콜론, 속성 값으로 구성됩니다. 속성 이름은 필수 확장인 경우 "x+", 비필수 확장인 경우 "x-" 두 문자로 시작해야 합니다. 게이트웨이가 인식하지 못하는 필수 확장 속성을 수신하는 경우 오류 코드 525\(LocalConnectionOptions의 알 수 없는 확장\)와 함께 명령을 거부해야 합니다.

---
##### **3.2.2.3.  Capabilities**

기능은 감사 시 엔드포인트의 기능에 대해 호출 에이전트에 알립니다. 기능 인코딩은 두 가지 모두에 공통적인 매개변수에 대한 로컬 연결 옵션 인코딩을 기반으로 합니다. 또한 기능에는 지원되는 패키지 목록과 지원되는 모드 목록도 포함될 수 있습니다.

사용되는 매개변수는 다음과 같습니다.

\*

- 지원되는 코덱 목록입니다. 다음 매개변수는 이 목록에 지정된 모든 코덱에 적용됩니다. 예를 들어, 일부 매개변수를 지정해야 하는 경우 무음 억제가 일부 코덱과만 호환되는 경우 게이트웨이는 각 코덱 세트에 대해 하나씩 여러 LocalConnectionOptions 매개변수를 반환합니다.

패킷화 기간:

- 범위를 지정할 수 있습니다.

대역폭:

- 패킷화 기간 범위에 해당하는 범위가 지정될 수 있습니다\(무음 억제가 없다고 가정\). 없는 경우 코덱 유형에서 값이 추론됩니다.

에코 제거:

- 이 코덱에 대해 반향 제거가 지원되면 "on"이고, 그렇지 않으면 "off"입니다. 기본값은 지원입니다.

침묵 억제:

- 이 코덱에 무음 억제가 지원되면 "on"이고, 그렇지 않으면 "off"입니다. 기본값은 지원입니다.

제어권을 얻다:

- 게인 제어가 지원되지 않으면 "0"입니다. 기본값은 지원입니다.

서비스 유형:

- 값 "0"은 서비스 유형을 지원하지 않음을 나타내고, 다른 모든 값은 서비스 유형을 지원함을 나타냅니다. 기본값은 지원입니다.

```text
   Resource Reservation:
      The parameter indicates the reservation services that are
      supported, in addition to best effort.  The value "g" is encoded
      when the gateway supports both the guaranteed and the controlled
      load service, "cl" when only the controlled load service is
      supported.  The default is "best effort."
```

암호화 키:

- 값을 인코딩하면 암호화 지원을 나타냅니다. 기본값은 지원되지 않습니다.

네트워크 유형:

- 키워드 "nt" 뒤에 콜론과 세미콜론으로 구분된 지원되는 네트워크 유형 목록이 옵니다. 이 매개변수는 선택사항입니다.

이벤트 패키지

- 이 엔드포인트에서 지원하는 이벤트 패키지는 키워드 "v"로 인코딩되고 그 뒤에 콜론과 문자열이 옵니다. 값 목록이 지정된 경우 이러한 값은 세미콜론으로 구분됩니다. 지정된 첫 번째 값은 해당 끝점의 기본 패키지가 됩니다.

모드

- 이 끝점에서 지원되는 모드는 키워드 "m"으로 인코딩되며 그 뒤에 콜론과 이 끝점에 대해 지원되는 연결 모드의 세미콜론으로 구분된 목록이 옵니다.

---
##### **3.2.2.4.  Connection parameters**

연결 매개변수는 유형 및 값 쌍의 문자열로 인코딩됩니다. 여기서 유형은 매개변수의 문자 식별자 또는 확장 유형이고 값은 10진수 정수입니다. 유형은 '=' 기호로 값과 구분됩니다. 매개변수는 쉼표로 서로 인코딩됩니다.

연결 매개변수 유형은 다음 표에 지정되어 있습니다.

```text
    __________________________________________________________________
   | Connection parameter|  Code|  Connection parameter              |
   | name                |      |  value                             |
   |_____________________|______|____________________________________|
   | Packets sent        |   PS |  The number of packets that        |
   |                     |      |  were sent on the connection.      |
   | Octets sent         |   OS |  The number of octets that         |
   |                     |      |  were sent on the connection.      |
   | Packets received    |   PR |  The number of packets that        |
   |                     |      |  were received on the connection.  |
   | Octets received     |   OR |  The number of octets that         |
   |                     |      |  were received on the connection.  |
   | Packets lost        |   PL |  The number of packets that        |
   |                     |      |  were not received on the          |
   |                     |      |  connection, as deduced from       |
   |                     |      |  gaps in the sequence number.      |
   | Jitter              |   JI |  The average inter-packet arrival  |
   |                     |      |  jitter, in milliseconds,          |
   |                     |      |  expressed as an integer number.   |
   | Latency             |   LA |  Average latency, in milliseconds, |
   |                     |      |  expressed as an integer number.   |
   |_____________________|______|____________________________________|
```

확장 매개변수 이름은 문자열 "X-"와 그 뒤에 오는 두 글자의 확장 매개변수 이름으로 구성됩니다. 인식할 수 없는 내선 번호를 받은 통화 상담원은 이러한 내선 번호를 자동으로 무시해야 합니다.

연결 매개변수 인코딩의 예는 다음과 같습니다.

```text
         P: PS=1245, OS=62345, PR=0, OR=0, PL=0, JI=0, LA=48
```

---
##### **3.2.2.5.  Reason Codes**

이유 코드는 세 자리 숫자 값입니다. 이유 코드 뒤에는 선택적으로 공백과 설명이 옵니다. 예:

```text
      900 Endpoint malfunctioning
```

원인 코드 목록은 섹션 2.5에서 확인할 수 있습니다.

---
##### **3.2.2.6.  Connection mode**

연결 모드는 연결 작동 모드를 설명합니다. 가능한 값은 다음과 같습니다.

```text
       ________________________________________________________
      | Mode       |  Meaning                                 |
      |____________|__________________________________________|
      | M: sendonly|  The gateway should only send packets    |
      | M: recvonly|  The gateway should only receive packets |
      | M: sendrecv|  The gateway should send                 |
      |            |  and receive packets                     |
      | M: confrnce|  The gateway should place                |
      |            |  the connection in conference mode       |
      | M: inactive|  The gateway should neither              |
      |            |  send nor receive packets                |
      | M: loopback|  The gateway should place                |
      |            |  the circuit in loopback mode.           |
      | M: conttest|  The gateway should place                |
      |            |  the circuit in test mode.               |
      | M: netwloop|  The gateway should place                |
      |            |  the connection in network loopback mode.|
      | M: netwtest|  The gateway should place                |
      |            |   the connection in network              |
      |            |   continuity test mode.                  |
      | M: data    |  The gateway should use the circuit      |
      |            |  for network access for data             |
      |            |  (e.g., PPP, SLIP, etc.).                |
      |____________|__________________________________________|
```

---
##### **3.2.2.7.  Coding of event names**

이벤트 이름은 실제 이벤트 이름과 슬래시\(/\)로 구분된 선택적 패키지 이름으로 구성됩니다. 이벤트 이름 뒤에는 선택적으로 at 기호\(@\)와 이벤트를 관찰해야 하는 연결 식별자가 올 수 있습니다. 이벤트 이름은 RequestedEvents, SignalRequests 및 ObservedEvents 매개변수에 사용됩니다.

각 신호에는 켜기/끄기\(OO\), 타임아웃\(TO\), 간략\(BR\)과 관련된 신호 유형 중 하나가 있습니다. \(이러한 신호 유형은 패키지 정의에 지정되며 메시지에는 없습니다.\) 켜기/끄기 신호는 신호를 켜려면 "+"로, 신호를 끄려면 "-"로 매개변수화할 수 있습니다. 켜기/끄기 신호가 매개변수화되지 않은 경우 신호가 켜집니다. 다음 두 가지 모두 vmwi 신호를 켭니다.

```text
      vmwi(+), vmwi
```

다음은 이벤트 이름의 유효한 예입니다.

```text
       ____________________________________________________________
      | L/hu        |   on-hook transition, in the line package   |
      | F/0         |   digit 0 in the MF package                 |
      | fh          |   Flash-hook, assuming that the line package|
      |             |   is a default package for the end point.   |
      | G/rt@0A3F58 |   Ring back signal on                       |
      |             |   connection "0A3F58".                      |
      |_____________|_____________________________________________|
```

또한 RequestedEvents 및 DetectEvents 매개변수에서는 개별 이름 대신 이벤트의 범위 및 와일드카드 표기법을 사용할 수 있습니다. 별표는 "모든 연결"을 나타내는 데 사용할 수 있으며 달러 기호는 "현재" 연결을 나타내는 데 사용할 수 있습니다. 다음은 이러한 표기법의 유효한 예입니다.

```text
       __________________________________________________________
      | M/[0-9]   |   Digits 0 to 9 in the MF package           |
      | fh        |   Flash-hook, assuming that the line package|
      |           |   is a default package for the end point.   |
      | [0-9*#A-D]|   All digits and letters in the DTMF        |
      |           |   packages (default for endpoint).          |
      | T/$       |   All events in the trunk packages.         |
      | R/qa@*    |   The quality alert event in all            |
      |           |   connections                               |
      | R/rt@$    |   Ringback on current connection            |
      |___________|_____________________________________________|
```

---
##### **3.2.2.8.  RequestedEvents**

RequestedEvent 매개변수는 요청된 이벤트 목록을 제공합니다. 이벤트 코드는 이전 섹션에 설명되어 있습니다.

각 이벤트는 요청된 작업 또는 작업 목록에 따라 한정될 수 있습니다. 지정된 작업은 괄호로 묶이고 쉼표로 구분된 키워드 목록으로 인코딩됩니다. 다양한 작업에 대한 코드는 다음과 같습니다.

```text
                ______________________________________
               | Action                       |  Code|
               |______________________________|______|
               | Notify immediately           |  N   |
               | Accumulate                   |  A   |
               | Treat according to digit map |  D   |
               | Swap                         |  S   |
               | Ignore                       |  I   |
               | Keep Signal(s) active        |  K   |
               | Embedded Notification Request|  E   |
               |______________________________|______|
```

작업이 지정되지 않은 경우 기본 작업은 이벤트를 알리는 것입니다. 이는 예를 들어 ft와 ft\(N\)이 동일하다는 것을 의미합니다. 나열되지 않은 이벤트는 무시됩니다.

숫자 매핑 작업은 MF 및 DTMF 패키지 또는 숫자 및 타이머의 인코딩을 정의하는 다른 패키지의 숫자, 문자 및 숫자 간 타이머에 대해서만 지정할 수 있습니다.

요청된 목록은 이벤트/작업 그룹이 쉼표로 구분되어 한 줄에 인코딩됩니다. RequestedEvents 인코딩의 예는 다음과 같습니다.

```text
         R: hu(N), hf(S,N)
         R: hu(N), [0-9#T](D)
```

"활성화" 작업의 경우 포함된 알림 요청 매개변수는 쉼표로 구분된 최대 3개의 매개변수 그룹 목록으로 인코딩됩니다. 각 그룹은 한 글자 식별자로 시작하고 그 뒤에 괄호 안에 매개변수 목록이 옵니다. 문자 "R"로 식별되는 첫 번째 선택적 매개변수 그룹은 RequestedEvents 매개변수의 활성화된 값입니다. 문자 "S"로 식별되는 두 번째 선택적 그룹은 SignalRequests 매개변수의 활성화된 값입니다. 문자 "D"로 식별되는 세 번째 선택적 그룹은 DigitMap의 활성화된 값입니다. \(기존 구현 중 일부는 이 세 가지 구성 요소를 다른 순서로 인코딩할 수 있습니다.\)

RequestedEvents가 없으면 매개변수는 null 값으로 설정됩니다. SignalRequest가 없으면 매개변수는 null 값으로 설정됩니다. DigitMap이 없으면 현재 값을 사용해야 합니다. 다음은 포함된 요청의 유효한 예입니다.

```text
         R: hd(E(R([0-9#T](D),hu(N)),S(dl),D([0-9].[#T])))
         R: hd(E(R([0-9#T](D),hu(N)),S(dl)))
```

---
##### **3.2.2.9.  SignalRequests**

SignalRequests 매개변수는 요청된 신호의 이름을 제공합니다. 각 신호는 이전 섹션에 표시된 대로 이름으로 식별됩니다.

예를 들어 안내 방송이나 ADSI 디스플레이와 같은 여러 신호는 추가 매개변수를 통해 검증될 수 있습니다.

\* 공지사항의 이름과 매개변수,

\* 표시되어야 하는 문자열입니다.

```text
   These parameters will be encoded as a set of UTF8 character strings,
   spearated by comams and enclosed within parenthesis, as in:
      S: adsi("123456 Francois Gerard")
      S: ann(no-such-number, 1234567)
```

여러 신호가 요청되면 해당 코드는 다음과 같이 쉼표로 구분됩니다.

```text
         S: asdi(123456 Your friend), rg
```

---
##### **3.2.2.10.  ObservedEvent**

관찰된 이벤트 매개변수는 관찰된 이벤트 목록을 제공합니다. 이벤트 코드는NotificationRequest에 사용된 것과 동일합니다. 숫자 지도에 따라 누적된 이벤트는 단일 문자열로 그룹화될 수 있습니다. 숫자 축적 중에 다른 이벤트가 감지된 경우 격리된 이벤트 목록으로 보고되어야 합니다. 관찰된 작업의 예는 다음과 같습니다.

```text
        O: L/hu
        O: 8295555T
        O: 8,2,9,5,5,L/hf,5,5,T
        O: L/hf, L/hf, L/hu
```

---
##### **3.2.2.11.  RequestedInfo**

RequestedInfo 매개변수에는 "매개변수 행" 섹션에 정의된 대로 쉼표로 구분된 매개변수 코드 목록이 포함되어 있습니다. 예를 들어 NotifiedEntity, RequestIdentifier, RequestedEvents, SignalRequests, DigitMap, QuarantineHandling 및 DetectEvents 매개변수의 값을 감사하려는 경우 RequestedInfo 매개변수의 값은 다음과 같습니다.

```text
         F:N,X,R,S,D,Q,T
```

AuditEndPoint 명령의 기능 요청은 다음과 같이 키워드 "A"로 인코딩됩니다.

```text
         F:A
```

---
##### **3.2.2.12.  QuarantineHandling**

격리 처리 매개변수에는 쉼표로 구분된 키워드 목록이 포함되어 있습니다.

\* 격리된 이벤트의 처리를 나타내는 키워드 "프로세스" 또는 "폐기". 프로세스나 삭제가 모두 없으면 프로세스가 가정됩니다.

\* 정확히 최대 하나의 알림이 예상되는지 또는 여러 알림이 허용되는지 여부를 나타내는 키워드 "step" 또는 "loop". 단계나 루프가 모두 없으면 단계로 간주됩니다. 다음 값은 유효한 예입니다.

```text
               Q:loop
               Q:process
               Q:discard,loop
```

---
##### **3.2.2.13.  DetectEvents**

DetectEvent 매개변수는 다음과 같이 쉼표로 구분된 이벤트 목록으로 인코딩됩니다.

```text
         T: hu,hd,hf,[0-9#*]
```

어떤 작업도 이벤트와 연관될 수 없다는 점에 유의해야 합니다.

---
##### **3.2.2.14.  EventStates**

EventStates 매개변수는 다음과 같이 쉼표로 구분된 이벤트 목록으로 인코딩됩니다.

```text
      ES: hu
```

어떤 작업도 이벤트와 연관될 수 없다는 점에 유의해야 합니다.

---
##### **3.2.2.15.  RestartMethod**

RestartMethod 매개변수는 예를 들어 "graceful", "forced", "restart", "disconnected" 또는 "cancel-graceful" 키워드 중 하나로 인코딩됩니다.

```text
         RM:restart
```

---
##### **3.2.2.16.  Bearer Information**

베어러 정보의 값은 속성 이름으로 표시되고 속성 값에서 콜론으로 구분된 쉼표로 구분된 속성 목록으로 인코딩됩니다.

정의된 유일한 속성은 "인코딩"\(코드 "e"\)이며 정의된 값은 "A"\(A-law\) 및 "mu"\(mu-law\)입니다.

베어러 정보 인코딩의 예는 다음과 같습니다.

```text
         B: e:mu
```

---
### **3.3.  Format of response headers**

응답 헤더는 응답 라인으로 구성되며 선택적으로 응답 매개변수를 인코딩하는 헤더가 뒤따릅니다.

응답 헤더의 예는 다음과 같습니다.

```text
         200 1203 OK
```

응답 줄은 세 자리 숫자 값인 응답 코드로 시작됩니다. 코드 뒤에는 공백, 거래 식별자, 공백 앞에 선택적 설명이 옵니다.

다음 표에서는 응답을 트리거한 명령의 기능에 따라 응답 헤더에 필수 또는 선택 항목으로 존재하는 매개 변수를 설명합니다. 문자 M은 필수, O는 선택, F는 금지를 나타냅니다.

```text
    ___________________________________________________________________
   | Parameter name      |  EP|  CR|  MD|  DL|  RQ|  NT|  AU|  AU|  RS|
   |                     |  CF|  CX|  CX|  CX|  NT|  FY|  EP|  CX|  IP|
   |_____________________|____|____|____|____|____|____|____|____|____|
   | ResponseAck         |  F |  F |  F |  F |  F |  F |  F |  F |  F |
   | BearerInformation   |  F |  F |  F |  F |  F |  F |  O |  F |  F |
   | CallId              |  F |  F |  F |  F |  F |  F |  F |  O |  F |
   | ConnectionId        |  F |  O*|  F |  F |  F |  F |  F |  F |  F |
   | RequestIdentifier   |  F |  F |  F |  F |  F |  F |  O |  F |  F |
   | LocalConnection     |  F |  F |  F |  F |  F |  F |  O |  O |  F |
   | Options             |    |    |    |    |    |    |    |    |    |
   | Connection Mode     |  F |  F |  F |  F |  F |  F |  F |  O |  F |
   | RequestedEvents     |  F |  F |  F |  F |  F |  F |  O |  F |  F |
   | SignalRequests      |  F |  F |  F |  F |  F |  F |  O |  F |  F |
   | NotifiedEntity      |  F |  F |  F |  F |  F |  F |  F |  F |  O |
   | ReasonCode          |  F |  F |  F |  F |  F |  F |  O |  F |  F |
   | ObservedEvents      |  F |  F |  F |  F |  F |  F |  O |  F |  F |
   | DigitMap            |  F |  F |  F |  F |  F |  F |  O |  F |  F |
   | Connection          |  F |  F |  F |  O |  F |  F |  F |  O |  F |
   | Parameters          |    |    |    |    |    |    |    |    |    |
   | Specific Endpoint ID|  F |  O |  F |  F |  F |  F |  F |  F |  F |
   | RequestedInfo       |  F |  F |  F |  F |  F |  F |  F |  F |  F |
   | QuarantineHandling  |  F |  F |  F |  F |  F |  F |  O |  F |  F |
   | DetectEvents        |  F |  F |  F |  F |  F |  F |  O |  F |  F |
   | EventStates         |  F |  F |  F |  F |  F |  F |  O |  F |  F |
   | RestartMethod       |  F |  F |  F |  F |  F |  F |  O |  F |  F |
   | RestartDelay        |  F |  F |  F |  F |  F |  F |  O |  F |  F |
   | Capabilities        |  F |  F |  F |  F |  F |  F |  O |  F |  F |
   | SecondConnectionId  |  F |  O |  F |  F |  F |  F |  F |  F |  F |
   | SecondEndpointID    |  F |  O |  F |  F |  F |  F |  F |  F |  F |
   |_____________________|____|____|____|____|____|____|____|____|____|
   | LocalConnection     |  F |  M |  O |  F |  F |  F |  F |  O*|  F |
   | Descriptor          |    |    |    |    |    |    |    |    |    |
   | RemoteConnection    |  F |  F |  F |  F |  F |  F |  F |  O*|  F |
   | Descriptor          |    |    |    |    |    |    |    |    |    |
   |_____________________|____|____|____|____|____|____|____|____|____|
```

CreateConnection 메시지의 경우 응답 줄 뒤에 Connection-Id 매개변수가 옵니다. 생성 요청이 와일드카드 Endpoint-Id로 전송된 경우 특정 엔드포인트-Id 매개변수가 뒤에 올 수도 있습니다. Connection-Id 매개변수는 표에서 선택사항으로 표시됩니다. 실제로 연결이 생성된 경우 모든 긍정적인 응답에 대해 필수이며, 생성된 연결이 없는 경우 응답이 부정적인 경우에는 금지됩니다.

DeleteConnection 메시지의 경우 섹션 3.2.2.2에 정의된 대로 응답 줄 뒤에 연결 매개변수 매개변수가 옵니다.

LocalConnectionDescriptor는 CreateConnection에 대한 긍정적인 응답\(코드 200\)과 함께 전송되어야 합니다. 수정으로 인해 세션 매개변수가 수정된 경우 ModifyConnection 명령에 대한 응답으로 전송될 수 있습니다. LocalConnectionDescriptor는 섹션 3.4에 정의된 대로 "세션 설명"으로 인코딩됩니다. 응답 헤더와 빈 줄로 구분됩니다.

여러 세션 설명자가 동일한 응답으로 인코딩되면 빈 줄로 구분되어 하나씩 인코딩됩니다. 예를 들어 감사 연결 요청에 대한 응답이 다음과 같이 로컬 세션 설명과 원격 세션 설명을 모두 전달하는 경우입니다.

```text
         200 1203 OK
         C: A3C47F21456789F0
         N: [128.96.41.12]
         L: p:10, a:PCMU;G726-32
         M: sendrecv
         P: PS=1245, OS=62345, PR=780, OR=45123, PL=10, JI=27,LA=48

         v=0
         c=IN IP4 128.96.41.1
         m=audio 1296 RTP/AVP 0

         v=0
         c=IN IP4 128.96.63.25
         m=audio 1296 RTP/AVP 0 96
         a=rtpmap:96 G726-32/8000
```

이 예에서 SDP 구문에 따라 각 설명은 "버전" 줄\(v=...\)로 시작됩니다. 로컬 설명은 항상 원격 설명보다 먼저 전송됩니다. 연결 설명자가 요청되었지만 감사된 연결에 대해 존재하지 않는 경우 해당 연결 설명자는 SDP 프로토콜 버전 필드에만 나타납니다.

---
### **3.4.  Formal syntax description of the protocol**

이 섹션에서는 RFC 2234에 정의된 "Augmented BNF for Syntax Specs"에 따라 프로토콜 구문에 대한 공식적인 설명을 제공했습니다.

---
# **MGCPMessage = MGCPCommand / MGCPResponse**
---
# **MGCPCommand = MGCPCommandLine 0*(MGCPParameter) [EOL *SDPinformation]**

```text
MGCPCommandLine = MGCPVerb 1*(WSP) <transaction-id> 1*(WSP)
                        <endpointName> 1*(WSP) MGCPversion EOL

MGCPVerb = "EPCF" / "CRCX" / "MDCX" / "DLCX" / "RQNT"
         / "NTFY" / "AUEP" / "AUCX" / "RSIP" / extensionVerb
```

---
# **extensionVerb = "X" 3(ALPHA / DIGIT)**
---
# **transaction-id = 1*9(DIGIT)**

끝점 이름 = localEndpointName "@" 도메인 이름
LocalEndpointName = LocalNamePart 0\*\("/" LocalNamePart\)
LocalNamePart = AnyName / AllName / NameString
AnyName = "$"
모든 이름 = "\*"
NameString = 1\*\(허용되는 문자 범위\)
도메인 이름 = 1\*256\(ALPHA / DIGIT / "." / "-"\) ; RFC 821에 정의된 대로

```text
MGCPversion = "MGCP" 1*(WSP) 1*(DIGIT) "." 1*(DIGIT)
              [1*(WSP) ProfileName]
ProfileName = 1*(range-of-allowed-characters)
```

---
# **MGCPParameter = ParameterValue EOL**

```text
ParameterValue = ("K" ":" 0*WSP <ResponseAck>) /
                 ("B" ":" 0*WSP <BearerInformation>) /
                 ("C" ":" 0*WSP <CallId>) /
                 ("I" ":" 0*WSP <ConnectionId>) /
                 ("N" ":" 0*WSP <NotifiedEntity>) /
                 ("X" ":" 0*WSP <RequestIdentifier>) /
                 ("L" ":" 0*WSP <LocalConnectionOptions>) /
                 ("M" ":" 0*WSP <ConnectionMode>) /
                 ("R" ":" 0*WSP <RequestedEvents>) /
                 ("S" ":" 0*WSP <SignalRequests>) /
                 ("D" ":" 0*WSP <DigitMap>) /
                 ("O" ":" 0*WSP <ObservedEvents>) /
                 ("P" ":" 0*WSP <ConnectionParameters>) /
                 ("E" ":" 0*WSP <ReasonCode>) /

                 ("Z" ":" 0*WSP <SpecificEndpointID>) /
                 ("Z2" ":" 0*WSP <SecondEndpointID>) /
                 ("I2" ":" 0*WSP <SecondConnectionID>) /
                 ("F" ":" 0*WSP <RequestedInfo>) /
                 ("Q" ":" 0*WSP <QuarantineHandling>) /
                 ("T" ":" 0*WSP <DetectEvents>) /
                 ("RM" ":" 0*WSP <RestartMethod>) /
                 ("RD" ":" 0*WSP <RestartDelay>) /
                 ("A" ":" 0*WSP <Capabilities>) /
                 ("ES" ":" 0*WSP <EventStates>) /
                     (extensionParameter ":" 0*WSP <parameterString>)

ResponseAck =  confirmedTransactionIdRange
               *[ ","  confirmedTransactionIdRange ]
```

---
# **confirmedTransactionIdRange = 1*9DIGIT [ "-" 1*9DIGIT ]**

```text
BearerInformation = BearerAttribute 0*("," 0*WSP BearerAttribute)
BearerAttribute = ("e" ":" <BearerEncoding>)
BearerEncoding = "A" / "mu"
```

---
# **CallId = 1*32(HEXDIG)**

// 감사 요청 응답에는 식별자 목록이 포함될 수 있습니다.
연결 ID = 1\*32\(HEXDIG\) 0\*\("," 1\*32\(HEXDIG\)\)
SecondConnectionID = 연결 ID

```text
NotifiedEntity = [LocalName "@"] DomainName [":" portNumber]
LocalName = 1*32(suitableCharacter)
portNumber = 1*5(DIGIT)
```

---
# **RequestIdentifier = 1*32(HEXDIG)**

```text
LocalConnectionOptions = [ LocalOptionValue 0*(WSP)
                 0*("," 0*(WSP) LocalOptionValue 0*(WSP)) ]
LocalOptionValue = ("p" ":" <packetizationPeriod> )
                 / ("a" ":" <compressionAlgorithm> )
                 / ("b" ":" <bandwidth> )
                 / ("e" ":" <echoCancellation> )
                 / ("gc" ":" <gainControl> )
                 / ("s" ":" <silenceSuppression> )
                 / ("t" ":" <typeOfService> )
                 / ("r" ":" <resourceReservation> )
                 / ("k" ":" <encryptionmethod>[":"<encryptionKey>])
                 / ("nt" ":" <typeOfNetwork> )
                 / (localOptionExtensionName ":"
                 / localOptionExtensionValue)

Capabilities = [ CapabilityValue 0*(WSP)
                 0*("," 0*(WSP) CapabilityValue 0*(WSP)) ]

CapabilityValue = LocalOptionValue
                / ("v" ":" <supportedPackages>)
                / ("m" ":" <supportedModes> )

packetizationPeriod = 1*4(DIGIT)["-" 1*4(DIGIT)]
compressionAlgorithm = algorithmName 0*(";" algorithmName)
algorithmName = 1*32(SuitableCharacter)
bandwidth = 1*4(DIGIT)["-" 1*4(DIGIT)]
echoCancellation = "on" / "off"
gainControl = "auto" / ["-"]1*4(DIGIT)
silenceSuppression = "on" / "off"
typeOfService = 2HEXDIG
resourceReservation = "g" / "cl" / "be"
```

;암호화 매개변수는 SDP\(RFC 2327\)와 같이 코딩됩니다.
암호화 데이터 = \( "clear" ":" <encryptionKey\> \) / \( "base64" ":" <encodedEncryptionKey\> \) / \( "uri" ":" <URItoObtainKey\> \) / \( "prompt" \) ; SDP에 정의되어 있으며 MGCP에서는 사용할 수 없습니다!
암호화키 = 1\*\(SuitableCharacter / SP\)
encodeEncryptionKey = 1\*\(ALPHA / DIGIT / "+" / "/" / "="\)
URItoObtainKey = 1\*\(SuitableCharacter\) / quotedString

```text
typeOfNetwork = "IN" / "ATM" / "LOCAL"
supportedModes= ConnectionMode 0*(";" ConnectionMode)
supportedPackages = packageName 0*(";" packageName)

localOptionExtensionName = "x" ("+"/"-") 1*32(SuitableCharacter)
localOptionExtensionValue = 1*32(SuitableCharacter) / quotedString

ConnectionMode = "sendonly" / "recvonly" / "sendrecv" /
                 "confrnce" / "inactive" / "loopback" /
                 "conttest" / "netwloop" / "netwtest" / "data"

RequestedEvents = [requestedEvent 0*("," 0*(WSP) requestedEvent)]
requestedEvent = eventName [ "(" requestedActions ")" ]

eventName = [ (packageName / "*") "/" ] (eventId / "all" / eventRange)
            [ "@" (ConnectionId / "$" / "*") ]
packageName = 1*(ALPHA / DIGIT / HYPHEN)
eventId = 1*(SuitableCharacter)
eventRange = "[" 1*(DIGIT / DTMFLetter / "*" / "#" /

                        (DIGIT "-" DIGIT)/(DTMFLetter "-"
                         DTMFLetter)) "]"

requestedActions = requestedAction 0*("," 0*(WSP) requestedAction)
requestedAction = "N" / "A" / "D" / "S" / "I" / "K" /
                  "E" "(" EmbeddedRequest ")"

EmbeddedRequest =   (      "R" "(" EmbeddedRequestList ")"
                      ["," "S" "(" EmbeddedSignalRequest ")" ]
                      ["," "D" "(" EmbeddedDigitMap ")" ] )
                /   (      "S" "(" EmbeddedSignalRequest ")"
                      ["," "D" "(" EmbeddedDigitMap ")" ] )
                /   (      "D" "(" EmbeddedDigitMap ")" )

EmbeddedRequestList = RequestedEvents
EmbeddedSignalRequest = SignalRequests
EmbeddedDigitMap = DigitMap

SignalRequests = [ SignalRequest 0*("," 0*(WSP) SignalRequest ) ]
SignalRequest = eventName [ "(" eventParameters ")" ]
eventParameters = eventParameter 0*("," 0*(WSP) eventParameter)
eventParameter = eventParameterString / quotedString
eventParameterString = 1*(SuitableCharacter)

DigitMap = DigitString  / "(" DigitStringList ")"
DigitStringList = DigitString 0*( "|" DigitString )
DigitString = 1*(DigitStringElement)
DigitStringElement = DigitPosition ["."]
DigitPosition = DigitMapLetter / DigitMapRange
DigitMapLetter = DIGIT / "#" / "*" / "A" / "B" / "C" / "D" / "T"
DigitMapRange =  "x" / "[" 1*DigitLetter "]"
DigitLetter ::= *((DIGIT "-" DIGIT ) / DigitMapLetter)

ObservedEvents = SignalRequests
EventStates = SignalRequests

ConnectionParameters = [ConnectionParameter
                        0*( "," 0*(WSP) ConnectionParameter )
ConnectionParameter = ( "PS" "=" packetsSent )
                    / ( "OS" "=" octetsSent )
                    / ( "PR" "=" packetsReceived )
                    / ( "OR" "=" octetsReceived )
                    / ( "PL" "=" packetsLost )
                    / ( "JI" "=" jitter )
                    / ( "LA" "=" averageLatency )
                    / ( ConnectionParameterExtensionName "="
                        ConnectionParameterExtensionValue )
packetsSent = 1*9(DIGIT)

octetsSent = 1*9(DIGIT)
packetsReceived = 1*9(DIGIT)
octetsReceived = 1*9(DIGIT)
packetsLost = 1*9(DIGIT)
jitter = 1*9(DIGIT)
averageLatency = 1*9(DIGIT)
ConnectionParameterExtensionName = "X" "-" 2*ALPHA
ConnectionParameterExtensionValue = 1*9(DIGIT)
```

---
# **ReasonCode = 3DIGIT [SPACE 1*(%x20-7E)]**

```text
SpecificEndpointID = endpointName
SecondEndpointID = endpointName
```

---
# **RequestedInfo = [infoCode 0*("," infoCode)]**

```text
infoCode = "B" / "C" / "I" / "N" / "X" / "L" / "M" /
           "R" / "S" / "D" / "O" / "P" / "E" / "Z" /
           "Q" / "T" / "RC" / "LC" / "A" / "ES" / "RM" / "RD"

QuarantineHandling = loopControl / processControl /
              (loopControl "," processControl )
loopControl = "step" / "loop"
processControl = "process" / "discard"
```

---
# **DetectEvents = [eventName 0*("," eventName)]**
---
# **RestartMethod = "graceful" / "forced" / "restart" / "disconnected"**
---
# **RestartDelay = 1*6(DIGIT)**

```text
extensionParameter = "X" ("-"/"+") 1*6(ALPHA / DIGIT)
parameterString = 1*(%x20-7F)

MGCPResponse = MGCPResponseLine 0*(MGCPParameter)
                [EOL *SDPinformation]

MGCPResponseLine = (<responseCode> 1*(WSP) <transaction-id>
                          [1*(WSP) <responseString>] EOL)
responseCode = 3DIGIT
responseString = *(%x20-7E)

SuitableCharacter= DIGIT / ALPHA / "+" / "-" / "_" / "&" /
                   "!" / "'" / "|" / "=" / "#" / "?" / "/" /
                   "." / "$" / "*" / ";" / "@" / "[" / "]" /
                   "^" / "`" / "{" / "}" / "~"
```

---
# **quotedString = DQUOTE visibleString**

```text
                 0*(quoteEscape visibleString) DQUOTE
quoteEscape = DQUOTE DQUOTE
visibleString = (%x00-21 / %x23-FF)
EOL = CRLF / LF
```

---
# **SDPinformation = ;See RFC 2327**
---
### **3.5.  Encoding of the session description**

세션 설명은 세션 설명 프로토콜인 SDP에 따라 인코딩됩니다. MGCP 구현은 모든 규격 SDP 메시지를 완벽하게 구문 분석할 수 있어야 하며 SDP 표준을 엄격하게 준수하는 세션 설명을 보내야 합니다. 실제로 SDP의 사용법은 "mode" 매개변수에 지정된 대로 진행 중인 세션 유형에 따라 달라집니다.

\* 모드가 "data"로 설정된 경우 세션 설명은 데이터 액세스 서비스의 구성을 설명합니다.

\* 모드가 다른 값으로 설정된 경우 세션 설명은 오디오 서비스에 대한 것입니다.

오디오 서비스의 경우 게이트웨이는 "오디오" 미디어에 대해 SDP에 제공된 정보를 고려합니다. 데이터 서비스의 경우 게이트웨이는 "네트워크 액세스" 미디어에 제공된 정보를 고려합니다.

---
#### **3.5.1.  Usage of SDP for an audio service**

전화 통신 게이트웨이에서는 정확히 하나의 미디어인 오디오를 사용하는 세션만 설명하면 됩니다. 전화 통신 애플리케이션과 관련된 SDP 매개변수는 다음과 같습니다.

- 세션 설명 수준에서:

- \* 원격 게이트웨이\(명령\) 또는 로컬 게이트웨이\(응답\)의 IP 주소 또는 SDP "연결 데이터" 매개변수로 인코딩된 오디오 회의의 멀티캐스트 주소입니다. 이 매개변수는 RTP 패킷을 교환하는 데 사용될 IP 주소를 지정합니다.

- 오디오 미디어의 경우:

- \* 오디오 미디어를 지정하는 미디어 설명 필드\(m\), 원격 게이트웨이\(명령\) 또는 로컬 게이트웨이\(응답\)에 의해 RTP 패킷을 수신하는 데 사용되는 전송 포트,

- RTP/AVP 전송 및 게이트웨이가 허용할 형식 목록. 이 목록에는 일반적으로 항상 코드 0\(PCMU용으로 예약됨\)이 포함되어야 합니다.

- \* 선택적으로 동적 오디오 형식의 인코딩을 정의하는 RTPMAP 속성,

- \* 선택적으로 패킷 지속 시간을 정의하는 패킷화 기간\(패킷 시간\) 속성\(Ptime\),

- \* 선택적으로 연결 유형\(sendonly, recvonly, sendrecv, inactive\)을 정의하는 속성입니다. 이 속성은 MGCP의 "모드" 매개변수와 직접적인 관계가 없다는 점에 유의하세요. 실제로 SDP 연결 유형은 MGCP에서 사용하는 값에 관계없이 대부분 "sendrecv"로 설정됩니다. 다른 값은 단방향 연결을 설정해야 하는 정보 또는 알림 서버의 경우와 같이 거의 사용되지 않습니다.

- \* 세션 수준에 없는 경우 원격 게이트웨이\(명령\) 또는 로컬 게이트웨이\(응답\)의 IP 주소입니다.

- 오디오 연결을 위한 SDP 사양의 예는 다음과 같습니다.

```text
            v=0
            c=IN IP4 128.96.41.1
            m=audio 3456 RTP/AVP 0 96
            a=rtpmap:96 G726-32/8000
```

일부 환경에서는 UDP 및 IP를 통한 RTP 이외의 다른 전송 채널을 사용하는 연결을 협상하기 위해 MGCP를 사용하라는 요청이 있습니다. 이에 대해서는 이 문서의 확장에서 자세히 설명합니다.

---
#### **3.5.2.  Usage of SDP in a network access service**

데이터 네트워크 액세스 애플리케이션과 관련된 SDP 매개변수는 다음과 같습니다.

- 데이터 미디어의 경우:

- \* 미디어 설명 필드\(m\)는 코드 "m=nas/xxxx"로 식별되는 네트워크 액세스 미디어를 지정합니다. 여기서 "xxxx"는 아래 지정된 대로 네트워크 액세스 매개변수화에 사용해야 하는 액세스 제어 방법을 설명합니다. 이 필드는 SDP 구문에 지정된 대로 서버에 연결하는 데 사용해야 하는 포트를 지정할 수도 있습니다.

- \* 액세스 제어 방법을 구현하는 서버의 주소 또는 도메인 이름을 지정하는 연결 주소 매개변수\(c=\)입니다. 이 매개변수는 세션 수준에서 지정될 수도 있습니다.

- \* 선택적으로 모뎀 유형을 포함하여 사용할 데이터 연결 유형을 설명하는 베어러 유형 속성\(a=bearer:\).

- \* 선택적으로 채널에서 사용될 프레이밍 유형을 설명하는 프레이밍 유형 속성\(a=framing:\).

\* 선택적으로 전화번호를 설명하는 속성

- \(a=전화 걸기:\), 전화가 전달된 번호\(a=전화 걸기:\) 및 발신 번호\(a=전화 걸기:\).

- \* 선택적으로 LAN\(a=subnet:\)에서 전화 접속 클라이언트가 사용할 수 있는 주소 범위를 설명하는 속성입니다.

- \* 선택적으로 SDP 프로토콜\(k=\)에 지정된 대로 인코딩된 암호화 키입니다.

연결 주소는 SDP 표준에 지정된 대로 인코딩되어야 합니다. 이는 다음 중 하나의 유형인 서버에 액세스하기 위해 미디어 라인에 지정된 포트와 함께 사용됩니다.

```text
       __________________________________________________________
      | Method name|  Method description                        |
      |____________|____________________________________________|
      | radius     |  Authentication according                  |
      |            |  to the Radius protocol.                   |
      | tacacs     |  Authentication according                  |
      |            |  to the TACACS+ protocol.                  |
      | diameter   |  Authentication according                  |
      |            |  to the Diameter protocol.                 |
      | l2tp       |  Level 2 tunneling protocol.               |
      |            |  The address and port are those of the LNS.|
      | login      |  Local login. (There is normally           |
      |            |  no server for that method.)               |
      | none       |  No authentication required.               |
      |            |  (The call was probably vetted             |
      |            |  by the Call Agent.)                       |
      |____________|____________________________________________|
```

필요한 경우 게이트웨이는 공지에 지정된 키를 사용하여 서비스에 액세스할 수 있습니다. 특히 해당 키는 L2TP 터널 설정에 사용될 수 있습니다.

베어러 속성은 베어러 이름과 선택적 확장으로 구성됩니다. 베어러 유형은 변조 유형\(모뎀 이름\)을 지정하거나, 디지털 연결의 경우 ISDN 서비스 유형\(8비트, 7비트\)을 지정합니다. 확장자가 있으면 단일 슬래시\(/\)로 전달자 이름과 구분됩니다. Bearer 속성의 유효한 값은 다음 표에 정의되어 있습니다.

```text
    ____________________________________________________________________
   | Type of bearer description      |  Example of values              |
   |_________________________________|_________________________________|
   | ITU modem standard              |  V.32, V.34, V.90.              |
   | ITU modem standard qualified    |  v.90/3com,                     |
   | by a manufacturer name          |  v.90/rockwell,                 |
   |                                 |  v.90/xxx                       |
   | Well known modem types          |  X2, K56flex                    |
   | ISDN transparent access, 64 kbps|  ISDN64                         |
   | ISDN64 + V.110                  |  ISDN64/V.110                   |
   | ISDN64 + V.120                  |  ISDN64/V.120                   |
   | ISDN transparent access, 56 kbps|  ISDN56                         |
   | Informal identification         |  (Requires coordination between |
   |                                 |  the Call Agent and the gateway)|
   |_________________________________|_________________________________|
```

프레이밍 속성의 유효한 값은 다음 표에 정의되어 있습니다.

```text
             _________________________________________________
            | Type of framing description|  Example of values|
            |____________________________|___________________|
            | PPP, asynchronous framing  |  ppp-asynch       |
            | PPP, HDLC framing          |  ppp-hdlc         |
            | SLIP, asynchronous         |  slip             |
            | Asynchronous, no framing   |  asynch           |
            |____________________________|___________________|
```

네트워크 액세스 인증 매개변수는 데이터 호출에 대해 실행되어야 하는 액세스 제어에 대한 지침을 제공합니다. 이 선택적 속성은 다음과 같이 인코딩됩니다.

```text
        "a=subnet:" <network type> <address type>
           <connection address> "/" <prefix length>
```

여기서 매개변수 "네트워크 유형", "주소 유형" 및 "연결 주소"는 SDP의 연결 주소 매개변수\(c=\)에 대해 정의된 대로 형식화되고 "접두사 길이"는 비트 수의 10진수 표현입니다. 접두사에.

네트워크 액세스 서비스에 대한 SDP 발표의 예는 다음과 같습니다.

```text
         v=0
         m=nas/radius
         c=IN IP4 radius.example.net
         a=bearer:v.34
         a=framing:ppp-asynch
         a=dialed:18001234567
         a=called:12345678901
         a=dialing:12340567890

         v=0
         m=nas/none
         c=IN IP4 128.96.41.1
         a=subnet:IN IP4 123.45.67.64/26
         a=bearer:isdn64
         a=framing:ppp-sync
         a=dialed:18001234567
         a=dialing:2345678901

         v=0
         c=IN IP4 access.example.net
         m=nas/l2tp
         k=clear:some-shared-secret
         a=bearer:v.32
         a=framing:ppp-asynch
         a=dialed:18001234567
         a=dialing:2345678901
```

---
#### **3.5.3.  Usage of SDP for ATM connections**

ATM 연결을 위한 SDP 페이로드 사양은 관련 문서 "Voice over ATM 게이트웨이를 제어하기 위한 MGCP 사용"에 설명되어 있습니다. 다음 텍스트는 이를 나타냅니다.

SDP 페이로드는 다음을 지정합니다.

\* ATM 제품군의 주소, ATM 주소 지정 변형\(NSAP, UNI, E.164\) 및 ATM 주소를 지정하기 위해 SDP의 "c=" 매개변수를 사용하여 ATM 인터페이스를 통해 연결이 설정됩니다.

\* "m=audio" 매개변수는 오디오 인코딩을 지정하고 필요한 경우 VPI 및 VCI를 지정합니다.

\* 추가 속성 매개변수\(a=\)는 적응 계층 유형, 오류 수정 또는 손실 보상 알고리즘과 같은 ATM 코딩 변형을 지정하는 데 사용됩니다.

ATM 연결을 위한 SDP 페이로드의 예는 다음과 같습니다.

```text
         v=0 c=ATM NSAP
         47.0091.8100.0000.0060.3e64.fd01.0060.3e64.fd01.fe m=audio
         5/1002 ATM/AVP PCMU a=connection_type:AAL2
```

---
#### **3.5.4.  Usage of SDP for local connections**

MGCP를 사용하여 단일 게이트웨이 내에서 내부 연결을 설정하는 경우 해당 연결의 매개변수를 인코딩하는 데 SDP 형식이 사용됩니다. 다음 매개변수가 사용됩니다:

\* 연결 매개변수\(C=\)는 네트워크 유형 공간으로 키워드 "LOCAL", 주소 유형으로 키워드 "EPN"\(엔드포인트 이름\), 연결로 엔드포인트 이름을 사용하여 연결이 로컬임을 지정합니다. 주소.

\* "m=audio" 매개변수는 항상 0으로 설정되는 포트 번호, 항상 LOCAL 키워드로 설정되는 프로토콜 유형, RTP\(RTP 페이로드\)에 사용되는 것과 동일한 규칙을 사용하여 인코딩 유형을 지정합니다. 숫자.\) 인코딩 유형은 일반적으로 0\(PCMU\)으로 설정되어야 합니다.

로컬 SDP 페이로드의 예는 다음과 같습니다.

```text
         v=0
         c=LOCAL EPN X35V3+A4/13
         m=audio 0 LOCAL 0
```

---
### **3.6.  Transmission over UDP**

MGCP 메시지는 UDP를 통해 전송됩니다. 명령은 지정된 끝점에 대해 DNS에 정의된 IP 주소 중 하나로 전송됩니다. 응답은 명령의 소스 주소로 다시 전송됩니다.

엔드포인트에 포트가 지정되지 않은 경우 다음 명령을 전송해야 합니다.

\* 통화 에이전트에 의해 게이트웨이용 기본 MGCP 포트인 2427로 연결됩니다.

\* 게이트웨이를 통해 통화 에이전트용 기본 MGCP 포트인 2727로 연결됩니다.

---
#### **3.6.1.  Providing the At-Most-Once functionality**

UDP를 통해 전달되는 MGCP 메시지는 손실될 수 있습니다. 적시에 응답하지 않으면 명령이 반복됩니다. 대부분의 MGCP 명령은 멱등성이 없습니다. 게이트웨이의 상태는 다음과 같습니다.

예를 들어 CreateConnection 명령이 여러 번 실행되면 예측할 수 없습니다. 따라서 전송 절차는 "At-Most-Once" 기능을 제공해야 합니다.

MGCP 엔터티는 최근 트랜잭션에 보낸 응답 목록과 현재 실행 중인 트랜잭션 목록을 메모리에 보관해야 합니다. 들어오는 명령의 트랜잭션 식별자는 최근 응답의 트랜잭션 식별자와 비교됩니다. 일치하는 항목이 발견되면 MGCP 엔터티는 트랜잭션을 실행하지 않고 단순히 응답을 반복합니다. 나머지 명령은 현재 트랜잭션 목록과 비교됩니다. 일치하는 항목이 발견되면 MGCP 엔터티는 트랜잭션을 실행하지 않으며 이는 단순히 무시됩니다.

이 프로시저는 긴 타이머 값\(다음에 LONG-TIMER로 표시됨\)을 사용합니다. 타이머는 최대 반복 횟수, 반복 타이머의 최대값, 네트워크 내 패킷의 최대 전파 지연을 고려하여 트랜잭션의 최대 지속 시간보다 크게 설정해야 합니다. 권장 값은 30초입니다.

응답 사본은 응답이 발행된 후 LONG-TIMER초 후에 파기되거나 게이트웨이\(또는 통화 에이전트\)가 "응답 승인 속성"을 통해 응답이 수신되었다는 확인을 수신할 때 파기될 수 있습니다. 이 속성을 통해 승인된 트랜잭션의 경우 게이트웨이는 네트워크에서 생성될 수 있는 트랜잭션 요청의 중복 복사본을 감지하고 무시하기 위해 응답이 발행된 후 LONG-TIMER 초 동안 트랜잭션 ID의 복사본을 보관해야 합니다. .

---
#### **3.6.2.  Transaction identifiers and three ways handshake**

거래 식별자는 0\~999,999,999 범위의 정수입니다. 통화 상담원은 자신이 관리하는 각 게이트웨이에 대해 특정 번호 공간을 사용하거나 임의의 그룹에 속하는 모든 게이트웨이에 대해 동일한 번호 공간을 사용하기로 결정할 수 있습니다. 통화 상담원은 여러 독립 프로세스 간에 대규모 게이트웨이 관리 부하를 공유하기로 결정할 수 있습니다. 이러한 프로세스는 동일한 트랜잭션 번호 공간을 공유합니다. 거래 식별자를 중앙 집중식으로 할당하거나 서로 다른 프로세스에 식별자의 중복되지 않는 범위를 사전 할당하는 등 이러한 공유에는 여러 가지 가능한 구현이 있습니다. 구현에서는 "상태, 장애 조치 및 경합 조건" 섹션에 정의된 대로 논리적 호출 에이전트에서 발생하는 모든 트랜잭션에 고유한 트랜잭션 식별자가 할당되도록 보장해야 합니다. 게이트웨이는 트랜잭션 식별자만 보고 중복 트랜잭션을 간단히 감지할 수 있습니다.

```text
   The Response Acknowledgement Attribute can be found in any command.
   It carries a set of "confirmed transaction-id ranges."
```

MGCP 게이트웨이는 응답 확인 메시지에서 수신된 "확인된 트랜잭션 ID 범위"에 해당 ID가 포함된 트랜잭션에 대한 응답 복사본을 삭제하도록 선택할 수 있습니다. transaction-id가 이 범위에 속하면 해당 통화 에이전트의 추가 명령을 자동으로 삭제해야 합니다.

"확인된 트랜잭션 ID 범위" 값은 게이트웨이가 해당 호출 에이전트에 대한 마지막 응답을 발행한 이후 LONG-TIMER초 이상이 경과되거나 게이트웨이가 작업을 재개할 때 사용되지 않습니다. 이 상황에서는 transaction-id에 대한 테스트 없이 명령을 수락하고 처리해야 합니다.

"응답 승인 속성"을 포함하는 명령이 무질서하게 전송될 수 있습니다. 게이트웨이는 최근 명령에서 수신된 "확인된 트랜잭션 ID 범위"의 결합을 유지해야 합니다.

---
#### **3.6.3.  Computing retransmission timers**

모든 처리되지 않은 명령에 대해 적절한 시간 초과를 제공하고 시간 초과가 초과된 경우 명령을 재시도하는 것은 요청 엔터티의 책임입니다. 또한 반복된 명령이 승인되지 않는 경우 중복 서비스를 찾거나 기존 또는 보류 중인 연결을 삭제하는 것은 요청 엔터티의 책임입니다.

사양에서는 의도적으로 재전송 타이머 값을 지정하지 않습니다. 이러한 값은 일반적으로 네트워크에 따라 다릅니다. 재전송 타이머는 일반적으로 명령 전송과 응답 반환 사이에 소요되는 시간을 측정하여 타이머를 추정해야 합니다. 한 가지 가능성은 두 가지 변수를 사용하는 TCP-IP에 구현된 알고리즘을 사용하는 것입니다.

\* 관찰된 지연의 지수 평활 평균을 통해 추정된 평균 승인 지연 AAD,

\* 관찰된 지연과 현재 평균 간의 차이의 절대값을 지수 평활 평균하여 추정한 평균 편차 ADEV

TCP의 재전송 타이머는 평균 지연의 합계와 평균 편차의 N배로 설정됩니다. 그러나 MGCP에서는 LONG-TIMER 초 후에 게이트웨이가 반복되는 패킷을 수신하지 않도록 보장하기 위해 타이머의 최대값을 제한해야 합니다. 제안되는 최대값은 4초입니다.

재전송 후 MGCP 엔터티는 다음을 수행해야 합니다.

\* 평균 지연 AAD의 추정값을 두 배로 늘려야 합니다.

\* 0.5 AAD와 AAD 사이에 균일하게 분포된 임의의 값을 계산해야 합니다.

\* 재전송 타이머는 해당 무작위 값과 평균 편차의 N배의 합으로 설정되어야 합니다.

이 절차에는 두 가지 효과가 있습니다. 기하급수적으로 증가하는 구성 요소를 포함하기 때문에 정체가 발생할 경우 메시지 스트림이 자동으로 느려집니다. 임의의 구성 요소가 포함되어 있기 때문에 동일한 외부 이벤트에 의해 트리거된 알림 간의 잠재적인 동기화가 중단됩니다.

---
#### **3.6.4.  Piggy backing**

통화 에이전트가 동일한 게이트웨이에 동시에 여러 메시지를 보내려는 경우가 있습니다. 여러 MGCP 메시지를 동일한 UDP 패킷으로 전송해야 하는 경우 다음 예와 같이 단일 점이 포함된 텍스트 줄로 구분해야 합니다.

```text
         200 2005 OK
         DLCX 1244 card23/21@trgw-7.example.net MGCP 1.0
         C: A3C47F21456789F0
         I: FDE234C8
```

피기백된 메시지는 여러 개의 동시 메시지로 수신된 경우 정확하게 처리되어야 합니다.

---
#### **3.6.5.  Provisional responses**

일부 트랜잭션을 실행하는 데 시간이 오래 걸릴 수 있습니다. 긴 실행 시간은 타이머 기반 재전송 절차와 상호 작용할 수 있습니다. 이로 인해 과도한 재전송 횟수가 발생하거나 타이머 값이 너무 길어져 효율성이 떨어질 수 있습니다.

트랜잭션에 긴 실행 시간이 필요할 것이라고 예측할 수 있는 게이트웨이는 응답 코드 100과 함께 임시 응답을 보낼 수 있습니다. 게이트웨이는 아직 실행 중인 트랜잭션의 반복을 수신하는 경우 이 응답을 보내야 합니다.

임시 응답을 받은 MGCP 엔터티는 해당 거래에 대해 더 긴 반복 타이머로 전환해야 합니다.

---
## **4.  States, failover and race conditions.**

적절한 통화 신호 전달을 구현하기 위해 통화 에이전트는 엔드포인트의 상태를 추적해야 하며 게이트웨이는 이벤트가 통화 에이전트에 적절하게 통보되는지 확인해야 합니다. 게이트웨이 또는 통화 에이전트가 다시 시작될 때 특별한 조건이 존재합니다. "장애 조치" 절차 중에 게이트웨이를 새 통화 에이전트로 리디렉션해야 하며, 통화 에이전트는 게이트웨이가 오프라인이 되거나 다시 시작될 때 특별한 조치를 취해야 합니다.

---
### **4.1.  Basic Asumptions**

"장애 조치" 지원은 다음 가정을 기반으로 합니다.

\* 통화 상담원은 네트워크 주소가 아닌 도메인 이름으로 식별되며 여러 주소가 도메인 이름과 연결될 수 있습니다.

\* 엔드포인트에는 특정 시점에 하나의 NotifiedEntity가 연결되어 있습니다.

\* NotifiedEntity는 이 끝점\(와일드카드 끝점 이름 포함\)에 대해 수신된 "NotifiedEntity" 매개 변수의 마지막 값입니다. 명시적인 "NotifiedEntity" 매개변수가 수신되지 않은 경우 "NotifiedEntity"는 기본적으로 프로비저닝된 NotifiedEntity 값을 사용하거나 엔드포인트에 대해 수신된 마지막 명령의 소스 주소에 값이 프로비저닝되지 않은 경우

\* 명령에 대한 응답은 NotifiedEntity와 관계없이 항상 명령의 소스 주소로 전송됩니다.

\* "통지된 엔터티"가 여러 IP 주소로 확인되는 도메인 이름을 참조하는 경우 엔드포인트는 동일한 논리적 통화 에이전트에서 서로 다른 인터페이스 간에 전환할 수 있지만 다른\(백업\) 통화 에이전트로 전환할 수는 없습니다. 그들 자신. 그러나 백업 통화 에이전트는 직접 또는 간접적으로 전환하도록 지시할 수 있습니다.

\* 전체 통화 에이전트를 사용할 수 없게 되면 해당 통화 에이전트가 관리하는 엔드포인트는 결국 "연결이 끊어집니다". 이러한 엔드포인트를 다시 연결하는 유일한 방법은 실패한 통화 에이전트를 사용할 수 있게 하거나 백업 통화 에이전트가 영향을 받은 엔드포인트에 연결하는 것입니다.

\* 백업 통화 에이전트가 엔드포인트 그룹의 제어권을 인수한 경우 실패한 통화 에이전트는 백업 통화 에이전트와 통신하고 동기화하는 것으로 가정됩니다.

- 영향을 받은 엔드포인트의 제어권을 다시 원래 통화 에이전트로 이전합니다\(원하는 경우 - 실패한 통화 에이전트는 이제 단순히 백업 통화 에이전트가 되어야 할 수도 있습니다\).

별도의 CA 간에는 핸드오버 충돌 해결이 이루어지지 않았다는 점에 유의해야 합니다. CA가 자신이 수행하는 작업을 알고 서로 통신하는 것에 엄격하게 의존하고 있습니다\(AuditEndpoint를 사용하여 현재 NotifiedEntity에 대해 알아볼 수 있음\).

---
### **4.2.  Security, Retransmission, and Detection of Lost Associations:**

미디어 게이트웨이 제어 프로토콜은 일련의 트랜잭션으로 구성되며, 각 트랜잭션은 일반적으로 승인이라고 하는 명령과 응답으로 구성됩니다. UDP를 통해 전달되는 MGCP 메시지는 손실될 수 있습니다. 적시에 응답하지 않으면 명령이 반복됩니다. MGCP 엔터티는 최근 트랜잭션에 보낸 응답 목록, 즉 지난 LONG-TIMER 초 동안 보낸 모든 응답 목록과 현재 실행 중인 트랜잭션 목록을 메모리에 보관해야 합니다.

들어오는 명령의 트랜잭션 식별자는 최근 응답의 트랜잭션 식별자와 비교됩니다. 일치하는 항목이 발견되면 MGCP 엔터티는 트랜잭션을 실행하지 않고 단순히 응답을 반복합니다. 나머지 명령은 현재 트랜잭션 목록과 비교됩니다. 일치하는 항목이 발견되면 MGCP 엔터티는 트랜잭션을 실행하지 않으며 이는 단순히 무시됩니다. 명령 실행이 완료되면 응답이 제공됩니다.

반복 메커니즘은 네 가지 유형의 가능한 오류를 방지하는 데 사용됩니다.

\* 전송 오류\(예: 회선의 잡음이나 대기열의 혼잡으로 인해 패킷이 손실된 경우\)

\* 구성 요소 오류, 예를 들어 통화 에이전트에 대한 인터페이스를 사용할 수 없게 되는 경우

\* 통화 에이전트 실패\(예: 전체 통화 에이전트를 사용할 수 없는 경우\)

\* 장애 조치\(failover\), 새 통화 에이전트가 투명하게 "인계"되는 경우입니다.

요소는 과거 이력으로부터 전송 오류로 인한 패킷 손실률 추정치를 도출할 수 있어야 합니다. 적절하게 구성된 시스템에서 이 손실률은 일반적으로 1% 미만으로 매우 낮게 유지되어야 합니다. 통화 에이전트나 게이트웨이가 메시지를 여러 번 반복해야 하는 경우 다음과 같이 가정하는 것이 매우 타당합니다.

전송 오류가 아닌 다른 문제가 발생하고 있습니다. 예를 들어, 손실률이 1%인 경우 5번의 연속 전송 시도가 실패할 확률은 1,000억분의 1입니다. 이는 초당 1,000개의 트랜잭션을 처리하는 호출 에이전트의 경우 10일에 한 번 미만으로 발생해야 하는 이벤트입니다. \(실제로 과도한 것으로 간주되는 반복 횟수는 일반적인 패킷 손실률의 함수여야 합니다.\) "Max1"이라고 부르는 "의심 임계값"은 일반적으로 "연결 해제 임계값"보다 낮습니다. , 더 큰 값으로 설정해야 합니다.

```text
      Command issued: N=0
              |
       transmission: N++
              |  +------------ retransmission: N++ -----------+
              |  |                                            |
              |  |       transmission                         |
              |  |  +---to new address -+<--------------------|--+
              |  |  |        N=0        |                     |  |
              V  V  V                   |                     |  |
        +-----------+                   |                     |  |
        | awaiting  |- new call agent ->+  +------------+     |  |
        |  response |--- timer elapsed --->| N > Max1 ? |-(no)+  |
        +-----------+ <----------+         +------------+     ^  |
              |   |              |               |            |  |
              |   +- wrong key? -+             (yes)          |  |
              |                                  |            |  |
      response received                    (if N=Max1,        |  |
              |                             or N=Max2         |  |
              |                             check DNS)        |  |
              v                                  |            |  |
            (end)                       +---------------+     |  |
                                        |more addresses?|(yes)|--+
                                        +---------------+     |
                                                 |            |
                                               (no)           |
                                                 |            |
                                           +------------+     |
                                           | N > Max2 ? |(no)-+
                                           +------------+
                                                 |
                                               (yes)
                                                 |
                                                 v
                                          (disconnected)
```

전통적인 재전송 알고리즘은 단순히 연속적인 반복 횟수를 세고, 패킷을 너무 많이 재전송한 후에 연결이 끊어졌다는 결론을 내립니다.

\(일반적으로 7\~11회\) 감지되지 않거나 진행 중인 "장애 조치"의 가능성을 설명하기 위해 다음과 같이 클래식 알고리즘을 수정합니다.

\* 게이트웨이는 항상 새로운 통화 에이전트가 있는지 확인하도록 요청합니다. 다음 중 하나를 통해 알 수 있습니다.

- - 장애 조치를 알리는 유효한 멀티캐스트 메시지를 수신하거나

- - NotifiedEntity가 새 통화 에이전트를 가리키는 명령을 수신하거나

- - 새 통화 에이전트를 가리키는 리디렉션 응답을 받습니다.

- 새 통화 에이전트가 감지되면 게이트웨이는 해당 새 에이전트에 처리되지 않은 명령을 전송하기 시작합니다. 명령에 대한 응답은 여전히 ​​명령의 소스 주소로 전송됩니다.

\* 이 호출 에이전트의 반복 횟수가 "Max1"보다 큰 경우 호출 에이전트 인터페이스의 가능한 변경을 감지하기 위해 게이트웨이가 네임 서버에 적극적으로 쿼리하도록 요청합니다.

\* 게이트웨이는 통화 에이전트에 대해 여러 IP 주소를 학습했을 수 있습니다. 반복 횟수가 "Max1"보다 크고 "Max2"보다 작고 시도되지 않은 인터페이스가 더 많은 경우 게이트웨이는 재전송을 대체 주소로 보내야 합니다.

\* 더 이상 시도할 인터페이스가 없고,

- 반복 횟수는 Max2입니다. 그런 다음 게이트웨이는 DNS에 한 번 더 접속하여 다른 인터페이스를 사용할 수 있어야 하는지 확인합니다. 그렇지 않은 경우 이제 게이트웨이 연결이 끊어집니다.

이 절차를 수행하면 진행 중인 장애 조치를 감지할 가능성이 최대화됩니다. 실제로 두 가지 매우 구체적인 문제, 즉 타이머 기반 절차의 잠재적인 긴 지연과 암호화 보호 사용으로 인한 혼란의 위험이 있습니다.

네트워크 부하에 자동으로 적응하기 위해 MGCP는 기하급수적으로 증가하는 타이머를 지정합니다. 초기 타이머가 200밀리초로 설정된 경우 다섯 번째 재전송 손실은 약 6초 후에 감지됩니다. 이는 아마도 장애 조치를 감지하기 위해 허용되는 대기 지연일 것입니다. 일시적인 연결 문제를 극복할 뿐만 아니라 장애 조치 실행에 더 많은 시간을 허용하기 위해 해당 지연 후에도 반복을 계속해야 합니다. 총 30초의 지연을 기다리는 것이 허용될 수 있습니다.

그러나 재전송의 최대 지연을 제한하는 것이 중요합니다. 재전송에 앞서 초기 데이터그램 전송 이후 경과된 시간이 T-MAX보다 크지 않은지 확인됩니다. T-MAX 시간 이상이 경과되면 엔드포인트의 연결이 끊어집니다. T-MAX 값은 LONG-TIMER 값과 관련됩니다. LONG-TIMER 값은 T-MAX에 네트워크의 최대 전파 지연을 추가하여 얻습니다.

연결 실패의 또 다른 잠재적인 원인은 명령을 인증할 수 없는 호출 에이전트가 보낸 "잘못된 키" 메시지를 수신하는 것입니다. 아마도 연관의 보안 매개변수가 손실되었기 때문일 것입니다. 이러한 메시지는 실제로 IPSEC에서 승인되지 않으며 액면 그대로 받아들여서는 안 됩니다. 공격자는 제어 연결 손실을 촉발하기 위해 "잘못된 키" 메시지를 쉽게 위조할 수 있습니다. 현재 알고리즘은 이러한 메시지를 무시하므로 타이머에 대한 엄격한 의존도로 해석됩니다. 실제로 알고리즘은 "Max1" 반복 후 통화 에이전트의 키 서버로 검사를 실행하여 개선될 수 있습니다.

---
### **4.3.  Race conditions**

MGCP는 "격리 목록"이라는 개념과 명시적인 비동기화 감지를 통해 경쟁 조건을 처리합니다.

MGCP는 전송 메커니즘이 명령과 응답의 순서를 유지할 것이라고 가정하지 않습니다. 이는 호출 에이전트의 적절한 동작을 통해 방지할 수 있는 경쟁 조건을 유발할 수 있습니다. \(일부 경쟁 조건은 분산 시스템에 내재되어 있으며 명령이 엄격한 순서로 전송되더라도 여전히 발생합니다.\)

경우에 따라 많은 게이트웨이가 동시에 작업을 다시 시작하기로 결정할 수도 있습니다. 예를 들어, 지진이나 얼음 폭풍으로 인해 특정 지역에서 전력이나 송전 능력이 손실되는 경우 이러한 상황이 발생할 수 있습니다. 전원과 전송이 다시 설정되면 많은 게이트웨이가 "RestartInProgress" 명령을 동시에 전송하기로 결정하여 작동이 매우 불안정해질 수 있습니다.

---
#### **4.3.1.  Quarantine list**

MGCP 제어 게이트웨이는 "이벤트" 목록을 감시하도록 요청하는 "알림 요청"을 수신합니다. 이러한 이벤트 처리를 결정하는 프로토콜 요소는 "요청된 이벤트" 목록, "숫자 지도" 및 "이벤트 감지" 목록입니다.

엔드포인트가 초기화되면 요청된 이벤트 목록과 숫자 맵이 비어 있습니다. 명령을 수신한 후 게이트웨이는 목록에 언급된 이벤트가 발생하는지 엔드포인트를 관찰하기 시작합니다.

```text
   The events are examined as they occur. The action that follows is
   determined by the "action" parameter associated to the event in the
   list of requested events, and also by the digit map.  The events that
   are defined as "accumulate" or "treat according to digit map" are
   accumulated in a list of events, the events that are marked as
   "treated according to the digit map" will additionally be accumulated
   in the dialed string. This will go on until one event is encountered
   that triggers a Notification to the "notified entity."
```

이 시점에서 게이트웨이는 알림 명령을 전송하고 엔드포인트를 "알림" 상태로 설정합니다. 엔드포인트가 이 알림 상태에 있는 한 엔드포인트에서 검색될 이벤트는 나중에 처리할 수 있도록 "격리" 버퍼에 저장됩니다. 이벤트는 어떤 의미에서 "격리"됩니다. RequestedEvents 매개변수와 가장 최근에 수신된 DetectEvent 매개변수의 결합으로 지정된 모든 이벤트 또는 후자가 없는 경우 RequestedEvents에서 참조되는 모든 이벤트는 연관된 작업에 관계없이 감지되고 격리되어야 합니다. 이벤트.

Notify 명령에 대한 승인이 수신되면 끝점은 "알림 상태"를 종료합니다. Notify 명령은 섹션 3.5에 지정된 대로 "알림 상태"에서 재전송될 수 있습니다. 엔드포인트가 "알림 상태"를 종료하면 관찰된 이벤트 목록과 엔드포인트의 "현재 다이얼 문자열"이 null 값으로 재설정됩니다.

해당 시점 이후 게이트웨이의 동작은 알림 요청의 QuarantineHandling 매개 변수 값에 따라 달라집니다. 통화 에이전트가 알림 요청 명령에 대한 응답으로 최대 하나의 알림을 예상한다고 지정한 경우 게이트웨이는 다음 알림 요청 명령을 받을 때까지 격리 목록에 이벤트를 계속 누적해야 합니다.

게이트웨이가 여러 개의 연속적인 알림 명령을 보낼 권한이 있는 경우 다음과 같이 진행됩니다. 게이트웨이가 "알림 상태"를 종료하면 관찰된 이벤트 목록과 엔드포인트의 "현재 다이얼 문자열"을 null 값으로 재설정하고 이미 수신된 요청 이벤트 목록과 숫자를 사용하여 격리된 이벤트 목록 처리를 시작합니다. 지도. 이러한 이벤트를 처리할 때,

게이트웨이에서 알림 명령을 보내야 하는 이벤트가 발생할 수 있습니다. 이 경우 게이트웨이는 다음 두 가지 동작 중 하나를 채택할 수 있습니다.

\* 트리거 이벤트까지 관찰된 이벤트 목록에 누적된 모든 이벤트를 포함하여 보고하는 Notify 명령을 즉시 전송할 수 있으며, 처리되지 않은 이벤트는 격리 목록에 남겨두고,

\* 또는 격리된 목록을 비우고 여러 이벤트 세트와 여러 다이얼 문자열을 보고하는 단일 알림 명령을 전송하려고 시도할 수 있습니다. 다이얼 문자열은 각 트리거 이벤트 후에 null 값으로 재설정됩니다. 마지막 트리거 이벤트 이후의 이벤트는 격리 목록에 남습니다.

게이트웨이가 알림 명령을 전송하면 끝점은 승인이 수신될 때까지 "알림 상태"로 유지됩니다. 게이트웨이가 알림 명령을 요청하는 격리된 이벤트를 찾지 못하면 끝점을 정상 상태로 설정합니다. 그런 다음 알림 요청 명령이 방금 수신된 것과 똑같은 방식으로 이벤트가 발생하면 처리됩니다.

게이트웨이는 엔드포인트에 대한 새로운 알림 요청 명령을 언제든지 수신할 수 있습니다. 알림 상태에서 새 알림 요청이 수신되면 게이트웨이는 새 알림 요청에 대한 성공적인 응답 전에 호출 에이전트가 보류 중인 알림을 수신했는지 확인해야 합니다. 이는 프로토콜의 "피기백\(piggy-backing\)" 기능을 사용하여 수행됩니다. 그런 다음 메시지는 이전 명령과 새 명령에 대한 소스 및 "알림 엔터티"에 관계없이 단일 패킷으로 새 알림 요청의 소스로 전송됩니다. 관련된 단계는 다음과 같습니다.

a\) 게이트웨이는 보류 중인 이전 알림 명령의 반복과 새 알림 요청에 대한 승인을 단일 패킷으로 전달하는 메시지를 작성합니다.

b\) 그러면 엔드포인트는 알림 명령의 승인을 기다리지 않고 "알림 상태"에서 벗어납니다.

c\) 승인되지 않은 알림 명령 명령의 복사본은 승인이 수신될 때까지 보관됩니다. 타이머가 경과하면 알림 요청 승인이 반복적으로 전달되는 패킷에서 알림이 반복됩니다.

d\) 승인이 손실되면 통화 에이전트는 알림 요청을 다시 전송합니다. 게이트웨이는 확인되지 않은 알림과 알림 요청 확인을 단일 패킷으로 재전송하여 이러한 반복에 응답합니다.

e\) 게이트웨이가 이전 알림이 확인되기 전에 알림을 전송해야 하는 경우 이전 알림의 반복, 마지막 알림 요청의 확인 반복 및 새 알림을 피기백하는 패킷을 구성해야 합니다.

f\) 동일한 메시지에서 여러 패킷을 피기백할 수 없는 게이트웨이는 마지막 알림이 승인되지 않는 한 엔드포인트를 "알림" 상태로 두도록 선택해야 합니다.

알림 요청 명령을 받은 후 요청된 이벤트 목록 및 숫자 맵\(새 항목이 제공된 경우\)은 새로 수신된 매개변수로 대체되고 관찰된 이벤트 목록 및 누적 다이얼 문자열은 null 값으로 재설정됩니다. 동작은 QuarantineHandling 매개 변수의 값에 따라 결정됩니다. 매개변수는 격리된 이벤트 또는 이전에 관찰된 이벤트를 삭제하도록 지정할 수 있으며, 이 경우 삭제됩니다. 매개변수가 격리된 이벤트를 처리해야 한다고 지정하는 경우 게이트웨이는 새로 수신된 요청 이벤트 목록 및 숫자 맵을 사용하여 격리된 이벤트 목록 또는 이전에 관찰된 이벤트 처리를 시작합니다. 이러한 이벤트를 처리할 때 게이트웨이에서 알림 명령을 보내야 하는 이벤트가 발생할 수 있습니다. 이 경우 게이트웨이는 트리거 이벤트까지 관찰된 이벤트 목록에 누적된 모든 이벤트를 보고하는 Notify 명령을 즉시 전송하고 처리되지 않은 이벤트는 격리 버퍼에 남겨두고 "알림"을 입력합니다. 상태".

게이트웨이가 이전 알림 요청에 따라 이벤트를 누적했지만 아직 알림을 트리거하는 이벤트를 감지하지 못한 경우 새로운 알림 요청이 수신될 수 있습니다. 아직 통보되지 않은 이벤트의 처리는 격리된 이벤트와 마찬가지로 격리 처리 매개변수에 따라 결정됩니다.

\* 격리 처리 매개변수에 격리된 이벤트를 무시하도록 지정하면 관찰된 이벤트 목록이 재설정됩니다.

\* 격리 처리 매개 변수에 격리된 이벤트를 처리하도록 지정하면 관찰된 이벤트 목록이 격리된 이벤트 목록으로 전송됩니다. 그러면 관찰된 이벤트 목록이 재설정되고 격리된 이벤트 목록이 처리됩니다.

호출 에이전트는 피기백\(piggy-backing\) 메커니즘을 사용하여 동일한 데이터그램에서 성공적인 알림 메시지와 새 알림 요청에 대한 응답을 제공해야 합니다\(SHOULD\).\(SHOULD\)

---
#### **4.3.2.  Explicit detection**

여러 엔드포인트 상태의 핵심 요소는 후크의 위치입니다. 통화 에이전트가 게이트웨이에 오프 후크 이벤트\(전화 통신에서 잘 알려진 "눈부심" 조건\)를 알리도록 요청할 시간을 갖기 전에 사용자가 오프 후크 상태로 전환하기로 결정하거나 사용자가 온 후크 상태로 전환하는 경우 경쟁 조건이 발생할 수 있습니다. 통화 에이전트가 이벤트 알림을 요청할 시간을 갖기 전에 후크를 연결합니다.

이러한 경합 상태를 방지하려면 게이트웨이는 알림 요청을 승인하기 전에 엔드포인트의 상태를 확인해야 합니다. 오류가 반환되어야 합니다.

1- 전화기가 이미 오프훅 상태인 동안 게이트웨이가 "오프훅" 전환을 알리도록 요청받은 경우,

2- 전화기가 이미 연결되어 있는 동안 게이트웨이가 "온 후크" 또는 "플래시 후크" 상태를 알리도록 요청받은 경우.

조건 확인은 알림 요청이 수신될 때 수행되며, 현재 조건을 발생시킨 실제 이벤트가 이전에 보고되었거나 무시되었거나 현재 격리될 수 있다는 점에 유의해야 합니다.

RequestedEvent 목록 또는 요청된 신호 목록과 같은 게이트웨이의 다른 상태 변수는 각 성공적인 알림 요청 후에 완전히 대체되므로 통화 에이전트와 게이트웨이 간의 장기적인 불일치가 방지됩니다.

알림 요청이 실패하면 연결 처리 명령에 포함되어 있는지 여부에 관계없이 게이트웨이는 명령이 수신되지 않은 것처럼 계속 진행됩니다. 다른 모든 트랜잭션과 마찬가지로,NotificationRequest는 원자성 트랜잭션으로 작동해야 하므로 명령의 결과로 시작된 모든 변경 사항은 되돌려져야 합니다.

게이트웨이가 GatewayRequest를 수신하기 직전에 Notify가 발행되면 또 다른 경쟁 조건이 발생할 수 있습니다. RequestIdentifier는 Notify 명령을 NotifyRequest 명령과 연관시키는 데 사용됩니다.

---
#### **4.3.3.  Ordering of commands, and treatment of disorder**

MGCP는 기본 전송 프로토콜이 게이트웨이나 엔드포인트로 전송되는 명령의 순서를 보장하도록 요구하지 않습니다. 이 속성은 작업의 적시성을 극대화하는 경향이 있지만 몇 가지 단점이 있습니다. 예를 들어:

\* 알림 명령은 새로운 알림 요청 명령 전송 후 지연되어 통화 에이전트에 도착할 수 있으며,

\* 이전 알림이 승인되기 전에 새 알림 요청이 전송되는 경우 이전 알림이 두 번째 위치에서 수신되지 않을 것이라는 보장은 없습니다.

엔드포인트의 일관된 작동을 보장하려는 통화 상담원은 다음 규칙을 사용할 수 있습니다.

1\) 게이트웨이가 여러 엔드포인트를 처리하는 경우 서로 다른 엔드포인트에 관련된 명령이 병렬로 전송될 수 있습니다. 예를 들어 각 엔드포인트가 자체 프로세스 또는 자체 스레드에 의해 제어되는 모델을 따르면 됩니다.

2\) 동일한 엔드포인트에 여러 개의 연결이 생성되면 서로 다른 연결에 관련된 명령을 병렬로 보낼 수 있습니다.

3\) 주어진 연결에는 일반적으로 하나만 있어야 합니다.

- 뛰어난 명령\(생성 또는 수정\). 그러나 언제든지 DeleteConnection 명령을 실행할 수 있습니다. 결과적으로 게이트웨이는 이전에 삭제된 연결에 적용되는 ModifyConnection 명령을 수신할 수도 있습니다. 이러한 명령은 무시되어야 하며 오류 코드가 반환되어야 합니다.

4\) 특정 엔드포인트에는 일반적으로 언제든지 미해결 알림 요청 명령이 하나만 있어야 합니다. RequestId 매개변수는 알림 명령을 트리거하는 알림 요청과 연관시키는 데 사용되어야 합니다.

5\) 어떤 경우에는 암시적 또는 명시적으로 와일드카드가 사용됩니다.

- 끝점 그룹에 적용되는 DeleteConnection 명령은 보류 중인 CreateConnection 명령보다 먼저 진행될 수 있습니다. 통화 에이전트는 전역 DeleteConnection 명령 시 완료가 보류 중인 모든 연결을 개별적으로 삭제해야 합니다. 또한 와일드카드로 명명된 끝점에 대한 새 CreateConnection 명령은 와일드카드 DeleteConnection 명령이 승인될 때까지 보낼 수 없습니다.

6\) 명령어들이 서로 내장되어 있을 때, 시퀀싱

- 모든 명령에 대한 요구 사항을 준수해야 합니다. 예를 들어 알림 요청이 포함된 연결 만들기 명령은 동시에 CreateConnection 및 알림 요청의 순서를 따라야 합니다.

7\) AuditEndpoint 및 AuditConnection은 어떠한 영향도 받지 않습니다.

- 순서.

8\) RestartInProgress는 항상 재시작 절차에 정의된 대로 엔드포인트가 보낸 첫 번째 명령이어야 합니다. 다른 명령이나 응답은 이 RestartInProgress 명령 이후에 전달되어야 합니다\(피기백 허용\).

9\) 여러 개의 메시지가 하나의 패킷에 피기백되는 경우, 메시지는 항상 순서대로 처리됩니다.

이러한 규칙은 항상 명령에 응답해야 하는 게이트웨이에 영향을 주지 않습니다.

---
#### **4.3.4.  Fighting the restart avalanche**

다수의 게이트웨이에 동시에 전원이 공급된다고 가정해 보겠습니다. RestartInProgress 트랜잭션을 모두 시작한다면 통화 에이전트가 혼잡해져서 서비스 복원의 중요한 기간 동안 메시지 손실과 네트워크 정체가 발생할 가능성이 높습니다. 이러한 사태를 방지하기 위해 다음과 같은 행동이 제안됩니다.

1\) 게이트웨이의 전원이 켜지면 0과 최대 대기 지연\(MWD\) 사이에 균일하게 분포된 임의 값으로 재시작 타이머를 시작해야 합니다. 동일한 알고리즘을 사용하는 여러 게이트웨이 간의 난수 생성이 동시에 발생하지 않도록 주의해야 합니다.

2\) 그런 다음 게이트웨이는 이 타이머가 끝나거나 통화 에이전트로부터 명령이 수신되거나 가정용 게이트웨이의 오프훅 전환과 같은 로컬 사용자 활동이 감지될 때까지 기다려야 합니다.

3\) 타이머가 경과하거나 명령이 수신되거나 활동이 감지되면 게이트웨이는 재시작 절차를 시작해야 합니다.

다시 시작 절차에서는 호출 에이전트가 이 끝점에서 보는 첫 번째 메시지\(명령 또는 응답\)가 호출 에이전트에 다시 시작을 알리는 RestartInProgress 메시지임을 보장하기 위해 끝점이 필요합니다. 엔드포인트는 이를 달성하기 위해 피기백\(piggy-backing\)을 최대한 활용할 수 있습니다.

게이트웨이의 각 엔드포인트에는 초기 재시작 메시지를 전달하기 위해 프로비저닝 가능한 통화 에이전트, 즉 "알림 엔터티"가 있을 것으로 예상됩니다. 게이트웨이의 엔드포인트 컬렉션이 둘 이상의 통화 에이전트에 의해 관리되는 경우 지정된 통화 에이전트가 관리하는 각 엔드포인트 컬렉션에 대해 위 절차를 수행해야 합니다. 게이트웨이는 게이트웨이의 여러 엔드포인트가 다시 시작되고 해당 엔드포인트가 동일한 호출 에이전트에 의해 관리될 때 생성되는 RestartInProgress 메시지 수를 최소화하기 위해 와일드카드를 최대한 활용해야 합니다.\(MUST\)

MWD 값은 게이트웨이 유형에 따라 달라지는 구성 매개변수입니다. 다음 추론을 사용하여 주거용 게이트웨이의 지연 값을 결정할 수 있습니다.

통화 상담원은 일반적으로 피크 시간 트래픽 부하를 처리하도록 구성되며, 이 기간 동안 평균 10%의 회선이 통화 중이며 평균 지속 시간은 일반적으로 3분입니다. 통화 처리에는 일반적으로 각 종단점과 통화 에이전트 사이에 5\~6개의 MGCP 트랜잭션이 포함됩니다. 이 간단한 계산은 통화 에이전트가 평균 30분마다 각 엔드포인트에 대해 5\~6개의 트랜잭션을 처리하거나, 다르게 말하면 평균 5\~6분마다 엔드포인트당 약 1개의 트랜잭션을 처리할 것으로 예상된다는 것을 보여줍니다. 이는 주거용 게이트웨이에 대한 합리적인 MWD 값이 10\~12분임을 시사합니다. 명시적인 구성이 없는 경우 주거용 게이트웨이는 MWD에 대해 600초 값을 채택해야 합니다.

동일한 추론에 따르면 트렁킹 게이트웨이나 비즈니스 게이트웨이의 경우 MWD의 값이 훨씬 짧아야 합니다. 이는 이들이 많은 수의 엔드포인트를 처리하고 또한 이러한 엔드포인트의 사용률이 피크 최번시 동안 10%보다 훨씬 높기 때문입니다. , 일반적인 값은 60%입니다. 피크 시간 동안 이러한 엔드포인트는 통화 에이전트 로드에 분당 약 1개의 트랜잭션을 기여할 것으로 예상됩니다. 합리적인 알고리즘은 "트렁크" 엔드포인트당 MWD 값을 주거용 게이트웨이당 MWD보다 6배 짧게 만들고 다시 시작되는 엔드포인트 수에 반비례하도록 만드는 것입니다. 예를 들어 T1 회선을 처리하는 게이트웨이의 경우 MWD를 2.5초로 설정해야 하고, T3 회선을 처리하는 게이트웨이의 경우 60밀리초로 설정해야 합니다.

---
#### **4.3.5.  Disconnected Endpoints**

다시 시작 절차 외에도 게이트웨이에는 섹션 3.4.2에 설명된 대로 엔드포인트가 "연결 해제"될 때 시작되는 "연결 해제" 절차도 있습니다. 엔드포인트는 통화 에이전트와 통신을 시도할 때만 연결이 끊어질 수 있다는 점에 유의해야 합니다. 다음 단계 뒤에는 "연결이 끊어진" 엔드포인트가 이어집니다.

1. "연결 끊김" 타이머는 0과 프로비저닝 가능한 "연결 끊김" 초기 대기 지연\(Tdinit\)\(예: 15초\) 사이에 균일하게 분포된 임의의 값으로 초기화됩니다. 동일한 알고리즘을 사용하는 여러 게이트웨이와 엔드포인트 간의 난수 생성이 동기화되지 않도록 주의해야 합니다.\(MUST\)

2. 그러면 게이트웨이는 이 타이머가 끝나거나 통화 에이전트로부터 명령이 수신되거나 엔드포인트에 대한 로컬 사용자 활동\(예: 오프후크 전환\)이 감지될 때까지 기다립니다.

3. "연결 끊김" 타이머가 경과하거나 명령이 수신되거나 로컬 사용자 활동이 감지되면 게이트웨이는 엔드포인트에 대해 "연결 끊김" 절차를 시작합니다. 로컬 사용자 활동의 경우 프로시저 속도를 제한하려면 게이트웨이가 연결 해제되었거나 마지막으로 "연결 해제" 절차를 시작한 이후 프로비저닝 가능한 "연결 해제된" 최소 대기 지연\(Tdmin\)이 경과되어야 합니다. 수행.

4. "연결 끊김" 프로시저가 여전히 엔드포인트를 벗어나는 경우

- 연결이 끊어지면 "연결이 끊긴" 타이머가 두 배로 늘어나고, 프로비저닝 가능한 "연결이 끊긴" 최대 대기 지연\(Tdmax\)\(예: 600초\)에 따라 게이트웨이가 2단계를 다시 진행합니다.

"연결 끊김" 절차는 이제 끝점이 연결이 끊어졌음을 알리는 RestartInProgress 명령을 호출 에이전트에 보내야 하고 더 나아가 첫 번째 메시지\(명령 또는 응답\)가 연결 해제되었음을 보장해야 한다는 점에서 다시 시작 절차와 유사합니다. 이제 통화 에이전트는 이 끝점에서 이 RestartInProgress 명령을 확인해야 합니다. 엔드포인트는 이를 달성하기 위해 피기백\(piggy-backing\)을 최대한 활용해야 합니다. 예를 들어 통화 에이전트는 끝점을 감사하기로 결정하거나 단순히 끝점에 대한 모든 연결을 삭제할 수 있습니다.\(MUST, MUST\)

이 사양은 의도적으로 연결이 끊긴 끝점에 대한 추가 동작을 지정하지 않습니다. 예를 들어 공급업체는 무음 제공, 재주문 신호음 재생, 다운로드한 wav 파일 재생 활성화 등을 선택할 수 있습니다.\(MAY\)

Tdinit의 기본값은 15초, Tdmin의 기본값은 15초, Tdmax의 기본값은 600초입니다.

---
## **5.  Security requirements**

승인되지 않은 개체가 MGCP를 사용할 수 있는 경우 승인되지 않은 통화를 설정하거나 승인된 통화를 방해할 수 있습니다. 우리는 MGCP 메시지가 RFC 2402에 정의된 IP 인증 헤더 또는 RFC 2406에 정의된 IP 캡슐화 보안 페이로드를 사용하여 RFC 2401에 정의된 IP 보안 아키텍처에 정의된 대로 보안 인터넷 연결을 통해 항상 전달될 것으로 기대합니다. 따라서 전체 MGCP 프로토콜 스택에는 다음 계층이 포함됩니다.

```text
                ________________________________
               |              MGCP             |
               |_______________________________|
               |              UDP              |
               |_______________________________|
               |          IP security          |
               | (authentication or encryption)|
               |_______________________________|
               |              IP               |
               |_______________________________|
               |       transmission media      |
               |_______________________________|
```

게이트웨이와 통화 에이전트가 IP 보안이 인증 서비스를 제공한 메시지만 수락하는 경우 연결이 적절하게 보호됩니다. 암호화 서비스는 도청에 대한 추가 보호를 제공하므로 제3자가 특정 엔드포인트에서 설정된 연결을 모니터링하는 것을 금지합니다.

SDP에 정의된 대로 세션 설명을 사용하여 세션 키를 전달하는 경우에도 암호화 서비스가 요청됩니다.

이러한 절차는 오작동하는 게이트웨이나 오작동하는 통화 에이전트에 의한 서비스 거부 공격으로부터 반드시 보호하지는 않습니다. 그러나 이러한 오작동하는 엔터티에 대한 식별 정보를 제공하며 유지 관리 절차를 통해 해당 엔터티의 승인을 박탈해야 합니다.

---
### **5.1.  Protection of media connections**

MGCP를 사용하면 통화 에이전트가 오디오 메시지를 암호화하는 데 사용할 수 있는 "세션 키"를 게이트웨이에 제공하여 도청을 방지할 수 있습니다.

패킷 네트워크의 특정 문제는 "통제되지 않은 참여"입니다. 이 공격은 미디어 패킷을 연결에 사용되는 IP 주소와 UDP 포트로 전달하여 수행될 수 있습니다. 보호 기능이 구현되지 않으면 패킷의 압축이 풀리고 신호가 "라인 측"에서 재생됩니다.

이 공격에 대한 기본 보호는 알려진 소스의 패킷만 수락하는 것입니다. 예를 들어 IP 소스 주소와 UDP 소스 포트가 "원격 세션 설명"에 발표된 값과 일치하는지 확인합니다. 그러나 여기에는 두 가지 불편한 점이 있습니다. 연결 설정 속도가 느려지고 소스 스푸핑에 속을 수 있다는 것입니다.

\* 주소 기반 보호를 활성화하려면 통화 에이전트가 e-gress 게이트웨이의 원격 세션 설명을 가져와 이를 in-gress 게이트웨이에 전달해야 합니다. 이를 위해서는 최소한 한 번의 네트워크 왕복이 필요하며 딜레마에 빠지게 됩니다. 왕복이 완료될 때까지 기다리지 않고 통화가 진행되도록 허용하거나 원격 알림을 "클리핑"하는 등의 위험이 있거나 전체 왕복을 기다리고 느린 통화 설정 절차에 만족하십시오.

\* 소스 스푸핑은 공격자가 트래픽의 일부를 수신하여 유효한 소스 대상 주소 및 포트 쌍을 얻을 수 있는 경우에만 효과적입니다. 소스 스푸핑에 맞서기 위해 네트워크에 대한 모든 액세스 포인트를 제어할 수 있습니다. 그러나 이는 실제로 달성하기가 매우 어렵습니다.

소스 주소를 확인하는 대신 통화 설정 절차 중에 전달되는 비밀 키를 사용하여 패킷을 암호화하고 인증하는 것입니다. 이렇게 하면 통화 설정 속도가 느려지지 않으며 주소 스푸핑에 대한 강력한 보호 기능을 제공합니다.

---
## **6.  Event packages and end point types**

이 섹션에서는 패키지 및 이벤트 이름의 초기 정의를 제공합니다. 추가 문서에서 더 많은 패키지를 정의할 수 있습니다.

---
### **6.1.  Basic packages**

기본 패키지 목록에는 다음이 포함됩니다.

```text
                _________________________________________
               | Package                      |   name  |
               |______________________________|_________|
               | Generic Media Package        |   G     |
               | DTMF package                 |   D     |
               | MF Package                   |   M     |
               | Trunk Package                |   T     |
               | Line Package                 |   L     |
               | Handset Package              |   H     |
               | RTP Package                  |   R     |
               | Network Access Server Package|   N     |
               | Announcement Server Package  |   A     |
               | Script Package               |   Script|
               |______________________________|_________|
```

각 패키지의 이벤트 표에는 5개의 열이 있습니다.

기호: 이벤트에 사용되는 고유 기호

- 정의: 이벤트에 대한 간단한 설명

- R: 이 열에 x가 나타나는 것은 통화 상담원이 요청할 수 있는 이벤트입니다.

- S: 이벤트에 대해 이 열에 아무것도 나타나지 않으면 통화 에이전트의 명령에 따라 이벤트에 신호를 보낼 수 없습니다. 그렇지 않은 경우 다음 기호는 이벤트 유형을 식별합니다.

- OO On/Off 신호. 신호는 통화 상담원이 끄라고 명령할 때까지 켜져 있으며 그 반대의 경우도 마찬가지입니다.

- TO 타임아웃 신호. 신호는 새로운 신호로 대체되지 않는 한 주어진 기간 동안 지속됩니다.

- BR 간략한 신호. 이벤트 기간은 짧고 알려져 있습니다.

- 기간: TO 신호의 기간을 지정합니다.

---
#### **6.1.1.  Generic Media Package**

```text
   Package Name: G
```

일반 미디어 패키지는 트렁킹 게이트웨이, 액세스 게이트웨이 또는 주거용 게이트웨이와 같은 여러 유형의 엔드포인트에서 관찰할 수 있는 이벤트 및 신호를 그룹화합니다.

```text
  _____________________________________________________________________
 | Symbol   |   Definition               |   R |   S      Duration    |
 |__________|____________________________|_____|______________________|
 | mt       |   Modem detected           |   x |                      |
 | ft       |   Fax tone detected        |   x |                      |
 | ld       |   Long duration connection |   x |                      |
 | pat(###) |   Pattern ### detected     |   x |   OO                 |
 | rt       |   Ringback tone            |     |   TO                 |
 | rbk(###) |   ring back on connection  |     |   TO     180 seconds |
 | cf       |   Confirm tone             |     |   BR                 |
 | cg       |   Network Congestion tone  |     |   TO                 |
 | it       |   Intercept tone           |     |   OO                 |
 | pt       |   Preemption tone          |     |   OO                 |
 | of       |   report failure           |   x |                      |
 |__________|____________________________|_____|______________________|
```

신호는 다음과 같이 정의됩니다.

- 패턴 정의는 자동 응답기 감지, 톤 감지 등과 같은 특정 알고리즘에 사용될 수 있습니다.

통화 연결음\(rt\)

- 가청 벨소리는 주파수가 440Hz와 480Hz이고 각각 ​​-19dBm 레벨을 갖는 두 개의 AC 톤을 조합하여 -16dBm의 결합 레벨을 제공합니다. 신호음의 주기는 2초 켜진 후 4초 꺼지는 것입니다. GR-506-CORE - LSSGR: 신호, 섹션 17.2.5를 참조하세요.

연결되면 다시 전화 걸기

- 식별자가 매개변수로 전달되는 연결에 적용되는 통화 연결음.

"장기 연결"은 연결이 1시간 이상 지속되면 감지됩니다.

---
#### **6.1.2.  DTMF package**

```text
   Package name: D

    _______________________________________________________________
   | Symbol |   Definition              |   R |   S      Duration |
   |________|___________________________|_____|___________________|
   | 0      |   DTMF 0                  |   x |   BR              |
   | 1      |   DTMF 1                  |   x |   BR              |
   | 2      |   DTMF 2                  |   x |   BR              |
   | 3      |   DTMF 3                  |   x |   BR              |
   | 4      |   DTMF 4                  |   x |   BR              |
   | 5      |   DTMF 5                  |   x |   BR              |
   | 6      |   DTMF 6                  |   x |   BR              |
   | 7      |   DTMF 7                  |   x |   BR              |
   | 8      |   DTMF 8                  |   x |   BR              |
   | 9      |   DTMF 9                  |   x |   BR              |
   | #      |   DTMF #                  |   x |   BR              |
   | *      |   DTMF *                  |   x |   BR              |
   | A      |   DTMF A                  |   x |   BR              |
   | B      |   DTMF B                  |   x |   BR              |
   | C      |   DTMF C                  |   x |   BR              |
   | D      |   DTMF D                  |   x |   BR              |
   | L      |   long duration indicator |   x |          2 seconds|
   | X      |   Wildcard, match         |   x |                   |
   |        |   any digit 0-9           |     |                   |
   | T      |   Interdigit timer        |   x |          4 seconds|
   | of     |   report failure          |   x |                   |
   |________|___________________________|_____|___________________|
```

"interdigit 타이머" T는 두 가지 방법으로 사용할 수 있는 숫자 입력 타이머입니다.

\* 타이머 T를 숫자 지도와 함께 사용하는 경우 첫 번째 숫자가 입력될 때까지 타이머가 시작되지 않으며 숫자 지도 일치 또는 불일치가 발생할 때까지 각각의 새 숫자가 입력된 후 타이머가 다시 시작됩니다. 이 경우 타이머 T는 숫자 간 타이머로 기능합니다.

\* 숫자 맵 없이 타이머 T를 사용하는 경우 타이머는 즉시 시작되고 숫자가 입력되자마자 간단하게 취소됩니다\(재시작되지 않음\). 이 경우, 오버랩 송신을 사용할 때 타이머 T를 인터디지트 타이머로 사용할 수 있습니다.

- 숫자 맵과 함께 사용하면 타이머 T는 T\(부분\) 또는 T\(임계\)의 두 값 중 하나를 취합니다. 숫자 맵의 패턴과 일치하는 숫자 문자열에 최소한 하나 이상의 숫자가 필요한 경우 타이머 T는 다음에 해당하는 T\(부분\) 값을 취합니다.

- 부분 다이얼 타이밍. 일치를 생성하는 데 타이머가 필요한 전부인 경우 타이머 T는 임계 타이밍에 해당하는 값 T\(임계\)를 취합니다. 숫자 맵 없이 타이머 T를 사용하는 경우 타이머 T는 T\(중요\) 값을 갖습니다. T\(부분\)의 기본값은 16초이고 T\(중요\)의 기본값은 4초입니다. 프로비저닝 프로세스로 인해 이 두 가지가 모두 변경될 수 있습니다.

- "긴 지속 시간 표시기"는 DTMF 신호가 2초보다 긴 지속 시간 동안 생성될 때 관찰됩니다. 이 경우 게이트웨이는 두 가지 연속 이벤트를 감지합니다. 먼저 신호가 인식되면 DTMF 신호를 감지하고 2초 후에 장시간 신호를 감지합니다.

---
#### **6.1.3.  MF Package**

```text
      Package Name: M

       ________________________________________________________
      | Symbol |   Definition       |   R |   S      Duration |
      |________|____________________|_____|___________________|
      | 0      |   MF 0             |   x |   BR              |
      | 1      |   MF 1             |   x |   BR              |
      | 2      |   MF 2             |   x |   BR              |
      | 3      |   MF 3             |   x |   BR              |
      | 4      |   MF 4             |   x |   BR              |
      | 5      |   MF 5             |   x |   BR              |
      | 6      |   MF 6             |   x |   BR              |
      | 7      |   MF 7             |   x |   BR              |
      | 8      |   MF 8             |   x |   BR              |
      | 9      |   MF 9             |   x |   BR              |
      | X      |   Wildcard, match  |   x |                   |
      |        |   any digit 0-9    |     |                   |
      | T      |   Interdigit timer |   x |          4 seconds|
      | K0     |   MF K0 or KP      |   x |   BR              |
      | K1     |   MF K1            |   x |   BR              |
      | K2     |   MF K2            |   x |   BR              |
      | S0     |   MF S0 or ST      |   x |   BR              |
      | S1     |   MF S1            |   x |   BR              |
      | S2     |   MF S2            |   x |   BR              |
      | S3     |   MF S3            |   x |   BR              |
      | wk     |   Wink             |   x |   BR              |
      | wko    |   Wink off         |   x |   BR              |
      | is     |   Incoming seizure |   x |   OO              |
      | rs     |   Return seizure   |   x |   OO              |
      | us     |   Unseize circuit  |   x |   OO              |
      | of     |   report failure   |   x |                   |
      |________|____________________|_____|___________________|
```

MF 패키지 이벤트의 정의는 다음과 같습니다.

눈짓

- 특정 기간 내에 미점유 상태에서 압수 상태, 미점유 트렁크 상태로 전환됩니다. 일반적인 발작 기간은 100-350msec입니다.\)

들어오는 발작

- 통화 시도에 대한 수신 표시.

반납 압류:

- 나가는 발작에 대한 반응으로 발작.

회로 차단 해제:

- 통화 종료 시 회선의 발작이 해제됩니다.

```text
   Wink off:
      A signal used in operator services trunks.  A transition from
      seized to unseized to seized trunk states within a specified
      period of 100-350 ms. (To be checked)
```

---
#### **6.1.4.  Trunk Package**

```text
   Package Name: T

   _____________________________________________________________________
  | Symbol |   Definition                   |   R |   S      Duration  |
  |________|________________________________|_____|____________________|
  | co1    |   Continuity tone (single tone,|   x |   OO               |
  |        |   or return tone)              |     |                    |
  | co2    |   Continuity test (go tone,    |   x |   OO               |
  |        |   in dual tone procedures)     |     |                    |
  | lb     |   Loopback                     |     |   OO               |
  | om     |   Old Milliwatt Tone (1000 Hz) |   x |   OO               |
  | nm     |   New Milliwatt Tone (1004 Hz) |   x |   OO               |
  | tl     |   Test Line                    |   x |   OO               |
  | zz     |   No circuit                   |   x |   OO               |
  | as     |   Answer Supervision           |   x |   OO               |
  | ro     |   Reorder Tone                 |   x |   TO     30 seconds|
  | of     |   report failure               |   x |                    |
  | bl     |   Blocking                     |     |   OO               |
  |________|________________________________|_____|____________________|
```

트렁크 패키지 신호 이벤트의 정의는 다음과 같습니다.

연속성 톤\(co1\):

- 2010 + 또는 - 30Hz의 톤.

연속성 테스트\(co2\):

- 1780 + 또는 - 30Hz의 톤.

```text
   Milliwatt Tones:
      Old Milliwatt Tone (1000 Hz), New Milliwatt Tone (1004 Hz)
```

라인 테스트:

- 105 테스트 라인 테스트 진행 톤\(-10dBm0 + 또는 - 0.5dB에서 2225Hz + 또는 - 25Hz\).

```text
   No circuit:
      (that annoying tri-tone, low to high)

   Answer Supervision:
```

톤 재정렬:

- 재정렬 톤은 주파수가 480Hz와 620Hz이고 레벨이 각각 -24dBm인 2개의 AC 톤을 조합하여 -21dBm의 결합 레벨을 제공합니다. 스테이션 통화 중 신호음의 주기는 0.25초 켜졌다가 0.25초 꺼지며 계속 반복됩니다. GR-506-CORE - LSSGR: 신호, 섹션 17.2.7을 참조하세요.

블로킹:

- 통화 에이전트는 엔드포인트에 "bl\(+\)" 신호를 적용하여 회로를 차단 상태로 설정할 수 있습니다. "bl\(-\)" 신호를 적용하여 차단을 해제할 수 있습니다.

연속성 신호음은 통화 에이전트가 연속성 테스트를 시작하려고 할 때 사용됩니다. 테스트에는 단일 톤과 이중 톤의 두 가지 유형이 있습니다. 통화 에이전트는 프로비저닝 정보를 통해 특정 엔드포인트에 어떤 테스트를 적용해야 하는지 알 것으로 예상됩니다. 예를 들어 단일 주파수 테스트를 시작하려는 통화 에이전트는 다음 형식의 명령을 게이트웨이에 보냅니다.

```text
         RQNT 1234 epx-t1/17@tgw2.example.net
         X: AB123FE0
         S: co1
         R: co1
```

대신 이중 톤 테스트를 시작하려는 경우 다음 명령을 보냅니다.

```text
         RQNT 1234 epx-t1/17@tgw2.example.net
         X: AB123FE0
         S: co2
         R: co1
```

게이트웨이는 요청된 신호를 보내고 두 경우 모두 2010Hz 톤\(co1\)의 반환을 찾습니다. 해당 신호음을 감지하면 해당 알림을 보냅니다.

신호음은 OO 유형입니다. 게이트웨이는 새 알림 요청을 받을 때까지 계속해서 신호음을 보냅니다.

---
#### **6.1.5.  Line Package**

```text
   Package Name: L

________________________________________________________________________
|Symbol       |   Definition                 |   R |   S    Duration   |
|_____________|______________________________|_____|___________________|
|adsi(string) |   adsi display               |     |   BR              |
|vmwi         |   visual message             |     |   OO              |
|             |   waiting indicator          |     |                   |
|hd           |   Off hook transition        |   x |                   |
|hu           |   On hook transition         |   x |                   |
|hf           |   Flash hook                 |   x |                   |
|aw           |   Answer tone                |   x |   OO              |
|bz           |   Busy tone                  |     |   TO   30 seconds |
|ci(ti,nu,na) |   Caller-id                  |     |   BR              |
|wt           |   Call Waiting tone          |     |   TO   30 seconds |
|wt1, wt2,    |   Alternative call           |     |                   |
|wt3, wt4     |   waiting tones              |     |                   |
|dl           |   Dial tone                  |     |   TO   16 seconds |
|mwi          |   Message waiting ind.       |     |   TO   16 seconds |
|nbz          |   Network busy               |   x |   OO              |
|             |   (fast cycle busy)          |     |                   |
|ro           |   Reorder tone               |     |   TO   30 seconds |
|rg           |   Ringing                    |     |   TO   180 seconds|
|r0, r1, r2,  |   Distinctive ringing        |     |   TO   180 seconds|
|r3, r4, r5,  |                              |     |                   |
|r6 or r7     |                              |     |                   |
|rs           |   Ringsplash                 |     |   BR              |
|p            |   Prompt tone                |   x |   BR              |
|e            |   Error tone                 |   x |   BR              |
|sl           |   Stutter dialtone           |     |   TO   16 seconds |
|v            |   Alerting Tone              |     |   OO              |
|y            |   Recorder Warning Tone      |     |   OO              |
|sit          |   SIT tone                   |     |                   |
|z            |   Calling Card Service Tone  |     |   OO              |
|oc           |   Report on completion       |   x |                   |
|ot           |   Off hook warning tone      |     |   TO   indefinite |
|s(###)       |   Distinctive tone pattern   |   x |   BR              |
|of           |   report failure             |   x |                   |
|_____________|______________________________|_____|___________________|
```

톤의 정의는 다음과 같습니다.

발신음:

- 결합된 350 + 440Hz 톤.

시각적 메시지 대기 표시기

- VMWI 메시지의 전송은 TR-H-000030의 섹션 2.3.2, "링잉과 연관되지 않은 온훅 데이터 전송"의 요구 사항과 SR-TSV-002476의 CPE 지침을 준수합니다. VMWI 메시지는 회선이 유휴 상태일 때만 SPCS에서 전송됩니다. 회선이 통화 중인 동안 새 메시지가 도착하면 회선이 유휴 상태로 돌아갈 때까지 VMWI 표시 메시지가 지연됩니다. CA는 주기적으로 CPE의 시각적 표시기를 새로 고쳐야 합니다. TR-NWT-001401 - 시각적 메시지 대기 표시기 일반 요구 사항을 참조하세요. 및 GR-30-CORE - 음성 대역 데이터 전송 인터페이스.

```text
   Message waiting Indicator
      See GR-506-CORE, 17.2.3.
```

경고음:

- 2초 지속의 440Hz 톤과 10초마다 1/2초의 톤이 이어집니다.

링 스플래시

- "알림 벨소리"라고도 알려진 Ringsplash는 통화가 전달되었음을 나타내고 사용자에게 CF 하위 기능이 활성화되었음을 알리기 위해 물리적 전달 회선\(유휴 시\)에 적용할 수 있는 버스트 벨 울림입니다. 미국에서는 0.5\(-0,+0.1\)초의 전력 링잉 버스트로 정의됩니다. TR-TSY-000586 - 착신 전환 하위 기능을 참조하세요.

통화 대기음

- 통화 대기 톤은 GR-506-CORE, 14.2에 정의되어 있습니다. 통화 대기 기능은 TR-TSY-000571에 정의되어 있습니다. "wt"를 TO 신호로 정의하면 \(MGCP의 정신을 고려할 때\) 나에게 잘못된 것처럼 보이는 기능을 실제로 정의하는 것이므로 GR-506-CORE에 따라 ECS에서 "wt"를 BR 신호로 정의합니다. 또한 실제로 네 가지 다른 통화 대기 톤 패턴\(GR-506-CORE, 14.2 참조\)이 있으므로 wt1, wt2, wt3, wt4가 있는 것으로 나타났습니다.

발신자 ID\(ci\(시간, 번호, 이름\)\):

- 발신자 ID 이벤트는 통화 시간, 발신 번호, 발신 이름 등 세 가지 매개변수를 전달합니다. 세 필드는 각각 선택 사항이지만 각 쉼표는 항상 포함됩니다. TR-NWT-001188, GR-30-CORE 및 TR-NWT-000031을 참조하세요.

녹음기 경고음:

- 15초마다 0.5초 지속되는 1400Hz 톤.

앉아 톤:

- 서비스가 중단된 회선을 나타내는 데 사용됩니다.

전화 카드 서비스 톤:

- 941 + 1477Hz의 60ms 및 350 + 440Hz의 940ms\(다이얼 톤\), 200ms의 시간 상수로 기하급수적으로 감소합니다.

독특한 톤 패턴:

- 여기서 ###은 000에서 999 사이의 숫자입니다. 벨소리 구별, 발신음 맞춤 설정 등에 사용할 수 있습니다.

완료 보고

- 완료 이벤트에 대한 보고는 게이트웨이가 엔드포인트에서 TO 유형의 하나 이상의 신호를 수행하도록 요청받았을 때 감지되며, 이러한 신호가 오프훅 전환 또는 다이얼링과 같은 요청된 이벤트 감지에 의해 중지되지 않고 완료되었을 때 감지됩니다. 숫자. 완료 보고서는 다음과 같이 라이브 시간이 끝난 신호의 이름을 매개변수로 전달할 수 있습니다.

```text
            O: L/oc(L/dl)
```

연결되면 다시 전화 걸기

- 연결 식별자에 적용되는 통화 연결음이 매개변수로 전달됩니다.

이러한 정의 중 상당수는 국가마다 다르다는 점에 유의해야 합니다. 위에 나열된 주파수는 북미에서 사용되는 주파수입니다. 국가마다 서로 다른 톤 세트를 수용해야 할 필요성이 있으며, 해당 요구 사항을 충족하는 가장 좋은 방법에 대한 논의가 계속 진행 중입니다.

\* 한 가지 해결책은 예를 들어 독일 다이얼톤을 "L-DE/DL"로 지정하는 다양한 이벤트 패키지를 정의하는 것입니다.

\* 또 다른 해결책은 관리 인터페이스를 사용하여 어떤 주파수가 어떤 톤과 연관되어야 하는지 엔드포인트 기반으로 지정하는 것입니다.

---
#### **6.1.6.  Handset emulation package**

```text
   Package Name: H

________________________________________________________________________
|Symbol       |   Definition                 |   R |   S    Duration   |
|_____________|______________________________|_____|___________________|
|adsi(string) |   adsi display               |   x |   BR              |
|tdd          |                              |     |                   |
|vmwi         |                              |     |                   |
|hd           |   Off hook transition        |   x |   OO              |
|hu           |   On hook transition         |   x |   OO              |
|hf           |   Flash hook                 |   x |   BR              |
|aw           |   Answer tone                |   x |   OO              |
|bz           |   Busy tone                  |   x |   OO              |
|wt           |   Call Waiting tone          |   x |   TO   30 seconds |
|dl           |   Dial tone (350 + 440 Hz)   |   x |   TO   120 seconds|
|nbz          |   Network busy               |   x |   OO              |
|             |   (fast cycle busy)          |     |                   |
|rg           |   Ringing                    |   x |   TO   30 seconds |
|r0, r1, r2,  |   Distinctive ringing        |   x |   TO   30 seconds |
|r3, r4, r5,  |                              |     |                   |
|r6 or r7     |                              |     |                   |
|p            |   Prompt tone                |   x |   BR              |
|e            |   Error tone                 |   x |   BR              |
|sdl          |   Stutter dialtone           |   x |   TO   16 seconds |
|v            |   Alerting Tone              |   x |   OO              |
|y            |   Recorder Warning Tone      |   x |   OO              |
|t            |   SIT tone                   |   x |                   |
|z            |   Calling Card Service Tone  |   x |   OO              |
|oc           |   Report on completion       |   x |                   |
|ot           |   Off hook warning tone      |   x |   OO              |
|s(###)       |   Distinctive tone pattern   |   x |   BR              |
|of           |   report failure             |   x |                   |
|_____________|______________________________|_____|___________________|
```

핸드셋 에뮬레이션 패키지는 게이트웨이가 핸드셋을 에뮬레이션할 수 있을 때 사용되는 라인 패키지의 확장입니다. 라인 패키지와의 차이점은 "오프 후크"와 같은 이벤트를 감지하고 신호를 보낼 수 있다는 것입니다.

---
#### **6.1.7.  RTP Package**

```text
   Package Name: R

    ____________________________________________________________________
   | Symbol  |   Definition                   |   R |   S      Duration|
   |_________|________________________________|_____|__________________|
   | UC      |   Used codec changed           |   x |                  |
   | SR(###) |   Sampling rate changed        |   x |                  |
   | JI(###) |   Jitter buffer size changed   |   x |                  |
   | PL(###) |   Packet loss exceeded         |   x |                  |
   | qa      |   Quality alert                |   x |                  |
   | co1     |   Continuity tone (single tone,|   x |   OO             |
   |         |   or return tone)              |     |                  |
   | co2     |   Continuity test (go tone,    |   x |   OO             |
   |         |  in dual tone procedures)      |     |                  |
   | of      |   report failure               |   x |                  |
   |_________|________________________________|_____|__________________|

   Codec Changed:
      Codec changed to hexadecimal codec number enclosed in parenthesis,
      as in UC(15), to indicate the codec was changed to PCM mu-law.
      Codec Numbers are specified in RFC 1890, or in a new definition of
      the audio profiles for RTP that replaces this RFC.  Some
      implementations of media gateways may not allow the codec to be
      changed upon command from the call agent.  codec changed to codec
      hexadecimal ##.
```

샘플링 속도가 변경되었습니다:

- 샘플링 속도가 SR\(20\)과 같이 괄호 안에 밀리초 단위의 십진수로 변경되어 샘플링 속도가 20밀리초로 변경되었음을 나타냅니다. 미디어 게이트웨이의 일부 구현에서는 통화 에이전트의 명령에 따라 샘플링 속도를 변경하는 것을 허용하지 않을 수 있습니다.

지터 버퍼 크기가 변경되었습니다.

- 미디어 게이트웨이에 수신된 RTP 스트림에 대한 지터 버퍼의 깊이를 자동으로 조정할 수 있는 기능이 있는 경우, 미디어 게이트웨이 컨트롤러가 가변성의 증가 또는 감소를 수용하기 위해 지터 버퍼 크기를 자동으로 늘렸다는 알림을 받는 것이 유용합니다. 네트워크 대기 시간. 알림을 요청하는 구문은 "JI"이며, 이는 컨트롤러가 지터 버퍼 크기 변경에 대한 알림을 원한다는 것을 미디어 게이트웨이에 알려줍니다. 미디어 게이트웨이에서 컨트롤러로의 알림 구문은 "JI\(####\)"입니다. 여기서 ####는 지터 버퍼의 새 크기\(밀리초\)입니다.

패킷 손실 초과:

- 패킷 손실률이 100,000패킷당 지정된 패킷 수의 십진수 임계값을 초과합니다. 여기서 패킷 손실 수는 괄호 안에 포함됩니다. 예를 들어, PL\(10\)은 패킷이 10,000개 패킷 중 1개 비율로 삭제되고 있음을 나타냅니다.

품질 경고

- 패킷 손실률 또는 지연과 지터의 조합이 지정된 품질 임계값을 초과합니다.

연속성 톤은 Trunk 패키지에 정의된 것과 동일합니다. RTP 회로의 연속성을 테스트하기 위해 네트워크 루프백 또는 네트워크 연속성 테스트 모드와 함께 사용할 수 있습니다.

"작업 실패" 코드는 기본 연결 끊김과 같은 문제를 보고하는 데 사용될 수 있습니다. 관찰된 이벤트에는 실패 이유 코드가 매개변수로 포함될 수 있습니다.

---
#### **6.1.8.  Network Access Server Package**

```text
   Package Name: N

       ____________________________________________________________
      | Symbol |   Definition             |   R |   S     Duration|
      |________|__________________________|_____|_________________|
      | pa     |  Packet arrival          |  x  |                 |
      | cbk    |  Call back request       |  x  |                 |
      | cl     |  Carrier lost            |  x  |                 |
      | au     |   Authorization succeeded|  x  |                 |
      | ax     |   Authorization denied   |  x  |                 |
      | of     |   Report failure         |  x  |                 |
      |________|__________________________|_____|_________________|
```

패킷 도착 이벤트는 엔드포인트에서 관찰되는 인터넷 주소로 최근에 하나 이상의 패킷이 전송되었음을 알리는 데 사용됩니다. 이벤트 보고서에는 표준 ASCII 인코딩의 인터넷 주소가 괄호 안에 포함되어 있습니다.

```text
         O: pa(192.96.41.1)
```

콜백 이벤트는 데이터 연결 초기 단계에서 콜백이 요청되었음을 알리는 데 사용됩니다. 이벤트 보고서에는 콜백해야 하는 사용자의 식별 정보가 괄호 안에 포함됩니다.

```text
         O: cbk(user25)
```

---
#### **6.1.9.  Announcement Server Package**

```text
   Package Name: A

    ___________________________________________________________________
   | Symbol         |   Definition           |   R |   S      Duration|
   |________________|________________________|_____|__________________|
   | ann(url,parms) |   Play an announcement |     |   TO     variable|
   | oc             |   Report on completion |   x |                  |
   | of             |   Report failure       |   x |                  |
   |________________|________________________|_____|__________________|
```

공지 작업은 다음 예와 같이 URL 이름과 초기 매개변수 집합으로 한정됩니다.

```text
         S: ann(http://scripts.example.net/all-lines-busy.au)
```

안내 방송이 재생되면 "작업 완료" 이벤트가 감지됩니다. 알림을 재생할 수 없는 경우 작업 실패 이벤트가 반환될 수 있습니다. 실패는 다음과 같은 설명으로 설명될 수 있습니다.

```text
         O: A/of(file not found)
```

---
#### **6.1.10.  Script Package**

```text
   Package Name: Script

    ______________________________________________________________
   | Symbol    |   Definition           |   R |   S  |   Duration|
   |___________|________________________|_____|______|___________|
   | java(url) |   Load a java script   |     |   TO |   variable|
   | perl(url) |   Load a perl script   |     |   TO |   variable|
   | tcl(url)  |   Load a TCL script    |     |   TO |   variable|
   | xml(url)  |   Load an XML script   |     |   TO |   variable|
   | oc        |   Report on completion |   x |      |           |
   | of        |   Report failure       |   x |      |           |
   |___________|________________________|_____|______|___________|
```

"언어" 작업 정의는 다음 예와 같이 URL 이름과 초기 매개변수 집합으로 한정됩니다.

```text
         S: script/java(http://scripts.example.net/credit-
            card.java,long,1234)
```

현재 정의는 가장 일반적인 언어에 대한 키워드를 정의합니다. 이 문서의 추가 버전에서는 더 많은 언어가 정의될 ​​수 있습니다. 각 언어에 대해 API 사양은 스크립트가 로컬 "notificationRequest" 명령을 실행하고 해당 알림을 받는 방법을 설명합니다.

스크립트는 쉼표로 구분된 하나 이상의 텍스트 문자열로 구성된 출력을 생성합니다. 텍스트 문자열은 다음 예와 같이 완료 시 보고서에 설명으로 보고됩니다.

```text
         O: script/oc(21223456794567,9738234567)
```

실패 보고서는 다음과 같이 문자열을 반환할 수도 있습니다.

```text
         O: script/oc(21223456794567,9738234567)
```

스크립트 환경의 정의와 해당 환경의 특정 작업은 추가 연구 대상입니다.

---
### **6.2.  Basic endpoint types and profiles**

우리는 다음과 같은 기본 엔드포인트 유형과 프로필을 정의합니다.

```text
   *  Trunk gateway (ISUP)

   *  Trunk gateway (MF)

   *  Network Access Server (NAS)

   *  Combined NAS/VOIP gateway

   *  Access Gateway

   *  Residential Gateway

   *  Announcement servers
```

이 게이트웨이는 다음 패키지를 구현해야 합니다.

```text
       ___________________________________________________________
      | Gateway                    |   Supported packages        |
      |____________________________|_____________________________|
      | Trunk gateway (ISUP)       |   GM, DTMF, TK, RTP         |
      | Trunk gateway (MF)         |   GM, MF, DTMF, TK, RTP     |
      | Network Access Server (NAS)|   GM, MF, TK, NAS           |
      | Combined NAS/VOIP gateway  |   GM, MF, DTMF, TK, NAS, RTP|
      | Access Gateway (VOIP)      |   GM, DTMF, MF, RTP         |
      | Access Gateway (VOIP+NAS)  |   GM, DTMF, MF, NAS, RTP    |
      | Residential Gateway        |   GM, DTMF, Line, RTP       |
      | Announcement Server        |   ANN, RTP                  |
      |____________________________|_____________________________|
```

고급 알림 서버는 스크립트 패키지를 지원할 수도 있습니다.

고급 트렁킹 서버는 ANN 패키지, 스크립트 패키지 및 경우에 따라 회선 및 핸드셋 패키지도 지원할 수 있습니다.

---
## **7.  Versions and compatibility**
---
### **7.1.  Differences between version 1.0 and draft 0.5**

Draft 0-5는 Draft 버전 0.1의 마지막 업데이트로 1999년 2월에 발행되었습니다. 버전 1.0은 구현 경험의 이점을 활용하며 CableLabs의 NCS 프로젝트와 최대한 일치합니다. 2월 초안과 버전 1.0의 주요 차이점은 다음과 같습니다.

\* 3개의 인코딩을 더 명확하게 지정

- LocalConnectionOptions 매개변수, 인코딩 방법, 패킷화 기간 및 대역폭은 SDP에 제시된 규칙을 따라야 합니다.

\* 검역 처리 매개변수가 감지되었지만 아직 지정되지 않은 이벤트의 처리를 제어하는 ​​방법을 지정합니다.

\* 예상치 못한 타이머나 숫자가 트리거되도록 지정됨

- 다이얼링된 문자열을 전송합니다.

\* 섹션 2.1.5에서 숫자 맵 구문 설명을 제거했습니다\(섹션 3.4와 중복되었습니다.\)

\* 공식 구문 설명의 기타 버그를 수정했습니다.

\* CableLabs NCS와 정렬된 명령 사양

-  사양. 이는 주로 AuditEndpoint에 영향을 미치며

```text
      RestartInProgress commands.
```

\* 재전송 처리를 CableLabs NCS 사양에 맞게 조정했습니다.

\* 임시 응답 반환 코드 및 해당 동작 설명이 추가되었습니다.

\* 진행 중인 재시작을 위한 선택적 이유 코드 매개변수가 추가되었습니다.

\* 재시작 방법, 재시작 지연 및 이유 코드를 감사할 수 있는 기능이 추가되었습니다.

---
### **7.2.  Differences between draft-04 and draft-05**

차이점은 미미합니다. 저작권 표시를 수정하고 공식 설명의 버그를 수정했습니다.

---
### **7.3.  Differences between draft-03 and draft-04**

Draft 04는 2월 1일 발행된 Draft 03 검토 과정에서 지적된 여러 가지 사소한 편집 실수를 수정합니다.

---
### **7.4.  Differences between draft-02 and draft-03**

1998년 1월 22일 발행된 초안-02와 초안 03의 주요 차이점은 다음과 같습니다.

\* 엔드포인트 유형에 대한 논의를 소개했습니다.

\* 연결 설정 절차 및 연결 매개변수의 역할에 대한 논의를 소개했습니다.

\* 이벤트 이름 내에 연결 식별자 표기법을 도입했습니다.

\* LocalConnectionOptions 매개변수 및 ConnectionParameters 매개변수에 대한 확장 절차를 문서화했습니다.

\* 게이트웨이가 30초 타이머를 기다리지 않고 이전 응답의 복사본을 삭제할 수 있도록 ResponseAck 매개변수를 사용하는 3방향 핸드셰이크 절차를 도입했습니다.

```text
   *  Expanded the security section to include a discussion of
      "uncontrolled barge-in."
```

\* 부록으로 "두 개의 연결 생성" 명령을 제안했습니다.

---
### **7.5.  Differences between draft-01 and draft-02**

1998년 11월에 발행된 초안-01과 초안 02의 주요 차이점은 다음과 같습니다.

\* 프로토콜의 ABNF 설명을 추가했습니다.

\* EndpointConfiguration 명령 사양,

\* 연결 생성 명령에 "두 끝점" 모드 추가,

\* 초기 구현자의 요청에 따라 패키지 와일드카드를 "$/$"에서 "\*/all"로 수정했습니다.

\* 외부 사양에 더 잘 부합하도록 일부 패키지 정의를 개정했습니다.

```text
   *  Addition of a specification for the handling of "failover."
```

\* 경쟁 조건 섹션이 개정되었습니다.

---
### **7.6.  The making of MGCP from IPDC and SGCP**

MGCP 버전 0.1은 SGCP와 IPDC 제안을 융합한 결과입니다.

---
### **7.7.  Changes between MGCP and initial versions of SGCP**

MGCP 버전 0.1\(SGCP 버전 1.2 포함\)에는 SGCP 버전 1.1에서 다음과 같은 변경 사항이 도입되었습니다.

\* 프로토콜명이 MGCP로 변경되었습니다.

\* IPDC에서 영감을 받아 엔드포인트 이름에 공식적인 와일드카드 구조를 도입하고 각 작업에서 와일드카드 이름의 사용법을 자세히 설명합니다.

\* 이벤트 이름 지정 방식, IPDC에서 영감을 받은 패키지 구조 도입.

\* 감사 끝점, 감사 연결\(Cablelabs에서 요청\) 및 다시 시작\(IPDC에서 영감을 얻음\)을 위한 새로운 작업입니다.

\* 알림 요청의 동작을 제어하는 ​​새로운 매개변수입니다.

\* 경쟁 조건 감지 및 처리에 대한 텍스트가 개선되었습니다.

\* 패키지 이름을 통합하기 위해 이벤트 보고에 대한 구문 수정.

\* 기본 이벤트 패키지 정의\(IPDC에서 영감을 얻음\).

\* IPDC에서 영감을 받은 필수 및 선택적 확장 매개변수 통합.

SGCP 버전 1.1에는 SGCP 1.0 버전에서 다음과 같은 변경 사항이 도입되었습니다.

```text
   *  Extension parameters (X-??:)

   *  Error Code 511 (Unrecognized extension).
```

\* 모든 이벤트 코드는 RequestEvent, SignalRequest 및 ObservedEvent 매개변수에서 사용할 수 있습니다.

\* 오류 코드 512\(요청된 이벤트를 감지할 수 있는 기능이 없음\).

\* 오류 코드 513\(요청된 신호를 생성할 수 있는 장치가 없음\).

```text
   *  Error Code 514 (Unrecognized announcement).
```

\* 생성 명령에서 특정 Endpoint-ID가 반환될 수 있습니다.

\* 숫자 A 및 D와의 충돌을 피하기 위해 ASDI 디스플레이 코드를 "ad"에서 "asdi"로 변경했습니다.

\* 숫자 A 및 타이머 표시 T와의 충돌을 피하기 위해 응답음 코드를 "at"에서 "aw"로 변경했습니다.

\* 숫자 B 및 타이머 표시 T와의 충돌을 피하기 위해 통화 중 신호음 코드를 "bt"에서 "bz"로 변경했습니다.

\* 연속성 톤 값이 "co"로 지정되었습니다\(CT는

- 여러 경우에 잘못 사용되었습니다. CT가 와 충돌합니다.\)

\* 숫자 D 및 타이머 표시 T와의 충돌을 피하기 위해 발신음 코드를 "dt"에서 "dl"로 변경했습니다.

\* 공지사항 요청에 대한 코드 포인트를 추가했습니다.

\* "wink" 이벤트에 대한 코드 포인트를 추가했습니다.

\* "Connection Parameter"의 "octet received" 코드를 "OR"로 설정합니다. \(RO로 설정되었으나 모든 예시에서 "OR"이 사용되었습니다.\)

\* "데이터" 모드가 추가되었습니다.

\* 네트워크 액세스 모드\(NAS\)에 대한 SDP 매개변수에 대한 설명이 추가되었습니다.

\* 네트워크 액세스 모드에 대한 4개의 흐름도를 추가했습니다.

\* 설명을 더 쉽게 이해할 수 있도록 수많은 편집 제안을 통합했습니다. 특히 요청, 쿼리, 기능 및 명령 간의 혼란을 해소했습니다.

\* 연속성 테스트 모드는 듀얼 톤 트랜스폰더를 지정하는 것으로 정의되었으며 루프백 모드는 단일 톤 테스트에 사용할 수 있습니다.

```text
   *  Added event code "OC", operation completed.
```

\* 예상되는 이벤트 및 알림 처리를 명확히 하는 "격리 목록" 사양을 추가했습니다.

\* "와일드카드 삭제" 작업 사양이 추가되었습니다.

---
## **8.  Security Considerations**

보안 문제는 섹션 5에서 논의됩니다.

---
## **9.  Acknowledgements**

SGCP와 MGCP의 설계에 대한 조언을 제공한 많은 리뷰어들, 특히 Flemming Andreasen, Sankar Ardhanari, Francois Berard, David Auerbach, Bob Biskner, David Bukovinsky, Jerry Kamitses, Oren Kudevitzki, Barry Hoffner, 트로이 몰리, 데이브 오란, 제프 오윅, 존 피켄스, 루 루빈, 칩 샤프, 폴 시벤, 커트 스타인브레너, 조 스톤, 스튜어트 레이.

MGCP 버전 0.1은 Level 3 Communications가 설립한 기술 자문 위원회가 설계한 "인터넷 프로토콜 장치 제어"\(IPDC\)에서 많은 영감을 받았습니다. IP 연결 제어 프로토콜, IP 미디어 제어 프로토콜 및 IP 장치 관리에서 전체 텍스트 세트가 검색되었습니다. 저자는 Ilya Akramovich, Bob Bell, Dan Brendes, Peter Chung, John Clark, Russ Dehlinger, Andrew Dugan, Isaac Elliott, Cary FitzGerald, Jan Gronski, Tom Hess, Geoff Jordan, Tony Lam이 이 프로토콜에 기여한 것에 대해 감사를 표하고 싶습니다. , Shawn Lewis, Dave Mazik, Alan Mikhak, Pete O'Connell, Scott Pickett, Shyamal Prasad, Eric Presworsky, Paul Richards, Dale Skran, Louise Spergel, David Sprague, Raj Srinivasan, Tom Taylor 및 Michael Thomas.

---
## **10.  References**

\* Schulzrinne, H., Casner, S., Frederick, R. 및 V. Jacobson, "RTP: 실시간 애플리케이션을 위한 전송 프로토콜", RFC 1889, 1996년 1월.

\* Schulzrinne, H., "최소 제어를 통한 오디오 및 비디오 회의용 RTP 프로필", RFC 1890, 1996년 1월.

\* Handley, M 및 V. Jacobson, "SDP: 세션 설명 프로토콜", RFC 2327, 1998년 4월.

\* Handley, M., "SAP - 세션 발표 프로토콜", 진행 중인 작업.

\* Handley, M., Schulzrinne, H. 및 E. Schooler, "SIP\(세션 시작 프로토콜\)", RFC 2543, 1999년 3월.

\* Schulzrinne, H., Rao, A. 및 R. Lanphier, "실시간 스트리밍 프로토콜\(RTSP\)", RFC 2326, 1998년 4월.

```text
   *  ITU-T, Recommendation Q.761, "FUNCTIONAL DESCRIPTION OF THE ISDN
      USER PART OF SIGNALLING SYSTEM No. 7", (Malaga-Torremolinos, 1984;
      modified at Helsinki, 1993)

   *  ITU-T, Recommendation Q.762, "GENERAL FUNCTION OF MESSAGES AND
      SIGNALS OF THE ISDN USER PART OF SIGNALLING SYSTEM No. 7",
      (MalagaTorremolinos, 1984; modified at Helsinki, 1993)

   *  ITU-T, Recommendation H.323 (02/98), "PACKET-BASED MULTIMEDIA
      COMMUNICATIONS SYSTEMS."

   *  ITU-T, Recommendation H.225, "Call Signaling Protocols and Media
      Stream Packetization for Packet Based Multimedia Communications
      Systems."

   *  ITU-T, Recommendation H.245 (02/98), "CONTROL PROTOCOL FOR
      MULTIMEDIA COMMUNICATION."
```

\* Kent, S. 및 R. Atkinson, "인터넷 프로토콜을 위한 보안 아키텍처", RFC 2401, 1998년 11월.

\* Kent, S. 및 R. Atkinson, "IP 인증 헤더", RFC 2402, 1998년 11월.

\* Kent, S. 및 R. Atkinson, "IP ESP\(보안 페이로드 캡슐화\)", RFC 2406, 1998년 11월.

\* Crocker, D. 및 P. Overell, "구문을 위한 증강된 BNF

- 사양: ABNF", RFC 2234, 1997년 11월.

---
## **11.  Authors' Addresses**

```text
   Mauricio Arango
   RSL COM Latin America
   6300 N.W. 5th Way, Suite 100
   Ft. Lauderdale, FL 33309

   Phone: (954) 492-0913
   EMail: marango@rslcom.com

   Andrew Dugan
   Level3 Communications
   1450 Infinite Drive
   Louisville, CO 80027

   Phone: (303)926 3123
   EMail: andrew.dugan@l3.com

   Isaac Elliott
   Level3 Communications
   1450 Infinite Drive
   Louisville, CO 80027

   Phone: (303)926 3123
   EMail: ike.elliott@l3.com

   Christian Huitema
   Telcordia Technologies
   MCC 1J236B
   445 South Street
   Morristown, NJ 07960
   U.S.A.

   Phone: +1 973-829-4266
   EMail: huitema@research.telcordia.com

   Scott Pickett
   Vertical Networks
   1148 East Arques Ave
   Sunnyvale, CA 94086

   Phone: (408) 523-9700 extension 200
   EMail: ScottP@vertical.com
```

자세한 내용은 SGCP 웹사이트에서 확인할 수 있습니다.

```text
           http://www.argreenhouse.com/SGCP/
```

---
## **12.  Appendix A: Proposed "MoveConnection" command**

동일한 게이트웨이에서 기존 연결을 한 끝점에서 다른 끝점으로 이동하는 새 명령을 생성하는 것이 제안되었습니다. 이 명령은 동일한 게이트웨이에서 제공하는 엔드포인트 간의 통화 전달과 같은 특정 통화 서비스를 처리하는 데 특히 유용합니다.

```text
         [SecondEndPointId,]
         [ConnectionId,]
         [LocalConnectionDescriptor]
          <--- ModifyConnection(CallId,
                                EndpointId,
                                ConnectionId,
                                SecondEndPointId,
                                [NotifiedEntity,]
                                [LocalConnectionOptions,]
                                [Mode,]
                                [RemoteConnectionDescriptor,]
                                [Encapsulated NotificationRequest,]
                                [Encapsulated EndpointConfiguration])
```

사용되는 매개 변수는 연결이 이동되는 끝점을 식별하는 SecondEndpointId가 추가된 ModifyConnection 명령과 동일합니다.

EndpointId는 연결이 생성된 엔드포인트의 정규화된 엔드포인트 식별자여야 합니다. 로컬 이름은 와일드카드 규칙을 사용하면 안 됩니다.

SecondEndpointId는 연결이 생성된 끝점의 끝점 식별자입니다. "모두" 와일드카드 규칙을 사용할 수 있지만 "모두" 규칙은 사용할 수 없습니다. SecondEndpointId 매개변수가 정규화되지 않은 경우 게이트웨이는 응답 매개변수로 호출 에이전트에 반환될 값을 선택합니다.

이 명령을 실행하면 기존 연결이 두 번째 끝점으로 "이동"됩니다. 게이트웨이 구현에 따라 이동 후 연결 식별자는 이동 전 연결 식별자와 동일할 수도 있고 동일하지 않을 수도 있습니다. 동일하지 않은 경우 새 값이 응답 매개변수로 반환됩니다.

이 명령의 목적은 IP 주소 및 포트와 같은 전송 매개변수를 수정하지 않고 통화 에이전트가 매개변수 변경을 원격 게이트웨이에 알리도록 강요하지 않고 연결의 로컬 재배치를 수행하는 것입니다.

연결 끝. 그러나 게이트웨이 아키텍처가 항상 이러한 투명한 이동을 허용하는 것은 아닙니다. 예를 들어 일부 아키텍처에서는 특정 엔드포인트 그룹을 처리하는 여러 보드에 특정 IP 주소를 허용할 수 있습니다. 어떤 이유로든 이동으로 인해 전송 매개변수를 변경해야 하는 경우 새 LocalConnectionDescriptor가 응답 매개변수로 반환됩니다.

LocalConnectionOptions, Mode 및 RemoteConnectionDescriptor가 있는 경우 이동 후에 적용됩니다.

RequestedEvents, RequestIdentifier, DigitMap, SignalRequests, QuarantineHandling 및 DetectEvents 매개 변수는 선택 사항입니다. 통화 에이전트는 연결 이동과 동시에 실행되는 알림 요청을 전송하는 데 사용할 수 있습니다. 이러한 매개 변수가 있으면 알림 요청이 두 번째 끝점에 적용됩니다.

이러한 매개변수가 있는 경우 이동 및 알림요청이 동기화되어야 합니다. 즉, 둘 다 수락하거나 둘 다 거부해야 함을 의미합니다. NotifiedEntity 매개변수\(있는 경우\)는 ModifyConnection 및 NotificationRequest 명령 모두에 적용됩니다.

이 명령은 두 번째 끝점에도 적용되는 캡슐화된 EndpointConfiguration 명령을 전달할 수 있습니다. 이 명령이 있는 경우 EndpointConfiguration 명령의 매개변수는 복제되지 않는 SecondEndpointId를 제외하고 MoveConnection의 일반 매개변수 뒤에 삽입됩니다. EndpointConfiguration 명령은 캡슐화된NotificationRequest 명령과 함께 캡슐화될 수 있습니다.

캡슐화된 EndpointConfiguration 명령은 MoveConnection 명령의 운명을 공유합니다. MoveConnection이 거부되면 EndpointConfiguration이 실행되지 않습니다.

---
### **12.1.  Proposed syntax modification**

moveConnection 명령을 추가하는 데 필요한 유일한 구문 수정은 공식 구문의 MGCPVerb 절에 있는 승인된 값에 MOVE 키워드를 추가하는 것입니다.

---
## **13.  Full Copyright Statement**

Copyright \(C\) The Internet Society \(1999\). 판권 소유.

이 문서와 그 번역본은 복사되어 타인에게 제공될 수 있으며, 이에 대해 설명하거나 설명하거나 구현을 지원하는 파생물은 어떤 종류의 제한 없이 전체적으로 또는 부분적으로 준비, 복사, 출판 및 배포될 수 있습니다. , 단, 위의 저작권 표시와 이 단락은 그러한 모든 사본 및 파생물에 포함됩니다. 그러나 이 문서 자체는 인터넷 표준 개발 목적으로 필요한 경우를 제외하고는 저작권 표시를 제거하거나 Internet Society 또는 기타 인터넷 조직에 대한 참조를 제거하는 등 어떤 식으로든 수정할 수 없습니다. 인터넷 표준 프로세스를 따르거나 영어 이외의 언어로 번역하는 데 필요한 대로 따라야 합니다.

위에서 부여된 제한된 권한은 영구적이며 Internet Society 또는 그 승계자 또는 양수인에 의해 취소되지 않습니다.

이 문서와 여기에 포함된 정보는 "있는 그대로" 제공되며 인터넷 사회 및 인터넷 공학 태스크포스는 여기에 포함된 정보의 사용이 상품성 또는 특정 목적에의 적합성에 대한 권리 또는 묵시적 보증을 침해하는 행위.

---
# **Acknowledgement**

RFC 편집기 기능에 대한 자금은 현재 Internet Society에서 제공하고 있습니다.