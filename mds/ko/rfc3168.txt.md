

```text
Network Working Group                                    K. Ramakrishnan
Request for Comments: 3168                            TeraOptic Networks
Updates: 2474, 2401, 793                                        S. Floyd
Obsoletes: 2481                                                    ACIRI
Category: Standards Track                                       D. Black
                                                                     EMC
                                                          September 2001
```

- IP에 명시적 혼잡 알림\(ECN\) 추가

---
# **Status of this Memo**

이 문서는 인터넷 커뮤니티를 위한 인터넷 표준 추적 프로토콜을 지정하고 개선을 위한 토론 및 제안을 요청합니다. 이 프로토콜의 표준화 상태 및 상태에 대해서는 "Internet Official Protocol Standards"\(STD 1\) 최신판을 참조하십시오. 이 메모의 배포는 무제한입니다.

---
# **Copyright Notice**

Copyright \(C\) The Internet Society \(2001\). 판권 소유.

---
# **Abstract**

이 메모에서는 IP 헤더에서 ECN의 2비트 사용을 포함하여 TCP 및 IP에 ECN\(명시적 혼잡 알림\)을 통합하는 방법을 지정합니다.

---
# **Table of Contents**

```text
   1.  Introduction..................................................  3
   2.  Conventions and Acronyms......................................  5
   3.  Assumptions and General Principles............................  5
   4.  Active Queue Management (AQM).................................  6
   5.  Explicit Congestion Notification in IP........................  6
   5.1.  ECN as an Indication of Persistent Congestion............... 10
   5.2.  Dropped or Corrupted Packets................................ 11
   5.3.  Fragmentation............................................... 11
   6.  Support from the Transport Protocol........................... 12
   6.1.  TCP......................................................... 13
   6.1.1  TCP Initialization......................................... 14
   6.1.1.1.  Middlebox Issues........................................ 16
   6.1.1.2.  Robust TCP Initialization with an Echoed Reserved Field. 17
   6.1.2.  The TCP Sender............................................ 18
   6.1.3.  The TCP Receiver.......................................... 19
   6.1.4.  Congestion on the ACK-path................................ 20
   6.1.5.  Retransmitted TCP packets................................. 20
   6.1.6.  TCP Window Probes......................................... 22
   7.  Non-compliance by the End Nodes............................... 22
   8.  Non-compliance in the Network................................. 24
   8.1.  Complications Introduced by Split Paths..................... 25
   9.  Encapsulated Packets.......................................... 25
   9.1.  IP packets encapsulated in IP............................... 25
   9.1.1.  The Limited-functionality and Full-functionality Options.. 27
   9.1.2.  Changes to the ECN Field within an IP Tunnel.............. 28
   9.2.  IPsec Tunnels............................................... 29
   9.2.1.  Negotiation between Tunnel Endpoints...................... 31
   9.2.1.1.  ECN Tunnel Security Association Database Field.......... 32
   9.2.1.2.  ECN Tunnel Security Association Attribute............... 32
   9.2.1.3.  Changes to IPsec Tunnel Header Processing............... 33
   9.2.2.  Changes to the ECN Field within an IPsec Tunnel........... 35
   9.2.3.  Comments for IPsec Support................................ 35
   9.3.  IP packets encapsulated in non-IP Packet Headers............ 36
   10.  Issues Raised by Monitoring and Policing Devices............. 36
   11.  Evaluations of ECN........................................... 37
   11.1.  Related Work Evaluating ECN................................ 37
   11.2.  A Discussion of the ECN nonce.............................. 37
   11.2.1.  The Incremental Deployment of ECT(1) in Routers.......... 38
   12.  Summary of changes required in IP and TCP.................... 38
   13.  Conclusions.................................................. 40
   14.  Acknowledgements............................................. 41
   15.  References................................................... 41
   16.  Security Considerations...................................... 45
   17.  IPv4 Header Checksum Recalculation........................... 45
   18.  Possible Changes to the ECN Field in the Network............. 45
   18.1.  Possible Changes to the IP Header.......................... 46
   18.1.1.  Erasing the Congestion Indication........................ 46
   18.1.2.  Falsely Reporting Congestion............................. 47
   18.1.3.  Disabling ECN-Capability................................. 47
   18.1.4.  Falsely Indicating ECN-Capability........................ 47
   18.2.  Information carried in the Transport Header................ 48
   18.3.  Split Paths................................................ 49
   19.  Implications of Subverting End-to-End Congestion Control..... 50
   19.1.  Implications for the Network and for Competing Flows....... 50
   19.2.  Implications for the Subverted Flow........................ 53
   19.3.  Non-ECN-Based Methods of Subverting End-to-end Congestion
          Control.................................................... 54
   20.  The Motivation for the ECT Codepoints........................ 54
   20.1.  The Motivation for an ECT Codepoint........................ 54
   20.2.  The Motivation for two ECT Codepoints...................... 55
   21.  Why use Two Bits in the IP Header?........................... 57
   22.  Historical Definitions for the IPv4 TOS Octet................ 58
   23.  IANA Considerations.......................................... 60
   23.1.  IPv4 TOS Byte and IPv6 Traffic Class Octet................. 60
   23.2.  TCP Header Flags........................................... 61
   23.3. IPSEC Security Association Attributes....................... 62
   24.  Authors' Addresses........................................... 62
   25.  Full Copyright Statement..................................... 63
```

---
## **1.  Introduction**

먼저 혼잡을 나타내는 TCP의 패킷 삭제 사용을 설명합니다. 다음으로 인터넷 인프라에 활성 대기열 관리\(예: RED\)를 추가하면 라우터가 대기열이 오버플로되기 전에 정체를 감지하므로 라우터는 더 이상 정체를 나타내는 패킷 삭제로 제한되지 않습니다. 대신 라우터는 ECN 지원 전송 패킷의 IP 헤더에 CE\(Congestion Experienced\) 코드 포인트를 설정할 수 있습니다. CE 코드 포인트가 라우터에 설정되는 시기를 설명하고 TCP를 ECN 지원으로 만들기 위해 TCP에 필요한 수정 사항을 설명합니다. 다른 전송 프로토콜\(예: 신뢰할 수 없는 유니캐스트 또는 멀티캐스트, 신뢰할 수 있는 멀티캐스트, 기타 신뢰할 수 있는 유니캐스트 전송 프로토콜\)에 대한 수정은 해당 프로토콜이 개발되고 표준 프로세스를 통해 발전할 때 고려될 수 있습니다. 또한 이 문서에서는 IP 터널, 특히 IPsec 터널 내에서 ECN 사용과 관련된 문제에 대해 설명합니다.

이 문서의 기본 원칙 중 하나는 여기에 지정된 메커니즘이 가능한 한 점진적으로 배포 가능하다는 것입니다. 증분 배포 원칙에 대한 한 가지 과제는 ECN 사용과 호환되지 않는 일부 IP 터널이 이전에 존재했다는 것입니다. ECN이 배포되면 호환되지 않는 IP 터널을 이 문서에 맞게 업그레이드해야 합니다.

이 문서는 ECN을 인터넷 커뮤니티를 위한 실험 프로토콜로 정의한 RFC 2481, "IP에 명시적 혼잡 알림\(ECN\)을 추가하는 제안"을 폐기합니다. 이 문서는 또한 IP 헤더의 ECN 필드 정의 시 RFC 2474, "IPv4 및 IPv6 헤더의 DS 필드\(DS 필드\) 정의"를 업데이트하여 RFC 2401, "인터넷 프로토콜에 대한 보안 아키텍처"를 변경합니다. ECN 사용과 호환되도록 터널 모드 헤더 구성에서 IPv4 TOS 바이트 및 IPv6 트래픽 클래스 옥텟을 처리하고, TCP 헤더에 두 개의 새로운 플래그를 정의할 때 RFC 793, "전송 제어 프로토콜"을 사용합니다.

TCP의 혼잡 제어 및 회피 알고리즘은 네트워크가 블랙박스라는 개념을 기반으로 합니다 \[Jacobson88, Jacobson90\]. 네트워크의 혼잡 상태 등은 네트워크가 혼잡해지고 패킷이 중단될 때까지 \(네트워크에서 처리되지 않은 패킷의 창을 늘려서\) 네트워크 부하를 점진적으로 증가시켜 네트워크 상태를 검색하는 최종 시스템에 의해 결정됩니다. 잃어버린. 네트워크를 "블랙박스"로 취급하고 처리

네트워크 정체를 나타내는 손실은 개별 패킷의 지연이나 손실에 거의 또는 전혀 민감하지 않고 TCP가 전달하는 순수한 최선의 노력 데이터에 적합합니다. 또한 TCP의 혼잡 관리 알고리즘에는 처리량 관점에서 손실의 영향을 최소화하기 위한 기술\(예: 빠른 재전송 및 빠른 복구\)이 내장되어 있습니다. 그러나 이러한 메커니즘은 실제로 하나 이상의 개별 패킷의 지연이나 손실에 민감한 애플리케이션을 돕기 위한 것이 아닙니다. 텔넷, 웹 탐색, 오디오 및 비디오 데이터 전송과 같은 대화형 트래픽은 패킷 손실\(특히 UDP와 같이 신뢰할 수 없는 데이터 전송 전송을 사용하는 경우\)이나 재전송 필요성으로 인해 발생하는 패킷 대기 시간 증가에 민감할 수 있습니다. 손실 후 패킷\(TCP에서 제공하는 안정적인 데이터 전달 의미론 사용\)

TCP는 패킷 손실이 발생할 때까지 창 크기를 점진적으로 늘려 사용할 적절한 혼잡 창을 결정하므로 이로 인해 병목 현상이 발생하는 라우터에 대기열이 쌓이게 됩니다. 각 개별 흐름에 의해 배치된 로드\(예: 대기열 오버플로에 대한 테일 드롭\)에 민감하지 않은 라우터의 대부분의 패킷 삭제 정책을 사용하면 이는 대기 시간에 민감한 흐름의 일부 패킷이 삭제될 수 있음을 의미합니다. 또한 이러한 삭제 정책으로 인해 여러 흐름에서 손실이 동기화됩니다.

활성 대기열 관리 메커니즘은 대기열이 오버플로되기 전에 정체를 감지하고 이러한 정체를 최종 노드에 표시합니다. 따라서 활성 대기열 관리는 해당 대기열을 공유하는 모든 트래픽에 대해 불필요한 대기열 지연을 줄일 수 있습니다. 활성 대기열 관리의 장점은 RFC 2309 \[RFC2309\]에 설명되어 있습니다. 활성 대기열 관리는 여러 흐름에 걸친 바람직하지 않은 손실 동기화를 포함하여 대기열 오버플로로 인해 삭제되는 일부 나쁜 속성을 방지합니다. 더 중요한 것은 활성 대기열 관리는 혼잡 제어 메커니즘\(예: TCP\)을 갖춘 전송 프로토콜이 혼잡을 나타내는 유일한 지표로 버퍼 오버플로에 의존할 필요가 없다는 것을 의미합니다.

활성 대기열 관리 메커니즘은 엔드 노드에 정체를 표시하기 위해 여러 가지 방법 중 하나를 사용할 수 있습니다. 하나는 현재 수행되는 것처럼 패킷 삭제를 사용하는 것입니다. 그러나 활성 대기열 관리를 사용하면 라우터가 패킷을 대기열에 넣거나 삭제하는 정책과 정체를 나타내는 정책을 분리할 수 있습니다. 따라서 활성 대기열 관리를 통해 라우터는 패킷 삭제에만 의존하는 대신 패킷 헤더의 CE\(Congestion Experienced\) 코드 포인트를 정체 표시로 사용할 수 있습니다. 이는 대기 시간에 민감한 흐름에 대한 손실의 영향을 줄일 수 있는 잠재력을 가지고 있습니다.

인터넷에는 ECN을 협상하도록 구성된 TCP SYN 패킷을 삭제하거나 RST로 응답하는 일부 미들박스\(방화벽, 로드 밸런서 또는 침입 탐지 시스템\)가 있습니다. 이 문서에서는 그러한 장비가 있는 경우에도 강력한 연결을 제공하기 위해 TCP 구현이 사용할 수 있는 절차를 지정합니다.

---
## **2.  Conventions and Acronyms**

이 문서에 나타나는 키워드 MUST, MUST NOT, REQUIRED, SHALL, SHALL NOT, SHOULD, SHOULD NOT, RECOMMENDED, MAY 및 OPTIONAL은 \[RFC2119\]에 설명된 대로 해석됩니다.\(MUST NOT\)

---
## **3.  Assumptions and General Principles**

이 섹션에서는 이 제안서의 디자인 선택을 안내하는 중요한 디자인 원칙과 가정 중 일부를 설명합니다.

- \* ECN은 점진적으로 도입될 가능성이 높으므로 마이그레이션 수용이 필수적이다. 일부 라우터는 여전히 정체를 나타 내기 위해 패킷을 삭제할 수 있으며 일부 최종 시스템은 ECN을 지원하지 않을 수 있습니다. 가장 실행 가능한 전략은 ECN 지원 환경과 ECN 지원 불가능한 환경의 "섬"에 의존하지 않고도 증분 배포를 수용하는 전략입니다.

- \* 혼잡 제어 및 회피를 위한 새로운 메커니즘은 기존 혼잡 제어 메커니즘과 공존하고 협력해야 합니다. 특히, 새로운 메커니즘은 혼잡에 적응하는 TCP의 현재 방법 및 혼잡 기간에 패킷을 삭제하는 라우터의 현재 관행과 공존해야 합니다.

- \* 혼잡은 다양한 시간 규모에 걸쳐 지속될 수 있습니다. 우리가 관심을 갖는 시간 척도는 왕복 시간보다 오래 지속될 수 있는 혼잡 이벤트입니다.

\* 개별 흐름의 패킷 수\(예: TCP

- UDP를 사용한 연결 또는 교환\)은 적은 수의 패킷부터 상당히 많은 수의 패킷까지 다양할 수 있습니다. 우리는 네트워크 피드백이 도달할 때 여전히 활성화될 수 있도록 충분한 패킷을 보내는 흐름으로 인해 발생하는 정체를 관리하는 데 관심이 있습니다.

- \* 비대칭 라우팅은 인터넷에서 일반적으로 발생하는 현상입니다. 데이터 패킷이 따르는 경로\(링크 및 라우터의 순서\)는 반대 방향의 승인 패킷이 따르는 경로와 다를 수 있습니다.

- \* 많은 라우터는 IP 옵션의 헤더 정보를 처리하는 것보다 IP 패킷의 "일반" 헤더를 더 효율적으로 처리합니다. 이는 IP 패킷의 일반 헤더에 정체 경험 정보를 유지하는 것을 의미합니다.

- \* 모든 최종 시스템이 혼잡 제어 메커니즘에 협력하는 것은 아니라는 점을 인식해야 합니다. 그러나 새로운 메커니즘이 TCP 애플리케이션이 TCP 혼잡 제어를 비활성화하는 것을 더 쉽게 만들어서는 안 됩니다. ECN 기능과 같은 새로운 메커니즘에 참여한다고 거짓말을 하는 것의 이점은 작을 것입니다.

---
## **4.  Active Queue Management (AQM)**

무작위 조기 감지\(RED\)는 초기 혼잡을 감지하기 위해 제안된 AQM\(Active Queue Management\)을 위한 메커니즘 중 하나이며\[FJ93\], 현재 인터넷에 배포되고 있습니다\[RFC2309\]. AQM은 혼잡 표시에 대한 여러 대안 중 하나를 사용하는 일반적인 메커니즘이지만 ECN이 없는 경우 AQM은 패킷 삭제를 혼잡 표시 메커니즘으로 사용하도록 제한됩니다. AQM은 대기열이 오버플로되는 경우에만 패킷을 삭제하는 것이 아니라 임계값을 초과하는 평균 대기열 길이를 기준으로 패킷을 삭제합니다. 그러나 AQM은 대기열이 실제로 오버플로되기 전에 패킷을 삭제할 수 있으므로 메모리 제한으로 인해 AQM이 항상 패킷을 삭제하도록 강제되는 것은 아닙니다.

AQM은 이러한 필드가 IP 헤더에 제공되고 전송 프로토콜에서 이해되는 경우 패킷을 삭제하는 대신 패킷 헤더에 CE\(Congestion Experienced\) 코드 포인트를 설정할 수 있습니다. ECN과 함께 CE 코드 포인트를 사용하면 수신자가 패킷을 수신할 수 있으므로 패킷 손실 후 재전송으로 인한 과도한 지연 가능성을 피할 수 있습니다. CE 코드포인트가 설정된 패킷을 나타내기 위해 'CE 패킷'이라는 용어를 사용합니다.

---
## **5.  Explicit Congestion Notification in IP**

이 문서에서는 인터넷이 초기 혼잡에 대한 혼잡 표시\(RED 및 이전 작업 \[RJ90\]에서와 같이\)를 제공하도록 지정합니다. 여기서 알림은 때때로 패킷을 삭제하는 대신 표시를 통해 이루어질 수 있습니다. 이는 IP 헤더의 2비트 ECN 필드를 사용하여 4개의 ECN 코드 포인트\('00' \~ '11'\)를 만듭니다. ECN 가능 전송\(ECT\) 코드 포인트 '10' 및 '01'은 전송 프로토콜의 끝점이 ECN 가능임을 나타내기 위해 데이터 송신자에 의해 설정됩니다. 우리는 그것들을 각각 ECT\(0\)과 ECT\(1\)이라고 부릅니다. 이 문서에서 "ECT 코드 포인트"라는 문구는 두 개의 ECT 코드 포인트 중 하나를 나타냅니다. 라우터는 ECT\(0\) 및 ECT\(1\) 코드 포인트를 동일하게 처리합니다. 발신자는 패킷별로 ECT\(0\) 또는 ECT\(1\) 코드 포인트를 사용하여 ECT를 표시할 수 있습니다.

ECT에 대한 두 코드 포인트인 ECT\(0\) 및 ECT\(1\)를 모두 사용하는 것은 주로 데이터 전송자가 네트워크 요소가 CE 코드 포인트를 지우지 않고 데이터 수신기가 삭제되는지 확인하는 메커니즘을 허용하려는 욕구에서 비롯되었습니다. 전송 프로토콜에서 요구하는 대로 CE 코드포인트가 설정된 패킷의 수신을 발신자에게 적절하게 보고합니다. 발신자와 수신자가 ECT\(0\) 및 ECT\(1\) 코드 포인트를 구별하기 위한 지침은 각 전송 프로토콜에 대해 별도의 문서에서 다루어집니다. 특히 이 문서에서는 ECT\(0\)와 ECT\(1\) 코드 포인트를 구별하기 위한 TCP 엔드노드의 메커니즘을 다루지 않습니다. 단일 ECT 코드 포인트만 필요한 프로토콜 및 발신자는 ECT\(0\)를 사용해야 합니다.\(SHOULD\)

not-ECT 코드 포인트 '00'은 ECN을 사용하지 않는 패킷을 나타냅니다. CE 코드포인트 '11'은 엔드 노드에 대한 정체를 나타내기 위해 라우터에 의해 설정됩니다. 가득 찬 대기열에 도착하는 패킷이 있는 라우터는 ECN이 없을 때와 마찬가지로 패킷을 삭제합니다.

```text
      +-----+-----+
      | ECN FIELD |
      +-----+-----+
        ECT   CE         [Obsolete] RFC 2481 names for the ECN bits.
         0     0         Not-ECT
         0     1         ECT(1)
         1     0         ECT(0)
         1     1         CE
```

- 그림 1: IP의 ECN 필드.

두 개의 ECT 코드 포인트를 사용하면 기본적으로 패킷 헤더에 1비트 ECN nonce가 제공되며 라우터는 CE 코드 포인트를 설정할 때 반드시 nonce를 "삭제"합니다\[SCWA99\]. 예를 들어, CE 코드 포인트를 삭제한 라우터는 원래 nonce를 재구성하는 데 추가 어려움에 직면하게 되므로 CE 코드 포인트를 반복적으로 삭제하면 엔드 노드에서 감지될 가능성이 더 높아집니다. ECN nonce는 또한 패킷에 CE 코드 포인트가 설정되었는지 여부에 대해 전송 송신자에게 거짓말을 하는 잘못된 동작의 전송 수신자 문제를 해결할 수 있습니다. 두 개의 ECT 코드 포인트를 사용하는 동기는 네 번째 ECT 코드 포인트\(즉, 코드 포인트 '01'\)에 대한 대체 가능성에 대한 논의와 함께 섹션 20에서 더 자세히 논의됩니다. ECT\(1\) 코드 포인트를 이해하지 못하는 이전 ECN 구현과의 하위 호환성은 섹션 11에서 논의됩니다.

RFC 2481 \[RFC2481\]에서는 ECN 필드가 ECT\(ECN-Capable Transport\) 비트와 CE 비트로 구분되었습니다. RFC 2481에 설정된 ECT\(ECN-Capable Transport\) 비트만 있는 ECN 필드는 이 문서의 ECT\(0\) 코드 포인트에 해당하고, ECN 필드는

RFC 2481의 ECT 및 CE 비트는 이 문서의 CE 코드 포인트에 해당합니다. RFC 2481에서는 '01' 코드 포인트가 정의되지 않은 상태로 남아 있으며, 이는 단일 ECT 코드 포인트만 필요한 경우 ECT\(0\) 사용을 권장하는 이유입니다.

```text
         0     1     2     3     4     5     6     7
      +-----+-----+-----+-----+-----+-----+-----+-----+
      |          DS FIELD, DSCP           | ECN FIELD |
      +-----+-----+-----+-----+-----+-----+-----+-----+

        DSCP: differentiated services codepoint
        ECN:  Explicit Congestion Notification
```

- 그림 2: IP의 차별화된 서비스 및 ECN 필드.

IPv4 TOS 옥텟의 비트 6과 7은 ECN 필드로 지정됩니다. IPv4 TOS 옥텟은 IPv6의 트래픽 클래스 옥텟에 해당하며 ECN 필드는 두 경우 모두 동일하게 정의됩니다. IPv4 TOS 옥텟\[RFC791\] 및 IPv6 트래픽 클래스 옥텟에 대한 정의는 6비트 DS\(차별화 서비스\) 필드\[RFC2474, RFC2780\]로 대체되었습니다. 비트 6과 7은 \[RFC2474\]에 현재 사용되지 않는 것으로 나열되어 있으며 ECN에 대한 실험적 사용을 위해 승인된 것으로 RFC 2780에 지정되어 있습니다. 섹션 22에서는 TOS 옥텟의 간략한 역사를 제공합니다.

TOS 옥텟의 불안정한 기록으로 인해 이 문서에 지정된 ECN 필드의 사용은 ECN 이전의 이 두 비트의 이전 사용과 역호환성을 보장할 수 없습니다. 이러한 이전 버전과의 호환성 부족으로 인한 잠재적인 위험은 섹션 22에서 논의됩니다.

단일 CE 패킷의 ECN 가능 전송을 수신하면 최종 시스템에서 따르는 정체 제어 알고리즘은 기본적으로 \*단일\* 드롭 패킷에 대한 정체 제어 응답과 동일해야 합니다. 예를 들어, ECN 가능 TCP의 경우 소스 TCP는 패킷 삭제 또는 ECN 표시가 포함된 데이터 창에 대해 혼잡 창을 절반으로 줄여야 합니다.\(MUST\)

CE 패킷에 대한 혼잡 제어 응답이 삭제된 패킷에 대한 응답과 본질적으로 동일하도록 요구하는 한 가지 이유는 엔드 시스템과 라우터 모두에서 ECN의 점진적인 배포를 수용하기 위한 것입니다. 일부 라우터는 ECN 가능 패킷을 삭제할 수 있지만\(예: 정체 감지를 위해 동일한 AQM 정책 사용\) 다른 라우터는 동일한 정체 수준에 대해 CE 코드 포인트를 설정할 수 있습니다. 마찬가지로, 라우터는 비ECN 가능 패킷을 삭제할 수 있지만 이에 상응하는 ECN 가능 패킷에 CE 코드 포인트를 설정할 수 있습니다.

혼잡 수준. 패킷 삭제와 CE 코드 포인트에 대해 서로 다른 혼잡 제어 응답이 있는 경우 이는 서로 다른 흐름에 대해 불공정한 처리를 초래할 수 있습니다.

추가적인 목표는 왕복 시간 내에 여러 혼잡 표시에 여러 번 반응하는 것을 피하기 위해 최종 시스템이 데이터 창당 최대 한 번\(즉, 왕복 시간당 최대 한 번\) 혼잡에 반응해야 한다는 것입니다.

라우터의 경우, ECN 가능 패킷의 CE 코드 포인트는 라우터가 최종 노드에 대한 혼잡 표시로 패킷을 삭제한 경우에만 설정되어야 합니다. 라우터의 버퍼가 아직 가득 차지 않았고 라우터가 최종 노드에 초기 혼잡을 알리기 위해 패킷을 삭제할 준비가 된 경우, 라우터는 먼저 해당 패킷의 IP 헤더에 ECT 코드 포인트가 설정되어 있는지 확인해야 합니다. 그렇다면 라우터는 패킷을 삭제하는 대신 IP 헤더에 CE 코드 포인트를 설정할 수 있습니다.\(SHOULD, MAY\)

모든 엔드 노드가 ECN 가능 환경에서는 CE 코드 포인트 설정을 위한 새로운 기준과 CE 패킷에 대한 엔드 노드 반응을 위한 새로운 혼잡 제어 메커니즘을 개발할 수 있습니다. 그러나 이는 연구 문제이므로 이 문서에서는 다루지 않습니다.

CE 패킷\(즉, CE 코드 포인트가 설정된 패킷\)이 라우터에 의해 수신되면 CE 코드 포인트는 변경되지 않고 그대로 유지되며 패킷은 평소대로 전송됩니다. 심각한 정체가 발생하고 라우터의 대기열이 가득 차면 라우터는 새 패킷이 도착할 때 일부 패킷을 삭제할 수밖에 없습니다. 우리는 대다수의 최종 시스템이 ECN 지원이 되고 TCP 또는 기타 호환 가능한 혼잡 제어 메커니즘에 참여할 때 이러한 패킷 손실이 상대적으로 드물게 될 것으로 예상합니다. 적절하게 프로비저닝된 ECN 지원 환경에서 패킷 손실은 주로 일시적인 동안이나 비협력 소스가 있을 때 발생해야 합니다.

패킷을 삭제하는 대신 CE를 설정할 수 있는 경우에 대한 위의 논의는 기본적으로 모든 PHB\(Differentiated Services Per-Hop Behavior\) \[RFC 2475\]에 적용됩니다. PHB 사양은 규정 준수 구현이 CE 설정과 패킷 삭제 중에서 선택하는 방법에 대한 자세한 내용을 제공할 수 있지만 필수 사항은 아닙니다. 라우터는 발생하는 삭제가 혼잡 이외의 이유로 발생하거나 엔드 노드에 초기 혼잡을 나타내려는 욕구로 인해 발생하는 경우 패킷을 삭제하는 대신 CE를 설정해서는 안 됩니다\(예: diffserv 에지 노드는 특정 클래스의 무조건 삭제하도록 구성될 수 있음\). diffserv 도메인에 진입하는 것을 방지합니다\).\(MUST, MUST NOT\)

우리는 라우터가 \[FJ93, RFC2309\]에서 제안된 RED 알고리즘을 사용하여 평균 대기열 크기로 표시되는 초기 혼잡에 대한 응답으로 CE 코드 포인트를 설정할 것으로 예상합니다. 우리가 아는 한, 이는 버퍼 오버플로가 발생하기 전에 라우터가 사전에 패킷을 삭제하도록 IETF에서 현재 논의 중인 유일한 제안입니다. 그러나 이 문서에서는 활성 대기열 관리를 위한 특정 메커니즘을 지정하지 않으며 필요한 경우 IETF의 다른 영역에 해당 작업을 맡깁니다. ECN은 라우터에서 합리적인 활성 대기열 관리 메커니즘을 보유해야 하는 필요성과 불가분의 관계에 있지만 그 반대는 성립하지 않습니다. 활성 대기열 관리 메커니즘은 IP 아키텍처에 ECN이 없을 때 패킷 삭제를 정체 표시로 사용하여 ECN과 독립적으로 개발 및 배포되었습니다.

---
### **5.1.  ECN as an Indication of Persistent Congestion**

IP 패킷에 CE 코드포인트가 설정된 \*단일\* 패킷은 패킷 삭제에 대한 것처럼 전송 계층이 혼잡 제어 측면에서 응답하게 한다는 점을 강조합니다. 라우터에서 지속적인 정체가 발생하지 않는 경우에도 순간 대기열 크기는 상당한 변화를 보일 수 있습니다. 따라서 대기열의 용량보다 훨씬 작은 임계값에 도달하는 순간 대기열 크기에 의해 반영되는 라우터의 일시적 정체가 전송 계층에서 반응을 유발하지 않는 것이 중요합니다. 따라서 CE 코드포인트는 순간적인 큐 크기를 기반으로 라우터에 의해 설정되어서는 안 됩니다.

예를 들어 정체 표시를 위한 ATM 및 프레임 릴레이 메커니즘은 일반적으로 중간 노드가 정체되어 있는지 판단하는 기준으로 평균 대기열 크기와 관련된 개념 없이 정의되었기 때문에 매우 잡음이 많은 신호를 제공한다고 믿습니다. ECN에 대해 이 문서에 지정된 TCP 송신자 반응은 잡음이 많은 혼잡 알림 신호에 대한 적절한 반응이 아닙니다. 그러나 ATM 네트워크에 접속하는 라우터에 인터페이스에서 평균 대기열을 유지 관리하는 방법이 있고 이를 사용하여 ATM 서브넷이 혼잡하다는 확실한 결정을 내리는 경우 여기에 정의된 ECN 알림을 사용할 수 있습니다.

우리는 ECN을 활용하기 위해 레이어 2\(예: ATM 스위치 또는 프레임 릴레이 스위치\) 기술 실험을 계속 장려하고 있습니다. 예를 들어, RED\(패킷 표시가 임계값을 초과하는 평균 대기열 길이를 기반으로 함\)와 같은 방식을 사용하면 계층 2 장치는 합리적으로 신뢰할 수 있는 정체 표시를 제공할 수 있습니다. 경로의 모든 계층 2 장치가 해당 계층의 자체 혼잡 경험 코드포인트\(예: ATM의 경우 EFCI 비트, 프레임 릴레이의 FECN 비트\)를 이러한 안정적인 방식으로 설정하면 계층 2 네트워크에 대한 인터페이스 라우터는 상태를 복사할 수 있습니다. 그 레이어 2의

IP 헤더의 CE 코드포인트에 대한 혼잡 경험 코드포인트입니다. 우리는 이것이 현재의 관행이 아니며 현재 표준에도 없다는 것을 알고 있습니다. 그러나 이러한 방식으로 실험을 장려하면 혼잡을 표시하기 위해 단일 비트를 사용할 때 기존 계층 2 메커니즘이 보다 신뢰할 수 있는 혼잡 표시 수단을 제공하도록 진화하는 데 필요한 정보를 제공할 수 있습니다.

---
### **5.2.  Dropped or Corrupted Packets**

이 문서에서 제안된 ECN 사용에 대해\(즉, 삭제된 데이터 패킷이 혼잡을 나타내는 TCP와 같은 전송 프로토콜의 경우\) 끝 노드는 삭제된 데이터 패킷을 감지하고 이에 대한 끝 노드의 혼잡 응답을 감지합니다. 삭제된 데이터 패킷은 적어도 수신된 CE 패킷에 대한 혼잡 응답만큼 강력합니다. CE 코드포인트의 혼잡 표시의 안정적인 전달을 보장하기 위해 네트워크에서 해당 패킷의 손실이 최종 노드에 의해 감지되고 혼잡 표시로 해석되지 않는 한 ECT 코드포인트는 패킷에 설정되어서는 안 됩니다.\(MUST NOT\)

TCP와 같은 전송 프로토콜은 "순수한" ACK 패킷의 삭제와 같은 모든 패킷 삭제를 반드시 감지하지는 않습니다. 예를 들어, TCP는 이전에 삭제된 ACK 패킷에 대한 응답으로 후속 ACK 패킷의 도착 속도를 줄이지 않습니다. ECN 기능을 이러한 패킷으로 확장하기 위한 모든 제안은 CE 코드 포인트로 표시되었지만 나중에 네트워크에서 삭제된 ACK 패킷의 경우와 같은 문제를 해결해야 합니다. 우리는 이 측면이 여전히 연구 주제라고 믿기 때문에 이 문서에서는 현재 "순수한" ACK 패킷이 ECN 기능을 나타내서는 안 된다는 점을 명시하고 있습니다.\(MUST NOT\)

마찬가지로 손상\(비트 오류\)으로 인해 나중에 네트워크에서 CE 패킷이 삭제되는 경우 오늘날 TCP가 삭제된 데이터 패킷에 응답하는 것처럼 최종 노드는 여전히 정체 제어를 호출해야 합니다. 손상된 CE 패킷 문제는 네트워크가 손상으로 인해 삭제된 패킷과 혼잡 또는 버퍼 오버플로로 인해 삭제된 패킷을 구별하기 위한 모든 제안에서 고려되어야 합니다. 특히, ECN의 유비쿼터스 배포 자체만으로는 엔드 노드가 패킷 삭제를 혼잡이 아닌 손상의 징후로 해석할 수 있도록 하는 충분한 개발이 되지 않습니다.

---
### **5.3.  Fragmentation**

ECN 가능 패킷에는 DF\(Don't Fragment\) 비트 세트가 있을 수 있습니다. 조각난 패킷의 재조립은 혼잡 표시를 잃어서는 안 됩니다. 즉, 재조립할 IP 패킷의 조각에 CE 코드포인트 세트가 있는 경우 다음 두 가지 조치 중 하나를 취해야 합니다.\(MAY, MUST NOT, MUST\)

- \* 재조립된 패킷에 CE 코드포인트를 설정합니다. 그러나 이 재조립에 기여하는 다른 조각 중 하나라도 Not-ECT 코드 포인트를 전달하는 경우에는 이런 일이 발생해서는 안 됩니다.\(MUST NOT\)

- \* 다른 이유로 인해 패킷이 재조립되는 대신 삭제됩니다.

두 가지 작업이 모두 적용 가능한 경우 둘 중 하나를 선택할 수 있습니다. 조각화된 패킷의 재조립은 모든 조각이 동일한 코드포인트를 전달할 때 ECN 코드포인트를 변경해서는 안 됩니다.\(MAY, MUST NOT\)

RFC 2481은 리어셈블리 동작을 지정하지 않았기 때문에 해당 실험적 RFC를 준수하는 이전 ECN 구현은 조각에서 CE 코드 포인트를 보존한다는 측면에서 반드시 리어셈블리를 올바르게 수행하지는 않습니다. 송신자는 ECN 가능 패킷에 DF 비트를 설정하여 이 동작의 결과를 피할 수 있습니다.

위의 재조립 사양이 충분히 정확하지 않은 상황이 발생할 수 있습니다. 예를 들어, 조각화 지점이나 그 이후의 경로에 악의적이거나 손상된 엔터티가 있는 경우 패킷 조각은 ECT\(0\), ECT\(1\) 및/또는 Not-ECT 코드 포인트의 혼합을 전달할 수 있습니다. 위의 재조립 사양은 이 경우 파편 재조립에 대한 요구 사항을 제시하지 않습니다. 보다 정확한 리어셈블리 동작이 필요한 상황에서는 프로토콜 사양이 대신 프로토콜에서 보낸 모든 ECN 가능 패킷에 DF를 설정해야 함을 지정해야 합니다.\(MUST\)

---
## **6.  Support from the Transport Protocol**

ECN에는 IP 패킷 헤더의 ECN 필드에서 제공하는 기능 외에도 전송 프로토콜의 지원이 필요합니다. 전송 프로토콜은 발신자가 전송된 패킷에서 ECT 코드 포인트를 설정할 수 있도록 모든 엔드포인트가 ECN 가능인지 확인하기 위해 설정 중에 엔드포인트 간 협상이 필요할 수 있습니다. 둘째, 전송 프로토콜은 CE 패킷 수신에 적절하게 반응할 수 있어야 합니다. 이 반응은 데이터 수신기가 데이터 전송자에게 수신된 CE 패킷\(예: TCP\)을 알리거나, 데이터 수신기가 계층화된 멀티캐스트 그룹\(예: RLM \[MJV96\]\)에 대한 구독을 취소하거나 다른 작업을 알리는 형태일 수 있습니다. 이는 궁극적으로 혼잡한 링크에서 해당 흐름의 도착 속도를 줄입니다. CE 패킷은 일시적인 혼잡이 아닌 지속적인 혼잡을 나타내므로\(섹션 5.1 참조\), 따라서 CE 패킷 수신에 대한 반응은 지속적인 혼잡에 적합한 반응이어야 합니다.

이 문서에서는 TCP에 ECN 기능을 추가하는 것에 대해서만 다루고 다른 전송 프로토콜의 ECN 문제는 추가 연구로 남겨둡니다. TCP의 경우 ECN에는 세 가지 새로운 기능이 필요합니다.

연결 설정 중 엔드포인트 간 협상을 통해 둘 다 ECN 지원이 가능한지 확인합니다. CE 패킷이 수신되면 데이터 수신자가 데이터 송신자에게 알릴 수 있도록 TCP 헤더의 ECN-Echo\(ECE\) 플래그; 및 데이터 송신자가 데이터 수신자에게 혼잡 윈도우가 감소되었음을 알릴 수 있도록 TCP 헤더에 CWR\(Congestion Window Reduced\) 플래그를 포함합니다. 다른 전송 프로토콜에서 요구되는 지원은 특히 신뢰할 수 없거나 신뢰할 수 있는 멀티캐스트 전송 프로토콜의 경우 다를 수 있으며 표준화를 위해 다른 전송 프로토콜이 IETF에 도입될 때 결정되어야 합니다.

```text
   In a mild abuse of terminology, in this document we refer to `TCP
   packets' instead of `TCP segments'.
```

---
### **6.1.  TCP**

다음 섹션에서는 TCP에서 제안된 ECN 사용을 자세히 설명합니다. 이 제안은 \[Floyd94\]에서 본질적으로 동일한 형식으로 설명됩니다. 우리는 소스 TCP가 느린 시작, 빠른 재전송 및 빠른 복구 \[RFC2581\]의 표준 혼잡 제어 알고리즘을 사용한다고 가정합니다.

이 제안은 TCP 헤더의 예약 필드에 두 개의 새로운 플래그를 지정합니다. ECN 기능 협상을 위한 TCP 메커니즘은 TCP 헤더의 ECE\(ECN-Echo\) 플래그를 사용합니다. TCP 헤더의 Reserved 필드에 있는 비트 9는 ECN-Echo 플래그로 지정됩니다. TCP 헤더의 6비트 예약 필드 위치는 RFC 793 \[RFC793\]의 그림 4에 나와 있습니다\(완전성을 위해 아래에 다시 표시\). ECN 필드의 이 사양은 예약된 필드를 비트 4-7을 사용하는 4비트 필드로 남겨 둡니다.

TCP 수신기가 ECN-Echo 플래그 설정을 중지할 시기를 결정할 수 있도록 TCP 헤더에 두 번째 새 플래그인 CWR 플래그를 도입합니다. CWR 플래그는 TCP 헤더의 예약 필드에 있는 비트 8에 할당됩니다.

```text
        0   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15
      +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
      |               |                       | U | A | P | R | S | F |
      | Header Length |        Reserved       | R | C | S | S | Y | I |
      |               |                       | G | K | H | T | N | N |
      +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
```

- 그림 3: TCP 헤더의 바이트 13 및 14에 대한 이전 정의.

```text
        0   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15
      +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
      |               |               | C | E | U | A | P | R | S | F |
      | Header Length |    Reserved   | W | C | R | C | S | S | Y | I |
      |               |               | R | E | G | K | H | T | N | N |
      +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
```

- 그림 4: TCP 헤더의 바이트 13 및 14에 대한 새로운 정의.

따라서 ECN은 라우터와 연결 끝점 간의 신호 전달을 위해 IP 헤더의 ECT 및 CE 플래그\(그림 1 참조\)를 사용하고, TCP의 경우 TCP 헤더\(그림 4 참조\)에서 ECN-Echo 및 CWR 플래그를 사용합니다. -TCP 엔드포인트 신호에 대한 엔드포인트입니다. TCP 연결의 경우 정체에 대한 ECN 기반 반응의 일반적인 이벤트 순서는 다음과 같습니다.

- \* ECT 코드 포인트는 발신자가 전송한 패킷에 설정되어 해당 패킷에 대한 전송 엔터티에서 ECN을 지원함을 나타냅니다.

- \* ECN 지원 라우터는 임박한 정체를 감지하고 삭제하려는 패킷에 ECT 코드 포인트가 설정되어 있는지 감지합니다. 라우터는 패킷을 삭제하는 대신 IP 헤더에 CE 코드 포인트를 설정하고 패킷을 전달하도록 선택합니다.

- \* 수신자는 CE 코드 포인트가 설정된 패킷을 수신하고 발신자에게 전송되는 다음 TCP ACK에 ECN-Echo 플래그를 설정합니다.

- \* 송신자는 ECN-Echo가 설정된 TCP ACK를 수신하고, 혼잡에 대해 패킷이 삭제된 것처럼 반응합니다.

- \* 송신자는 수신자에게 전송되는 다음 패킷의 TCP 헤더에 CWR 플래그를 설정하여 ECN-Echo 플래그 수신 및 반응을 확인합니다.

TCP 전송 엔터티의 ECN 사용과 ECN-Echo 및 CWR 플래그 사용에 대한 협상은 아래 섹션에 자세히 설명되어 있습니다.

---
### **6.1.1  TCP Initialization**

TCP 연결 설정 단계에서 소스 및 대상 TCP는 ECN 사용 의사에 대한 정보를 교환합니다. 이 협상이 완료된 후 TCP 발신자는 데이터 패킷의 IP 헤더에 ECT 코드 포인트를 설정하여 전송이 가능하고 이 패킷에 대해 ECN에 참여할 의사가 있음을 네트워크에 나타냅니다. 이는 라우터가 이를 표시할 수 있음을 나타냅니다.

혼잡 알림 방법으로 사용하려는 경우 CE 코드 포인트가 포함된 패킷입니다. TCP 연결이 특정 패킷에 대해 ECN 알림을 사용하지 않으려는 경우 송신 TCP는 ECN 코드 포인트를 not-ECT로 설정하고 TCP 수신자는 수신된 패킷의 CE 코드 포인트를 무시합니다.

이 논의에서는 시작 호스트를 호스트 A로 지정하고 응답 호스트를 호스트 B로 지정합니다. ECE 및 CWR 플래그가 "ECN-setup SYN 패킷"으로 설정된 SYN 패킷을 호출하고 최소한 SYN 패킷을 호출합니다. ECE 및 CWR 플래그 중 하나가 "비ECN 설정 SYN 패킷"을 설정하지 않았습니다. 마찬가지로 ECE 플래그만 설정되어 있지만 CWR 플래그는 "ECN 설정 SYN-ACK 패킷"으로 설정되지 않은 상태에서 SYN-ACK 패킷을 호출하고 ECE 및 CWR 플래그의 다른 구성을 사용하여 SYN-ACK 패킷을 호출합니다. "비ECN 설정 SYN-ACK 패킷"입니다.

TCP 연결이 ECN을 사용하기 전에 호스트 A는 ECN 설정 SYN 패킷을 보내고 호스트 B는 ECN 설정 SYN-ACK 패킷을 보냅니다. SYN 패킷의 경우 ECN 설정 SYN 패킷의 ECE 및 CWR 설정은 정체 또는 정체에 대한 응답을 나타내는 것이 아니라 전송 TCP가 ECN 가능이라는 표시로 정의됩니다. 보다 정확하게는 ECN 설정 SYN 패킷은 SYN 패킷을 전송하는 TCP 구현이 ECN에 송신자 및 수신자로 참여함을 나타냅니다. 특히, 수신자로서 나가는 TCP 승인\(ACK\) 패킷에 ECE를 설정하여 IP 헤더에 CE 코드 포인트가 설정된 들어오는 데이터 패킷에 응답합니다. 발신자로서 혼잡 창을 줄이고 적절한 경우 CWR을 설정하여 ECE가 설정된 수신 패킷에 응답합니다. ECN 설정 SYN 패킷은 TCP 발신자가 전송할 수 있는 패킷 중 일부 또는 전부에서 ECT 코드 포인트를 설정하도록 커밋하지 않습니다. 그러나 이 TCP 연결 내에서 이후 전송에서 TCP 발신자가 ECE 및 CWR 설정 없이 SYN 패킷을 보내는 경우에도 CE 코드 포인트가 설정된 수신 패킷에 적절하게 응답하겠다는 약속은 유지됩니다.

호스트 B가 ECN 설정 SYN-ACK 패킷을 보낼 때 ECE 플래그는 설정하지만 CWR 플래그는 설정하지 않습니다. ECN-setup SYN-ACK 패킷은 SYN-ACK 패킷을 전송하는 TCP가 ECN-Capable임을 나타내는 것으로 정의됩니다. SYN 패킷과 마찬가지로 ECN 설정 SYN-ACK 패킷은 TCP 호스트가 전송된 패킷에 ECT 코드 포인트를 설정하도록 커밋하지 않습니다.

다음 규칙은 TCP 연결 내의 ECN 설정 패킷 전송에 적용됩니다. 여기서 TCP 연결은 TCP 연결 설정 및 종료에 대한 표준 규칙에 의해 정의됩니다.

- \* 호스트가 ECN 설정 SYN 패킷을 수신한 경우 ECN 설정 SYN-ACK 패킷을 보낼 수 있습니다. 그렇지 않으면 ECN 설정 SYN-ACK 패킷을 보내면 안 됩니다.\(MAY, MUST NOT\)

- \* 호스트는 적어도 하나의 ECN-setup SYN 또는 ECN-setup SYN-ACK 패킷을 전송하고 적어도 하나의 ECN-setup SYN 또는 ECN-setup SYN-ACK 패킷을 수신하지 않는 한 데이터 패킷에 ECT를 설정해서는 안 됩니다. 비ECN 설정 SYN 또는 비ECN 설정 SYN-ACK 패킷을 전송하지 않았습니다. 호스트가 하나 이상의 비ECN 설정 SYN 또는 비ECN 설정 SYN-ACK 패킷을 수신한 경우 데이터 패킷에 ECT를 설정해서는 안 됩니다.\(MUST NOT, SHOULD NOT\)

- \* 호스트가 데이터 패킷에 ECT 코드 포인트를 설정한 경우 해당 호스트는 연결의 모든 후속 패킷에서 CWR TCP 비트를 올바르게 설정/삭제해야 합니다.\(MUST\)

- \* 호스트가 하나 이상의 ECN-setup SYN 또는 ECN-setup SYN-ACK 패킷을 전송하고 비ECN-setup SYN 또는 비ECN-setup SYN-ACK 패킷을 수신하지 않은 경우 해당 호스트가 TCP를 수신하는 경우 IP 헤더에 ECT 및 CE 코드 포인트가 설정된 데이터 패킷이 있는 경우 해당 호스트는 ECN 지원 연결에 대해 지정된 대로 이러한 패킷을 처리해야 합니다.\(MUST\)

- \* TCP 연결에서 ECN을 사용할 의사가 없는 호스트는 이러한 의사를 나타내기 위해 전송하는 모든 비ECN 설정 SYN 및/또는 SYN-ACK 패킷에서 ECE 및 CWR 플래그를 모두 지워야 합니다. 수신기는 ECN 설정이 아닌 SYN 및 SYN-ACK 패킷의 모든 형태를 올바르게 처리해야 합니다.\(SHOULD, MUST\)

- \* 호스트는 SYN 또는 SYN-ACK 패킷에 ECT를 설정해서는 안 됩니다.\(MUST NOT\)

TCP 클라이언트는 FIN-ACK를 수신한 후 TIME-WAIT 상태로 진입하고, 타임아웃 후 CLOSED 상태로 전환됩니다. 많은 TCP 구현에서는 TIME-WAIT 상태 동안 창 내 SYN 패킷을 받으면 새로운 TCP 연결을 만듭니다. TCP 호스트가 TIME-WAIT 또는 CLOSED 상태에 들어갈 때 해당 연결에 대한 ECN 협상에 대한 이전 상태를 무시해야 합니다.

---
##### **6.1.1.1.  Middlebox Issues**

ECN은 초기화를 위해 TCP 헤더\(그림 3 참조\)에 ECN-Echo 및 CWR 플래그를 사용합니다. 인터넷에는 ECN 설정 SYN 패킷을 삭제하거나 RST로 응답하는 일부 결함이 있는 방화벽, 로드 밸런서 및 침입 감지 시스템이 존재합니다. 이러한 패킷\(이러한 비트가 설정됨\)은 포트의 서명이라고 믿습니다. - 서비스 거부 공격에 사용될 수 있는 검색 도구입니다. 문제가 있는 장비 중 일부가 확인되었으며 웹 페이지 \[FIXES\]에는 비호환 제품 목록과 공급업체에서 게시한 수정 사항이 포함되어 있습니다. TBIT 웹 페이지 \[TBIT\]에는 이 결함이 있는 장비의 영향을 받는 일부 웹 서버가 나열되어 있습니다. 우리는 이 문제에 대해 커뮤니티에 경고하기 위해 이 문서에서 이것을 언급합니다.

이러한 결함이 있는 장비가 있는 경우에도 강력한 연결을 제공하기 위해 ECN 설정 SYN 패킷의 전송에 대한 응답으로 RST를 수신하는 호스트는 CWR 및 ECE가 지워진 SYN을 다시 보낼 수 있습니다. 이로 인해 ECN을 사용하지 않고 TCP 연결이 설정될 수 있습니다.\(MAY\)

일반적인 SYN 재전송 시간 초과 간격 내에 ECN 설정 SYN에 대한 응답을 받지 못한 호스트는 CWR 및 ECE가 지워진 상태에서 SYN과 후속 SYN 재전송을 다시 보낼 수 있습니다. 원래 SYN이 손실되는 일반적인 패킷 손실을 극복하기 위해 원래 호스트는 포기하고 CWR 및 ECE 비트가 지워진 SYN을 재전송하기 전에 하나 이상의 ECN 설정 SYN 패킷을 재전송할 수 있습니다.\(MAY\)

이 경우 다음과 같은 예시 시나리오가 가능합니다.

\(1\) 호스트 A: ECN 설정 SYN을 보냅니다. \(2\) 호스트 B: ECN 설정 SYN/ACK를 전송하면 패킷이 삭제되거나 지연됩니다. \(3\) 호스트 A: ECN 설정이 아닌 SYN을 보냅니다. \(4\) 호스트 B: ECN 설정이 아닌 SYN/ACK를 보냅니다.

이 경우 위의 절차에 따라 호스트 A나 호스트 B 모두 데이터 패킷에 ECT 비트를 설정할 수 없습니다. 또한 섹션 6.1.1의 ECN 설정 및 사용 규칙의 중요한 결과는 호스트가 다른 호스트가 ECN을 사용할 수 있다는 암시적 신호로 ECT 데이터 패킷의 수신을 사용하는 것이 금지된다는 것입니다.

---
##### **6.1.1.2.  Robust TCP Initialization with an Echoed Reserved Field**

SYN을 보내는 TCP가 SYN 패킷에 대한 TCP 헤더의 예약 필드에 두 개의 ECN 관련 플래그를 설정하도록 선택한 반면, SYN-ACK를 보내는 응답 TCP는 하나의 ECN 관련 플래그만 설정하도록 선택한 이유에 대한 질문이 있습니다. SYN-ACK 패킷에서. 이러한 비대칭성은 배포된 일부 TCP 구현과 ECN 기능을 강력하게 협상하는 데 필요합니다. TCP 수신기가 단순히 수신된 데이터 패킷에 있는 TCP 헤더의 예약 필드를 반영하기 위해 ACK 패킷\(따라서 SYN-ACK\)에 TCP 헤더의 예약 필드를 설정하는 잘못된 TCP 구현이 하나 이상 존재합니다. TCP SYN 패킷은 ECN-능력을 나타내기 위해 ECN-Echo 및 CWR 플래그를 설정하는 반면, SYN-ACK 패킷은 ECN-Echo 플래그만 설정하기 때문에 송신 TCP는 예약 필드에 있는 자체 플래그에 대한 수신자의 반영을 다음과 같이 올바르게 해석합니다. 수신기가 ECN을 지원하지 않는다는 표시입니다. 보내는 TCP는 단순히 들어오는 SYN 패킷의 예약 필드를 반영하는 SYN-ACK 패킷을 보내는 잘못된 TCP 구현으로 인해 오해를 받지 않습니다.

---
#### **6.1.2.  The TCP Sender**

ECN을 사용하는 TCP 연결의 경우 새 데이터 패킷은 IP 헤더에 설정된 ECT 코드 포인트와 함께 전송됩니다. TCP 연결에서 전송된 모든 패킷에 대해 발신자가 하나의 ECT 코드 포인트만 필요한 경우 ECT\(0\)를 사용해야 합니다. 송신자가 ECN-Echo\(ECE\) ACK 패킷\(즉, TCP 헤더에 ECN-Echo 플래그가 설정된 ACK 패킷\)을 수신하면 송신자는 자신이 보낸 경로의 네트워크에 정체가 발생했음을 알게 됩니다. 수신기에. 정체 표시는 ECN 가능 TCP가 아닌 경우 정체 손실과 마찬가지로 처리되어야 합니다. 즉, TCP 소스는 혼잡 창 "cwnd"를 절반으로 줄이고 느린 시작 임계값 "ssthresh"를 줄입니다. 송신 TCP는 ECN-Echo ACK 패킷 수신에 대한 응답으로 혼잡 창을 늘려서는 안 됩니다.\(SHOULD, SHOULD NOT\)

TCP는 데이터 창마다 한 번 이상\(또는 더 느슨하게 말하면 왕복 시간마다 한 번 이상\) 정체 표시에 반응해서는 안 됩니다. 즉, TCP 송신자의 혼잡 창은 단일 데이터 창에서 일련의 삭제 및/또는 CE 패킷에 대한 응답으로 한 번만 줄어들어야 합니다. 또한 TCP 소스는 느린 시작 임계값인 ssthresh가 마지막 왕복 시간 내에 감소한 경우 이를 줄여서는 안 됩니다. 그러나 재전송된 패킷이 삭제되면 소스 TCP는 이를 새로운 정체 인스턴스로 해석합니다.

소스 TCP가 CE 패킷에 대한 응답으로 정체 창을 줄인 후 계속해서 도착하는 수신 승인은 감소된 정체 창에서 허용하는 대로 나가는 패킷을 "클럭아웃"할 수 있습니다. 혼잡 창이 하나의 MSS\(최대 세그먼트 크기\)로만 구성되고 송신 TCP가 ECN-Echo ACK 패킷을 수신하는 경우 송신 TCP는 원칙적으로 여전히 혼잡 창을 절반으로 줄여야 합니다. 그러나 혼잡 윈도우의 값은 하나의 MSS 값 아래로 제한됩니다. 송신 TCP가 1 MSS의 정체 창을 사용하여 계속해서 송신하는 경우 왕복 시간당 하나의 패킷이 전송됩니다. 혼잡 창이 1일 때 ECN-Echo 패킷을 수신하면 TCP 송신자의 전송 속도를 더욱 줄여야 합니다. 이 상황에서 속도를 더 낮추는 수단으로 재전송 타이머를 사용합니다. 따라서 전송 TCP는 혼잡 창이 1일 때 ECN-Echo 패킷을 수신할 때 재전송 타이머를 재설정해야 합니다. 그러면 송신 TCP는 재전송 타이머가 만료될 때만 새 패킷을 보낼 수 있습니다.\(MUST\)

ECN 지원 TCP 발신자가 어떤 이유로든\(재전송 시간 초과, 빠른 재전송 또는 ECN 알림에 대한 응답으로 인해\) 정체 창을 줄이는 경우 TCP 발신자는 첫 번째 새 데이터의 TCP 헤더에 CWR 플래그를 설정합니다. 창 축소 후에 패킷이 전송됩니다. 해당 데이터 패킷이 네트워크에서 삭제되면

TCP를 보내는 것은 혼잡 창을 다시 줄이고 삭제된 패킷을 다시 전송해야 합니다.

우리는 "Congestion Window Reduced" 정보가 TCP 수신자에게 안정적으로 전달되도록 보장합니다. 이는 CWR 플래그를 전달하는 새 데이터 패킷이 삭제되면 TCP 송신자가 다시 혼잡 창을 줄이고 CWR 플래그가 설정된 또 다른 새 데이터 패킷을 보내야 한다는 사실에서 비롯됩니다. 따라서 TCP 헤더의 CWR 비트는 재전송된 패킷에 설정되어서는 안 됩니다.\(SHOULD NOT\)

TCP 데이터 송신자가 혼잡 창을 줄인 후 CWR 비트를 설정할 준비가 되면 전송하는 첫 번째 새 데이터 패킷에만 CWR 비트를 설정해야 합니다.\(SHOULD\)

\[Floyd94\]에서는 ECN에 대한 TCP의 응답을 더 자세히 설명합니다. \[Floyd98\]에서는 광범위한 ECN 시나리오를 보여주는 ns 시뮬레이터의 검증 테스트에 대해 설명합니다. 이러한 시나리오에는 다음이 포함됩니다. ECN 다음에 다른 ECN, 빠른 재전송 또는 재전송 시간 초과; 재전송 시간 초과 또는 ECN이 뒤따르는 빠른 재전송; ECN이 뒤따르는 하나의 패킷의 혼잡 창.

TCP는 들어오는 ACK, 다중 중복 승인 또는 재전송 시간 초과\[RFC2581\]에 대한 응답으로 데이터 패킷을 보내기 위한 기존 알고리즘을 따릅니다. 또한 TCP는 ECN-Echo 비트 세트\[RFC2581\] 없이 ACK 패킷을 수신할 때 혼잡 창을 늘리는 일반적인 절차를 따릅니다.

---
#### **6.1.3.  The TCP Receiver**

TCP가 대상 엔드 시스템에서 CE 데이터 패킷을 수신하면 TCP 데이터 수신자는 후속 ACK 패킷의 TCP 헤더에 ECN-Echo 플래그를 설정합니다. TCP 수신기가 도착하는 두 개의 데이터 패킷에 대해 ACK를 보낼 수 있는 현재의 "지연된 ACK" TCP 구현에서와 같이 구현된 ACK 보류가 있는 경우 ACK 패킷의 ECN-Echo 플래그는 다음과 같은 경우 '1'로 설정됩니다. CE 코드포인트는 승인되는 데이터 패킷 중 하나에 설정됩니다. 즉, 수신된 데이터 패킷 중 CE 패킷이 있는 경우 반환되는 ACK에는 ECN-Echo 플래그가 설정됩니다.

ECN-Echo 플래그를 전달하는 삭제된 ACK 패킷의 가능성에 대한 견고성을 제공하기 위해 TCP 수신기는 이후에 전송되는 일련의 ACK 패킷에 ECN-Echo 플래그를 설정합니다. TCP 수신자는 TCP 송신자로부터 수신한 CWR 플래그를 사용하여 ECN-Echo 플래그 설정을 중지할 시기를 결정합니다.

TCP 수신기가 ECN-Echo 비트가 설정된 ACK 패킷을 전송한 후 해당 TCP 수신기는 전송하는 모든 ACK 패킷에 ECN-Echo 플래그를 계속 설정합니다\(CE 데이터 패킷을 승인하든 비-CE를 승인하든 관계 없음\).

CWR 패킷\(CWR 플래그가 설정된 패킷\)을 수신할 때까지 데이터 패킷\)을 전송합니다. CWR 패킷을 수신한 후 후속 비CE 데이터 패킷에 대한 승인에는 ECN-Echo 플래그가 설정되지 않습니다. 데이터 수신기가 다른 CE 패킷을 수신하면 수신기는 ECN-Echo 플래그가 설정된 ACK 패킷을 다시 한 번 보냅니다. CWR 패킷 수신이 데이터 보낸 사람이 ECN-Echo 메시지를 받았다는 것을 보장하지는 않지만, 이는 데이터 보낸 사람이 CE 코드 포인트가 설정된 데이터 패킷을 보낸 \*후\* 어느 시점에서 혼잡 창을 줄였다는 것을 의미합니다. .

우리는 이미 TCP 발신자가 데이터 창당 혼잡 창을 두 번 이상 줄일 필요가 없다고 지정했습니다. 데이터 창에 삭제된 패킷과 \(표시된\) CE 패킷이 모두 포함되어 있을 때 TCP 발신자가 혼잡 창을 불필요하게 줄이는 것을 방지하려면 약간의 주의가 필요합니다. 이는 \[Floyd98\]에 설명되어 있습니다.

---
#### **6.1.4.  Congestion on the ACK-path**

현재 세대의 TCP 혼잡 제어 알고리즘의 경우 순수 승인 패킷\(예: 수반되는 데이터가 포함되지 않은 패킷\)은 not-ECT 코드 포인트와 함께 전송되어야 합니다. 현재 TCP 수신기에는 정체 알림에 대한 응답으로 ACK 경로의 트래픽을 줄이는 메커니즘이 없습니다. ACK 경로의 혼잡에 대응하는 메커니즘은 현재와 미래의 연구 분야입니다. \(한 가지 간단한 가능성은 송신자가 CE 코드 포인트가 설정된 순수 ACK 패킷을 수신할 때 혼잡 창을 줄이는 것입니다.\) 현재 TCP 구현의 경우 단일 삭제 ACK는 일반적으로 TCP의 전송 속도에 매우 작은 영향을 미칩니다.\(MUST\)

---
#### **6.1.5.  Retransmitted TCP packets**

이 문서에서는 ECN 가능 TCP 구현이 재전송된 데이터 패킷에 대해 IP 헤더에 ECT 코드 포인트\(ECT\(0\) 또는 ECT\(1\)\)를 설정해서는 안 되며, TCP 데이터 수신기가 도착하는 데이터 패킷에서 ECN 필드를 무시해야 한다고 명시합니다. 수신자의 현재 창을 벗어났습니다. 이는 서비스 거부 공격에 대한 보안을 강화하고 네트워크에서 나중에 삭제되는 패킷에 대한 ECN 정체 표시의 견고성을 높이기 위한 것입니다.\(MUST NOT\)

첫째, TCP 발신자가 재전송된 패킷에 ECT 코드 포인트를 설정한 경우 불필요하게 재전송된 패킷이 나중에 네트워크에서 삭제되면 최종 노드는 CE를 설정하는 라우터로부터 정체 표시를 결코 수신하지 못합니다. 코드포인트. 따라서 재전송된 데이터 패킷에 ECT 코드 포인트를 설정하는 것은 나중에 네트워크에서 삭제되는 패킷에 대해서도 혼잡 표시의 강력한 전달과 일치하지 않습니다.

또한 TCP 발신자의 IP 소스 주소를 스푸핑할 수 있는 공격자는 IP 헤더에 CE 코드 포인트가 설정된 임의의 시퀀스 번호를 사용하여 데이터 패킷을 보낼 수 있습니다. 이 스푸핑된 데이터 패킷을 수신하면 TCP 데이터 수신기는 데이터가 현재 수신 창에 있지 않다고 판단하고 중복 승인을 반환합니다. 우리는 TCP 데이터 수신기에서 창 밖 패킷을 수신기의 현재 창 외부에 있는 데이터 패킷으로 정의합니다. Out-of-window 패킷을 수신하면 TCP 데이터 수신자는 패킷 헤더의 CE 코드 포인트를 유효한 혼잡 표시로 처리할지 여부를 결정해야 하며 이에 따라 ECN-Echo 표시를 TCP 데이터 발신자에게 반환할지 여부를 결정해야 합니다. . TCP 데이터 수신자가 창 외부 패킷의 CE 코드 포인트를 무시한 경우 TCP 데이터 송신자는 네트워크로부터 합법적일 수 있는 정체 표시를 수신하지 못하여 종단간 정체 제어를 위반하게 됩니다. 반면에, TCP 데이터 수신기가 out-of-window 패킷의 CE 표시를 따르고 TCP 데이터 송신자에게 정체 표시를 보고하면 스푸핑된 out-of-window 패킷을 생성한 악성 노드가 됩니다. 데이터 송신자가 혼잡 창을 불필요하게 줄이도록\(반으로 줄임\) TCP 연결을 성공적으로 "공격"했습니다. 이러한 서비스 거부 공격을 방지하기 위해 우리는 합법적인 TCP 데이터 발신자가 재전송된 데이터 패킷에 ECT 코드 포인트를 설정해서는 안 되며, TCP 데이터 수신기는 창 밖 패킷의 CE 코드 포인트를 무시해야 한다고 지정합니다.\(MUST NOT\)

재전송된 패킷에 ECT\(0\) 또는 ECT\(1\)을 설정하지 않을 때의 한 가지 단점은 재전송된 패킷에 대한 ECN 보호를 거부한다는 것입니다. 그러나 약간의 정체가 있는 완전한 ECN 가능 환경에서 ECN 가능 TCP 연결의 경우 애초에 정체로 인해 패킷이 삭제되는 경우가 거의 없으므로 재전송된 패킷의 인스턴스가 거의 발생하지 않아야 합니다. 패킷이 재전송되는 경우 ECN이 방지할 수 없는 패킷 손실\(손상 또는 정체로 인해\)이 이미 있는 것입니다.

라우터가 TCP 연결 내에서 ECN 가능 데이터 패킷에 대한 CE 코드 포인트를 설정하면 TCP 연결은 해당 정체 표시를 수신하거나 동일한 데이터 창 내에서 다른 정체 표시를 수신하도록 보장됩니다. 이 패킷이 네트워크에서 삭제되거나 재정렬되더라도 마찬가지입니다. 패킷이 나중에 재전송되는 경우와 패킷이 나중에 재전송되지 않는 경우를 고려합니다.

첫 번째 경우, 패킷이 삭제되거나 지연되고 어느 시점에서 데이터 송신자에 의해 재전송되면 재전송은 해당 패킷 또는 동일한 패킷의 일부 이전 패킷에 대한 빠른 재전송 또는 재전송 시간 초과의 결과입니다. 데이터 창. 이 경우 데이터 송신자가 이미 이 패킷을 재전송했기 때문에 데이터 송신자가 이미 응답을 했다는 것을 알 수 있습니다.

원래 패킷과 동일한 데이터 창 내에서 일부 패킷의 정체를 나타냅니다. 따라서 패킷의 첫 번째 전송이 네트워크에서 누락되거나 지연되더라도 CE 코드포인트가 설정되어 있고 나중에 데이터 수신자에서 out-of-window 패킷으로 무시된다면 이는 문제가 되지 않습니다. , 왜냐하면 발신자가 해당 데이터 창에 대한 정체 표시에 이미 응답했기 때문입니다.

두 번째 경우, 데이터 송신자가 패킷을 재전송하지 않으면 이 데이터 패킷은 데이터 수신자가 수신한 이 데이터의 유일한 복사본이므로 방법에 관계없이 창 내 패킷으로 데이터 수신기에 도착합니다. 패킷이 지연되거나 재정렬될 수 있습니다. 이 경우 CE 코드 포인트가 네트워크 내의 패킷에 설정되어 있으면 데이터 수신기에서 이를 혼잡의 유효한 표시로 처리합니다.

---
#### **6.1.6.  TCP Window Probes.**

TCP 데이터 수신기가 0 창을 알리면 TCP 데이터 송신기는 창 프로브를 보내 수신기의 창이 증가했는지 확인합니다. 윈도우 프로브 패킷에는 바이트인 시퀀스 번호를 제외하고는 사용자 데이터가 포함되어 있지 않습니다. 윈도우 프로브 패킷이 네트워크에서 삭제되면 이 손실은 수신기에서 감지되지 않습니다. 따라서 TCP 데이터 송신자는 윈도우 프로브 패킷에 ECT 코드포인트나 CWR 비트를 설정해서는 안 됩니다.\(MUST NOT\)

그러나 윈도우 프로브는 정확한 시퀀스 번호를 사용하기 때문에 서비스 거부 공격에서 쉽게 스푸핑될 수 없습니다. 따라서 윈도우 프로브가 CE 코드포인트 세트와 함께 도착하면 수신기는 ECN 표시에 응답해야 합니다.\(SHOULD\)

---
## **7.  Non-compliance by the End Nodes**

이 섹션에서는 비준수 엔드 노드\(즉, 전송된 패킷에 ECT 코드 포인트를 설정하지만 수신된 CE 패킷에 응답하지 않는 엔드 노드\)에 대한 ECN의 취약성에 대한 우려를 논의합니다. 우리는 IP 아키텍처에 ECN을 추가한다고 해서 응답하지 않는 흐름에 대한 아키텍처의 현재 취약성이 크게 증가하지는 않을 것이라고 주장합니다.

비ECN 환경의 경우에도 비준수 또는 응답하지 않는 흐름\(즉, 혼잡한 링크에서 도착 속도를 줄여 혼잡 제어 표시에 응답하지 않는 흐름\)으로 인해 발생할 수 있는 피해에 대한 심각한 우려가 있습니다. 예를 들어, 엔드 노드는 패킷 삭제에 대한 응답으로 혼잡 창을 줄이지 않음으로써 "혼잡 제어를 해제"할 수 있습니다. 이것이 현재 인터넷의 관심사이다. 라우터는 패킷을 감지하고 차등 처리하기 위한 메커니즘을 배포해야 한다고 주장되어 왔습니다.

비준수 흐름 \[RFC2309,FF99\]. 또한 엔드투엔드 흐름별 예약 및 한 흐름을 다른 흐름과 격리하는 기술, 차별화된 서비스 또는 엔드투엔드 예약과 같은 기술을 통해 응답하지 않는 흐름의 더 해로운 영향 중 일부를 제거할 수 있다는 제안도 있었습니다.

패킷을 삭제하는 것 자체가 비준수에 대한 적절한 억제 수단이며 ECN을 사용하면 이러한 억제 효과가 제거되는 것처럼 보일 수 있습니다. 우리는 이에 대한 응답으로 \(1\) ECN 가능 라우터는 혼잡이 심한 시간에도 패킷 삭제 동작을 유지합니다. \(2\) 혼잡이 심한 경우에도 패킷 삭제 자체는 비준수에 대한 적절한 억제 수단이 아닙니다.

첫째, ECN 지원 라우터는 패킷 표시 속도가 합리적으로 낮은 경우에만 패킷을 삭제하는 것이 아니라 패킷을 표시합니다. 평균 대기열 크기가 상한 임계값을 초과하여 잠재적인 패킷 표시 비율이 높아지는 기간 동안에는 라우터가 패킷 헤더에 CE 코드 포인트를 설정하는 대신 패킷을 삭제하는 것이 좋습니다.

ECN이 배포될 때 패킷 표시 속도가 낮거나 보통인 기간에는 해당 패킷을 표시하는 것보다 응답하지 않는 삭제 흐름에 대한 억제 효과가 거의 없습니다. 예를 들어 안정적인 전달을 사용하는 지연에 민감하지 않은 흐름은 패킷 손실이 있을 때 전송 속도를 낮추기보다는 증가시키는 인센티브를 가질 수 있습니다. 마찬가지로, 신뢰할 수 없는 전달을 사용하는 지연에 민감한 흐름은 증가된 패킷 삭제 비율에 대한 응답으로 FEC 사용을 증가시켜 전송 속도를 감소시키기보다는 오히려 증가시킬 수 있습니다. 같은 이유로 우리는 모든 흐름이 동일한 패킷 삭제율을 공유하는 높은 패킷 삭제율 환경에서도 패킷 삭제 자체가 비준수에 대한 효과적인 억제 수단이라고 믿지 않습니다.

비준수 또는 응답하지 않는 흐름을 식별하고 제한하기 위해 여러 가지 방법이 제안되었습니다. 네트워크 환경에 ECN을 추가한다고 해서 그러한 메커니즘을 설계하고 배포하는 것이 어떤 식으로든 어려워지는 것은 아닙니다. 오히려 아키텍처에 ECN을 추가하면 응답하지 않는 흐름을 식별하는 작업이 약간 더 쉬워질 것입니다. 예를 들어, ECN 가능 환경에서 라우터는 삭제된 패킷에 대한 정보로 제한되지 않거나 해당 라우터 자체에 CE 코드 포인트가 설정되어 있습니다. 이러한 환경에서 라우터는 경로의 앞부분에서 해당 패킷에 의해 발생한 정체를 나타내는 도착 CE 패킷을 기록할 수도 있습니다.

---
## **8.  Non-compliance in the Network**

이 섹션에서는 라우터가 ECN 필드의 비트 중 하나를 수정하기 위해 악의적으로 작동할 때 발생하는 문제를 고려합니다. IPv4에서는 IP 헤더가 헤더 체크섬을 통해 비트 오류로부터 보호됩니다. IPv6에서는 그렇지 않습니다. 따라서 IPv6의 경우 ECN 필드는 IP 헤더 체크섬에 의해 감지되지 않고 링크나 라우터의 비트 오류로 인해 실수로 수정될 수 있습니다.

ECN 필드의 비트를 조작함으로써 공격자\(또는 손상된 라우터\)는 다음 중 하나 이상을 수행할 수 있습니다. 혼잡을 허위로 보고, 개별 패킷에 대해 ECN 기능을 비활성화하거나 ECN 혼잡 표시를 삭제하거나 ECN을 허위로 표시 -능력. 18절에서는 ECN 분야가 수정될 수 있는 다양한 사례를 체계적으로 검토한다. 그러한 수정의 결과를 결정할 때 고려되는 중요한 기준은 라우터가 패킷을 삭제하는 경우보다 모든 차원\(처리량, 지연, 공정성 또는 기능\)에서 더 나쁜 동작으로 이어질 가능성이 있는지 여부입니다.

정체를 잘못 보고하거나 개별 패킷에 대해 ECN 기능을 비활성화하는 처음 두 가지 가능한 변경 사항은 라우터가 단순히 패킷을 삭제하는 경우보다 나쁘지 않습니다. 혼잡 제어 관점에서 비호환 라우터에 의한 혼잡이 없을 때 CE 코드 포인트를 설정하는 것은 라우터가 불필요하게 패킷을 삭제하는 것보다 나쁘지 않습니다. 나중에 네트워크에서 삭제되는 패킷의 ECT 코드 포인트를 "삭제"하면 라우터의 작업으로 인해 나중에 네트워크에서 해당 패킷에 대한 불필요한 패킷 삭제가 발생할 수 있습니다.

그러나 섹션 18에서 설명한 것처럼 ECN 혼잡 표시를 지우거나 ECN 기능을 잘못 표시하는 라우터는 단순히 패킷을 삭제한 경우보다 흐름에 더 많은 손상을 입힐 수 있습니다. 도착하는 CE 패킷에서 CE 코드 포인트를 "삭제"하는 불량 또는 손상된 라우터는 정체 표시가 다운스트림 수신기에 도달하는 것을 방지합니다. 이로 인해 해당 흐름에 대한 정체 제어가 실패하고 네트워크의 정체가 증가하여 궁극적으로 정체된 게이트웨이에서 평균 대기열 크기가 증가함에 따라 이 흐름에 대한 후속 패킷이 삭제될 수 있습니다.

섹션 19에서는 ECN-Capability를 잘못 표시하거나 ECN\(CE-코드 포인트\)에서 혼잡 표시를 삭제하여 종단 간 혼잡 제어를 파괴하는 잠재적인 영향을 고려합니다. 우리는 섹션 19에서 ECN 기반 혼잡 제어를 파괴하는 결과가 잠재적인 불공정으로 이어질 수 있음을 관찰합니다. 그러나 이는 최종 노드에 의한 ECN 기반 또는 패킷 기반 혼잡 제어의 파괴보다 나쁘지 않을 가능성이 높습니다.

---
### **8.1.  Complications Introduced by Split Paths**

라우터나 다른 네트워크 요소가 흐름의 모든 패킷에 액세스할 수 있는 경우 해당 라우터는 단순히 해당 흐름에서 모든 패킷을 삭제하는 것보다 ECN 필드를 변경하여 흐름에 더 이상 손상을 줄 수 없습니다. 그러나 어떤 경우에는 악의적이거나 손상된 라우터가 흐름의 패킷 하위 집합에만 액세스할 수 있습니다. 질문은 다음과 같습니다. 이 라우터가 패킷 하위 집합의 ECN 필드를 변경함으로써 단순히 해당 패킷 집합을 삭제한 경우보다 해당 흐름에 더 많은 손상을 줄 수 있습니까?

이에 대해서는 섹션 18에서 자세히 논의하며 다음과 같이 결론을 내립니다. 전체 패킷의 하위 집합에만 액세스할 수 있는 공격자가 ECN 기반 혼잡 제어를 파괴하여 패킷의 이점을 거부할 수 있다는 것은 사실입니다. ECN을 다른 패킷에 통합합니다. 이는 바람직하지 않지만 ECN을 비활성화할 만큼 충분한 우려 사항은 아닙니다.

---
## **9.  Encapsulated Packets**
---
### **9.1.  IP packets encapsulated in IP**

터널 내 IP 패킷 헤더 캡슐화는 IPsec 및 IP in IP를 비롯한 여러 곳에서 사용됩니다\[RFC2003\]. 이 섹션에서는 ECN과 IP 터널 간의 상호 작용과 관련된 문제를 고려하고 두 가지 대체 솔루션을 지정합니다. 이 논의는 차별화된 서비스와 다양한 형태의 IP 터널 간의 상호 작용에 대한 RFC 2983의 논의\[RFC 2983\]로 보완됩니다. 차별화된 서비스는 ECN에서 사용하는 IP 헤더 옥텟의 나머지 6비트를 사용하기 때문입니다\(섹션 5의 그림 2 참조\). .

일부 IP 터널 모드는 원래 또는 "내부" IP 헤더 및 관련 패킷을 캡슐화하는 새로운 "외부" IP 헤더 추가를 기반으로 합니다. 많은 경우 새로운 "외부" IP 헤더는 연결을 따라 중간 지점에서 추가 및 제거될 수 있으므로 네트워크는 엔드포인트 참여 없이 터널을 설정할 수 있습니다. 터널 출구에서 외부 헤더가 삭제되도록 지정하는 터널을 "단순 터널"로 표시합니다.

ECN은 라우터와 연결 끝점 간의 신호 전달을 위해 IP 헤더의 ECN 필드를 사용합니다. ECN은 IP 헤더의 ECN 필드 처리를 기반으로 IP 터널과 상호 작용합니다. 단순 IP 터널에서 ECN 필드를 포함하는 옥텟은 IP 터널 수신 시 내부 IP 헤더에서 외부 IP 헤더로 복사되거나 매핑되며, 이 필드의 외부 헤더 사본은 IP 터널 송신 시 삭제됩니다. ECN 필드를 처리하지 않고 외부 헤더를 단순히 폐기하고 ECN 가능 라우터가 CE를 설정하는 경우

\(혼잡 경험\) 단순 IP 터널의 패킷 내 코드 포인트, 이 표시는 터널 출구에서 폐기되어 정체 표시를 잃습니다.

따라서 단순 IP 터널을 통해 ECN을 사용하면 라우터가 외부 IP 헤더를 사용하여 끝점에 정체 신호를 보내려고 시도하지만 외부 헤더가 터널 출구 지점에서 삭제되기 때문에 이러한 정체 경고가 도착하지 않습니다. 이 문제는 터널 모드의 ECN 및 IPsec에서 발생했으며 RFC 2481에서는 이 동작과 그 결과를 방지하기 위해 ECN을 이전 단순 IPsec 터널과 함께 사용하지 말 것을 권장했습니다. ECN이 널리 배포되면 ECN 지원 트래픽을 전달할 가능성이 있는 간단한 터널을 변경해야 합니다. ECN 가능 트래픽이 혼잡한 ECN 가능 라우터를 통해 단순 터널을 통해 전달되는 경우 위의 섹션 8에서 설명한 것처럼 혼잡한 라우터에서 평균 대기열 크기가 증가함에 따라 이 흐름에 대한 후속 패킷이 삭제될 수 있습니다.

보안 관점에서 IP 터널의 외부 헤더에 ECN을 사용하면 공격자가 터널 끝점 너머로 전파되는 ECN 정보를 변조할 수 있으므로 보안 문제가 발생할 수 있습니다. 이러한 우려 사항에 대한 섹션 18 및 19의 분석과 그에 따른 위험을 바탕으로 우리의 전반적인 접근 방식은 ECN 지원을 IP 터널에 대한 옵션으로 만들어 IP 터널이 ECN을 사용하거나 사용하지 않도록 지정하거나 구성할 수 있도록 하는 것입니다. 터널 외부 헤더의 ECN. 따라서 ECN 사용에 따른 위험이 이점보다 더 크다고 판단되는 환경이나 터널링 프로토콜에서는 터널이 외부 헤더에서 ECN을 사용할 수 없습니다. 그러면 터널 내의 라우터에서 발생하는 정체에 대한 유일한 표시는 패킷 손실을 통해서입니다.

결과적으로 IPsec 터널을 포함하여 IP 터널을 통한 ECN 지원 연결 동작에 대해 두 가지 실행 가능한 옵션이 있습니다.

- \* ECN이 내부 헤더에 유지되지만 외부 헤더에서는 비활성화되는 제한된 기능 옵션입니다. 이 경우 터널 내에서 발생하는 신호 정체에 사용할 수 있는 유일한 메커니즘은 패킷 삭제입니다.

- \* 내부 및 외부 헤더 모두에서 ECN을 지원하고 터널 내의 노드에서 엔드포인트로 정체 경고를 전파하는 전체 기능 옵션입니다.

이러한 옵션을 지원하려면 터널 수신 및 송신 시 IP 헤더 처리에 다양한 양의 변경이 필요합니다. 제한된 기능 옵션만 지원하기에 충분한 이러한 변경 사항 중 작은 하위 집합은 ECN과 IP 터널 간의 비호환성을 제거하는 데 충분합니다.

이 문서의 목표 중 하나는 제한된 기능 옵션과 전체 기능 옵션 간의 장단점에 대한 지침을 제공하는 것입니다. 적의 ECN 필드 수정으로 인한 잠재적 영향에 대한 전체 논의는 섹션 18과 19에 나와 있습니다.

---
#### **9.1.1.  The Limited-functionality and Full-functionality Options**

IP 터널의 ECN 캡슐화에 대한 제한된 기능 옵션은 내부\(캡슐화\) 헤더의 ECN 필드 값에 관계없이 외부\(캡슐화\) 헤더에 not-ECT 코드 포인트를 설정하는 것입니다. 이 옵션을 사용하면 내부 헤더의 ECN 필드가 캡슐화 해제 시 변경되지 않습니다. 이 접근 방식의 단점은 원래 TCP 발신자의 캡슐화된 패킷이 ECN 지원이더라도 흐름이 IP 터널링을 사용하는 경로 부분에 대해 ECN을 지원하지 않는다는 것입니다. 즉, 캡슐화된 패킷이 ECN 가능 혼잡 라우터에 도착하고 라우터가 패킷을 삭제하거나 최종 노드에 대한 혼잡 표시로 표시하기로 결정할 수 있는 경우 라우터는 CE 코드 포인트를 설정하는 것이 허용되지 않습니다. 대신 패킷을 삭제해야 합니다.

ECN 캡슐화의 전체 기능 옵션은 내부 헤더가 ECT 또는 ECT가 아닌 경우 캡슐화 시 내부 헤더의 ECN 코드 포인트를 외부 헤더에 복사하고 외부 헤더의 ECN 코드 포인트를 ECT\(0\)으로 설정하는 것입니다. 내부 헤더의 ECN 코드 포인트가 CE인 경우. 캡슐화 해제 시 CE 코드 포인트가 외부 헤더에 설정되면 CE 코드 포인트도 내부 헤더에 설정됩니다. 그렇지 않으면 내부 헤더의 ECN 코드 포인트가 변경되지 않고 그대로 유지됩니다. 즉, 전체 ECN 지원을 위해 캡슐화 및 캡슐화 해제 처리에는 다음이 포함됩니다. 터널 수신 시 전체 기능 옵션은 외부 헤더에 ECN 코드 포인트를 설정합니다. 내부 헤더의 ECN 코드 포인트가-ECT 또는 ECT가 아닌 경우 외부 헤더의 ECN 코드 포인트에 복사됩니다. 내부 헤더의 ECN 코드 포인트가 CE인 경우 외부 헤더의 ECN 코드 포인트는 ECT\(0\)으로 설정됩니다. 터널 출구에서 캡슐화 해제 시 전체 기능 옵션은 CE 코드포인트가 외부 헤더에 설정된 경우 내부 헤더에 CE 코드포인트를 설정합니다. 그렇지 않으면 내부 헤더의 이 필드가 변경되지 않습니다.

전체 기능 옵션을 사용하면 흐름이 IP 터널링을 사용할 수 있는 경로 부분에서 ECN을 활용할 수 있습니다. 보안 관점에서 전체 기능 옵션의 단점은 IP 터널이 터널 내 IP 헤더의 ECN 비트에 대한 특정 수정으로부터 흐름을 보호할 수 없다는 것입니다. IP 헤더의 ECN 비트 수정으로 인한 잠재적 위험은 섹션 18 및 19에 자세히 설명되어 있습니다.

- \(1\) IP 터널은 제한된 기능 또는 전체 기능 옵션을 구현하여 IP 터널 끝점에서 DS 필드 옥텟의 처리를 수정해야 합니다.\(MUST\)

- \(2\) 선택적으로, IP 터널은 IP 터널의 엔드포인트가 터널의 ECN에 대한 제한된 기능 옵션과 전체 기능 옵션 사이의 선택을 협상하도록 할 수 있습니다.\(MAY\)

IP 터널에서 ECN을 사용할 수 있도록 하는 데 필요한 최소 기능은 제한된 기능 옵션으로, 이는 터널의 외부 헤더에서 ECN이 활성화되지 않도록 합니다. ECN을 완벽하게 지원하려면 전체 기능 옵션을 사용해야 합니다. 제한된 기능 또는 전체 기능 옵션 사이의 선택을 협상하기 위한 터널 끝점에 대한 선택적 메커니즘이 없는 경우 제한된 기능 또는 전체 기능을 지원할지 여부에 대해 터널 끝점 간에 기존 계약이 있을 수 있습니다. ECN 옵션.

모든 IP 터널은 제한된 기능 옵션을 구현해야 하며\(MUST\) 전체 기능 옵션을 지원해야 합니다\(SHOULD\).\(MUST\)

또한 외부 헤더에 CE 코드 포인트가 있는 패킷이 제한된 기능 옵션을 사용하는 터널 또는 전체 기능 옵션을 사용하지만 not-ECT 코드 포인트가 내부 헤더에 설정되어 있습니다. 이는 이전 버전과의 호환성과 ECN 필드의 무단 수정이 발생하지 않도록 보장하기 위한 것이며 다음 섹션\(9.1.2\)에서 자세히 설명합니다.\(SHOULD\)

---
#### **9.1.2.  Changes to the ECN Field within an IP Tunnel.**

IP 터널 모드 패킷의 내부 헤더에 ECN 필드 복사본이 있으면 외부 헤더의 ECN 필드에 대한 무단 수정을 탐지할 수 있는 기회가 제공됩니다. 내부 헤더와 외부 헤더의 ECT 필드 비교는 이 문서를 준수하는 구현에 대해 두 가지 범주로 나뉩니다.

- \* IP 터널이 전체 기능 옵션을 사용하는 경우 내부 헤더에도 설정되어 있는 경우에만 외부 헤더에 not-ECT 코드포인트를 설정해야 합니다.

- \* 터널이 제한된 기능 옵션을 사용하는 경우 외부 헤더에 not-ECT 코드 포인트를 설정해야 합니다.

적절한 조건을 만족하지 않는 패킷을 수신하면 문제가 발생할 수 있습니다.

터널 수신 지점은 이 문서의 요구 사항에 맞게 업데이트되지 않았지만 터널 송신 지점은 ECN을 지원하도록 업데이트된 IP 터널의 경우를 생각해 보세요. 이 경우 IP 터널은 모든 기능을 갖춘 ECN 옵션을 지원하도록 명시적으로 구성되지 않습니다. 그러나 터널 수신 지점은 전체 기능 옵션을 지원하는 터널 수신 지점과 동일하게 작동합니다. ECN 지원 연결의 패킷이 이 터널을 사용하는 경우 ECT 코드 포인트는 터널 수신 지점의 외부 헤더에 설정됩니다. 터널 내의 정체로 인해 ECN 지원 라우터가 외부 헤더에 CE를 설정할 수 있습니다. 터널이 전체 기능 옵션을 지원하도록 명시적으로 구성되지 않았기 때문에 터널 송신 지점에서는 외부 헤더에 not-ECT 코드 포인트가 설정될 것으로 예상합니다. ECN 가능 터널 송신 포인트가 전체 기능 옵션을 지원하도록 구성되지 않은 터널에서 외부 헤더에 ECT 또는 CE 코드 포인트가 있는 패킷을 수신하면 해당 패킷은 CE 코드 포인트 여부에 따라 처리되어야 합니다. 아래와 같이 설정되었습니다. 전체 기능 옵션을 지원하도록 구성되지 않은 터널에서 CE 코드 포인트가 외부 헤더에 설정되어 있지만 내부 헤더에는 설정되지 않은 경우 패킷은 송신 지점에서 삭제되어야 하고, 그렇지 않으면 전달되어야 하는 것이 권장됩니다. .\(SHOULD\)

IP 터널은 ECN 코드 포인트를 CE에서 ECT로 변경하는 것에 따른 정체 표시 삭제에 대한 보호를 제공할 수 없습니다. 정체 표시를 삭제하면 ECN이 없으면 불가능한 방식으로 네트워크 및 기타 흐름에 영향을 미칠 수 있습니다. 혼잡 표시의 삭제는 터널 내의 노드에 의해 배치된 혼잡 표시에 대해서만 수행될 수 있다는 점에 유의하는 것이 중요합니다. 내부 헤더의 ECN 필드 사본은 터널 수신의 업스트림 노드로부터의 혼잡 알림을 보존합니다\(내부 헤더도 삭제되지 않는 한\). 혼잡 알림 삭제가 ECN의 혼잡 관리 이점을 초과하는 보안 위험으로 판단되면 제한된 기능 옵션을 사용하도록 터널을 지정하거나 구성할 수 있습니다.

---
### **9.2.  IPsec Tunnels**

```text
   IPsec supports secure communication over potentially insecure network
   components such as intermediate routers.  IPsec protocols support two
   operating modes, transport mode and tunnel mode, that span a wide
   range of security requirements and operating environments.  Transport
   mode security protocol header(s) are inserted between the IP (IPv4 or
   IPv6) header and higher layer protocol headers (e.g., TCP), and hence
   transport mode can only be used for end-to-end security on a
   connection.  IPsec tunnel mode is based on adding a new "outer" IP
   header that encapsulates the original, or "inner" IP header and its
   associated packet.  Tunnel mode security headers are inserted between
   these two IP headers.  In contrast to transport mode, the new "outer"
```

IP 헤더 및 터널 모드 보안 헤더는 연결을 따라 중간 지점에서 추가 및 제거될 수 있으므로 보안 게이트웨이가 보안 프로토콜에 엔드포인트 참여를 요구하지 않고도 연결의 취약한 부분을 보호할 수 있습니다. 터널 모드 보안의 중요한 측면은 원래 사양에서는 터널 출구에서 외부 헤더가 삭제되어 IP 헤더 수정에 따른 보안 위협이 해당 터널 끝점 이상으로 전파되지 않도록 한다는 것입니다. IPsec에 대한 자세한 내용은 \[RFC2401\]에서 확인할 수 있습니다.

\[ESP, AH\]에 원래 정의된 IPsec 프로토콜에서는 내부 헤더의 ECN 필드가 터널 출구 노드에서 IPsec 캡슐화 해제 처리에 의해 변경되지 않도록 요구했습니다. 이는 ECN의 전체 기능 모드 가능성을 배제했을 것입니다. 동시에, ECN 필드에 대한 적의 수정 사항이 IPsec 터널 끝점에서 도난 또는 서비스 거부 공격을 시작하는 데 사용될 수 없도록 보장합니다. 이러한 수정 사항은 터널 끝점에서 삭제되기 때문입니다.

원칙적으로 IPsec 터널의 외부 헤더에서 ECN 기능의 사용을 허용하면 공격자가 터널 끝점 너머로 전파되는 정보를 변조할 수 있으므로 보안 문제가 발생합니다. 이러한 우려 사항과 관련 위험에 대한 분석\(섹션 18 및 19에 포함\)을 기반으로 우리의 전반적인 접근 방식은 ECN과의 충돌을 제거하기 위해 IPsec 변경에 대한 구성 지원을 제공하는 것이었습니다.

특히 터널 모드에서 IPsec 터널은 섹션 9.1.1에 설명된 제한된 기능 옵션을 지원해야 하며 섹션 9.1.1에 설명된 전체 기능 옵션을 지원해야 합니다.\(MUST\)

이를 통해 IPsec 터널의 외부 헤더에 있는 ECN 기능을 사용할 수 있는 권한이 해당 IPsec 보안 연결\(SA\)의 구성 가능한 부분이 되어 위험이 이점보다 더 크다고 판단되는 상황에서는 비활성화될 수 있습니다. 결과적으로 IPsec 보안 관리자에게는 IPsec 터널 내의 ECN 지원 연결 동작에 대한 두 가지 대안, 즉 앞에서 설명한 기능이 제한된 대안과 전체 기능 대안이 제공됩니다.

또한 이 문서에서는 IPsec 터널의 끝점이 보안 정책을 기반으로 해당 터널의 외부 헤더에서 ECN 기능 활성화를 협상할 수 있는 방법을 지정합니다. 터널 끝점 간에 ECN 사용을 협상하는 기능을 통해 보안 관리자는 위험\(예: 정체 알림 손실\)이 ECN의 이점보다 크다고 생각하는 상황에서 ECN을 비활성화할 수 있습니다.

\[ESP, AH\]에 정의된 IPsec 프로토콜은 암호화 계산에 IP 헤더의 ECN 필드를 포함하지 않습니다\(터널 모드의 경우 외부 IP 헤더의 ECN 필드는 포함되지 않음\). 따라서 네트워크 노드에 의한 ECN 필드 수정은 IPsec 무결성 검사가 실패할 수 없기 때문에 IPsec의 종단 간 보안에 영향을 주지 않습니다. 결과적으로, IPsec은 적의 ECN 필드 수정\(즉, 중간자 공격\)에 대해 어떠한 방어도 제공하지 않습니다. 적의 수정도 IPsec의 종단 간 보안에 영향을 주지 않기 때문입니다. 일부 환경에서는 IPsec 무결성 검사에 영향을 주지 않고 ECN 필드를 수정하는 기능이 비밀 채널을 구성할 수 있습니다. 이러한 채널을 제거하거나 대역폭을 줄여야 하는 경우 IPsec 터널은 제한된 기능 모드에서 실행되어야 합니다.

---
#### **9.2.1.  Negotiation between Tunnel Endpoints**

이 섹션에서는 터널 끝점 간의 ECN 지원 협상을 포함하여 IPsec 터널을 통한 ECN 사용을 활성화하기 위한 자세한 변경 사항을 설명합니다. 이는 IPsec에 대한 세 가지 변경 사항으로 지원됩니다.

- \* 터널 캡슐화 및 캡슐화 해제 처리가 외부 IP 헤더에서 ECN 사용을 허용하거나 금지하는지 여부를 나타내는 선택적 SAD\(보안 연결 데이터베이스\) 필드입니다.

\* 다음을 가능하게 하는 선택적 보안 연관 속성

- 터널 모드를 지원하는 SA의 두 끝점 사이에서 이 SAD 필드를 협상합니다.

\* 터널 모드 캡슐화 및 캡슐화 해제 변경

- SAD 필드의 값을 기반으로 외부 IP 헤더에서 ECN 사용을 허용하거나 금지하는 처리입니다. 외부 IP 헤더에서 ECN 사용이 허용되면 ECN 지원 연결에 대한 외부 헤더에 ECT 코드 포인트가 설정되고 이러한 연결의 정체 알림\(CE 코드 포인트로 표시됨\)은 터널 송신 시 내부 헤더로 전파됩니다.

ECN 사용 협상이 구현되면 SAD 필드도 구현되어야 합니다. 반면, SAD 필드를 지원하는 구현의 경우에도 ECN 사용 협상은 모든 경우에 선택 사항입니다. 캡슐화 및 캡슐화 해제 처리 변경 사항은 필수이지만 ECN 사용이 항상 금지되어 있다고 가정하여 다른 두 가지 변경 사항 없이 구현할 수 있습니다. IPsec 터널을 통한 ECN 사용을 위한 전체 기능 대안은 선택적 협상 지원 유무에 관계없이 SAD 필드와 캡슐화 및 캡슐화 해제 처리 변경 사항의 전체 버전으로 구성됩니다. 제한된 기능 대안은 항상 ECN 사용을 금지하는 캡슐화 및 캡슐화 해제 변경 사항의 하위 집합으로 구성됩니다.\(SHOULD, MAY, MUST, MAY\)

이러한 변경 사항은 다음 세 가지 하위 섹션에서 자세히 다룹니다.

---
##### **9.2.1.1.  ECN Tunnel Security Association Database Field**

전체 ECN 기능은 SAD에 새 필드를 추가합니다\(\[RFC2401\] 참조\).

- ECN 터널: 허용 또는 금지.

- 터널 모드에서 이 SA를 사용하는 ECN 가능 연결이 터널 내에서 발생하는 정체에 대한 ECN 정체 알림을 수신하도록 허용되는지 여부를 나타냅니다. 허용되는 값은 ECN 정체 알림을 활성화합니다. 금지된 값은 이러한 알림을 비활성화하여 삭제된 패킷을 통해 모든 정체가 표시되도록 합니다.

- \[선택사항. 이 필드의 값은 이를 지원하지 않는 구현에서 "금지"된 것으로 가정해야 합니다.\]\(MAY, SHOULD\)

이 속성이 구현된 경우 보안 정책 데이터베이스\(SPD\) 항목의 SA 사양은 해당 속성을 지원해야 하며 이 SPD 속성은 SPD 관리 인터페이스\(현재 \[RFC2401\]의 섹션 4.4.1에 설명되어 있음\)에 의해 다루어져야 합니다. .\(MUST\)

---
##### **9.2.1.2.  ECN Tunnel Security Association Attribute**

IPsec 터널에 대해 협상될 외부 IP 헤더를 기반으로 ECN 혼잡 알림에 대한 지원을 활성화하기 위해 새로운 IPsec 보안 연결 속성이 정의되었습니다\(\[RFC2407\] 참조\). 이 속성은 선택 사항이지만 이를 지원하는 구현은 섹션 9.2.1.1에 정의된 SAD 필드도 지원해야 합니다.\(SHOULD\)

```text
   Attribute Type

           class               value           type
     -------------------------------------------------
     ECN Tunnel                 10             Basic
```

IPsec SA 속성 값 10은 ECN 터널 SA 속성이 협상되고 있음을 나타내기 위해 IANA에 의해 할당되었습니다. 이 속성의 유형은 기본입니다\(\[RFC2407\]의 섹션 4.5 참조\). 클래스 값은 협상을 수행하는 데 사용됩니다. 이 SA 속성 협상을 위한 인코딩 형식 및 요구 사항을 포함한 추가 정보는 \[RFC2407, RFC2408, RFC2409\]를 참조하세요.

```text
   Class Values

   ECN Tunnel
```

ECN 기능을 터널 캡슐화 모드와 함께 사용할 수 있는지 여부를 지정합니다. 이는 터널 캡슐화 및 캡슐화 해제 처리에 영향을 미칩니다. 섹션 9.2.1.3을 참조하세요.

```text
   RESERVED          0
   Allowed           1
   Forbidden         2
```

값 3-61439는 IANA에 예약되어 있습니다. 값 61440-65535는 개인용입니다.

지정하지 않으면 기본값은 금지된 것으로 간주됩니다.

ECN 터널은 새로운 SA 속성이므로 이를 사용하는 개시자는 이를 이해하지 못하는 응답자를 만나 이를 포함하는 제안을 거부할 것으로 예상할 수 있습니다. 이러한 구현과의 하위 호환성을 위해 개시자는 항상 ECN 터널 속성이 없는 제안을 포함하여 해당 응답자가 ECN 터널 속성을 포함하지 않는 변환이나 제안을 선택할 수 있도록 해야 합니다. RFC 2407에서는 현재 응답자가 알 수 없는 속성이 포함된 제안이 있는 경우 모든 제안을 거부하도록 요구합니다. 이 요구 사항은 응답자가 알 수 없는 속성이 포함된 제안이나 변환을 선택하지 않도록 변경될 것으로 예상됩니다.\(SHOULD\)

---
##### **9.2.1.3.  Changes to IPsec Tunnel Header Processing**

완전한 ECN 지원을 위해 IPv4 TOS 필드와 IPv6 트래픽 클래스 필드에 대한 캡슐화 및 캡슐화 해제 처리가 \[RFC2401\]에 지정된 것에서 다음과 같이 변경되었습니다.

```text
                        <-- How Outer Hdr Relates to Inner Hdr -->
                        Outer Hdr at                 Inner Hdr at
   IPv4                 Encapsulator                 Decapsulator
     Header fields:     --------------------         ------------
       DS Field         copied from inner hdr (5)    no change
       ECN Field        constructed (7)              constructed (8)

   IPv6
     Header fields:
       DS Field         copied from inner hdr (6)    no change
       ECN Field        constructed (7)              constructed (8)
```

- \(5\)\(6\) 패킷이 외부 헤더의 DSCP 값이 적절하지 않은 도메인에 즉시 진입하는 경우 해당 값은 도메인 \[RFC 2474\]에 대한 적절한 값에 매핑되어야 합니다. 자세한 내용은 \[RFC 2475\]를 참조하세요.\(MUST\)

- \(7\) 이 SA에 대한 SAD 항목의 ECN 터널 필드 값이 "허용"이고 내부 헤더의 ECN 필드가 CE 이외의 값으로 설정된 경우 이 ECN 필드를 외부 헤더에 복사합니다. 내부 헤더의 ECN 필드가 CE로 설정된 경우 외부 헤더의 ECN 필드를 ECT\(0\)로 설정합니다.

- \(8\) 이 SA에 대한 SAD 항목의 ECN 터널 필드 값이 "허용"이고 내부 헤더의 ECN 필드가 ECT\(0\) 또는 ECT\(1\)로 설정되고 외부 헤더의 ECN 필드가 설정된 경우 헤더가 CE로 설정된 경우 외부 헤더의 ECN 필드를 내부 헤더로 복사합니다. 그렇지 않으면 내부 헤더의 ECN 필드를 변경하지 마십시오.

- \(5\)와 \(6\)은 \[RFC2401\]의 match 사용법과 동일하지만, \[RFC2401\]에서는 다르다.

위의 설명은 SAD에서 ECN 터널 필드를 지원하는 구현에 적용됩니다. 이러한 구현은 \[RFC2401\]에 정의된 IPv4 TOS 옥텟 및 IPv6 트래픽 클래스 옥텟의 처리 대신 이 처리를 구현해야 합니다. 이는 IPsec 터널과 함께 ECN 사용을 위한 전체 기능 대안을 구성합니다.\(MUST\)

SAD의 ECN 터널 필드를 지원하지 않는 구현은 SAD의 ECN 터널 필드 값이 모든 SA에 대해 "금지"된다는 것을 가정하여 이 처리를 구현해야 합니다. 이 경우 ECN 필드의 처리는 다음과 같이 줄어듭니다.\(MUST\)

\(7\) 외부 헤더에서 ECN 필드를 not-ECT로 설정합니다.

- \(8\) 내부 헤더의 ECN 필드를 변경하지 마십시오.

이는 IPsec 터널과 함께 ECN 사용에 대한 제한된 기능 대안을 구성합니다.

이전 버전과의 호환성을 위해 외부 헤더에 CE 코드 포인트가 설정된 패킷은 제한된 기능 옵션을 사용하거나 ECN 코드 포인트가 아닌 전체 기능 옵션을 사용하는 SA에 도착하면 삭제되어야 합니다. 내부 헤더.\(SHOULD\)

---
#### **9.2.2.  Changes to the ECN Field within an IPsec Tunnel.**

ECN 필드가 IPsec 터널 내에서 부적절하게 변경되고 이 변경이 터널 출구에서 감지되는 경우 해당 SA에 대한 적절한 조건을 충족하지 않는 패킷 수신은 감사 가능한 이벤트입니다. 구현은 각각의 잘못된 패킷에 대해 감사 레코드를 생성하는 대신 일정 기간 동안 SA별 잘못된 패킷 수로 감사 레코드를 생성할 수 있습니다. 그러한 감사 기록은 적어도 하나의 잘못된 패킷의 헤더를 포함해야 하지만 항목이 나타내는 모든 패킷의 헤더를 포함할 필요는 없습니다.\(MAY, SHOULD\)

---
#### **9.2.3.  Comments for IPsec Support**

IPsec 작업 그룹이 검토하는 동안 이 문서의 두 가지 영역에 대해 상당한 의견이 접수되었습니다. 이 섹션에서는 이러한 의견을 설명하고 제안된 변경 사항이 통합되지 않은 이유를 설명합니다.

첫 번째 의견은 노드별 구성이 SA별 구성보다 구현하기 쉽다는 점을 나타냅니다. 진지하게 생각해보고 초기에 노드별 구성을 권장했음에도 불구하고 이는 더 이상 좋은 생각이 아닌 것 같습니다. 문제는 ECN 인식이 IPsec에 점진적으로 배포됨에 따라 많은 ECN 인식 IPsec 구현이 ECN 인식 및 ECN 비인식 IPsec 터널 끝점의 혼합과 통신하게 된다는 것입니다. 이러한 노드별 구성 환경에서 유일하게 합리적인 조치는 모든 IPsec 터널에 대해 ECN 사용을 금지하는 것인데, 이는 원하는 결과가 아닙니다.

두 번째 영역에서는 여러 리뷰어가 SA 협상이 복잡하고 이에 추가하는 것이 쉽지 않다는 점을 지적했습니다. 한 검토자는 터널 설정 후 가능한 대안으로 ICMP를 사용할 것을 제안했습니다. 이 문서의 SA 협상에 대한 추가는 선택 사항이며 그대로 유지됩니다. 구현자는 이를 무시해도 됩니다. 저자는 이것이 제공하는 보증이 여러 상황에서 유용할 수 있다고 믿습니다. 실제로 이것이 구현되지 않으면 표준 프로세스의 후속 단계에서 삭제될 수 있습니다. 터널 설정 후 ECN을 협상하기 위해 ICMP를 확장하는 것은 SA 속성 협상을 확장하는 것보다 더 복잡합니다. 일부 터널에서는 트래픽이 터널 출구 끝점으로 주소 지정되는 것을 허용하지 않으므로 ICMP 패킷은 다른 곳으로 주소가 지정되고 출구 끝점에서 검색된 후 그곳이나 실제 대상에서 삭제되어야 합니다. 또한 ICMP 전달은 신뢰할 수 없으므로 ICMP 패킷이 삭제될 가능성이 있으며, 이에 따라 또 다른 승인/재전송 메커니즘이 개발됩니다. 기존 SA 협상 메커니즘에 대한 선택적 확장을 지정하는 것이 더 나을 것 같습니다.\(MAY, MAY\)

---
### **9.3.  IP packets encapsulated in non-IP Packet Headers.**

IP 패킷이 비IP 패킷 헤더가 있는 터널에 캡슐화되면 ECN과 관련하여 다른 문제가 제기됩니다. 이는 MPLS\[MPLS\], GRE\[GRE\], L2TP\[L2TP\] 및 PPTP\[PPTP\]에서 발생합니다. 이러한 프로토콜의 경우 ECN과 충돌이 없습니다. 캡슐화 프로토콜의 헤더에 대해 ECN 코드 포인트를 지정할 수 없으면 터널 내에서 ECN을 사용할 수 없습니다. 이전 작업에서는 ECN을 MPLS에 통합하기 위한 예비 제안을 고려했으며, 필요에 따라 ECN을 GRE, L2TP 또는 PPTP에 통합하기 위한 제안이 고려될 것입니다.

---
## **10.  Issues Raised by Monitoring and Policing Devices**

한 가지 가능성은 모니터링 및 정책 장치\(또는 보다 비공식적으로 "페널티 박스"\)가 네트워크에 설치되어 최선의 흐름이 혼잡에 적절하게 응답하는지 여부를 모니터링하고 적절하게 사용하지 않는 것으로 결정된 흐름에서 패킷을 우선적으로 삭제하는 것입니다. 종단 간 혼잡 제어 절차.

엔드투엔드 혼잡 제어에 응답하지 않는 흐름 또는 흐름 집합을 감지하는 "페널티 박스"는 사용 가능한 대역폭을 제한하기 위한 추가 조치를 취하기 전에 먼저 해당 흐름에서 패킷을 표시하는 것에서 삭제하는 것으로 변경하는 것이 좋습니다. 그 흐름에. 따라서 처음에 라우터는 CE 코드 포인트를 설정했을 패킷을 삭제할 수 있습니다. 여기에는 ECN 가능하고 이미 CE 코드 포인트가 설정된 해당 흐름에 대해 도착하는 패킷을 삭제하는 것이 포함될 수 있습니다. 이러한 방식으로 해당 흐름에 대해 해당 라우터에서 볼 수 있는 정체 표시는 경로의 다른 곳에 악의적이거나 손상된 라우터가 있는 경우에도 최종 노드에서도 볼 수 있도록 보장됩니다. ECN 가능 흐름에 대한 "페널티 박스"에서 취한 첫 번째 조치가 패킷을 표시하는 대신 패킷을 삭제하는 것이라고 가정하면, 공격자가 ECN 기반 종단 간 혼잡 제어를 파괴할 방법은 없습니다. 흐름이 비협조적인 것으로 특징지어지고 "페널티 박스" 내에서 더 심각한 조치를 취하게 될 수 있습니다.

실제로 배포되는 모니터링 및 정책 관리 장치는 모니터링이 단일 흐름이 아니라 흐름 집합\(예: 단일 IPsec 터널을 공유하는 흐름\)에 적용된다는 점에서 위에 설명된 '이상적인' 모니터링 장치에 미치지 못할 수 있습니다. . 이 경우 표시에서 삭제로의 전환은 해당 집계의 모든 흐름에 적용되어 집계의 다른 흐름에 대한 ECN의 이점도 거부됩니다. 최고 수준의 집계에서는 ECN이 비활성화된 경우에도 또 다른 형태의 ECN 비활성화가 발생합니다.

평균 대기열 크기가 일부 임계값을 초과하면 ECN 지원 RED 대기열이 정체 표시에서 패킷 삭제로 전환되는 경우 장치를 모니터링하고 정책을 관리합니다.

---
## **11.  Evaluations of ECN**
---
### **11.1.  Related Work Evaluating ECN**

이 섹션에서는 ECN 사용을 평가하는 일부 관련 작업에 대해 설명합니다. ECN 웹 페이지\[ECN\]에는 ECN 구현뿐만 아니라 다른 문서에 대한 포인터가 있습니다.

\[Floyd94\]는 TCP/IP 아키텍처에 ECN을 추가하는 것의 장점과 단점을 고려합니다. 시뮬레이션 기반 비교에서 볼 수 있듯이 ECN의 한 가지 장점은 짧거나 지연에 민감한 TCP 연결에서 불필요한 패킷 삭제를 방지하는 것입니다. ECN의 두 번째 장점은 TCP에서 불필요한 재전송 시간 초과를 방지한다는 것입니다. 이 문서에서는 ECN을 TCP의 혼잡 제어 메커니즘에 통합하는 방법을 자세히 설명합니다. 백서에서 논의된 ECN의 가능한 단점은 비호환 TCP 연결이 자신을 ECN 지원으로 잘못 광고할 수 있고 ECN-Echo 메시지를 전달하는 TCP ACK 패킷 자체가 네트워크에서 삭제될 수 있다는 것입니다. 이 두 가지 문제 중 첫 번째 문제는 이 문서의 부록에서 논의되고 두 번째 문제는 TCP 헤더에 CWR 플래그를 추가하여 해결됩니다.

ECN의 실험적 평가에는 \[RFC2884,K98\]이 포함됩니다. \[K98\] 및 \[RFC2884\]의 결론은 ECN TCP가 비ECN TCP보다 약간 더 나은 처리량을 얻는다는 것입니다. ECN TCP 흐름은 비ECN TCP 흐름에 대해 공평합니다. ECN TCP는 양방향 트래픽\(양방향 혼잡 포함\)과 혼잡한 여러 게이트웨이에 강력합니다. 많은 짧은 웹 전송을 사용한 실험에서는 대부분의 짧은 연결이 ECN 유무에 관계없이 유사한 전송 시간을 갖는 반면, 짧은 연결 중 소수는 ECN 실험과 비교하여 비ECN 실험의 경우 전송 시간이 매우 길다는 것을 보여줍니다.

---
### **11.2.  A Discussion of the ECN nonce.**

두 개의 ECT 코드 포인트인 ECT\(0\) 및 ECT\(1\)를 사용하면 패킷 헤더에 1비트 ECN 임시 값을 제공할 수 있습니다\[SCWA99\]. 이에 대한 주된 동기는 네트워크 요소가 CE 코드 포인트를 삭제하지 않고 데이터 수신기가 CE 코드 포인트가 설정된 패킷의 수신을 보낸 사람에게 적절하게 보고하는지 확인하기 위한 메커니즘을 데이터 발신자가 확인할 수 있도록 하기 위한 것입니다. 전송 프로토콜. 이 섹션에서는 하나의 ECT 코드 포인트만 정의된 RFC 2481을 준수하는 라우터에서 IP ECN 구현과의 이전 버전과의 호환성 문제에 대해 설명합니다. 우리는

ECT\(1\) 코드 포인트를 이해하는 ECN 구현을 점진적으로 배포하면 심각한 운영 문제가 발생합니다. 이는 특히 ECT\(1\) 코드 포인트가 엔드 노드에서 사용되기 시작하기 전에 라우터에서 ECT\(1\) 코드 포인트의 배포가 시작되는 경우일 가능성이 높습니다.

---
#### **11.2.1.  The Incremental Deployment of ECT(1) in Routers.**

ECN은 1999년 1월부터 실험적 표준이었으며 ECT\(1\) 코드 포인트를 이해하지 못하는 라우터에는 이미 ECN이 구현되어 있습니다. ECT\(1\) 코드 포인트의 사용이 TCP 또는 기타 전송 프로토콜에 대해 표준화된 경우 이는 데이터 송신자가 ECT\(1\) 코드 포인트를 사용하고 있지만 경로의 혼잡한 라우터가 이 코드 포인트를 이해하지 못한다는 것을 의미할 수 있습니다. .

전송 프로토콜에서 허용하는 경우 데이터 발신자는 ECT\(1\)를 전혀 사용하지 않고 코드 포인트 ECT\(0\)를 사용하여 모든 ECN 가능 패킷을 보낼 수 있습니다. 그러나 ECN 지원 발신자가 ECT\(1\)를 사용하고 경로의 혼잡한 라우터가 ECT\(1\) 코드 포인트를 이해하지 못한 경우 라우터는 결국 ECT\(0\) 패킷 중 일부를 표시하고 삭제하게 됩니다. ECT\(1\) 패킷 중 일부를 정체 표시로 사용합니다. TCP는 표시된 패킷과 삭제된 패킷 모두에 반응해야 하기 때문에 표시되었을 수 있는 패킷을 삭제하는 이러한 동작은 네트워크에 큰 위협이 되지 않으며 라우터가 표시 시기와 표시 여부를 결정할 수 있도록 하는 ECN에 대한 전반적인 접근 방식과 일치합니다. 적합하다고 판단되는 대로 패킷을 전송합니다\(섹션 5 참조\).

---
## **12.  Summary of changes required in IP and TCP**

이 문서에서는 ECN에 사용할 IP 헤더의 두 비트를 지정했습니다. not-ECT 코드포인트는 전송 프로토콜이 CE 코드포인트를 무시함을 나타냅니다. 이는 ECN 코드 포인트의 기본값입니다. ECT 코드포인트는 전송 프로토콜이 ECN에 참여할 의사가 있고 참여할 수 있음을 나타냅니다.

라우터는 끝 노드에 정체를 나타내기 위해 CE 코드 포인트를 설정합니다. 패킷 헤더의 CE 코드포인트는 라우터에 의해 재설정되어서는 안 됩니다.\(MUST NOT\)

TCP에는 ECN에 대한 세 가지 변경, 설정 단계 및 TCP 헤더의 두 가지 새로운 플래그가 필요합니다. ECN-Echo 플래그는 데이터 수신기에서 수신된 CE 패킷을 데이터 송신기에 알리는 데 사용됩니다. CWR\(Congestion Window Reduced\) 플래그는 데이터 송신자가 혼잡 창이 감소되었음을 데이터 수신자에게 알리기 위해 사용됩니다.

ECN\(명시적 혼잡 알림\)을 사용하는 경우 IP 터널 내에서 생성된 혼잡 표시가 터널 출구에서 손실되지 않아야 합니다. IP 터널링을 거치는 흐름이 ECN을 사용할 수 있도록 캡슐화 및 캡슐화 해제 중에 IP 프로토콜의 ECN 필드 처리에 약간의 수정을 지정했습니다.

터널의 ECN에 대한 두 가지 옵션이 지정되었습니다.

1\) 외부 헤더의 ECN 필드를 not-ECT로 설정하고 캡슐화 해제 시 내부 헤더를 변경하지 않음으로써 IP 터널 내부에서 ECN을 사용하지 않는 제한된 기능 옵션입니다.

2\) 내부 헤더의 ECN 필드에 따라 외부 헤더의 ECN 필드를 not-ECT 또는 ECT 코드 포인트 중 하나로 설정하는 전체 기능 옵션입니다. 캡슐화 해제 시 CE 코드포인트가 외부 헤더에 설정되고 내부 헤더가 ECT 코드포인트 중 하나로 설정된 경우 CE 코드포인트가 내부 헤더에 복사됩니다.

IPsec 터널의 경우 이 문서에서는 IPsec 터널 내에서 ECN 사용 협상을 가능하게 하는 선택적 IPsec 보안 연결\(SA\) 속성과 SA의 터널 모드에서 ECN이 허용되는지 여부를 나타내는 보안 연결 데이터베이스의 선택적 필드도 정의합니다. ECN 사용을 위해 IPsec 터널에 필요한 변경 사항은 IPsec 아키텍처를 정의하고 구현의 일부 측면을 지정하는 RFC 2401 \[RFC2401\]을 수정합니다. 새로운 IPsec SA 속성은 \[RFC2407\]의 섹션 4.5에 이미 정의된 속성에 추가됩니다.

이 문서는 ECN을 인터넷 커뮤니티를 위한 실험 프로토콜로 정의한 RFC 2481, "IP에 명시적 혼잡 알림\(ECN\)을 추가하는 제안"을 폐기합니다. 이 섹션의 나머지 부분에서는 이 문서와 이전 문서 간의 관계에 대해 설명합니다.

RFC 2481에는 캡슐화된 패킷과 함께 ECN 사용에 대한 간략한 설명이 포함되어 있으며 당시\(1999년 1월\) IPsec 사양에 따라 흐름이 IPsec 터널을 통과하는 경우 ECN을 안전하게 사용할 수 없다는 점을 언급했습니다. RFC 2481은 또한 ECN과 호환되도록 IPsec 터널 사양을 변경할 수 있는 방법을 설명했습니다.

이 문서에는 RFC 2481 이후에 수행된 작업도 포함되어 있습니다. 첫 번째는 IPsec 터널의 변경 사항을 자세히 설명하고 ECN의 보안 영향을 광범위하게 논의하는 것이었습니다\(현재 이 문서의 섹션 18 및 19에 포함됨\). 두 번째는 모든 IP 터널을 포함하도록 IPsec 터널에 대한 논의를 확장하는 것이었습니다. 이전 IP 터널은 흐름의 ECN 사용과 호환되지 않기 때문에

인터넷에 ECN을 배포하면 제한된 기능 또는 전체 기능 옵션을 사용하여 기존 IP 터널을 ECN 호환 버전으로 업데이트해야 한다는 강력한 압력이 발생합니다.

이 문서에서는 MPLS, GRE, L2TP 또는 PPTP와 같은 비IP 터널에 ECN을 포함하는 문제를 다루지 않습니다. MPLS에 ECN 지원을 추가하는 방법에 대한 이전 예비 문서는 진행되지 않았습니다.

RFC2481 이후 세 번째 새로운 작업은 재전송된 데이터 패킷을 사용하여 ECN 절차를 설명하는 것이었습니다. 즉, 재전송된 데이터 패킷에 ECT 코드 포인트를 설정해서는 안 됩니다. 이 추가 사양의 동기는 기존 TCP 연결에 대한 서비스 거부 공격 가능성을 제거하는 것입니다. ECN 지원 TCP의 일부 이전 배포는 재전송된 패킷에 ECT 코드 포인트를 설정하지 말라는 \(새로운\) 요구 사항을 따르지 않을 수 있습니다. 우리는 이것이 실제로 심각한 문제를 일으킬 것이라고 믿지 않습니다.

또한 이 문서에서는 ECN 협상을 위한 SYN 패킷 사용 사양을 약간 확장합니다. ECN 지원 TCP의 일부 이전 배포는 이 문서에 지정된 요구 사항을 따르지 않을 수 있지만 엔드포인트에서 TCP 구현을 조합하여 TCP 연결에 대한 성능 또는 호환성 문제가 발생할 것이라고는 생각하지 않습니다.

이 문서에는 TCP에서 ECN nonce 구현의 일부로 사용할 수 있는 ECT\(1\) 코드 포인트의 사양도 포함되어 있습니다.

---
## **13.  Conclusions**

AQM을 구현하려는 현재의 노력을 고려할 때 지금이 패킷 삭제에만 의존하지 않는 혼잡 회피 메커니즘을 배포할 적절한 시기라고 생각합니다. 단일 패킷\(예: 실시간 트래픽, 짧은 웹 전송\)의 지연 및 손실에 민감한 애플리케이션 및 전송의 배포가 증가함에 따라 패킷 손실에 따른 일반적인 혼잡 알림 메커니즘은 불충분한 것으로 보입니다\(또는 최소한 비최적\).

우리는 네트워크 내 ECN 필드 수정의 결과를 조사하여 적이 ECN 필드를 변경할 수 있는 모든 기회를 분석했습니다. 많은 경우 ECN 필드 변경은 패킷 삭제보다 나쁘지 않습니다. 그러나 우리는 일부 변경 사항이 종단 간 혼잡 제어를 무너뜨리는 더 심각한 결과를 가져온다는 점을 지적했습니다. 그러나 그럼에도 불구하고 우리는 잠재적인 피해가 제한적이며 의도적으로 종단간 혼잡 제어에 협력하지 못하는 종단 시스템이 제기하는 위협과 유사하다는 점을 지적합니다.

---
## **14.  Acknowledgements**

이 문서에서 직접 인정하지 못한 많은 사람들을 포함하여 많은 사람들이 이 작업과 이 문서에 기여했습니다. 또한 ECN-Capability 협상을 위한 TCP 메커니즘을 제안한 Kenjiro Cho, CWR 비트를 제안한 Kevin Fall, IPv4 헤더 체크섬 재계산에 대한 자료를 제공한 Steve Blake, 토론에 참여한 Jamal Hadi-Salim에게 감사의 말씀을 전하고 싶습니다. ECN 문제에 대해 토론하고 Steve Bellovin, Jim Bound, Brian Carpenter, Paul Ferguson, Stephen Kent, Greg Minshall 및 Vern Paxson이 보안 문제에 대해 논의했습니다. 또한 이러한 문제에 대해 지속적인 논의를 해주신 인터넷 엔드투엔드 연구 그룹\(Internet End-to-End Research Group\)에도 감사드립니다.

Dax Kelson, Alexey Kuznetsov, Jamal Hadi-Salim 및 Venkat Venkatsubra를 포함한 여러 사람들과의 이메일 토론에서는 ECE 및 CWR의 TCP SYN 패킷에 응답하지 않는 인터넷의 부적합 장비로 인해 제기된 문제를 해결했습니다. 플래그가 설정되었습니다. TCP 초기화 절차에 대해 토론해 주신 Mark Handley, Jitentra Padhye 및 기타 분들께 감사드립니다.

ECN 및 IP 터널 고려 사항에 대한 논의는 차별화 서비스 실무 그룹\(Differentiated Services Working Group\)의 관련 토론 및 문서를 기반으로 합니다. IP 터널에 대한 피드백을 주신 방글라데시 다카의 Tabassum Bint Haque에게 감사드립니다. ECN Tunnel SA 속성 협상의 유용성을 향상시키는 RFC 2407 수정을 제안한 Derrell Piper와 Kero Tivinen에게 감사드립니다.

ECN nonce를 제안한 David Wetherall, David Ely 및 Neil Spring에게 감사드립니다. 또한 이 문제에 대해 토론해 주신 Stefan Savage에게도 감사드립니다. IP 조각화 문제, 네 번째 ECN 코드 포인트의 대체 의미론 및 기타 여러 주제를 제기한 Bob Briscoe와 Jon Crowcroft에게 감사드립니다. 문서의 여러 문제에 대한 피드백을 주신 Richard Wendland에게 감사드립니다.

또한 ECN 표준화를 위한 피드백과 작업에 대해 수년간 IESG, 특히 운송 지역 이사들에게 감사드립니다.

---
## **15.  References**

\[AH\] Kent, S. 및 R. Atkinson, "IP 인증 헤더", RFC 2402, 1998년 11월.

\[ECN\] "ECN 웹페이지", URL

- "http://www.aciri.org/floyd/ecn.html". 정보 제공 목적으로만 참조하세요.

\[ESP\] Kent, S. 및 R. Atkinson, "IP 캡슐화 보안 페이로드", RFC 2406, 1998년 11월.

\[수정 사항\] ECN-under-Linux 비공식 공급업체 지원 페이지, URL "http://gtf.org/garzik/ecn/". 정보 제공 목적으로만 참조하세요.

\[FJ93\] Floyd, S. 및 Jacobson, V., "혼잡 방지를 위한 무작위 조기 감지 게이트웨이", 네트워킹에 대한 IEEE/ACM 트랜잭션, V.1 N.4, 1993년 8월, p. 397-413.

\[Floyd94\] Floyd, S., "TCP 및 명시적 혼잡 알림", ACM 컴퓨터 통신 검토, V. 24 N. 5, 1994년 10월, p. 10-23.

\[Floyd98\] Floyd, S., "NS의 ECN 검증 테스트

- 시뮬레이터", URL "http://www-mash.cs.berkeley.edu/ns/", 테스트 tcl/test/test-all-ecn. 정보 제공 목적으로만 참조하십시오.

\[FF99\] Floyd, S. 및 Fall, K., "인터넷에서 엔드투엔드 혼잡 제어 사용 촉진", 네트워킹에 대한 IEEE/ACM 트랜잭션, 1999년 8월.

\[FRED\] Lin, D. 및 Morris, R., "무작위 조기 탐지의 역학", SIGCOMM '97, 1997년 9월.

\[GRE\] Hanks, S., Li, T., Farinacci, D. 및 P. Traina, "일반 라우팅 캡슐화\(GRE\)", RFC 1701, 1994년 10월.

\[Jacobson88\] V. Jacobson, "혼잡 방지 및 제어", Proc. ACM SIGCOMM '88, pp. 314-329.

\[Jacobson90\] V. Jacobson, "수정된 TCP 혼잡 회피

- 알고리즘", end2end-interest 메일링 리스트에 보낸 메시지, 1990년 4월. URL "ftp://ftp.ee.lbl.gov/email/vanj.90apr30.txt".

\[K98\] Krishnan, H., "명백한 혼잡 분석

- TCP에 대한 알림\(ECN\) 혜택", 석사 논문, UCLA, 1998. 인정 목적으로만 인용.

\[L2TP\] Townsley, W., Valencia, A., Rubens, A., Pall, G., Zorn, G. 및 B. Palter, "레이어 2 터널링 프로토콜 "L2TP"", RFC 2661, 1999년 8월.

\[MJV96\] S. McCanne, V. Jacobson 및 M. Vetterli, "Receiver-driven Layered Multicast", SIGCOMM '96, 1996년 8월, pp. 117-130.

\[MPLS\] Awduche, D., Malcolm, J., Agogbua, J., O'Dell, M. 및 J. McManus, MPLS를 통한 교통 엔지니어링 요구 사항, RFC 2702, 1999년 9월.

\[PPTP\] Hamzeh, K., Pall, G., Verthein, W., Taarud, J., Little, W. 및 G. Zorn, "PPTP\(지점 간 터널링 프로토콜\)", RFC 2637, 1999년 7월 .

```text
   [RFC791]     Postel, J., "Internet Protocol", STD 5, RFC 791,
                September 1981.

   [RFC793]     Postel, J., "Transmission Control Protocol", STD 7, RFC
                793, September 1981.
```

\[RFC1141\] Mallory, T. 및 A. Kullberg, "인터넷 체크섬의 증분 업데이트", RFC 1141, 1990년 1월.

\[RFC1349\] Almquist, P., "인터넷 프로토콜 제품군의 서비스 유형", RFC 1349, 1992년 7월.

\[RFC1455\] Eastlake, D., "서비스의 물리적 링크 보안 유형", RFC 1455, 1993년 5월.

\[RFC1701\] Hanks, S., Li, T., Farinacci, D. 및 P. Traina, "GRE\(일반 라우팅 캡슐화\)", RFC 1701, 1994년 10월.

\[RFC1702\] Hanks, S., Li, T., Farinacci, D. 및 P. Traina, "IPv4 네트워크를 통한 일반 라우팅 캡슐화", RFC 1702, 1994년 10월.

\[RFC2003\] Perkins, C., "IP 내 IP 캡슐화", RFC 2003, 1996년 10월.

\[RFC2119\] Bradner, S., "요구 사항 수준을 나타 내기 위해 RFC에 사용되는 핵심 단어", BCP 14, RFC 2119, 1997년 3월.

\[RFC2309\] Braden, B. 등, "인터넷의 대기열 관리 및 혼잡 회피에 대한 권장 사항", RFC 2309, 1998년 4월.

\[RFC2401\] Kent, S. 및 R. Atkinson, 인터넷 프로토콜용 보안 아키텍처, RFC 2401, 1998년 11월.

\[RFC2407\] Piper, D., "인터넷 IP 보안 도메인

- ISAKMP에 대한 해석", RFC 2407, 1998년 11월.

\[RFC2408\] Maughan, D., Schertler, M., Schneider, M. 및 J. Turner, "ISAKMP\(인터넷 보안 협회 및 키 관리 프로토콜\)", RFC 2409, 1998년 11월.

\[RFC2409\] Harkins D. 및 D. Carrel, "인터넷 키 교환\(IKE\)", RFC 2409, 1998년 11월.

\[RFC2474\] Nichols, K., Blake, S., Baker, F. 및 D. Black,

- "IPv4 및 IPv6 헤더의 차별화된 서비스 필드\(DS 필드\) 정의", RFC 2474, 1998년 12월.

\[RFC2475\] Blake, S., Black, D., Carlson, M., Davies, E., Wang, Z. 및 W. Weiss, "차등화된 서비스를 위한 아키텍처", RFC 2475, 1998년 12월.

\[RFC2481\] Ramakrishnan K. 및 S. Floyd, "IP에 명시적 혼잡 알림\(ECN\)을 추가하는 제안", RFC 2481, 1999년 1월.

\[RFC2581\] Alman, M., Paxson, V. 및 W. Stevens, "TCP 혼잡 제어", RFC 2581, 1999년 4월.

\[RFC2884\] Hadi Salim, J. 및 U. Ahmed, "IP 네트워크의 ECN\(명시적 혼잡 알림\) 성능 평가", RFC 2884, 2000년 7월.

\[RFC2983\] Black, D., "차별화된 서비스 및 터널", RFC2983, 2000년 10월.

\[RFC2780\] Bradner S. 및 V. Paxson, "인터넷 프로토콜 및 관련 헤더의 값에 대한 IANA 할당 지침", BCP 37, RFC 2780, 2000년 3월.

\[RJ90\] K. K. Ramakrishnan 및 Raj Jain, "컴퓨터 네트워크의 혼잡 회피를 위한 바이너리 피드백 체계", 컴퓨터 시스템의 ACM 트랜잭션, Vol.8, No.2, pp. 158-181, 1990년 5월.

\[SCWA99\] Stefan Savage, Neal Cardwell, David Wetherall 및 Tom Anderson, 오작동하는 수신기를 사용한 TCP 혼잡 제어, ACM 컴퓨터 통신 리뷰, 1999년 10월.

\[TBIT\] Jitendra Padhye 및 Sally Floyd, "웹 서버의 TCP 동작 식별", ICSI TR-01-002, 2001년 2월. URL "http://www.aciri.org/tbit/".

---
## **16.  Security Considerations**

보안 고려 사항은 섹션 7, 8, 18 및 19에서 논의되었습니다.

---
## **17.  IPv4 Header Checksum Recalculation**

IPv4 헤더 체크섬 재계산은 출력 버퍼링 스위치를 사용하는 일부 고급 라우터 아키텍처에서 문제가 됩니다. 헤더 조작의 전부는 아니더라도 대부분이 스위치의 입력 측에서 수행되는 반면 ECN 결정은 로컬에서 이루어져야 하기 때문입니다. 출력 버퍼에. IPv6 헤더 체크섬이 없기 때문에 이는 IPv6에는 문제가 되지 않습니다. IPv4 TOS 옥텟은 16비트 하프워드의 마지막 바이트입니다.

RFC 1141 \[RFC1141\]에서는 TTL 필드가 감소한 후 IPv4 체크섬의 증분 업데이트에 대해 설명합니다. CE 코드 포인트가 설정된 후 IPv4 체크섬의 증분 업데이트는 다음과 같이 작동합니다. HC를 ECT\(0\) 패킷의 원래 헤더 체크섬으로 설정하고 HC'를 CE 비트가 설정된 후 새 헤더 체크섬으로 설정합니다. 즉, ECN 필드가 '10'에서 '11'로 변경되었습니다. 그런 다음 보수 빼기로 계산된 헤더 체크섬의 경우 HC'는 다음과 같이 다시 계산됩니다.

```text
        HC' = { HC - 1     HC > 1
              { 0x0000     HC = 1
```

2의 보수 시스템에서 계산된 헤더 체크섬의 경우 HC'는 CE 비트가 설정된 후 다음과 같이 다시 계산됩니다.

```text
        HC' = { HC - 1     HC > 0
              { 0xFFFE     HC = 0

   A similar incremental updating of the IPv4 checksum can be carried
   out when the ECN field is changed from ECT(1) to CE, that is, from '
   01' to '11'.
```

---
## **18.  Possible Changes to the ECN Field in the Network**

이 섹션에서는 혼잡을 잘못 보고하거나, 개별 패킷에 대해 ECN-Capability를 비활성화하거나, ECN 혼잡 표시를 삭제하거나, ECN-Capability를 잘못 표시하는 등 네트워크의 ECN 필드에 발생할 수 있는 변경 사항에 대해 자세히 설명합니다.

---
### **18.1.  Possible Changes to the IP Header**
---
#### **18.1.1.  Erasing the Congestion Indication**

먼저, 우리는 라우터 업스트림에 의해 설정된 후 정체 표시를 효과적으로 지우는 결과를 가져오도록 라우터가 수행할 수 있는 변경 사항을 고려합니다. 다음 규칙은 수신된 패킷의 ECN 코드 포인트 -\> 전송된 패킷의 ECN 코드 포인트입니다.

CE 코드 포인트를 ECT\(0\) 또는 ECT\(1\) 코드 포인트로 바꾸면 혼잡 표시가 효과적으로 지워집니다. 그러나 두 개의 ECT 코드 포인트를 사용하면 CE 코드 포인트를 지우는 라우터는 원래 ECT 코드 포인트가 ECT\(0\)인지 ECT\(1\)인지 알 수 없습니다. 따라서 전송 프로토콜이 CE 코드 포인트의 삭제를 감지하는 메커니즘을 배포하는 것이 가능합니다.

업스트림 라우터에 대한 CE 코드 포인트가 삭제되면 정체 표시가 소스에 도달하지 않기 때문에 한동안 정체가 발생할 가능성이 있습니다. 그러나 패킷이 수신되고 승인됩니다.

정체 표시 삭제의 잠재적인 효과는 복잡하며 아래 섹션 19에서 자세히 논의됩니다. 혼잡 표시를 지우는 효과는 네트워크에서 패킷을 삭제하는 것과 다릅니다. 데이터 패킷이 삭제되면 TCP 발신자가 삭제를 감지하고 혼잡을 나타내는 것으로 해석합니다. 마찬가지로, 충분한 수의 연속 승인 패킷이 삭제되어 누적 승인 필드가 발신자에서 진행되지 않게 되면 발신자는 혼잡 창에 의해 추가 패킷을 보낼 수 없도록 제한되고 궁극적으로 재전송 타이머가 만료됩니다.

대조적으로, 다운스트림 라우터에 의한 CE 비트의 체계적인 삭제는 버퍼 오버플로로 인한 패킷 손실 가능성을 포함하여 업스트림 라우터에서 큐 축적을 유발하는 효과를 가질 수 있습니다. 혼잡한 라우터를 통과하는 다른 흐름이 CE 비트 세트에 반응할 수 있는 반면, CE 비트가 지워진 흐름은 더 나은 성능을 볼 수 있다는 점에서 불공평할 가능성이 있습니다. 이러한 잠재적인 불공평성에 대한 제한은 아래 섹션 19에서 더 자세히 논의됩니다.

세 가지 변경 사항 중 마지막은 CE 코드 포인트를 비-ECT 코드 포인트로 대체하여 정체 표시를 지우고 동시에 ECN 기능을 비활성화하는 것입니다.

혼잡 표시의 '삭제'는 패킷이 다운스트림 라우터에 의해 다시 표시되거나 삭제되지 않는 경우에만 유효합니다. CE 코드포인트가 ECT 코드포인트로 대체되면,

패킷은 ECN 가능 상태로 유지되며 정체 표시로 다운스트림 라우터에 의해 표시되거나 삭제될 수 있습니다. CE 코드포인트가 비ECT 코드포인트로 교체되면 패킷은 더 이상 ECN을 지원하지 않으므로 삭제될 수 있지만 다운스트림 라우터에 의해 혼잡 표시로 표시되지는 않습니다.

---
#### **18.1.2.  Falsely Reporting Congestion**

이번 변경은 혼잡이 없더라도 ECT 코드포인트가 이미 설정된 경우 CE 코드포인트를 설정하는 것입니다. 이 변경 사항은 나머지 경로에 있는 해당 패킷의 처리에 영향을 주지 않습니다. 특히, 라우터는 도착 패킷을 삭제하거나 표시할지 여부를 결정할 때 CE 코드 포인트를 검사하지 않습니다.

그러나 이로 인해 애플리케이션이 불필요하게 종단 간 혼잡 제어를 호출하고 도착 속도가 감소할 수 있습니다. 그 자체로는 변조 라우터가 실제로 패킷을 삭제한 경우보다 애플리케이션이나 네트워크에 있어서 더 나쁘지 않습니다.

---
#### **18.1.3.  Disabling ECN-Capability**

이 변경은 패킷의 ECT 코드 포인트를 끄는 것입니다. 이는 나중에 패킷이 정체에 직면할 경우\(예: 적당한 평균 대기열 크기의 RED 대기열에 도착하여\) 표시되는 대신 삭제된다는 것을 의미합니다. 그 자체로는 변조 라우터가 실제로 패킷을 삭제한 경우보다 \(응용 프로그램에 있어서\) 더 나쁘지 않습니다. 이 특별한 경우의 장점은 CE 비트 설정으로 인한 반응을 기대하는 혼잡한 라우터 업스트림이 없다는 것입니다.

---
#### **18.1.4.  Falsely Indicating ECN-Capability**

이 변경으로 인해 패킷에 ECN 지원으로 잘못 레이블이 지정됩니다. 패킷은 ECN 지원 전송 또는 ECN 지원이 아닌 전송을 통해 전송되었을 수 있습니다.

나중에 패킷이 ECN 지원 라우터에서 중간 정도의 정체에 직면하면 라우터는 패킷을 삭제하는 대신 CE 코드 포인트를 설정할 수 있습니다. 실제로 전송 프로토콜이 ECN 지원이 아닌 경우 전송은 이러한 정체 표시를 수신하지 않으며 이에 대한 응답으로 전송 속도를 줄이지 않습니다. ECN 기능을 잘못 표시할 경우 발생할 수 있는 결과에 대해서는 아래 섹션 19에서 자세히 설명합니다.

나중에 패킷이 ECN 지원 라우터에서 정체를 경험하지 않으면 이러한 두 변경 사항 중 첫 번째 변경 사항은 전송 프로토콜에 의한 ECN nonce 사용을 방해할 가능성이 있는 것 외에는 아무런 영향도 미치지 않습니다. 그러나 마지막 변경 사항은 다음과 같은 영향을 미칩니다.

경로를 따라 모니터링 장치에 정체에 대한 허위 보고를 제공하는 것입니다. 전송 프로토콜이 ECN 지원인 경우 이 변경 사항은 ECN 기능을 잘못 표시하는 것과 혼잡을 잘못 보고하는 것을 결합하여 전송 수준에서도 영향을 미칠 수 있습니다. ECN 지원 전송의 경우 이로 인해 전송이 혼잡에 불필요하게 반응하게 됩니다. 이 특별한 경우에는 ECN 필드를 잘못 변경하는 라우터가 패킷을 삭제했을 수 있습니다. 따라서 ECN 가능 전송의 경우 ECN 필드에 대한 이러한 변경의 결과는 패킷을 삭제하는 것보다 나쁘지 않습니다.

---
### **18.2.  Information carried in the Transport Header**

TCP의 경우 ECN 가능 TCP 수신기는 TCP 피어에게 자신이 TCP 수준에서 ECN 가능함을 알리고 연결이 설정될 때 TCP 헤더에 이 정보를 전달합니다. 이 문서에서는 네트워크 내 전송 헤더의 변경으로 인해 발생할 수 있는 잠재적인 위험을 고려하지 않습니다. IPsec이 사용될 때 전송 헤더는 터널 모드와 전송 모드\[ESP, AH\] 모두에서 보호됩니다.

또 다른 문제는 전송 헤더에 잘못된 ECN 정보를 전달하는 스푸핑된 IP 소스 주소가 있는 TCP 패킷과 관련이 있습니다. 완전성을 위해 여기에서는 다른 노드의 IP 소스 주소를 스푸핑하는 노드가 TCP 헤더에 있는 두 개의 ECN 플래그를 사용하여 서비스 거부 공격을 시작할 수 있는 몇 가지 가능한 방법을 조사합니다. 그러나 이러한 공격을 수행하려면 공격자가 유효한 TCP 시퀀스 번호를 사용할 수 있어야 하며, 이 능력과 IP 소스 주소를 스푸핑할 수 있는 공격자는 ECN 플래그를 사용하지 않고도 TCP 연결을 손상시킬 수 있습니다. 따라서 ECN은 이와 관련하여 새로운 취약점을 추가하지 않습니다.

TCP 데이터 수신기의 스푸핑된 IP 소스 주소가 포함된 승인 패킷에는 ECE 비트 세트가 포함될 수 있습니다. TCP 데이터 발신자가 유효한 패킷으로 수락하면 이 스푸핑된 승인 패킷으로 인해 TCP 데이터 발신자가 혼잡 창을 불필요하게 절반으로 줄일 수 있습니다. 그러나 데이터 송신자가 이를 수락하려면 이러한 스푸핑된 승인 패킷이 유효한 승인 번호뿐만 아니라 올바른 32비트 시퀀스 번호도 가져야 합니다. 이러한 스푸핑된 승인 패킷을 성공적으로 보낼 수 있는 공격자는 스푸핑된 RST 패킷을 보내거나 TCP 연결에 대해 동일한 피해를 주는 다른 작업을 수행할 수도 있습니다.

TCP 데이터 송신자의 스푸핑된 IP 소스 주소가 있는 패킷에는 CWR 비트 세트가 포함될 수 있습니다. 다시 말하지만, 이러한 패킷이 승인되려면 유효한 시퀀스 번호가 있어야 합니다. 또한 이러한 스푸핑된 패킷은 성능에 제한적인 영향을 미칩니다. CWR 비트가 설정된 데이터 패킷을 스푸핑하면 TCP 데이터 수신기가 손상될 수 있습니다.

스푸핑된 CWR 패킷을 수신했을 때 데이터 수신기가 ECE 패킷을 보낸 경우에는 그렇지 않은 경우보다 적은 수의 ECE 패킷을 보냅니다.

---
### **18.3.  Split Paths**

어떤 경우에는 악의적이거나 손상된 라우터가 흐름의 패킷 하위 집합에만 액세스할 수 있습니다. 질문은 다음과 같습니다. 이 라우터가 패킷 하위 집합의 ECN 필드를 변경함으로써 단순히 해당 패킷 집합을 삭제한 경우보다 해당 흐름에 더 많은 손상을 줄 수 있습니까?

흐름의 패킷을 A 패킷과 B 패킷으로 분류하고, 공격자는 A 패킷에만 액세스할 수 있다고 가정합니다. 적이 정체가 발생하는 지점의 업스트림에 ECN-Capability를 잘못 표시하거나 다운스트림의 정체 표시를 삭제하여 A 패킷만 이동하는 경로를 따라 종단 간 정체 제어를 파괴하고 있다고 가정합니다. 또한 A와 B 패킷을 모두 확인하고 전체 흐름이 혼잡 표시에 적절하게 응답하지 않는 것으로 판단되면 A와 B 패킷을 모두 "처벌"하는 모니터링 장치가 존재한다는 점을 고려하십시오. 우리가 믿을 수 있는 또 다른 주요 특징은 A&B 흐름을 '처벌'하기 전에 모니터링 장치가 CE 코드 포인트를 설정하는 대신 먼저 패킷을 삭제하고 이미 CE 코드 포인트를 가지고 있는 해당 흐름의 도착 패킷을 삭제한다는 것입니다. 세트. 엔드 노드가 실제로 엔드-투-엔드 혼잡 제어를 사용하는 경우 모니터링 장치에서 볼 수 있는 모든 혼잡 표시를 확인하고 이러한 혼잡 표시에 응답하기 시작합니다. 따라서, 모니터링 장치는 초기 단계에서 흐름에 대한 표시를 성공적으로 제공합니다.

A 패킷에만 액세스할 수 있는 공격자가 ECN 기반 혼잡 제어를 파괴함으로써 A&B 집합의 다른 패킷에 대한 ECN의 이점을 거부할 수 있다는 것은 사실입니다. 불행한 일이지만 이것이 ECN을 비활성화할 이유는 아닙니다.

혼잡을 허위로 보고하는 변형은 경로를 따라 두 명의 적이 있을 때 발생합니다. 첫 번째 적이 혼잡을 허위로 보고하고 두 번째 적이 이러한 보고를 '삭제'합니다. \(패킷 삭제와 달리 ECN 혼잡 보고서는 나중에 악의적이거나 손상된 라우터에 의해 네트워크에서 '역전'될 수 있습니다. 그러나 ECN nonce를 사용하면 전송에서 이 동작을 감지하는 데 도움이 될 수 있습니다.\) 이는 끝까지 투명합니다. 노드의 경우, 첫 번째와 두 번째 적 사이의 모니터링 장치가 혼잡에 대한 잘못된 표시를 볼 수 있습니다. 혼잡에 적절하게 응답하지 않는 흐름을 '처벌'하기 전에 라우터는 먼저 삭제로 전환한다는 이 문서의 권장 사항을 명심하세요.

혼잡을 나타내는 것으로 표시하는 대신 해당 흐름에 대해. 여기에 CE 코드 포인트가 설정된 해당 흐름에서 도착하는 패킷을 삭제하는 것이 포함되면 이러한 정체 표시가 최종 노드에 표시됩니다. 따라서 여러 적의 충돌로 인해 가정할 수 있는 추가 피해는 없습니다.

---
## **19.  Implications of Subverting End-to-End Congestion Control**

이 섹션에서는 ECN 기능을 잘못 표시하거나 ECN\(CE 코드 포인트\)에서 혼잡 표시를 삭제하여 종단 간 혼잡 제어를 파괴할 수 있는 잠재적인 영향에 중점을 둡니다. 이 두 가지 방법 중 하나로 종단 간 혼잡 제어를 파괴하면 애플리케이션과 네트워크 모두에 영향을 미칠 수 있습니다. 이에 대해서는 아래에서 별도로 논의합니다.

ECN 기능을 잘못 표시하는 방법인 종단 간 혼잡 제어를 파괴하는 첫 번째 방법은 나중에 패킷이 정체에 직면하여 CE 코드 포인트가 설정되는 경우에만 종단 간 혼잡 제어를 효과적으로 파괴합니다. 이 경우 전송 프로토콜\(ECN 지원이 불가능할 수 있음\)은 이러한 다운스트림 정체 라우터로부터 정체 표시를 수신하지 않습니다.

종단 간 혼잡 제어를 파괴하는 두 번째 방법인 패킷의 CE 코드 포인트를 '삭제'하는 것은 혼잡한 라우터에 의해 패킷의 CE 코드 포인트가 이전에 설정된 경우에만 종단 간 혼잡 제어를 효과적으로 파괴합니다. 이 경우 전송 프로토콜은 혼잡한 업스트림 라우터로부터 혼잡 표시를 받지 않습니다.

종단 간 혼잡 제어를 파괴하는 이 두 가지 방법 중 하나는 공격자가 단순히 해당 흐름에서 패킷을 삭제한 경우보다 네트워크\(및 흐름 자체\)에 더 많은 피해를 입힐 수 있습니다. 그러나 이 섹션 뒷부분과 섹션 7에서 논의하는 것처럼 이러한 잠재적인 피해는 제한적입니다.

---
### **19.1.  Implications for the Network and for Competing Flows**

ECN 필드의 CE 코드포인트는 라우터가 \*보통\* 정체 기간 동안 정체를 나타내는 용도로만 사용됩니다. ECN 지원 라우터는 라우터 대기열이 아직 가득 차지 않은 경우에도 혼잡이 심한 동안 패킷을 표시하는 대신 삭제해야 합니다. 예를 들어, RED 기반 활성 대기열 관리를 사용하는 라우터의 경우 라우터는 평균 대기열 크기가 RED 대기열의 최대 임계값을 초과하는 동안 도착하는 패킷을 표시하는 대신 삭제해야 합니다.

엔드-투-엔드 혼잡 제어를 파괴하는 네트워크의 한 가지 결과는 네트워크로부터 혼잡 표시를 수신하지 못하는 흐름이 네트워크를 더 심한 혼잡으로 몰아넣을 때까지 전송 속도를 증가시킬 수 있다는 것입니다. 그러면 혼잡한 라우터가 도착하는 패킷을 표시하지 않고 삭제하기 시작할 수 있습니다. 흐름별 스케줄링이나 다른 흐름별 메커니즘에 의해 격리되지 않고 대신 차별화되지 않은 방식으로 단일 대기열의 다른 흐름과 집계되는 흐름의 경우 혼잡한 라우터에서의 이 패킷 삭제는 모든 흐름에 적용됩니다. 그 대기열을 공유하는 것입니다. 따라서 결과적으로 네트워크의 정체 수준이 높아집니다.

어떤 경우에는 정체 수준의 증가로 인해 혼잡한 대기열에서 패킷 표시에서 패킷 삭제 방식으로 혼잡한 대기열을 구동하는 데 충분한 버퍼가 크게 증가하게 됩니다. 이러한 전환은 버퍼 오버플로로 인해 또는 평균 대기열이 RED의 최대 임계값보다 높을 때 패킷을 삭제하는 위에 설명된 활성 대기열 관리 정책으로 인해 발생할 수 있습니다. 이 시점에서, 파괴된 흐름을 포함한 모든 흐름은 패킷 표시 대신 패킷 삭제를 보기 시작하며 악의적이거나 손상된 라우터는 더 이상 이러한 네트워크 정체 표시를 '삭제'할 수 없습니다. 엔드 노드가 적절한 엔드투엔드 혼잡 제어를 배포하는 경우, 파괴된 흐름은 혼잡에 대응하여 도착 속도를 줄입니다. 혼잡 수준이 충분히 줄어들면 혼잡한 대기열은 패킷 삭제 방식에서 패킷 표시 방식으로 돌아올 수 있습니다. 정상 상태 패턴은 이 두 체제 사이에서 진동하는 혼잡한 대기열 중 하나일 수 있습니다.

다른 경우에는 종단 간 혼잡 제어를 파괴한 결과가 혼잡한 링크를 충분히 심한 혼잡으로 몰아넣어 패킷이 표시되는 대신 삭제될 만큼 심각하지 않습니다. 이 경우 네트워크의 경쟁 흐름에 대한 영향은 패킷 표시 또는 삭제 속도가 약간 증가하고 해당 흐름에 사용할 수 있는 대역폭이 감소한다는 것입니다. 이는 전복된 흐름의 도착 속도가 링크 대역폭에 비해 충분히 작아 혼잡한 라우터의 평균 대기열 크기가 제어되는 경우 안정적인 상태일 수 있습니다. 특히, 파괴된 흐름은 이 라우터의 링크에 대한 제한된 대역폭 수요를 가질 수 있지만 여전히 링크의 "공정한" 공유보다 더 많은 것을 얻을 수 있습니다. 이러한 제한된 수요는 데이터 소스의 제한된 수요로 인해 발생할 수 있습니다. TCP 광고 창의 제한 사항; 더 낮은 대역폭의 액세스 파이프; 또는 다른 요인. 따라서 ECN 기반 혼잡 제어의 전복은 여전히 ​​불공정을 초래할 수 있으며, 여기서 언급하는 것이 적절하다고 생각합니다.

네트워크에서 ECN 기반 혼잡 제어의 전복으로 인해 발생하는 네트워크에 대한 위협은 본질적으로 종단 간 혼잡 제어와 의도적으로 협력하지 못하는 최종 시스템에 의해 발생하는 위협과 동일합니다. 이 위협을 해결하기 위해 라우터에 메커니즘을 배포하는 것은 공개 연구 문제이며 섹션 10에서 자세히 논의됩니다.

패킷에 설정된 CE 코드 포인트가 삭제되는 섹션 18.1.1에 설명된 예를 들어보겠습니다: {'11' -\> '10' 또는 '11' -\> '01'}. CE 코드포인트를 설정한 혼잡한 업스트림 라우터의 결과는 이 혼잡 표시가 해당 흐름의 끝 노드에 도달하지 못한다는 것입니다. 따라서 소스\(완전히 협력적이고 악의적이지 않은 소스라도\)는 전송 속도를 계속해서 높일 수 있습니다\(TCP 흐름인 경우 혼잡 창을 늘려서\). 흐름은 잠재적으로 혼잡한 라우터를 공유하는 다른 흐름보다 더 나은 처리량을 달성합니다. 특히 해당 라우터에 정책 메커니즘이나 흐름별 큐잉 메커니즘이 없는 경우 더욱 그렇습니다. 다른 흐름의 동작을 고려하십시오. 특히 협조적인 경우, 즉 전복된 종단 간 혼잡 제어를 경험하지 않는 흐름입니다. 그들은 혼잡한 라우터에서 부하를 줄여\(예: 창 크기를 줄임으로써\) 전복된 흐름에 도움이 될 가능성이 높습니다. 이는 불공정을 초래합니다. 위에서 논의한 것처럼 이 불공평성은 일시적\(혼잡한 대기열이 패킷 표시 방식으로 이동하기 때문에\)이거나 변동적\(혼잡한 대기열이 패킷 표시와 패킷 삭제 방식 사이에서 진동하기 때문에\)이거나 보다 온건하지만 지속적일 수 있습니다. 안정적인 상태입니다\(혼잡한 대기열이 패킷 삭제 방식으로 전환되지 않기 때문입니다\).

파괴된 흐름이 의도적으로 종단 간 혼잡 제어를 피하는 경우 결과는 유사합니다. 한 가지 차이점은 엔드 노드에서 의도적으로 종단 간 혼잡 제어를 피하는 흐름은 혼잡한 대기열이 패킷 삭제 모드에 있을 때에도 전송 속도 감소를 거부함으로써 종단 간 혼잡 제어를 피할 수 있다는 것입니다. 네트워크의 패킷 삭제에 대한 응답입니다. 따라서 ECN 기반 혼잡 제어의 전복으로 인한 네트워크 문제는 종단 노드에서 종단 간 혼잡 제어를 의도적으로 회피함으로써 발생하는 문제보다 덜 심각합니다. 또한 인프라 자체의 동작을 제어하는 ​​것보다 최종 노드의 동작을 제어하는 ​​것이 훨씬 더 어려운 경우도 있습니다. 이는 네트워크의 ECN 기반 혼잡 제어 전복으로 인해 발생하는 네트워크 문제가 작다는 의미는 아닙니다. ECN 기반 또는 현재 알려진 다른 패킷 기반 혼잡 제어 메커니즘을 최종 노드에 의해 전복함으로써 발생하는 네트워크 문제에 비하면 왜소해 보일 뿐입니다.

---
### **19.2.  Implications for the Subverted Flow**

소스가 ECN 가능임을 나타내면 ECN에 참여할 수 있는 네트워크의 라우터가 정체 표시를 위해 CE 코드 포인트를 사용할 것으로 예상됩니다. ECN을 사용하면 패킷 손실량을 줄이는 잠재적인 이점이 있습니다\(활성 대기열 관리 정책으로 인한 대기열 지연 감소 외에도\). 터널링된 패킷이 통과하는 노드가 어떤 방식으로든 신뢰할 수 없는 IPsec 터널을 통해 패킷이 흐를 때 IPsec은 바람직하지 않은 결과를 초래하는 전복으로부터 흐름을 보호할 것으로 예상됩니다.

많은 경우, 전복된 흐름은 전복되지 않은 경쟁 흐름에 비해 더 많은 대역폭을 수신함으로써 네트워크의 해당 흐름에 대한 종단간 정체 제어의 전복으로부터 이점을 얻을 수 있습니다. 혼잡한 대기열이 패킷 삭제 단계에 도달하면 처리량, 손실 및 지연 간의 해당 흐름의 상대적인 균형에 따라 종단 간 혼잡 제어의 전복이 전복된 흐름에 전반적인 이점을 줄 수도 있고 그렇지 않을 수도 있습니다.

종단 간 혼잡 제어를 파괴하는 한 가지 형태는 ECT 코드 포인트를 설정하여 ECN 기능을 잘못 표시하는 것입니다. 이로 인해 다운스트림 혼잡 라우터가 CE 코드 포인트를 헛되이 설정하게 됩니다. 그러나 섹션 9.1.2에 설명된 대로 IP 터널에서 ECT 코드 포인트가 변경되면 터널 내에서 내부 헤더가 변경되지 않은 한 터널의 출구 지점에서 이를 감지할 수 있습니다.

종단 간 혼잡 제어를 파괴하는 두 번째 형태는 CE 코드포인트를 삭제하여 혼잡 표시를 삭제하는 것입니다. 이 경우 CE 코드포인트를 헛되이 설정한 것은 혼잡한 업스트림 라우터입니다.

IP 터널 내에서 ECT 코드 포인트가 지워지면 터널 내에서 내부 헤더가 변경되지 않은 한 터널의 송신 지점에서 이를 감지할 수 있습니다. CE 코드포인트가 IP 터널의 업스트림으로 설정된 경우 내부 헤더가 CE 코드포인트의 설정 값을 유지하므로 터널 내 외부 헤더의 CE 코드포인트를 삭제해도 아무런 효과가 없습니다. 그러나 CE 코드 포인트가 터널 내에 설정되어 있고 터널 내부 또는 다운스트림에서 삭제된 경우 터널의 출구 지점에서 이것이 반드시 감지되는 것은 아닙니다.

이러한 종단간 혼잡 제어의 전복으로 인해 최종 시스템 전송은 혼잡 표시에 응답하지 않습니다. 에 설명된 전복되지 않은 흐름에 대한 불공평성이 증가함과 함께

이전 섹션에서는 혼잡한 라우터의 대기열이 계속해서 구축되어 혼잡한 라우터에서 패킷 손실이 발생할 수 있습니다. 이는 어떤 경우에도 전송에 혼잡을 나타내는 수단입니다. 그 사이에 흐름은 전복되지 않은 다른 흐름에 비해 증가된 대역폭과 함께 더 높은 대기열 지연을 경험할 수 있습니다. 그러나 전송은 본질적으로 경로에서 신중하게 관리되는 대기열이 지속적으로 발생한다고 가정하지 않습니다. 우리는 이러한 형태의 종단 간 혼잡 제어가 파괴된 흐름에 대해 공격자가 단순히 해당 흐름 자체의 패킷을 삭제한 경우보다 나쁘지 않다고 믿습니다.

---
### **19.3.  Non-ECN-Based Methods of Subverting End-to-end Congestion Control**

우리는 많은 경우 ECN 필드의 비트를 변경할 수 있는 악의적이거나 손상된 라우터가 단순히 문제의 패킷을 삭제한 경우보다 더 많은 피해를 줄 수 없다는 것을 보여주었습니다. 그러나 이는 모든 경우에 해당되는 것은 아니며, 특히 손상된 라우터가 ECN 기능을 잘못 표시하거나 ECN 혼잡 표시\(CE 코드 포인트에서\)를 삭제하여 종단 간 혼잡 제어를 파괴한 경우에는 더욱 그렇습니다. 라우터가 패킷을 삭제하여 흐름에 해를 끼칠 수 있는 방법은 많지만 라우터는 패킷을 삭제하여 종단 간 혼잡 제어를 무너뜨릴 수 없습니다. 예를 들어, 라우터는 데이터 패킷, 승인 패킷 또는 제어 패킷을 삭제하여 TCP 혼잡 제어를 파괴할 수 없습니다.

패킷 삭제를 사용하여 종단 간 정체 제어를 무너뜨릴 수는 없지만, 손상되었거나 악의적인 라우터가 사용할 수 있는 종단 간 정체 제어를 무너뜨리는 비ECN 기반 방법이 \*있습니다\*. 예를 들어, 손상된 라우터는 데이터 패킷을 복제하여 경로의 일부 부분을 따라 종단 간 혼잡 제어의 효과를 효과적으로 무효화할 수 있습니다. \(IPsec 터널 내에서 패킷을 복제한 라우터의 경우 보안 관리자는 터널에 대한 재생 방지 보호를 구성하여 중복된 패킷이 삭제되도록 할 수 있습니다.\) 네트워크 내에서 이러한 패킷 복제는 네트워크와 네트워크에 유사한 영향을 미칩니다. 위의 섹션 18.1.1 및 18.1.4에 설명된 것과 같은 전복된 흐름.

---
## **20.  The Motivation for the ECT Codepoints.**
---
### **20.1.  The Motivation for an ECT Codepoint.**

```text
   The need for an ECT codepoint is motivated by the fact that ECN will
   be deployed incrementally in an Internet where some transport
   protocols and routers understand ECN and some do not. With an ECT
   codepoint, the router can drop packets from flows that are not ECN-
   capable, but can *instead* set the CE codepoint in packets that *are*
```

ECN 지원. ECT 코드 포인트를 사용하면 끝 노드가 패킷을 삭제하는 \*대신\* 패킷에 CE 코드 포인트를 설정할 수 있으므로 끝 노드는 ECN을 배포할 인센티브를 가질 수 있습니다.

ECT 코드 포인트가 없는 경우 라우터는 ECN 가능 및 비ECN 가능 흐름 모두의 패킷에 대해 CE 코드 포인트를 설정해야 합니다. 이 경우 엔드 노드가 ECN을 배포할 인센티브가 없으며 ECN이 아닌 세계에서 ECN 지원 세계로 증분 배포할 수 있는 실행 가능한 경로가 없습니다. 흐름의 하위 집합이 ECN을 지원하는 증분 배포의 첫 번째 단계를 생각해 보세요. 정체가 시작될 때 패킷 삭제/표시 비율이 낮을 때 라우터는 패킷을 삭제하는 대신 CE 코드 포인트만 설정합니다. 그러나 ECN 지원 흐름만 CE 패킷을 이해하고 응답합니다. 결과적으로 ECN 가능 흐름은 물러나고 ECN 가능하지 않은 흐름은 ECN 신호를 인식하지 못하고 계속해서 혼잡 창을 열게 됩니다.

이 경우 가능한 두 가지 결과가 있습니다. \(1\) ECN 지원 흐름이 백오프되고, ECN 지원이 아닌 흐름이 모든 대역폭을 확보하고 정체가 약간 유지되거나, \(2\) ECN 지원 흐름이 백오프됩니다. , 비ECN 가능 흐름은 그렇지 않으며 라우터가 CE 코드 포인트 설정에서 패킷 삭제로 전환될 때까지 정체가 증가합니다. 이 두 번째 결과는 공정성을 균등화하지만 ECN 지원 흐름은 여전히 ​​ECN 지원으로 인한 이점을 거의 받지 못합니다. 왜냐하면 혼잡이 증가하면 라우터가 패킷 삭제 동작을 하게 되기 때문입니다.

자신을 ECN 가능이라고 광고했지만 CE 코드 포인트에 응답하지 않는 흐름은 이 문서의 앞부분에서 설명한 대로 혼잡 제어를 끄는 흐름과 기능적으로 동일합니다.

따라서 흐름의 하위 집합이 ECN 가능이지만 ECN 가능 흐름에 해당 사실을 라우터에 표시하는 메커니즘이 없는 세계에서는 인터넷에서 덜 효과적이며 덜 공평한 혼잡 제어가 발생하여 결과적으로 엔드 노드가 ECN을 배포하지 않도록 하는 강력한 인센티브.

---
### **20.2.  The Motivation for two ECT Codepoints.**

두 ECT 코드 포인트의 주요 동기는 1비트 ECN nonce를 제공하는 것입니다. ECN nonce를 사용하면 발신자가 네트워크 요소가 CE 코드 포인트를 지우지 않고 있는지, 데이터 수신자가 CE 코드 포인트가 설정된 패킷 수신을 발신자에게 적절하게 보고하는지 확률론적으로 검증할 수 있는 메커니즘을 개발할 수 있습니다.

발신자가 오작동하는 네트워크 요소 또는 수신자를 감지할 수 있는 또 다른 가능성은 수신자가 CE 코드포인트 수신을 보고하는지 확인하기 위해 데이터 발신자가 가끔 CE 코드포인트 세트가 포함된 데이터 패킷을 보내는 것입니다. 물론 이러한 패킷이 네트워크에서 정체를 겪게 되면 CE 코드 포인트가 이미 설정되어 있으므로 라우터는 패킷을 변경하지 않을 수도 있습니다. 따라서 CE 코드 포인트 세트로 전송된 패킷의 경우 TCP 엔드 노드는 일부 라우터가 이러한 패킷에 CE 코드 포인트를 설정하려고 했는지 확인할 수 없습니다. 이러한 이유로 CE 코드 포인트를 사용하여 패킷을 보내는 것은 드물게 수행되어야 하며 ECN nonce보다 오작동하는 네트워크 요소 및 수신기에 대한 검사가 덜 효과적입니다.

ECT\(1\)에 네 번째 ECN 코드 포인트를 할당하면 이 코드 포인트를 다른 목적으로 사용할 수 없습니다. 명확성을 위해 여기에는 다른 가능한 목적을 간략하게 나열합니다.

한 가지 가능성은 데이터 송신자가 네 번째 ECN 코드 포인트를 사용하여 ECN에 대한 대체 의미를 나타내는 것일 수 있습니다. 그러나 이는 DS 필드에서 차별화된 서비스 코드 포인트를 사용하여 신호를 보내는 것이 더 적절하다고 생각됩니다.

네 번째 ECN 코드 포인트의 두 번째 가능한 사용은 라우터에 정체 표시를 위한 두 개의 별도 코드 포인트\(각각 약한 정체와 심각한 정체에 대해 CE\(0\) 및 CE\(1\)\)를 제공하는 것이었습니다. 이는 어떤 경우에는 유용할 수 있지만 현 시점에서는 확실히 설득력 있는 요구 사항은 아닌 것 같습니다. 이에 대한 강력한 필요성이 있다고 판단된 경우 증분 배포의 복잡성으로 인해 이 기능에 대해 단 하나의 코드 포인트 이상이 필요할 가능성이 높습니다.

ECN 코드 포인트에 대해 비공식적으로 제안된 세 번째 용도는 라우터에서 표시된 패킷을 복제하기 위한 무작위 절차를 기반으로 하는 일부 형태의 멀티캐스트 혼잡 제어에 사용하기 위한 것입니다. 일부 제안된 멀티캐스트 패킷 복제 절차는 \(1\) 패킷에 이 코드 포인트를 표시한 복제 포인트의 업스트림에서 정체가 발생했다는 사실을 전달하고 \(2\) 해당 복제 포인트의 다운스트림에서 정체를 감지할 수 있다는 사실을 전달하는 새로운 ECN 코드 포인트를 기반으로 합니다. ECT\(1\)은 ECT\(0\)과 구별되고 혼잡 또는 초기 혼잡에 대한 응답으로 ECN 표시가 발생할 때 CE로 대체되기 때문에 이 목적을 수행할 수 있습니다. ECN 인식 멀티캐스트 패킷 복제 절차와 모든 경우에\(즉, 멀티캐스트 수신자의 ECN 필드 처리와 마찬가지로\) 이 향상된 버전의 ECN이 멀티캐스트 정체 제어에 의해 어떻게 사용되는지에 대한 설명은 이 문서의 범위를 벗어납니다. 사용된 멀티캐스트 패킷 복제 절차\).

이 문서의 ECN에 대한 IP 터널 수정 사양에서는 터널 끝점 간 외부 IP 헤더의 ECN 필드에 대한 유일한 변경 사항이 정체를 나타내도록 CE 코드 포인트를 설정하는 것이라고 가정합니다. 이는 이전 단락의 멀티캐스트 복제 절차에 의해 제안된 ECT\(1\)의 일부 사용과 일치하지 않으며, 멀티캐스트 복제 절차와 전체 ECN 기능을 갖춘 IP 터널 간의 불일치가 해결되지 않는 한 이러한 절차를 배포해서는 안 됩니다. 제한된 ECN 기능을 대신 사용할 수 있지만 실제로는 터널 내에서 멀티캐스트 트래픽 복제가 발생하는 경우 많은 터널 프로토콜\(IPsec 포함\)이 올바르게 작동하지 않습니다.\(SHOULD NOT\)

---
## **21.  Why use Two Bits in the IP Header?**

IP 헤더에 ECT 표시가 필요한 경우 ECT\(ECN-Capable Transport\) 및 CE\(Congestion Experienced\) 코드 포인트가 단일 비트에 오버로드되어야 하는지 여부에 대한 의문이 여전히 남아 있습니다. \[Floyd94\]에서 살펴본 이 오버로드된 1비트 대안은 두 개의 값을 가진 단일 비트를 포함합니다. 한 값인 "ECT 및 CE가 아님"은 ECN 지원 전송을 나타내고, 다른 값인 "CE 또는 ECT 아님"은 혼잡 경험 또는 비ECN 지원 전송을 나타냅니다.

1비트 구현과 2비트 구현의 한 가지 차이점은 혼잡한 여러 라우터를 통과하는 패킷과 관련이 있습니다. 두 번째 혼잡한 라우터에 도착하고 표시 또는 삭제를 위해 해당 라우터의 활성 대기열 관리에 의해 선택되는 CE 패킷을 생각해 보세요. 1비트 구현에서 두 번째 혼잡한 라우터는 CE 패킷과 비-ECT 패킷을 구분할 수 없기 때문에 CE 패킷을 삭제할 수밖에 없습니다. 2비트 구현에서 두 번째 혼잡한 라우터는 CE 패킷을 삭제하거나 CE 코드 포인트 세트와 함께 그대로 두는 선택권을 갖습니다.

1비트 구현과 2비트 구현의 또 다른 차이점은 1비트 구현을 사용하면 단일 흐름의 수신기가 CE 패킷과 비ECT 패킷을 구별할 수 없다는 사실에서 비롯됩니다. 따라서 1비트 구현에서 ECN 가능 데이터 송신자는 각 패킷이 ECN 가능 또는 비ECN 가능으로 전송되었는지 여부를 수신자에게 명확하게 표시해야 합니다. 한 가지 가능성은 송신자가 패킷이 ECN 지원으로 전송되었는지 여부를 전송 헤더에 표시하는 것입니다. 1비트 구현에 대한 기능 제한과 관련된 두 번째 가능성은 보낸 사람이 \*모든\* 패킷을 ECN 가능 또는 비ECN 가능으로 보낼 것임을 명확하게 나타내는 것입니다. 멀티캐스트 전송 프로토콜의 경우 이 명확한 표시는 진행 중인 멀티캐스트 세션에 참여하는 수신자에게 명백해야 합니다.

앞서 설명했으며 이 문서에서 권장하는 또 다른 문제는 전송\(특히 TCP\)이 순수 ACK 패킷이나 재전송된 패킷을 ECN 지원으로 표시해서는 안 된다는 것입니다. ECN을 지원하지 않는 전송의 순수 ACK 패킷은 정체 제어 관점에서 전송에 반드시 영향을 주지 않고 삭제될 수 있습니다\(이후 ACK가 누적되기 때문입니다\). 창을 줄임으로써 순수 ACK 패킷의 CE 코드 포인트에 반응하는 ECN 가능 전송은 ECN 가능 전송이 아닌 전송에 비해 불리할 것입니다. 이러한 이유로\(및 재전송된 패킷과 관련하여 앞서 설명한 이유로\) 패킷별로 ECT 코드 포인트를 설정하는 것이 바람직합니다.

2비트 접근 방식의 또 다른 장점은 다소 강력하다는 것입니다. 섹션 8에서 논의되는 가장 중요한 문제는 기본 표시가 ECN 가능 전송이 아닌 전송의 표시여야 한다는 것입니다. 2비트 구현에서 기본값에 대한 이 요구 사항은 단순히 ECT가 아닌 코드 포인트가 기본값이어야 함을 의미합니다. 1비트 구현에서 이는 단일 오버로드된 비트가 기본적으로 "CE 또는 ECT 아님" 위치에 있어야 함을 의미합니다. 이는 덜 명확하고 간단하며 최종 노드나 라우터에서 잘못된 구현이 발생할 가능성이 더 높습니다.

요약하면, 1비트 구현이 가능한 구현일 수 있지만 2비트 구현에 비해 다음과 같은 중요한 제한 사항이 있습니다. 첫째, 1비트 구현은 혼잡한 두 번째 라우터에서 CE 패킷을 처리하는 기능이 더 제한적입니다. 둘째, 1비트 구현에서는 ECN 지원 흐름의 패킷 전송 헤더에 추가 정보가 전달되거나\(두 번째 비트의 기능을 다른 곳, 즉 전송 헤더에 전달하기 위해\) ECN 지원의 발신자가 필요합니다. 흐름은 수신자가 어떤 패킷이 ECN 가능이고 어떤 패킷이 ECN 가능하지 않은지를 선험적으로 결정할 수 있어야 한다는 제한을 받아들입니다. 셋째, 1비트 구현은 ECN 비트에 대해 잘못된 기본값을 선택하는 잘못된 구현으로 인해 오류가 발생할 가능성이 더 높습니다. 우리는 ECT 비트용 IP 헤더의 추가 비트를 사용하는 것이 이러한 제한을 극복하는 데 매우 유용하다고 믿습니다.

---
## **22.  Historical Definitions for the IPv4 TOS Octet**

RFC 791 \[RFC791\]은 IP 헤더에 ToS\(서비스 유형\) 옥텟을 정의했습니다. RFC 791에서는 ToS 옥텟의 비트 6과 7이 "향후 사용을 위해 예약됨"으로 나열되어 있으며 0으로 설정된 것으로 표시됩니다. ToS 옥텟의 처음 두 필드는 우선순위 및 서비스 유형\(TOS\) 필드로 정의되었습니다.

```text
             0     1     2     3     4     5     6     7
          +-----+-----+-----+-----+-----+-----+-----+-----+
          |   PRECEDENCE    |       TOS       |  0  |  0  |  RFC 791
          +-----+-----+-----+-----+-----+-----+-----+-----+
```

RFC 1122에는 TOS 필드에 비트 6과 7이 포함되어 있지만 이 두 비트의 구체적인 용도에 대해서는 논의하지 않았습니다.

```text
             0     1     2     3     4     5     6     7
          +-----+-----+-----+-----+-----+-----+-----+-----+
          |   PRECEDENCE    |       TOS                   |  RFC 1122
          +-----+-----+-----+-----+-----+-----+-----+-----+
```

IPv4 TOS 옥텟은 RFC 1349 \[RFC1349\]에서 다음과 같이 재정의되었습니다.

```text
             0     1     2     3     4     5     6     7
          +-----+-----+-----+-----+-----+-----+-----+-----+
          |   PRECEDENCE    |       TOS             | MBZ |  RFC 1349
          +-----+-----+-----+-----+-----+-----+-----+-----+

   Bit 6 in the TOS field was defined in RFC 1349 for "Minimize Monetary
   Cost".  In addition to the Precedence and Type of Service (TOS)
   fields, the last field, MBZ (for "must be zero") was defined as
   currently unused.  RFC 1349 stated that "The originator of a datagram
   sets [the MBZ] field to zero (unless participating in an Internet
   protocol experiment which makes use of that bit)."
```

RFC 1455 \[RFC 1455\]는 보장된 링크 보안 수준을 요청하기 위해 TOS 필드의 4개 비트를 모두 사용하는 실험적 표준을 정의했습니다.

RFC 1349 및 RFC 1455는 DS 필드의 비트 6 및 7이 현재 사용되지 않음\(CU\)으로 나열되는 "IPv4 및 IPv6 헤더의 차별화된 서비스 필드\(DS 필드\) 정의"\[RFC2474\]에 의해 더 이상 사용되지 않습니다. RFC 2780 \[RFC2780\]은 2비트 CU 필드의 실험적 사용으로 ECN을 지정했습니다. RFC 2780에서는 8비트 전체가 아닌 이 옥텟의 처음 6비트만 포함하도록 DS 필드의 정의를 업데이트했습니다. 처음 6비트는 DSCP\(Differentiated Services CodePoint\)로 정의됩니다.

```text
            0     1     2     3     4     5     6     7
         +-----+-----+-----+-----+-----+-----+-----+-----+
         |               DSCP                |    CU     |  RFCs 2474,
         +-----+-----+-----+-----+-----+-----+-----+-----+    2780
```

이러한 불안정한 기록으로 인해 이 문서의 ECN 필드 정의는 이 두 비트의 모든 과거 사용과 역호환성을 보장할 수 없습니다.

RFC 2474 이전에는 라우터를 통해 전달된 패킷의 DSCP 또는 ECN 필드에서 비트를 수정하는 것이 허용되지 않았으므로 2474 이전의 RFC만 준수하는 라우터는 ECN에 영향을 주지 않습니다. 최종 노드의 경우 2474 이전의 RFC만을 준수하는 모든 구현에서는 비트 7\(두 번째 ECN 비트\)을 0으로 전송해야 합니다. 이러한 노드는 "금전적 비용 최소화" 조항을 위해 비트 6\(첫 번째 ECN 비트\)을 1로 전송할 수 있습니다. RFC 1349 또는 RFC 1455에 의해 승인된 실험; RFC 1349의 이러한 측면이나 RFC 1455의 실험은 널리 구현되거나 사용되지 않았습니다. 부적합 라우터로 인해 발생할 수 있는 손상에는 CE 코드 포인트가 설정된 라우터에 도착한 ECN 가능 패킷의 CE 코드 포인트를 "삭제"하거나 정체가 없는 경우에도 CE 코드 포인트를 설정하는 것이 포함됩니다. . 이에 대해서는 "네트워크의 비준수" 섹션에서 논의되었습니다.

ECN 가능 환경에서 ECT 코드 포인트 세트가 포함된 패킷을 전송하는 비ECN 가능 엔드 노드에 의해 발생할 수 있는 손상은 "엔드 노드에 의한 비준수" 섹션에서 논의되었습니다.

---
## **23.  IANA Considerations**

이 섹션에는 이 사양에서 생성된 네임스페이스 또는 IANA에서 관리하는 기존 네임스페이스에 할당된 값이 포함되어 있습니다.

---
### **23.1.  IPv4 TOS Byte and IPv6 Traffic Class Octet**

IP 헤더의 ECN 필드에 대한 코드 포인트는 RFC 2780에서 요구하는 대로 이 RFC의 표준 작업에 의해 지정됩니다.

이 문서가 RFC로 게시되면 IANA는 다음과 같은 네임스페이스를 사용하여 "IPv4 TOS 바이트 및 IPv6 트래픽 클래스 옥텟"이라는 새 레지스트리를 생성해야 합니다.

IPv4 TOS 바이트 및 IPv6 트래픽 클래스 옥텟

설명: IPv4와 IPv6의 등록은 동일합니다.

```text
   Bits 0-5:  see Differentiated Services Field Codepoints Registry
           (http://www.iana.org/assignments/dscp-registry)

   Bits 6-7, ECN Field:

   Binary  Keyword                                  References
   ------  -------                                  ----------
     00     Not-ECT (Not ECN-Capable Transport)     [RFC 3168]
     01     ECT(1) (ECN-Capable Transport(1))       [RFC 3168]
     10     ECT(0) (ECN-Capable Transport(0))       [RFC 3168]
     11     CE (Congestion Experienced)             [RFC 3168]
```

---
### **23.2.  TCP Header Flags**

TCP 헤더의 CWR 및 ECE 플래그에 대한 코드 포인트는 RFC 2780에서 요구하는 대로 이 RFC의 표준 조치에 의해 지정됩니다.

이 문서가 RFC로 게시되면 IANA는 다음과 같은 네임스페이스를 사용하여 "TCP 헤더 플래그"라는 새 레지스트리를 생성해야 합니다.

```text
   TCP Header Flags
```

TCP\(전송 제어 프로토콜\)에는 아래 그림과 같이 TCP 헤더의 바이트 13 및 14에 향후 사용을 위해 예약된 RFC 793에 정의된 6비트 예약 필드가 포함되어 있습니다. 나머지 6개의 제어 비트는 RFC 793에 의해 별도로 정의됩니다.

```text
     0   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
   |               |                       | U | A | P | R | S | F |
   | Header Length |        Reserved       | R | C | S | S | Y | I |
   |               |                       | G | K | H | T | N | N |
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
```

RFC 3168은 예약된 필드의 6개 비트 중 2개를 ECN에 사용하도록 정의합니다.

```text
     0   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
   |               |               | C | E | U | A | P | R | S | F |
   | Header Length |    Reserved   | W | C | R | C | S | S | Y | I |
   |               |               | R | E | G | K | H | T | N | N |
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+

   TCP Header Flags

   Bit      Name                                    Reference
   ---      ----                                    ---------
    8        CWR (Congestion Window Reduced)        [RFC 3168]
    9        ECE (ECN-Echo)                         [RFC 3168]
```

---
### **23.3. IPSEC Security Association Attributes**

IANA는 1999년 11월 David Black의 요청에 따라 위 섹션 9.2.1.2에 설명된 ECN 터널 사용을 위해 IPSEC 보안 연관 속성 값 10을 할당했습니다. IANA는 이 할당에 대한 참조를 David Black의 요청에서 이 RFC로 변경했습니다.

---
## **24.  Authors' Addresses**

```text
   K. K. Ramakrishnan
   TeraOptic Networks, Inc.

   Phone: +1 (408) 666-8650
   EMail: kk@teraoptic.com

   Sally Floyd
   ACIRI

   Phone: +1 (510) 666-2989
   EMail: floyd@aciri.org
   URL: http://www.aciri.org/floyd/

   David L. Black
   EMC Corporation
   42 South St.
   Hopkinton, MA  01748

   Phone:  +1 (508) 435-1000 x75140
   EMail: black_david@emc.com
```

---
## **25.  Full Copyright Statement**

Copyright \(C\) The Internet Society \(2001\). 판권 소유.

이 문서와 그 번역본은 복사되어 타인에게 제공될 수 있으며, 이에 대해 설명하거나 설명하거나 구현을 지원하는 파생물은 어떤 종류의 제한 없이 전체적으로 또는 부분적으로 준비, 복사, 출판 및 배포될 수 있습니다. , 단, 위의 저작권 표시와 이 단락은 그러한 모든 사본 및 파생물에 포함됩니다. 그러나 이 문서 자체는 인터넷 표준 개발 목적으로 필요한 경우를 제외하고는 저작권 표시를 제거하거나 Internet Society 또는 기타 인터넷 조직에 대한 참조를 제거하는 등 어떤 식으로든 수정할 수 없습니다. 인터넷 표준 프로세스를 따르거나 영어 이외의 언어로 번역하는 데 필요한 대로 따라야 합니다.

위에서 부여된 제한된 권한은 영구적이며 Internet Society 또는 그 승계자 또는 양수인에 의해 취소되지 않습니다.

이 문서와 여기에 포함된 정보는 "있는 그대로" 제공되며 인터넷 사회 및 인터넷 공학 태스크포스는 여기에 포함된 정보의 사용이 상품성 또는 특정 목적에의 적합성에 대한 권리 또는 묵시적 보증을 침해하는 행위.

---
# **Acknowledgement**

RFC 편집기 기능에 대한 자금은 현재 Internet Society에서 제공하고 있습니다.