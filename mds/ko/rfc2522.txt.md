

```text
Network Working Group                                            P. Karn
Request for Comments: 2522                                      Qualcomm
Category: Experimental                                        W. Simpson
                                                              DayDreamer
                                                              March 1999

               Photuris: Session-Key Management Protocol
```

---
# **Status of this Memo**

이 문서는 인터넷 커뮤니티를 위한 실험 프로토콜을 정의합니다. 어떤 종류의 인터넷 표준도 지정하지 않습니다. 개선을 위한 논의와 제안을 요청합니다. 이 메모의 배포는 무제한입니다.

---
# **Copyright Notice**

저작권\(C\)인터넷학회\(1999\). 저작권\(C\) Philip Karn 및 William Allen Simpson\(1994-1999\). 판권 소유.

---
# **Abstract**

Photuris는 IP 보안 프로토콜\(AH 및 ESP\)과 함께 사용하도록 고안된 세션 키 관리 프로토콜입니다. 이 문서는 기본 프로토콜 메커니즘을 정의합니다.

```text
Karn & Simpson                Experimental                      [Page i]
RFC 2522                   Photuris Protocol                  March 1999
```

---
# **Table of Contents**

```text
     1.     Introduction ..........................................    1
        1.1       Terminology .....................................    1
        1.2       Protocol Overview ...............................    3
        1.3       Security Parameters .............................    5
        1.4       LifeTimes .......................................    6
           1.4.1  Exchange LifeTimes ..............................    6
           1.4.2  SPI LifeTimes ...................................    7
        1.5       Random Number Generation ........................    8
     2.     Protocol Details ......................................    9
        2.1       UDP .............................................    9
        2.2       Header Format ...................................   10
        2.3       Variable Precision Integers .....................   11
        2.4       Exchange-Schemes ................................   13
        2.5       Attributes ......................................   13
     3.     Cookie Exchange .......................................   14
           3.0.1  Send Cookie_Request .............................   14
           3.0.2  Receive Cookie_Request ..........................   15
           3.0.3  Send Cookie_Response ............................   15
           3.0.4  Receive Cookie_Response .........................   16
        3.1       Cookie_Request ..................................   17
        3.2       Cookie_Response .................................   18
        3.3       Cookie Generation ...............................   19
           3.3.1  Initiator Cookie ................................   19
           3.3.2  Responder Cookie ................................   20
     4.     Value Exchange ........................................   21
           4.0.1  Send Value_Request ..............................   21
           4.0.2  Receive Value_Request ...........................   22
           4.0.3  Send Value_Response .............................   22
           4.0.4  Receive Value_Response ..........................   23
        4.1       Value_Request ...................................   24
        4.2       Value_Response ..................................   25
        4.3       Offered Attribute List ..........................   26
     5.     Identification Exchange ...............................   28
           5.0.1  Send Identity_Request ...........................   29
           5.0.2  Receive Identity_Request ........................   29
           5.0.3  Send Identity_Response ..........................   30
           5.0.4  Receive Identity_Response .......................   30
        5.1       Identity_Messages ...............................   31
        5.2       Attribute Choices List ..........................   33
        5.3       Shared-Secret ...................................   34
        5.4       Identity Verification ...........................   34
```

```text
Karn & Simpson                Experimental                     [Page ii]
RFC 2522                   Photuris Protocol                  March 1999
```

```text
        5.5       Privacy-Key Computation .........................   36
        5.6       Session-Key Computation .........................   37
     6.     SPI Messages ..........................................   38
           6.0.1  Send SPI_Needed .................................   38
           6.0.2  Receive SPI_Needed ..............................   39
           6.0.3  Send SPI_Update .................................   39
           6.0.4  Receive SPI_Update ..............................   39
           6.0.5  Automated SPI_Updates ...........................   40
        6.1       SPI_Needed ......................................   41
        6.2       SPI_Update ......................................   43
           6.2.1  Creation ........................................   44
           6.2.2  Deletion ........................................   45
           6.2.3  Modification ....................................   45
        6.3       Validity Verification ...........................   45
     7.     Error Messages ........................................   46
        7.1       Bad_Cookie ......................................   47
        7.2       Resource_Limit ..................................   47
        7.3       Verification_Failure ............................   48
        7.4       Message_Reject ..................................   49
     8.     Public Value Exchanges ................................   50
        8.1       Modular Exponentiation Groups ...................   50
        8.2       Moduli Selection ................................   50
           8.2.1  Bootstrap Moduli ................................   51
           8.2.2  Learning Moduli .................................   51
        8.3       Generator Selection .............................   51
        8.4       Exponent Selection ..............................   52
        8.5       Defective Exchange Values .......................   53
     9.     Basic Exchange-Schemes ................................   54
     10.    Basic Key-Generation-Function .........................   55
        10.1      MD5 Hash ........................................   55
     11.    Basic Privacy-Method ..................................   55
        11.1      Simple Masking ..................................   55
     12.    Basic Validity-Method .................................   55
        12.1      MD5-IPMAC Check .................................   55
     13.    Basic Attributes ......................................   56
        13.1      Padding .........................................   56
        13.2      AH-Attributes ...................................   57
        13.3      ESP-Attributes ..................................   57
        13.4      MD5-IPMAC .......................................   58
           13.4.1 Symmetric Identification ........................   58
```

```text
Karn & Simpson                Experimental                    [Page iii]
RFC 2522                   Photuris Protocol                  March 1999
```

```text
           13.4.2 Authentication ..................................   59
        13.5      Organizational ..................................   60
     APPENDICES ...................................................   61
     A.     Automaton .............................................   61
        A.1       State Transition Table ..........................   62
        A.2       States ..........................................   65
           A.2.1  Initial .........................................   65
           A.2.2  Cookie ..........................................   66
           A.2.3  Value ...........................................   66
           A.2.4  Identity ........................................   66
           A.2.5  Ready ...........................................   66
           A.2.6  Update ..........................................   66
     B.     Use of Identification and Secrets .....................   67
        B.1       Identification ..................................   67
        B.2       Group Identity With Group Secret ................   67
        B.3       Multiple Identities With Group Secrets ..........   68
        B.4       Multiple Identities With Multiple Secrets .......   69
     OPERATIONAL CONSIDERATIONS ...................................   70
     SECURITY CONSIDERATIONS ......................................   70
     HISTORY ......................................................   71
     ACKNOWLEDGEMENTS .............................................   72
     REFERENCES ...................................................   73
     CONTACTS .....................................................   75
     COPYRIGHT ....................................................   76
```

```text
Karn & Simpson                Experimental                     [Page iv]
RFC 2522                   Photuris Protocol                  March 1999
```

---
## **1.  Introduction**

Photuris \[Firefly\]는 인터넷을 통해 세션 키를 전달하지 않고 두 당사자 간에 단기 세션 키를 설정합니다. 이러한 세션 키는 이전에 보안 목적으로 구성되었던 장기 비밀 키\(예: 암호 및 암호 문구\)를 직접 대체합니다.

기본 Photuris 프로토콜은 당사자 식별을 위해 이전에 구성된 기존 비밀 키를 활용합니다. 이는 배포 속도를 높이고 관리 구성 변경을 줄이기 위한 것입니다.

이 문서는 주로 Photuris 프로토콜을 구현하기 위한 것입니다. 프로토콜 메커니즘의 적절한 구현과 작동에 필요한 일부 기본 정책 영역을 언급하기는 하지만 서비스 및 애플리케이션 인터페이스 정의를 자세히 설명하지는 않습니다.

기본 Photuris 프로토콜은 확장 가능하므로 새로운 데이터 유형과 프로토콜 동작이 예상됩니다. 구현자는 예제에 현재 있거나 완전한 것으로 나타나는 값에 의존하지 않도록 특히 주의해야 합니다. 그 목적은 주로 교육적이기 때문입니다.

---
### **1.1.  Terminology**

이 문서에서 키워드 "할 수 있다", "해야 한다", "해야 한다", "선택적", "권장한다", "해야 한다", "하면 안 된다"는 \[RFC-2119\]에 설명된 대로 해석됩니다.\(MUST NOT\)

byte 8비트 수량입니다. "옥텟"이라고도 함

- 표준어.

교환 가치 공유 비밀을 계산하는 데 사용되는 공개적으로 배포 가능한 가치입니다. 이 문서에 사용된 대로 공개/개인 키 쌍의 공개 부분이 아닌 Diffie-Hellman 교환을 나타냅니다.

개인 키 비밀로 유지되고 비대칭 공개/개인 키 쌍의 일부인 값입니다.

공개 키 비대칭 공개/개인 키 쌍의 일부인 공개적으로 배포 가능한 값입니다.

```text
   secret-key       A symmetric key that is not publically
                    distributable.  As used in this document, this is
                    distinguished from an asymmetric public/private
```

- 키 쌍. 예를 들어 사용자 비밀번호가 있습니다.

보안 협회\(SA\)

- 두 노드 간의 보안 관계를 설명하는 매개변수 모음입니다. 이러한 매개변수에는 당사자의 신원, 변환\(알고리즘 및 알고리즘 모드 포함\), 키\(예: 세션 키, 비밀 키 또는 적절한 공개/개인 키 쌍\) 및 기타 정보가 포함됩니다. 예를 들어 민감도 라벨링.

보안 매개변수 지수\(SPI\)

- 변환 및 세션 키와 같이 보안 연관 하에서 사용되는 특정 단방향 속성 세트를 나타내는 숫자입니다. 이 번호는 SPI 소유자인 IP 대상에 상대적이며 IP\(다음 헤더\) 프로토콜별로 고유합니다. 즉, 여러 프로토콜에서 동일한 값을 사용하여 서로 다른 보안 연관 매개변수를 동시에 나타낼 수 있습니다.\(MAY\)

세션 키 당사자의 공유 비밀에서 독립적으로 파생되고 트래픽의 한 방향을 입력하는 데 사용되는 키입니다. 이 키는 자주 변경됩니다.

공유 비밀 이 문서에서 사용되는 Photuris 교환의 계산된 결과입니다.

SPI 소유자 IP 대상에 해당하는 당사자입니다. 보호된 데이터그램의 의도된 수신자.

SPI 사용자 IP 소스에 해당하는 당사자입니다. 보호된 데이터그램의 송신자.

변환 특정 데이터 세트의 암호화 조작입니다. 이 문서에서 사용된 것처럼 잘 지정된 특정 방법\(다른 곳에서 정의됨\)을 나타냅니다. 예를 들어, AH-MD5 \[RFC-1828\]는 IP 데이터그램을 암호화 해시로 변환하고 ESP-DES-CBC \[RFC-1829\]는 일반 텍스트를 암호 텍스트로 변환한 후 다시 그 반대로 변환합니다.

이러한 용어 중 다수는 계층적으로 관련되어 있습니다.

```text
      Security Association (bi-directional)
       - one or more lists of Security Parameters (uni-directional)
        -- one or more Attributes
         --- may have a key
         --- may indicate a transform
```

구현자는 \[Schneier95\]에서 암호화 해싱\(예: MD5\), 암호화 알고리즘 및 모드\(예: DES\), 디지털 서명\(예: DSS\) 및 기타 알고리즘에 대한 세부 정보를 찾을 수 있습니다.

---
### **1.2.  Protocol Overview**

Photuris 프로토콜은 몇 가지 간단한 단계로 구성됩니다.

1. "쿠키" 교환은 가짜 IP 소스 또는 UDP 포트를 통해 전송되는 단순 플러딩 공격으로부터 보호합니다. 각 당사자는 상대방에게 "쿠키"를 전달합니다.

- 그 대가로 응답자는 공유 비밀 계산을 위해 지원되는 교환 체계 목록을 제공합니다.

2. 가치 교환은 당사자들 사이에 공유 비밀을 설정합니다. 각 당사자는 교환 가치를 상대방에게 전달합니다. 이 값은 공유 비밀을 계산하는 데 사용됩니다. 응답자는 공유 비밀이 생성될 때까지 상태 비저장 상태로 유지됩니다.

- 또한 지원되는 속성은 새로운 보안 매개변수 설정에 사용하기 위해 각 당사자가 제공합니다.

3. 식별 교환은 당사자를 서로 식별하고 1단계와 2단계에서 전송된 값의 무결성을 확인합니다.

- 또한 공유 비밀은 각 방향에서 별도의 세션 키를 생성하는 기반을 제공하며 이는 다시 기존 인증 또는 암호화에 사용됩니다. 필요에 따라 추가 보안 속성도 교환됩니다.

- 본 교환은 당사자의 개인정보 보호를 위해 공유비밀 기반의 메시지 프라이버시 키를 사용하여 마스크 처리됩니다. 이는 당사자의 신원을 보호하고 보안 매개변수 속성 값을 숨기며 교환 프로토콜 및 보안 변환에 대한 보안을 향상시킵니다.

4. 세션 키를 주기적으로 변경하고 새롭거나 개정된 보안 매개변수를 설정하기 위해 추가 메시지가 교환될 수 있습니다.

- 해당 거래소 역시 위와 같은 방식으로 당사자의 개인정보 보호를 위해 마스킹됩니다.

메시지 유형의 순서와 그 목적은 아래 다이어그램에 요약되어 있습니다. 보안 연결을 사용하려면 먼저 처음 세 단계\(쿠키, 교환 및 식별\)를 모두 수행해야 합니다.

```text
   Initiator                            Responder
   =========                            =========
   Cookie_Request                 ->
                                   <-   Cookie_Response
                                           offer schemes
   Value_Request                  ->
      pick scheme
      offer value
      offer attributes
                                   <-   Value_Response
                                           offer value
                                           offer attributes
```

- \[교환된 가치로부터 공유 비밀 생성\]

```text
   Identity_Request               ->
      make SPI
      pick SPI attribute(s)
      identify self
      authenticate
      make privacy key(s)
      mask/encrypt message
                                   <-   Identity_Response
                                           make SPI
                                           pick SPI attribute(s)
                                           identify self
                                           authenticate
                                           make privacy key(s)
                                           mask/encrypt message
```

- \[각 방향으로 SPI 세션 키 만들기\]

```text
   SPI User                             SPI Owner
   ========                             =========
   SPI_Needed                     ->
      list SPI attribute(s)
      make validity key
      authenticate
      make privacy key(s)
      mask/encrypt message
                                   <-   SPI_Update
                                           make SPI
                                           pick SPI attribute(s)
                                           make SPI session-key(s)
                                           make validity key
                                           authenticate
                                           make privacy key(s)
                                           mask/encrypt message
```

어느 쪽이든 언제든지 교환을 시작할 수 있습니다. 예를 들어 개시자는 전화 링크에서 "발신자"일 필요는 없습니다.

개시자는 재전송으로 인한 모든 메시지 손실을 복구할 책임이 있습니다.

---
### **1.3.  Security Parameters**

두 당사자 간의 Photuris 교환으로 인해 SPI 값 쌍\(각 방향에 하나씩\)이 생성됩니다. 각 SPI는 각 방향에서 별도의 세션 키를 생성하는 데 사용됩니다.

SPI는 IP 대상을 제어하는 ​​엔터티인 SPI 소유자\(수신자\)에 의해 할당됩니다. 당사자는 IP 대상, IP\(다음 헤더\) 프로토콜 및 SPI의 조합을 사용하여 올바른 보안 연결을 구별합니다.

양 당사자가 동시에 Photuris 교환을 시작하거나 한 당사자가 둘 이상의 Photuris 교환을 시작하는 경우 개시자 쿠키\(및 UDP 포트\)는 교환을 별도로 유지합니다. 이로 인해 각 대상에 대해 둘 이상의 초기 SPI가 생성됩니다.

서로 다른 매개변수를 사용하여 여러 SPI를 생성하기 위해 당사자는 SPI\_Update를 보낼 수도 있습니다.

이러한 뛰어난 SPI를 모두 사용해야 한다는 요구 사항은 없습니다. SPI 사용자\(송신자\)는 각 데이터그램 전송에 대해 적절한 SPI를 선택합니다.

```text
   Implementation Notes:
```

- SPI 할당에 사용되는 방법은 구현에 따라 다릅니다. 유일한 요구 사항은 SPI가 IP 대상 및 IP\(다음 헤더\) 프로토콜에 대해 고유해야 한다는 것입니다.

- 그러나 암호화된 무작위 SPI 값을 선택하면 예측 가능한 값 시퀀스에 의존하는 공격을 방지하는 데 도움이 될 수 있습니다. 구현자는 SPI 값이 특정 순서나 범위를 가질 것으로 기대해서는 안 됩니다.\(MUST NOT\)

---
### **1.4.  LifeTimes**

Photuris 교환으로 인해 각각 별도의 LifeTimes를 갖는 두 종류의 상태가 생성됩니다.

1\) Photuris 거래소 자체와 관련된 소량 상태의 Exchange LifeTime입니다. 이 상태는 인터넷 노드 사이로 볼 수 있습니다.

2\) 설정된 개별 SPI의 SPI 수명. 이 상태는 사용자와 노드 사이로 볼 수 있습니다.

SPI 수명은 Exchange 수명보다 짧을 수도 있고 길 수도 있습니다. 이러한 LifeTime은 서로 관련될 필요가 없습니다.

교환 가치가 만료되면\(또는 새로운 값으로 대체되면\) 만료되지 않은 파생 SPI는 영향을 받지 않습니다. 이는 새로운 Photuris 교환 중에 트래픽이 중단 없이 계속되도록 하는 데 중요합니다.

---
#### **1.4.1.  Exchange LifeTimes**

양 당사자가 보유하고 있는 모든 교환 상태에는 연관된 ELT\(교환 수명\)이 있으며 정기적으로 만료됩니다. 이는 머신의 물리적, 물류적 보안에 따라 달라지며 일반적으로 10분\~1일\(기본값 30분\) 범위입니다.

또한 Photuris 교환 중에는 ETO\(Exchange TimeOut\)로 인해 교환이 완료될 때까지 기다리는 시간이 제한됩니다. 이 시간 초과에는 패킷 왕복 및 식별 교환 계산을 완료하는 데 걸리는 시간이 포함됩니다. 시간은 알 수 없는 피어의 처리 능력에 대해 예상되는 최대 계산 지연량과 해당 피어에 대한 최소 사용자 기대치 모두에 의해 제한됩니다.

```text
   results (default 30 seconds).
```

이러한 Exchange 수명 및 시간 초과는 구현에 따라 다르며 Photuris 메시지에 공개되지 않습니다. 편집증적인 운영자는 상당히 짧은 Exchange 수명을 갖지만 ETO의 두 배 미만이어서는 안 됩니다.\(MUST NOT\)

Photuris 교환 간의 동기화를 방지하려면 구현 시 새 Exchange-Value를 계산하는 데 필요한 초 범위의 두 배 내에서 각 Exchange 수명 시간을 무작위로 변경해야 합니다. 예를 들어, 응답자가 30분의 기본 ELT를 사용하고 새 교환 가치를 계산하는 데 10초가 걸리는 경우 방정식은 다음과 같습니다\(밀리초\).\(SHOULD\)

```text
      1790000 + urandom(20000)
```

Exchange-Scheme, Exchange-Values ​​및 결과 공유 비밀은 Exchange 수명 동안 단기 저장소에 캐시될 수 있습니다. 동일한 당사자 간에 반복적인 Photuris 교환이 발생하고 교환 값이 변경되지 않은 것으로 밝혀지면 이전에 계산된 공유 비밀을 사용하여 새로운 세션 키를 신속하게 생성할 수 있습니다.\(MAY\)

---
#### **1.4.2.  SPI LifeTimes**

각 SPI에는 SPI 소유자\(수신자\)가 지정한 관련 수명 시간이 있습니다. 이 SPI 수명\(SPILT\)은 일반적으로 링크 속도\(일반적으로 2\~30분\)와 관련이 있지만 ETO의 3배보다 작아서는 안 됩니다.\(MUST NOT\)

SPI\_Update를 사용하여 SPI 소유자가 SPI를 삭제할 수도 있습니다. SPI가 만료되거나 삭제되면 당사자는 SPI 사용을 중단합니다.

여러 Photuris 교환 간의 동기화를 방지하려면 구현 시 각 SPI 수명 시간을 무작위로 변경해야 합니다. 예를 들어 응답자가 기본 SPILLED를 5분, ETO에 30초를 사용하는 경우 방정식은 다음과 같습니다\(밀리초\).\(SHOULD\)

```text
      285000 + urandom(30000)
```

SPI 사용자가 긴 수명을 허용해야 한다는 요구 사항은 없습니다. SPI 사용자는 설정된 SPI를 절대 사용하지 않거나 언제든지 SPI 사용을 중단할 수 없습니다.

동일한 기능에 대해 SPI 사용자가 만료되지 않은 SPI를 두 개 이상 사용할 수 있는 경우 일반적인 구현 기술은 SPI를 선택하는 것입니다.

남은 LifeTime이 가장 큽니다. 그러나 다수의 SPI 중에서 무작위로 선택하면 트래픽 분석에 대한 방어가 어느 정도 제공될 수 있습니다.

삭제되거나 만료된 SPI의 부활을 방지하기 위해 SPI 소유자는 해당 SPI를 기억해야 하지만 이를 생성하는 데 사용된 Photuris 교환 공유 비밀도 만료되고 관련 상태를 제거할 때까지 사용할 수 없는 것으로 표시해야 합니다.\(SHOULD\)

SPI 소유자가 최근 만료된 수신 SPI를 감지했지만 관련 교환 상태가 아직 제거되지 않은 경우 구현은 SPI를 수락할 수 있습니다. 허용되는 시간 길이는 클럭 드리프트 및 가변 패킷 왕복 시간에 따라 크게 달라지므로 구현에 따라 다릅니다.\(MAY\)

---
### **1.5.  Random Number Generation**

Photuris의 보안은 각 당사자가 생성한 비밀 난수의 품질에 따라 결정적으로 달라집니다. 어느 쪽이든 난수 생성기가 불량하면 알고리즘에서 생성된 공유 비밀이 손상될 수 있습니다.

하드웨어 지원 없이 범용 컴퓨터에서 암호화 품질 난수를 생성하는 것은 매우 까다로운 문제입니다. 일반적으로 이를 위해서는 키 입력 타이밍과 같은 다수의 반 무작위 외부 이벤트로부터 엔트로피를 "추출"하기 위해 암호화 해싱 함수를 사용해야 합니다. 훌륭한 토론은 \[RFC-1750\]에서 찾을 수 있습니다.

---
## **2.  Protocol Details**

개시자는 여러 상황에서 Photuris 교환을 시작합니다.

- 개시자는 전송하려는 데이터그램을 가지고 있습니다.

- 기밀성이며 IP 대상과 현재 Photuris 교환 상태가 없습니다. 이 데이터그램은 삭제되고 대신 Cookie\_Request가 전송됩니다.

- 개시자는 ICMP 메시지 \[RFC-1812\] 목적지 도달 불가: 통신 관리적으로 금지됨\(유형 3, 코드 13\)을 수신했으며 현재 ICMP 소스와의 Photuris 교환 상태가 없습니다.

- 개시자는 ICMP 소스와 현재 Photuris 교환 상태를 일치시키는 ICMP 메시지 \[RFC-2521\] 보안 실패: 잘못된 SPI\(유형 40, 코드 0\)를 수신했습니다.

- 개시자는 ICMP 메시지 \[RFC-2521\] 보안 실패: 인증 필요\(유형 40, 코드 4\)를 수신했으며 현재 ICMP 소스와 Photuris 교환 상태가 없습니다.

- 개시자는 ICMP 소스와 현재 Photuris 교환 상태를 일치시키는 ICMP 메시지 \[RFC-2521\] 보안 실패: 인증 필요\(유형 40, 코드 5\)를 수신했습니다.

이벤트가 ICMP 메시지인 경우 ICMP 메시지에 실제로 이전에 전송된 IP 데이터그램과 일치하는 정보가 포함되어 있는지 특별한 주의를 기울여야 합니다. 그렇지 않으면 새로운 Photuris Exchange를 자극하여 막힘 공격의 기회를 제공할 수 있습니다.\(MUST\)

---
### **2.1.  UDP**

모든 Photuris 메시지는 사용자 데이터그램 프로토콜 헤더 \[RFC-768\]를 사용합니다. 개시자는 UDP 대상 포트 468로 전송합니다.

개시자에게 응답할 때 응답자는 IP 소스와 대상, UDP 소스와 대상 포트를 교환합니다.

UDP 체크섬은 전송 시 올바르게 계산되어야 합니다. 잘못된 UDP 체크섬이 포함된 메시지가 수신되면 해당 메시지는 자동으로 삭제됩니다.\(MUST\)

```text
   Implementation Notes:
```

- Photuris를 설치하면 컴퓨터 운영 체제에 대해 UDP 체크섬 계산이 활성화되고 나중에 운영자가 비활성화하는 것을 방지할 수 있을 것으로 예상됩니다.

- 인터넷 프로토콜 버전 4 \[RFC-791\]에서는 최대 재조립된 데이터그램을 576바이트로 제한합니다.

- 가변 크기 값을 포함하는 데이터그램을 처리할 때 전체 데이터그램 길이와 비교하여 길이를 확인해야 합니다. 잘못 코딩된 수신기를 중단시키는 잘못된 크기\(너무 길거나 짧음\)는 서비스 거부 공격으로 사용될 수 있습니다.

---
### **2.2.  Header Format**

모든 메시지는 네트워크 순서\(가장 중요한 것부터 가장 중요한 것까지\)에 따라 왼쪽에서 오른쪽으로 전송되는 다음과 유사한 형식을 갖습니다.

```text
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                       Initiator-Cookie                        ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                       Responder-Cookie                        ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    Message    |
   +-+-+-+-+-+-+-+-+

   Initiator-Cookie  16 bytes.

   Responder-Cookie  16 bytes.

   Message          1 byte.  Each message type has a unique value.
                    Initial values are assigned as follows:

                        0  Cookie_Request
                        1  Cookie_Response
                        2  Value_Request
                        3  Value_Response
                        4  Identity_Request
                        5  Secret_Response (optional)
                        6  Secret_Request (optional)
                        7  Identity_Response
                        8  SPI_Needed
                        9  SPI_Update
                       10  Bad_Cookie
                       11  Resource_Limit
                       12  Verification_Failure
                       13  Message_Reject
```

자세한 내용과 차이점은 개별 메시지에 자세히 설명되어 있습니다.

---
### **2.3.  Variable Precision Integers**

```text
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |             Size              |             Value ...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

크기는 2, 4 또는 8바이트입니다. 값 필드에 사용된 유효 비트 수입니다. 항상 가장 중요한 바이트를 먼저 전송합니다.

- 크기가 0이면 값 필드가 존재하지 않습니다. 중요한 비트가 없습니다. 이는 "누락" 또는 "널"을 의미합니다. 이는 유효 비트 수 표시를 포함하는 0 값과 혼동되어서는 안 됩니다.

- 최상위 바이트가 0\~254\(0xfe\) 범위에 있는 경우 필드는 2바이트입니다. 두 바이트 모두 값 필드의 크기를 나타내는 데 사용되며 범위는 1\~65,279 유효 비트\(1\~8,160바이트\)입니다.

```text
                    When the most significant byte is 255 (0xff), the
                    field is 4 bytes.  The remaining 3 bytes are added
                    to 65,280 to indicate the size of the Value field,
                    which is limited to 16,776,959 significant bits (in

                    2,097,120 bytes).
```

- 최상위 2바이트가 65,535\(0xffff\)인 경우 해당 필드는 8바이트입니다. 나머지 6바이트는 16,776,960에 추가되어 값 필드의 크기를 나타냅니다.

값 0바이트 이상. 항상 가장 많이 전송됩니다.

- 중요한 바이트부터 먼저.

- 사용된 비트는 바이트 경계 내에서 오른쪽 정렬됩니다. 즉, 사용되지 않은 비트는 최상위 바이트에 있습니다. 사용되지 않은 비트가 없거나 사용되지 않은 비트가 0으로 채워진 경우 값은 부호 없는 양의 정수로 간주됩니다.

- 사용되지 않은 선행 비트가 채워진 경우 해당 숫자는 2의 보수 음의 정수로 간주됩니다. 음의 정수는 항상 최상위 바이트에 사용되지 않은 선행 부호 비트를 하나 이상 갖습니다.

값에 앞에 0개의 유효 비트가 포함된 경우 단축 형식을 사용해서는 안 됩니다. 크기는 올바른 유효 비트 수를 나타내야 합니다\(SHOULD\).\(SHOULD NOT, SHOULD\)

```text
   Implementation Notes:
```

- 음의 정수는 반드시 지원되어야 하는 것은 아니지만, 완전성을 위해 포함됩니다.

- 지원하는 데에는 65,279개 이상의 유효 비트가 필요하지 않습니다. 다른 범위는 이러한 UDP 메시지에 비해 너무 길지만 완전성을 위해 포함되었습니다.

---
### **2.4.  Exchange-Schemes**

```text
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |            Scheme             |             Size              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |             Value ...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

구성표 2바이트. Exchange-Scheme을 나타내는 고유 값입니다. 자세한 내용은 "기본 교환 방식"을 참조하세요.

크기는 0\~65,279 범위의 2바이트입니다. "가변 정밀도 정수"를 참조하세요.

값 0바이트 이상. "가변 정밀도 정수"를 참조하세요.

특정 구성표에 대해 크기가 일정하다고 가정하면 안 됩니다. 다양한 크기를 가진 여러 종류의 동일한 구성표가 모든 구성표 목록에 존재할 수 있습니다.\(MUST NOT, MAY\)

그러나 각 구성표 및 크기 조합 중 하나만 구성표 목록에 표시됩니다.

---
### **2.5.  Attributes**

```text
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Attribute   |    Length     |  Value(s) ...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

속성 1바이트. 속성의 종류를 나타내는 고유한 값입니다. 자세한 내용은 "기본 속성"을 참조하세요.

- 값이 0\(패딩\)이면 길이 필드가 존재하지 않습니다\(항상 0\).

길이 1바이트. 값 필드의 크기\(바이트\)입니다.

- 길이가 0이면 값 필드가 존재하지 않습니다.

값 0바이트 이상. 자세한 내용은 "기본 속성"을 참조하세요.

길이는 특정 항목에 대해 일정하다고 가정하면 안 됩니다.\(MUST NOT\)

기인하다. 길이가 다양한 여러 종류의 동일한 속성이 모든 속성 목록에 존재할 수 있습니다.\(MAY\)

---
## **3.  Cookie Exchange**

```text
   Initiator                            Responder
   =========                            =========
   Cookie_Request                 ->
                                   <-   Cookie_Response
                                           offer schemes
```

---
#### **3.0.1.  Send Cookie_Request**

개시자는 로컬 상태를 초기화하고 고유한 "쿠키"를 생성합니다. 개시자-쿠키는 동일한 당사자 간의 각각의 새로운 Cookie\_Request에서 달라야 합니다. 자세한 내용은 "쿠키 생성"을 참조하세요.\(MUST\)

- 이 당사자가 초기자였던 피어 IP 노드 간의 이전 교환이 만료되지 않은 경우 이 응답자 쿠키는 가장 최근의 응답자 쿠키로 설정되고 이 카운터는 해당 카운터로 설정됩니다.

- 예를 들어 새로운 VPN\(가상 사설망\) 터널이 기존 파트너에 설정되려고 합니다. Counter는 이전 Cookie\_Response에서 수신된 값과 동일하고 Responder-Cookie는 동일하게 유지되며 새로운 Initiator-Cookie가 생성됩니다.

- 새로운 Cookie\_Request가 이 당사자가 응답자인 이전 교환의 메시지에 대한 응답인 경우 이 응답자 쿠키는 이전 개시자 쿠키로 설정되고 이 카운터는 0으로 설정됩니다.

- 예를 들어 SPI\_Needed에 대한 응답으로 이전 Initiator로부터 Bad\_Cookie 메시지를 수신했습니다. Responder-Cookie는 Initiator-Cookie로 대체되고 새로운 Initiator-Cookie가 생성됩니다. 이는 가짜 Bad\_Cookie 메시지를 탐지하기 위한 장부를 제공합니다.

- 또한 양방향 사용자, 전송 및 프로세스 지향 키잉에 사용할 수 있습니다. 이러한 메커니즘은 이 문서의 범위를 벗어납니다.

- 그렇지 않으면 이 Responder-Cookie와 Counter는 모두 0으로 설정됩니다.

- 기본적으로 Initiator는 이전 교환 상태가 모두 만료된 경우와 동일하게 동작합니다. 응답자는 자신의 교환 상태가 만료되지 않은 경우 Resource\_Limit을 보냅니다.

또한 개시자는 재전송 타이머를 시작합니다. 제한 시간 내에 유효한 Cookie\_Response가 도착하지 않으면 남은 재전송 횟수만큼 동일한 Cookie\_Request를 재전송합니다. 개시자-쿠키 값은 동일한 IP 대상 및 UDP 포트로의 각 재전송에서 동일해야 합니다.\(MUST\)

재전송이 초과된 경우 교환 중에 Resource\_Limit 메시지가 수신된 경우 개시자는 업데이트된 값으로 새 Cookie\_Request를 전송하여 Photuris 교환을 다시 시작해야 합니다.\(SHOULD\)

---
#### **3.0.2.  Receive Cookie_Request**

Cookie\_Request를 수신하면 응답자는 다른 Photuris 교환을 시작하기에 충분한 리소스가 있는지 확인합니다.

- 이 특정 피어에 대해 너무 많은 SPI 값이 이미 사용 중이거나 너무 많은 동시 교환이 진행 중이거나 다른 리소스 제한에 도달한 경우 Resource\_Limit 메시지가 전송됩니다.

- 이 특정 피어에 의해 시작된 이전 교환이 Exchange TimeOut을 초과하지 않았고 응답자 쿠키가 이러한 이전 교환 중 하나를 지정하지 않은 경우 Resource\_Limit 메시지가 전송됩니다.

그렇지 않으면 응답자는 Cookie\_Response를 반환합니다.

현재 응답자는 추가 상태를 생성하지 않습니다.

---
#### **3.0.3.  Send Cookie_Response**

개시자의 IP 소스가 검사됩니다. 피어 IP 노드 간의 이전 교환이 만료되지 않은 경우 응답 카운터는 가장 최근 교환 카운터에 1을 더한 값으로 설정됩니다\(비순차적인 재전송 허용\). 그렇지 않으면 응답 카운터는 요청 카운터에 1을 더한 값으로 설정됩니다.

카운터의 롤오버를 통해 새 카운터 값이 0\(모듈로 256\)인 경우 값은 1로 설정됩니다.

이 새로운 카운터 값이 아직 Exchange TimeOut을 초과하지 않은 이 특정 피어에 의해 시작된 일부 이전 교환과 일치하는 경우,

고유한 카운터 값에 도달할 때까지 카운터가 다시 증가합니다.

노타 베네:

- 동일한 두 피어 간의 동시 교환은 254개까지 지원됩니다.

응답자는 고유한 쿠키를 생성합니다. 각 연속 응답의 Responder-Cookie 값은 달라야 합니다. 자세한 내용은 "쿠키 생성"을 참조하세요.\(SHOULD\)

피어 간에 사용 가능한 Exchange-Schemes은 Offered-Schemes에 나열됩니다.

---
#### **3.0.4.  Receive Cookie_Response**

개시자는 개시자-쿠키와 제공되는 구성표를 검증합니다.

- 유효하지 않거나 만료된 초기자 쿠키가 감지되면 메시지가 자동으로 삭제됩니다.

- 가변 길이 Offered-Schemes가 UDP 길이와 일치하지 않거나 모든 Offered-Schemes에 명백히 결함이 있거나 의도한 목적에 비해 불충분한 경우 메시지는 자동으로 삭제됩니다. 구현은 발생을 기록하고 적절하게 운영자에게 알려야 합니다.\(SHOULD\)

- 유효한 메시지가 수신되면 새 Cookie\_Request가 전송될 때까지 이후의 Cookie\_Response와 일치하는 Initiator-Cookies도 자동으로 삭제됩니다.

메시지가 유효하면 Offered-Schemes 목록에서 Exchange-Scheme이 선택됩니다.

이 계획 선택은 전송되는 다음 Photuris 메시지에 영향을 미칠 수 있습니다. 기본적으로 다음 Photuris 메시지는 Value\_Request입니다.

```text
   Implementation Notes:
```

- 개시자-쿠키만 교환을 식별하는 데 사용됩니다. Counter와 Responder-Cookie는 모두 Cookie\_Request와 다릅니다.

- 확장에 대한 다양한 제안은 Scheme-Choice를 활용하여 다른 메시지 순서를 나타냅니다. 이러한 메커니즘은 이 문서의 범위를 벗어납니다.

---
### **3.1.  Cookie_Request**

```text
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                       Initiator-Cookie                        ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                       Responder-Cookie                        ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    Message    |    Counter    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

개시자-쿠키 16바이트. 교환을 식별하는 무작위 값입니다. 값은 0이 아니어야 합니다. 자세한 내용은 "쿠키 생성"을 참조하세요.\(MUST NOT\)

응답자 쿠키 16바이트. 특정 이전 교환을 식별합니다. 이전 Cookie\_Response에서 복사되었습니다.

- 0이면 이전 교환이 지정되지 않습니다.

- 0이 아니고 카운터가 0인 경우 이전 교환의 개시자-쿠키를 포함합니다. 지정된 당사자는 이전 당사자 페어링을 유지하기 위해 이 교환에서 응답자가 되도록 요청됩니다.

- 0이 아니고 카운터도 0이 아닌 경우 이전 교환의 응답자 쿠키를 포함합니다. 지정된 당사자는 이전 당사자 페어링을 유지하기 위해 이 교환에서 응답자가 되도록 요청됩니다.

```text
   Message          0
```

카운터 1바이트. 이전 교환 횟수를 나타냅니다.

- 0인 경우 응답자 쿠키는 이전 교환의 개시자를 나타내거나 이전 교환이 지정되지 않음을 나타냅니다.

- 0이 아닌 경우 Responder-Cookie는 이전 교환에 대한 응답자를 나타냅니다. 이 값은 해당 Cookie\_Response 또는 Resource\_Limit의 Counter로 설정됩니다.

---
### **3.2.  Cookie_Response**

```text
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                       Initiator-Cookie                        ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                       Responder-Cookie                        ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    Message    |    Counter    |  Offered-Schemes ...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

개시자-쿠키 16바이트. Cookie\_Request에서 복사되었습니다.

응답자 쿠키 16바이트. 교환을 식별하는 무작위 값입니다. 값은 0이 아니어야 합니다. 자세한 내용은 "쿠키 생성"을 참조하세요.\(MUST NOT\)

```text
   Message          1
```

카운터 1바이트. 현재 교환된 번호를 나타냅니다. 0보다 커야 합니다.

Offered-Schemes 4바이트 이상입니다. 가장 선호도가 낮은 것부터 순서대로 응답자가 지원하는 하나 이상의 Exchange-Scheme 목록입니다. 자세한 내용은 "기본 교환 구성표"를 참조하십시오.

- 하나의 구성표\(#2\)만 지원되어야 하며 모든 제공 구성표 목록에 있어야 합니다.\(SHOULD\)

- 각 유형의 구성표는 두 개 이상 제공될 수 있지만 각 구성표는 크기로 구별됩니다. 목록의 끝은 UDP 길이로 표시됩니다.

---
### **3.3.  Cookie Generation**

Photuris 당사자가 쿠키를 생성하는 정확한 기술은 구현에 따라 다릅니다. 선택한 방법은 몇 가지 기본 요구 사항을 충족해야 합니다.

1. 쿠키는 특정 당사자에 따라 달라져야 합니다. 이렇게 하면 공격자가 실제 IP 주소와 UDP 포트를 사용하여 쿠키를 얻은 다음 이를 사용하여 무작위로 선택한 IP 주소 또는 포트의 요청으로 피해자를 휩쓸지 못하게 됩니다.\(MUST\)

2. 발행 엔터티가 아닌 다른 사람이 해당 엔터티에서 허용할 쿠키를 생성하는 것이 불가능해야 합니다. 이는 발행 주체가 쿠키 생성 및 후속 확인에 로컬 비밀 정보를 사용한다는 것을 의미합니다. 특정 쿠키에서 이 비밀 정보를 추론하는 것이 불가능해야 합니다.\(MUST NOT\)

3. 쿠키 생성 및 확인 방법은 CPU 리소스를 방해하려는 공격을 신속하게 막아야 합니다.\(MUST\)

권장되는 기술은 암호화 해싱 기능\(예: MD5\)을 사용하는 것입니다.

들어오는 쿠키는 들어오는 데이터그램에 포함된 값과 로컬 비밀 무작위 값에서 로컬로 다시 생성하여 언제든지 확인할 수 있습니다.

---
#### **3.3.1.  Initiator Cookie**

쿠키에 영향을 미치는 개시자 비밀 값은 각각의 새로운 Photuris 교환마다 변경되어야 하며 이후 응답자별로 내부적으로 캐시됩니다. 이는 재생 공격에 대한 향상된 동기화 및 보호 기능을 제공합니다.\(SHOULD\)

대안은 비밀 값 대신 쿠키를 캐시하는 것입니다. 수신되는 쿠키는 재생성 계산 비용 없이 직접 비교할 수 있습니다.

비밀 값, IP 소스 및 대상 주소, UDP 소스 및 대상 포트를 통해 쿠키를 계산하는 것이 좋습니다.

```text
   Implementation Notes:
```

- 권장 사항에는 UDP 소스 포트가 포함되어 있지만 이는 구현에 따라 매우 다릅니다. 예를 들어 값이 상수인 경우에는 포함되지 않을 수 있습니다.

- 그러나 구현 시 동일한 컴퓨터의 상호 의심스러운 사용자가 동일한 쿠키를 생성하지 못하도록 보호하는 것이 중요합니다.

---
#### **3.3.2.  Responder Cookie**

쿠키에 영향을 미치는 응답자 비밀 값은 다양한 개시자에 대해 동일하게 유지될 수 있습니다. 그러나 이 비밀은 쿠키 사용 시간을 제한하기 위해 주기적으로 변경되어야 합니다\(일반적으로 60초마다\).\(MAY, SHOULD\)

응답자 쿠키에는 개시자 쿠키가 포함되어야 합니다. Responder-Cookie에는 Counter\(Cookie\_Response에서 반환됨\)가 포함되어야 합니다. 이는 재생 공격에 대한 향상된 동기화 및 보호 기능을 제공합니다.\(SHOULD, MUST\)

비밀 값, IP 소스 및 대상 주소, 자체 UDP 대상 포트, 카운터, 개시자 쿠키 및 현재 제공되는 구성표를 통해 쿠키를 계산하는 것이 좋습니다.

쿠키는 초기 쿠키 교환 중에 상태 저장을 방지하기 위해 개시자별로 캐시되지 않습니다. Value\_Request\(나중에 설명\)를 수신하면 응답자는 유효성 검사를 위해 쿠키를 다시 생성합니다.

Value\_Response가 전송되면\(나중에 설명됨\) 개시자 및 응답자 쿠키가 모두 캐시되어 교환을 식별합니다.

```text
   Implementation Notes:
```

- 권장 사항에는 UDP 소스 포트가 포함되지 않지만 이는 구현에 따라 매우 다릅니다. 일부 변형에는 성공적으로 포함될 수 있습니다.

- 그러나 적절한 Counter를 결정하기 위해 기존 Photuris 교환과 일치할 때 UDP Source 포트가 포함되지 않는 것이 중요합니다.

- 권장 사항에는 Cookie\_Response와 사이의 스키마 값의 동적 변화를 감지하기 위한 Offered-Schemes가 포함됩니다.

```text
      Value_Response.
```

- Value\_Response와 Identity\_Response 사이에서 미리 계산된 응답자 교환 값의 동적 변화를 감지하려면 일부 메커니즘이 필요할 수 있습니다. 예를 들어 쿠키를 유효하지 않게 렌더링하도록 비밀 값을 변경하거나 Photuris 교환 상태를 만료됨으로 명시적으로 표시합니다.\(MAY\)

---
## **4.  Value Exchange**

```text
   Initiator                            Responder
   =========                            =========
   Value_Request                  ->
      pick scheme
      offer value
      offer attributes
                                   <-   Value_Response
                                           offer value
                                           offer attributes
```

- \[교환된 가치로부터 공유 비밀 생성\]

---
#### **4.0.1.  Send Value_Request**

개시자는 계획 선택에 대한 적절한 교환 가치를 생성합니다. 이 교환 가치는 미리 계산되어 여러 응답자에 사용될 수 있습니다.

응답자의 IP 대상이 검사되고 당사자 간에 사용 가능한 속성이 Offered-Attributes에 나열됩니다.

또한 개시자는 재전송 타이머를 시작합니다. 제한 시간 내에 유효한 Value\_Response가 도착하지 않으면 남은 재전송 횟수에 대해 동일한 Value\_Request가 재전송됩니다.

재전송 횟수가 초과된 경우 교환 중에 Bad\_Cookie 또는 Resource\_Limit 메시지가 수신된 경우 개시자는 새 Cookie\_Request를 전송하여 Photuris 교환을 다시 시작해야 합니다.\(SHOULD\)

---
#### **4.0.2.  Receive Value_Request**

응답자는 응답자 쿠키, 카운터, 계획 선택, 교환 가치 및 제공 속성을 검증합니다.

- 유효하지 않거나 만료된 Responder-Cookie가 감지되면 Bad\_Cookie 메시지가 전송됩니다.

- 이 특정 피어에 대해 너무 많은 SPI 값이 이미 사용 중이거나 너무 많은 동시 교환이 진행 중이거나 다른 리소스 제한에 도달한 경우 Resource\_Limit 메시지가 전송됩니다.

- 유효하지 않은 Scheme-Choice가 감지되거나 Exchange-Value에 명백한 결함이 있거나 가변 길이 Offered-Attributes가 UDP 길이와 일치하지 않는 경우 메시지는 자동으로 삭제됩니다. 구현은 발생을 기록하고 적절하게 운영자에게 알려야 합니다.\(SHOULD\)

메시지가 유효하면 응답자는 Exchange 타이머를 Exchange TimeOut으로 설정하고 Value\_Response를 반환합니다.

응답자는 들어오는 Value\_Request 쿠키 쌍과 해당 Value\_Response의 복사본을 유지합니다. 중복된 Value\_Request가 수신되면 이전 Value\_Response만 재전송하고 추가 조치를 취하지 않습니다.

---
#### **4.0.3.  Send Value_Response**

응답자는 계획 선택에 대한 적절한 교환 가치를 생성합니다. 이 교환 가치는 사전 계산되어 여러 개시자에 사용될 수 있습니다.

개시자의 IP 소스가 검사되고 당사자 간에 사용 가능한 속성이 Offered-Attributes에 나열됩니다.

```text
   Implementation Notes:
```

- 이때 응답자는 공유 비밀 계산을 시작합니다. 지연을 최소화하기 위해 공유 비밀 계산이 병렬로 실행됩니다.

- 상당한 시간이 걸릴 수 있습니다. 구현자는 이 계산으로 인해 재전송이 차단되지 않도록 해야 합니다. 일반적으로 재전송 시간 초과가 계산 시간을 초과하므로 이는 일반적으로 문제가 되지 않습니다.

---
#### **4.0.4.  Receive Value_Response**

개시자는 쿠키 쌍, 교환 가치 및 제공 속성을 검증합니다.

- 유효하지 않거나 만료된 쿠키가 감지되면 메시지가 자동으로 삭제됩니다.

- Exchange-Value에 명백히 결함이 있거나 가변 길이 Offered-Attributes가 UDP 길이와 일치하지 않는 경우 메시지는 자동으로 삭제됩니다. 구현은 발생을 기록하고 적절하게 운영자에게 알려야 합니다.\(SHOULD\)

- 유효한 메시지가 수신되면 새 Cookie\_Request가 전송될 때까지 나중에 일치하는 두 쿠키가 포함된 Value\_Response도 자동으로 삭제됩니다.

메시지가 유효하면 개시자는 공유 비밀의 병렬 계산을 시작합니다.

개시자는 계산을 완료하면 Identity\_Request를 응답자에게 보냅니다.

---
### **4.1.  Value_Request**

```text
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                       Initiator-Cookie                        ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                       Responder-Cookie                        ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    Message    |    Counter    |         Scheme-Choice         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                   Initiator-Exchange-Value                    ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Initiator-Offered-Attributes ...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-
```

개시자-쿠키 16바이트. Cookie\_Response에서 복사되었습니다.

응답자 쿠키 16바이트. Cookie\_Response에서 복사되었습니다.

```text
   Message          2
```

카운터 1바이트. Cookie\_Response에서 복사되었습니다.

구성표 선택 2바이트. Cookie\_Response의 Offered-Schemes 목록에서 개시자가 선택한 값입니다.

- 계획만 지정됩니다. 크기는 개시자-교환-값과 일치하며 값은 암시적입니다.

개시자-교환-가치

- 가변 정밀도 정수. 당사자 간의 공유 비밀을 계산하기 위해 개시자가 제공합니다. 값 형식은 Scheme-Choice로 표시됩니다.

- 필드는 크기 필드에 표시된 대로 길이가 정수 바이트일 수 있습니다. 특별한 정렬이 필요하지 않습니다. 표시된 32비트 정렬은 그림의 편의를 위한 것입니다.

개시자 제공 속성

- 4바이트 이상. 개시자가 지원하는 보안 매개변수 속성의 목록입니다.

- 이 목록의 내용과 사용법은 "제공 속성 목록"에 자세히 설명되어 있습니다. 목록의 끝은 UDP 길이로 표시됩니다.

---
### **4.2.  Value_Response**

```text
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                       Initiator-Cookie                        ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                       Responder-Cookie                        ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    Message    |                    Reserved                   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                   Responder-Exchange-Value                    ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Responder-Offered-Attributes ...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-
```

개시자-쿠키 16바이트. Value\_Request에서 복사되었습니다.

응답자 쿠키 16바이트. Value\_Request에서 복사되었습니다.

```text
   Message          3
```

3바이트를 예약했습니다. 향후 사용을 위해; 전송될 때 0으로 설정되어야 하며, 수신될 때 무시되어야 합니다.\(MUST\)

응답자-교환-가치

- 가변 정밀도 정수. 당사자 간의 공유 비밀을 계산하기 위해 응답자가 제공합니다. Value 형식은 Value\_Request에 지정된 현재 Scheme-Choice로 표시됩니다.

```text
                    The field may be any integral number of bytes in
```

- 크기 필드에 표시된 길이입니다. 특별한 정렬이 필요하지 않습니다. 표시된 32비트 정렬은 그림의 편의를 위한 것입니다.

응답자 제공 속성

- 4바이트 이상. 응답자가 지원하는 보안 매개변수 속성 목록입니다.

- 이 목록의 내용과 사용법은 "제공 속성 목록"에 자세히 설명되어 있습니다. 목록의 끝은 UDP 길이로 표시됩니다.

---
### **4.3.  Offered Attribute List**

이 목록에는 상대방이 사용할 수 있는 당사자가 지원하는 속성이 포함됩니다. 속성 형식은 "기본 속성"에 지정됩니다.

목록은 식별-속성, 인증-속성 및 \(선택 사항\) 캡슐화-속성의 두 개 또는 세 개의 섹션으로 구성됩니다. 각 섹션 내에서 속성은 가장 선호되는 것부터 가장 선호되지 않는 것 순으로 정렬됩니다.

목록의 첫 번째 섹션에는 식별 방법이 포함되어 있습니다. 이 목록에서 Identity-Choice가 선택됩니다.

목록의 두 번째 섹션은 "AH-속성"\(#1\)으로 시작됩니다. 여기에는 인증 방법 및 기타 운영 유형이 포함됩니다.

목록의 세 번째 섹션은 "ESP-Attributes"\(#2\)로 시작됩니다. 여기에는 인증 방법, 압축, 암호화 및 기타 운영 유형이 포함됩니다. 캡슐화 속성이 제공되지 않으면 "ESP-속성" 속성 자체가 목록에서 생략됩니다.

속성 선택은 목록의 뒷부분 두 섹션에서 선택됩니다.

"대칭 식별" 및 "인증" 모두에 대한 "MD5-IPMAC"\(#5\) 속성에 대한 지원이 필요하며 모든 제공 속성 목록에 있어야 합니다.\(SHOULD\)

```text
   Implementation Notes:
```

-  예를 들어,

```text
         "MD5-IPMAC" (Symmetric Identification),
         "AH-Attributes",
         "MD5-IPMAC" (Authentication).
```

- 제안은 잠재 SPI 사용자\(발신자\)에 의해 이루어지기 때문에 선호도 순서는 특정 구현의 기능 및 엔지니어링 장단점을 반영할 가능성이 높습니다.

- 그러나 중요한 처리 병목 현상은 수신기에서 자주 발생합니다. SPI 소유자\(수신자\)는 덜 선호되는 속성을 선택하여 요구 사항을 표현할 수 있습니다.

- 주문은 운영 정책 및 애플리케이션에 대한 요청 서비스에 의해 영향을 받을 수도 있습니다. 그러한 고려 사항은 이 문서의 범위를 벗어납니다.

- 목록은 추가 섹션으로 나눌 수 있습니다. 이러한 섹션은 항상 ESP-속성 섹션을 따르며 인식할 수 없는 속성과 구별할 수 없습니다.

- 선택된 인증, 압축, 암호화 및 식별 메커니즘과 캡슐화 모드\(있는 경우\)는 양방향에서 동일할 필요는 없습니다.

---
## **5.  Identification Exchange**

```text
   Initiator                            Responder
   =========                            =========
   Identity_Request               ->
      make SPI
      pick SPI attribute(s)
      identify self
      authenticate
      make privacy key(s)
      mask/encrypt message
                                   <-   Identity_Response
                                           make SPI
                                           pick SPI attribute(s)
                                           identify self
                                           authenticate
                                           make privacy key(s)
                                           mask/encrypt message
```

- \[각 방향으로 SPI 세션 키 만들기\]

메시지의 형식과 의미는 각 방향에서 동일하지만 메시지 교환은 순서대로 이루어집니다. 메시지는 메시지 및 식별 필드를 검사하여 당사자가 쉽게 구별할 수 있습니다.

```text
   Implementation Notes:
```

- 계산 시간은 공유 비밀 생성 또는 신원 확인에 사용되는 비밀 값의 특정 비트 값에 따라 달라질 수 있습니다. 계산 시간을 기록하여 이러한 비밀 비트의 분석을 방지하려면 가장 긴 계산이 예상되는 시간까지 Identity\_Messages 전송을 지연해야 합니다. 이는 프로세서 속도, 알고리즘, 길이 변수에 따라 달라집니다. 따라서 시간을 추정하는 방법은 구현에 따라 다릅니다.\(SHOULD\)

- 신원 확인이 완료되기 전에 수신된 인증 및/또는 암호화된 사용자 데이터그램은 이 단계가 완료될 때까지 대기열에 배치될 수 있습니다. 확인이 성공하면 확인 후 데이터그램이 도착한 것처럼 대기열이 처리됩니다. 확인에 실패하면 대기열이 삭제됩니다.

---
#### **5.0.1.  Send Identity_Request**

개시자는 적절한 식별, SPI 및 SPI에 대한 속성 세트인 SPILT를 선택하고 검증을 계산하고 현재 Scheme-Choice에 표시된 개인 정보 보호 방법을 사용하여 메시지를 마스킹합니다.

또한 개시자는 재전송 타이머를 시작합니다. 제한 시간 내에 유효한 Identity\_Response가 도착하지 않으면 남은 재전송 횟수 동안 이전 Identity\_Request가 재전송됩니다.

재전송 횟수가 초과된 경우 교환 중에 Bad\_Cookie 메시지가 수신되면 개시자는 새 Cookie\_Request를 전송하여 Photuris 교환을 다시 시작해야 합니다.\(SHOULD\)

---
#### **5.0.2.  Receive Identity_Request**

응답자는 쿠키 쌍, 패딩, 식별, 검증 및 속성 선택을 검증합니다.

- 유효하지 않거나 만료된 쿠키가 감지되면 Bad\_Cookie 메시지가 전송됩니다.

- 마스크 해제 후 잘못된 Padding이 감지되거나 가변 길이 Attribute-Choices가 UDP 길이와 일치하지 않거나 속성이 Offered-Attributes에 없으면 메시지가 자동으로 삭제됩니다.

- 잘못된 Identification이 감지되거나 메시지 확인에 실패한 경우 Verification\_Failure 메시지가 전송됩니다.

- 이러한 문제가 발견될 때마다 보안협회가 설립되지 않습니다. 구현은 발생을 기록하고 적절하게 운영자에게 알려야 합니다.\(SHOULD\)

메시지가 유효하면 응답자는 Exchange 타이머를 Exchange LifeTime으로 설정합니다\(이전 교환에 대해 아직 수행되지 않은 경우\). 공유 비밀의 병렬 계산이 완료되면 응답자는 Identity\_Response를 반환합니다.

응답자는 들어오는 Identity\_Request 값과 해당 Identity\_Response의 복사본을 유지합니다. 중복된 Identity\_Request가 수신되면 이전 Identity\_Response만 다시 보내고 추가 조치는 취하지 않습니다.

---
#### **5.0.3.  Send Identity_Response**

응답자는 적절한 식별, SPI 및 SPI에 대한 속성 세트인 SPILT를 선택하고 검증을 계산하고 현재 Scheme-Choice에 표시된 개인 정보 보호 방법을 사용하여 메시지를 마스킹합니다.

응답자는 양방향으로 SPI 세션 키를 계산합니다.

이때 Responder는 사용자 데이터그램의 인증 및/또는 암호화를 시작합니다.

---
#### **5.0.4.  Receive Identity_Response**

개시자는 쿠키 쌍, 패딩, 식별, 검증 및 속성 선택을 검증합니다.

- 유효하지 않거나 만료된 쿠키가 감지되면 메시지가 자동으로 삭제됩니다.

- 마스크 해제 후 잘못된 Padding이 감지되거나 가변 길이 Attribute-Choices가 UDP 길이와 일치하지 않거나 속성이 Offered-Attributes에 없으면 메시지가 자동으로 삭제됩니다.

- 잘못된 Identification이 감지되거나 메시지 확인에 실패한 경우 Verification\_Failure 메시지가 전송됩니다.

- 이러한 문제가 발견될 때마다 보안협회가 설립되지 않습니다. 구현은 발생을 기록하고 적절하게 운영자에게 알려야 합니다.\(SHOULD\)

- 유효한 메시지가 수신되면 새 Cookie\_Request가 전송될 때까지 두 일치하는 쿠키가 포함된 이후 Identity\_Response도 자동으로 삭제됩니다.

메시지가 유효하면 개시자는 Exchange 타이머를 Exchange 수명 시간으로 설정합니다\(이전 교환에 대해 아직 수행되지 않은 경우\).

개시자는 양방향으로 SPI 세션 키를 계산합니다.

이때 Initiator는 사용자 데이터그램의 인증 및/또는 암호화를 시작합니다.

---
### **5.1.  Identity_Messages**

```text
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                       Initiator-Cookie                        ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                       Responder-Cookie                        ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    Message    |                    LifeTime                   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                   Security-Parameters-Index                   |
   +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
   |        Identity-Choice        |                               |
   + + + + + + + + + + + + + + + + +                               +
   |                                                               |
   ~                        Identification                         ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                         Verification                          ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute-Choices ...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                                                      ... Padding  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

개시자-쿠키 16바이트. Value\_Request에서 복사되었습니다.

응답자 쿠키 16바이트. Value\_Request에서 복사되었습니다.

```text
   Message          4 (Request) or 7 (Response)
```

수명 3바이트. 표시된 SPI가 만료되기까지 남은 시간\(초\)입니다.

- SPI가 0이면 이 필드는 0이 아닌 임의의 값으로 채워져야 합니다.\(MUST\)

SPI\(보안 매개변수 색인\)

-                4 바이트. 수신 통신에 사용되는 SPI입니다.

```text
                    When zero, indicates that no SPI is created in this

                    direction.
```

Identity-Choice 2바이트 이상. 피어가 보낸 Offered-Attributes 목록에서 ID 속성이 선택되고 확인을 계산하는 데 사용됩니다.

- 필드는 길이 필드에 표시된 대로 길이가 정수 바이트일 수 있습니다. 특별한 정렬이 필요하지 않습니다. 표시된 16비트 정렬은 그림의 편의를 위한 것입니다.

식별 가변 정밀도 정수\(Variable Precision Integer\) 또는 Identity-Choice가 나타내는 대체 형식입니다. 자세한 내용은 "기본 속성"을 참조하세요.

- 필드 길이는 정수 바이트일 수 있습니다. 특별한 정렬이 필요하지 않습니다. 표시된 32비트 정렬은 그림의 편의를 위한 것입니다.

검증 가변 정밀도 정수\(Variable Precision Integer\) 또는 Identity-Choice가 나타내는 대체 형식입니다. 값 계산은 "신원 확인"에 설명되어 있습니다.

- 필드 길이는 정수 바이트일 수 있습니다. 특별한 정렬이 필요하지 않습니다. 표시된 32비트 정렬은 그림의 편의를 위한 것입니다.

속성 선택

- 0바이트 이상. SPI가 0이 아닌 경우 피어가 지원하는 제공 속성 목록에서 선택된 속성 목록입니다.

- 이 목록의 내용과 사용법은 "속성 선택 목록"에 자세히 설명되어 있습니다. 목록의 끝은 Padding을 제거한 후 UDP 길이로 표시됩니다\(UDP 길이 - 마지막 Padding 값\).

8\~255바이트 패딩. 이 필드는 메시지 시작 부분부터 측정하여 최소 128바이트 경계까지 채워집니다. 패드 바이트 수는 무작위로 선택됩니다.

```text
                    In addition, when a Privacy-Method indicated by the
```

- 현재 Scheme-Choice에서는 일반 텍스트가 일부 바이트 수\(블록 암호의 블록 크기\)의 배수여야 하며, 이 필드는 필요에 따라 알고리즘에서 요구하는 크기로 조정됩니다.

- 자체 설명 패딩은 값 1로 시작합니다. 각 바이트에는 해당 바이트의 인덱스가 포함됩니다. 따라서 마지막 패드 바이트는 제거할 패드 바이트 수를 나타냅니다. 예를 들어 패딩되지 않은 메시지 길이가 120바이트인 경우 패딩 값은 1, 2, 3, 4, 5, 6, 7, 8이 될 수 있습니다.

SPI 필드 뒤의 메시지 부분은 현재 Scheme-Choice에 표시된 Privacy-Method를 사용하여 마스크됩니다.

SPI 다음의 필드는 불투명합니다. 즉, 값은 마스킹\(및 선택적 암호화\) 이전에 설정되고 마스킹 해제\(및 선택적 암호 해독\) 후에만 검사됩니다.

---
### **5.2.  Attribute Choices List**

이 목록은 SPI의 속성을 지정합니다. 속성 형식은 "기본 속성"에 지정됩니다.

목록은 인증 속성 및/또는 캡슐화 속성이라는 하나 또는 두 개의 섹션으로 구성됩니다.

SPI 사용자에서 SPI 소유자로 전송할 때 속성은 나열된 순서대로 처리됩니다. 예를 들어,

```text
      "ESP-Attributes",
      "Deflate" (Compression),
      "XOR" (Encryption),
      "DES-CBC" (Encryption),
      "XOR" (Encryption),
      "AH-Attributes",
      "AH-Sequence",
      "MD5-IPMAC" (Authentication),
```

압축 및 삼중 암호화\(내부\)를 사용하는 ESP가 생성되고 ESP 페이로드의 시퀀스 번호\(외부\)가 사용되는 AH 인증이 발생합니다.

SPI 소유자는 자연스럽게 데이터그램을 역순으로 처리합니다.

이 순서는 키 생성 순서에도 영향을 미칩니다. SPI 모두

소유자 및 SPI 사용자는 나열된 순서대로 키를 생성합니다.

```text
   Implementation Notes:
```

- 제공 속성 목록에서 선택하는 경우 보안 협회가 모든 종류의 제공 속성을 단일 SPI에 포함하거나 모든 제공 속성에 대해 별도의 SPI를 생성할 필요는 없습니다.

- 어떤 종류의 속성은 단일 SPI에 두 번 이상 포함될 수 있습니다. 허용되는 속성 조합 세트는 구현 및 운영 정책에 따라 다릅니다. 그러한 고려 사항은 이 문서의 범위를 벗어납니다.

- 목록은 추가 섹션으로 나눌 수 있습니다. 이는 양 당사자가 영향을 받는 속성을 인식하는 경우에만 발생할 수 있습니다.

- 선택된 인증, 압축, 암호화 및 식별 메커니즘과 캡슐화 모드\(있는 경우\)는 양방향에서 동일할 필요는 없습니다.

---
### **5.3.  Shared-Secret**

공유 비밀은 다양한 계산에 사용됩니다. 공유 비밀의 내부 표현에 관계없이 계산에 사용될 때 이는 가변 정밀도 정수의 값 부분과 동일한 형식입니다.

- 가장 중요한 바이트가 먼저 옵니다. - 사용된 비트는 바이트 경계 내에서 오른쪽 정렬됩니다. - 사용되지 않은 비트는 최상위 바이트에 있습니다. - 사용되지 않은 비트는 0으로 채워집니다.

공유 비밀에는 크기 필드가 포함되지 않습니다.

---
### **5.4.  Identity Verification**

이러한 메시지는 Identity-Choice를 사용하여 인증됩니다. 확인 값은 마스킹\(및 선택적 암호화\) 이전에 계산되고 마스킹 해제\(및 선택적 암호 해독\) 후에 확인됩니다.

Identity-Choice 인증 기능에는 두 가지 입력 값이 제공됩니다.

- 송신자\(SPI 소유자\) 검증 키 - 검증될 데이터\(연결된 바이트 시퀀스\)

결과 출력 값은 확인 필드에 저장됩니다.

Identity-Choice 확인 데이터는 다음과 같은 연결된 값으로 구성됩니다.

+ 개시자 쿠키, + 응답자 쿠키, + 메시지, 수명 및 SPI 필드, + 신원 선택 및 식별, + SPI 사용자 신원 확인\(응답 전용\), + 확인 필드 뒤의 속성 선택, + 패딩, + SPI 소유자 TBV, + SPI 소유자 교환 값, + SPI 소유자 제공 속성, + SPI 사용자 TBV, + SPI 사용자 교환 값, + SPI 사용자 제공 속성, + 응답자 제공 -계획.

TBV\(3바이트 값\)는 Value\_Request의 Counter 및 Scheme-Choice 필드 또는 관련 Exchange-Value 바로 앞에 있는 Value\_Response의 Reserved 필드로 구성됩니다.

Exchange-Value 및 Offered-Attributes 필드의 순서는 각 방향에서 다르며 Identification 및 SPI 필드도 각 방향에서 다를 수 있습니다. 또한 SPI 사용자 신원 확인\(Identity\_Request의\)은 Identity\_Response에만 존재합니다.

확인에 실패하면 SPI를 추가하지 않고 사용자에게 알림이 전송되고 Verification\_Failure 메시지가 전송됩니다. 성공하면 사용자 데이터그램의 인증 및/또는 암호화로 일반 작업이 시작됩니다.

```text
   Implementation Notes:
```

- 이는 SPI에 지정된 인증 방법과 다릅니다.

- 검증 계산에 포함된 식별 및 검증 키의 정확한 세부 사항은 "기본 속성"에 설명된 대로 ID 선택에 따라 달라집니다.

- 각 당사자는 PGP\(Pretty Good Privacy\) 신뢰 웹과 같은 자신만의 신뢰할 수 있는 데이터베이스를 유지하고 거기에서 발견된 신원만 허용하기를 원할 수 있습니다. 내부 또는 외부 데이터베이스에서 ID를 찾지 못하면 동일한 결과가 발생합니다.

- 검증 계산 실패로 인한 Verification\_Failure 메시지.

- 교환 가치 데이터에는 크기 및 가치 필드가 모두 포함됩니다. Offered-Attributes 및 Attribute-Choices 데이터에는 속성, 길이 및 값 필드가 포함됩니다.

---
### **5.5.  Privacy-Key Computation**

식별 교환 메시지는 현재 계획 선택에 표시된 개인 정보 보호 방법을 사용하여 마스크됩니다. 마스킹은 SPI 다음 필드부터 시작하여 Padding을 포함하여 UDP 길이가 나타내는 데이터 끝까지 계속됩니다.

Scheme-Choice에 지정된 Key-Generation-Function은 각 메시지에 대한 특수 개인 키를 생성하는 데 사용됩니다. 이 함수는 다음 연결된 값에 대해 계산됩니다.

+ SPI 소유자 교환 값, + SPI 사용자 교환 값, + 개시자 쿠키, + 응답자 쿠키, + 메시지, 수명 및 SPI\(또는 예약\) 필드, + 계산된 공유 비밀.

Exchange-Value 필드의 순서가 각 방향에서 다르고 Message, LifeTime 및 SPI 필드도 각 방향에서 다르기 때문에 결과 개인 키는 일반적으로 각 방향에서 다릅니다.

지정된 키 생성 기능의 한 번의 반복에서 사용할 수 있는 것보다 더 많은 수의 키 비트가 필요한 경우 후행 공유 비밀을 복제하고 함수를 다시 계산하여 더 많은 키 비트가 생성됩니다. 즉, 첫 번째 반복에는 공유 비밀의 후행 복사본이 하나 있고, 두 번째 반복에는 공유 비밀의 후행 복사본이 두 개 있는 식입니다.

```text
   Implementation Notes:
```

- 이는 SPI에 지정된 암호화 방법과 다릅니다.

- Padding의 길이 및 기타 세부 사항은 Privacy-Method에 따라 다릅니다. 자세한 내용은 "기본 개인 정보 보호 방법" 목록을 참조하세요.

- 초기 검증 후 Exchange-Values를 메모리에 유지하지 않으려면 각각에 대해 연결된 데이터 값의 초기 바이트에 대해 함수를 미리 계산하는 것이 종종 가능합니다.

- 방향을 지정하고 공유 비밀의 후행 복사본을 추가합니다.

- 교환 가치 데이터에는 크기 및 가치 필드가 모두 포함됩니다.

---
### **5.6.  Session-Key Computation**

각 SPI에는 하나 이상의 세션 키가 있습니다. 이러한 키는 SPI의 속성을 기반으로 생성됩니다. 자세한 내용은 "기본 속성"을 참조하세요.

Scheme-Choice에 지정된 Key-Generation-Function은 해당 특정 속성에 대한 SPI 세션 키를 생성하는 데 사용됩니다. 이 함수는 다음 연결된 값에 대해 계산됩니다.

+ 개시자 쿠키, + 응답자 쿠키, + SPI 소유자 생성 키, + SPI 사용자 생성 키, + 메시지 확인 필드, + 계산된 공유 비밀.

생성 키의 순서는 각 방향에서 다르고 확인 필드도 각 방향에서 다를 가능성이 높으므로 결과 세션 키는 일반적으로 각 방향에서 다릅니다.

지정된 키 생성 기능의 한 번의 반복에서 사용할 수 있는 것보다 더 많은 수의 키 비트가 필요한 경우 후행 공유 비밀을 복제하고 함수를 다시 계산하여 더 많은 키 비트가 생성됩니다. 즉, 첫 번째 반복에는 공유 비밀의 후행 복사본이 하나 있고, 두 번째 반복에는 공유 비밀의 후행 복사본이 두 개 있는 식입니다.

```text
   Implementation Notes:
```

- 이는 Photuris 교환을 위해 생성된 개인정보 키와 다릅니다. 다른 초기화 데이터가 사용되며 반복은 별도로 유지됩니다.

- 세션 키 계산에 포함되는 확인 필드 및 생성 키의 정확한 세부 사항은 "기본 속성"에 설명된 대로 ID 선택에 따라 달라집니다.

- 초기 검증 후 생성 키를 메모리에 유지하지 않으려면 각 방향에 대해 연결된 데이터 값의 초기 바이트에 대해 함수를 미리 계산하고 공유 비밀의 후행 복사본을 추가하는 것이 가능한 경우가 많습니다.

- 동일한 SPI에 인증 및 암호화 속성이 모두 사용되는 경우 동일한 SPI와 연결된 여러 세션 키가 있을 수 있습니다. 이러한 세션 키는 속성 선택 목록의 순서대로 생성됩니다.

---
## **6.  SPI Messages**

```text
   SPI User                             SPI Owner
   ========                             =========
   SPI_Needed                     ->
      list SPI attribute(s)
      make validity key
      authenticate
      make privacy key(s)
      mask/encrypt message
                                   <-   SPI_Update
                                           make SPI
                                           pick SPI attribute(s)
                                           make SPI session-key(s)
                                           make validity key
                                           authenticate
                                           make privacy key(s)
                                           mask/encrypt message
```

메시지 교환은 개시자 및 응답자와 관련이 없습니다. 대신 어느 쪽이든 언제든지 이러한 메시지 중 하나를 보낼 수 있습니다. 메시지는 당사자별로 쉽게 구별됩니다.

---
#### **6.0.1.  Send SPI_Needed**

식별 교환이 완료된 후 언제든지 어느 쪽이든 SPI\_Needed를 보낼 수 있습니다. 이 메시지는 잠재 SPI 사용자가 데이터그램에 대한 특정 속성\(예: 기밀성\)이 필요하고 현재 SPI에 해당 속성이 없을 때 전송됩니다.

잠재 SPI 사용자는 양 당사자가 이전에 제공한 속성의 교차점에서 선택하고 검증을 계산하며 현재 계획 선택에 표시된 개인 정보 보호 방법을 사용하여 메시지를 마스킹합니다.

---
#### **6.0.2.  Receive SPI_Needed**

잠재적인 SPI 소유자는 쿠키 쌍, 패딩, 검증 및 필요한 속성을 검증합니다.

- 유효하지 않거나 만료된 쿠키가 감지되면 Bad\_Cookie 메시지가 전송됩니다.

- 이 특정 피어에 이미 너무 많은 SPI 값이 사용 중이거나 다른 리소스 제한에 도달한 경우 Resource\_Limit 메시지가 전송됩니다.

- 마스크 해제 후 유효하지 않은 패딩이 감지되거나 가변 길이 Attributes-Needed가 UDP 길이와 일치하지 않거나 속성이 Offered-Attributes에 없으면 메시지가 자동으로 삭제됩니다.

- 메시지 확인에 실패하면 Verification\_Failure 메시지가 전송됩니다.

- 이러한 문제가 감지될 때마다 SPI가 설정되지 않습니다. 구현은 발생을 기록하고 적절하게 운영자에게 알려야 합니다.\(SHOULD\)

메시지가 유효하면 당사자는 필요한 속성과 함께 SPI\_Update를 보내야 합니다.\(SHOULD\)

기존 SPI에 해당 속성이 있는 경우 해당 SPI는 나머지 SPILT와 함께 SPI\_Update에 반환됩니다.

---
#### **6.0.3.  Send SPI_Update**

식별 교환이 완료된 후 언제든지 어느 쪽이든 SPI\_Update를 보낼 수 있습니다. 이 메시지는 SPI 소유자에서 SPI 사용자로 한 방향으로만 영향을 미칩니다.

SPI 소유자는 SPI와 SPI 속성 세트인 SPILT를 선택하고 검증을 계산한 후 현재 Scheme-Choice에 표시된 Privacy-Method를 사용하여 메시지를 마스킹합니다.

---
#### **6.0.4.  Receive SPI_Update**

잠재 SPI 사용자는 쿠키 쌍, 패딩, 확인 및 필요한 속성을 검증합니다.

- 유효하지 않거나 만료된 쿠키가 감지되면 Bad\_Cookie 메시지

-  보냈다.

- 마스크 해제 후 잘못된 패딩이 감지되거나 가변 길이 속성 선택이 UDP 길이와 일치하지 않거나 속성이 Offered 속성에 없거나 메시지가 기존 SPI를 수정하는 경우 메시지가 자동으로 삭제됩니다.

- 메시지 확인에 실패하면 Verification\_Failure 메시지가 전송됩니다.

- 이러한 문제가 감지될 때마다 SPI가 설정되지 않습니다. 구현은 발생을 기록하고 적절하게 운영자에게 알려야 합니다.\(SHOULD\)

메시지가 유효하면 나중에 설명하는 것처럼 추가 작업은 LifeTime 필드의 값에 따라 달라집니다.

---
#### **6.0.5.  Automated SPI_Updates**

각 SPI는 여러 가지 상황에서 교체가 필요합니다.

```text
   -  the volume of data processed (inhibiting probability
      cryptanalysis),
```

- 사용 가능한 재생 방지 시퀀스 번호가 고갈되었습니다.

- 그리고 LifeTime의 만료.

일반적으로 데이터그램을 수신하면 결정이 내려집니다. 변환 특정 처리에서 새로 고침이 필요하다고 판단되면 자동화된 SPI\_Update가 트리거됩니다.

또한 자동화된 SPI\_Update를 통해 지연이 높은 환경에서 고대역폭 애플리케이션에 대한 신속한 SPI 새로 고침이 가능합니다. 업데이트 메시지는 기본 트래픽과 반대 방향으로 흐르므로 대역폭을 보존하고 서비스 중단을 방지합니다.

각 SPI를 생성할 때 구현은 선택적으로 UTO\(업데이트 시간 초과\)를 설정할 수 있습니다. 기본적으로 LifeTime\(SPILT/2\) 값의 절반으로 설정됩니다. 이 시간은 매우 동적이고 조정 가능하여 특정 처리를 변환하기 훨씬 전에 자동화된 SPI\_Update를 제공합니다. 제한 시간 내에 새로운 Photuris 교환이 발생하지 않고 현재 교환 상태가 만료되지 않은 경우 자동화된 SPI\_Update가 전송됩니다.\(MAY\)

---
### **6.1.  SPI_Needed**

```text
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                       Initiator-Cookie                        ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                       Responder-Cookie                        ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    Message    |                  Reserved-LT                  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                         Reserved-SPI                          |
   +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
   |                                                               |
   ~                         Verification                          ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attributes-Needed ...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                                                      ... Padding  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

개시자-쿠키 16바이트. Value\_Request에서 복사되었습니다.

응답자 쿠키 16바이트. Value\_Request에서 복사되었습니다.

```text
   Message          8
```

예약됨-LT 3바이트. 향후 사용을 위해; 전송 시 0이 아닌 임의의 값으로 채워야 하며, 수신 시 무시되어야 합니다.\(MUST\)

예약됨-SPI 4바이트. 향후 사용을 위해; 전송될 때 0으로 설정되어야 하며, 수신될 때 무시되어야 합니다.\(MUST\)

검증 가변 정밀도 정수 또는 기타 형식

- 현재 Scheme-Choice로 표시됩니다. 값 계산은 "유효성 확인"에 설명되어 있습니다.

- 필드 길이는 정수 바이트일 수 있습니다. 특별한 정렬이 필요하지 않습니다. 표시된 32비트 정렬은 그림의 편의를 위한 것입니다.

속성-필요

- 4바이트 이상. 피어가 지원하는 Offered-Attributes 목록에서 선택한 두 개 이상의 속성 목록입니다.

이 목록의 내용과 사용법은 다음과 같습니다.

- 이전에 "속성 선택 목록"에 설명되어 있습니다. 목록의 끝은 Padding을 제거한 후 UDP 길이로 표시됩니다\(UDP 길이 - 마지막 Padding 값\).

8바이트 이상을 패딩합니다. 메시지는 식별 교환 메시지에 대해 지정된 것과 동일한 방식으로 채워집니다.

SPI 필드 뒤의 메시지 부분은 현재 Scheme-Choice에 표시된 Privacy-Method를 사용하여 마스크됩니다.

SPI 다음의 필드는 불투명합니다. 즉, 값은 마스킹\(및 선택적 암호화\) 이전에 설정되고 마스킹 해제\(및 선택적 암호 해독\) 후에만 검사됩니다.

---
### **6.2.  SPI_Update**

```text
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                       Initiator-Cookie                        ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                       Responder-Cookie                        ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    Message    |                    LifeTime                   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                   Security-Parameters-Index                   |
   +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
   |                                                               |
   ~                         Verification                          ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute-Choices ...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                                                      ... Padding  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

개시자-쿠키 16바이트. Value\_Request에서 복사되었습니다.

응답자 쿠키 16바이트. Value\_Request에서 복사되었습니다.

```text
   Message          9
```

수명 3바이트. 표시된 SPI가 만료되기까지 남은 시간\(초\)입니다. 0 값은 표시된 SPI가 삭제되었음을 나타냅니다.

SPI\(보안 매개변수 색인\)

-                4 바이트. 수신 통신에 사용되는 SPI입니다.

- 새로운 SPI 값\(생성용\)일 수도 있고, 기존 SPI 값\(삭제용\)일 수도 있습니다. 값 0은 특수 처리를 나타냅니다.

검증 가변 정밀도 정수 또는 기타 형식

- 현재 Scheme-Choice로 표시됩니다. 값 계산은 "유효성 확인"에 설명되어 있습니다.

- 필드 길이는 정수 바이트일 수 있습니다. 특별한 정렬이 필요하지 않습니다. 표시된 32비트 정렬은 그림의 편의를 위한 것입니다.

속성 선택

- 0바이트 이상. SPI 및 SPILLED가 0이 아닌 경우 피어가 지원하는 Offered-Attributes 목록에서 선택된 속성 목록입니다.

이 목록의 내용과 사용법은 다음과 같습니다.

- 이전에 "속성 선택 목록"에 설명되어 있습니다. 목록의 끝은 Padding을 제거한 후 UDP 길이로 표시됩니다\(UDP 길이 - 마지막 Padding 값\).

8바이트 이상을 패딩합니다. 메시지는 식별 교환 메시지에 대해 지정된 것과 동일한 방식으로 채워집니다.

SPI 필드 뒤의 메시지 부분은 현재 Scheme-Choice에 표시된 Privacy-Method를 사용하여 마스크됩니다.

SPI 다음의 필드는 불투명합니다. 즉, 값은 마스킹\(및 선택적 암호화\) 이전에 설정되고 마스킹 해제\(및 선택적 암호 해독\) 후에만 검사됩니다.

---
#### **6.2.1.  Creation**

LifeTime이 0이 아니고 SPI도 0이 아닌 경우 SPI\_Update를 사용하여 새 SPI를 생성할 수 있습니다. SPI가 0이면 SPI\_Update가 자동으로 삭제됩니다.

새 세션 키는 Identity\_Messages와 동일한 방식으로 계산됩니다. 공유 비밀의 교환 수명 동안 SPI 값은 항상 이전 SPI와 다르기 때문에 결과 세션 키는 동일한 방향에서 사용되는 다른 모든 SPI와 반드시 달라야 합니다.

재전송 타이머가 필요하지 않습니다. 성공은 새로운 SPI의 피어 사용으로 표시됩니다.

모든 생성 시도가 실패하면 결국 피어는 모든 기존 SPI가 만료되었음을 확인하고 새 Cookie\_Request를 전송하여 Photuris 교환을 다시 시작합니다. 적절한 경우 이 Cookie\_Request에는 이전 당사자 쌍을 유지하기 위한 응답자-쿠키가 포함될 수 있습니다.\(MAY\)

---
#### **6.2.2.  Deletion**

LifeTime이 0이면 SPI\_Update를 사용하여 기존 SPI 하나를 삭제할 수 있습니다. SPI도 0이면 SPI\_Update는 이 보안 연결과 관련된 기존 SPI를 모두 삭제하고 Photuris 교환 상태를 만료됨으로 표시합니다. 이는 이를 필요로 하는 애플리케이션이 종료될 때 특히 유용합니다.

재전송 타이머가 필요하지 않습니다. 이 메시지는 ICMP 보안 실패 메시지 수를 줄이기 위한 권고 사항입니다.

삭제 시도가 실패하면 피어는 일반적인 ICMP 보안 실패 메시지를 통해 삭제된 SPI가 유효하지 않다는 사실을 알게 되고 새 Cookie\_Request를 전송하여 Photuris 교환을 시작합니다.

---
#### **6.2.3.  Modification**

SPI\_Update는 기존 SPI 수명 연장, 만료된 SPI 부활, 속성 선택 추가/제거 등 기존 SPI를 수정하는 데 사용할 수 없습니다.

수신 시 유효한 메시지는 자동으로 삭제됩니다.

---
### **6.3.  Validity Verification**

이러한 메시지는 현재 구성표 선택에 표시된 유효성 방법을 사용하여 인증됩니다. 확인 값은 마스킹\(및 선택적 암호화\) 이전에 계산되고 마스킹 해제\(및 선택적 암호 해독\) 후에 확인됩니다.

유효성-방법 인증 기능에는 두 가지 입력 값이 제공됩니다.

- 송신자\(SPI 소유자\) 검증 키 - 검증될 데이터\(연결된 바이트 시퀀스\)

결과 출력 값은 확인 필드에 저장됩니다.

유효성-방법 검증 데이터는 다음과 같은 연결된 값으로 구성됩니다.

+ 개시자 쿠키, + 응답자 쿠키, + 메시지, 수명 및 SPI\(또는 예약됨\) 필드, + SPI 소유자 신원 확인, + SPI 사용자 신원 확인, + 확인 필드 다음의 속성 선택, + 패딩 .

Identity Verification 필드\(Identity\_Messages의\) 순서는 각 방향에서 다르며, Message, LifeTime 및 SPI 필드도 각 방향에서 다를 수 있습니다.

확인에 실패하면 SPI를 추가하거나 삭제하지 않고 사용자에게 알림이 전송되고 Verification\_Failure 메시지가 전송됩니다. 성공하면 사용자 데이터그램의 인증 및/또는 암호화로 일반 작업이 시작됩니다.

```text
   Implementation Notes:
```

- 이는 SPI에 지정된 인증 방법과 다릅니다.

- 신원 확인 데이터에는 크기 및 값 필드가 모두 포함됩니다. 속성 선택 데이터에는 속성, 길이 및 값 필드가 포함됩니다.

---
## **7.  Error Messages**

이 메시지는 Photuris 상태 손실 또는 기타 문제에 대한 응답으로 발행됩니다. 메시지는 한 방향으로만 영향을 미칩니다. 재전송 타이머가 필요하지 않습니다.

이러한 메시지는 마스크되지 않습니다.

수신자는 쿠키의 유효성을 확인합니다. 오류 메시지의 쿠키 쌍이 실제로 현재 사용 중인 쌍과 일치하고 프로토콜이 현재 그러한 오류 메시지가 예상되는 상태에 있는지 특별한 주의를 기울여야 합니다. 그렇지 않으면 이러한 메시지가 서비스 거부 공격의 기회를 제공할 수 있습니다. 잘못된 메시지는 자동으로 삭제됩니다.\(MUST\)

---
### **7.1.  Bad_Cookie**

33바이트 메시지 형식에 대해서는 "헤더 형식"을 참조하세요. 추가 필드가 없습니다.

개시자-쿠키 16바이트. 불쾌한 메시지에서 복사되었습니다.

응답자 쿠키 16바이트. 불쾌한 메시지에서 복사되었습니다.

```text
   Message          10
```

이 오류 메시지는 Value\_Request, Identity\_Request, SPI\_Needed 또는 SPI\_Update가 수신되고 수신자별 쿠키가 유효하지 않거나 관련 교환 상태가 만료된 경우 전송됩니다.

Photuris 교환 중에 이 오류 메시지가 수신되면 프로토콜 단계의 작동에 즉각적인 영향을 미치지 않습니다. 나중에 재전송 횟수가 초과되어 이 오류 메시지가 수신되면 개시자는 적절하게 업데이트된 응답자 쿠키 및 카운터와 함께 새 Cookie\_Request를 전송하여 Photuris 교환을 다시 시작해야 합니다.\(SHOULD\)

SPI\_Needed에 대한 응답으로 이 오류 메시지가 수신되면 교환 상태가 만료된 것으로 표시되어서는 안 되지만 당사자는 새로운 Cookie\_Request를 전송하여 Photuris 교환을 시작해야 합니다.\(SHOULD NOT\)

SPI\_Update에 대한 응답으로 이 오류 메시지가 수신되면 교환 상태가 만료된 것으로 표시되어서는 안 되며 추가 조치가 취해지지 않습니다. 나중에 피어가 인증 및/또는 암호화된 데이터를 전송해야 할 때 새로운 교환이 시작됩니다.\(SHOULD NOT\)

기존 SPI는 삭제되지 않습니다. 정상적으로 만료되며 나중에 제거됩니다.

---
### **7.2.  Resource_Limit**

34바이트 메시지 형식은 "Cookie\_Request"를 참조하세요. 추가 필드가 없습니다.

개시자-쿠키 16바이트. 불쾌한 메시지에서 복사되었습니다.

응답자 쿠키 16바이트. 불쾌한 메시지에서 복사되었습니다.

```text
                    Special processing is applied to a Cookie_Request.
                    When the offending message Responder-Cookie and
                    Counter were both zero, and an existing exchange has
                    not yet been purged, this field is replaced with the
```

- 기존 거래소의 응답자 쿠키.

```text
   Message          11
```

카운터 1바이트. 불쾌한 메시지에서 복사되었습니다.

- 0인 경우 응답자 쿠키는 이전 교환의 개시자를 나타내거나 이전 교환이 지정되지 않음을 나타냅니다.

- 0이 아닌 경우 Responder-Cookie는 이전 교환에 대한 응답자를 나타냅니다. 이 값은 해당 Cookie\_Response의 Counter로 설정됩니다.

이 오류 메시지는 Cookie\_Request, Value\_Request 또는 SPI\_Needed가 수신되고 해당 피어에 이미 너무 많은 SPI 값이 사용 중이거나 다른 Photuris 리소스를 사용할 수 없을 때 전송됩니다.

Photuris 교환 중에 Cookie\_Request 또는 Value\_Request에 대한 응답으로 이 오류 메시지가 수신되면 구현에서는 다른 Cookie\_Request 또는 Value\_Request를 보내기 위해 재전송 제한 시간을 \(평소와 같이\) 두 배로 늘려야 합니다. 그렇지 않으면 프로토콜 단계의 작동에 즉각적인 영향을 미치지 않습니다. 나중에 재전송 횟수가 초과되어 이 오류 메시지가 수신되면 개시자는 적절하게 업데이트된 응답자 쿠키 및 카운터와 함께 새 Cookie\_Request를 전송하여 Photuris 교환을 다시 시작해야 합니다.\(SHOULD, SHOULD\)

SPI\_Needed에 대한 응답으로 이 오류 메시지가 수신되면 구현은 이 교환과 관련된 기존 SPI 중 하나가 삭제되거나 만료될 때까지 다른 SPI\_Needed를 전송해서는 안 됩니다.\(SHOULD NOT\)

---
### **7.3.  Verification_Failure**

33바이트 메시지 형식에 대해서는 "헤더 형식"을 참조하세요. 추가 필드가 없습니다.

개시자-쿠키 16바이트. 불쾌한 메시지에서 복사되었습니다.

응답자 쿠키 16바이트. 불쾌한 메시지에서 복사되었습니다.

```text
   Message          12
```

이 오류 메시지는 Identity\_Message, SPI\_Needed 또는 SPI\_Update가 수신되고 확인이 실패할 때 전송됩니다.

이 오류 메시지가 수신되면 구현은 발생을 기록하고 적절하게 운영자에게 알려야 합니다. 그러나 수신은 프로토콜 작동에 영향을 미치지 않습니다.\(SHOULD\)

---
### **7.4.  Message_Reject**

```text
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                       Initiator-Cookie                        ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                       Responder-Cookie                        ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    Message    |  Bad-Message  |             Offset            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

개시자-쿠키 16바이트. 불쾌한 메시지에서 복사되었습니다.

응답자 쿠키 16바이트. 불쾌한 메시지에서 복사되었습니다.

```text
   Message          13
```

잘못된 메시지 1바이트. 문제가 있는 메시지의 메시지 번호를 나타냅니다.

오프셋 2바이트. 인식할 수 없는 필드가 시작되는 문제 메시지 시작 부분의 바이트 수입니다. 최소값은 32입니다.

이 오류 메시지는 지원되지 않는 선택적 메시지 유형이 수신되거나 지원되는 메시지의 선택적 형식이 인식되지 않을 때 전송됩니다.

이 오류 메시지가 수신되면 구현은 발생을 기록하고 적절하게 운영자에게 알려야 합니다. 그러나 수신은 프로토콜 작동에 영향을 미치지 않습니다.\(SHOULD\)

---
## **8.  Public Value Exchanges**

Photuris는 원칙적으로 공개 키 암호화, 특히 Diffie-Hellman 키 교환을 기반으로 합니다. 개인 비밀 값을 기반으로 한 공개 D-H 교환 값 교환은 당사자 간의 상호 공유 비밀을 초래합니다. 이 공유 비밀은 그 자체로 사용되거나 후속 트래픽의 인증 및 암호화를 위한 일련의 세션 키를 생성하는 데 사용될 수 있습니다.

이 문서에서는 Diffie-Hellman 공개 키 알고리즘에 익숙하다고 가정합니다. 좋은 설명은 \[Schneier95\]에서 찾을 수 있습니다.

---
### **8.1.  Modular Exponentiation Groups**

원래 Diffie-Hellman 기술\[DH76\]은 모듈러 지수화를 지정했습니다. 공개 값은 생성기\(g\)를 사용하여 생성되며 개인 비밀 지수\(x\), 모듈로 a 소수\(p\)로 증가됩니다.

```text
      (g**x) mod p.
```

이러한 공개 값이 당사자 간에 교환되면 당사자는 서로 간의 공유 비밀 값을 계산할 수 있습니다.

```text
      (g**xy) mod p.
```

생성기\(g\)와 모듈러스\(p\)는 계획 선택에 의해 설정됩니다\(자세한 내용은 "기본 교환 계획" 참조\). 이는 Cookie\_Response에서 제공되며 Value\_Request에서 한 쌍이 선택됩니다.

비공개 지수\(x\)와 \(y\)는 당사자들에 의해 비밀로 유지됩니다. \(x\) 또는 \(y\)를 사용한 모듈러 지수화의 공개 값 결과만 개시자 및 응답자 교환 값으로 전송됩니다.

이러한 공개 값은 단일 가변 정밀도 정수로 표시됩니다. 이러한 교환 값의 크기는 모듈러스\(p\)의 크기와 일치합니다.

---
### **8.2.  Moduli Selection**

각 구현은 OfferedSchemes에서 하나 이상의 모듈을 제안합니다. 모든 구현은 최대 1024비트 모듈을 지원해야 합니다\(MUST\).\(MUST\)

특정 Photuris 노드의 경우 이러한 모듈러스는 상당한 시간 동안 변경될 필요가 없습니다. 아마도 며칠 또는 몇 주일 것입니다. 백그라운드 프로세스는 주기적으로 새로운 모듈을 생성할 수 있습니다.

512비트 모듈러스의 경우 현재 추정치는 64를 제공합니다.

- \(비관적\) 암호화 강도의 비트에 해당합니다.

- 1024비트 모듈러스의 경우 현재 예상되는 암호화 강도는 80\(비관적\)에서 98\(낙관적\) 비트에 해당합니다.

이러한 추정치는 원하는 보안 매개변수 속성에 적합한 모듈을 선택할 때 사용됩니다.

---
#### **8.2.1.  Bootstrap Moduli**

각 구현은 백그라운드에서 다른 모듈러스를 생성할 수 있을 때까지 부트스트랩 중에 고정 모듈러스를 사용할 가능성이 높습니다. 부트스트랩 계수는 널리 분산되고 기계가 다시 초기화될 때마다 재사용되므로 가장 장기적인 보호를 제공하려면 "안전한" 소수\(p = 2q+1\)여야 합니다.\(SHOULD\)

구현자는 자체 부트스트랩 모듈을 생성하고 연속적인 구현 릴리스에서 부트스트랩 모듈을 변경하는 것이 좋습니다.

---
#### **8.2.2.  Learning Moduli**

Photuris 교환이 시작되면 Responder Offered-Schemes에서 새로운 모듈이 학습됩니다. 개시자는 자체 사용을 위해 이러한 모듈을 캐시할 수 있습니다.\(MAY\)

학습된 모듈러스를 제공하기 전에 구현에서는 가능한 소수성 검증을 최소한 한 번 반복해야 합니다. 이러한 방식으로 모듈이 전달됨에 따라 많은 프로세서가 병렬로 검증을 수행합니다.\(MUST\)

소수성 검증 실패가 발견되면 후속 교환 후 재학습 및 재테스트를 피하기 위해 실패한 모듈을 일정 기간\(구현에 따라 다름\) 동안 유지해야 합니다.\(SHOULD\)

---
### **8.3.  Generator Selection**

생성기\(g\)는 개인 비밀 지수가 더 작은 하위 집합을 순환하지 않고 모듈러스\(p\) 범위 전체에 고르게 분포된 모든 가능한 공개 값을 생성하도록 선택되어야 합니다. 이러한 생성기를 "기본 루트"라고 합니다\(p가 "안전"할 때 찾기가 쉽지 않음\).

지원하려면 하나의 발전기\(2\)만 필요합니다.

```text
   Implementation Notes:
```

- 한 가지 유용한 기술은 생성기를 선택한 다음 모듈러스 선택 체를 해당 생성기로 소수로 제한하는 것입니다.

p\(mod 24\) = 11인 경우 2입니다.

- p\(mod 12\) = 5일 때 3. p\(mod 10\) = 3 또는 7일 때 5.

- 필수 생성기\(2\)는 곱셈 성능의 효율성을 향상시킵니다. 여전히 가능한 잔여 공간의 절반을 차지하므로 원시 루트가 아닌 경우에도 사용할 수 있습니다.

---
### **8.4.  Exponent Selection**

각 구현은 서로 다른 모듈러스에 대해 별도의 무작위 개인 비밀 지수를 생성합니다. 그런 다음 주어진 모듈러스, 생성기 및 지수에 대해 D-H 교환 값이 계산됩니다.

이 사양에서는 지수 길이가 가장 강력한 제공 속성에 필요한 가장 긴 세션 키의 원하는 암호화 강도의 두 배 이상일 것을 권장합니다.

"Moduli Selection"\(위\)의 추정치를 기반으로 합니다.

- 512비트 모듈러스의 경우 128비트\(또는 그 이상\)의 지수 길이가 권장됩니다.

- 1024비트 모듈러스의 경우 160\~256비트\(또는 그 이상\)의 지수 길이가 권장됩니다.

동일한 모듈러스와 생성기가 사용될 때마다 동일한 지수와 교환 가치가 여러 당사자와 함께 사용될 수 있지만 지수는 무작위 간격으로 변경되어야 합니다. 백그라운드 프로세스는 주기적으로 이전 값을 삭제하고 새로운 임의의 개인 비밀 지수를 생성하고 교환 가치를 다시 계산할 수 있습니다.\(SHOULD\)

```text
   Implementation Notes:
```

- 지수의 크기는 전적으로 구현에 따라 다르며 상대방이 알 수 없으며 쉽게 변경할 수 있습니다.

- 이러한 작업에는 시간이 많이 걸리는 여러 모듈식 지수 계산이 포함되므로 "백그라운드"로 이동하면 Photuris 프로토콜의 겉보기 실행 속도가 크게 향상됩니다. 또한 단일 공개/개인 키 쌍을 여러 개의 밀접하게 배치된 키에서 사용할 수 있도록 CPU 부하를 충분히 줄입니다.

- 짧은 기간 동안 여러 다른 노드로 보안 연결을 생성할 때 Photuris 실행.

- 기타 사전 계산 제안은 \[BGMW93, LL94, Rooij94\]에 설명되어 있습니다.

---
### **8.5.  Defective Exchange Values**

일부 지수는 비밀로 간주되지 않습니다. 지수 0은 교환 가치 1을 생성하고 지수 1은 교환 가치 g를 생성합니다. 작은 지수는 쉽게 눈에 띄므로 다음과 같은 경우에는 피해야 합니다.\(SHOULD\)

```text
      g**x < p.
```

모듈러스의 구조에 따라 특정 지수가 하위 그룹 감금 공격에 사용될 수 있습니다. "안전한" 소수\(p = 2q+1\)의 경우 이러한 지수는 p-1과 \(p-1\)/2이며 각각 교환 값 1과 p-1을 생성합니다.

구현이 임의의 지수를 선택하면 결과 교환 가치가 검사됩니다. 교환 값이 모듈러스의 유효 비트 수의 절반 미만으로 표시되는 경우 새로운 무작위 지수를 선택해야 합니다.\(MUST\)

- 512비트 모듈러스의 경우 2\*\*256 이상의 Exchange-Value가 필요합니다.

- 1024비트 모듈러스의 경우 2\*\*512 이상의 Exchange-Value가 필요합니다.

또한 결과 Exchange-Value가 p-1이면 새로운 임의 지수를 선택해야 합니다.\(MUST\)

요구 사항을 충족하지 못하는 교환 값을 수신하면 값 교환 메시지가 자동으로 삭제됩니다.

```text
   Implementation Notes:
```

- 지수의 최상위 절반에 최소 1비트를 설정하면 작은 지수를 피할 수 있습니다.

---
## **9.  Basic Exchange-Schemes**

초기값은 다음과 같이 할당됩니다.

```text
   (0)   Reserved.

   (1)   Reserved.
```

\(2\) 구현이 필요합니다. 권장 생성기\(g\)가 2인 모든 모듈러스\(p\). Exchange-Scheme Size가 0이 아닌 경우 모듈러스는 Offered-Schemes 목록의 Exchange-Scheme Value 필드에 포함됩니다.

- Exchange-Scheme Size 0은 유효하지 않습니다.

```text
         Key-Generation-Function     "MD5 Hash"
         Privacy-Method              "Simple Masking"
         Validity-Method             "MD5-IPMAC Check"
```

- 이 기능 조합에는 최소 64비트의 암호화 강도를 갖춘 모듈러스가 필요합니다.

\(3\) 교환 계획 3 \~ 255는 미래에 널리 알려진 공개 계획을 위한 것입니다.

\(256\) Exchange-Schemes 256 \~ 32767은 공급업체별 미공개 체계를 위한 것입니다. 번호를 원하는 구현자는 작성자에게 번호를 요청해야 합니다.\(MUST\)

\(32768\)

- Exchange-Schemes 32768 \~ 65535는 공급업체 구현에 관계없이 개인 계획을 나타내기 위해 협력 당사자에게 제공됩니다. 이 번호는 예약된 번호가 아니며 중복될 수 있습니다. Cookie\_Request의 IP 소스 및 대상과 같은 다른 기준은 사용 가능한 특정 교환 체계를 구별하는 데 사용됩니다.

```text
10.  Basic Key-Generation-Function
10.1.  MD5 Hash
```

MD5 \[RFC-1321\]는 키 생성을 위한 의사 무작위 함수로 사용됩니다. 키는 해시의 가장 중요한 비트로 시작됩니다. MD5는 필요한 길이의 키 자료를 생성하기 위해 필요에 따라 반복됩니다.

개별 키가 마지막 해시의 128비트를 모두 사용하지 않는 경우 마지막 해시의 사용되지 않은 나머지\(최하위\) 비트는 모두 삭제됩니다. 동일한 목적으로 다른 키 생성 용도와 결합하면 다음 키는 새로운 해시 반복으로 시작됩니다.

```text
11.  Basic Privacy-Method
11.1.  Simple Masking
```

"개인 키 계산"에 설명된 대로 SPI 뒤의 다음 필드부터 시작하여 패딩을 포함하여 메시지 길이와 일치하도록 충분한 개인 키 자료가 생성됩니다. 메시지는 개인 키를 사용하여 XOR로 마스킹됩니다.

```text
12.  Basic Validity-Method
12.1.  MD5-IPMAC Check
```

"유효성 확인"에 설명된 대로 확인 필드 값은 다음의 연결에 대한 MD5 \[RFC-1321\] 해시입니다.

```text
      MD5( key, keyfill, data, datafill, key, md5fill )
```

여기서 키는 계산된 확인 키입니다.

키필과 데이터필은 md5fill에 정의된 것과 동일한 길이의 패드 기술을 사용합니다. 이 패딩과 길이는 암시적이며 데이터그램에 나타나지 않습니다.

결과 확인 필드는 128비트 가변 정밀도 정수\(크기 포함 18바이트\)입니다. 계산에 사용되는 경우 확인 데이터에는 크기 및 값 필드가 모두 포함됩니다.

---
## **13.  Basic Attributes**

번호를 원하는 구현자는 작성자에게 번호를 요청해야 합니다. 초기값은 다음과 같이 할당됩니다.\(MUST\)

```text
     Use    Type
      -       0* padding
      -       1* AH-Attributes
      -       2+ ESP-Attributes
     AEI      5* MD5-IPMAC
     AEIX   255+ Organizational

     A      AH Attribute-Choice
      E     ESP Attribute-Choice
       I    Identity-Choice
        X   dependent on list location
         +  feature must be recognized even when not supported
         *  feature must be supported (mandatory)
```

다른 속성은 동반 문서에 지정되어 있습니다.

---
### **13.1.  Padding**

```text
   +-+-+-+-+-+-+-+-+
   |   Attribute   |
   +-+-+-+-+-+-+-+-+

   Attribute        0
```

각 속성에는 여러 바이트의 값 필드가 있을 수 있습니다. 처리 효율성을 촉진하기 위해 이러한 필드는 정수 모듈로 8바이트\(64비트\) 경계에 정렬됩니다.

패딩은 정렬이 필요한 속성 앞에 1\~7 속성 0 패딩 바이트를 삽입하여 수행됩니다.

목록의 마지막 속성 뒤에는 패딩이 사용되지 않습니다.

---
### **13.2.  AH-Attributes**

```text
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Attribute   |    Length     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Attribute        1

   Length           0
```

속성 목록이 지정되면 이 속성은 AH\(인증 헤더\)에 적용되는 목록 섹션을 시작합니다.

---
### **13.3.  ESP-Attributes**

```text
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Attribute   |    Length     |  PayloadType  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Attribute        2

   Length           1
```

페이로드 유형 1바이트. IP 다음 헤더\(프로토콜\) 값을 사용하여 ESP 변환 데이터 필드의 내용을 나타냅니다. IP Next 헤더\(프로토콜\)의 최신 값은 가장 최근의 "할당된 번호"\[RFC-1700\]에 지정됩니다.

- 예를 들어 전체 IP 데이터그램을 암호화하는 경우 이 필드에는 IP-in-IP 캡슐화를 나타내는 값 4가 포함됩니다.

속성 목록이 지정되면 이 속성은 ESP\(Encapslating Security Payload\)에 적용되는 목록 섹션을 시작합니다.

Offered-Attribute로 나열되면 PayloadType은 255로 설정됩니다.

Attribute-Choice로 선택하면 PayloadType이 실제 사용되는 값으로 설정된다.

---
### **13.4.  MD5-IPMAC**

```text
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Attribute   |    Length     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Attribute        5

   Length           0
```

---
#### **13.4.1.  Symmetric Identification**

Identity-Choice로 선택되면 바로 다음의 식별 필드에 구조화되지 않은 가변 정밀도 정수가 포함됩니다. 유효한 식별 및 대칭 비밀 키는 당사자에 의해 사전 구성됩니다.

식별 값에는 필수 형식이나 내용이 없습니다. 값은 모든 종류의 숫자 또는 문자열일 수 있습니다. 자세한 내용은 "식별정보 및 비밀의 사용"을 참조하세요.

대칭 비밀 키\(지정된 대로\)는 식별 필드의 내용을 기반으로 선택됩니다. 모든 구현은 최소 62바이트를 지원해야 합니다\(MUST\). 선택된 대칭 비밀 키는 최소 64비트의 암호화 강도를 제공해야 합니다\(SHOULD\).\(MUST, SHOULD\)

"ID 확인"에 설명된 대로 확인 필드 값은 다음을 연결한 MD5 \[RFC-1321\] 해시입니다.

```text
      MD5( key, keyfill, data, datafill, key, md5fill )
```

여기서 키는 계산된 확인 키입니다.

키필과 데이터필은 md5fill에 정의된 것과 동일한 길이의 패드 기술을 사용합니다. 이 패딩과 길이는 암시적이며 데이터그램에 나타나지 않습니다.

결과 확인 필드는 128비트 가변 정밀도 정수\(크기 포함 18바이트\)입니다. 계산에 사용되는 경우 확인 데이터에는 크기 및 값 필드가 모두 포함됩니다.

"신원 확인"과 "유효성 확인" 모두에서 확인 키는 다음 연결된 값의 MD5 \[RFC-1321\] 해시입니다.

+ 대칭 비밀 키, + 계산된 공유 비밀.

"세션 키 계산"의 경우 대칭 비밀 키가 생성 키로 직접 사용됩니다.

대칭 비밀 키의 내부 표현에 관계없이 계산에 사용될 때 이는 가변 정밀도 정수의 값 부분과 동일한 형식입니다.

- 가장 중요한 바이트가 먼저 옵니다. - 사용된 비트는 바이트 경계 내에서 오른쪽 정렬됩니다. - 사용되지 않은 비트는 최상위 바이트에 있습니다. - 사용되지 않은 비트는 0으로 채워집니다.

대칭 비밀 키에는 크기 필드가 포함되지 않습니다.

---
#### **13.4.2.  Authentication**

\[RFC-1828\] 등에 따라 AH 또는 ESP 속성 선택으로 선택될 수 있습니다. 선택한 교환 체계는 최소 64비트의 암호화 강도를 제공해야 합니다\(SHOULD\).\(SHOULD\)

"세션 키 계산"에 설명된 대로 키 생성 기능 반복 중 가장 중요한 384비트\(48바이트\)가 키에 사용됩니다.

```text
   Profile:
```

- Photuris와 협상할 때 변환이 \[RFC-1828\]과 약간 다릅니다.

- 인증된 메시지의 형식은 다음과 같습니다.

```text
         MD5( key, keyfill, datagram, datafill, key, md5fill )
```

- 여기서 키는 SPI 세션 키입니다.

- 추가 데이터필은 \[PO96\]에 설명된 \(비현실적인\) 공격으로부터 보호합니다. 키필과 데이터필은 md5fill에 정의된 것과 동일한 길이의 패드 기술을 사용합니다. 이 패딩과 길이는 암시적이며 데이터그램에 나타나지 않습니다.

---
### **13.5.  Organizational**

```text
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Attribute   |    Length     |              OUI
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          ...      |     Kind      |  Value(s) ...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Attribute        255

   Length           >= 4
```

- 길이가 4인 경우 값 필드가 존재하지 않습니다.

OUI 3바이트. IEEE 802 또는 IANA에서 할당한 공급업체의 조직 고유 식별자입니다\(연락처 세부 정보는 \[RFC-1700\] 참조\). 바이트 내의 비트는 정식 순서로 되어 있으며 최상위 바이트가 먼저 전송됩니다.

종류 1바이트. OUI의 하위 유형을 나타냅니다. 이 분야에는 표준화가 없습니다. 각 OUI는 고유한 값을 구현합니다.

값 0바이트 이상. 세부 사항은 구현에 따라 다릅니다.

일부 구현자는 독점 알고리즘 및 속성을 게시할 필요가 없거나 게시를 원하지 않을 수도 있습니다. 이 OUI 메커니즘을 사용하면 작성자에게 고유 번호 요청을 방해하지 않고 이를 지정할 수 있습니다.

---
## **A.  Automaton**

프로토콜의 작동을 설명하기 위해 예제 자동화 장치가 제공됩니다. 불완전하고 비결정적입니다. 좋은/나쁜 의미론적 결정의 대부분은 정책 기반이거나 표 형식으로 표현하기가 너무 어렵습니다. 이 예와 텍스트 사이에 충돌이 나타나는 경우 텍스트가 우선합니다.

유한 상태 자동 장치는 이벤트, 동작 및 상태 전환으로 정의됩니다. 이벤트에는 타이머 만료와 같은 외부 명령 수신, 피어로부터의 데이터그램 수신이 포함됩니다. 작업에는 타이머 시작과 피어에 대한 데이터그램 전송이 포함됩니다.

```text
   Events

   DU13 = Communication Administratively Prohibited
   SF0  = Bad SPI
   SF4  = Need Authentication
   SF5  = Need Authorization
   WC   = Want Confidentiality

   RCQ+ = Receive Cookie_Request (Good)
   RCQ- = Receive Cookie_Request (Bad)
   RCR+ = Receive Cookie_Response (Good)
   RCR- = Receive Cookie_Response (Bad)

   RVQ+ = Receive Value_Request (Good)
   RVQ- = Receive Value_Request (Bad)
   RVR+ = Receive Value_Response (Good)
   RVR- = Receive Value_Response (Bad)

   RIQ+ = Receive Identity_Request (Good)
   RIQ- = Receive Identity_Request (Bad)
   RIR+ = Receive Identity_Response (Good)
   RIR- = Receive Identity_Response (Bad)

   RUN+ = Receive SPI_Needed (Good)
   RUN- = Receive SPI_Needed (Bad)
   RUM+ = Receive SPI_Update (Good)
   RUM- = Receive SPI_Update (Bad)

   RBC  = Receive Bad Cookie
   RRL  = Receive Resource Limit
   RVF  = Receive Verification Failure
   RMR  = Receive Message Reject
```

TO+ = 카운터 \> 0으로 인한 시간 초과

TO- = 카운터가 만료된 시간 초과 UTO = 업데이트 시간 초과 XTO = 교환 시간 초과

```text
   Actions

   scq  = Send Cookie_Request
   scr  = Send Cookie_Response

   svq  = Send Value_Request
   svr  = Send Value_Response

   siq  = Send Identity_Request
   sir  = Send Identity_Response

   sum  = Send SPI_Update

   se*  = Send error message (see text)
   sbc  = Send Bad Cookie
   srl  = Send Resource Limit
   svf  = Send Verification Failure

   brto = Backoff Retransmission TimeOut
   buto = Backoff Update TimeOut
   rto  = Set Retransmission TimeOut
   uto  = Set Update TimeOut
   xto  = Set Exchange TimeOut

   log  = log operator message
```

---
### **A.1.  State Transition Table**

상태는 가로로 표시되고 이벤트는 세로로 읽혀집니다. 상태 전환 및 작업은 작업/새 상태 형식으로 표시됩니다. 여러 작업은 쉼표로 구분되며 공간이 필요한 경우 다음 줄에서 계속될 수 있습니다. 여러 작업을 편리한 순서로 구현할 수 있습니다. 상태 뒤에는 설명 각주를 나타내는 문자가 올 수 있습니다. 대시\('-'\)는 잘못된 전환을 나타냅니다.

```text
   Initiator

         |    0         1         2         3         4
         | Initial    Cookie  CookieBad   Value    ValueBad
   ------+--------------------------------------------------
    DU13 |rto,scq/1 rto,scq/1 rto,scq/1     3         4
    SF0  |rto,scq/1     1         2         3         4
    SF4  |rto,scq/1     1         2         3         4
    SF5  |rto,scq/1     1         2         3         4
    WC   |rto,scq/1     1         2         3         4
         |
    RCR+ |    -     rto,svq/3 rto,svq/3     3         4
    RCR- |    0         1         2         3         4
    RVR+ |    -         -         -     rto,siq/5 rto,siq/5
    RVR- |    0         1         2         3         4
    RIR+ |    -         -         -         -         -
    RIR- |    0         1         2         3         4
         |
    RUN+ |    -         -         -         -         -
    RUN- |  sbc/0     sbc/1     sbc/2     sbc/3     sbc/4
    RUM+ |    -         -         -         -         -
    RUM- |  sbc/0     sbc/1     sbc/2     sbc/3     sbc/4
         |
    RBC  |    -         -         -         4         4
    RRL  |    -       brto/2    brto/2    brto/4    brto/4
    RVF  |    -         -         -         -         -
    RMR  |    -         -         -         -         -
         |
     TO+ |    -       scq/1     scq/2     svq/3     svq/4
     TO- |    -         0       scq/1       0       scq/1
    UTO  |    -         -         -         -         -
    XTO  |    -         0         0         0         0

   Initiator

         |    5         6         8
         |Identity IdentityBad  Update
   ------+-----------------------------
    DU13 |    5         6         8
    SF0  |    5         6     rto,scq/1
    SF4  |    5         6     rto,scq/1
    SF5  |    5         6     rto,scq/1
    WC   |    5         6       sun/8
         |
    RCR+ |    5         6         8
    RCR- |    5         6         8
    RVR+ |    5         6         8
    RVR- |    5         6         8
    RIR+ |  uto/8     uto/8       8
    RIR- |  svf/5     svf/6       8
         |
    RUN+ |    -         -       sum/8
    RUN- |  sbc/5     sbc/6     se*/8
    RUM+ |    -         -         8
    RUM- |  sbc/5     sbc/6     se*/8
         |
    RBC  |    6         6     rto,scq/1
    RRL  |    5         6       buto/8
    RVF  |  log/5     log/6     log/8
    RMR  |  log/5     log/6     log/8
         |
     TO+ |  sim/5     sim/6       -
     TO- |    0       scq/1       -
    UTO  |    -         -       sum/8
    XTO  |    0         0         0

   Responder

         |    0         7         8
         | Initial    Ready     Update
   ------+-----------------------------
    WC   |    -         7       sun/8
         |
    RCQ+ |  scr/0     scr/7     scr/8
    RCQ- |  srl/0     srl/7     srl/8
    RVQ+ |xto,svr/7   svr/7     svr/8
    RVQ- |  sbc/0     sbc/7     sbc/8
    RIQ+ |    -     uto,sir/8   sir/8
    RIQ- |  sbc/0     se*/7     se*/8
         |
    RUN+ |    -         -       sum/8
    RUN- |  sbc/0     sbc/7     se*/8
    RUM+ |    -         -         8
    RUM- |  sbc/0     sbc/7     se*/8
         |
    RBC  |    -         7     rto,scq/1
    RRL  |    -         -       buto/8
    RVF  |    -         -       log/8
    RMR  |    -         -       log/8
         |
    UTO  |    -         -       sum/8
    XTO  |    -         0         0
```

---
### **A.2.  States**

다음은 각 오토마톤 상태에 대한 자세한 설명입니다.

상태의 "Bad" 버전은 Bad\_Cookie 또는 Resource\_Limit 메시지가 수신되었음을 나타냅니다.

---
#### **A.2.1.  Initial**

초기 상태는 당사자들 사이에 상태가 없다는 점에서 허구입니다.

---
#### **A.2.2.  Cookie**

Cookie 상태에서는 Initiator가 Cookie\_Request를 보냈고 Cookie\_Response를 기다리고 있습니다. 다시 시작 및 Exchange 타이머가 모두 실행 중입니다.

응답자에는 쿠키 상태가 없습니다.

---
#### **A.2.3.  Value**

Value 상태에서는 Initiator가 Exchange-Value를 보냈고 Identity\_Message를 기다리고 있습니다. 다시 시작 및 Exchange 타이머가 모두 실행 중입니다.

---
#### **A.2.4.  Identity**

Identity 상태에서 Initiator는 Identity\_Request를 보냈고 응답으로 Identity\_Response를 기다리고 있습니다. 다시 시작 및 Exchange 타이머가 모두 실행 중입니다.

---
#### **A.2.5.  Ready**

준비 상태에서 응답자는 교환 값을 보냈고 Identity\_Message를 기다리고 있습니다. Exchange 타이머가 실행 중입니다.

---
#### **A.2.6.  Update**

업데이트 상태에서는 각 당사자가 Photuris 교환을 체결했으며 Exchange LifeTime이 만료될 때까지 만료되는 SPI를 일방적으로 업데이트합니다. 업데이트 타이머와 Exchange 타이머가 모두 실행 중입니다.

---
## **B.  Use of Identification and Secrets**

기본 프로토콜을 구현하려면 참가자 ID 및 관련 대칭 비밀 키의 운영자 구성에 대한 지원이 필요합니다.

식별 및 비밀 필드의 형식은 읽을 수 있는 문자열로 제한되지 않습니다. 더 간단한 인용 문자열 구성 외에도 구현에서는 임의의 바이트 스트림 구성을 허용해야 합니다\(MUST\).\(MUST\)

---
### **B.1.  Identification**

일반적으로 식별은 사용자 이름, 사이트 이름, 정규화된 도메인 이름 또는 사용자 이름과 도메인 이름이 포함된 이메일 주소입니다. 예는 다음과 같습니다:

```text
      user
      node.site.
      user@node.site.
      rcmd@node.site.
      "Mundane Name" <user@node.site>
```

도메인 이름이 당사자가 사용하는 특정 IP 주소와 일치할 필요는 없습니다.

---
### **B.2.  Group Identity With Group Secret**

간단한 구성 접근 방식에서는 신뢰할 수 있는 그룹의 모든 참가자에게 배포되는 단일 ID 및 비밀을 사용할 수 있습니다. 이는 인터넷을 통한 가상 사설망으로 구성된 단일 관리 하의 라우터 간에 적합할 수 있습니다.

노타 베네:

- 이 예에 사용된 비밀번호는 최소 64비트 암호화 강도에 대한 "MD5-IPMAC 대칭 식별" 권장 사항을 충족하지 않습니다.

관리자는 동일한 사용자 이름과 비밀번호로 각 라우터를 구성합니다.

```text
      identity local "Tiny VPN 1995 November" "abracadabra"
      identity remote "Tiny VPN 1995 November" "abracadabra"
```

개시자가 Identity\_Request를 보내면 SPI 소유자는

식별 필드는 "Tiny VPN 1995 November"이고 SPI 소유자 비밀 키는 "abracadabra"입니다.

응답자가 Identity\_Response를 보낼 때 SPI 소유자 식별 필드는 "Tiny VPN 1995 November"이고 SPI 소유자 비밀 키는 "abracadabra"입니다. SPI 사용자 식별은 "Tiny VPN 1995 November"\(요청에서 가져옴\)이고 SPI 사용자 비밀 키는 "abracadabra"입니다.

모든 단계에서 양 당사자에게 동일한 난수를 생성하는 매우 열악한 난수 생성 구현과 완전히 동일한 구성에도 불구하고 응답 계산에 SPI 사용자 확인 필드를 추가하면 다음이 발생할 가능성이 높습니다. 다른 확인 값\("신원 확인" 참조\) 결과적으로 서로 다른 확인 값은 각 방향에서 다를 가능성이 높은 SPI 세션 키 계산에 영향을 미칩니다\("세션 키 계산" 참조\).

---
### **B.3.  Multiple Identities With Group Secrets**

보다 강력한 구성 접근 방식에서는 각 당사자에 대해 별도의 ID와 비밀을 사용하여 신뢰할 수 있는 그룹의 참가자에게 배포할 수 있습니다. 이는 인증된 방화벽 통과에 적합할 수 있습니다.

관리자는 하나 이상의 네트워크와 다수의 모바일 사용자를 보유합니다. 승인된 외부 사용자의 접근을 제한하는 것이 바람직합니다. 예제 경계 라우터는 10.0.0.1입니다.

관리자는 라우터에 대한 그룹 사용자 이름 및 비밀번호와 함께 각 사용자에게 서로 다른 사용자 이름 및 비밀번호를 제공합니다.

관리자는 다음을 부분적으로 구성합니다.

```text
      identity local "199511@router.site" "FalDaRah"
      identity remote "Happy_Wanderer@router.site" "FalDaRee"
```

각 모바일 사용자는 터널링 및 인증에 명령을 추가합니다.

```text
      route addprivate 10.0.0.0/8 tunnel 10.0.0.1
      secure 10.0.0.1 authenticate-only
      identity local "Happy_Wanderer@router.site" "FalDaRee"
      identity remote "199511@router.site" "FalDaRah"
      identity remote "199512@router.site" "FalDaHaHaHaHaHaHa"
```

모바일 개시자가 Identity\_Request를 보내면 SPI 소유자는

식별 필드는 "Happy\_Wanderer@router.site"이고 SPI 소유자 비밀 키는 "FalDaRee"입니다.

방화벽 응답자가 Identity\_Response를 보낼 때 SPI 소유자 식별 필드는 "199511@router.site"이고 SPI 소유자 비밀 키는 "FalDaRah"입니다. SPI 사용자 식별 필드는 "Happy\_Wanderer@router.site"\(요청에서 가져옴\)이고 SPI 사용자 비밀 키는 "FalDaRee"입니다.

이 예에서 모바일 사용자는 이미 월별 비밀번호 변경을 준비하고 있으며, 이때 라우터는 자신을 "199512@router.site"로 식별할 수 있습니다.

---
### **B.4.  Multiple Identities With Multiple Secrets**

각 당사자 간에 비밀 쌍을 구성하면 보안이 강화될 수 있습니다. 이전과 마찬가지로 하나의 비밀은 그룹 구성원과의 초기 연락에 사용되지만 다른 비밀은 특정 당사자 간에 사용됩니다. 하나의 비밀 또는 비밀 쌍이 손상되더라도 그룹의 다른 구성원에게는 영향을 미치지 않습니다. 이는 각 VPN 구성원 액세스에 대한 로컬 정책을 설정하는 협력 가상 사설망 간의 경계를 형성하는 라우터 사이에 적합할 수 있습니다.

```text
   One administrator configures:

      identity local "Apple" "all for one"
      identity local "Apple-Baker" "Apple to Baker" "Baker"
      identity remote "Baker" "one for all"
      identity remote "Baker-Apple" "Baker to Apple"

   Another configures:

      identity local "Baker" "one for all"
      identity local "Baker-Apple" "Baker to Apple" "Apple"
      identity remote "Apple" "all for one"
      identity remote "Apple-Baker" "Apple to Baker"
```

개시자가 Identity\_Request를 보낼 때 SPI 소유자 식별 필드는 "Apple"이고 SPI 소유자 비밀 키는 "all for one"입니다.

응답자가 Identity\_Response를 보내면 "Apple"\(이 예에서는 세 번째 필드로 표시됨\)에 대한 특수 쌍이 존재함을 확인하고 SPI 소유자 식별 필드는 "Baker-Apple"이고 SPI 소유자 비밀 키는 "Baker"입니다. 애플에게". SPI 사용자 식별은 "Apple"\(요청에서 가져옴\)이고 SPI 사용자

비밀 키는 "모두를 위한 것"입니다.

---
# **Operational Considerations**

사양은 대부분의 상황을 만족시키는 기본값과 함께 몇 가지 구성 가능한 매개변수만 제공합니다.

```text
   Retransmissions
      Default: 3.

   Initial Retransmission TimeOut (IRTO)
      Default: 5 seconds.

   Exchange TimeOut (ETO)
      Default: 30 seconds.  Minimum: Retransmissions * IRTO.

   Exchange LifeTime (ELT)
      Default: 30 minutes.  Minimum: 2 * ETO.

   SPI LifeTime (SPILT)
      Default: 5 minutes.  Minimum: 3 * ETO.
```

각 당사자는 알려진 ID 및 대칭 비밀 키 목록을 구성합니다.

또한 각 당사자는 특정 ID 보유자에게 부여되는 액세스 권한\(있는 경우\)을 결정하는 로컬 정책을 구성합니다. 예를 들어 당사자는 익명 FTP를 허용하지만 Telnet은 금지할 수 있습니다. 그러한 고려 사항은 이 문서의 범위를 벗어납니다.

---
# **Security Considerations**

Photuris는 네트워크 프로토콜에 관심이 있는 암호화 전문가가 아닌 암호화에 관심이 있는 숙련된 네트워크 프로토콜 설계자가 현재 사용 가능한 도구를 기반으로 했습니다. 이 사양은 암호학에 대한 광범위한 배경 지식 없이도 쉽게 구현할 수 있도록 고안되었습니다.

따라서 이 문서에는 최소한의 배경 암호학적 논의와 근거만 포함됩니다. 일반 암호학 커뮤니티에서 일부 리뷰가 제공되었지만 설계 결정 및 장단점은 후속 논문에서 철저하게 분석되고 앞으로 수년 동안 논의될 것으로 예상됩니다.

암호학적 세부 사항은 새로운 분석을 통해 보다 쉽고 시기적절하게 업데이트될 수 있는 별도의 문서용으로 예약되어 있습니다.

---
# **History**

현재 버전 1\(1994년 12월 \~ 1995년 3월\)이라고 불리는 Photuris의 초기 사양은 짧은 설계 요구 사항 목록과 Phil Karn의 간단한 실험 코드를 기반으로 했습니다. 사전 지정된 그룹 매개변수의 단일 바이트 인덱스와 함께 하나의 모듈식 지수 형식만 사용되었습니다. 공개 가치 교환 중에 변환 속성이 ​​선택되었습니다. 표준 ESP 변환을 사용한 식별 서명 교환에서 파티 개인정보가 보호되었습니다.

IP 보안 워킹 그룹의 검토를 위해 제출할 때 많은 기능이 요구되었습니다. 단지 254개의 미래 그룹 선택만으로는 충분하지 않은 것으로 간주되었습니다. 이는 2바이트로 확장되었고\(그리고 구성표 이름이 변경됨\) 가변 매개변수를 전달하기 위해 다시 확장되었습니다. 변환 속성은 선택적 매개변수를 수용하기 위해 가변 길이로 만들어졌습니다. 다른 모든 가능한 매개변수는 협상 가능하도록 만들어졌습니다. 일부 참가자는 일부 메시지에만 표준 ESP 변환을 사용하기 위해 UDP 소켓의 모드를 전환할 수 없었으며 파티 개인 정보 보호가 프로토콜에 통합되었습니다. 메시지 헤더가 재구성되었으며 변환 속성 선택이 식별 교환까지 지연되었습니다. 추가 업데이트 메시지 단계가 추가되었습니다.

버전 2\(1995년 7월 \~ 1995년 12월\) 사양 안정성은 이후 논의를 위해 대부분의 매개변수를 별도의 문서로 이동하고 기본 사양에 몇 가지 필수 기능만 남겨두는 방식으로 1995년 11월에 달성되었습니다. 한 달 안에 상호 운용 가능한 여러 구현이 생성되었습니다.

불행하게도 선동의 일환으로 IP 보안 워킹 그룹은 밀짚 투표에서 정당의 개인 정보 보호를 제거하기로 결정했으며 워킹 그룹 의장은 더 이상의 논의를 허용하지 않고 회의를 종료했습니다. 식별 교환 메시지가 올바르게 작동하려면 개인 정보 보호가 필요했기 때문에 메시지가 다시 재구성되었습니다. 파티 개인 정보 보호 및 기타 선택 사항 체계는 별도의 문서로 분할되었습니다.

구현자는 별도의 토론 그룹을 구성했습니다. 버전 3\(1996년 4월 \~ 1997년 6월\)은 오랜 기간 동안 사양 안정성을 유지하고 6개 플랫폼에서 다중 구현을 즐겼습니다.

한편, IP 보안 워킹 그룹\(IP Security Working Group\)은 협상 가능한 매개변수가 많은 경쟁 사양을 개발했습니다. 또한 PPP 확장 작업 그룹은 링크 보안 변환을 배포했습니다.

버전 4\(1997년 7월 이후\)는 이러한 다른 노력과 인터페이스 호환성을 유지하려고 시도합니다. 사소한 변경 사항은

변환 패딩 형식 및 키 생성에 지정됩니다. 구성표당 둘 이상의 값이 허용되므로 향후 확장에 대한 선택의 여지가 더 커집니다. 당사자 개인 정보를 기본 문서로 되돌리고 자동화된 업데이트 및 오류 복구에서 작은 의미 변경을 수행할 수 있는 기회가 주어집니다. 모든 ESP 변환 속성은 \(희망적으로\) 기본 문서에 대한 향후 호환되지 않는 변경을 방지하기 위해 별도의 문서로 이동됩니다.

---
# **Acknowledgements**

- 함께 곱할 수 있는 정수의 크기, 정수가 그 자체로 곱해질 수 있는 횟수, 정수가 감소할 수 있는 모듈러스를 제한하는 법을 제정해서는 안 됩니다. \[제일계명\]

Phil Karn은 주로 프로토콜 단계의 설계, 특히 "쿠키" 막힘 방지 방어를 담당하고 초기 테스트 구현을 개발했으며 많은 설계 근거 텍스트를 제공했습니다\(현재는 별도의 문서로 제거됨\).

William Simpson은 패킷 형식 및 속성, 추가 메시지 유형, 편집 및 형식화를 담당했습니다. 그러한 실수는 모두 그의 책임입니다.

이 프로토콜은 나중에 Station-To-Station 인증 프로토콜 \[DOW92\]과 많은 공통 요소를 가지고 있는 것으로 밝혀졌습니다.

Angelos Keromytis는 최초의 완전히 독립적인 구현을 개발했습니다\(1995년 10월경\). 또한 그는 쿠키 환율 제한 카운터를 제안했습니다.

Paul C van Oorschot는 인증 전용 버전의 신원 확인을 제공하기 위해 공개 지수와 공유 비밀을 모두 서명할 것을 제안했습니다. 또한 그는 모듈러스, 생성기 및 지수 선택에 관한 텍스트를 제공했습니다\(현재는 별도의 문서로 제거됨\).

Hilarie Orman은 비대칭 공개/개인 키 ID 방법\(현재는 별도의 문서로 제거됨\)을 위한 세션 키 생성에 비밀 "nonce"를 추가할 것을 제안하고 프로토콜 세부 사항에 대한 광범위한 검토를 제공했습니다.

Bart Preneel과 Paul C van Oorschot는 \[PO96\]에서 인증을 위해 해싱할 때 데이터와 후행 키 사이에 패딩을 권장했습니다.

Niels Provos는 AIX, Linux, OpenBSD 및 Solaris로 포팅된 또 다른 독립 구현\(1997년 5월경\)을 개발했습니다. 또한 그가 만든

자동화된 업데이트에 관한 제안 및 구성표당 여러 모듈리 나열.

Bill Sommerfeld는 세션 키 생성에 인증 대칭 비밀 키를 포함시키고 연속적인 교환에서 쿠키 값을 사용하여 양방향 사용자 지향 키 지정을 제공할 것을 제안했습니다\(현재는 별도의 문서로 제거됨\).

Oliver Spatscheck는 Xkernel을 위한 두 번째 독립적 구현\(1995년 12월경\)을 개발했습니다.

초기 구현자 간의 국제 상호 운용성 테스트는 여기에 있는 많은 구현 노트와 프로토콜 메시지의 의미 체계에 대한 수많은 개선에 대한 원동력을 제공했습니다.

Randall Atkinson, Steven Bellovin, Wataru Hamada, James Hughes, Brian LaMacchia, Cheryl Madson, Lewis McCarthy, Perry Metzger, Bob Quinn, Ron Rivest, Rich Schroeppel 및 Norman Shulman은 이 문서의 이전 버전에 대한 유용한 비평을 제공했습니다.

컴퓨팅 리소스를 제공해주신 정보기술통합센터\(CITI\)에 특별히 감사드립니다.

---
# **References**

\[BGMW93\] E. Brickell, D. Gordon, K. McCurley 및 D. Wilson, "사전 계산을 통한 빠른 지수화\(확장 초록\)", Advances in Cryptology -- Eurocrypt '92, 컴퓨터 과학 강의 노트 658\(1993\), Springer-Verlag, 200-207.

- 또한 미국 특허 #5,299,262, E.F. Brickell, D.M. 고든, K.S. McCurley, "암호화 시스템에서 지수화 방법", 1994년 3월 29일.

\[DH76\] Diffie, W. 및 Hellman, H.E., "암호화의 새로운 방향", IEEE Transactions on Information Theory, v IT-22 n 6 pp 644-654, 1976년 11월.

\[DOW92\] Whitfield Diffie, Paul C van Oorshot 및 Michael J Wiener, "인증 및 인증된 키 교환", 디자인, 코드 및 암호화, v 2 pp 107-125, Kluwer Academic Publishers, 1992.

\[반딧불이\] "포투리스\(Photuris\)"는 반딧불이의 라틴어 이름입니다. "Firefly"는 STU-III 보안 전화에 대한 미국 국가 안보국의 \(비밀\) 키 교환 프로토콜의 이름입니다. 정보에 근거한 추측은

Firefly는 매우 유사한 디자인을 기반으로 하고 있습니다.

- 원칙.

\[LL94\] Lim, C.H., Lee, P.J., "사전 계산을 통한 더욱 유연한 지수화", Advances in Cryptology - Crypto '94, 컴퓨터 과학 강의 노트 839\(1994\), Springer-Verlag, 페이지 95-107.

\[제일계명\]

- 유즈넷 목록 sci.crypt에서 출처를 알 수 없는 인용문을 파생했습니다.

\[PO96\] Bart Preneel 및 Paul C van Oorshot, "두 가지 MAC 알고리즘의 보안", Advances in Cryptology - Eurocrypt '96, 컴퓨터 과학 1070 강의 노트\(1996년 5월\), Springer-Verlag, 페이지 19-32 .

```text
   [RFC-768]   Postel, J., "User Datagram Protocol", STD 6,
               USC/Information Sciences Institute, August 1980.

   [RFC-791]   Postel, J., "Internet Protocol", STD 5, USC/Information
               Sciences Institute, September 1981.
```

\[RFC-1321\] Rivest, R., "MD5 메시지 다이제스트 알고리즘", MIT 컴퓨터 과학 연구소, 1992년 4월.

\[RFC-1700\] Reynolds, J. 및 Postel, J., "할당된 번호", STD 2, USC/정보 과학 연구소, 1994년 10월.

\[RFC-1812\] Baker, F., 편집자, "IP 버전 4 라우터에 대한 요구 사항", Cisco Systems, 1995년 6월.

```text
   [RFC-1828]  Metzger, P., Simpson, W., "IP Authentication using Keyed
               MD5", July 1995.

   [RFC-1829]  Karn, P., Metzger, P., Simpson, W., "The ESP DES-CBC
               Transform", July 1995.
```

\[RFC-2119\] Bradner, S., "요구 사항 수준을 나타 내기 위해 RFC에 사용되는 핵심 단어", BCP 14, Harvard University, 1997년 3월.

\[RFC-2521\] Karn, P. 및 Simpson, W., "ICMP 보안 실패 메시지", 1999년 3월.

\[Rooij94\] P. de Rooij, "효율적인 지수화

- 사전 계산 및 벡터 추가 체인", Advances in Cryptology -- Eurocrypt '94, 컴퓨터 강의 노트

```text
               Science, Springer-Verlag, pages 403-415.

   [Schneier95]
               Schneier, B., "Applied Cryptography Second Edition", John
               Wiley & Sons, New York, NY, 1995.  ISBN 0-471-12845-7.
```

---
# **Contacts**

이 문서에 대한 의견은 photuris@adk.gr 메일링 리스트에서 논의되어야 합니다.

이 문서에 대한 질문은 다음 주소로 문의할 수도 있습니다.

```text
      Phil Karn
      Qualcomm, Inc.
      6455 Lusk Blvd.
      San Diego, California  92121-2779

          karn@qualcomm.com
          karn@unix.ka9q.ampr.org (preferred)

      William Allen Simpson
      DayDreamer
      Computer Systems Consulting Services
      1384 Fontaine
      Madison Heights, Michigan  48071

          wsimpson@UMich.edu
          wsimpson@GreenDragon.com (preferred)
```

---
# **Full Copyright Statement**

저작권\(C\)인터넷학회\(1999\). 저작권\(C\) Philip Karn 및 William Allen Simpson\(1994-1999\). 판권 소유.

본 문서와 그 번역본은 다른 사람에게 복사 및 제공될 수 있으며, 본 문서에 대해 논평하거나 설명하거나 구현을 지원하는 파생 저작물은 어떤 종류의 제한 없이 전체 또는 일부를 준비, 복사, 출판 및 배포할 수 있습니다. 단, 위의 저작권 표시와 이 단락은 모든 사본과 파생물에 포함되어 있어야 합니다. 그러나 본 문서 자체는 인터넷 표준을 개발하기 위한 목적으로 필요한 경우를 제외하고 저작권 표시를 제거하거나 인터넷 협회 또는 기타 인터넷 조직에 대한 참조를 제거하는 등 어떠한 방식으로도 수정할 수 없습니다\(이 경우 저작권에 대한 절차는 다음과 같이 정의됩니다\). 인터넷 표준 프로세스를 따라야 함\) 또는 영어 이외의 언어로 번역해야 하는 경우.

위에서 부여된 제한된 권한은 영구적이며 Internet Society 또는 그 승계자 또는 양수인에 의해 취소되지 않습니다.

이 문서와 여기에 포함된 정보는 "있는 그대로" 제공되며 인터넷 사회와 인터넷 엔지니어링 태스크포스는 여기에 있는 정보의 사용에 대한 보증을 포함하여\(단, 이에 국한되지 않음\) 모든 명시적 또는 묵시적 보증을 부인합니다. 특정 목적에 대한 상품성이나 적합성에 대한 어떠한 권리나 묵시적인 보증도 침해하지 않습니다.