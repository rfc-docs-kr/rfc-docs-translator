

```text
Network Working Group                                          P. Savola
Request for Comments: 4459                                     CSC/FUNET
Category: Informational                                       April 2006

       MTU and Fragmentation Issues with In-the-Network Tunneling
```

---
# **Status of This Memo**

이 메모는 인터넷 커뮤니티에 대한 정보를 제공합니다. 어떤 종류의 인터넷 표준도 지정하지 않습니다. 이 메모의 배포는 무제한입니다.

---
# **Copyright Notice**

Copyright \(C\) The Internet Society \(2006\).

---
# **Abstract**

네트워크 중간, 일반적으로 라우터 사이에 배포될 때 IP-in-IP와 같은 터널링 기술은 처리할 수 있는 크기가 얼마나 큰 패킷인지에 관한 특정 문제를 안고 있습니다. 이러한 패킷이 조각화되고 재조립되는지 여부\(및 방법\), 경로 MTU 검색 여부 사용될 것인지 또는 이 시나리오를 운영상 피할 수 있는 방법. 이 메모는 이것이 일반적이고 사소하지 않은 문제인 이유를 설명하고 다양한 솔루션과 그 특성을 어느 정도 자세히 설명합니다.

---
# **Table of Contents**

```text
   1. Introduction ....................................................2
   2. Problem Statement ...............................................3
   3. Description of Solutions ........................................4
      3.1. Fragmentation and Reassembly by the Tunnel Endpoints .......4
      3.2. Signalling the Lower MTU to the Sources ....................5
      3.3. Encapsulate Only When There is Free MTU ....................6
      3.4. Fragmentation of the Inner Packet ..........................8
   4. Conclusions .....................................................9
   5. Security Considerations ........................................10
   6. Acknowledgements ...............................................11
   7. References .....................................................11
      7.1. Normative References ......................................11
      7.2. Informative References ....................................12
```

---
## **1.  Introduction**

다른 패킷에 데이터그램을 캡슐화하는 많은 방법, 즉 터널링 메커니즘이 수년에 걸쳐 지정되었습니다. 예를 들어 IP-in-IP\(예: \[1\] \[2\], \[3\]\), 일반 라우팅 캡슐화 \(GRE\) \[4\], L2TP\(Layer 2 Tunneling Protocol\) \[5\] 또는 터널 모드의 IP 보안\(IPsec\) \[6\] - 모두 IPv4, IPv6 또는 기타 프로토콜 위에서 실행되어 전송될 수 있습니다. 동일하거나 다른 프로토콜.

이들 모두는 내부 프로토콜의 끝점이 외부 프로토콜의 끝점과 같은 위치에 있도록 실행될 수 있습니다. 일반적인 시나리오에서는 이는 "호스트 간" 터널링에 해당합니다. 호스트에서 라우터로 또는 라우터에서 호스트로의 터널링과 같이 한 세트의 엔드포인트를 같은 위치에 배치하는 것도 가능합니다. 마지막으로, 이러한 메커니즘 중 다수는 라우터 간에 전달되는 트래픽의 전부 또는 일부에 대해 라우터 간에도 사용되어 라우터 간 터널링이 발생합니다.

이러한 모든 프로토콜과 시나리오에는 공통적으로 한 가지 문제가 있습니다. 즉, 네트워크에서 통과하는 경로의 가장 작은 MTU\(최대 전송 단위\)에 패킷이 들어가고 심지어 캡슐화되도록 소스가 최대 패킷 크기를 어떻게 선택합니까? 그리고 패킷 크기에 영향을 미칠 수 없다면 어떤 경우에도 패킷 크기를 캡슐화할 수 있도록 어떻게 해야 합니까? 네 가지 주요 솔루션은 다음과 같습니다\(섹션 3에서 자세히 설명\).

1. 너무 큰 캡슐화된 패킷을 모두 조각화하여 경로에 맞추고 터널 끝점에서 다시 조립합니다.

2. 경로 MTU 검색\(PMTUD\)\[7\]\[8\]을 사용하여 더 작은 패킷을 보내기 위해 트래픽이 캡슐화되어야 하고 적합보다 큰 모든 소스에 신호를 보냅니다.

3. 특정 환경에서 캡슐화된 패킷이 네트워크의 모든 경로에 맞는지 확인합니다\(예: 캡슐화에 사용되는 백본에서 1500보다 큰 MTU를 사용\).

4. 너무 큰 원본 패킷을 조각화하여 해당 조각이 경로에 맞도록, 심지어 캡슐화한 다음 대상 노드에서 다시 조립합니다. 이 접근 방식은 특정 가정 하에서 IPv4에만 사용할 수 있습니다\(섹션 3.4 참조\).

또한 IPsec을 통한 GRE 또는 L2TP와 같은 여러 계층의 캡슐화를 실행하는 것도 일반적입니다. 네트워크에 중첩된 터널이 있는 경우 터널 끝점은 동일하거나 다를 수 있으며 내부 터널과 외부 터널 모두 서로 다른 MTU 처리 전략을 가질 수 있습니다. \~ 안에

특히, 신호는 가장 안쪽 터널 끝점의 수가 제한되어 있는 경우 외부 터널에 대한 확장 가능한 옵션일 수 있습니다.

터널링 패킷 크기 문제는 경로 MTU 검색이 하나의 소스 노드에만 신호를 보내면 되는 호스트 간 터널링이나 호스트 간 터널링에서 상대적으로 간단합니다. 문제는 이 메모의 초점인 라우터 대 라우터 및 특정 라우터 대 호스트 시나리오에서 훨씬 더 어렵습니다.

이 논의의 대부분은 경로에 더 낮은 MTU를 가진 링크가 존재하는 보다 일반적인 경우에 적용된다는 점은 주목할 가치가 있습니다. 이에 대한 구체적이고 널리 배포된 예는 고객의 액세스 링크에서 PPPoE\(PPP over Ethernet\) \[11\]를 사용하는 것입니다. 이러한 낮은 MTU 링크, 특히 PPPoE 링크는 일반적으로 조각화 및 재조립이 불가능할 수 있는 토폴로지\(예: 백본\)에 배포되지 않으므로 문제가 약간 더 쉬울 수 있습니다. 그러나 보다 일반적인 경우는 이 메모의 범위를 벗어나는 것으로 간주됩니다.

캡슐화에 사용할 가장 적합한 패킷 크기를 얻기 위해 터널 끝점에서 사용되는 메커니즘을 지정하고 구현하는 데에도 알려진 문제가 있습니다. 정적 값을 선택하면 결국 많은 조각화가 수행될 수 있습니다. 반면 PMTUD를 사용하는 경우 구현에서는 ICMP 패킷이 너무 큼 메시지를 기반으로 검색된 인터페이스 MTU를 업데이트하고 ICMP 패킷이 너무 큼 메시지를 캡슐화된 패킷의 소스로 다시 생성해야 합니다. 이는 또한 충분한 데이터가 ICMP 메시지에 피기백되었다고 가정합니다\(IPv4 헤더 다음에 필요한 64비트를 초과함\). 섹션 3.2에서 소스 신호를 보내기 위해 PMTUD를 사용하는 방법에 대해 간략하게 논의할 것입니다. 그러나 심층적인 사양 및 분석은 다른 곳\(예: \[4\] 및 \[2\]\)에 설명되어 있으며 이 메모의 범위를 벗어납니다.

섹션 2에는 문제 설명이 포함되어 있으며 섹션 3에서는 다양한 솔루션과 단점 및 장점을 설명하고 섹션 4에서는 결론을 제시합니다.

---
## **2.  Problem Statement**

이것이 정확히 왜 문제로 간주되는지 고려해 볼 가치가 있습니다.

솔루션 1을 사용하여 캡슐화된 결과 패킷을 조각화하고 터널 끝점에서 다시 조립하여 모든 패킷 크기 문제를 해결할 수 있습니다. 그러나 이는 섹션 3.1에 설명된 대로 적어도 세 가지 이유로 문제가 있는 것으로 간주됩니다.

따라서 가능하면 조각화 및 재조립을 피하는 것이 바람직합니다. 반면에 다른 솔루션은 그렇지 않을 수도 있습니다.

실용적입니다. 특히 라우터 간 또는 라우터 간 터널링에서 경로 MTU 검색은 매우 불리할 수 있습니다. 백본 라우터가 패킷을 보내려고 하는 모든 소스에 ICMP Packet Too Big 메시지를 보내는 경우를 고려하십시오. 그것을 통해. 캡슐화 전 조각화는 IPv6에서도 사용할 수 없으며 DF\(조각화 안 함\) 비트가 설정된 경우에도 사용할 수 없습니다\(자세한 내용은 섹션 3.4 참조\). 캡슐화가 항상 가능하도록 충분히 높은 MTU를 보장하는 것은 물론 유효한 접근 방식이지만 신중한 운영 계획이 필요하며 구현자에게는 실행 가능한 가정이 아닐 수도 있습니다.

이는 이 문제에 대한 사소한 해결책이 없다는 것을 의미하며, 이 메모에서 수행된 것처럼 절충점을 고려하기 위해 추가 조사가 필요합니다.

---
## **3.  Description of Solutions**

이 섹션에서는 잠재적인 솔루션을 좀 더 자세히 설명합니다.

---
### **3.1.  Fragmentation and Reassembly by the Tunnel Endpoints**

터널링 패킷 크기 문제에 대한 가장 간단해 보이는 해결책은 캡슐화기에 의한 외부 패킷의 조각화와 캡슐화 해제기에 의한 재조립입니다. 그러나 이는 적어도 다음 세 가지 이유로 인해 매우 문제가 됩니다.

o 조각화로 인해 오버헤드가 발생합니다. 모든 조각에는 IP 헤더\(20 또는 40바이트\)가 필요하며 IPv6의 경우 조각 헤더에 추가로 8바이트가 필요합니다.

o 조각화 및 재조립에는 계산이 필요합니다. 데이터그램을 조각으로 분할하는 것은 중요한 절차이며 재조립도 마찬가지입니다. 예를 들어, 소프트웨어 라우터 전달 구현은 이러한 작업을 회선 속도로 수행하지 못할 수도 있습니다.

o 재조립 시 일반적으로 모든 정보\(즉, 모든 조각\)를 사용할 수 없습니다. 재조립할 첫 번째 조각이 도착하면 재조립된 데이터그램의 전체 길이를 그 당시에 알 수 없기 때문에 가능한 최대 크기의 버퍼를 할당해야 할 수도 있습니다. 또한 조각이 손실되거나 재정렬되거나 지연될 수 있으므로 리어셈블리 엔진은 일정 시간\(예: 60초\[9\]\) 부분 패킷을 대기해야 합니다. 예를 들어 10Gbit/s 속도의 회선 속도로 이 작업을 수행해야 하는 경우 재조립에 필요한 버퍼 길이가 엄청날 수 있습니다.

라우터 간 터널링을 조사할 때 세 번째 문제가 최악일 가능성이 높습니다. 확실히 하드웨어 계산 및 구현 요구 사항도 중요하지만 결국 그렇게 어려운 것은 아니며 추가 오버헤드로 인해 백본에서 낭비되는 링크 용량도 큰 문제가 아닐 수 있습니다.

그러나 IPv4 식별 헤더 길이는 16비트\(IPv6의 32비트에 비해\)에 불과하며 두 IP 주소 간에 더 많은 수의 패킷이 터널링되는 경우 ID가 래핑되어 데이터 연결 오류가 발생할 가능성이 매우 높습니다. 관련되지 않은 두 패킷의 데이터를 잘못 결합하는 이러한 재조립으로 인해 데이터 무결성이 발생하고 잠재적으로 기밀 유지 위반이 발생합니다. 이 문제는 \[12\]에 자세히 설명되어 있습니다.

캡슐화 헤더에 DF 비트가 설정된 IPv6 및 IPv4를 사용하면 터널 끝점에서 터널 MTU를 최적화하고 네트워크 기반 재조립을 최소화할 수 있습니다. 이는 또한 터널 경로에서 캡슐화된 패킷의 조각화를 방지합니다. IPv4 캡슐화 헤더에 DF 비트가 설정되지 않은 경우 터널 끝점은 상당한 양의 조각화 및 재조립을 수행해야 하며 PMTUD 사용은 최소화됩니다.

부록 A에서 설명한 것처럼 터널의 MTU는 패킷의 조각화 및 재조립이 필요한 요소이기도 합니다. 터널 MTU가 "무한"이거나 물리적 인터페이스 MTU와 동일한 경우 최악의 경우가 발생합니다.

따라서 재조립이 충분히 안정적으로 작동할 수 있다면 이는 허용 가능한 대체 솔루션 중 하나이지만 IPv6에만 해당됩니다.

---
### **3.2.  Signalling the Lower MTU to the Sources**

또 다른 접근 방식은 Path MTU Discovery\(또는 잠재적으로 미래 파생물\[13\]\)와 같은 기술을 사용하여 네트워크에서 패킷이 캡슐화될 소스에 신호를 보내 캡슐화할 수 있도록 더 작은 패킷을 보내는 것입니다. 특히, 라우터에서 수행되면 여기에는 두 가지 분리 가능한 기능이 포함됩니다.

ㅏ. 전달 동작: 패킷을 전달할 때 IPv4 전용 DF 비트가 설정된 경우 송신 링크의 MTU가 너무 작은 경우 라우터는 ICMP 패킷이 너무 큼 메시지를 소스에 보냅니다.

비. 라우터의 "호스트" 동작: 라우터가 터널과 관련된 ICMP Packet Too Big 메시지를 수신하면 \(1\) 터널 MTU를 조정하고 \(2\) ICMP Packet Too Big 메시지를 캡슐화된 패킷의 소스 주소로 보냅니다. \(2\) 즉시 수행하거나 다음 패킷이 ICMP를 트리거할 때까지 기다리면서 수행할 수 있습니다. 전자는 MTU 변경으로 인한 패킷 손실을 최소화합니다.

이는 터널의 MTU 크기가 64KB가 아닌 적절한 크기인 경우에만 작동합니다. 자세한 내용은 부록 A를 참조하세요.

이 접근 방식은 PMTUD가 작동한다고 가정합니다. 현재 IPv6에서 작동하고 있으며 작동에 중요하지만 IPv4에서는 PMTUD가 모든 ICMP 패킷을 부적절하게 삭제하도록 구성된 방화벽 및 기타 상자 등으로 인해 신뢰성이 떨어진다는 충분한 증거가 있습니다\[14\]. PMTUD를 작동하지 않게 만드는 소프트웨어 버그.

또한 네트워크의 신호가 매우 바람직하지 않은 두 가지 시나리오가 있습니다. 첫 번째는 매우 많은 수의 소스에 이 정보를 신호로 보내야 하는 네트워크의 눈에 띄는 위치에서 캡슐화가 수행되는 경우입니다\(PMTUD 상태를 유지하는 기간에 따라 여러 번까지 가능\). 두 번째는 수동적 모니터링 목적\(네트워크 관리, 합법적인 차단 등\)을 위해 캡슐화가 수행되는 경우입니다. 트래픽이 캡슐화되는 소스가 이러한 상황을 인식하지 못하는 것이 중요한 경우입니다.

조각화를 방지하려는 경우 IPv4는 두 가지 대안 중 하나를 요구합니다\[1\]. 내부 패킷의 DF 비트를 캡슐화 헤더로 복사하거나 항상 외부 헤더의 DF 비트를 설정합니다. PMTUD가 즉시 수렴되도록 강제하기 때문에 특히 통제된 환경에서는 후자가 더 좋습니다.

특정 시나리오에서만 TCP와 함께 작동하는 관련 기술을 "MSS 클램핑"이라고 합니다. 이 기술 또는 오히려 "해킹"을 사용하면 TCP 패킷의 최대 세그먼트 크기\(MSS\)가 터널 끝점에 의해 줄어들어 TCP 연결이 자동으로 사용 가능한 최대 패킷 크기로 제한됩니다. 분명히 이는 MSS가 없는 UDP 또는 기타 프로토콜에서는 작동하지 않습니다. 이 접근 방식은 가장 적합하며 PPPoE와 함께 사용되지만 다른 방법으로도 적용될 수 있습니다. 또한 이 접근 방식에서는 모든 트래픽이 MSS 클램핑을 수행하는 터널 끝점을 통과한다고 가정합니다. 이는 단일 홈 액세스 링크의 경우 사소한 일이지만 그렇지 않으면 문제가 될 수 있습니다.

PMTUD에 대한 새로운 접근 방식이 진행 중이지만\[13\], 이것이 문제를 해결할지는 불확실합니다. 적어도 수동적 모니터링 요구 사항은 아닙니다.

---
### **3.3.  Encapsulate Only When There is Free MTU**

세 번째 접근 방식은 캡슐화 및 캡슐화 해제가 수행되는 환경에 따른 운영 방식입니다. 즉, ISP가 백본에 터널링을 배포하는 경우 높은 MTU를 지원하는 링크로만 구성됩니다.

\(예: 기가비트 이더넷 또는 SDH/SONET\) 모든 고객과 동료의 MTU는 더 낮습니다\(예: 1500 또는 백본 MTU에서 캡슐화 오버헤드를 뺀 값\). 이는 패킷이 없음을 의미합니다\(캡슐화 오버헤드가 추가됨\). "백본 MTU"보다 더 큰 MTU를 가지며 캡슐화된 모든 패킷은 항상 백본 링크에서 MTU 방식으로 맞습니다.

이 접근 방식은 배포 시나리오를 매우 가정한 것입니다. 예를 들어, 더 이상 유지되지 않는 경우 다른 ISP와의 터널을 구축하는 것이 바람직할 수 있습니다. 또는 터널링 요구 사항을 충족하기 위해 더 높은 MTU를 지원할 수 없는 링크가 네트워크에 있을 수 있습니다. 또는 터널이 고객과 ISP 사이에 직접 설정될 수 있으며, 이 경우 조각화가 발생하고 터널링된 조각이 ISP에서 종료되므로 ISP 장비의 재조립 기능이 필요합니다.

다시 말하면, 이 접근 방식은 예를 들어 ISP를 전송하는 것이 아니라 특정 종류의 ISP 자체 네트워크의 일부 내부에서 터널링이 수행되는 경우에만 고려할 수 있습니다.

또 다른 관련 접근 방식은 소스가 모든 물리적 MTU에 맞는 충분히 낮은 MTU만 사용하도록 하는 것입니다. 예를 들어 IPv6은 최소 MTU를 1280바이트로 지정합니다. 예를 들어 트래픽이 캡슐화되는 모든 소스가 이를 최대 패킷 크기로 사용하는 경우 네트워크에는 캡슐화를 위한 여유 MTU가 항상 충분할 것입니다. 그러나 오늘날에는 그렇지 않으며 이러한 접근 방식이 일반적으로 작동할 수 있다고 가정하는 것은 완전히 비현실적입니다.

IPv6 최소 MTU는 1280바이트\[10\]이지만 터널 구현에서 조각화 및 재조립을 구현해야 하는 시나리오가 있다는 점을 기억할 가치가 있습니다\[3\]. 예를 들어 물리적 터널 위에 IPv6-in-IPv6 터널이 있는 경우 1280바이트의 MTU와 인터페이스하거나 IPv6 터널링의 두 레이어가 있는 경우. 이는 IPv6가 터널링되는 상위 링크의 MTU\(예: 40바이트\)가 1280바이트보다 다소 큰지 확인해야만 피할 수 있습니다. 이 결론은 일반화될 수 있습니다. IP는 IP 위에서 터널링될 수 있기 때문에 단일 최소 또는 최대 MTU를 찾을 수 없으므로 소스에 대한 조각화 또는 신호가 필요하지 않습니다.

전체적으로 특정 운영 환경에서는 배포 선택을 통해 문제를 방지하거나 소스에서 사용하는 MTU를 제한하는 것이 가능할 수 있지만 이는 아마도 장비 공급업체에게 충분히 좋은 일반적인 솔루션은 아닐 것입니다. 다른 솔루션도 제공되어야 합니다.

---
### **3.4.  Fragmentation of the Inner Packet**

마지막 가능성은 캡슐화된 패킷이 터널의 경로 MTU\(PMTUD를 사용하여 발견됨\)에 맞도록 캡슐화하기 전에 내부 패킷을 조각화하는 것입니다. 그러나 IPv4만이 이러한 "진행 중" 조각화를 지원한다는 점에 유의해야 합니다. 또한 Don't Fragment 비트가 설정된 패킷에는 허용되지 않습니다. IPv6을 완전히 무시할 수 있더라도 너무 많은 IPv4 호스트 스택이 DF 비트 세트로 패킷을 전송하므로 이것이 불가능해 보입니다.

그러나 다음과 같은 표준을 위반하는 기존 구현이 있습니다.

```text
   o  discard too big packets with the DF bit not set instead of
      fragmenting them (this is rare);
```

o 전체 또는 지정된 인터페이스에 대해 DF 비트를 완전히 무시합니다. 또는

o 구성된 인터페이스의 출구에서 캡슐화하기 전에 DF 비트를 지웁니다. 이는 일반적으로 너무 큰 패킷뿐만 아니라 모든 트래픽에 대해 수행됩니다\(이를 구성하는 것이 일반적임\).

이는 비준수 동작이지만 특히 엄격하게 제어되는 특정 수동 모니터링 시나리오에서 확실히 용도가 있으며 PMTUD 문제를 해결하기 위해 보다 일반적인 적용 가능성도 있습니다.

DF 비트를 지우면 터널 너머의 경로에 대한 보낸 사람의 PMTUD가 효과적으로 비활성화됩니다. 이로 인해 나중에 네트워크에서 조각화가 발생할 수 있지만 패킷이 캡슐화되기 전에 이미 조각화되었으므로 나중에 이 조각화가 문제를 크게 악화시키지는 않습니다.

이는 \(일부에서\) 구현되고 원하는 동작이므로 PMTUD 기능\(예:\)에 대한 전체 영향을 분석해야 하며 조각화 관련 IPv4 비트의 사용을 재평가해야 합니다.

요약하면, 이 접근 방식은 PMTUD에 문제를 일으킬 가능성이 있는 IPv4 문제에 대한 비교적 쉬운 수정을 제공합니다. 이는 IPv6에서는 작동하지 않으므로 일반적인 솔루션으로 간주할 수 없습니다.

---
## **4.  Conclusions**

터널 끝점에 의한 조각화 및 재조립은 문제에 대한 명확하고 간단한 해결책이지만, 패킷이 손실될 때 하드웨어 재조립은 극복할 수 없는 심각한 구현 문제에 직면할 수 있습니다. 이 접근 방식은 특히 조각 식별 필드 래핑 문제로 인해 높은 데이터 속도를 갖는 IPv4의 경우 실현 가능하지 않은 것 같습니다\[12\]. 데이터 속도가 IPv4의 경우 MB/s 정도이고 IPv6의 경우 수십 GB/s 정도인 경우 지속적인 래핑이 발생할 수 있습니다. 그러나 이러한 재조립 접근 방식은 아마도 수동 모니터링 애플리케이션에는 문제가 되지 않을 것입니다.

적어도 현재로서는 특히 IPv4의 경우 PMTUD 기술은 백본에서 사용하기에는 너무 불안정하거나 확장성이 없는 것으로 보입니다. 향후 솔루션이 이 측면에서 더 잘 작동할 수 있는지 여부는 공개된 질문입니다.

일부 환경에서는 캡슐화된 패킷이 통과하는 네트워크에서 더 높은 MTU를 유지하여 조각화가 필요하지 않도록 보장하는 문제에 대한 운영 접근 방식으로 충분하다는 것이 분명합니다. 그러나 이것은 일반적으로 충분하지 않으며, 운영자의 배포에 대해 가정을 할 수 없는 공급업체의 경우에는 충분하지 않습니다.

내부 패킷의 조각화는 IPv4에서만 가능하며 나쁜 부작용\(예: PMTUD의 경우\)이 발생할 수 있는 표준 비호환 동작이 채택되는 경우에만 충분합니다. 대안이 있는 경우에는 사용해서는 안 됩니다. 외부 패킷의 단편화는 수동 모니터링에 더 나은 옵션인 것 같습니다.

그러나 네트워크에서 재조립을 피해야 하는 경우 기본적으로 두 가지 가능성이 있습니다.

1. IPv6의 경우 ICMP 신호 또는 작동 방법을 사용합니다.

2. IPv4의 경우 DF 비트가 설정되지 않은 패킷은

- 캡슐화 전에 조각화됩니다\(캡슐화 헤더는 DF 비트 세트를 갖습니다\). DF 비트가 설정된 패킷은 DF 비트를 지워야 합니다\(비규격임에도 불구하고\). 이는 또한 \(신뢰할 수 없는\) 인터넷 전체 PMTUD의 필요성을 최소화합니다.

명시적으로 언급해야 할 흥미로운 점은 터널링이 고속 백본에서 수행될 때 일반적으로 환경에 대한 가정을 할 수 있다는 것입니다. 그러나 그러한 네트워크에서 재조립이 수행되지 않는 경우 소프트웨어나 더 낮은 요구 사항으로 재조립이 수행될 수 있습니다.

PMTUD를 사용하거나 수동 모니터링을 위한 별도의 접근 방식을 사용하여 구현하므로 이는 실제 문제가 아닐 수도 있습니다.

결과적으로 이 시점에서 중요한 질문은 1\) 터널링을 배포하는 고속 네트워크에서 더 높은 MTU를 가정할 수 있는지 여부, 2\) "저속" 네트워크가 소프트웨어 기반 재조립에 대처할 수 있는지 여부입니다. 성능이 떨어지는 하드웨어 기반 재조립 또는 기타 해결 방법. 중요한 향후 작업은 DF 비트에 대해 관찰된 비준수 동작을 분석하여 예상치 못한 단점이 있는지 확인하는 것입니다.

---
## **5.  Security Considerations**

이 문서에서는 패킷 크기 및 네트워크 내 터널링과 관련된 다양한 문제를 설명합니다. 이는 자체적으로 보안을 고려하지 않습니다.

그러나 다양한 솔루션에는 공격에 더 취약해질 수 있는 특성이 있을 수 있습니다. 예를 들어, 라우터 기반 조각 재조립은 공격자가 조각을 모두 보내지 않고 충분한 수의 조각을 보내는 경우 쉽게 버퍼 메모리 고갈\(재조립\)로 이어질 수 있습니다. , 재조립이 시간 초과될 때까지 중단되도록 합니다. 이러한 공격과 기타 조각 공격\(예: \[15\]\)은 이미 방화벽 및 호스트 스택 등에 대해 사용되었으므로 구현 시 이를 고려해야 합니다.

내부 또는 외부 패킷의 단편화로 인한 암호화 비용\(소프트웨어에서 수행되는 경우 일반적으로 재조립보다 더 중요함\)을 고려해 볼 가치가 있습니다. 외부 조각이 누락되면 아직 암호화 작업이 수행되지 않은 것입니다. 내부 조각이 누락되면 암호화 작업이 이미 수행된 것입니다. 따라서 이러한 접근 방식 중 어느 것이 더 바람직한지는 암호화 또는 재조립이 이미 하드웨어에 제공되어 있는지 여부에 따라 달라집니다. 고속 라우터의 경우 적어도 상대적으로 무거운 암호화를 수행하는 경우 하드웨어 지원이 이미 필요하다고 가정할 수 있어야 합니다.

PMTUD\(및 결과적으로 ICMP\)를 사용하는 솔루션은 ICMP를 사용하는 공격도 고려해야 합니다. 특히, 공격자는 처리량을 줄이기 위해 및/또는 조각화/재조립 서비스 거부 공격으로 매우 낮은 MTU를 나타내는 ICMP 패킷이 너무 큼 메시지를 보낼 수 있습니다. 이 공격은 \[16\]의 TCP 맥락에서 설명되었습니다.

---
## **6.  Acknowledgements**

주제가 새로운 것은 아니지만 L2TP 조각화 문제에 관해 W. Mark Townsley와의 최근 토론으로 인해 저자는 자리에 앉아 일반적인 문제를 작성하게 되었습니다. Michael Richardson과 Mika Joutsenvirta는 첫 번째 버전에 대한 유용한 피드백을 제공했습니다. NANOG 목록에서 의견을 구할 때 Carsten Bormann, Kevin Miller, Warren Kumari, Iljitsch van Beijnum, Alok Dube 및 Stephen J. Wilcox가 유용한 피드백을 제공했습니다. 나중에 Carlos Pignataro가 훌륭한 의견을 제공하여 문서 개선에 도움을 주었습니다. Joe Touch도 메모에 대한 입력을 제공했습니다.

---
## **7.  References**
---
### **7.1.  Normative References**

\[1\] Perkins, C., "IP 내 IP 캡슐화", RFC 2003, 1996년 10월.

\[2\] Nordmark, E. 및 R. Gilligan, "IPv6 호스트 및 라우터에 대한 기본 전환 메커니즘", RFC 4213, 2005년 10월.

\[3\] Conta, A. 및 S. Deering, "IPv6 사양의 일반 패킷 터널링", RFC 2473, 1998년 12월.

\[4\] Farinacci, D., Li, T., Hanks, S., Meyer, D. 및 P. Traina, "GRE\(일반 라우팅 캡슐화\)", RFC 2784, 2000년 3월.

\[5\] Lau, J., Townsley, M. 및 I. Goyret, "레이어 2 터널링 프로토콜 - 버전 3\(L2TPv3\)", RFC 3931, 2005년 3월.

\[6\] Kent, S. 및 K. Seo, "인터넷 프로토콜을 위한 보안 아키텍처", RFC 4301, 2005년 12월.

\[7\] Mogul, J. 및 S. Deering, "경로 MTU 검색", RFC 1191, 1990년 11월.

\[8\] McCann, J., Deering, S. 및 J. Mogul, "IP 버전 6에 대한 경로 MTU 검색", RFC 1981, 1996년 8월.

\[9\] Braden, R., "인터넷 호스트 요구 사항 - 통신 계층", STD 3, RFC 1122, 1989년 10월.

\[10\] Deering, S. 및 R. Hinden, "인터넷 프로토콜, 버전 6\(IPv6\) 사양", RFC 2460, 1998년 12월.

---
### **7.2.  Informative References**

\[11\] Mamakos, L., Lidl, K., Evarts, J., Carrel, D., Simone, D. 및 R. Wheeler, "PPPoE\(이더넷을 통한 PPP 전송 방법\)", RFC 2516, 2월 1999.

\[12\] Mathis, M., "매우 유해한 것으로 간주되는 조각화", 진행 중인 작업, 2004년 7월.

\[13\] Mathis, M. 및 J. Heffner, "경로 MTU 검색", 진행 중인 작업, 2006년 3월.

```text
   [14]  Medina, A., Allman, M., and S. Floyd, "Measuring the Evolution
         of Transport Protocols in the Internet", Computer
         Communications Review, Apr 2005, <http://www.icir.org/tbit/>.
```

\[15\] Miller, I., "작은 조각 공격의 변종으로부터 보호\(RFC 1858\)", RFC 3128, 2001년 6월.

\[16\] Gont, F., "TCP에 대한 ICMP 공격", 진행 중인 작업, 2006년 2월.

---
# **Appendix A.  MTU of the Tunnel**

다양한 터널링 메커니즘은 터널 링크를 다양한 종류의 MTU 값을 갖는 것으로 처리할 수 있습니다. 일부는 다른 인터페이스와 동일한 기본 MTU를 사용할 수 있습니다. 일부는 기본 MTU에서 예상 IP 오버헤드\(예: 20, 28 또는 40바이트\)를 뺀 값을 사용할 수도 있습니다. 일부는 터널을 "무한 MTU"\(예: 64KB\)로 취급할 수도 있습니다.

\[2\]에서 설명했듯이 무한한 MTU를 갖는 것, 즉 항상 외부 패킷을 조각화하고\(내부 패킷은 조각화하지 않음\) 터널 경로에 대해 PMTUD를 수행하지 않는 것은 특히 호스트-라우터 시나리오에서 매우 나쁜 생각입니다. \(노드가 이것이 호스트 간 터널이라고 확신하는 경우 적절한 크기의 패킷을 보내는 것보다 조각화 및 재조립이 더 효율적이라면 더 큰 MTU가 합리적일 수 있다고 주장할 수 있지만 이는 무리인 것처럼 보입니다. \)

---
# **Author's Address**

```text
   Pekka Savola
   CSC/FUNET
   Espoo
   Finland

   EMail: psavola@funet.fi
```

---
# **Full Copyright Statement**

Copyright \(C\) The Internet Society \(2006\).

이 문서는 BCP 78에 포함된 권리, 라이선스 및 제한 사항의 적용을 받으며 여기에 명시된 경우를 제외하고 작성자는 모든 권리를 보유합니다.

이 문서 및 여기에 포함된 정보는 "있는 그대로" 제공되며 기여자, 기여자가 대표하거나 후원하는 조직\(있는 경우\), 인터넷 사회 및 인터넷 공학 태스크포스는 모든 명시적 또는 묵시적 보증을 부인합니다. 여기에서 구성은 상품성 또는 특정 목적에의 적합성에 대한 권리 또는 묵시적 보증을 침해하지 않습니다.

---
# **Intellectual Property**

IETF는 이 문서에 설명된 기술의 구현 또는 사용과 관련이 있다고 주장할 수 있는 지적 재산권 또는 기타 권리의 유효성 또는 범위 또는 그러한 권리에 따른 라이센스의 범위에 대해 어떠한 입장도 취하지 않습니다. 는 가능하다; 또한 그러한 권리를 식별하기 위해 독립적인 노력을 기울였다는 것을 나타내지 않습니다. RFC 문서의 권리와 관련된 절차에 대한 정보는 BCP 78 및 BCP 79에서 찾을 수 있습니다.

IETF 사무국에 제출된 IPR 공개 사본 및 사용 가능한 라이선스에 대한 보증 또는 이 사양의 구현자 또는 사용자가 이러한 독점권 사용에 대한 일반 라이선스 또는 허가를 얻으려는 시도의 결과를 얻을 수 있습니다. http://www.ietf.org/ipr의 IETF 온라인 IPR 저장소에서.

IETF는 이 표준을 구현하는 데 필요할 수 있는 기술을 포함할 수 있는 저작권, 특허 또는 특허 출원 또는 기타 소유권에 관심을 갖도록 이해 당사자를 초대합니다. 정보를 IETF\(ietf-ipr@ietf.org\)로 보내주십시오.

---
# **Acknowledgement**

RFC 편집기 기능에 대한 자금은 IETF 행정 지원 활동\(IASA\)에서 제공합니다.