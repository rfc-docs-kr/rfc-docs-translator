

```text
Internet Engineering Task Force (IETF)                         V. Paxson
Request for Comments: 6298                              ICSI/UC Berkeley
Obsoletes: 2988                                                M. Allman
Updates: 1122                                                       ICSI
Category: Standards Track                                         J. Chu
ISSN: 2070-1721                                                   Google
                                                              M. Sargent
                                                                    CWRU
                                                               June 2011

                  Computing TCP's Retransmission Timer
```

---
# **Abstract**

이 문서에서는 TCP\(전송 제어 프로토콜\) 발신자가 재전송 타이머를 계산하고 관리하는 데 사용해야 하는 표준 알고리즘을 정의합니다. RFC 1122의 섹션 4.2.3.1에 대한 논의를 확장하고 알고리즘 지원 요구 사항을 SHOULD에서 MUST로 업그레이드합니다. 이 문서는 RFC 2988을 폐기합니다.\(MUST\)

---
# **Status of This Memo**

이것은 인터넷 표준 추적 문서입니다.

이 문서는 IETF\(Internet Engineering Task Force\)의 제품입니다. 이는 IETF 커뮤니티의 합의를 나타냅니다. 공개 검토를 받았으며 IESG\(Internet Engineering Steering Group\)의 출판 승인을 받았습니다. 인터넷 표준에 대한 자세한 내용은 RFC 5741의 섹션 2에서 확인할 수 있습니다.

이 문서의 현재 상태, 정오표, 피드백 제공 방법에 대한 정보는 http://www.rfc-editor.org/info/rfc6298에서 얻을 수 있습니다.

---
# **Copyright Notice**

Copyright \(c\) 2011 IETF Trust 및 문서 작성자로 확인된 사람. 판권 소유.

이 문서는 이 문서의 발행일에 유효한 BCP 78 및 IETF 문서에 관한 IETF 트러스트의 법적 조항\(http://trustee.ietf.org/license-info\)의 적용을 받습니다. 이 문서와 관련된 귀하의 권리 및 제한 사항을 설명하므로 이 문서를 주의 깊게 검토하십시오. 이 문서에서 추출한 코드 구성 요소는 Trust Legal Provisions의 섹션 4.e에 설명된 대로 Simplified BSD License 텍스트를 포함해야 하며 Simplified BSD License에 설명된 대로 보증 없이 제공됩니다.

---
## **1.  Introduction**

전송 제어 프로토콜\(TCP\)\[Pos81\]은 재전송 타이머를 사용하여 원격 데이터 수신기의 피드백이 없을 때 데이터 전달을 보장합니다. 이 타이머의 지속 시간을 RTO\(재전송 시간 초과\)라고 합니다. RFC 1122 \[Bra89\]는 RTO가 \[Jac88\]에 설명된 대로 계산되어야 한다고 명시합니다.

이 문서는 RTO 설정을 위한 알고리즘을 체계화합니다. 또한 이 문서에서는 RFC 1122 섹션 4.2.3.1의 논의를 확장하고 알고리즘 지원 요구 사항을 SHOULD에서 MUST로 업그레이드합니다. RFC 5681 \[APB09\]에는 RTO가 만료되고 재전송이 전송된 후 전송을 시작하기 위해 TCP가 사용하는 알고리즘이 간략하게 설명되어 있습니다. 이 문서는 RFC 5681 \[APB09\]에 설명된 동작을 변경하지 않습니다.\(MUST\)

어떤 상황에서는 TCP 발신자가 이 문서에 설명된 알고리즘이 허용하는 것보다 더 보수적인 것이 유리할 수 있습니다. 그러나 TCP는 다음 알고리즘이 허용하는 것보다 더 공격적이어서는 안 됩니다. 이 문서는 RFC 2988 \[PA00\]을 폐기합니다.\(MUST NOT\)

이 문서의 핵심 단어 "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY" 및 "OPTIONAL"은 다음과 같습니다. \[Bra97\]에 설명된 대로 해석됩니다.\(MUST NOT\)

---
## **2.  The Basic Algorithm**

현재 RTO를 계산하기 위해 TCP 송신자는 SRTT\(평활 왕복 시간\) 및 RTTVAR\(왕복 시간 변화\)의 두 가지 상태 변수를 유지합니다. 또한, 우리는 G초의 클록 세분성을 가정합니다.

SRTT, RTTVAR 및 RTO 계산을 관리하는 규칙은 다음과 같습니다.

\(2.1\) 발신자와 수신자 사이에 전송된 세그먼트에 대해 RTT\(왕복 시간\) 측정이 이루어질 때까지 발신자는 RTO를 <- 1초로 설정해야 합니다. 단, \(5.5\)에서 설명한 반복 재전송에 대한 "백오프"는 여전히 적용됩니다.\(SHOULD\)

- 이 문서의 이전 버전에서는 초기 RTO 3초를 사용했습니다\[PA00\]. TCP 구현은 여전히 ​​이 값\(또는 1초를 초과하는 다른 값\)을 사용할 수 있습니다. 초기 RTO 하한의 이러한 변경 사항은 부록 A에서 자세히 설명합니다.\(MAY\)

\(2.2\) 첫 번째 RTT 측정 R이 수행되면 호스트는 반드시 설정해야 합니다.\(MUST\)

```text
            SRTT <- R
            RTTVAR <- R/2
            RTO <- SRTT + max (G, K*RTTVAR)
```

- 여기서 K = 4입니다.

\(2.3\) 후속 RTT 측정 R'이 수행되면 호스트는 반드시 설정해야 합니다.\(MUST\)

```text
            RTTVAR <- (1 - beta) * RTTVAR + beta * |SRTT - R'|
            SRTT <- (1 - alpha) * SRTT + alpha * R'
```

- RTTVAR 업데이트에 사용된 SRTT의 값은 두 번째 할당을 사용하여 SRTT 자체를 업데이트하기 전의 값입니다. 즉, RTTVAR 및 SRTT 업데이트는 위의 순서로 계산되어야 합니다.\(MUST\)

- 위의 내용은 alpha=1/8 및 beta=1/4\(\[JK88\]에서 제안된 대로\)를 사용하여 계산되어야 합니다.\(SHOULD\)

```text
         After the computation, a host MUST update
         RTO <- SRTT + max (G, K*RTTVAR)
```

\(2.4\) RTO가 계산될 때마다 1초 미만인 경우 RTO는 1초로 반올림되어야 합니다.\(SHOULD\)

- 전통적으로 TCP 구현은 RTT를 측정하고 RTO에 큰 최소값을 적용하는 RTO를 트리거하기 위해 대략적인 클록을 사용합니다. 연구에 따르면 TCP를 보수적으로 유지하고 가짜 재전송을 방지하려면 큰 최소 RTO가 필요하다고 합니다\[AP99\]. 따라서 이 사양에서는 보수적인 접근 방식으로 큰 최소 RTO가 필요하지만,

- 동시에 미래의 어느 시점에서는 더 작은 최소 RTO가 허용 가능하거나 우수하다는 연구 결과가 나올 수 있음을 인정합니다.

\(2.5\) 최소 60초인 경우 RTO에 최대값을 설정할 수 있습니다.\(MAY\)

---
## **3.  Taking RTT Samples**

TCP는 RTT 샘플을 채취하기 위해 Karn의 알고리즘 \[KP87\]을 사용해야 합니다. 즉, RTT 샘플은 재전송된 세그먼트를 사용하여 생성되어서는 안 됩니다\(따라서 응답이 패킷의 첫 번째 인스턴스에 대한 것인지 아니면 이후 인스턴스에 대한 것인지가 모호합니다\). TCP가 재전송된 세그먼트에서 RTT 샘플을 안전하게 가져올 수 있는 유일한 경우는 TCP 타임스탬프 옵션 \[JBB92\]이 사용되는 경우입니다. 타임스탬프 옵션은 승인을 트리거한 데이터 세그먼트의 인스턴스에 대한 모호성을 제거하기 때문입니다.\(MUST, MUST NOT\)

전통적으로 TCP 구현에서는 한 번에 하나의 RTT 측정을 수행했습니다\(일반적으로 RTT당 한 번\). 그러나 타임스탬프 옵션을 사용하면 각 ACK가 RTT 샘플로 사용될 수 있습니다. RFC 1323 \[JBB92\]에서는 큰 혼잡 창을 활용하는 TCP 연결이 추정된 RTT에서 앨리어싱 효과를 피하기 위해 데이터 창당 많은 RTT 샘플을 가져와야 한다고 제안합니다. TCP 구현은 RTT당 최소한 하나의 RTT 측정을 수행해야 합니다\(Karn의 알고리즘에 따라 불가능한 경우는 제외\).\(MUST\)

상당히 적당한 혼잡 창 크기의 경우, 연구에 따르면 각 세그먼트의 타이밍이 더 나은 RTT 추정기로 이어지지는 않습니다\[AP99\]. 또한 RTT당 여러 샘플을 채취하는 경우 섹션 2에 정의된 알파 및 베타가 부적절한 RTT 기록을 유지할 수 있습니다. 이러한 상수를 변경하는 방법은 현재 공개 연구 문제입니다.

---
## **4.  Clock Granularity**

RTT 측정 및 다양한 상태 변수를 계산하는 데 사용되는 클록 세분성 G에 대한 요구 사항은 없습니다. 그러나 RTO 계산의 K\*RTTVAR 항이 0인 경우 분산 항은 G초로 반올림되어야 합니다\(즉, 2.3단계에 제공된 방정식을 사용하십시오\).\(MUST\)

```text
       RTO <- SRTT + max (G, K*RTTVAR)
```

경험에 따르면 더 미세한 클럭 단위\(<= 100msec\)가 거친 단위보다 성능이 다소 더 나은 것으로 나타났습니다.

\[Jac88\]은 거친 세분성 타이머에서 더 나은 정밀도를 얻는 데 사용할 수 있는 몇 가지 영리한 트릭을 설명합니다. 이러한 변경 사항은 현재 TCP 구현에서 광범위하게 구현됩니다.

---
## **5.  Managing the RTO Timer**

구현에서는 세그먼트가 너무 일찍 재전송되지 않도록\(즉, 해당 세그먼트의 이전 전송 후 1 RTO 미만\) 재전송 타이머를 관리해야 합니다.\(MUST\)

다음은 재전송 타이머를 관리하기 위한 권장 알고리즘입니다.\(SHOULD\)

\(5.1\) 데이터가 포함된 패킷이 전송될 때마다\(재전송 포함\) 타이머가 실행 중이 아닌 경우 RTO 초\(RTO의 현재 값에 대해\) 후에 만료되도록 실행을 시작합니다.

\(5.2\) 미해결 데이터가 모두 확인되면 재전송 타이머를 끕니다.

\(5.3\) 새 데이터를 확인하는 ACK가 수신되면 재전송 타이머를 다시 시작하여 RTO 초\(RTO의 현재 값\) 후에 만료되도록 합니다.

재전송 타이머가 만료되면 다음을 수행하십시오.

\(5.4\) TCP 수신자가 승인하지 않은 가장 빠른 세그먼트를 재전송합니다.

\(5.5\) 호스트는 RTO <- RTO \* 2\("타이머 백오프"\)를 설정해야 합니다. 위의 \(2.5\)에서 논의된 최대값은 이 배가 연산의 상한을 제공하는 데 사용될 수 있습니다.\(MUST\)

\(5.6\) 재전송 타이머를 시작하여 RTO 초 후에 만료되도록 합니다\(5.5에 설명된 두 배의 작업 후 RTO 값에 대해\).

\(5.7\) 타이머가 SYN 세그먼트의 ACK를 기다리며 만료되고 TCP 구현이 3초 미만의 RTO를 사용하는 경우 데이터 전송이 시작될 때\(즉, 3방향 핸드셰이크 후\) RTO를 3초로 다시 초기화해야 합니다. 완료\).\(MUST\)

- 이는 이 문서 \[PA00\]의 이전 버전에서 변경된 사항을 나타내며 부록 A에서 설명합니다.

재전송 후 새로운 RTT 측정값이 획득되면\(새 데이터가 전송되고 승인된 경우에만 발생할 수 있음\) RTO 계산을 포함하여 섹션 2에 설명된 계산이 수행되며 이로 인해 RTO가 "붕괴"될 수 있습니다. 기하급수적 백오프\(규칙 5.5\)가 적용된 후 다시 다운됩니다.

현재 SRTT 및 RTTVAR이 이 상황에서 가짜일 가능성이 높으므로 TCP 구현은 타이머를 여러 번 백오프한 후 SRTT 및 RTTVAR을 지울 수 있습니다. SRTT 및 RTTVAR이 지워지면 \(2.3\)을 사용하는 대신 \(2.2\)에 따라 채취한 다음 RTT 샘플로 초기화해야 합니다.\(MAY\)

---
## **6.  Security Considerations**

이 문서에서는 TCP가 승인되지 않은 세그먼트를 재전송하기 전에 주어진 간격 동안 대기하도록 요구합니다. 공격자는 시간이 지정된 패킷의 대기 시간이나 승인 대기 시간에 지연을 추가하여 TCP 발신자가 큰 RTO 값을 계산하도록 할 수 있습니다. 그러나 패킷 대기 시간에 지연을 추가하는 기능은 패킷 손실을 유발하는 기능과 종종 일치하므로 단순히 패킷의 일부를 폐기하는 것보다 더 많은 피해를 입힐 수 있는 공격에서 공격자가 무엇을 얻을 수 있는지 파악하기 어렵습니다. TCP 연결의 패킷입니다.

인터넷은 네트워크 안정성을 유지하고 혼잡 붕괴를 피하기 위해 RTO 알고리즘\(RFC 5681에 설명된 알고리즘 포함\)의 올바른 구현에 상당 부분 의존합니다. 공격자는 수신자가 실제로 데이터를 수신하기 전에 세그먼트에 대한 승인을 위조하여 정체 상황에서 TCP 엔드포인트가 보다 공격적으로 응답하도록 하여 RTO를 안전하지 않은 값으로 낮출 수 있습니다. 그러나 그렇게 하려면 승인을 올바르게 스푸핑해야 하는데, 이는 공격자가 보낸 사람과 받는 사람 사이의 경로를 따라 트래픽을 모니터링할 수 없으면 어렵습니다. 또한 공격자가 보낸 사람의 RTO를 너무 작은 값에 도달하게 만들 수 있더라도 공격자는 이를 많은 공격에 활용할 수 없는 것으로 보입니다\(연결에 속한 패킷을 스푸핑할 수 있는 경우 발생할 수 있는 다른 피해와 비교\). , 전송 TCP는 실제 혼잡으로 인해 잘못 전송된 패킷이 손실되는 경우에도 여전히 타이머를 취소하기 때문입니다.

RFC 5681 \[APB09\]의 보안 고려 사항은 이 문서에도 적용됩니다.

---
## **7.  Changes from RFC 2988**

이 문서에서는 SYN 또는 SYN의 ACK가 손실되지 않는 한 초기 RTO를 이전 3초\[PA00\]에서 1초로 줄입니다. 이 경우 기본 RTO는 데이터 전송이 시작되기 전 3초로 되돌아갑니다.

---
## **8.  Acknowledgments**

이 메모에 설명된 RTO 알고리즘은 \[Jac88\]의 Van Jacobson에 의해 시작되었습니다.

초기 RTO를 3초에서 1초로 변경하도록 동기를 부여한 데이터의 대부분은 Robert Love, Andre Broido 및 Mike Belshe에게서 나왔습니다.

---
## **9.  References**
---
### **9.1.  Normative References**

\[APB09\] Allman, M., Paxson, V. 및 E. Blanton, "TCP 혼잡 제어", RFC 5681, 2009년 9월.

\[Bra89\] Braden, R., Ed., "인터넷 호스트 요구 사항 -

- 통신 계층", STD 3, RFC 1122, 1989년 10월.

\[Bra97\] Bradner, S., "RFC에서 표시하기 위해 사용되는 핵심 단어

- 요구 사항 수준", BCP 14, RFC 2119, 1997년 3월.

\[JBB92\] Jacobson, V., Braden, R. 및 D. Borman, "고성능을 위한 TCP 확장", RFC 1323, 1992년 5월.

```text
   [Pos81] Postel, J., "Transmission Control Protocol", STD 7, RFC 793,
           September 1981.
```

---
### **9.2.  Informative References**

\[AP99\] Allman, M. 및 V. Paxson, "종단 간 네트워크 경로 속성 추정에 대해", SIGCOMM 99.

\[Chu09\] Chu, J., "21세기를 위한 TCP 매개변수 튜닝", http://www.ietf.org/proceedings/75/slides/tcpm-1.pdf, 2009년 7월.

\[SLS09\] Schulman, A., Levin, D. 및 Spring, N., "CRAWDAD 데이터 세트 umd/sigcomm2008 \(v. 2009-03-02\)", http://crawdad.cs.dartmouth.edu/umd /sigcomm2008, 2009년 3월.

\[HKA04\] Henderson, T., Kotz, D. 및 Abyzov, I., "CRAWDAD 추적 dartmouth/campus/tcpdump/fall03 \(v. 2004-11-09\)", http://crawdad.cs.dartmouth. edu/dartmouth/campus/tcpdump/fall03, 2004년 11월.

\[Jac88\] Jacobson, V., "혼잡 방지 및 제어", 컴퓨터 통신 검토, vol. 18, 아니. 4, pp. 314-329, 1988년 8월.

\[JK88\] Jacobson, V. 및 M. Karels, "혼잡 방지 및 제어", ftp://ftp.ee.lbl.gov/papers/congavoid.ps.Z.

\[KP87\] Karn, P. 및 C. Partridge, "신뢰할 수 있는 전송 프로토콜의 왕복 시간 추정 개선", SIGCOMM 87.

\[PA00\] Paxson, V. 및 M. Allman, "TCP의 재전송 타이머 계산", RFC 2988, 2000년 11월.

---
# **Appendix A.  Rationale for Lowering the Initial RTO**

합리적인 초기 RTO를 선택하려면 두 가지 상충되는 고려 사항의 균형을 맞춰야 합니다.

1. 초기 RTO는 허위 재전송 및 이와 관련된 부정적인 성능 영향을 방지하기 위해 대부분의 종단간 경로를 포괄할 만큼 충분히 커야 합니다.

2. 초기 RTO는 RTT 샘플을 가져오기 전에 발생하는 패킷 손실을 적시에 복구할 수 있을 만큼 작아야 합니다.

전통적으로 TCP는 초기 RTO \[Bra89\] \[PA00\]로 3초를 사용해 왔습니다. 이 문서에서는 다음 근거를 사용하여 이 값을 1초로 낮추도록 요구합니다.

- 최신 네트워크는 초기 RTO가 3초로 정의된 당시의 최첨단 네트워크보다 훨씬 빠릅니다.

- 연구 결과 대규모 분석에서 관찰된 연결 중 97.5% 이상의 왕복 시간이 1초 미만인 것으로 나타났으며\[Chu09\], 1초가 위의 기준 1을 충족함을 시사합니다.

- 또한 연구에서는 3방향 핸드셰이크 내에서 약 2%의 재전송률이 관찰되었습니다. 이는 초기 RTO를 줄이는 것이 무시할 수 없는 연결 집합에 이점이 있음을 보여줍니다.

- 그러나 \[Chu09\]에서 연구된 연결 중 대략 2.5%는 RTT가 1초보다 길다. 이러한 연결의 경우 1초의 초기 RTO는 연결 설정 중\(필요 여부에 관계없이\) 재전송을 보장합니다.

이런 일이 발생하면 이 문서에서는 데이터 전송 단계를 초기 RTO 3초로 되돌릴 것을 요구합니다. 따라서 스퓨리어스 재전송의 의미는 미미합니다. \(1\) 추가 SYN이 네트워크로 전송되고 \(2\) RFC 5681 \[APB09\]에 따라 초기 혼잡 창은 1 세그먼트로 제한됩니다. \(2\)는 분명히 그러한 연결을 불리하게 만드는 반면, 이 문서는 최소한 연결이 짧은 시간 초과로 인해 지속적으로 문제가 발생하지 않도록 RTO를 재설정합니다. \(물론 RTT가 3초를 초과하면 연결에 여전히 문제가 발생합니다. 그러나 이는 TCP의 새로운 문제는 아닙니다.\)

또한 타임스탬프를 사용할 때 TCP는 가짜 재전송이 있는 경우에도 RTT 샘플을 가져올 수 있으므로 RTT가 1초를 초과할 때 올바른 RTT 추정치로의 수렴을 촉진합니다.

\[Chu09\]에서 제시된 결과에 대한 추가적인 확인으로, 서로 다른 시점에 네 가지 유리한 지점에서 수집된 클라이언트 행동의 패킷 추적을 분석했습니다.

```text
   Name       Dates            Pkts.   Cnns.  Clnts. Servs.
   --------------------------------------------------------
   LBL-1      Oct/05--Mar/06   292M    242K   228    74K
   LBL-2      Nov/09--Feb/10   1.1B    1.2M   1047   38K
   ICSI-1     Sep/11--18/07    137M    2.1M   193    486K
   ICSI-2     Sep/11--18/08    163M    1.9M   177    277K
   ICSI-3     Sep/14--21/09    334M    3.1M   170    253K
   ICSI-4     Sep/11--18/10    298M    5M     183    189K
   Dartmouth  Jan/4--21/04     1B      4M     3782   132K
   SIGCOMM    Aug/17--21/08    11.6M   133K   152    29K
```

"LBL" 데이터는 로렌스 버클리 국립 연구소에서, "ICSI" 데이터는 국제 컴퓨터 과학 연구소에서, "SIGCOMM" 데이터는 SIGCOMM 2008 참석자들에게 서비스를 제공한 무선 네트워크에서, "Dartmouth" 데이터는 Dartmouth College의 무선 네트워크에서 수집되었습니다. 후자의 두 데이터 세트는 CRAWDAD 데이터 저장소 \[HKA04\] \[SLS09\]에서 사용할 수 있습니다. 테이블에는 데이터 수집 날짜, 수집된 패킷 수, 관찰된 TCP 연결 수, 모니터링되는 로컬 클라이언트 수 및 연결된 원격 서버 수가 나열됩니다. 우리는 추적 유리한 지점 근처에서 시작된 연결만 고려합니다.

이러한 데이터 세트를 분석한 결과 재전송된 SYN의 보급률은 0.03%\(ICSI-4\)에서 대략 2%\(LBL-1 및 Dartmouth\) 사이인 것으로 나타났습니다.

그런 다음 데이터를 분석하여 초기 RTO를 1초로 가정할 경우 발생할 수 있는 추가 및 허위 재전송 횟수를 결정했습니다. 대부분의 데이터세트에서 허위 재전송 연결 비율은 0.1% 미만이었습니다. 그러나 Dartmouth 데이터 세트에서는 연결의 약 1.1%가 더 낮은 초기 RTO로 가짜 재전송을 보냈습니다. 이는 모니터링되는 네트워크가 무선이므로 RF 효과로 인한 추가 지연에 취약하기 때문이라고 생각합니다.

마지막으로, 초기 RTO를 줄여 손실된 SYN을 재전송하면 분명히 성능상의 이점이 있습니다. 데이터 세트 전체에서 SYN을 재전송하고 이 문서에 지정된 더 작은 초기 RTO를 사용하여 최소 10% 성능 향상을 실현하는 연결 비율은 43%\(LBL-1\)에서 87%\(ICSI-4\)입니다. 최소 50%의 성능 향상을 실현할 수 있는 연결 비율은 17%\(ICSI-1 및 SIGCOMM\)에서 73%\(ICSI-4\)입니다.

우리가 액세스할 수 있는 데이터를 통해 낮은 초기 RTO는 많은 연결에 유익하고 상대적으로 소수의 연결에는 해로울 가능성이 높다는 결론을 내렸습니다.

```text
   Authors' Addresses

   Vern Paxson
   ICSI/UC Berkeley
   1947 Center Street
   Suite 600
   Berkeley, CA 94704-1198

   Phone: 510-666-2882
   EMail: vern@icir.org
   http://www.icir.org/vern/

   Mark Allman
   ICSI
   1947 Center Street
   Suite 600
   Berkeley, CA 94704-1198

   Phone: 440-235-1792
   EMail: mallman@icir.org
   http://www.icir.org/mallman/

   H.K. Jerry Chu
   Google, Inc.
   1600 Amphitheatre Parkway
   Mountain View, CA 94043

   Phone: 650-253-3010
   EMail: hkchu@google.com

   Matt Sargent
   Case Western Reserve University
   Olin Building
   10900 Euclid Avenue
   Room 505
   Cleveland, OH 44106

   Phone: 440-223-5932
   EMail: mts71@case.edu
```