

```text
Network Working Group                                         P. Calhoun
Request for Comments: 3588                               Airespace, Inc.
Category: Standards Track                                    J. Loughney
                                                                   Nokia
                                                              E. Guttman
                                                  Sun Microsystems, Inc.
                                                                 G. Zorn
                                                     Cisco Systems, Inc.
                                                                J. Arkko
                                                                Ericsson
                                                          September 2003

                         Diameter Base Protocol
```

---
# **Status of this Memo**

이 문서는 인터넷 커뮤니티를 위한 인터넷 표준 추적 프로토콜을 지정하고 개선을 위한 토론 및 제안을 요청합니다. 이 프로토콜의 표준화 상태 및 상태에 대해서는 "Internet Official Protocol Standards"\(STD 1\) 최신판을 참조하십시오. 이 메모의 배포는 무제한입니다.

---
# **Copyright Notice**

저작권\(C\)인터넷학회\(2003\). 판권 소유.

---
# **Abstract**

Diameter 기본 프로토콜은 네트워크 액세스 또는 IP 이동성과 같은 애플리케이션을 위한 AAA\(인증, 권한 부여 및 회계\) 프레임워크를 제공하기 위한 것입니다. Diameter는 또한 로컬 인증, 권한 부여 및 회계, 로밍 상황 모두에서 작동하도록 고안되었습니다. 이 문서는 모든 Diameter 애플리케이션에서 사용되는 메시지 형식, 전송, 오류 보고, 회계 및 보안 서비스를 지정합니다. Diameter 기본 애플리케이션은 모든 Diameter 구현에서 지원되어야 합니다.

---
# **Conventions Used In This Document**

이 문서의 핵심 단어 "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY" 및 "OPTIONAL"은 다음과 같습니다. BCP 14, RFC 2119 \[KEYWORD\]에 설명된 대로 해석됩니다.\(MUST NOT\)

---
# **Table of Contents**

```text
   1.  Introduction.................................................   6
       1.1.   Diameter Protocol.....................................   9
              1.1.1.   Description of the Document Set..............  10
       1.2.   Approach to Extensibility.............................  11
              1.2.1.   Defining New AVP Values......................  11
              1.2.2.   Creating New AVPs............................  11
              1.2.3.   Creating New Authentication Applications.....  11
              1.2.4.   Creating New Accounting Applications.........  12
              1.2.5.   Application Authentication Procedures........  14
       1.3.   Terminology...........................................  14
   2.  Protocol Overview............................................  18
       2.1.   Transport.............................................  20
              2.1.1.   SCTP Guidelines..............................  21
       2.2.   Securing Diameter Messages............................  21
       2.3.   Diameter Application Compliance.......................  21
       2.4.   Application Identifiers...............................  22
       2.5.   Connections vs. Sessions..............................  22
       2.6.   Peer Table............................................  23
       2.7.   Realm-Based Routing Table.............................  24
       2.8.   Role of Diameter Agents...............................  25
              2.8.1.   Relay Agents.................................  26
              2.8.2.   Proxy Agents.................................  27
              2.8.3.   Redirect Agents..............................  28
              2.8.4.   Translation Agents...........................  29
       2.9.   End-to-End Security Framework.........................  30
       2.10.  Diameter Path Authorization...........................  30
   3.  Diameter Header..............................................  32
       3.1.   Command Codes.........................................  35
       3.2.   Command Code ABNF specification.......................  36
       3.3.   Diameter Command Naming Conventions...................  38
   4.  Diameter AVPs................................................  38
       4.1.   AVP Header............................................  39
              4.1.1.   Optional Header Elements.....................  41
       4.2.   Basic AVP Data Formats................................  41
       4.3.   Derived AVP Data Formats..............................  42
       4.4.   Grouped AVP Values....................................  49
              4.4.1.   Example AVP with a Grouped Data Type.........  50
       4.5.   Diameter Base Protocol AVPs...........................  53
   5.  Diameter Peers...............................................  56
       5.1.   Peer Connections......................................  56
       5.2.   Diameter Peer Discovery...............................  56
       5.3.   Capabilities Exchange.................................  59
              5.3.1.   Capabilities-Exchange-Request................  60
              5.3.2.   Capabilities-Exchange-Answer.................  60
              5.3.3.   Vendor-Id AVP................................  61
              5.3.4.   Firmware-Revision AVP........................  61
              5.3.5.   Host-IP-Address AVP..........................  62
              5.3.6.   Supported-Vendor-Id AVP......................  62
              5.3.7.   Product-Name AVP.............................  62
       5.4.   Disconnecting Peer Connections........................  62
              5.4.1.   Disconnect-Peer-Request......................  63
              5.4.2.   Disconnect-Peer-Answer.......................  63
              5.4.3.   Disconnect-Cause AVP.........................  63
       5.5.   Transport Failure Detection...........................  64
              5.5.1.   Device-Watchdog-Request......................  64
              5.5.2.   Device-Watchdog-Answer.......................  64
              5.5.3.   Transport Failure Algorithm..................  65
              5.5.4.   Failover and Failback Procedures.............  65
       5.6.   Peer State Machine....................................  66
              5.6.1.   Incoming connections.........................  68
              5.6.2.   Events.......................................  69
              5.6.3.   Actions......................................  70
              5.6.4.   The Election Process.........................  71
   6.  Diameter Message Processing..................................  71
       6.1.   Diameter Request Routing Overview.....................  71
              6.1.1.   Originating a Request........................  73
              6.1.2.   Sending a Request............................  73
              6.1.3.   Receiving Requests...........................  73
              6.1.4.   Processing Local Requests....................  73
              6.1.5.   Request Forwarding...........................  74
              6.1.6.   Request Routing..............................  74
              6.1.7.   Redirecting Requests.........................  74
              6.1.8.   Relaying and Proxying Requests...............  75
       6.2.   Diameter Answer Processing............................  76
              6.2.1.   Processing Received Answers..................  77
              6.2.2.   Relaying and Proxying Answers................  77
       6.3.   Origin-Host AVP.......................................  77
       6.4.   Origin-Realm AVP......................................  78
       6.5.   Destination-Host AVP..................................  78
       6.6.   Destination-Realm AVP.................................  78
       6.7.   Routing AVPs..........................................  78
              6.7.1.   Route-Record AVP.............................  79
              6.7.2.   Proxy-Info AVP...............................  79
              6.7.3.   Proxy-Host AVP...............................  79
              6.7.4.   Proxy-State AVP..............................  79
       6.8.   Auth-Application-Id AVP...............................  79
       6.9.   Acct-Application-Id AVP...............................  79
       6.10.  Inband-Security-Id AVP................................  79
       6.11.  Vendor-Specific-Application-Id AVP....................  80
       6.12.  Redirect-Host AVP.....................................  80
       6.13.  Redirect-Host-Usage AVP...............................  80
       6.14.  Redirect-Max-Cache-Time AVP...........................  81
       6.15.  E2E-Sequence AVP......................................  82
   7.  Error Handling...............................................  82
       7.1.   Result-Code AVP.......................................  84
              7.1.1.   Informational................................  84
              7.1.2.   Success......................................  84
              7.1.3.   Protocol Errors..............................  85
              7.1.4.   Transient Failures...........................  86
              7.1.5.   Permanent Failures...........................  86
       7.2.   Error Bit.............................................  88
       7.3.   Error-Message AVP.....................................  89
       7.4.   Error-Reporting-Host AVP..............................  89
       7.5.   Failed-AVP AVP........................................  89
       7.6.   Experimental-Result AVP...............................  90
       7.7.   Experimental-Result-Code AVP..........................  90
   8.  Diameter User Sessions.......................................  90
       8.1.   Authorization Session State Machine...................  92
       8.2.   Accounting Session State Machine......................  96
       8.3.   Server-Initiated Re-Auth.............................. 101
              8.3.1.   Re-Auth-Request.............................. 102
              8.3.2.   Re-Auth-Answer............................... 102
       8.4.   Session Termination................................... 103
              8.4.1.   Session-Termination-Request.................. 104
              8.4.2.   Session-Termination-Answer................... 105
       8.5.   Aborting a Session.................................... 105
              8.5.1.   Abort-Session-Request........................ 106
              8.5.2.   Abort-Session-Answer......................... 106
       8.6.   Inferring Session Termination from Origin-State-Id.... 107
       8.7.   Auth-Request-Type AVP................................. 108
       8.8.   Session-Id AVP........................................ 108
       8.9.   Authorization-Lifetime AVP............................ 109
       8.10.  Auth-Grace-Period AVP................................. 110
       8.11.  Auth-Session-State AVP................................ 110
       8.12.  Re-Auth-Request-Type AVP.............................. 110
       8.13.  Session-Timeout AVP................................... 111
       8.14.  User-Name AVP......................................... 111
       8.15.  Termination-Cause AVP................................. 111
       8.16.  Origin-State-Id AVP................................... 112
       8.17.  Session-Binding AVP................................... 113
       8.18.  Session-Server-Failover AVP........................... 113
       8.19.  Multi-Round-Time-Out AVP.............................. 114
       8.20.  Class AVP............................................. 114
       8.21.  Event-Timestamp AVP................................... 115
   9.  Accounting................................................... 115
       9.1.   Server Directed Model................................. 115
       9.2.   Protocol Messages..................................... 116
       9.3.   Application Document Requirements..................... 116
       9.4.   Fault Resilience...................................... 116
       9.5.   Accounting Records.................................... 117
       9.6.   Correlation of Accounting Records..................... 118
       9.7.   Accounting Command-Codes.............................. 119
              9.7.1.   Accounting-Request........................... 119
              9.7.2.   Accounting-Answer............................ 120
       9.8.   Accounting AVPs....................................... 121
              9.8.1.   Accounting-Record-Type AVP................... 121
              9.8.2.   Acct-Interim-Interval AVP.................... 122
              9.8.3.   Accounting-Record-Number AVP................. 123
              9.8.4.   Acct-Session-Id AVP.......................... 123
              9.8.5.   Acct-Multi-Session-Id AVP.................... 123
              9.8.6.   Accounting-Sub-Session-Id AVP................ 123
              9.8.7.   Accounting-Realtime-Required AVP............. 123
   10. AVP Occurrence Table......................................... 124
       10.1.  Base Protocol Command AVP Table....................... 124
       10.2.  Accounting AVP Table.................................. 126
   11. IANA Considerations.......................................... 127
       11.1.  AVP Header............................................ 127
              11.1.1.  AVP Code..................................... 127
              11.1.2.  AVP Flags.................................... 128
       11.2.  Diameter Header....................................... 128
              11.2.1.  Command Codes................................ 128
              11.2.2.  Command Flags................................ 129
       11.3.  Application Identifiers............................... 129
       11.4.  AVP Values............................................ 129
              11.4.1.  Result-Code AVP Values....................... 129
              11.4.2.  Accounting-Record-Type AVP Values............ 130
              11.4.3.  Termination-Cause AVP Values................. 130
              11.4.4.  Redirect-Host-Usage AVP Values............... 130
              11.4.5.  Session-Server-Failover AVP Values........... 130
              11.4.6.  Session-Binding AVP Values................... 130
              11.4.7.  Disconnect-Cause AVP Values.................. 130
              11.4.8.  Auth-Request-Type AVP Values................. 130
              11.4.9.  Auth-Session-State AVP Values................ 130
              11.4.10. Re-Auth-Request-Type AVP Values.............. 131
              11.4.11. Accounting-Realtime-Required AVP Values...... 131
       11.5.  Diameter TCP/SCTP Port Numbers........................ 131
       11.6.  NAPTR Service Fields.................................. 131
   12. Diameter Protocol Related Configurable Parameters............ 131
   13. Security Considerations...................................... 132
       13.1.  IPsec Usage........................................... 133
       13.2.  TLS Usage............................................. 134
       13.3.  Peer-to-Peer Considerations........................... 134
   14. References................................................... 136
       14.1.  Normative References.................................. 136
       14.2.  Informative References................................ 138
   15. Acknowledgements............................................. 140
   Appendix A.  Diameter Service Template........................... 141
   Appendix B.  NAPTR Example....................................... 142
   Appendix C.  Duplicate Detection................................. 143
   Appendix D.  Intellectual Property Statement..................... 145
   Authors' Addresses............................................... 146
   Full Copyright Statement......................................... 147
```

---
## **1.  Introduction**

TACACS\[TACACS\] 및 RADIUS\[RADIUS\]와 같은 AAA\(인증, 권한 부여 및 계정\) 프로토콜은 처음에 전화 접속 PPP\[PPP\] 및 터미널 서버 액세스를 제공하기 위해 배포되었습니다. 시간이 지남에 따라 인터넷이 성장하고 무선, DSL, 모바일 IP 및 이더넷을 포함한 새로운 액세스 기술이 도입되면서 라우터 및 네트워크 액세스 서버\(NAS\)의 복잡성과 밀도가 증가하여 AAA 프로토콜에 대한 새로운 요구가 생겼습니다.

AAA 프로토콜에 대한 네트워크 액세스 요구 사항은 \[AAAREQ\]에 요약되어 있습니다. 여기에는 다음이 포함됩니다.

장애 조치

- \[RADIUS\]는 장애 조치 메커니즘을 정의하지 않으므로 결과적으로 장애 조치 동작이 구현마다 다릅니다. 잘 정의된 장애 조치 동작을 제공하기 위해 Diameter는 애플리케이션 계층 승인을 지원하고 장애 조치 알고리즘 및 관련 상태 머신을 정의합니다. 이에 대해서는 섹션 5.5 및 \[AAATRANS\]에 설명되어 있습니다.

전송 수준 보안

- \[RADIUS\]는 응답 패킷에만 필요한 애플리케이션 계층 인증 및 무결성 체계를 정의합니다. \[RADEXT\]는 추가 인증 및 무결성 메커니즘을 정의하지만 확장 가능 인증 프로토콜\(EAP\) 세션 중에만 사용이 필요합니다. 속성 숨김은 지원되지만 \[RADIUS\]는 패킷별 기밀성을 지원하지 않습니다. 회계에서 \[RADACCT\]는 재생 보호가 프로토콜 자체가 아닌 백엔드 청구 서버에서 제공된다고 가정합니다.

- \[RFC3162\]는 RADIUS와 함께 IPsec 사용을 정의하지만 IPsec에 대한 지원은 필요하지 않습니다. \[IKE\] 내 인증은 2단계에서 IPsec SA를 설정하기 전 1단계 내에서만 발생하므로 일반적으로 각 응용 프로그램에 대해 별도의 신뢰 또는 인증 체계를 정의하는 것은 불가능합니다. 이는 AAA 배포에 사용하기 위해 고유한 인증서 계층 구조를 정의하는 것이 바람직할 수 있는 도메인 간 AAA 애플리케이션\(예: 로밍\)에서 IPsec의 유용성을 제한합니다. 전송 수준 보안에 대한 보편적인 지원을 제공하고 도메인 내 및 도메인 간 AAA 배포를 모두 활성화하려면 Diameter에서 IPsec 지원이 필수이고 TLS 지원은 선택 사항입니다. 보안은 섹션 13에서 논의됩니다.

안정적인 운송

- RADIUS는 UDP를 통해 실행되며 재전송 동작을 정의하지 않습니다. 결과적으로 신뢰성은 구현마다 다릅니다. \[ACCMGMT\]에 설명된 대로 이는 패킷 손실이 수익 손실로 직접 이어질 수 있는 회계의 주요 문제입니다. 잘 정의된 전송 동작을 제공하기 위해 Diameter는 \[AAATRANS\]에 정의된 대로 신뢰할 수 있는 전송 메커니즘\(TCP, SCTP\)을 통해 실행됩니다.

에이전트 지원

- \[RADIUS\]는 프록시, 리디렉션 및 릴레이를 포함한 에이전트에 대한 명시적인 지원을 제공하지 않습니다. 예상되는 동작은 정의되지 않았으므로 구현마다 다릅니다. Diameter는 에이전트 동작을 명시적으로 정의합니다. 이에 대해서는 섹션 2.8에 설명되어 있습니다.

서버 시작 메시지

- RADIUS 서버 시작 메시지는 \[DYNAUTH\]에 정의되어 있지만 지원은 선택 사항입니다. 이로 인해 이기종 배포 전반에 걸쳐 원치 않는 연결 끊기 또는 요청 시 재인증/재인증과 같은 기능을 구현하기가 어렵습니다. 서버 시작 메시지에 대한 지원은 Diameter에서 필수이며 섹션 8에 설명되어 있습니다.

감사 가능성

- RADIUS는 데이터 개체 보안 메커니즘을 정의하지 않으므로 신뢰할 수 없는 프록시가 감지되지 않은 채 속성이나 패킷 헤더를 수정할 수도 있습니다. 역량 협상에 대한 지원 부족과 더불어 이로 인해 분쟁 발생 시 어떤 일이 발생했는지 판단하기가 매우 어렵습니다. 데이터 객체 보안의 구현은 Diameter 내에서 필수는 아니지만 이러한 기능은 지원되며 \[AAACMS\]에 설명되어 있습니다.

전환 지원

- Diameter는 RADIUS와 공통 프로토콜 데이터 유닛\(PDU\)을 공유하지 않지만, RADIUS와의 하위 호환성을 구현하기 위해 상당한 노력을 기울여 두 프로토콜을 동일한 네트워크에 배포할 수 있습니다. 처음에는 Diameter가 새로운 네트워크 장치뿐만 아니라 기존 RADIUS 장치와 Diameter 에이전트 간의 통신을 가능하게 하는 게이트웨이 내에 배포될 것으로 예상됩니다. \[NASREQ\]에 설명된 이 기능을 사용하면 RADIUS와 Diameter를 모두 사용하는 게이트웨이나 서버를 추가하여 Diameter 지원을 레거시 네트워크에 추가할 수 있습니다.

위의 요구 사항을 해결하는 것 외에도 Diameter는 다음 사항도 지원합니다.

역량 협상

- RADIUS는 오류 메시지, 기능 협상 또는 특성에 대한 필수/비필수 플래그를 지원하지 않습니다. RADIUS 클라이언트와 서버는 서로의 기능을 인식하지 못하기 때문에 상호 허용되는 서비스를 성공적으로 협상하지 못할 수도 있고 어떤 경우에는 어떤 서비스가 구현되었는지조차 인식하지 못할 수도 있습니다. Diameter에는 오류 처리\(섹션 7\), 기능 협상\(섹션 5.3\) 및 필수/비필수 속성-값 쌍\(AVP\)\(섹션 4.1\)에 대한 지원이 포함됩니다.

피어 검색 및 구성

- RADIUS 구현에서는 일반적으로 서버 또는 클라이언트의 이름이나 주소를 해당 공유 비밀과 함께 수동으로 구성해야 합니다. 이로 인해 관리 부담이 커지고 RADIUS 공유 비밀을 재사용하려는 유혹이 생겨 요청 인증자가 \[RADIUS\]에서 요구하는 것처럼 전역적으로나 시간적으로 고유하지 않은 경우 주요 보안 취약점이 발생할 수 있습니다. Diameter를 통해 DNS를 통해 피어를 동적으로 검색할 수 있습니다. 동적 세션 키의 파생은 전송 수준 보안을 통해 활성화됩니다.

로밍 지원

- ROAMOPS WG는 로밍 구현 \[ROAMREV\], 세부 로밍 요구 사항 \[ROAMCRIT\]에 대한 조사를 제공하고 네트워크 액세스 식별자\(NAI\) \[NAI\]를 정의하고 RADIUS 기반 로밍 \[PROXYCHAIN\]의 기존 구현\(및 모방\)을 문서화했습니다. 확장성을 높이기 위해 \[PROXYCHAIN\]은 중간 서버를 통한 프록시 체인 개념을 도입하여 공급자 간 로밍을 촉진했습니다. 그러나 RADIUS는 프록시에 대한 명시적인 지원을 제공하지 않고 감사 가능성과 전송 수준 보안 기능이 부족하기 때문에 RADIUS 기반 로밍은 외부 당사자의 공격에 취약할 뿐만 아니라 로밍 파트너 자체가 저지르는 사기에도 취약합니다. 결과적으로 인터넷 \[PROXYCHAIN\]에서의 대규모 배포에는 적합하지 않습니다. 도메인 간 로밍 및 메시지 라우팅\(섹션 2.7 및 6\), 감사 가능성\(AAACMS\) 및 전송 계층 보안\(섹션 13\) 기능에 대한 명시적인 지원을 제공함으로써 Diameter는 이러한 제한 사항을 해결하고 안전하고 확장 가능한 로밍을 제공합니다.

AAA 프로토콜이 처음 도입된 이후 10년 동안 NAS\(네트워크 액세스 서버\) 장치의 기능이 크게 향상되었습니다. 결과적으로 Diameter는 RADIUS보다 훨씬 더 정교한 프로토콜이지만 여전히 구현 가능합니다.

프로세서 속도가 향상되고 임베디드 IPsec 및 TLS 구현이 널리 사용 가능해짐에 따라 임베디드 장치 내에서 사용 가능합니다.

---
### **1.1.  Diameter Protocol**

Diameter 기본 프로토콜은 다음 기능을 제공합니다.

- AVP\(속성 값 쌍\) 전달 - 기능 협상 - 오류 알림 - 새로운 명령 및 AVP 추가를 통한 확장성\(\[AAAREQ\]에 필요함\) - 사용자 세션 처리, 정산 등 애플리케이션에 필요한 기본 서비스

프로토콜에 의해 전달되는 모든 데이터는 AVP 형식입니다. 이러한 AVP 값 중 일부는 Diameter 프로토콜 자체에서 사용되는 반면 다른 값은 Diameter를 사용하는 특정 애플리케이션과 관련된 데이터를 전달합니다. 필수 AVP가 포함되고 명시적으로 제외된 AVP가 포함되지 않는 한 AVP는 Diameter 메시지에 임의로 추가될 수 있습니다. AVP는 다음과 같은 필수 기능을 지원하기 위해 기본 Diameter 프로토콜에서 사용됩니다.

- Diameter 서버가 사용자를 인증할 수 있도록 하기 위해 사용자 인증 정보를 전송합니다.

- 클라이언트와 서버 간에 서비스별 인증 정보를 전송하여 피어가 사용자의 액세스 요청을 승인해야 하는지 여부를 결정할 수 있도록 합니다.

- 회계 목적, 용량 계획 등에 사용될 수 있는 리소스 사용 정보 교환\(MAY\)

- 서버 계층을 통해 Diameter 메시지를 중계, 프록시 및 리디렉션합니다.

Diameter 기본 프로토콜은 \[AAAREQ\]에서 요구하는 대로 AAA 프로토콜에 필요한 최소 요구 사항을 제공합니다. 기본 프로토콜은 회계 목적으로만 사용될 수도 있고 모바일 IPv4 \[DIAMMIP\] 또는 네트워크 액세스 \[NASREQ\]와 같은 Diameter 애플리케이션과 함께 사용될 수도 있습니다. 새로운 명령이나 AVP를 추가하여 새로운 애플리케이션에서 사용하기 위해 기본 프로토콜을 확장하는 것도 가능합니다. 현재 Diameter의 초점은 네트워크 액세스 및 회계 애플리케이션입니다. 많은 애플리케이션에서 사용되는 진정한 일반 AAA 프로토콜은 Diameter가 제공하지 않는 기능을 제공할 수도 있습니다. 따라서 새로운 응용 프로그램의 설계자는 Diameter를 사용하기 전에 요구 사항을 이해하는 것이 중요합니다.

Diameter 적용에 대한 자세한 내용은 섹션 2.4를 참조하십시오.

모든 노드가 요청을 시작할 수 있습니다. 그런 의미에서 Diameter는 P2P 프로토콜입니다. 이 문서에서 Diameter 클라이언트는 네트워크 액세스 서버\(NAS\) 또는 외부 에이전트\(FA\)와 같이 액세스 제어를 수행하는 네트워크 가장자리에 있는 장치입니다. Diameter 클라이언트는 사용자에 대한 인증, 승인 및 계정 서비스를 요청하기 위해 Diameter 메시지를 생성합니다. Diameter 에이전트는 메시지를 로컬에서 인증 및/또는 승인하지 않는 노드입니다. 에이전트에는 프록시, 리디렉션 및 릴레이 에이전트가 포함됩니다. Diameter 서버는 사용자의 인증 및/또는 권한 부여를 수행합니다. Diameter 노드는 특정 요청에 대한 에이전트 역할을 하는 동시에 다른 요청에 대한 서버 역할을 할 수도 있습니다.\(MAY\)

Diameter 프로토콜은 특정 사용자에 대한 서비스 중단 요청과 같은 서버 시작 메시지도 지원합니다.

---
#### **1.1.1.  Description of the Document Set**

현재 Diameter 사양은 기본 사양\(본 문서\), 전송 프로필 \[AAATRANS\] 및 애플리케이션: 모바일 IPv4 \[DIAMMIP\] 및 NASREQ \[NASREQ\]로 구성됩니다.

전송 프로필 문서 \[AAATRANS\]에서는 AAA 프로토콜에서 발생하는 전송 계층 문제와 이러한 문제를 극복하는 방법에 대한 권장 사항을 논의합니다. 이 문서는 Diameter 장애 조치 알고리즘과 상태 머신도 정의합니다.

모바일 IPv4 \[DIAMMIP\] 애플리케이션은 Diameter 서버가 모바일 노드에 대한 모바일 IPv4 서비스에 대한 AAA 기능을 수행할 수 있도록 하는 Diameter 애플리케이션을 정의합니다.

NASREQ \[NASREQ\] 애플리케이션은 Diameter 서버가 PPP/SLIP 전화 접속 및 터미널 서버 액세스 환경에서 사용될 수 있도록 하는 Diameter 애플리케이션을 정의합니다. Diameter와 RADIUS 간의 프로토콜 변환을 수행해야 하는 서버에 대한 고려가 이루어졌습니다.

요약하면, 이 문서는 계정 지원을 포함하는 AAA의 기본 프로토콜 사양을 정의합니다. 모바일 IPv4 및 NASREQ 문서는 인증, 권한 부여 및 계정에 대해 이 기본 사양을 사용하는 애플리케이션을 설명합니다.

---
### **1.2.  Approach to Extensibility**

Diameter 프로토콜은 다음을 포함한 여러 메커니즘을 사용하여 확장 가능하도록 설계되었습니다.

```text
      -  Defining new AVP values
      -  Creating new AVPs
      -  Creating new authentication/authorization applications
      -  Creating new accounting applications
      -  Application authentication procedures
```

기존 AVP 값, AVP 및 Diameter 애플리케이션을 재사용하는 것이 좋습니다. 재사용은 표준화와 구현을 단순화하고 잠재적인 상호 운용성 문제를 방지합니다. 명령 코드는 재사용될 것으로 예상됩니다. 새로운 명령 코드는 IETF 합의에 의해서만 생성될 수 있습니다\(섹션 11.2.1 참조\).

---
#### **1.2.1.  Defining New AVP Values**

새 애플리케이션은 새 AVP를 생성하는 대신 가능하면 기존 애플리케이션에 정의된 AVP를 재사용하려고 시도해야 합니다. Enumerated 유형의 AVP의 경우 애플리케이션은 일부 서비스별 정보를 전달하기 위해 새로운 값이 필요할 수 있습니다.

새로운 AVP 값을 할당하려면 새로운 AVP 값에 대한 설명과 함께 요청이 IANA \[IANA\]로 전송되어야 합니다. 직경에 대한 IANA 고려 사항은 섹션 11에서 논의됩니다.\(MUST\)

---
#### **1.2.2.  Creating New AVPs**

기존 AVP를 사용할 수 없는 경우 새 AVP를 생성해야 합니다. 정의되는 새로운 AVP는 섹션 4.2에 나열된 데이터 유형 중 하나를 사용해야 합니다.\(MUST\)

AVP의 논리적 그룹화가 필요하고 주어진 명령에서 여러 "그룹"이 가능한 경우 그룹화된 AVP를 사용하는 것이 좋습니다\(섹션 4.4 참조\).

새로운 AVP를 생성하려면 AVP에 대한 사양과 함께 요청이 IANA로 전송되어야 합니다. 요청에는 AVP를 활용하는 명령이 포함되어야 합니다.\(MUST, MUST\)

---
#### **1.2.3.  Creating New Authentication Applications**

모든 Diameter 애플리케이션 사양에는 IANA 할당 애플리케이션 식별자\(섹션 2.4 참조\) 또는 공급업체별 애플리케이션 식별자가 있어야 합니다.\(MUST\)

새로운 Diameter 사용 시나리오가 사양을 크게 변경하지 않고는 기존 애플리케이션에 적합하지 않은 경우 새로운 Diameter 애플리케이션을 만드는 것이 바람직할 수 있습니다. 애플리케이션의 주요 변경 사항은 다음과 같습니다.

- "M" 비트가 설정된 명령에 새 AVP를 추가합니다.

- 요청을 충족하기 위해 왕복 횟수가 다른 명령이 필요합니다\(예: application foo에는 한 번의 왕복이 필요한 명령이 있지만 new application bar에는 완료하는 데 두 번의 왕복이 필요한 명령이 있습니다\).

- 애플리케이션과 함께 사용할 새로운 AVP 정의가 필요한 인증 방법에 대한 지원을 추가합니다. 새로운 EAP 인증 방법은 새로운 AVP 없이 Diameter 내에서 지원될 수 있으므로 EAP 방법을 추가해도 새로운 인증 애플리케이션을 생성할 필요가 없습니다.

새 애플리케이션을 만드는 것은 최후의 수단으로 간주되어야 합니다. 구현에서는 새 애플리케이션을 정의할 필요 없이 공급업체별 AVP를 포함하여 애플리케이션에 정의된 모든 명령에 임의의 비필수 AVP를 추가할 수 있습니다. 자세한 내용은 섹션 11.1.1을 참조하십시오.\(MAY\)

새로운 애플리케이션 식별자 할당을 정당화하기 위해 Diameter 애플리케이션은 하나의 명령 코드를 정의하거나 새로운 필수 AVP를 ABNF에 추가해야 합니다.\(MUST\)

예상 AVP는 ABNF \[ABNF\] 문법으로 정의되어야 합니다\(섹션 3.2 참조\). Diameter 애플리케이션에 계정 요구사항이 있는 경우에는 Diameter 계정 메시지에 표시될 AVP도 지정해야 합니다\(섹션 9.3 참조\). 그러나 새로운 인증 애플리케이션 ID가 필요하다고 해서 새로운 회계 애플리케이션 ID가 필요하다는 의미는 아닙니다.\(MUST, MUST\)

가능하다면 새로운 Diameter 애플리케이션은 유사한 정보를 전달하는 여러 AVP를 정의하는 것을 피하기 위해 기존 Diameter AVP를 재사용해야 합니다\(SHOULD\).\(SHOULD\)

---
#### **1.2.4.  Creating New Accounting Applications**

Diameter 회계만 필요한 서비스가 있습니다. 이러한 서비스는 ACR\(Accounting-Request\)/ACA\(Accounting-Answer\) 메시지에 전달되는 AVP를 정의해야 하지만 새로운 명령 코드를 정의할 필요는 없습니다. 구현은 임의의 비필수 AVP\("M" 비트가 설정되지 않은 AVP\)를 정의된 모든 명령에 추가할 수 있습니다.\(MAY\)

새로운 회계 애플리케이션을 정의할 필요 없이 공급업체별 AVP를 포함한 애플리케이션을 사용할 수 있습니다. 자세한 내용은 섹션 11.1.1을 참조하십시오.

Diameter 기능 교환에는 여전히 애플리케이션 식별자가 필요합니다. 모든 Diameter 회계 애플리케이션 사양에는 IANA 할당 애플리케이션 식별자\(섹션 2.4 참조\) 또는 공급업체별 애플리케이션 식별자가 있어야 합니다.\(MUST\)

모든 Diameter 구현은 회계를 지원해야 합니다. 새로운 필수 AVP가 추가되지 않는 한, 기본 회계 지원은 이 문서에 정의된 ACR/ACA 명령을 사용하는 모든 애플리케이션을 처리하는 데 충분합니다. 필수 AVP는 회계 애플리케이션에 대한 ABNF 내에서 필수인지 선택 사항인지에 관계없이 회계 명령 내에서 전송될 때 "M" 비트가 설정된 AVP로 정의됩니다.\(MUST\)

새로운 회계 애플리케이션의 생성은 최후의 수단으로 간주되어야 하며 새로운 명령이나 추가 메커니즘\(예: 애플리케이션 정의 상태 머신\)이 애플리케이션 내에 정의되거나 새로운 필수 AVP가 ABNF에 추가되지 않는 한 사용해서는 안 됩니다.\(MUST NOT\)

회계 명령 내에서 "M" 비트를 설정한다는 것은 백엔드 서버\(예: 청구 서버\) 또는 회계 서버 자체가 올바른 청구서를 계산하기 위해 AVP를 이해해야 함을 의미합니다. AVP가 청구 프로세스와 관련이 없는 경우, AVP가 회계 명령 내에 포함될 때 "M" 비트가 설정되어서는 안 됩니다. 이는 동일한 AVP가 다른 Diameter 내에서 사용될 때 "M" 비트가 설정되더라도 마찬가지입니다. 명령\(즉, 인증/권한 부여 명령\).\(MUST, MUST NOT\)

DIAMETER 기본 계정 구현은 계정 서버가 청구할 수 없는 서비스에 대한 계정 요청을 수락하는 것을 방지하기 위해 지원되는 계정 애플리케이션을 광고하도록 구성 가능해야 합니다. 홈 도메인과 회계 애플리케이션 ID의 조합을 사용하여 요청을 적절한 회계 서버로 라우팅할 수 있습니다.\(MUST\)

가능하다면 새로운 Diameter 회계 애플리케이션은 유사한 정보를 전달하는 여러 AVP를 정의하는 것을 피하기 위해 기존 AVP를 재사용하려고 시도해야 합니다\(SHOULD\).\(SHOULD\)

필수 AVP, 새로운 명령 또는 추가 메커니즘\(예: 애플리케이션 정의 상태 머신\) 없이 기본 어카운팅이 사용되는 경우 기본 프로토콜 정의 표준 어카운팅 애플리케이션 ID\(섹션 2.4\)를 ACR/ACA 명령에 사용해야 합니다.\(MUST\)

---
#### **1.2.5.  Application Authentication Procedures**

가능하다면 애플리케이션을 변경할 필요 없이 새로운 인증 방법을 추가할 수 있도록 애플리케이션을 설계해야 합니다. 이를 위해서는 새로운 인증 변환이나 유사한 결과를 생성하는 다른 체계를 나타내기 위해 새로운 AVP 값을 할당해야 할 수도 있습니다. 가능하다면 확장 가능 인증 프로토콜\(EAP\)과 같은 인증 프레임워크를 사용해야 합니다.\(SHOULD, MAY, SHOULD\)

---
### **1.3.  Terminology**

AAA

- 인증, 권한 부여 및 회계.

회계

- 용량 계획, 감사, 청구 또는 비용 할당을 목적으로 자원 사용에 대한 정보를 수집하는 행위.

회계 기록

- 계정 기록은 전체 세션 동안 사용자의 리소스 소비에 대한 요약을 나타냅니다. 회계 기록을 생성하는 회계 서버는 동일한 사용자에게 서비스를 제공하는 여러 장치의 중간 회계 이벤트 또는 회계 이벤트를 처리하여 이를 수행할 수 있습니다.

입증

- 실체\(주체\)의 신원을 확인하는 행위.

권한 부여

- 요청 엔터티\(주체\)가 리소스\(객체\)에 대한 접근을 허용할지 여부를 결정하는 행위입니다.

AVP

- Diameter 프로토콜은 하나 이상의 AVP\(속성 값 쌍\)가 뒤따르는 헤더로 구성됩니다. AVP에는 헤더가 포함되어 있으며 프로토콜별 데이터\(예: 라우팅 정보\)는 물론 인증, 권한 부여 또는 계정 정보를 캡슐화하는 데 사용됩니다.

브로커

- 브로커는 AAA 인프라에서 일반적으로 사용되는 비즈니스 용어입니다. 브로커는 릴레이, 프록시 또는 리디렉션 에이전트이며 로밍 컨소시엄에 의해 운영될 수 있습니다. 비즈니스 모델에 따라 브로커는 릴레이 에이전트 또는 프록시 에이전트를 배포하도록 선택할 수 있습니다.\(MAY\)

직경 에이전트

- Diameter 에이전트는 릴레이, 프록시, 리디렉션 또는 변환 서비스를 제공하는 Diameter 노드입니다.

직경 클라이언트

- Diameter 클라이언트는 액세스 제어를 수행하는 네트워크 가장자리에 있는 장치입니다. Diameter 클라이언트의 예로는 NAS\(네트워크 액세스 서버\) 또는 FA\(외부 에이전트\)가 있습니다.

직경 노드

- Diameter 노드는 Diameter 프로토콜을 구현하는 호스트 프로세스이며 클라이언트, 에이전트 또는 서버 역할을 합니다.

직경 피어

- Diameter Peer는 주어진 Diameter Node가 직접 전송 연결을 갖는 Diameter 노드입니다.

직경 보안 교환

- 다이어미터 보안 교환\(Diameter Security Exchange\)은 두 개의 다이어미터 노드가 엔드투엔드 보안을 구축하는 프로세스입니다.

직경 서버

- Diameter 서버는 특정 영역에 대한 인증, 승인 및 계정 요청을 처리하는 서버입니다. 본질적으로 Diameter 서버는 기본 프로토콜 외에도 Diameter 애플리케이션을 지원해야 합니다.\(MUST\)

하류

- 다운스트림은 홈 서버에서 액세스 장치로 향하는 특정 Diameter 메시지의 방향을 식별하는 데 사용됩니다.

엔드투엔드 보안

- TLS 및 IPsec은 홉별 보안 또는 전송 연결 전반에 걸친 보안을 제공합니다. 릴레이나 프록시가 관련되면 이 홉별 보안은 전체 Diameter 사용자 세션을 보호하지 않습니다. 종단 간 보안은 Diameter 에이전트를 통해 통신할 수 있는 두 개의 Diameter 노드 간의 보안입니다. 이 보안은 원래 Diameter 노드에서 종료 Diameter 노드까지의 전체 Diameter 통신 경로를 보호합니다.

홈 영역

- 홈 영역은 사용자가 계정 관계를 유지하는 관리 도메인입니다.

```text
   Home Server
      See Diameter Server.
```

중간회계

- 중간 계정 메시지는 사용자 세션 중 사용량에 대한 스냅샷을 제공합니다. 일반적으로 장치 재부팅이나 기타 네트워크 문제로 인해 세션 요약 메시지 또는 세션 기록을 수신할 수 없는 경우 사용자 세션의 부분적인 계정을 제공하기 위해 구현됩니다.

로컬 영역

- 로컬 영역은 사용자에게 서비스를 제공하는 관리 도메인입니다. 관리 도메인은 특정 사용자에게는 로컬 영역으로 작동하는 동시에 다른 사용자에게는 홈 영역으로 작동할 수 있습니다.\(MAY\)

다중 세션

- 다중 세션은 여러 세션의 논리적 연결을 나타냅니다. 다중 세션은 Acct-Multi-Session-Id를 사용하여 추적됩니다. 다중 세션의 예로는 다중 링크 PPP 번들이 있습니다. 번들의 각 구간은 세션이고 전체 번들은 다중 세션입니다.

네트워크 액세스 식별자

- 네트워크 액세스 식별자\(NAI \[NAI\]\)는 사용자의 신원과 영역을 추출하기 위해 Diameter 프로토콜에서 사용됩니다. ID는 인증 및/또는 권한 부여 중에 사용자를 식별하는 데 사용되는 반면, 영역은 메시지 라우팅 목적으로 사용됩니다.

프록시 에이전트 또는 프록시

- 요청 및 응답을 전달하는 것 외에도 프록시는 리소스 사용 및 프로비저닝과 관련된 정책 결정을 내립니다. 이는 일반적으로 NAS 장치의 상태를 추적하여 수행됩니다. 프록시는 일반적으로 서버로부터 응답을 받기 전에 클라이언트 요청에 응답하지 않지만 정책을 위반하는 경우 거부 메시지를 생성할 수 있습니다. 결과적으로 프록시는 자신을 통과하는 메시지의 의미를 이해해야 하며 모든 Diameter 애플리케이션을 지원하지 않을 수도 있습니다.

왕국

- '@' 문자 바로 뒤에 오는 NAI의 문자열입니다. NAI 영역 이름은 고유해야 하며 DNS 네임스페이스 관리에 포함됩니다. Diameter는 느슨하게 도메인이라고도 하는 영역을 사용하여 메시지가 로컬에서 충족될 수 있는지 또는 메시지를 라우팅하거나 리디렉션해야 하는지 여부를 결정합니다. RADIUS에서 영역 이름은 반드시 DNS 네임스페이스에 피기백될 필요는 없지만 DNS 네임스페이스와 독립적일 수 있습니다.

실시간회계

- 실시간 회계는 정의된 시간 창 내에서 자원 사용에 대한 정보를 처리하는 것을 포함합니다. 재정적 위험을 제한하기 위해 일반적으로 시간 제약이 적용됩니다.

릴레이 에이전트 또는 릴레이

- 라우팅 관련 AVP 및 영역 라우팅 테이블 항목을 기반으로 전달 요청 및 응답을 중계합니다. 릴레이는 정책 결정을 내리지 않기 때문에 비라우팅 AVP를 검사하거나 변경하지 않습니다. 결과적으로 릴레이는 메시지를 생성하지 않으며 메시지 또는 비라우팅 AVP의 의미를 이해할 필요가 없으며 모든 Diameter 애플리케이션 또는 메시지 유형을 처리할 수 있습니다. 릴레이는 라우팅 AVP 및 영역 전달 테이블의 정보를 기반으로 결정을 내리기 때문에 NAS 리소스 사용 또는 진행 중인 세션에 대한 상태를 유지하지 않습니다.

리디렉션 에이전트

- 리디렉션 에이전트는 클라이언트와 서버 간에 요청과 응답을 전달하는 대신 클라이언트를 서버로 참조하여 직접 통신할 수 있도록 합니다. 리디렉션 에이전트는 전달 경로에 있지 않으므로 클라이언트와 서버 간에 전송되는 AVP를 변경하지 않습니다. 리디렉션 에이전트는 메시지를 생성하지 않으며 모든 메시지 유형을 처리할 수 있습니다. 단, 특정 유형의 메시지만 리디렉션하도록 구성하고 다른 유형에 대해서는 릴레이 또는 프록시 에이전트로 작동하도록 구성할 수 있습니다. 프록시 에이전트와 마찬가지로 리디렉션 에이전트는 세션 또는 NAS 리소스와 관련된 상태를 유지하지 않습니다.

로밍 관계

- 로밍 관계에는 기업과 ISP 간의 관계, 로밍 컨소시엄 내 Peer ISP 간의 관계, ISP와 로밍 컨소시엄 간의 관계가 포함됩니다.

보안 협회

- 보안 연결은 릴레이 및/또는 프록시가 있는 경우에도 엔드포인트가 무결성을 유지하고 기밀로 통신할 수 있도록 하는 Diameter 세션의 두 엔드포인트 간의 연결입니다.

세션

- 세션은 특정 활동에 관련된 이벤트의 진행 과정입니다. 각 애플리케이션은 세션이 시작되고 끝나는 시점에 대한 지침을 제공해야 합니다\(SHOULD\). 동일한 Session-Identifier를 가진 모든 Diameter 패킷은 동일한 세션의 일부로 간주됩니다.\(SHOULD\)

세션 상태

- Stateful 에이전트는 승인된 모든 활성 세션을 추적하여 세션 상태 정보를 유지하는 에이전트입니다. 승인된 각 세션은 특정 서비스에 바인딩되며 해당 상태는 별도로 통지될 때까지 또는 만료될 때까지 활성 상태로 간주됩니다.

하위 세션

- 하위 세션은 특정 세션에 제공되는 고유한 서비스\(예: QoS 또는 데이터 특성\)를 나타냅니다. 이러한 서비스는 동시에\(예: 동일한 세션 중 동시 음성 및 데이터 전송\) 또는 순차적으로 발생할 수 있습니다. 세션의 이러한 변경 사항은 Accounting-Sub-Session-Id를 통해 추적됩니다.

거래상태

- Diameter 프로토콜은 에이전트가 장애 조치 목적으로 사용되는 트랜잭션 상태를 유지하도록 요구합니다. 트랜잭션 상태는 요청 전달 시 홉별 식별자가 저장됨을 의미합니다. 필드는 로컬에서 고유한 식별자로 대체되며 해당 답변이 수신되면 원래 값으로 복원됩니다. 요청 상태는 응답을 받으면 해제됩니다. 상태 비저장 에이전트는 트랜잭션 상태만 유지하는 에이전트입니다.

번역 대행

- 변환 에이전트는 Diameter와 RADIUS와 같은 다른 AAA 프로토콜 간의 프로토콜 변환을 수행하는 상태 저장 Diameter 노드입니다.

운송 연결

- 전송 연결은 두 개의 Diameter 피어 사이에 직접 존재하는 TCP 또는 SCTP 연결\(P2P 연결이라고도 함\)입니다.

업스트림

- 업스트림은 액세스 장치에서 홈 서버로 향하는 특정 Diameter 메시지의 방향을 식별하는 데 사용됩니다.

사용자

- Diameter 클라이언트가 요청을 생성한 지원을 위해 일부 리소스를 요청하거나 사용하는 엔터티입니다.

---
## **2.  Protocol Overview**

```text
   The base Diameter protocol may be used by itself for accounting
   applications, but for use in authentication and authorization it is
   always extended for a particular application.  Two Diameter
   applications are defined by companion documents:  NASREQ [NASREQ],
```

모바일 IPv4 \[DIAMMIP\]. 이러한 애플리케이션은 이 문서에 소개되어 있지만 다른 곳에서 지정됩니다. 추가적인 Diameter 애플리케이션은 미래에 정의될 수 있습니다\(섹션 11.3 참조\).\(MAY\)

Diameter 클라이언트는 계정을 포함하는 기본 프로토콜을 지원해야 합니다. 또한 NASREQ 및/또는 모바일 IPv4와 같은 클라이언트 서비스를 구현하는 데 필요한 각 Diameter 애플리케이션을 완전히 지원해야 합니다. NASREQ와 모바일 IPv4를 모두 지원하지 않는 Diameter 클라이언트는 반드시 "Diameter X 클라이언트"라고 해야 합니다. 여기서 X는 지원하는 애플리케이션이지 "Diameter 클라이언트"는 아닙니다.\(MUST, MUST, MUST\)

Diameter 서버는 계정을 포함하는 기본 프로토콜을 지원해야 합니다. 또한, NASREQ 및/또는 모바일 IPv4와 같은 의도된 서비스를 구현하는 데 필요한 각 Diameter 애플리케이션을 완전히 지원해야 합니다. NASREQ와 모바일 IPv4를 모두 지원하지 않는 Diameter 서버는 반드시 "Diameter X Server"라고 해야 하며, 여기서 X는 지원하는 애플리케이션이지 "Diameter Server"는 아닙니다.\(MUST, MUST, MUST\)

Diameter Relay와 리다이렉트 에이전트는 정의에 따라 프로토콜이 투명하며 계정 및 모든 Diameter 애플리케이션을 포함하는 Diameter 기본 프로토콜을 투명하게 지원해야 합니다.\(MUST\)

Diameter 프록시는 계정을 포함하는 기본 프로토콜을 지원해야 합니다. 또한, NASREQ 및/또는 모바일 IPv4와 같은 프록시 서비스를 구현하는 데 필요한 각 Diameter 애플리케이션을 완전히 지원해야 합니다. NASREQ와 모바일 IPv4를 모두 지원하지 않는 Diameter 프록시는 반드시 "Diameter X 프록시"라고 해야 하며, 여기서 X는 지원하는 애플리케이션이지 "Diameter 프록시"는 아닙니다.\(MUST, MUST, MUST\)

기본 Diameter 프로토콜은 기능 협상, 메시지 전송 방법 및 피어가 결국 포기될 수 있는 방법과 관련이 있습니다. 기본 프로토콜은 Diameter 노드 간의 모든 메시지 교환에 적용되는 특정 규칙도 정의합니다.

Diameter 피어 간의 통신은 한 피어가 다른 Diameter 피어에게 메시지를 보내는 것으로 시작됩니다. 메시지에 포함된 AVP 세트는 특정 Diameter 애플리케이션에 의해 결정됩니다. 사용자 세션을 참조하기 위해 포함된 하나의 AVP는 Session-Id입니다.

사용자의 인증 및/또는 권한 부여에 대한 초기 요청에는 Session-Id가 포함됩니다. 그런 다음 Session-Id는 모든 후속 메시지에서 사용자 세션을 식별하는 데 사용됩니다\(자세한 내용은 섹션 8 참조\). 통신 당사자는 요청을 수락하거나 결과 코드 AVP와 함께 응답 메시지를 반환하여 거부할 수 있습니다.

오류가 발생했음을 나타내도록 설정됩니다. 요청을 받는 Diameter 서버나 클라이언트의 구체적인 동작은 사용되는 Diameter 애플리케이션에 따라 달라집니다.

세션 상태\(Session-Id와 연관됨\)는 Session-Termination-Request, Session-Termination-Answer를 수신하고 Session-Timeout AVP에서 승인된 서비스 시간이 만료되면 특정 Diameter에 설정된 규칙에 따라 해제되어야 합니다. 애플리케이션.\(MUST\)

---
### **2.1.  Transport**

전송 프로필은 \[AAATRANS\]에 정의되어 있습니다.

기본 Diameter 프로토콜은 TCP\[TCP\] 및 SCTP\[SCTP\] 전송 프로토콜의 포트 3868에서 실행됩니다.

Diameter 클라이언트는 반드시 TCP 또는 SCTP 중 하나를 지원해야 하며, 에이전트와 서버는 둘 다 지원해야 합니다. 이 사양의 향후 버전에서는 클라이언트가 SCTP를 지원하도록 요구할 수도 있습니다.\(MUST, MAY\)

Diameter 노드는 들어오는 연결을 수락한다고 선언한 포트 이외의 소스 포트에서 연결을 시작할 수 있으며 포트 3868에서 연결을 수신할 준비를 해야 합니다. 피어 상태 머신의 주어진 Diameter 인스턴스는 하나 이상의 전송을 사용해서는 안 됩니다. 피어에 여러 인스턴스가 존재하지 않는 한 특정 피어와 통신하기 위한 연결입니다. 이 경우 프로세스당 별도의 연결이 허용됩니다.\(MUST, MUST NOT\)

피어와의 전송 연결이 존재하지 않으면 연결 시도가 주기적으로 이루어져야 합니다. 이 동작은 권장 값이 30초인 Tc 타이머를 통해 처리됩니다. 피어가 통신을 원하지 않는다고 표시하여 전송 연결을 종료한 경우와 같이 이 규칙에는 특정 예외가 있습니다.\(SHOULD\)

피어에 연결할 때 0개 이상의 전송이 지정되면 SCTP를 먼저 시도한 다음 TCP를 시도해야 합니다. 피어 검색에 대한 자세한 내용은 섹션 5.2를 참조하세요.\(SHOULD\)

다이어미터 구현은 ICMP 프로토콜 포트 도달 불가능 메시지를 해당 메시지 신뢰에 대한 보안 정책에 따라 서버에 도달할 수 없다는 명시적인 표시로 해석할 수 있어야 합니다. Diameter 구현은 또한 전송 및 시간 초과 연결 시도로부터의 재설정을 해석할 수 있어야 합니다\(SHOULD\).\(SHOULD, SHOULD\)

Diameter가 피어에서 발생한 Diameter 오류로 구문 분석되거나 식별될 수 없는 데이터를 TCP에서 수신하는 경우 스트림이 손상되어 복구할 수 없습니다. 전송 연결은 RESET 호출\(TCP RST 비트 전송\) 또는 SCTP ABORT 메시지\(정상적인 종료가 손상됨\)를 사용하여 닫혀야 합니다.\(MUST\)

---
#### **2.1.1.  SCTP Guidelines**

다음은 SCTP를 지원하는 Diameter 구현에 대한 지침입니다.

1. 상호 운용성을 위해: 모든 Diameter 노드는 연관의 모든 SCTP 스트림에서 Diameter 메시지를 수신할 준비를 해야 합니다.\(MUST\)

2. 차단을 방지하려면: 모든 Diameter 노드는 HOL 차단을 방지하기 위해 연결에 사용 가능한 모든 SCTP 스트림을 활용해야 합니다.\(SHOULD\)

---
### **2.2.  Securing Diameter Messages**

NAS\(네트워크 액세스 서버\) 및 모바일 에이전트와 같은 다이어미터 클라이언트는 IP 보안 \[SECARCH\]를 지원해야 하며 TLS \[TLS\]를 지원할 수 있습니다. Diameter 서버는 TLS 및 IPsec을 지원해야 합니다. Diameter 프로토콜은 보안 메커니즘\(TLS 또는 IPsec\) 없이 사용되어서는 안 됩니다.\(MUST, MUST, MUST NOT\)

NAS와 로컬 AAA 프록시 간에 사전 공유 키를 사용하는 등 IPsec은 주로 에지와 도메인 내 트래픽에서 사용할 수 있는 것이 좋습니다. 이는 또한 인증서를 지원하기 위한 NAS의 요구 사항을 완화합니다. 또한 도메인 간 트래픽은 주로 TLS를 사용하는 것이 좋습니다. IPsec 및 TLS 사용에 대한 자세한 내용은 섹션 13.1 및 13.2를 참조하십시오.

---
### **2.3.  Diameter Application Compliance**

애플리케이션 식별자는 기능 교환 단계에서 광고됩니다\(섹션 5.3 참조\). 특정 애플리케이션에 대해 애플리케이션 광고 지원은 발신자가 모든 명령 코드와 사양에 설명된 관련 ABNF에 지정된 AVP를 지원한다는 것을 의미합니다.

구현은 공급업체별 AVP를 포함하여 애플리케이션에 정의된 모든 명령에 임의의 비필수 AVP를 추가할 수 있습니다. 자세한 내용은 섹션 11.1.1을 참조하십시오.\(MAY\)

---
### **2.4.  Application Identifiers**

각 Diameter 애플리케이션에는 IANA 할당 애플리케이션 식별자가 있어야 합니다\(섹션 11.3 참조\). 기본 프로토콜에는 지원이 필수이므로 애플리케이션 식별자가 필요하지 않습니다. 기능 교환 중에 Diameter 노드는 피어에게 로컬로 지원되는 애플리케이션을 알립니다. 또한 모든 Diameter 메시지에는 메시지 전달 프로세스에 사용되는 응용 프로그램 식별자가 포함되어 있습니다.\(MUST\)

다음 응용 프로그램 식별자 값이 정의됩니다.

```text
      Diameter Common Messages      0
      NASREQ                        1 [NASREQ]
      Mobile-IP                     2 [DIAMMIP]
      Diameter Base Accounting      3
      Relay                         0xffffffff
```

릴레이 및 리디렉션 에이전트는 반드시 릴레이 애플리케이션 식별자를 광고해야 하며, 다른 모든 Diameter 노드는 로컬로 지원되는 애플리케이션을 광고해야 합니다. Capability Exchange 메시지 광고 릴레이 서비스의 수신자는 발신자가 현재 및 미래의 모든 애플리케이션을 지원한다고 가정해야 합니다.\(MUST, MUST\)

Diameter 릴레이 및 프록시 에이전트는 특정 메시지의 적용을 지원하는 업스트림 서버를 찾는 일을 담당합니다. 아무 것도 찾을 수 없는 경우 DIAMETER\_UNABLE\_TO\_DELIVER로 설정된 결과 코드 AVP와 함께 오류 메시지가 반환됩니다.

---
### **2.5.  Connections vs. Sessions**

이 섹션에서는 독자에게 이 문서 전반에 걸쳐 광범위하게 사용되는 용어인 연결과 세션 간의 차이점에 대한 이해를 제공하려고 합니다.

연결은 Diameter 메시지를 보내고 받는 데 사용되는 두 피어 간의 전송 수준 연결입니다. 세션은 애플리케이션 계층의 논리적 개념으로, 액세스 장치와 서버 간에 공유되며 Session-Id AVP를 통해 식별됩니다.

```text
          +--------+          +-------+          +--------+
          | Client |          | Relay |          | Server |
          +--------+          +-------+          +--------+
                   <---------->       <---------->
                peer connection A   peer connection B

                   <----------------------------->
                           User session x
```

- 그림 1: 직경 연결 및 세션

그림 1에 제공된 예에서 피어 연결 A는 클라이언트와 해당 로컬 릴레이 사이에 설정됩니다. 피어 연결 B는 릴레이와 서버 사이에 설정됩니다. 사용자 세션 X는 클라이언트에서 릴레이를 통해 서버까지 이어집니다. 서비스의 각 "사용자"는 고유한 세션 식별자와 함께 인증 요청이 전송되도록 합니다. 서버가 수락하면 클라이언트와 서버 모두 세션을 인식합니다. 연결과 세션 사이에는 아무런 관계가 없으며 여러 세션에 대한 Diameter 메시지는 모두 단일 연결을 통해 다중화된다는 점에 유의하는 것이 중요합니다.

---
### **2.6.  Peer Table**

Diameter 피어 테이블은 메시지 전달에 사용되며 영역 라우팅 테이블에서 참조됩니다. 피어 테이블 항목에는 다음 필드가 포함됩니다.

호스트 ID

- 섹션 4.4의 DiameterIdentity 파생 AVP 데이터 형식에 대해 설명된 규칙을 따릅니다. 이 필드에는 CER 또는 CEA 메시지에서 발견된 Origin-Host\(섹션 6.3\) AVP의 내용이 포함됩니다.

상태T

- 이는 피어 항목의 상태이며 섹션 5.6에 나열된 값 중 하나와 일치해야 합니다.\(MUST\)

정적 또는 동적

- 피어 항목이 정적으로 구성되었는지 아니면 동적으로 검색되었는지 지정합니다.

만료 시간

- 동적으로 검색된 피어 테이블 항목이 새로 고쳐지거나 만료되는 시간을 지정합니다.

TLS 활성화됨

- 피어와 통신할 때 TLS를 사용할지 여부를 지정합니다.

```text
   Additional security information, when needed (e.g., keys,
   certificates)
```

---
### **2.7.  Realm-Based Routing Table**

모든 영역 기반 라우팅 조회는 일반적으로 영역 라우팅 테이블\(섹션 12 참조\)로 알려진 것에 대해 수행됩니다. 영역 라우팅 테이블 항목에는 다음 필드가 포함됩니다.

영역 이름

- 일반적으로 라우팅 테이블 조회에서 기본 키로 사용되는 필드입니다. 일부 구현에서는 정확한 일치를 요구하기보다는 영역의 오른쪽에서 가장 긴 일치를 기반으로 조회를 수행합니다.

애플리케이션 식별자

- 애플리케이션은 공급업체 ID와 애플리케이션 ID로 식별됩니다. 모든 IETF 표준 트랙 Diameter 애플리케이션의 경우 공급업체 ID는 0입니다. 경로 항목은 메시지의 애플리케이션 식별 AVP에 따라 다른 대상을 가질 수 있습니다. 이 필드는 라우팅 테이블 조회에서 보조 키 필드로 사용해야 합니다.\(MUST\)

지역 활동

- 로컬 작업 필드는 메시지 처리 방법을 식별하는 데 사용됩니다. 다음 작업이 지원됩니다.

- 1. LOCAL - 로컬 작업이 로컬로 설정된 경로 항목으로 확인되는 Diameter 메시지는 로컬에서 충족될 수 있으며 다른 서버로 라우팅될 필요가 없습니다.

- 2. RELAY - 이 카테고리에 속하는 모든 Diameter 메시지는 라우팅되지 않는 AVP를 수정하지 않고 다음 홉 서버로 라우팅되어야 합니다. 중계 지침은 섹션 6.1.8을 참조하세요.\(MUST\)

- 3. 프록시 - 이 범주에 속하는 모든 Diameter 메시지는 다음 홉 서버로 라우팅되어야 합니다. 로컬 서버는 라우팅 전에 메시지에 새로운 AVP를 포함시켜 메시지에 로컬 정책을 적용할 수 있습니다. 프록시 지침은 섹션 6.1.8을 참조하세요.\(MUST, MAY\)

- 4. REDIRECT - 이 카테고리에 속하는 Diameter 메시지에는 홈 Diameter 서버의 ID가 추가되어 메시지 발신자에게 반환되어야 합니다. 리디렉션 지침은 섹션 6.1.7을 참조하세요.\(MUST\)

서버 식별자

- 메시지가 라우팅될 하나 이상의 서버. 이러한 서버는 피어 테이블에도 있어야 합니다. 로컬 작업이 RELAY 또는 PROXY로 설정된 경우 이 필드에는 메시지가 라우팅되어야 하는 서버의 ID가 포함됩니다. 로컬 작업 필드가 REDIRECT로 설정된 경우 이 필드에는 메시지가 리디렉션되어야 하는 하나 이상의 서버 ID가 포함됩니다.\(MUST\)

정적 또는 동적

- 경로 항목이 정적으로 구성되었는지 아니면 동적으로 검색되었는지 지정합니다.

만료 시간

- 동적으로 검색된 경로 테이블 항목이 만료되는 시간을 지정합니다.

Diameter 에이전트는 LOCAL, RELAY, PROXY 또는 REDIRECT 작업 모드 중 적어도 하나를 지원해야 한다는 점에 유의하는 것이 중요합니다. 에이전트는 프로토콜 사양을 준수하기 위해 모든 작동 모드를 지원할 필요는 없지만 섹션 2의 프로토콜 준수 지침을 따라야 합니다. 릴레이 에이전트는 AVP를 재정렬해서는 안 되며, 프록시는 AVP를 재정렬하면 안 됩니다.\(MUST, MUST, MUST NOT\)

라우팅 테이블에는 다른 항목과 일치하지 않는 요청에 반드시 사용해야 하는 기본 항목이 포함될 수 있습니다. 라우팅 테이블은 그러한 항목으로만 구성될 수 있습니다.\(MUST, MAY\)

요청이 라우팅될 때 대상 서버는 주어진 메시지에 대한 애플리케이션 식별자\(섹션 2.4 참조\)를 광고했거나 자신을 릴레이 또는 프록시 에이전트로 광고해야 합니다. 그렇지 않으면 DIAMETER\_UNABLE\_TO\_DELIVER로 설정된 결과 코드 AVP와 함께 오류가 반환됩니다.\(MUST\)

---
### **2.8.  Role of Diameter Agents**

클라이언트와 서버 외에도 Diameter 프로토콜은 섹션 1.3에 정의된 릴레이, 프록시, 리디렉션 및 변환 에이전트를 도입합니다. 이러한 Diameter 에이전트는 여러 가지 이유로 유용합니다.

- 보안 연결 유지 관리를 포함하여 시스템 관리를 구성 가능한 그룹으로 분산할 수 있습니다.

- 함께 배치되거나 분산된 여러 NAS 장비 세트의 요청을 유사한 사용자 그룹 세트로 집중시키는 데 사용할 수 있습니다.

- 요청이나 응답에 부가 가치 처리를 수행할 수 있습니다.

- 로드 밸런싱에 사용할 수 있습니다.

- 복잡한 네트워크에는 여러 인증 소스가 있으며 요청을 정렬하고 올바른 대상으로 전달할 수 있습니다.

Diameter 프로토콜은 에이전트가 장애 조치 목적으로 사용되는 트랜잭션 상태를 유지하도록 요구합니다. 트랜잭션 상태는 요청 전달 시 해당 홉별 식별자가 저장됨을 의미합니다. 필드는 로컬에서 고유한 식별자로 대체되며 해당 답변이 수신되면 원래 값으로 복원됩니다. 요청 상태는 응답을 받으면 해제됩니다. 상태 비저장 에이전트는 트랜잭션 상태만 유지하는 에이전트입니다.

Proxy-Info AVP를 사용하면 Stateless 에이전트가 Diameter 요청에 로컬 상태를 추가할 수 있으며 응답에 동일한 상태가 표시된다는 보장이 있습니다. 그러나 프로토콜의 장애 조치 절차에서는 에이전트가 보류 중인 요청의 복사본을 유지해야 합니다.

상태 저장 에이전트는 세션 상태 정보를 유지하는 에이전트입니다. 승인된 모든 활성 세션을 추적합니다. 승인된 각 세션은 특정 서비스에 바인딩되며 해당 상태는 별도로 통지될 때까지 또는 만료될 때까지 활성 상태로 간주됩니다. 승인된 각 세션에는 만료가 있으며 이는 Session-Timeout AVP를 통해 Diameter 서버에 의해 전달됩니다.

세션 상태를 유지하는 것은 다음과 같은 특정 응용 프로그램에서 유용할 수 있습니다.\(MAY\)

```text
   -  Protocol translation (e.g., RADIUS <-> Diameter)
```

- 특정 사용자에게 권한이 부여된 자원을 제한

- 사용자별 또는 거래별 감사

Diameter 에이전트는 일부 요청에 대해서는 상태 저장 방식으로 작동하고 다른 요청에 대해서는 상태 비저장 방식으로 작동할 수 있습니다. Diameter 구현은 일부 요청에 대해서는 한 유형의 에이전트로 작동하고 다른 요청에 대해서는 다른 유형의 에이전트로 작동할 수 있습니다.\(MAY, MAY\)

---
#### **2.8.1.  Relay Agents**

릴레이 에이전트는 요청을 수락하고 메시지에서 발견된 정보\(예: 대상 영역\)를 기반으로 메시지를 다른 Diameter 노드로 라우팅하는 Diameter 에이전트입니다. 이 라우팅 결정은 지원되는 영역 및 알려진 피어 목록을 사용하여 수행됩니다. 이는 섹션 2.7에서 자세히 정의된 대로 영역 라우팅 테이블로 알려져 있습니다.

릴레이는 공통 지리적 영역\(POP\) 내의 여러 네트워크 액세스 서버\(NAS\)의 요청을 집계하는 데 사용될 수 있습니다. 릴레이를 사용하면 다른 영역의 Diameter 서버와 통신하는 데 필요한 필수 보안 정보로 NAS를 구성할 필요가 없기 때문에 유리합니다. 마찬가지로 이는 NAS가 추가, 변경 또는 삭제될 때 필요한 Diameter 서버의 구성 부하를 줄여줍니다.\(MAY\)

릴레이는 라우팅 정보를 삽입하고 제거하여 Diameter 메시지를 수정하지만 메시지의 다른 부분은 수정하지 않습니다. 릴레이는 세션 상태를 유지해서는 안 되지만 트랜잭션 상태는 유지해야 합니다.\(MUST\)

```text
    +------+    --------->     +------+     --------->    +------+
    |      |    1. Request     |      |     2. Request    |      |
    | NAS  |                   | DRL  |                   | HMS  |
    |      |    4. Answer      |      |     3. Answer     |      |
    +------+    <---------     +------+     <---------    +------+
   example.net                example.net                example.com
```

- 그림 2: Diameter 메시지 중계

그림 2에 제공된 예는 사용자 bob@example.com에 대해 액세스 장치인 NAS에서 발행된 요청을 보여줍니다. 요청을 보내기 전에 NAS는 "example.com"을 키로 사용하여 Diameter 경로 조회를 수행하고 해당 메시지가 Diameter Relay인 DRL로 중계되도록 결정합니다. DRL은 NAS와 동일한 경로 조회를 수행하고 메시지를 example.com의 Home Diameter Server인 HMS로 중계합니다. HMS는 요청이 \(영역을 통해\) 로컬로 지원될 수 있음을 식별하고, 인증 및/또는 권한 부여 요청을 처리하고, 저장된 트랜잭션 상태를 사용하여 다시 NAS로 라우팅되는 답변으로 응답합니다.

Relays는 애플리케이션 수준 처리를 수행하지 않기 때문에 모든 Diameter 애플리케이션에 대한 중계 서비스를 제공하므로 반드시 Relay Application Identifier를 광고해야 합니다.\(MUST\)

---
#### **2.8.2.  Proxy Agents**

릴레이와 마찬가지로 프록시 에이전트는 Diameter 라우팅 테이블을 사용하여 Diameter 메시지를 라우팅합니다. 그러나 정책 시행을 구현하기 위해 메시지를 수정한다는 점에서 다릅니다. 이를 위해서는 프록시가 다운스트림 피어\(예: 액세스 장치\)의 상태를 유지하여 리소스 사용을 시행하고 허용 제어 및 프로비저닝을 제공해야 합니다.

프록시가 NAS에 부가 가치 기능을 제공할 수도 있지만 메시지를 수정하면 인증이 중단되므로 액세스 장치가 종단 간 보안을 사용하는 것을 허용하지 않는다는 점에 유의하는 것이 중요합니다.\(MAY\)

프록시는 콜 제어 센터 또는 아웃소싱 연결을 제공하는 액세스 ISP에서 사용될 수 있으며, 사용 중인 포트의 수와 유형을 모니터링하고 구성에 따라 할당 및 허용 결정을 내릴 수 있습니다.\(MAY\)

리소스를 제한하려는 프록시는 세션 상태를 유지해야 합니다. 모든 프록시는 트랜잭션 상태를 유지해야 합니다.\(MUST, MUST\)

정책을 시행하려면 제공되는 서비스에 대한 이해가 필요하므로 프록시는 자신이 지원하는 Diameter 애플리케이션만 광고해야 합니다.\(MUST\)

---
#### **2.8.3.  Redirect Agents**

리디렉션 에이전트는 Diameter 라우팅 구성을 중앙 집중화해야 하는 시나리오에서 유용합니다. 예를 들어 컨소시엄의 모든 구성원에게 서비스를 제공하지만 영역 간에 모든 메시지를 중계하는 부담을 원하지 않는 리디렉션 에이전트가 있습니다. 이 시나리오는 구성원의 인프라가 변경될 때 컨소시엄이 구성원에게 라우팅 업데이트를 제공할 필요가 없기 때문에 유리합니다.

리다이렉트 에이전트는 메시지를 중계하지 않고, Diameter 에이전트가 직접 통신하는 데 필요한 정보만 답변으로 반환하므로 메시지를 수정하지 않는다. 리디렉션 에이전트는 응답 메시지를 받지 않으므로 세션 상태를 유지할 수 없습니다. 또한 리디렉션 에이전트는 요청을 릴레이하지 않으므로 트랜잭션 상태를 유지할 필요가 없습니다.

그림 3에 제공된 예는 사용자 bob@example.com에 대해 액세스 장치인 NAS에서 발행된 요청을 보여줍니다. 메시지는 NAS에 의해 example.com의 Diameter 라우팅 테이블에 라우팅 항목이 없는 릴레이인 DRL로 전달됩니다. DRL에는 HMS의 연락처 정보뿐만 아니라 DRL에 리디렉션 알림을 반환하는 리디렉션 에이전트인 DRD로 구성된 기본 경로가 있습니다. 리디렉션 알림을 받으면 DRL은 HMS와의 전송 연결을 설정하고\(아직 존재하지 않는 경우\) 요청을 전달합니다.

```text
                               +------+
                               |      |
                               | DRD  |
                               |      |
                               +------+
                                ^    |
                    2. Request  |    | 3. Redirection
                                |    |    Notification
                                |    v
    +------+    --------->     +------+     --------->    +------+
    |      |    1. Request     |      |     4. Request    |      |
    | NAS  |                   | DRL  |                   | HMS  |
    |      |    6. Answer      |      |     5. Answer     |      |
    +------+    <---------     +------+     <---------    +------+
   example.net                example.net               example.com

                 Figure 3: Redirecting a Diameter Message
```

리디렉션 에이전트는 애플리케이션 수준 처리를 수행하지 않기 때문에 모든 Diameter 애플리케이션에 대한 릴레이 서비스를 제공하므로 반드시 릴레이 애플리케이션 식별자를 광고해야 합니다.\(MUST\)

---
#### **2.8.4.  Translation Agents**

변환 에이전트는 두 프로토콜\(예: RADIUS<-\>Diameter, TACACS+<-\>Diameter\) 간의 변환을 제공하는 장치입니다. 번역 에이전트는 Diameter 인프라와 통신하기 위한 집계 서버로 사용되는 동시에 임베디드 시스템을 더 느린 속도로 마이그레이션할 수 있습니다.

Diameter 프로토콜이 수명이 긴 인증 세션 개념을 도입한다는 점을 고려하면 변환 에이전트는 반드시 세션 상태를 유지해야 하며 트랜잭션 상태를 유지해야 합니다.\(MUST\)

메시지 번역은 에이전트가 특정 요청의 애플리케이션을 인식하는 경우에만 발생할 수 있으므로 번역 에이전트는 로컬에서 지원되는 애플리케이션만 광고해야 합니다.\(MUST\)

```text
    +------+    --------->     +------+     --------->    +------+
    |      |  RADIUS Request   |      |  Diameter Request |      |
    | NAS  |                   | TLA  |                   | HMS  |
    |      |  RADIUS Answer    |      |  Diameter Answer  |      |
    +------+    <---------     +------+     <---------    +------+
   example.net                example.net               example.com

                Figure 4: Translation of RADIUS to Diameter
```

---
### **2.9.  End-to-End Security Framework**

엔드투엔드 보안 서비스에는 기밀성 및 메시지 원본 인증이 포함됩니다. 이러한 서비스는 에이전트를 통해 통신하는 두 피어 간의 AVP 무결성 및 기밀성을 지원하여 제공됩니다.

종단 간 보안은 \[AAACMS\]에 설명된 종단 간 보안 확장을 통해 제공됩니다. 종단 간 보안을 사용해야 하는 상황은 각 피어의 정책에 따라 결정됩니다. 표준화의 대상이 아닌 보안정책은 Next Hop Diameter Peer별로 적용될 수도 있고 Destination Realm별로 적용될 수도 있다. 예를 들어 TLS 또는 IPsec 전송 수준 보안이 충분한 경우 종단 간 보안이 필요하지 않을 수 있습니다.

```text
   End-to-end security policies include:

   -  Never use end-to-end security.
```

- 민감한 AVP가 포함된 메시지에 엔드투엔드 보안을 사용합니다. 민감한 AVP는 서비스 제공업체 정책에 따라 결정됩니다. 키와 비밀번호가 포함된 AVP는 민감한 것으로 간주되어야 합니다. 회계 AVP는 민감한 것으로 간주될 수 있습니다. P 비트가 설정되거나 암호화될 수 있는 모든 AVP는 민감한 것으로 간주될 수 있습니다.

```text
   -  Always use end-to-end security.
```

모든 Diameter 구현이 종단 간 보안을 지원하는 것이 강력히 권장됩니다.\(SHOULD\)

---
### **2.10.  Diameter Path Authorization**

섹션 2.2에 명시된 대로 Diameter에서는 각 연결\(TLS 또는 IPsec\)에 전송 수준 보안을 사용해야 합니다. 따라서 각 연결은 패킷별로 인증되고 재생 및 무결성이 보호되고 기밀이 유지됩니다.

각 연결을 인증하는 것 외에도 각 연결과 전체 세션도 인증되어야 합니다. 연결을 시작하기 전에 Diameter Peer는 해당 피어가 자신의 역할을 수행할 권한이 있는지 확인해야 합니다. 예를 들어, Diameter 피어는 인증될 수 있지만 이것이 Diameter 애플리케이션 세트를 광고하는 Diameter 서버 역할을 할 권한이 있다는 의미는 아닙니다.\(MUST, MUST\)

연결을 시작하기 전에 경로를 따라 각 연결에서 인증 확인이 수행됩니다. 각 피어가 어떤 Diameter 애플리케이션을 지원하는지 결정하기 위해 Diameter 기능 협상\(CER/CEA\)도 수행되어야 합니다. Diameter 세션은 세션에 필요한 Diameter 애플리케이션에 대한 지원을 광고한 승인된 노드를 통해서만 라우팅되어야 합니다.\(MUST, MUST\)

섹션 6.1.8에 명시된 대로 릴레이 또는 프록시 에이전트는 전달된 모든 요청에 ​​경로 기록 AVP를 추가해야 합니다. AVP에는 요청을 받은 피어의 ID가 포함되어 있습니다.\(MUST\)

홈 Diameter 서버는 세션을 승인하기 전에 Route-Record AVP를 확인하여 요청이 통과한 경로가 허용 가능한지 확인해야 합니다. 예를 들어, 홈 영역 내의 관리자는 신뢰할 수 없는 영역을 통해 라우팅된 요청을 받아들이고 싶지 않을 수 있습니다. 요청을 승인함으로써 홈 Diameter 서버는 서버와 이전 홉 간의 계약 관계에 지정된 대로 비즈니스 트랜잭션에 참여하려는 의지를 암시적으로 나타냅니다. 요청에 의해 통과된 경로가 허용되지 않는 경우 DIAMETER\_AUTHORIZATION\_REJECTED 오류 메시지\(섹션 7.1.5 참조\)가 전송됩니다.\(MUST\)

홈 영역은 각 계정 요청 메시지가 세션을 승인하는 Diameter 응답에 해당하는지 확인하기를 원할 수도 있습니다. 해당 승인 응답이 없는 계정 요청은 요청된 서비스와 제공된 서비스 간의 차이를 나타내는 계정 요청과 마찬가지로 추가 조사를 받아야 합니다.\(SHOULD\)

마찬가지로, 로컬 Diameter 에이전트는 세션을 승인하는 Diameter 응답을 수신할 때 응답이 통과한 경로가 허용 가능한지 확인하기 위해 Route-Record AVP를 확인해야 합니다. 각 단계에서 승인 응답을 전달하는 것은 세션과 관련된 재정적 위험을 기꺼이 감수하겠다는 의지의 증거로 간주됩니다. 예를 들어, 로컬 영역은 중간 영역에 대한 신용 한도를 설정하고 해당 한도를 위반하는 응답을 거부함으로써 이러한 노출을 제한할 수 있습니다. 권한 부여 응답에 해당하는 계정 요청을 발행함으로써 로컬 영역은 권한 부여 응답에 표시된 서비스를 제공하겠다는 동의를 암시적으로 나타냅니다. 로컬 영역에서 서비스를 제공할 수 없는 경우 DIAMETER\_UNABLE\_TO\_COMPLY 오류 메시지가 계정 요청 내에서 전송되어야 합니다. 수행할 수 없는 서비스에 대한 인증 응답을 수신하는 Diameter 클라이언트는 대체 서비스를 대체해서는 안 되며, 대신 대체 서비스에 대한 계정 요청을 보내면 안 됩니다.\(MUST, MUST NOT\)

---
## **3.  Diameter Header**

Diameter 헤더 형식의 요약은 다음과 같습니다. 필드는 네트워크 바이트 순서로 전송됩니다.

```text
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    Version    |                 Message Length                |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | command flags |                  Command-Code                 |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                         Application-ID                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      Hop-by-Hop Identifier                    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      End-to-End Identifier                    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  AVPs ...
   +-+-+-+-+-+-+-+-+-+-+-+-+-
```

버전

- 이 버전 필드는 직경 버전 1을 나타내기 위해 1로 설정되어야 합니다.\(MUST\)

메시지 길이

- 메시지 길이 필드는 3옥텟으로 헤더 필드를 포함한 Diameter 메시지의 길이를 나타낸다.

명령 플래그

- 명령 플래그 필드는 8비트입니다. 다음 비트가 할당됩니다:

```text
       0 1 2 3 4 5 6 7
      +-+-+-+-+-+-+-+-+
      |R P E T r r r r|
      +-+-+-+-+-+-+-+-+

      R(equest)   - If set, the message is a request.  If cleared, the
                    message is an answer.
      P(roxiable) - If set, the message MAY be proxied, relayed or
                    redirected.  If cleared, the message MUST be
                    locally processed.
      E(rror)     - If set, the message contains a protocol error,
                    and the message will not conform to the ABNF
                    described for this command.  Messages with the 'E'
```

비트 세트는 일반적으로 오류라고 합니다.

- 메시지. 이 비트는 요청 메시지에 설정되어서는 안 됩니다. 섹션 7.2를 참조하세요. T\(잠재적으로 재전송된 메시지\) - 이 플래그는 중복 요청 제거를 돕기 위해 링크 장애 조치 절차 후에 설정됩니다. 링크 실패로 인해 중복 가능성이 있음을 표시하기 위해 아직 확인되지 않은 요청을 재전송할 때 설정됩니다. 이 비트는 처음으로 요청을 보낼 때 지워져야 하며, 그렇지 않으면 보낸 사람이 이 플래그를 설정해야 합니다. Diameter 에이전트는 수신된 단일 요청을 기반으로 보내는 요청 수에만 관심을 가지면 됩니다. 다른 엔터티에 의한 재전송은 추적할 필요가 없습니다. T 플래그가 설정된 요청을 수신하는 Diameter 에이전트는 전달된 요청에 T 플래그 세트를 유지해야 합니다. 이전 메시지에 대해 오류 응답 메시지\(예: 프로토콜 오류\)가 수신된 경우 이 플래그를 설정하면 안 됩니다. 요청에 대해 서버로부터 응답을 받지 못하고 다시 요청을 보내는 경우에만 설정할 수 있습니다. 이 플래그는 응답 메시지에 설정되어서는 안 됩니다.\(MUST NOT, MUST, MUST, MUST NOT, MUST NOT\)

- r\(예약됨\) - 이 플래그 비트는 향후 사용을 위해 예약되어 있으며 반드시 0으로 설정되어야 하며 수신자에서 무시됩니다.\(MUST\)

명령 코드

- Command-Code 필드는 3옥텟으로, 메시지와 관련된 명령을 전달하기 위해 사용됩니다. 24비트 주소 공간은 IANA에 의해 관리됩니다\(섹션 11.2.1 참조\).

- 명령 코드 값 16,777,214 및 16,777,215\(16진수 값 FFFFFE -FFFFFF\)는 실험용으로 예약되어 있습니다\(섹션 11.3 참조\).

애플리케이션 ID

- Application-ID는 4옥텟으로 메시지가 적용 가능한 애플리케이션을 식별하는 데 사용됩니다. 애플리케이션은 인증 애플리케이션, 회계 애플리케이션 또는 공급업체별 애플리케이션일 수 있습니다. application-id가 사용할 수 있는 가능한 값은 섹션 11.3을 참조하세요.

- 헤더의 애플리케이션 ID는 메시지에 포함된 관련 AVP에 포함된 것과 동일해야 합니다.\(MUST\)

홉별 식별자

- 홉별 식별자는 부호 없는 32비트 정수 필드\(네트워크 바이트 순서\)이며 요청과 응답 일치에 도움이 됩니다. 발신자는 요청의 홉별 식별자가 주어진 시간에 특정 연결에서 고유한지 확인해야 하며, 재부팅 시 해당 번호가 고유한지 확인하려고 시도할 수 있습니다. 응답 메시지의 발신자는 홉별 식별자 필드에 해당 요청에서 발견된 것과 동일한 값이 포함되어 있는지 확인해야 합니다. 홉별 식별자는 일반적으로 시작 값이 무작위로 생성된 단조 증가하는 숫자입니다. 알려지지 않은 홉별 식별자로 수신된 응답 메시지는 반드시 폐기되어야 합니다.\(MUST, MUST, MUST\)

종단 간 식별자

- 종단 간 식별자는 부호 없는 32비트 정수 필드\(네트워크 바이트 순서\)이며 중복 메시지를 감지하는 데 사용됩니다. 재부팅 시 구현은 상위 12비트를 현재 시간의 하위 12비트를 포함하도록 설정하고 하위 20비트를 임의의 값으로 설정할 수 있습니다. 요청 메시지의 발신자는 각 메시지에 고유 식별자를 삽입해야 합니다. 식별자는 재부팅 후에도 최소 4분 동안 로컬에서 고유하게 유지되어야 합니다. 응답 메시지의 발신자는 종단 간 식별자 필드에 해당 요청에서 발견된 것과 동일한 값이 포함되어 있는지 확인해야 합니다. 종단 간 식별자는 어떤 종류의 Diameter 에이전트에 의해서도 수정되어서는 안 됩니다. Origin-Host\(섹션 6.3 참조\)와 이 필드의 조합은 중복을 검색하는 데 사용됩니다. 중복 요청은 동일한 응답이 전송되도록 해야 하며\(홉별 식별자 필드 및 존재할 수 있는 모든 라우팅 AVP를 모듈로\) 원래 요청이 처리될 때 설정된 상태에 영향을 주어서는 안 됩니다. 로컬에서 소비되는 중복 응답 메시지\(섹션 6.2 참조\)는 자동으로 삭제되어야 합니다.\(MAY, MUST, MUST, MUST, MUST NOT, MUST NOT, SHOULD\)

AVP

- AVP는 Diameter 메시지와 관련된 정보를 캡슐화하는 방법입니다. AVP에 대한 자세한 내용은 섹션 4를 참조하세요.

---
### **3.1.  Command Codes**

각 명령 요청/응답 쌍에는 명령 코드가 할당되며 하위 유형\(예: 요청 또는 응답\)은 Diameter 헤더의 명령 플래그 필드에 있는 'R' 비트를 통해 식별됩니다.

모든 Diameter 메시지는 헤더의 Command-Code 필드에 명령 코드를 포함해야 하며, 이는 특정 메시지에 대해 수행할 작업을 결정하는 데 사용됩니다. 다음 명령 코드는 Diameter 기본 프로토콜에 정의되어 있습니다.\(MUST\)

```text
   Command-Name             Abbrev.    Code       Reference
   --------------------------------------------------------
   Abort-Session-Request     ASR       274           8.5.1
   Abort-Session-Answer      ASA       274           8.5.2
   Accounting-Request        ACR       271           9.7.1
   Accounting-Answer         ACA       271           9.7.2
   Capabilities-Exchange-    CER       257           5.3.1
      Request
   Capabilities-Exchange-    CEA       257           5.3.2
      Answer
   Device-Watchdog-Request   DWR       280           5.5.1
   Device-Watchdog-Answer    DWA       280           5.5.2
   Disconnect-Peer-Request   DPR       282           5.4.1
   Disconnect-Peer-Answer    DPA       282           5.4.2
   Re-Auth-Request           RAR       258           8.3.1
   Re-Auth-Answer            RAA       258           8.3.2
   Session-Termination-      STR       275           8.4.1
      Request
   Session-Termination-      STA       275           8.4.2
      Answer
```

---
### **3.2.  Command Code ABNF specification**

정의된 모든 명령 코드는 반드시 존재해야 하거나 존재할 수 있는 AVP를 정의하는 데 사용되는 해당 ABNF 사양을 포함해야 합니다. 정의에는 다음 형식이 사용됩니다.\(MUST\)

```text
   command-def      = command-name "::=" diameter-message

   command-name     = diameter-name

   diameter-name    = ALPHA *(ALPHA / DIGIT / "-")

   diameter-message = header  [ *fixed] [ *required] [ *optional]
                      [ *fixed]

   header           = "<" Diameter-Header:" command-id
                      [r-bit] [p-bit] [e-bit] [application-id]">"

   application-id   = 1*DIGIT

   command-id       = 1*DIGIT
                      ; The Command Code assigned to the command
```

r-비트 = ", REQ"

- ; 존재하는 경우 Command의 'R' 비트입니다. 플래그가 설정되어 메시지가 ; 대답이 아니라 요청입니다.

p-비트 = ", PXY"

- ; 존재하는 경우 Command의 'P' 비트입니다. 플래그가 설정되어 메시지가 ; 프록시 가능합니다.

전자비트 = ", ERR"

- ; 존재하는 경우 명령에 'E' 비트가 있습니다. 플래그가 설정되어 응답을 나타냅니다. 메시지에는 Result-Code AVP가 포함되어 있습니다. "프로토콜 오류" 클래스.

```text
   fixed            = [qual] "<" avp-spec ">"
                      ; Defines the fixed position of an AVP
```

필수 = \[qual\] "{" avp-spec "}"

- ; AVP는 반드시 존재해야 하며 나타날 수 있습니다. 메시지의 아무 곳에나 있습니다.\(MUST\)

선택 사항 = \[qual\] "\[" avp-name "\]"

- ; '선택적' 규칙의 avp-name은 다음과 같습니다. 포함된 AVP 이름으로 평가됩니다. 고정된 또는 필수 규칙에서. AVP는 다음을 수행할 수 있습니다. 메시지의 아무 곳에나 나타납니다.

```text
   qual             = [min] "*" [max]
                      ; See ABNF conventions, RFC 2234 Section 6.6.
                      ; The absence of any qualifiers depends on whether
                      ; it precedes a fixed, required, or optional
                      ; rule.  If a fixed or required rule has no
                      ; qualifier, then exactly one such AVP MUST
                      ; be present.  If an optional rule has no
                      ; qualifier, then 0 or 1 such AVP may be
                      ; present.
                      ;
                      ; NOTE:  "[" and "]" have a different meaning
                      ; than in ABNF (see the optional rule, above).
                      ; These braces cannot be used to express
                      ; optional fixed rules (such as an optional
                      ; ICV at the end).  To do this, the convention
                      ; is '0*1fixed'.
```

최소 = 1\*DIGIT

- ; 요소가 가능한 최소 횟수입니다. 참석하세요. 기본값은 0입니다.

최대 = 1\*DIGIT

- ; 요소가 수행할 수 있는 최대 횟수입니다. 참석하세요. 기본값은 무한대입니다. ㅏ ; 0의 값은 AVP가 절대로 있어서는 안 된다는 것을 의미합니다. 현재의.\(MUST NOT\)

avp-spec = 직경 이름

- ; avp-spec은 정의된 AVP 이름이어야 합니다. 기본 또는 확장된 직경에서; 명세서.

avp-이름 = avp-spec / "AVP"

- ; 문자열 "AVP"는 \*any\* 임의 를 나타냅니다. 와 충돌하지 않는 AVP 이름; 에 정의된 필수 또는 고정 위치 AVP; 명령 코드 정의.

다음은 가상의 명령 코드에 대한 정의입니다.

```text
   Example-Request ::= < "Diameter-Header: 9999999, REQ, PXY >
                       { User-Name }
                     * { Origin-Host }
                     * [ AVP
```

---
### **3.3.  Diameter Command Naming Conventions**

Diameter 명령 이름에는 일반적으로 하나 이상의 영어 단어와 동사 Request 또는 Answer가 포함됩니다. 각 영어 단어는 하이픈으로 구분됩니다. 요청과 답변 모두에 대한 세 글자 약어도 일반적으로 제공됩니다.

예를 들어 세션을 종료하는 데 사용되는 메시지 세트가 있습니다. 명령 이름은 Session-Terminate-Request 및 Session-Terminate-Answer이고 약어는 각각 STR 및 STA입니다.

주어진 명령에 대한 요청과 응답은 모두 동일한 명령 코드를 공유합니다. 요청은 1로 설정된 Diameter 헤더의 R\(equest\) 비트로 식별되며 사용자에게 권한을 부여하거나 세션을 종료하는 등 특정 작업을 수행하도록 요청합니다. 수신자가 요청을 완료하면 다음 중 하나를 전달하는 결과 코드를 포함하는 해당 답변을 발행합니다.

- 요청이 성공했습니다.

- 요청이 실패했습니다.

- 성공 또는 실패 응답을 반환하기 전에 피어가 요구하는 정보를 제공하기 위해 추가 요청을 보내야 합니다.

- 수신자가 요청을 처리할 수 없었지만,

- 요청을 만족시킬 수 있는 Diameter 피어에 대한 정보\(리디렉션이라고 함\)

AVP 내에 인코딩된 추가 정보도 응답 메시지에 포함될 수 있습니다.\(MAY\)

---
## **4.  Diameter AVPs**

Diameter AVP는 특정 인증, 회계, 권한 부여, 라우팅 및 보안 정보는 물론 요청 및 응답에 대한 구성 세부 정보도 전달합니다.

일부 AVP는 두 번 이상 나열될 수 있습니다. 이러한 AVP의 효과는 구체적이며 AVP 설명에 따라 각 경우에 지정됩니다.\(MAY\)

OctetString 유형의 각 AVP는 32비트 경계에 정렬되도록 패딩되어야 하며, 다른 AVP 유형은 자연스럽게 정렬되어야 합니다. 단어 경계에 도달할 때까지 다수의 0 값 바이트가 AVP 데이터 필드 끝에 추가됩니다. 패딩의 길이는 AVP 길이 필드에 반영되지 않습니다.\(MUST\)

---
### **4.1.  AVP Header**

AVP 헤더의 필드는 네트워크 바이트 순서로 전송되어야 합니다. 헤더의 형식은 다음과 같습니다.\(MUST\)

```text
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                           AVP Code                            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |V M P r r r r r|                  AVP Length                   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        Vendor-ID (opt)                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    Data ...
   +-+-+-+-+-+-+-+-+
```

AVP 코드

- Vendor-Id 필드와 결합된 AVP 코드는 속성을 고유하게 식별합니다. AVP 번호 1\~255는 Vendor-Id 필드를 설정하지 않고 RADIUS와의 이전 버전과의 호환성을 위해 예약되어 있습니다. AVP 번호 256 이상은 IANA에서 할당한 직경에 사용됩니다\(섹션 11.1 참조\).

AVP 플래그

- AVP 플래그 필드는 수신자에게 각 속성을 어떻게 처리해야 하는지 알려줍니다. 'r'\(예약된\) 비트는 사용되지 않으며 0으로 설정되어야 합니다. 후속 Diameter 애플리케이션은 AVP 헤더 내에서 추가 비트를 정의할 수 있으며 인식되지 않은 비트는 오류로 간주되어야 합니다. 'P' 비트는 종단 간 보안을 위해 암호화가 필요함을 나타냅니다.\(SHOULD, SHOULD\)

- 필수 비트\(Mandatory bit\)로 알려진 'M' 비트는 AVP 지원이 필요한지 여부를 나타냅니다. Diameter 클라이언트, 서버, 프록시 또는 변환 에이전트가 'M' 비트 세트를 가진 AVP를 수신하고 AVP 또는 그 값이 인식되지 않으면 메시지는 반드시 거부되어야 합니다. Diameter Relay 및 리디렉션 에이전트는 인식되지 않은 AVP가 포함된 메시지를 거부해서는 안 됩니다.\(MUST, MUST NOT\)

- 'M' 비트는 이를 포함하는 AVP에 대해 정의된 규칙에 따라 설정되어야 합니다. 상호 운용성을 유지하기 위해 Diameter 구현은 기본 Diameter 프로토콜이나 그것이 나타나는 메시지를 관리하는 Diameter 애플리케이션 사양에 정의되지 않은 모든 필수 AVP를 Diameter 메시지에서 제외할 수 있어야 합니다. 다음 방법 중 하나로 이를 수행할 수 있습니다.\(MUST, MUST, MAY\)

- 1\) 메시지가 기본 Diameter 표준이나 그것이 나타나는 메시지를 관리하는 Diameter Application 사양에 정의되지 않은 필수 AVP를 포함하고 있기 때문에 거부되는 경우 구현은 AVP 없이 메시지를 다시 보낼 수 있습니다. 대신 추가 표준 AVP를 삽입합니다.

- 2\) 특정 필수 AVP가 전송되는 것을 허용/방지하는 구성 옵션이 시스템 전체, 피어별 또는 영역별로 제공될 수 있습니다. 따라서 관리자는 상호 운용성 문제를 방지하기 위해 구성을 변경할 수 있습니다.

- 메시지의 공식 구문에 의해 허용되고 기본 Diameter 표준 또는 메시지를 관리하는 Diameter 애플리케이션 사양 중 하나에 정의된 모든 필수 AVP를 지원하려면 Diameter 구현이 필요합니다.

- 'M' 비트가 지워진 AVP는 정보 제공용일 뿐이며 지원되지 않는 AVP 또는 해당 값이 지원되지 않는 AVP가 포함된 메시지를 수신하는 수신자는 단순히 AVP를 무시할 수 있습니다.\(MAY\)

- Vendor-Specific 비트로 알려진 'V' 비트는 AVP 헤더에 선택적 Vendor-ID 필드가 있는지 여부를 나타냅니다. 설정된 경우 AVP 코드는 특정 공급업체 코드 주소 공간에 속합니다.

- 달리 명시하지 않는 한 AVP는 다음과 같은 기본 AVP 플래그 필드 설정을 갖습니다.

- 'M' 비트는 반드시 설정되어야 합니다. 'V' 비트는 설정되어서는 안 됩니다.\(MUST, MUST NOT\)

AVP 길이

- AVP 길이 필드는 3옥텟이며, AVP 코드, AVP 길이, AVP 플래그, Vendor-ID 필드\(존재하는 경우\) 및 AVP 데이터를 포함하여 이 AVP의 옥텟 수를 나타냅니다. 잘못된 속성 길이를 가진 메시지가 수신되면 해당 메시지는 거부되어야 합니다.\(SHOULD\)

---
#### **4.1.1.  Optional Header Elements**

AVP 헤더에는 하나의 선택적 필드가 포함되어 있습니다. 이 필드는 해당 비트 플래그가 활성화된 경우에만 존재합니다.

공급업체 ID

- AVP 플래그 필드에 'V' 비트가 설정된 경우 Vendor-ID 필드가 존재합니다. 선택적 4옥텟 Vendor-ID 필드에는 네트워크 바이트 순서로 인코딩된 IANA 할당 "SMI 네트워크 관리 개인 기업 코드"\[ASSIGNNO\] 값이 포함됩니다. 벤더별 Diameter AVP를 구현하려는 모든 벤더는 비공개로 관리되는 AVP 주소 공간과 함께 자체 Vendor-ID를 사용해야 하며, 이는 다른 벤더의 벤더별 AVP 또는 향후 IETF 애플리케이션과 충돌하지 않도록 보장해야 합니다. .\(MUST\)

- 공급업체 ID 값 0은 IANA에서 관리하는 IETF 채택 AVP 값에 해당합니다. 공급업체 ID 필드가 없다는 것은 문제의 AVP가 공급업체에 특정하지 않음을 의미하므로 구현에서는 0개의 공급업체 ID를 사용해서는 안 됩니다.\(MUST NOT\)

---
### **4.2.  Basic AVP Data Formats**

데이터 필드는 0개 이상의 옥텟이며 속성과 관련된 정보를 포함합니다. 데이터 필드의 형식과 길이는 AVP 코드 및 AVP 길이 필드에 의해 결정됩니다. 데이터 필드의 형식은 다음 기본 데이터 유형 중 하나이거나 기본 데이터 유형에서 파생된 데이터 유형이어야 합니다. 새로운 기본 AVP 데이터 형식이 필요한 경우 이 RFC의 새 버전을 생성해야 합니다.\(MUST\)

옥텟스트링

- 데이터에는 가변 길이의 임의 데이터가 포함되어 있습니다. 별도로 명시하지 않는 한, AVP 길이 필드는 최소 8\('V' 비트가 활성화된 경우 12\)로 설정되어야 합니다. 길이가 4옥텟의 배수가 아닌 이 유형의 AVP 값 뒤에는 다음 AVP\(있는 경우\)가 32비트 경계에서 시작되도록 필요한 패딩이 옵니다.\(MUST\)

정수32

- 네트워크 바이트 순서의 32비트 부호 있는 값입니다. AVP 길이 필드는 12로 설정되어야 합니다\('V' 비트가 활성화된 경우 16\).\(MUST\)

정수64

- 네트워크 바이트 순서의 64비트 부호 있는 값입니다. AVP 길이 필드는 16\('V' 비트가 활성화된 경우 20\)으로 설정되어야 합니다.\(MUST\)

서명되지 않은32

- 네트워크 바이트 순서의 32비트 부호 없는 값입니다. AVP 길이 필드는 12로 설정되어야 합니다\('V' 비트가 활성화된 경우 16\).\(MUST\)

서명되지 않은64

- 네트워크 바이트 순서의 64비트 부호 없는 값입니다. AVP 길이 필드는 16\('V' 비트가 활성화된 경우 20\)으로 설정되어야 합니다.\(MUST\)

Float32

- 이는 \[FLOATPOINT\]에 설명된 단정밀도 부동 소수점 값을 나타냅니다. 32비트 값은 네트워크 바이트 순서로 전송됩니다. AVP 길이 필드는 12로 설정되어야 합니다\('V' 비트가 활성화된 경우 16\).\(MUST\)

Float64

- 이는 \[FLOATPOINT\]에 설명된 대로 배정밀도 부동 소수점 값을 나타냅니다. 64비트 값은 네트워크 바이트 순서로 전송됩니다. AVP 길이 필드는 16\('V' 비트가 활성화된 경우 20\)으로 설정되어야 합니다.\(MUST\)

그룹화됨

- 데이터 필드는 AVP의 시퀀스로 지정됩니다. 이러한 각 AVP는 헤더와 패딩을 포함하여 지정된 순서대로 따릅니다. AVP 길이 필드는 8\('V' 비트가 활성화된 경우 12\)에 헤더와 패딩을 포함하여 포함된 모든 AVP의 총 길이를 더한 값으로 설정됩니다. 따라서 그룹화된 유형의 AVP의 AVP 길이 필드는 항상 4의 배수입니다.

---
### **4.3.  Derived AVP Data Formats**

기본 AVP 데이터 형식을 사용하는 것 외에도 애플리케이션은 기본 AVP 데이터 형식에서 파생된 데이터 형식을 정의할 수 있습니다. 새로운 AVP 파생 데이터 형식을 정의하는 애플리케이션은 아래 정의와 동일한 형식을 사용하여 "AVP 파생 데이터 형식"이라는 섹션에 해당 형식을 포함해야 합니다. 각각의 새로운 정의는 형식을 정의하는 RFC에 대한 참조를 사용하여 정의되거나 나열되어야 합니다.\(MUST\)

아래 AVP 파생 데이터 형식은 애플리케이션에서 일반적으로 사용됩니다.

주소

- 주소 형식은 OctetString AVP 기본 형식에서 파생됩니다. 이는 예를 들어 32비트\(IPv4\)\[IPV4\] 또는 128비트\(IPv6\)\[IPV6\] 주소를 가장 중요한 옥텟부터 나타내는 식별된 공용체입니다. 주소의 처음 두 옥텟

- AVP는 \[IANAADFAM\]에 정의된 주소 패밀리를 포함하는 AddressType을 나타냅니다. AddressType은 나머지 옥텟의 내용과 형식을 구별하는 데 사용됩니다.

시간

- 시간 형식은 OctetString AVP 기본 형식에서 파생됩니다. 문자열은 처음 4바이트가 NTP 타임스탬프 형식인 것과 동일한 형식으로 4개의 옥텟을 포함해야 합니다. NTP 타임스탬프 형식은 \[SNTP\]의 3장에 정의되어 있습니다.\(MUST\)

- 이는 협정 세계시\(UTC\)를 기준으로 1900년 1월 1일 0시 이후의 초 수를 나타냅니다.

- 2036년 2월 7일 6시 28분 16초 UTC에 시간 값이 오버플로됩니다. SNTP \[SNTP\]는 시간을 2104로 확장하는 절차를 설명합니다. 이 절차는 모든 DIAMETER 노드에서 지원되어야 합니다.\(MUST\)

UTF8문자열

- UTF8String 형식은 OctetString AVP 기본 형식에서 파생됩니다. 이는 ISO/IEC IS 10646-1 문자 세트를 사용하여 표현된 사람이 읽을 수 있는 문자열이며, RFC 2279에 설명된 UTF-8 \[UFT8\] 변환 형식을 사용하여 OctetString으로 인코딩됩니다.

- 때때로 10646 표준에 대한 개정으로 추가 코드 포인트가 추가되므로 구현은 0x00000001에서 0x7fffffff까지의 코드 포인트를 만날 수 있도록 준비해야 합니다. UTF-8 문자 집합으로의 코드 포인트의 유효한 인코딩에 해당하지 않거나 이 범위를 벗어나는 바이트 시퀀스는 금지됩니다.\(MUST\)

- 제어 코드의 사용은 피해야 합니다. 새로운 라인을 표현해야 할 경우 제어 코드 시퀀스 CR LF를 사용해야 합니다.\(SHOULD, SHOULD\)

- 선행 또는 후행 공백의 사용은 피해야 합니다.\(SHOULD\)

- 사용자 인터페이스 하드웨어나 소프트웨어에서 직접 지원하지 않는 코드 포인트의 경우 16진수와 같은 대체 입력 및 표시 수단이 제공될 수 있습니다.\(MAY\)

- 7비트 US-ASCII로 인코딩된 정보의 경우 UTF-8 문자 세트는 US-ASCII 문자 세트와 동일합니다.

- UTF-8은 단일 문자/코드 포인트를 나타내기 위해 여러 바이트가 필요할 수 있습니다. 따라서 옥텟 단위의 UTF8String 길이는 인코딩된 문자 수와 다를 수 있습니다.

- UTF8String의 AVP 길이 필드는 문자가 아닌 옥텟으로 측정됩니다.

직경ID

- DiameterIdentity 형식은 OctetString AVP 기본 형식에서 파생됩니다.

```text
         DiameterIdentity  = FQDN
```

- DiameterIdentity 값은 중복 연결 및 라우팅 루프 감지를 위해 Diameter 노드를 고유하게 식별하는 데 사용됩니다.

- 문자열의 내용은 Diameter 노드의 FQDN이어야 합니다. 여러 Diameter 노드가 동일한 호스트에서 실행되는 경우 각 Diameter 노드에는 고유한 DiameterIdentity가 할당되어야 합니다. Diameter 노드가 여러 FQDN으로 식별될 수 있는 경우 시작 시 단일 FQDN을 선택하고 전송되는 연결에 관계없이 해당 노드에 대한 유일한 DiameterIdentity로 사용해야 합니다.\(MUST, MUST\)

```text
   DiameterURI
```

- DiameterURI는 아래에 지정된 URI\(Uniform Resource Identifiers\) 구문 \[URI\] 규칙을 따라야 합니다.\(MUST\)

```text
      "aaa://" FQDN [ port ] [ transport ] [ protocol ]

                      ; No transport security

      "aaas://" FQDN [ port ] [ transport ] [ protocol ]

                      ; Transport security used

      FQDN               = Fully Qualified Host Name

      port               = ":" 1*DIGIT
```

; 수신 대기에 사용되는 포트 중 하나

- ; 들어오는 연결. ; 없는 경우, ; 기본 직경 포트\(3868\)는 입니다. 추정.

```text
      transport          = ";transport=" transport-protocol
```

; 듣기 위해 사용된 교통수단 중 하나

- ; 들어오는 연결의 경우. 없는 경우, ; 기본 SCTP \[SCTP\] 프로토콜은 입니다. 추정. UDP는 다음과 같은 경우에 사용되어서는 안 됩니다. aaa-protocol 필드는 로 설정됩니다. 지름.\(MUST NOT\)

```text
      transport-protocol = ( "tcp" / "sctp" / "udp" )

      protocol           = ";protocol=" aaa-protocol
```

; 없는 경우 기본 AAA 프로토콜

- ; 직경입니다.

```text
      aaa-protocol       = ( "diameter" / "radius" / "tacacs+" )
```

- 다음은 유효한 Diameter 호스트 ID의 예입니다.

```text
      aaa://host.example.com;transport=tcp
      aaa://host.example.com:6666;transport=tcp
      aaa://host.example.com;protocol=diameter
      aaa://host.example.com:6666;protocol=diameter
      aaa://host.example.com:6666;transport=tcp;protocol=diameter
      aaa://host.example.com:1813;transport=udp;protocol=radius
```

열거됨

- 열거형은 Integer32 AVP 기본 형식에서 파생됩니다. 정의에는 유효한 값 목록과 해당 해석이 포함되어 있으며 AVP를 소개하는 Diameter 애플리케이션에 설명되어 있습니다.

IPFilterRule

- IPFilterRule 형식은 OctetString AVP 기본 형식에서 파생됩니다. ASCII 문자 세트를 사용합니다. 패킷은 관련된 다음 정보를 기반으로 필터링될 수 있습니다.

```text
         Direction                          (in or out)
         Source and destination IP address  (possibly masked)
         Protocol
         Source and destination port        (lists or ranges)
         TCP flags
         IP fragment flag
         IP options
         ICMP types
```

- 해당 방향에 대한 규칙이 순서대로 평가되며, 먼저 일치하는 규칙이 평가를 종료합니다. 각 패킷은 한 번 평가됩니다. 일치하는 규칙이 없으면 평가된 마지막 규칙이 허용인 경우 패킷이 삭제되고 마지막 규칙이 거부인 경우 통과됩니다.

- IPFilterRule 필터는 다음 형식을 따라야 합니다.\(MUST\)

- src에서 dst로의 action dir proto \[옵션\]

- 작업 허용 - 규칙과 일치하는 패킷을 허용합니다. 거부 - 규칙과 일치하는 패킷을 삭제합니다.

- dir "in"은 터미널에서, "out"은 터미널에서 입니다.

- proto 숫자로 지정된 IP 프로토콜입니다. "ip" 키워드는 모든 프로토콜이 일치함을 의미합니다.

- src 및 dst <주소/마스크\> \[포트\]

```text
                      The <address/mask> may be specified as:
                      ipno       An IPv4 or IPv6 number in dotted-
                                 quad or canonical IPv6 form.  Only
                                 this exact IP number will match the
                                 rule.
                      ipno/bits  An IP number as above with a mask
                                 width of the form 1.2.3.4/24.  In
                                 this case, all IP numbers from
                                 1.2.3.0 to 1.2.3.255 will match.
                                 The bit width MUST be valid for the
                                 IP version and the IP number MUST
                                 NOT have bits set beyond the mask.
                                 For a match to occur, the same IP
                                 version must be present in the
                                 packet that was used in describing
                                 the IP address.  To test for a
                                 particular IP version, the bits part
                                 can be set to zero.  The keyword
                                 "any" is 0.0.0.0/0 or the IPv6
                                 equivalent.  The keyword "assigned"
                                 is the address or set of addresses
                                 assigned to the terminal.  For IPv4,
                                 a typical first rule is often "deny
                                 in ip! assigned"
```

매치의 느낌이 반전될 수 있다

- 주소 앞에 not 수정자\(!\)가 있으면 다른 모든 주소가 대신 일치됩니다. 이는 포트 번호 선택에 영향을 주지 않습니다.

- TCP, UDP 및 SCTP 프로토콜을 사용하면 선택적 포트를 다음과 같이 지정할 수 있습니다.

```text
                         {port/port-port}[,ports[,...]]
```

- '-' 표기법은 포트 범위\(경계 포함\)를 지정합니다.

- 0이 아닌 오프셋\(즉, 첫 번째 조각이 아닌\)이 있는 조각난 패킷은 하나 이상의 포트 사양이 있는 규칙과 일치하지 않습니다. 조각난 패킷 일치에 대한 자세한 내용은 조각 옵션을 참조하세요.

옵션:

- 조각 패킷이 조각이고 이것이 데이터그램의 첫 번째 조각이 아닌 경우 일치합니다. 조각은 tcpflags 또는 TCP/UDP 포트 사양과 함께 사용할 수 없습니다.

ipoptions 사양

- IP 헤더에 사양에 지정된 쉼표로 구분된 옵션 목록이 포함되어 있으면 일치합니다. 지원되는 IP 옵션은 다음과 같습니다.

```text
                    ssrr (strict source route), lsrr (loose source
                    route), rr (record packet route) and ts
                    (timestamp).  The absence of a particular option
                    may be denoted with a '!'.
```

tcpoptions 사양

- TCP 헤더에 사양에 지정된 쉼표로 구분된 옵션 목록이 포함되어 있으면 일치합니다. 지원되는 TCP 옵션은 다음과 같습니다.

```text
                    mss (maximum segment size), window (tcp window
                    advertisement), sack (selective ack), ts (rfc1323
                    timestamp) and cc (rfc1644 t/tcp connection
                    count).  The absence of a particular option may
                    be denoted with a '!'.
```

확립된

- TCP 패킷만 해당됩니다. RST 또는 ACK 비트가 설정된 패킷을 일치시킵니다.

- TCP 패킷만 설정합니다. SYN 비트가 설정되어 있지만 ACK 비트가 없는 패킷을 일치시킵니다.

tcpflags 사양

- TCP 패킷만 해당됩니다. TCP 헤더에 사양에 지정된 쉼표로 구분된 플래그 목록이 포함되어 있으면 일치합니다. 지원되는 TCP 플래그는 다음과 같습니다.

- fin, syn, rst, psh, ack 및 urg. 특정 플래그가 없으면 '!'으로 표시될 수 있습니다. tcpflags 사양이 포함된 규칙은 오프셋이 0이 아닌 조각화된 패킷과 일치할 수 없습니다. 조각난 패킷 일치에 대한 자세한 내용은 조각 옵션을 참조하세요.

ICMP 유형 유형

- ICMP 패킷만 해당됩니다. ICMP 유형이 목록 유형에 있는 경우 일치합니다. 목록은 쉼표로 구분된 범위 또는 개별 유형의 조합으로 지정할 수 있습니다. 아래 나열된 숫자 값과 기호 값을 모두 사용할 수 있습니다. 지원되는 ICMP 유형은 다음과 같습니다.

- 에코 응답\(0\), 대상 도달 불가\(3\), 소스 소멸\(4\), 리디렉션\(5\), 에코 요청\(8\), 라우터 광고\(9\), 라우터 요청\(10\), TTL\(time-to-live\) 초과\(11\) \), IP 헤더 불량\(12\), 타임스탬프 요청\(13\), 타임스탬프 응답\(14\), 정보 요청\(15\), 정보 응답\(16\), 주소 마스크 요청\(17\) 및 주소 마스크 응답\(18\).

액세스 장치가 항상 폐기해야 하는 한 종류의 패킷이 있는데, 이는 조각 오프셋이 1인 IP 조각입니다. 이것은 유효한 패킷이지만 방화벽을 우회하는 데 한 번만 사용됩니다.\(MUST\)

- 거부 규칙을 해석하거나 적용할 수 없는 액세스 장치는 세션을 종료해야 합니다. 허용 규칙을 해석하거나 적용할 수 없는 액세스 장치는 더 제한적인 규칙을 적용할 수 있습니다. 액세스 장치는 예를 들어 액세스 장치 소유자의 인프라를 보호하기 위해 제공된 규칙보다 먼저 자체 거부 규칙을 적용할 수 있습니다.\(MUST, MAY, MAY\)

규칙 구문은 FreeBSD의 ipfw\(8\)의 수정된 하위 집합이며 ipfw.c 코드는 구현에 유용한 기반을 제공할 수 있습니다.

QoSFilterRule

- QosFilterRule 형식은 OctetString AVP 기본 형식에서 파생됩니다. ASCII 문자 세트를 사용합니다. 패킷은 패킷과 관련된 다음 정보를 기반으로 표시되거나 측정될 수 있습니다.

```text
         Direction                          (in or out)
         Source and destination IP address  (possibly masked)
         Protocol
         Source and destination port        (lists or ranges)
         DSCP values                        (no mask or range)
```

- 해당 방향에 대한 규칙이 순서대로 평가되며, 먼저 일치하는 규칙이 평가를 종료합니다. 각 패킷은 한 번 평가됩니다. 일치하는 규칙이 없으면 패킷은 최선의 노력으로 처리됩니다. QoS 규칙을 해석하거나 적용할 수 없는 액세스 장치는 세션을 종료해서는 안 됩니다.\(SHOULD NOT\)

QoSFilterRule 필터는 다음 형식을 따라야 합니다.\(MUST\)

src에서 dst로의 action dir proto \[옵션\]

태그 - 특정 DSCP가 포함된 패킷 표시

- \[DIFFSERV\]. DSCP 옵션이 포함되어야 합니다. 미터 - 미터 트래픽입니다. 측정 옵션이 포함되어야 합니다.\(MUST, MUST\)

dir 형식은 IPFilterRule에 설명된 대로입니다.

proto 형식은 아래에 설명되어 있습니다.

-IPFilterRule.

src 및 dst 형식은 아래에 설명되어 있습니다.

-IPFilterRule.

---
### **4.4.  Grouped AVP Values**

Diameter 프로토콜은 '그룹화' 유형의 AVP 값을 허용합니다. 이는 데이터 필드가 실제로 AVP의 시퀀스임을 의미합니다. 그룹화된 유형 내에 그룹화된 유형을 갖는 AVP를 포함하는 것, 즉 이들을 중첩하는 것이 가능합니다. 그룹형 AVP 내의 AVP는 섹션 4에 정의된 대로 그룹화되지 않은 AVP와 동일한 패딩 요구 사항을 갖습니다.

그룹화된 AVP에 포함된 모든 AVP의 AVP 코드 번호 지정 공간은 그룹화되지 않은 AVP의 경우와 동일합니다. 또한 그룹화된 AVP 내에 캡슐화된 AVP 중 하나가 'M'\(필수\) 비트 세트를 갖는 경우 그룹화된 AVP 자체도 'M' 비트 세트를 포함해야 합니다.\(MUST\)

정의된 모든 그룹화된 AVP는 아래에 정의된 대로 ABNF \[ABNF\]\(수정 사항 포함\)를 사용하여 해당 문법을 포함해야 합니다.\(MUST\)

```text
      grouped-avp-def  = name "::=" avp

      name-fmt         = ALPHA *(ALPHA / DIGIT / "-")
```

이름 = 이름-fmt

- ; 이름은 AVP의 이름이어야 합니다. 기본 또는 확장된 직경에 정의됩니다. 명세서.

```text
      avp              = header  [ *fixed] [ *required] [ *optional]
                         [ *fixed]

      header           = "<" "AVP-Header:" avpcode [vendor] ">"

      avpcode          = 1*DIGIT
                         ; The AVP Code assigned to the Grouped AVP
```

공급업체 = 1\*DIGIT

- ; 그룹화된 AVP에 할당된 Vendor-ID입니다. ; 없는 경우 기본값은 0입니다. 사용된.

---
#### **4.4.1.  Example AVP with a Grouped Data type**

예제-AVP\(AVP 코드 999999\)는 그룹화 유형이며 그룹화 AVP 값이 작동하는 방식을 명확하게 하는 데 사용됩니다. 그룹화된 데이터 필드에는 다음과 같은 ABNF 문법이 있습니다.

```text
      Example-AVP  ::= < AVP Header: 999999 >
                       { Origin-Host }
                     1*{ Session-Id }
                      *[ AVP ]
```

그룹화된 데이터가 포함된 예제-AVP는 다음과 같습니다.

Origin-Host AVP가 필요합니다\(섹션 6.3\). 이 경우:

```text
      Origin-Host = "example.com".
```

하나 이상의 Session-Id가 따라와야 합니다. 여기에는 두 가지가 있습니다.

```text
      Session-Id =
        "grump.example.com:33041;23432;893;0AF3B81"

      Session-Id =
        "grump.example.com:33054;23561;2358;0AF3B82"

   optional AVPs included are

      Recovery-Policy = <binary>
         2163bc1d0ad82371f6bc09484133c3f09ad74a0dd5346d54195a7cf0b35
         2cabc881839a4fdcfbc1769e2677a4c1fb499284c5f70b48f58503a45c5
         c2d6943f82d5930f2b7c1da640f476f0e9c9572a50db8ea6e51e1c2c7bd
         f8bb43dc995144b8dbe297ac739493946803e1cee3e15d9b765008a1b2a
         cf4ac777c80041d72c01e691cf751dbf86e85f509f3988e5875dc905119
         26841f00f0e29a6d1ddc1a842289d440268681e052b30fb638045f7779c
         1d873c784f054f688f5001559ecff64865ef975f3e60d2fd7966b8c7f92

      Futuristic-Acct-Record = <binary>
         fe19da5802acd98b07a5b86cb4d5d03f0314ab9ef1ad0b67111ff3b90a0
         57fe29620bf3585fd2dd9fcc38ce62f6cc208c6163c008f4258d1bc88b8
         17694a74ccad3ec69269461b14b2e7a4c111fb239e33714da207983f58c
         41d018d56fe938f3cbf089aac12a912a2f0d1923a9390e5f789cb2e5067
         d3427475e49968f841
```

선택적 AVP에 대한 데이터는 16진수로 표시됩니다. 왜냐하면 이러한 AVP의 형식은 example-AVP 그룹 정의 시점이나 이 AVP의 예시 인스턴스가 해석되는 시점에 알려지지 않았기 때문입니다. 동일한 AVP 세트를 지원하는 Diameter 구현입니다. 인코딩 예제에서는 패딩이 사용되는 방법과 길이 필드가 계산되는 방법을 보여줍니다. 또한 AVP는 수신자가 해석할 수 없는 그룹화된 AVP 값\(여기서는 Recover-Policy 및 Futuristic-Acct-Record AVP\)에 존재할 수 있습니다.

이 AVP는 다음과 같이 인코딩됩니다.

```text
           0       1       2       3       4       5       6       7
       +-------+-------+-------+-------+-------+-------+-------+-------+
     0 |     Example AVP Header (AVP Code = 999999), Length = 468      |
       +-------+-------+-------+-------+-------+-------+-------+-------+
     8 |     Origin-Host AVP Header (AVP Code = 264), Length = 19      |
       +-------+-------+-------+-------+-------+-------+-------+-------+
    16 |  'e'  |  'x'  |  'a'  |  'm'  |  'p'  |  'l'  |  'e'  |  '.'  |
       +-------+-------+-------+-------+-------+-------+-------+-------+
    24 |  'c'  |  'o'  |  'm'  |Padding|     Session-Id AVP Header     |
       +-------+-------+-------+-------+-------+-------+-------+-------+
    32 | (AVP Code = 263), Length = 50 |  'g'  |  'r'  |  'u'  |  'm'  |
       +-------+-------+-------+-------+-------+-------+-------+-------+
                                     . . .
       +-------+-------+-------+-------+-------+-------+-------+-------+
    64 |  'A'  |  'F'  |  '3'  |  'B'  |  '8'  |  '1'  |Padding|Padding|
       +-------+-------+-------+-------+-------+-------+-------+-------+
    72 |     Session-Id AVP Header (AVP Code = 263), Length = 51       |
       +-------+-------+-------+-------+-------+-------+-------+-------+
    80 |  'g'  |  'r'  |  'u'  |  'm'  |  'p'  |  '.'  |  'e'  |  'x'  |
       +-------+-------+-------+-------+-------+-------+-------+-------+
                                     . . .
       +-------+-------+-------+-------+-------+-------+-------+-------+
   104 |  '0'  |  'A'  |  'F'  |  '3'  |  'B'  |  '8'  |  '2'  |Padding|
       +-------+-------+-------+-------+-------+-------+-------+-------+
   112 |   Recovery-Policy Header (AVP Code = 8341), Length = 223      |
       +-------+-------+-------+-------+-------+-------+-------+-------+
   120 |  0x21 | 0x63  | 0xbc  | 0x1d  | 0x0a  | 0xd8  | 0x23  | 0x71  |
       +-------+-------+-------+-------+-------+-------+-------+-------+
                                     . . .
       +-------+-------+-------+-------+-------+-------+-------+-------+
   320 |  0x2f | 0xd7  | 0x96  | 0x6b  | 0x8c  | 0x7f  | 0x92  |Padding|
       +-------+-------+-------+-------+-------+-------+-------+-------+
   328 | Futuristic-Acct-Record Header (AVP Code = 15930), Length = 137|
       +-------+-------+-------+-------+-------+-------+-------+-------+
   336 |  0xfe | 0x19  | 0xda  | 0x58  | 0x02  | 0xac  | 0xd9  | 0x8b  |
       +-------+-------+-------+-------+-------+-------+-------+-------+
                                     . . .
       +-------+-------+-------+-------+-------+-------+-------+-------+
   464 |  0x41 |Padding|Padding|Padding|
       +-------+-------+-------+-------+
```

---
### **4.5.  Diameter Base Protocol AVPs**

다음 표는 기본 프로토콜에 정의된 Diameter AVP, 해당 AVP 코드 값, 유형, 가능한 플래그 값 및 AVP가 암호화될 수 있는지 여부를 설명합니다. Diameter 메시지의 발신자에 대해 "Encr"\(암호화\)는 해당 AVP를 포함하는 메시지가 Diameter 에이전트\(프록시, 리디렉션 또는 릴레이\)를 통해 전송되어야 하는 경우 엔드투\(end-to\)가 없는 한 메시지를 전송해서는 안 된다는 것을 의미합니다. - 발신자와 수신자 간의 최종 보안 및 무결성/기밀성 보호가 이 AVP에 제공되거나 발신자가 엔드투엔드 보안이 필요하지 않음을 나타내는 로컬로 신뢰할 수 있는 구성을 가지고 있습니다. 마찬가지로, Diameter 메시지의 발신자에 대해 "MAY" 열의 "P"는 해당 AVP를 포함하는 메시지가 Diameter 에이전트\(프록시, 리디렉션 또는 릴레이\)를 통해 전송되어야 하는 경우 메시지가 전송되어서는 안 된다는 것을 의미합니다. 발신자와 수신자 사이에 종단 간 보안이 있거나 발신자가 종단 간 보안이 필요하지 않음을 나타내는 로컬로 신뢰할 수 있는 구성을 가지고 있지 않은 경우.\(MAY, MUST NOT, MUST NOT\)

공간 제약으로 인해 DiameterIdentity를 나타내는 데 약식 DiamIdent가 사용됩니다.

```text
                                            +---------------------+
                                            |    AVP Flag rules   |
                                            |----+-----+----+-----|----+
                   AVP  Section             |    |     |SHLD| MUST|    |
   Attribute Name  Code Defined  Data Type  |MUST| MAY | NOT|  NOT|Encr|
   -----------------------------------------|----+-----+----+-----|----|
   Acct-             85  9.8.2   Unsigned32 | M  |  P  |    |  V  | Y  |
     Interim-Interval                       |    |     |    |     |    |
   Accounting-      483  9.8.7   Enumerated | M  |  P  |    |  V  | Y  |
     Realtime-Required                      |    |     |    |     |    |
   Acct-            50   9.8.5   UTF8String | M  |  P  |    |  V  | Y  |
     Multi-Session-Id                       |    |     |    |     |    |
   Accounting-      485  9.8.3   Unsigned32 | M  |  P  |    |  V  | Y  |
     Record-Number                          |    |     |    |     |    |
   Accounting-      480  9.8.1   Enumerated | M  |  P  |    |  V  | Y  |
     Record-Type                            |    |     |    |     |    |
   Accounting-       44  9.8.4   OctetString| M  |  P  |    |  V  | Y  |
    Session-Id                              |    |     |    |     |    |
   Accounting-      287  9.8.6   Unsigned64 | M  |  P  |    |  V  | Y  |
     Sub-Session-Id                         |    |     |    |     |    |
   Acct-            259  6.9     Unsigned32 | M  |  P  |    |  V  | N  |
     Application-Id                         |    |     |    |     |    |
   Auth-            258  6.8     Unsigned32 | M  |  P  |    |  V  | N  |
     Application-Id                         |    |     |    |     |    |
   Auth-Request-    274  8.7     Enumerated | M  |  P  |    |  V  | N  |
      Type                                  |    |     |    |     |    |
   Authorization-   291  8.9     Unsigned32 | M  |  P  |    |  V  | N  |
     Lifetime                               |    |     |    |     |    |
   Auth-Grace-      276  8.10    Unsigned32 | M  |  P  |    |  V  | N  |
     Period                                 |    |     |    |     |    |
   Auth-Session-    277  8.11    Enumerated | M  |  P  |    |  V  | N  |
     State                                  |    |     |    |     |    |
   Re-Auth-Request- 285  8.12    Enumerated | M  |  P  |    |  V  | N  |
     Type                                   |    |     |    |     |    |
   Class             25  8.20    OctetString| M  |  P  |    |  V  | Y  |
   Destination-Host 293  6.5     DiamIdent  | M  |  P  |    |  V  | N  |
   Destination-     283  6.6     DiamIdent  | M  |  P  |    |  V  | N  |
     Realm                                  |    |     |    |     |    |
   Disconnect-Cause 273  5.4.3   Enumerated | M  |  P  |    |  V  | N  |
   E2E-Sequence AVP 300  6.15    Grouped    | M  |  P  |    |  V  | Y  |
   Error-Message    281  7.3     UTF8String |    |  P  |    | V,M | N  |
   Error-Reporting- 294  7.4     DiamIdent  |    |  P  |    | V,M | N  |
     Host                                   |    |     |    |     |    |
   Event-Timestamp   55  8.21    Time       | M  |  P  |    |  V  | N  |
   Experimental-    297  7.6     Grouped    | M  |  P  |    |  V  | N  |
      Result                                |    |     |    |     |    |
   -----------------------------------------|----+-----+----+-----|----|

                                            +---------------------+
                                            |    AVP Flag rules   |
                                            |----+-----+----+-----|----+
                   AVP  Section             |    |     |SHLD| MUST|MAY |
   Attribute Name  Code Defined  Data Type  |MUST| MAY | NOT|  NOT|Encr|
   -----------------------------------------|----+-----+----+-----|----|
   Experimental-    298  7.7     Unsigned32 | M  |  P  |    |  V  | N  |
      Result-Code                           |    |     |    |     |    |
   Failed-AVP       279  7.5     Grouped    | M  |  P  |    |  V  | N  |
   Firmware-        267  5.3.4   Unsigned32 |    |     |    |P,V,M| N  |
     Revision                               |    |     |    |     |    |
   Host-IP-Address  257  5.3.5   Address    | M  |  P  |    |  V  | N  |
   Inband-Security                          | M  |  P  |    |  V  | N  |
      -Id           299  6.10    Unsigned32 |    |     |    |     |    |
   Multi-Round-     272  8.19    Unsigned32 | M  |  P  |    |  V  | Y  |
     Time-Out                               |    |     |    |     |    |
   Origin-Host      264  6.3     DiamIdent  | M  |  P  |    |  V  | N  |
   Origin-Realm     296  6.4     DiamIdent  | M  |  P  |    |  V  | N  |
   Origin-State-Id  278  8.16    Unsigned32 | M  |  P  |    |  V  | N  |
   Product-Name     269  5.3.7   UTF8String |    |     |    |P,V,M| N  |
   Proxy-Host       280  6.7.3   DiamIdent  | M  |     |    | P,V | N  |
   Proxy-Info       284  6.7.2   Grouped    | M  |     |    | P,V | N  |
   Proxy-State       33  6.7.4   OctetString| M  |     |    | P,V | N  |
   Redirect-Host    292  6.12    DiamURI    | M  |  P  |    |  V  | N  |
   Redirect-Host-   261  6.13    Enumerated | M  |  P  |    |  V  | N  |
      Usage                                 |    |     |    |     |    |
   Redirect-Max-    262  6.14    Unsigned32 | M  |  P  |    |  V  | N  |
      Cache-Time                            |    |     |    |     |    |
   Result-Code      268  7.1     Unsigned32 | M  |  P  |    |  V  | N  |
   Route-Record     282  6.7.1   DiamIdent  | M  |     |    | P,V | N  |
   Session-Id       263  8.8     UTF8String | M  |  P  |    |  V  | Y  |
   Session-Timeout   27  8.13    Unsigned32 | M  |  P  |    |  V  | N  |
   Session-Binding  270  8.17    Unsigned32 | M  |  P  |    |  V  | Y  |
   Session-Server-  271  8.18    Enumerated | M  |  P  |    |  V  | Y  |
     Failover                               |    |     |    |     |    |
   Supported-       265  5.3.6   Unsigned32 | M  |  P  |    |  V  | N  |
     Vendor-Id                              |    |     |    |     |    |
   Termination-     295  8.15    Enumerated | M  |  P  |    |  V  | N  |
      Cause                                 |    |     |    |     |    |
   User-Name          1  8.14    UTF8String | M  |  P  |    |  V  | Y  |
   Vendor-Id        266  5.3.3   Unsigned32 | M  |  P  |    |  V  | N  |
   Vendor-Specific- 260  6.11    Grouped    | M  |  P  |    |  V  | N  |
      Application-Id                        |    |     |    |     |    |
   -----------------------------------------|----+-----+----+-----|----|
```

---
## **5.  Diameter Peers**

이 섹션에서는 Diameter 노드가 연결을 설정하고 피어와 통신하는 방법을 설명합니다.

---
### **5.1.  Peer Connections**

Diameter 노드에는 통신할 수 있는 피어가 많이 있을 수 있지만 이들 모두에 대한 연결을 설정하는 것은 경제적이지 않을 수 있습니다. 최소한 Diameter 노드는 기본 및 보조 피어로 알려진 영역당 두 개의 피어와의 연결을 설정해야 합니다. 물론 필요하다고 판단되면 노드에 추가 연결이 있을 수도 있습니다. 일반적으로 영역에 대한 모든 메시지는 기본 피어로 전송되지만 장애 조치 절차가 호출되는 경우 보류 중인 모든 요청은 보조 피어로 전송됩니다. 그러나 구현에서는 피어 집합 간의 요청 로드 밸런싱을 자유롭게 수행할 수 있습니다.\(SHOULD, MAY\)

특정 피어는 특정 영역에 대해 기본 역할을 하는 동시에 다른 영역에 대해서는 보조 역할을 할 수도 있습니다.\(MAY\)

할당된 시간 내에 DWA를 받지 못하는 등 다양한 이유로 발생할 수 있는 피어가 의심스러운 것으로 간주되면 새 요청이 피어에 전달되어서는 안 되지만 장애 조치 절차가 호출됩니다. 활성 피어가 이 모드로 이동되면 필요한 수의 활성 연결이 존재하도록 추가 연결을 설정해야 합니다.\(SHOULD\)

의심되는 피어 목록에서 피어를 제거하는 방법에는 두 가지가 있습니다.

1. 피어에 더 이상 연결할 수 없어 전송 연결이 종료됩니다. 피어가 닫힌 상태로 이동됩니다.

2. 허용된 왕복 시간으로 세 개의 감시 메시지가 교환되며 피어와의 연결이 안정된 것으로 간주됩니다.

- 제거되는 피어가 기본 또는 보조 피어인 경우 대체 피어가 삭제된 피어를 교체해야 하며 기본 또는 보조 역할을 맡아야 합니다.\(SHOULD\)

---
### **5.2.  Diameter Peer Discovery**

다이내믹한 Diameter 에이전트 검색을 허용하면 Diameter 서비스의 더욱 간단하고 강력한 배포가 가능해집니다. Diameter 피어 검색의 상호 운용 가능한 구현을 촉진하기 위해 다음 메커니즘이 설명됩니다. 이들은 기반

기존 IETF 표준에 대한 것입니다. 첫 번째 옵션\(수동 구성\)은 모든 DIAMETER 노드에서 지원되어야 하며, 후자의 두 옵션\(SRVLOC 및 DNS\)은 지원될 수 있습니다.\(MUST\)

Diameter 피어 검색이 수행될 수 있는 두 가지 경우가 있습니다. 첫 번째는 Diameter 클라이언트가 첫 번째 홉 Diameter 에이전트를 검색해야 하는 경우입니다. 두 번째 경우는 Diameter 에이전트가 Diameter 작업을 추가로 처리하기 위해 다른 에이전트를 검색해야 하는 경우입니다. 두 경우 모두 다음과 같은 '검색 순서'를 권장합니다.

1. Diameter 구현은 정적\(수동\)으로 구성된 Diameter 에이전트 위치 목록을 참조합니다. 존재하고 응답하는 경우 사용됩니다.

2. Diameter 구현은 SLPv2 \[SLP\]를 사용하여 Diameter 서비스를 검색합니다. Diameter 서비스 템플릿 \[TEMPLATE\]은 부록 A에 포함되어 있습니다.

- SLPv2 보안을 배포하는 것이 좋습니다\(이를 위해서는 SLPv2 에이전트에 키를 배포해야 함\). 이에 대해서는 부록 A에서 자세히 설명합니다. 검색된 피어가 해당 역할에 대해 권한이 부여되었는지 확인하려면 SLPv2 보안을 사용해야 합니다\(SLPv2 에이전트에 키 배포 필요\). SLPv2에 대해서는 부록 A에서 자세히 설명합니다.\(SHOULD\)

3. Diameter 구현은 특정 영역의 서버에 대해 NAPTR 쿼리를 수행합니다. Diameter 구현은 Diameter 에이전트를 찾을 영역을 미리 알아야 합니다. 이는 예를 들어 Diameter 구현이 Diameter 작업을 수행하는 데 필요한 NAI의 '영역'에서 추론할 수 있습니다.

- 3.1 전송 프로토콜 선택 작업과 관련된 서비스는 값이 "AAA+D2x"인 NAPTR 서비스 필드가 있는 서비스입니다. 여기서 x는 도메인에서 지원하는 전송 프로토콜에 해당하는 문자입니다. 이 사양에서는 TCP의 경우 D2T, SCTP의 경우 D2S를 정의합니다. 또한 프로토콜 매핑을 전송하기 위해 NAPTR 서비스 이름에 대한 IANA 레지스트리를 설정합니다.

```text
          These NAPTR records provide a mapping from a domain, to the
          SRV record for contacting a server with the specific transport
          protocol in the NAPTR services field.  The resource record
          will contain an empty regular expression and a replacement
          value, which is the SRV record for that particular transport
          protocol.  If the server supports multiple transport
          protocols, there will be multiple NAPTR records, each with a
          different service value.  As per RFC 2915 [NAPTR], the client
```

- 서비스 필드가 적용되지 않는 모든 기록을 삭제합니다. 이 사양의 목적을 위해 몇 가지 규칙이 정의됩니다.

- 3.2 클라이언트는 클라이언트가 지원하는 전송 프로토콜을 나타내는 X 값에 대해 값이 "D2X"가 아닌 확인 서비스를 식별하는 모든 서비스 필드를 폐기해야 합니다. RFC 2915에 설명된 NAPTR 처리를 통해 클라이언트가 지원하는 서버의 가장 선호하는 전송 프로토콜과 서버에 대한 SRV 레코드가 검색됩니다.\(MUST\)

- NAPTR 대체 필드의 도메인 접미사는 원래 쿼리의 도메인과 일치해야 합니다.\(SHOULD\)

4. NAPTR 레코드가 발견되지 않으면 요청자는 대상 주소 '\_diameter.\_sctp'.realm 또는 '\_diameter.\_tcp'.realm에 대한 해당 주소 레코드를 쿼리합니다. 주소 레코드에는 요청자의 네트워크 프로토콜 기능에 따라 선택된 A RR, AAAA RR 또는 기타 유사한 레코드가 포함됩니다. DNS 서버가 주소 레코드를 반환하지 않으면 요청자는 포기합니다.

- 서버가 사이트 인증서를 사용하는 경우 쿼리의 도메인 이름과 대체 필드의 도메인 이름은 모두 TLS 또는 IKE 교환에서 서버가 전달한 사이트 인증서를 기반으로 유효해야 합니다. 마찬가지로, SRV 쿼리의 도메인 이름과 SRV 레코드의 대상 도메인 이름은 모두 동일한 사이트 인증서를 기반으로 유효해야 합니다. 그렇지 않으면 공격자가 다른 도메인의 대체 값을 포함하도록 DNS 레코드를 수정할 수 있으며 클라이언트는 이것이 원하는 동작인지 또는 공격의 결과인지 확인할 수 없습니다.\(MUST, MUST\)

또한 Diameter Peer는 다음 사항을 확인해야 합니다.

- 발견된 피어는 해당 역할을 수행할 권한이 있습니다. IKE 또는 TLS를 통한 인증이나 DNSSEC를 통한 DNS RR 검증만으로는 이러한 결론을 내리기에 충분하지 않습니다. 예를 들어, 웹 서버가 유효한 TLS 인증서를 얻었을 수 있고 보안된 RR이 DNS에 포함될 수 있지만 이것이 Diameter 서버로 작동하도록 승인되었음을 의미하지는 않습니다.\(MUST\)

- 인증은 예를 들어 Diameter Server CA 구성을 통해 얻을 수 있습니다. 대안으로 이는 Diameter 서버 인증을 나타내기 위해 TLS 또는 IKE 인증서 내의 OID 정의에 의해 달성될 수 있습니다.

동적으로 발견된 피어는 피어 테이블\(섹션 2.6 참조\)에 항목을 생성합니다. DNS를 통해 생성된 항목은 DNS TTL 내에서 만료되거나 새로 고쳐져야 합니다. 피어가 발견된 경우\(MUST\)

로컬 영역 외부에서는 피어 영역에 대한 라우팅 테이블 항목\(섹션 2.7 참조\)이 생성됩니다. 라우팅 테이블 항목의 만료는 피어의 만료 값과 일치해야 합니다.\(MUST\)

---
### **5.3.  Capabilities Exchange**

두 Diameter 피어가 전송 연결을 설정할 때 피어 상태 머신에 지정된 대로 Capability Exchange 메시지를 교환해야 합니다\(섹션 5.6 참조\). 이 메시지를 통해 피어의 신원과 그 기능\(프로토콜 버전 번호, 지원되는 Diameter 애플리케이션, 보안 메커니즘 등\)을 발견할 수 있습니다.\(MUST\)

수신자는 명령을 정의하는 Diameter 애플리케이션에 대한 지원을 광고한 피어에게만 명령을 발행합니다. Diameter 노드는 인식되지 않은 명령 및/또는 AVP가 불필요하게 피어에 전송되지 않도록 지원되는 애플리케이션을 캐시해야 합니다.\(MUST\)

발신자와 공통된 애플리케이션이 없는 CER\(Capability-Exchange-Req\) 메시지의 수신자는 결과 코드 AVP가 DIAMETER\_NO\_COMMON\_APPLICATION으로 설정된 CEA\(Capability-Exchange-Answer\)를 반환해야 하며 전송 연결을 끊어야 합니다. 레이어 연결. 자신을 릴레이로 광고하는 피어로부터 CER 또는 CEA를 수신하는 것은\(섹션 2.4 참조\) 피어와 공통 애플리케이션이 있는 것으로 해석되어야 합니다.\(MUST, MUST\)

마찬가지로 발신자와 공통된 보안 메커니즘이 없는 CER\(Capability-Exchange-Req\) 메시지의 수신자는 DIAMETER\_NO\_COMMON\_SECURITY로 설정된 결과 코드 AVP를 사용하여 CEA\(Capability-Exchange-Answer\)를 반환해야 하며 SHOULD 전송 계층 연결을 끊습니다.\(MUST\)

알 수 없는 피어로부터 수신된 CER은 자동으로 폐기될 수 있으며, CEA는 DIAMETER\_UNKNOWN\_PEER로 설정된 결과 코드 AVP와 함께 발행될 수 있습니다. 두 경우 모두 전송 연결이 닫힙니다. 로컬 정책이 알 수 없는 호스트로부터 CER 수신을 허용하는 경우 성공적인 CEA가 반환될 수 있습니다. 알 수 없는 피어의 CER이 성공적인 CEA로 응답되면 피어 항목의 수명은 전송 연결의 수명과 같습니다. 전송이 실패하는 경우 알 수 없는 피어로 향하는 보류 중인 모든 트랜잭션이 삭제될 수 있습니다.\(MAY, MAY\)

CER 및 CEA 메시지는 프록시, 리디렉션 또는 중계되어서는 안 됩니다.\(MUST NOT\)

CER/CEA 메시지는 프록시될 수 없기 때문에 업스트림 에이전트가 명령 코드에 해당하는 애플리케이션을 처리하는 데 사용할 수 있는 피어가 없는 메시지를 수신할 가능성이 여전히 있습니다. 이러한 경우 'E' 비트가 답변에 설정됩니다.

결과 코드 AVP가 DIAMETER\_UNABLE\_TO\_DELIVER로 설정된 메시지\(섹션 7 참조\)를 통해 다운스트림에 조치\(예: 대체 피어로 요청을 다시 라우팅\)를 취하도록 알립니다.

Capability-Exchange-Request 메시지를 제외하고 Auth-Application-Id 또는 Acct-Application-Id AVP를 포함하는 요청 유형의 메시지 또는 애플리케이션별 명령 코드가 있는 메시지는 다음으로만 전달될 수 있습니다. 애플리케이션에 대한 지원을 명시적으로 광고한\(또는 릴레이 애플리케이션 식별자를 광고한\) 호스트.\(MAY\)

---
#### **5.3.1.  Capabilities-Exchange-Request**

257로 설정된 명령 코드와 명령 플래그의 'R' 비트 세트로 표시된 CER\(Capability-Exchange-Request\)은 로컬 기능을 교환하기 위해 전송됩니다. 전송 실패가 감지되면 이 메시지를 대체 피어로 보내서는 안 됩니다.\(MUST NOT\)

Diameter가 여러 인터페이스와 여러 IP 주소에 걸쳐 연결을 허용하는 SCTP\[SCTP\]를 통해 실행될 때 Capability-Exchange-Request 메시지는 다음과 같은 경우 로컬로 사용될 수 있는 각 잠재적 IP 주소에 대해 하나의 Host-IP-Address AVP를 포함해야 합니다. Diameter 메시지를 전송합니다.\(MUST\)

```text
   Message Format

      <CER> ::= < Diameter Header: 257, REQ >
                { Origin-Host }
                { Origin-Realm }
             1* { Host-IP-Address }
                { Vendor-Id }
                { Product-Name }
                [ Origin-State-Id ]
              * [ Supported-Vendor-Id ]
              * [ Auth-Application-Id ]
              * [ Inband-Security-Id ]
              * [ Acct-Application-Id ]
              * [ Vendor-Specific-Application-Id ]
                [ Firmware-Revision ]
              * [ AVP ]
```

---
#### **5.3.2.  Capabilities-Exchange-Answer**

257로 설정된 명령 코드와 지워진 명령 플래그의 'R' 비트로 표시되는 CEA\(Capability-Exchange-Answer\)는 CER 메시지에 대한 응답으로 전송됩니다.

Diameter가 여러 인터페이스, 즉 여러 IP 주소에 걸쳐 연결을 허용하는 SCTP\[SCTP\]를 통해 실행되는 경우 Capability-Exchange-Answer 메시지에는 로컬로 사용될 수 있는 각 잠재적 IP 주소에 대해 하나의 호스트-IP-주소 AVP가 포함되어야 합니다. Diameter 메시지를 전송할 때.\(MUST\)

```text
   Message Format

      <CEA> ::= < Diameter Header: 257 >
                { Result-Code }
                { Origin-Host }
                { Origin-Realm }
             1* { Host-IP-Address }
                { Vendor-Id }
                { Product-Name }
                [ Origin-State-Id ]
                [ Error-Message ]
              * [ Failed-AVP ]
              * [ Supported-Vendor-Id ]
              * [ Auth-Application-Id ]
              * [ Inband-Security-Id ]
              * [ Acct-Application-Id ]
              * [ Vendor-Specific-Application-Id ]
                [ Firmware-Revision ]
              * [ AVP ]
```

---
#### **5.3.3.  Vendor-Id AVP**

Vendor-Id AVP\(AVP 코드 266\)는 Unsigned32 유형이며 Diameter 애플리케이션의 공급업체에 할당된 IANA "SMI 네트워크 관리 개인 기업 코드"\[ASSIGNNO\] 값을 포함합니다. Supported-Vendor-Id AVP\(섹션 5.3.6\)와 함께 이는 어떤 벤더 특정 속성이 피어에 전송될 수 있는지 알기 위해 사용될 수 있습니다. 또한 Vendor-Id, Product-Name\(섹션 5.3.7\) 및 Firmware-Revision\(섹션 5.3.4\) AVP의 조합은 매우 유용한 디버깅 정보를 제공할 수 있다고 구상됩니다.\(MAY, MAY\)

CER 또는 CEA 메시지의 Vendor-Id 값 0은 예약되어 있으며 이 필드가 무시됨을 나타냅니다.

---
#### **5.3.4.  Firmware-Revision AVP**

펌웨어 개정 AVP\(AVP 코드 267\)는 Unsigned32 유형이며 발행 장치의 펌웨어 개정을 Diameter 피어에 알리는 데 사용됩니다.

펌웨어 개정판이 없는 장치\(예: Diameter 소프트웨어 모듈을 실행하는 범용 컴퓨터\)의 경우 Diameter 소프트웨어 모듈의 개정판이 대신 보고될 수 있습니다.

---
#### **5.3.5.  Host-IP-Address AVP**

Host-IP-Address AVP\(AVP 코드 257\)는 주소 유형이며 Diameter 피어에게 보낸 사람의 IP 주소를 알리는 데 사용됩니다. Diameter 노드가 SCTP\[SCTP\]와 함께 사용할 것으로 예상되는 모든 소스 주소는 각 주소에 대한 Host-IP-Address AVP를 포함하여 CER 및 CEA 메시지에 광고되어야 합니다. 이 AVP는 CER 및 CEA 메시지에서만 사용해야 합니다.\(MUST, MUST\)

---
#### **5.3.6.  Supported-Vendor-Id AVP**

Supported-Vendor-Id AVP\(AVP 코드 265\)는 Unsigned32 유형이며 장치 공급업체가 아닌 공급업체에 할당된 IANA "SMI 네트워크 관리 개인 기업 코드"\[ASSIGNNO\] 값을 포함합니다. 이는 송신자가 이 AVP에서 식별된 벤더에 의해 정의된 벤더별 AVP\(일부 집합\)를 지원함을 피어에게 알리기 위해 CER 및 CEA 메시지에서 사용됩니다.

---
#### **5.3.7.  Product-Name AVP**

제품 이름 AVP\(AVP 코드 269\)는 UTF8String 유형이며 제품에 대해 공급업체에서 할당한 이름을 포함합니다. 제품 이름 AVP는 동일한 제품의 펌웨어 개정판 전체에서 일정하게 유지되어야 합니다.\(SHOULD\)

---
### **5.4.  Disconnecting Peer connections**

Diameter 노드가 전송 연결 중 하나의 연결을 끊으면 해당 피어는 연결 해제 이유를 알 수 없으며 연결 문제가 발생했거나 피어가 재부팅되었다고 가정할 가능성이 높습니다. 이러한 경우 피어는 섹션 2.1에 명시된 대로 주기적으로 재연결을 시도할 수 있습니다. 연결 끊김이 내부 리소스 부족으로 인해 발생했거나 단순히 문제의 노드가 가까운 미래에 피어에게 Diameter 메시지를 전달할 의도가 없는 경우, 주기적인 연결 요청은 환영받지 못할 것입니다. Disconnection-Reason AVP에는 Diameter 노드가 Disconnect-Peer-Request 메시지를 발행한 이유가 포함됩니다.

Disconnect-Peer-Request 메시지는 Diameter 노드에 의해 피어에게 전송 계층의 연결을 끊으려는 의도와 피어가 그렇게 할 타당한 이유가 없는 한 다시 연결해서는 안 된다는 것을 알리기 위해 사용됩니다\(예: 전달할 메시지\) \). 메시지를 받은 후,

Disconnect-Peer-Answer가 반환되는데, 메시지가 최근에 전달되었고 전송 중일 가능성이 높으면 오류를 포함해야 하며, 그렇지 않으면 경쟁 조건이 발생할 수 있습니다.\(SHOULD\)

Disconnect-Peer-Answer의 수신자는 전송 연결 해제를 시작합니다.

---
#### **5.4.1.  Disconnect-Peer-Request**

282로 설정된 Command-Code와 Command Flag의 'R' 비트 세트로 표시되는 DPR\(Disconnect-Peer-Request\)은 전송 연결을 종료하려는 의도를 알리기 위해 피어로 전송됩니다. 전송 실패가 감지되면 이 메시지를 대체 피어로 보내서는 안 됩니다.\(MUST NOT\)

```text
   Message Format

      <DPR>  ::= < Diameter Header: 282, REQ >
                 { Origin-Host }
                 { Origin-Realm }
                 { Disconnect-Cause }
```

---
#### **5.4.2.  Disconnect-Peer-Answer**

Command-Code가 282로 설정되고 Command Flag의 'R' 비트가 지워진 DPA\(Disconnect-Peer-Answer\)가 Disconnect-Peer-Request 메시지에 대한 응답으로 전송됩니다. 이 메시지를 받으면 전송 연결이 종료됩니다.

```text
   Message Format

      <DPA>  ::= < Diameter Header: 282 >
                 { Result-Code }
                 { Origin-Host }
                 { Origin-Realm }
                 [ Error-Message ]
               * [ Failed-AVP ]
```

---
#### **5.4.3.  Disconnect-Cause AVP**

연결 끊김 원인 AVP\(AVP 코드 273\)는 열거형 유형입니다. Diameter 노드는 전송 연결을 종료하려는 의도에 대한 이유를 피어에게 알리기 위해 Disconnect-Peer-Request 메시지에 이 AVP를 포함해야 합니다. 다음 값이 지원됩니다.\(MUST\)

재부팅 중 0

- 예정된 재부팅이 임박했습니다.

바쁜 1

- 피어의 내부 리소스가 제한되어 있어 전송 연결을 닫아야 한다고 결정했습니다.

DO\_NOT\_WANT\_TO\_TALK\_TO\_YOU 2

- 피어는 가까운 미래에 메시지가 교환될 것으로 예상하지 않기 때문에 전송 연결이 필요하지 않다고 판단했습니다.

---
### **5.5.  Transport Failure Detection**

Diameter 프로토콜의 특성을 고려하여 전송 실패를 가능한 한 빨리 감지하는 것이 좋습니다. 이러한 오류를 감지하면 사용할 수 없는 에이전트에 전송되는 메시지의 발생이 최소화되어 불필요한 지연이 발생하고 더 나은 장애 조치 성능이 제공됩니다. 이 섹션에 정의된 Device-Watchdog-Request 및 Device-Watchdog-Answer 메시지는 전송 오류를 사전에 감지하는 데 사용됩니다.

---
#### **5.5.1.  Device-Watchdog-Request**

280으로 설정된 명령 코드와 명령 플래그의 'R' 비트 세트로 표시되는 DWR\(Device-Watchdog-Request\)은 두 피어 간에 트래픽이 교환되지 않은 경우 피어로 전송됩니다\(섹션 5.5.3 참조\). \). 전송 실패가 감지되면 이 메시지를 대체 피어로 보내서는 안 됩니다.\(MUST NOT\)

```text
   Message Format

      <DWR>  ::= < Diameter Header: 280, REQ >
                 { Origin-Host }
                 { Origin-Realm }
                 [ Origin-State-Id ]
```

---
#### **5.5.2.  Device-Watchdog-Answer**

280으로 설정된 명령 코드와 지워진 명령 플래그의 'R' 비트로 표시되는 DWA\(Device-Watchdog-Answer\)는 Device-Watchdog-Request 메시지에 대한 응답으로 전송됩니다.

```text
   Message Format

      <DWA>  ::= < Diameter Header: 280 >
                 { Result-Code }
                 { Origin-Host }
                 { Origin-Realm }
                 [ Error-Message ]
               * [ Failed-AVP ]
                 [ Original-State-Id ]
```

---
#### **5.5.3.  Transport Failure Algorithm**

전송 실패 알고리즘은 \[AAATRANS\]에 정의되어 있습니다. 모든 Diameter 구현은 Diameter 기본 프로토콜을 준수하기 위해 사양에 정의된 알고리즘을 지원해야 합니다.\(MUST\)

---
#### **5.5.4.  Failover and Failback Procedures**

피어에서 전송 실패가 감지되는 경우 보류 중인 모든 요청 메시지를 가능하면 대체 에이전트로 전달해야 합니다. 이를 일반적으로 장애 조치라고 합니다.

Diameter 노드가 장애 조치 절차를 수행하려면 해당 노드가 해당 피어에 대해 보류 중인 메시지 대기열을 유지해야 합니다. 응답 메시지가 수신되면 해당 요청이 대기열에서 제거됩니다. 홉별 식별자 필드는 대기 중인 요청과 응답을 일치시키는 데 사용됩니다.

전송 실패가 감지되면 가능하면 대기열의 모든 메시지가 T 플래그가 설정된 대체 에이전트로 전송됩니다. Diameter 클라이언트 또는 에이전트를 부팅할 때 비휘발성 저장소에 전송되기 위해 아직 남아 있는 모든 레코드에도 T 플래그가 설정됩니다. 메시지를 대체 서버로 전달할 수 없는 경우의 예는 메시지에 고정된 대상이 있고 사용할 수 없는 피어가 메시지의 최종 대상인 경우입니다\(대상-호스트 AVP 참조\). 이러한 오류가 발생하려면 에이전트가 'E' 비트가 설정되고 결과 코드 AVP가 DIAMETER\_UNABLE\_TO\_DELIVER로 설정된 응답 메시지를 반환해야 합니다.

장애 조치의 결과로 동일한 요청이나 응답이 여러 개 수신될 수 있다는 점에 유의하는 것이 중요합니다. 중복 메시지를 식별하려면 Origin-Host AVP와 함께 Diameter 헤더의 종단 간 식별자 필드를 사용해야 합니다.\(MAY, MUST\)

2.1절에서 설명한 것처럼 전송 연결을 다시 설정하기 위해서는 실패한 피어와 주기적으로 연결 요청을 시도해야 합니다. 연결이 성공적으로 설정되면 메시지가 다시 피어에게 전달될 수 있습니다. 이를 일반적으로 장애 복구라고 합니다.

---
### **5.6.  Peer State Machine**

이 섹션에는 모든 Diameter 구현에서 반드시 관찰해야 하는 유한 상태 머신이 포함되어 있습니다. 각 Diameter 노드는 각 피어와 통신할 때 아래 설명된 상태 머신을 따라야 합니다. 여러 작업은 쉼표로 구분되며 공간이 필요한 경우 다음 줄에서 계속될 수 있습니다. 마찬가지로 상태와 다음 상태도 공간에 따라 여러 줄에 걸쳐 있을 수 있습니다.\(MUST, MUST\)

이 상태 기계는 \[AAATRANS\]에 설명된 상태 기계와 밀접하게 연결되어 있으며 전송 연결을 열고 닫고 장애 조치하고 조사하고 다시 여는 데 사용됩니다. 특히 \[AAATRANS\]에서는 연결을 조사하기 위해 감시 메시지를 사용해야 한다는 점에 유의하세요. Diameter의 경우 DWR 및 DWA 메시지가 사용됩니다.

I-는 개시자\(연결\) 연결을 나타내는 데 사용되는 반면, R-는 응답자\(수신\) 연결을 나타내는 데 사용됩니다. 접두사가 없다는 것은 이벤트가 발생한 연결에 관계없이 이벤트 또는 작업이 동일함을 나타냅니다.

상태 머신이 있을 수 있는 안정 상태는 Closed, I-Open 및 R-Open입니다. 다른 모든 상태는 중간 상태입니다. I-Open과 R-Open은 통신에 개시자 또는 응답자 전송 연결이 사용되는지 여부를 제외하면 동일합니다.

연결 요청이 성공적으로 완료된 직후에는 항상 시작 연결에서 CER 메시지가 전송됩니다. 선거가 발생하면 두 연결 중 하나가 종료됩니다. 로컬 Diameter 엔터티의 Origin-Host가 피어의 Origin-Host보다 높은 경우 응답자 연결은 유지됩니다. 피어의 Origin-Host가 더 높으면 개시자 연결이 유지됩니다. 모든 후속 메시지는 살아남은 연결을 통해 전송됩니다. 한 피어의 선택 결과는 다른 피어의 결과와 반대가 되는 것이 보장됩니다.

TLS 사용의 경우 양쪽 끝이 열린 상태일 때 TLS 핸드셰이크가 시작됩니다. TLS 핸드셰이크가 성공하면 모든 추가 메시지가 TLS를 통해 전송됩니다. Handshake가 실패하면 양쪽 끝이 닫힌 상태로 이동합니다.

상태 머신은 와이어의 이벤트를 통해 Diameter 피어가 볼 수 있는 Diameter 구현의 동작만 제한합니다.

동등한 결과를 생성하는 모든 구현은 규정을 준수하는 것으로 간주됩니다.

```text
   state            event              action         next state
   -----------------------------------------------------------------
   Closed           Start            I-Snd-Conn-Req   Wait-Conn-Ack
                    R-Conn-CER       R-Accept,        R-Open
                                     Process-CER,
                                     R-Snd-CEA

   Wait-Conn-Ack    I-Rcv-Conn-Ack   I-Snd-CER        Wait-I-CEA
                    I-Rcv-Conn-Nack  Cleanup          Closed
                    R-Conn-CER       R-Accept,        Wait-Conn-Ack/
                                     Process-CER      Elect
                    Timeout          Error            Closed

   Wait-I-CEA       I-Rcv-CEA        Process-CEA      I-Open
                    R-Conn-CER       R-Accept,        Wait-Returns
                                     Process-CER,
                                     Elect
                    I-Peer-Disc      I-Disc           Closed
                    I-Rcv-Non-CEA    Error            Closed
                    Timeout          Error            Closed

   Wait-Conn-Ack/   I-Rcv-Conn-Ack   I-Snd-CER,Elect  Wait-Returns
   Elect            I-Rcv-Conn-Nack  R-Snd-CEA        R-Open
                    R-Peer-Disc      R-Disc           Wait-Conn-Ack
                    R-Conn-CER       R-Reject         Wait-Conn-Ack/
                                                      Elect
                    Timeout          Error            Closed

   Wait-Returns     Win-Election     I-Disc,R-Snd-CEA R-Open
                    I-Peer-Disc      I-Disc,          R-Open
                                     R-Snd-CEA
                    I-Rcv-CEA        R-Disc           I-Open
                    R-Peer-Disc      R-Disc           Wait-I-CEA
                    R-Conn-CER       R-Reject         Wait-Returns
                    Timeout          Error            Closed

   R-Open           Send-Message     R-Snd-Message    R-Open
                    R-Rcv-Message    Process          R-Open
                    R-Rcv-DWR        Process-DWR,     R-Open
                                     R-Snd-DWA
                    R-Rcv-DWA        Process-DWA      R-Open
                    R-Conn-CER       R-Reject         R-Open
                    Stop             R-Snd-DPR        Closing
                    R-Rcv-DPR        R-Snd-DPA,       Closed
                                           R-Disc

                    R-Peer-Disc      R-Disc           Closed
                    R-Rcv-CER        R-Snd-CEA        R-Open
                    R-Rcv-CEA        Process-CEA      R-Open

   I-Open           Send-Message     I-Snd-Message    I-Open
                    I-Rcv-Message    Process          I-Open
                    I-Rcv-DWR        Process-DWR,     I-Open
                                     I-Snd-DWA
                    I-Rcv-DWA        Process-DWA      I-Open
                    R-Conn-CER       R-Reject         I-Open
                    Stop             I-Snd-DPR        Closing
                    I-Rcv-DPR        I-Snd-DPA,       Closed
                                     I-Disc
                    I-Peer-Disc      I-Disc           Closed
                    I-Rcv-CER        I-Snd-CEA        I-Open
                    I-Rcv-CEA        Process-CEA      I-Open

   Closing          I-Rcv-DPA        I-Disc           Closed
                    R-Rcv-DPA        R-Disc           Closed
                    Timeout          Error            Closed
                    I-Peer-Disc      I-Disc           Closed
                    R-Peer-Disc      R-Disc           Closed
```

---
#### **5.6.1.  Incoming connections**

Diameter 피어로부터 연결 요청이 수신되면 일반적으로 CER이 수신될 때까지 해당 피어의 신원을 알 수 없습니다. 이는 호스트와 포트가 Diameter 피어의 신원을 결정하기 때문입니다. 들어오는 연결의 소스 포트는 임의적입니다. CER을 수신하면 연결 피어의 ID를 Origin-Host에서 고유하게 확인할 수 있습니다.

이러한 이유로 Diameter 피어는 연결 요청을 수신하고 수락하고 CER을 기다리기 위해 상태 머신과 별도의 논리를 사용해야 합니다. CER이 새 연결에 도착하면 피어를 식별하는 Origin-Host를 사용하여 해당 피어와 연결된 상태 머신을 찾고 새 연결과 CER이 R-Conn-CER 이벤트로 상태 머신에 전달됩니다.

들어오는 연결을 처리하는 논리는 CER 이외의 메시지가 도착하거나 CER을 수신하기 전에 구현에서 정의한 시간 초과가 발생하는 경우 연결을 닫고 삭제해야 합니다.\(SHOULD\)

CER 수신을 포함하여 들어오는 연결을 처리하려면 특정 피어와 연결된 개별 상태 머신의 로직과 별도로 로직이 필요하므로 위의 상태 머신이 아닌 이 섹션에서 별도로 설명합니다.

---
#### **5.6.2.  Events**

자동 장치의 전환과 동작은 이벤트로 인해 발생합니다. 이 섹션에서는 실제 이벤트가 동일하지만 가능한 두 연결 중 하나에서 발생하므로 -I 및 -R 접두사를 무시합니다.

시작 Diameter 애플리케이션에서 다음과 같은 신호를 보냈습니다.

- 연결은 상대방과 시작되어야 합니다.

R-Conn-CER 전송 연결이 설정되었으며 관련 CER이 도착했음을 알리는 승인이 수신됩니다.

Rcv-Conn-Ack 전송 연결이 설정되었음을 확인하는 긍정적인 승인이 수신됩니다.

Rcv-Conn-Nack 전송 연결이 설정되지 않았다는 부정적인 승인이 수신되었습니다.

시간 초과 일부 이벤트를 기다리는 동안 애플리케이션 정의 타이머가 만료되었습니다.

Rcv-CER 피어로부터 CER 메시지가 수신되었습니다.

Rcv-CEA 피어로부터 CEA 메시지가 수신되었습니다.

Rcv-Non-CEA 상대방으로부터 CEA가 아닌 메시지를 받았습니다.

Peer-Disc 피어로부터 연결 끊김 표시가 수신되었습니다.

Rcv-DPR 피어로부터 DPR 메시지가 수신되었습니다.

Rcv-DPA 피어로부터 DPA 메시지가 수신되었습니다.

Win-Election 선거가 실시되었고 로컬 노드가 승자가 되었습니다.

Send-Message 메시지가 전송됩니다.

Rcv-Message CER, CEA, DPR, DPA, DWR, DWA 이외의 메시지가 수신되었습니다.

중지 Diameter 애플리케이션에서 다음과 같은 신호를 보냈습니다.

- 연결이 종료되어야 합니다\(예: 시스템 종료 시\).

---
#### **5.6.3.  Actions**

자동 장치의 작업은 이벤트에 의해 발생하며 일반적으로 패킷 전송 및/또는 연결에 대해 수행되는 작업을 나타냅니다. 이 섹션에서는 실제 작업이 동일하지만 두 가지 가능한 연결 중 하나에서 발생하므로 I 및 R 접두사를 무시합니다.

Snd-Conn-Req 피어와의 전송 연결이 시작됩니다.

수락 R-Conn-CER과 관련된 수신 연결이 응답자 연결로 수락됩니다.

거부 R-Conn-CER과 관련된 수신 연결이 끊어졌습니다.

Process-CER R-Conn-CER과 연관된 CER이 처리됩니다.

Snd-CER CER 메시지가 피어에게 전송됩니다.

Snd-CEA CEA 메시지가 피어에게 전송됩니다.

정리 필요한 경우 연결이 종료되고 모든 로컬 리소스가 해제됩니다.

오류 오류 조건에 대한 응답으로 전송 계층 연결이 정중하게 또는 중단적으로 끊어집니다. 로컬 리소스가 해제됩니다.

Process-CEA 수신된 CEA를 처리한다.

Snd-DPR DPR 메시지가 피어에게 전송됩니다.

Snd-DPA DPA 메시지가 피어에게 전송됩니다.

디스크 전송 계층 연결이 끊어지고 로컬 리소스가 해제됩니다.

선택 선택이 발생합니다\(자세한 내용은 섹션 5.6.4 참조\).

Snd-Message 메시지가 전송됩니다.

Snd-DWR DWR 메시지가 전송됩니다.

Snd-DWA DWA 메시지가 전송됩니다.

Process-DWR DWR 메시지가 서비스됩니다.

Process-DWA DWA 메시지가 서비스됩니다.

프로세스 메시지가 서비스됩니다.

---
#### **5.6.4.  The Election Process**

응답자에 대해 선택이 수행됩니다. 응답자는 피어가 보낸 CER에서 수신한 Origin-Host를 자신의 Origin-Host와 비교합니다. 로컬 Diameter 엔터티의 Origin-Host가 피어의 것보다 높으면 Win-Election 이벤트가 로컬로 발행됩니다.

비교는 더 짧은 OctetString을 0으로 채워서 길이가 더 긴 OctetString의 길이와 같도록 한 다음 첫 번째 옥텟이 가장 중요한 옥텟별 부호 없는 비교를 수행하는 방식으로 진행됩니다. 나머지 옥텟의 값은 0x80으로 간주됩니다.

---
## **6.  Diameter message processing**

이 섹션에서는 Diameter 요청 및 응답이 생성되고 처리되는 방법을 설명합니다.

---
### **6.1.  Diameter Request Routing Overview**

요청은 다음 세 가지 조합 중 하나에서 대상 영역 및 대상 호스트 AVP의 조합을 사용하여 최종 대상으로 전송됩니다.

- 프록시할 수 없는 요청\(예: CER\)에는 대상 영역 또는 대상 호스트 AVP가 포함되어서는 안 됩니다.\(MUST NOT\)

- 특정 영역을 서비스하지만 특정 서버가 아닌 홈 서버로 전송되어야 하는 요청\(예: 일련의 왕복 중 첫 번째 요청\)은 Destination-Realm AVP를 포함해야 하지만 다음을 포함해서는 안 됩니다. 대상-호스트 AVP.\(MUST NOT\)

- 그렇지 않으면 주어진 영역을 서비스하는 서버 중 특정 홈 서버로 전송되어야 하는 요청은 대상 영역 및 대상 호스트 AVP를 모두 포함해야 합니다.\(MUST\)

Destination-Host AVP는 요청의 목적지가 고정될 때 위에서 설명한 대로 사용됩니다. 여기에는 다음이 포함됩니다.

- 여러 왕복에 걸친 인증 요청

- 메시지의 소스와 최종 대상 간에 공유되는 사전 설정된 세션 키를 사용하는 보안 메커니즘을 사용하는 Diameter 메시지입니다.

- 특정 사용자의 세션이 종료되도록 요청하는 데 사용되는 Abort-Session-Request 메시지와 같이 특정 Diameter 클라이언트\(예: 액세스 장치\)가 수신해야 하는 서버 시작 메시지.\(MUST\)

에이전트는 문제의 호스트가 피어 테이블에 포함된 경우에만 대상-호스트 AVP에 설명된 호스트로 요청을 전달할 수 있습니다\(섹션 2.7 참조\). 그렇지 않으면 요청은 Destination-Realm만을 기반으로 라우팅됩니다\(섹션 6.1.6 참조\).

메시지가 프록시 가능한 경우 Destination-Realm AVP가 있어야 합니다. Diameter 에이전트\(프록시, 리디렉션 또는 릴레이\)에 의해 전달될 수 있는 요청 메시지에는 Acct-Application-Id AVP, Auth-Application-Id AVP 또는 Vendor-Specific-Application-Id AVP도 포함되어야 합니다. Diameter 에이전트\(프록시, 리디렉션 또는 릴레이\)에 의해 전달되어서는 안 되는 메시지는 ABNF에 Destination-Realm을 포함해서는 안 됩니다. Destination-Realm AVP의 값은 User-Name AVP 또는 기타 애플리케이션별 방법에서 추출될 수 있습니다.\(MUST, MUST, MUST NOT, MAY\)

메시지가 수신되면 메시지는 다음 순서로 처리됩니다.

1. 메시지가 로컬 호스트를 대상으로 하는 경우 섹션 6.1.4에 나열된 절차를 따릅니다.

2. 메시지가 로컬 호스트와 직접 통신할 수 있는 Diameter 피어를 대상으로 하는 경우 섹션 6.1.5에 나열된 절차를 따릅니다. 이를 요청 전달이라고 합니다.

3. 요청 라우팅이라고 알려진 섹션 6.1.6에 나열된 절차를 따릅니다.

4. 위의 어느 것도 성공하지 못하면 결과 코드가 DIAMETER\_UNABLE\_TO\_DELIVER로 설정되고 E 비트가 설정된 응답이 반환됩니다.

관리 도메인 내에서 작동하도록 Diameter 메시지 라우팅을 위해서는 영역 내의 모든 Diameter 노드가 피어여야 합니다.\(MUST\)

이 섹션에 포함된 처리 규칙은 Diameter 개발자를 위한 일반적인 지침으로 사용하기 위한 것입니다. 특정 구현에서는 여기에 설명된 것과 다른 방법을 사용할 수 있으며 여전히 프로토콜 사양을 준수합니다. 오류 처리에 대한 자세한 내용은 섹션 7을 참조하세요.\(MAY\)

---
#### **6.1.1.  Originating a Request**

요청을 생성할 때 해당 특정 요청에 대한 애플리케이션 정의에 설명된 다른 절차 외에도 다음 절차를 따라야 합니다.\(MUST\)

- 명령 코드가 적절한 값으로 설정되어 있습니다.

- 'R' 비트가 설정되었습니다.

- 종단 간 식별자는 로컬에서 고유한 값으로 설정됩니다.

- Origin-Host 및 Origin-Realm AVP는 반드시

- 메시지의 소스를 식별하는 데 사용되는 적절한 값\(MUST\)

- Destination-Host 및 Destination-Realm AVP는 섹션 6.1에 설명된 대로 적절한 값으로 설정되어야 합니다.\(MUST\)

- 요청이 프록시 가능한 경우 Acct-Application-Id AVP, Auth-Application-Id 또는 Vendor-Specific-Application-Id AVP가 포함되어야 합니다.

---
#### **6.1.2.  Sending a Request**

로컬에서 시작되거나 전달 또는 라우팅 작업의 결과로 요청을 보낼 때 다음 절차를 따라야 합니다.\(MUST\)

- 홉별 식별자는 로컬에서 고유한 값으로 설정되어야 합니다.

- 해당 메시지는 대기 요청 목록에 저장되어야 합니다.

에이전트가 수행하는 특정 역할에 따라 메시지에 대해 수행할 다른 작업은 다음 섹션에 설명되어 있습니다.

---
#### **6.1.3.  Receiving Requests**

릴레이 또는 프록시 에이전트는 요청을 받을 때 전달 루프를 확인해야 합니다. 서버가 Route-Record AVP에서 자신의 ID를 찾으면 루프가 감지됩니다. 이러한 이벤트가 발생하면 에이전트는 DIAMETER\_LOOP\_DETECTED로 설정된 결과 코드 AVP로 응답해야 합니다.\(MUST, MUST\)

---
#### **6.1.4.  Processing Local Requests**

다음 조건 중 하나가 발생하면 요청이 로컬 소비로 간주됩니다.

- 목적지 호스트 AVP는 로컬 호스트의 신원을 포함합니다.

- Destination-Host AVP가 존재하지 않고, Destination-Realm AVP에 서버가 로컬로 처리하도록 구성된 영역이 포함되어 있으며 Diameter 애플리케이션이 로컬로 지원됩니다.

- Destination-Host와 Destination-Realm이 모두 존재하지 않습니다.

요청이 로컬로 처리되면 섹션 6.2의 규칙을 사용하여 해당 답변을 생성해야 합니다.

---
#### **6.1.5.  Request Forwarding**

요청 전달은 Diameter 피어 테이블을 사용하여 수행됩니다. Diameter 피어 테이블에는 로컬 노드가 직접 통신할 수 있는 모든 피어가 포함됩니다.

요청이 수신되고 Destination-Host AVP에 인코딩된 호스트가 피어 테이블에 존재하는 호스트인 경우 메시지는 피어로 전달되어야 합니다.\(SHOULD\)

---
#### **6.1.6.  Request Routing**

Diameter 요청 메시지 라우팅은 영역과 애플리케이션을 통해 수행됩니다. Diameter 에이전트\(프록시, 리디렉션 또는 릴레이\)에 의해 전달될 수 있는 Diameter 메시지는 Destination-Realm AVP의 대상 영역과 애플리케이션 식별 AVP Auth-Application-Id, Acct-Application-Id 또는 Vendor-Specific 중 하나를 포함해야 합니다. - 애플리케이션 ID. 영역은 NAI\(Network Access Identifier\) ​​형식의 사용자 이름 AVP에서 검색될 수 있습니다. NAI의 영역 부분은 Destination-Realm AVP에 삽입됩니다.\(MUST, MAY\)

Diameter 에이전트는 로컬로 지원되는 영역 및 애플리케이션 목록을 가질 수 있고, 외부에서 지원되는 영역 및 애플리케이션 목록을 가질 수 있습니다. 로컬로 지원되지 않는 영역 및/또는 애플리케이션을 포함하는 요청이 수신되면 메시지는 영역 라우팅 테이블에 구성된 피어로 라우팅됩니다\(섹션 2.7 참조\).\(MAY\)

---
#### **6.1.7.  Redirecting requests**

리디렉션 에이전트가 라우팅 항목이 REDIRECT로 설정된 요청을 수신하면 헤더에 홉별 식별자를 유지하면서 'E' 비트가 설정된 응답 메시지로 응답해야 하며 결과 코드 AVP를 포함해야 합니다. DIAMETER\_REDIRECT\_INDICATION으로 변경됩니다. 라우팅 항목과 연관된 각 서버는 별도의 Redirect-Host AVP에 추가됩니다.\(MUST\)

```text
                  +------------------+
                  |     Diameter     |
                  |  Redirect Agent  |
                  +------------------+
                   ^    |    2. command + 'E' bit
    1. Request     |    |    Result-Code =
   joe@example.com |    |    DIAMETER_REDIRECT_INDICATION +
                   |    |    Redirect-Host AVP(s)
                   |    v
               +-------------+  3. Request  +-------------+
               | example.com |------------->| example.net |
               |    Relay    |              |   Diameter  |
               |    Agent    |<-------------|    Server   |
               +-------------+  4. Answer   +-------------+

                     Figure 5: Diameter Redirect Agent
```

'E' 비트가 설정된 응답 메시지의 수신자와 DIAMETER\_REDIRECT\_INDICATION으로 설정된 결과 코드 AVP는 Diameter 헤더의 hop-by-hop 필드를 사용하여 보류 중인 메시지 대기열\(섹션 5.3 참조\)의 요청을 식별합니다. 리디렉션됩니다. 새 에이전트와의 전송 연결이 없으면 하나가 생성되고 요청이 직접 전송됩니다.

여러 리디렉션 호스트 AVP가 허용됩니다. 'E' 비트가 설정된 응답 메시지의 수신자는 이러한 호스트 중 정확히 하나를 리디렉션된 메시지의 대상으로 선택합니다.

---
#### **6.1.8.  Relaying and Proxying Requests**

릴레이 또는 프록시 에이전트는 전달된 모든 요청에 ​​Route-Record AVP를 추가해야 합니다. AVP에는 요청을 받은 피어의 ID가 포함되어 있습니다.\(MUST\)

요청의 홉별 식별자가 저장되고 로컬에서 고유한 값으로 대체됩니다. IP 주소, 포트 및 프로토콜을 포함하는 요청 소스도 저장됩니다.

릴레이 또는 프록시 에이전트는 해당 응답이 수신될 때 로컬 상태 정보에 대한 액세스가 필요한 경우 요청에 Proxy-Info AVP를 포함할 수 있습니다. Proxy-Info AVP에는 특정 보안 관련 사항이 있으며 노드 로컬 키와 함께 내장된 HMAC를 포함해야 합니다\(SHOULD\). 또는 단순히 로컬 저장소를 사용하여 상태 정보를 저장할 수도 있습니다.\(MAY, SHOULD, MAY\)

그런 다음 메시지는 영역 라우팅 테이블에 식별된 대로 다음 홉으로 전달됩니다.

그림 6에서는 이 섹션에 나열된 절차를 사용한 메시지 라우팅의 예를 제공합니다.

```text
        (Origin-Host=nas.mno.net)    (Origin-Host=nas.mno.net)
        (Origin-Realm=mno.net)       (Origin-Realm=mno.net)
        (Destination-Realm=example.com)  (Destination-
                                         Realm=example.com)
                                     (Route-Record=nas.example.net)
    +------+      ------>      +------+      ------>      +------+
    |      |     (Request)     |      |      (Request)    |      |
    | NAS  +-------------------+ DRL  +-------------------+ HMS  |
    |      |                   |      |                   |      |
    +------+     <------       +------+     <------       +------+
   example.net    (Answer)   example.net     (Answer)   example.com
        (Origin-Host=hms.example.com)   (Origin-Host=hms.example.com)
        (Origin-Realm=example.com)      (Origin-Realm=example.com)
```

- 그림 6: Diameter 메시지 라우팅

---
### **6.2.  Diameter Answer Processing**

요청이 로컬에서 처리될 때, 명령을 정의하는 Diameter 애플리케이션에서 논의될 수 있는 추가 절차에 더해, 연관된 응답을 생성하기 위해 다음 절차를 적용해야 합니다.\(MUST\)

- 요청의 동일한 홉별 식별자가 응답에 사용됩니다.

- 로컬 호스트의 신원은 Origin-Host AVP에 인코딩됩니다.

- Destination-Host 및 Destination-Realm AVP는 응답 메시지에 존재해서는 안 됩니다.\(MUST NOT\)

- 결과 코드 AVP에는 성공 또는 실패를 나타내는 값이 추가됩니다.

- Session-Id가 요청에 있는 경우 응답에 포함되어야 합니다.\(MUST\)

- 요청의 모든 프록시 정보 AVP는 요청에 있었던 것과 동일한 순서로 응답 메시지에 추가되어야 합니다.\(MUST\)

- 'P' 비트는 요청에 있는 것과 동일한 값으로 설정됩니다.

- 요청에 포함된 동일한 End-to-End 식별자가 응답에 사용됩니다.

오류 메시지\(섹션 7.3 참조\)에도 위의 처리 규칙이 적용된다는 점에 유의하세요.

---
#### **6.2.1.  Processing received Answers**

Diameter 클라이언트 또는 프록시는 보류 중인 요청 목록에 대해 수신된 응답의 홉별 식별자와 일치해야 합니다. 해당 메시지는 보류 중인 요청 목록에서 제거되어야 합니다. 알려진 홉별 식별자와 일치하지 않는 수신 응답을 무시해야 합니다\(SHOULD\).\(MUST, SHOULD\)

---
#### **6.2.2.  Relaying and Proxying Answers**

프록시되거나 중계된 요청에 대한 응답인 경우 에이전트는 Diameter 헤더의 Hop-by-Hop 식별자 필드의 원래 값을 복원해야 합니다.\(MUST\)

메시지의 마지막 Proxy-Info AVP가 로컬 Diameter 서버를 대상으로 하는 경우 AVP는 응답이 전달되기 전에 제거되어야 합니다.\(MUST\)

릴레이 또는 프록시 에이전트가 실패를 나타내는 결과 코드 AVP가 포함된 응답을 수신하는 경우 AVP의 내용을 수정해서는 안 됩니다. 감지된 추가 로컬 오류는 모두 기록되어야 하지만 결과 코드 AVP에는 반영되지 않습니다. 에이전트가 성공을 나타내는 결과 코드 AVP가 포함된 응답 메시지를 수신하고 오류를 나타내기 위해 AVP를 수정하려는 경우 액세스 장치로 향하는 메시지에 적절한 오류를 포함하도록 결과 코드 AVP를 수정해야 합니다. 또한 Error-Reporting-Host AVP를 포함하고 액세스 장치를 대신하여 STR을 발행해야 합니다.\(MUST NOT, SHOULD, MUST\)

그런 다음 에이전트는 원래 요청을 받은 호스트에 응답을 보내야 합니다.\(MUST\)

---
### **6.3.  Origin-Host AVP**

Origin-Host AVP\(AVP 코드 264\)는 DiameterIdentity 유형이며 모든 Diameter 메시지에 있어야 합니다. 이 AVP는 Diameter 메시지를 발생시킨 엔드포인트를 식별합니다. 릴레이 에이전트는 이 AVP를 수정해서는 안 됩니다.\(MUST, MUST NOT\)

Origin-Host AVP의 값은 단일 호스트 내에서 고유함을 보장합니다.

Diameter 피어가 두 개 이상의 주소를 지원할 수 있으므로 Origin-Host AVP는 두 개 이상의 주소를 확인할 수 있습니다.

이 AVP는 가능한 한 Diameter 헤더에 가깝게 배치되어야 합니다. 6.10\(SHOULD\)

---
### **6.4.  Origin-Realm AVP**

Origin-Realm AVP\(AVP 코드 296\)는 DiameterIdentity 유형입니다. 이 AVP는 모든 Diameter 메시지의 발신자의 영역을 포함하며 모든 메시지에 존재해야 합니다.\(MUST\)

이 AVP는 가능한 한 Diameter 헤더에 가깝게 배치되어야 합니다.\(SHOULD\)

---
### **6.5.  Destination-Host AVP**

대상 호스트 AVP\(AVP 코드 293\)는 DiameterIdentity 유형입니다. 이 AVP는 원치 않는 에이전트가 시작한 모든 메시지에 있어야 하며, 요청 메시지에 나타날 수 있으며, 응답 메시지에는 있어서는 안 됩니다.\(MUST NOT\)

Destination-Host AVP가 없으면 Destination-Realm AVP에 지정된 영역 내에서 애플리케이션을 지원하는 Diameter 서버로 메시지가 전송됩니다.

이 AVP는 가능한 한 Diameter 헤더에 가깝게 배치되어야 합니다.\(SHOULD\)

---
### **6.6.  Destination-Realm AVP**

Destination-Realm AVP\(AVP 코드 283\)는 DiameterIdentity 유형이며 메시지가 라우팅될 영역을 포함합니다. Destination-Realm AVP는 응답 메시지에 존재해서는 안 됩니다. Diameter 클라이언트는 사용자 이름 AVP의 영역 부분을 삽입합니다. 요청 메시지를 시작하는 Diameter 서버는 의도된 대상 호스트로부터 수신된 이전 메시지의 Origin-Realm AVP 값을 사용합니다\(선험적으로 알려진 경우 제외\). 존재하는 경우 Destination-Realm AVP는 메시지 라우팅 결정을 수행하는 데 사용됩니다.\(MUST NOT\)

ABNF가 Destination-Realm AVP를 필수 AVP로 나열하지 않는 요청 메시지는 본질적으로 라우팅할 수 없는 메시지입니다.

이 AVP는 가능한 한 Diameter 헤더에 가깝게 배치되어야 합니다.\(SHOULD\)

---
### **6.7.  Routing AVPs**

이 섹션에서 정의된 AVP는 라우팅 목적으로 사용되는 Diameter AVP입니다. 이러한 AVP는 Diameter 메시지가 에이전트에 의해 처리됨에 따라 변경되므로 종단 간 보안으로 보호되어서는 안 됩니다.\(MUST NOT\)

---
#### **6.7.1.  Route-Record AVP**

Route-Record AVP\(AVP 코드 282\)는 DiameterIdentity 유형입니다. 이 AVP에 추가된 ID는 Capability Exchange 메시지의 Origin-Host에서 수신된 ID와 동일해야 합니다.\(MUST\)

---
#### **6.7.2.  Proxy-Info AVP**

Proxy-Info AVP\(AVP 코드 284\)는 그룹화 유형입니다. 그룹화된 데이터 필드에는 다음과 같은 ABNF 문법이 있습니다.

```text
      Proxy-Info ::= < AVP Header: 284 >
                     { Proxy-Host }
                     { Proxy-State }
                   * [ AVP ]
```

---
#### **6.7.3.  Proxy-Host AVP**

프록시-호스트 AVP\(AVP 코드 280\)는 DiameterIdentity 유형입니다. 이 AVP에는 Proxy-Info AVP를 추가한 호스트의 ID가 포함되어 있습니다.

---
#### **6.7.4.  Proxy-State AVP**

Proxy-State AVP\(AVP Code 33\)는 OctetString 유형이고 상태 로컬 정보를 포함하며 불투명 데이터로 처리되어야 합니다.\(MUST\)

---
### **6.8.  Auth-Application-Id AVP**

Auth-Application-Id AVP\(AVP 코드 258\)는 Unsigned32 유형이며 애플리케이션의 인증 및 권한 부여 부분 지원을 광고하는 데 사용됩니다\(섹션 2.4 참조\). Auth-Application-Id는 별도의 Diameter 사양에 정의되고 할당된 애플리케이션 ID가 있는 모든 인증 및/또는 권한 부여 메시지에도 있어야 합니다.\(MUST\)

---
### **6.9.  Acct-Application-Id AVP**

Acct-Application-Id AVP\(AVP 코드 259\)는 Unsigned32 유형이며 애플리케이션의 회계 부분 지원을 광고하는 데 사용됩니다\(섹션 2.4 참조\). Acct-Application-Id는 모든 회계 메시지에도 있어야 합니다. Auth-Application-Id 및 Acct-Application-Id AVP 중 정확히 하나만 존재할 수 있습니다.\(MUST, MAY\)

---
### **6.10.  Inband-Security-Id AVP**

Inband-Security-Id AVP\(AVP 코드 299\)는 Unsigned32 유형이며 애플리케이션의 보안 부분 지원을 광고하는 데 사용됩니다.

현재 다음 값이 지원되지만 새 보안 ID를 추가할 수 있는 공간이 충분합니다.

NO\_INBAND\_SECURITY 0

- 이 피어는 TLS를 지원하지 않습니다. AVP가 생략된 경우 이는 기본값입니다.

TLS 1

- 이 노드는 \[TLS\]에 정의된 대로 TLS 보안을 지원합니다.

---
### **6.11.  Vendor-Specific-Application-Id AVP**

Vendor-Specific-Application-Id AVP\(AVP 코드 260\)는 그룹화 유형이며 공급업체별 Diameter 애플리케이션 지원을 광고하는 데 사용됩니다. Auth-Application-Id 및 Acct-Application-Id AVP 중 정확히 하나만 존재할 수 있습니다.\(MAY\)

이 AVP는 공급업체별 애플리케이션에 정의된 모든 실험 명령의 첫 번째 AVP로도 존재해야 합니다.\(MUST\)

이 AVP는 가능한 한 Diameter 헤더에 가깝게 배치되어야 합니다.\(SHOULD\)

```text
   AVP Format

   <Vendor-Specific-Application-Id> ::= < AVP Header: 260 >
                                     1* [ Vendor-Id ]
                                     0*1{ Auth-Application-Id }
                                     0*1{ Acct-Application-Id }
```

---
### **6.12.  Redirect-Host AVP**

응답 메시지의 'E' 비트가 설정되고 결과 코드 AVP가 DIAMETER\_REDIRECT\_INDICATION으로 설정된 경우 이 AVP의 인스턴스 중 하나 이상이 존재해야 합니다.\(MUST\)

위의 내용을 수신하면 수신 Diameter 노드는 이러한 AVP에서 식별된 호스트 중 하나에 직접 요청을 전달해야 합니다. 선택된 Redirect-Host AVP에 포함된 서버는 이 세션과 관련된 모든 메시지에 사용되어야 합니다.\(SHOULD, SHOULD\)

---
### **6.13.  Redirect-Host-Usage AVP**

Redirect-Host-Usage AVP\(AVP 코드 261\)는 열거형 유형입니다. 이 AVP는 'E' 비트가 설정되고 결과 코드 AVP가 DIAMETER\_REDIRECT\_INDICATION으로 설정된 응답 메시지에 존재할 수 있습니다.\(MAY\)

존재하는 경우 이 AVP는 Redirect-Host로 인한 라우팅 항목이 사용되는 방법을 나타냅니다. 다음 값이 지원됩니다.

DONT\_캐시 0

- Redirect-Host AVP에 지정된 호스트는 캐시되어서는 안 됩니다. 이것이 기본값입니다.

모든\_세션 1

- Session-ID AVP의 동일한 값으로 정의된 동일한 세션 내의 모든 메시지는 Redirect-Host AVP에 지정된 호스트로 전송될 수 있습니다.\(MAY\)

ALL\_REALM 2

- 요청된 영역으로 향하는 모든 메시지는 Redirect-Host AVP에 지정된 호스트로 전송될 수 있습니다.\(MAY\)

REALM\_AND\_APPLICATION 3

- 지정된 영역에 요청된 애플리케이션에 대한 모든 메시지는 Redirect-Host AVP에 지정된 호스트로 전송될 수 있습니다.\(MAY\)

ALL\_애플리케이션 4

- 요청된 애플리케이션에 대한 모든 메시지는 Redirect-Host AVP에 지정된 호스트로 전송될 수 있습니다.\(MAY\)

모든\_호스트 5

- Redirect-Host를 생성한 호스트로 전송되는 모든 메시지는 Redirect-Host AVP에 지정된 호스트로 전송될 수 있습니다.\(MAY\)

ALL\_USER 6

- 요청된 사용자에 대한 모든 메시지는 Redirect-Host AVP에 지정된 호스트로 전송될 수 있습니다.\(MAY\)

---
### **6.14.  Redirect-Max-Cache-Time AVP**

Redirect-Max-Cache-Time AVP\(AVP 코드 262\)는 Unsigned32 유형입니다. 이 AVP는 'E' 비트가 설정된 응답 메시지에 있어야 하며, 결과 코드 AVP는 DIAMETER\_REDIRECT\_INDICATION으로 설정되고 Redirect-Host-Usage AVP는 0이 아닌 값으로 설정됩니다.\(MUST\)

이 AVP에는 리디렉션 호스트의 결과로 생성된 피어 및 경로 테이블 항목이 캐시되는 최대 시간\(초\)이 포함됩니다. 리디렉션 표시로 인해 생성된 호스트에 더 이상 연결할 수 없으면 관련 피어 및 라우팅 테이블 항목을 삭제해야 합니다.\(MUST\)

---
### **6.15.  E2E-Sequence AVP**

E2E-Sequence AVP\(AVP 코드 300\)는 종단 간 메시지에 대한 재생 방지 보호를 제공하며 그룹화된 유형입니다. 여기에는 임의의 값\(nonce가 있는 OctetString\)과 카운터\(Integer\)가 포함됩니다. 노드가 통신하는\(또는 통신을 기억하는\) 각 엔드투엔드 피어에 대해 서로 다른 nonce 값을 사용해야 하며 카운터는 0에서 시작되고 이 AVP가 해당 피어에 방출될 때마다 1씩 증가합니다. 이 AVP는 종단 간 보호\(예: CMS 서명 또는 암호화\)를 사용하는 모든 메시지에 포함되어야 합니다.\(MUST, MUST\)

---
## **7.  Error Handling**

직경에는 두 가지 유형의 오류가 있습니다. 프로토콜 및 애플리케이션 오류. 프로토콜 오류는 기본 프로토콜 수준에서 발생하는 오류이며 홉당 주의가 필요할 수 있습니다\(예: 메시지 라우팅 오류\). 반면 애플리케이션 오류는 일반적으로 Diameter 애플리케이션에 지정된 기능의 문제\(예: 사용자 인증, AVP 누락\)로 인해 발생합니다.\(MAY\)

프로토콜 오류를 보고하는 데 사용되는 결과 코드 AVP 값은 'E' 비트가 설정된 응답 메시지에만 있어야 합니다. 프로토콜 오류를 일으키는 요청 메시지가 수신되면 'E' 비트가 설정된 응답 메시지가 반환되고 결과 코드 AVP가 적절한 프로토콜 오류 값으로 설정됩니다. 응답이 요청 발신자에게 다시 전송되면 각 프록시 또는 중계 에이전트는 메시지에 대해 조치를 취할 수 있습니다.\(MUST, MAY\)

```text
                          1. Request        +---------+ Link Broken
                +-------------------------->|Diameter |----///----+
                |     +---------------------|         |           v
         +------+--+  | 2. answer + 'E' set | Relay 2 |     +--------+
         |Diameter |<-+ (Unable to Forward) +---------+     |Diameter|
         |         |                                        |  Home  |
         | Relay 1 |--+                     +---------+     | Server |
         +---------+  |   3. Request        |Diameter |     +--------+
                      +-------------------->|         |           ^
                                            | Relay 3 |-----------+
                                            +---------+

           Figure 7:  Example of Protocol Error causing answer message
```

그림 7은 Diameter 릴레이에 의해 업스트림으로 전달되는 메시지의 예를 제공합니다. Relay 2가 메시지를 수신하고 홈 서버로 요청을 전달할 수 없음을 감지하면 'E' 비트가 설정되고 결과 코드 AVP가 DIAMETER\_UNABLE\_TO\_DELIVER로 설정된 응답 메시지가 반환됩니다. 이 오류가 발생한다는 점을 고려하면

프로토콜 오류 범주 내에서 릴레이 1은 특별한 조치를 취하고 오류가 발생하면 대체 릴레이 3을 통해 메시지 라우팅을 시도합니다.

```text
         +---------+ 1. Request  +---------+ 2. Request  +---------+
         | Access  |------------>|Diameter |------------>|Diameter |
         |         |             |         |             |  Home   |
         | Device  |<------------|  Relay  |<------------| Server  |
         +---------+  4. Answer  +---------+  3. Answer  +---------+
                    (Missing AVP)           (Missing AVP)

              Figure 8: Example of Application Error Answer message
```

그림 8은 애플리케이션 오류를 일으킨 Diameter 메시지의 예를 제공합니다. 애플리케이션 오류가 발생하면 오류를 보고하는 Diameter 엔터티는 명령 플래그의 'R' 비트를 지우고 적절한 값으로 결과 코드 AVP를 추가합니다. 응용 프로그램 오류에는 프록시 또는 중계 에이전트 개입이 필요하지 않으므로 메시지는 요청 보낸 사람에게 다시 전달됩니다.

답변에 추가 AVP가 있어야 하는 특정 결과 코드 AVP 애플리케이션 오류가 있습니다. 이러한 경우 오류를 나타내기 위해 결과 코드 AVP를 설정하는 Diameter 노드는 AVP를 추가해야 합니다. 예는 다음과 같습니다:\(MUST\)

- 인식되지 않은 AVP는 'M' 비트\(필수 비트\)가 설정된 상태로 수신되며, 응답은 DIAMETER\_AVP\_UNSUPPORTED로 설정된 결과 코드 AVP 및 문제가 되는 AVP를 포함하는 실패-AVP AVP와 함께 전송됩니다.

- 인식할 수 없는 값으로 수신된 AVP로 인해 DIAMETER\_INVALID\_AVP\_VALUE로 설정된 결과 코드 AVP와 함께 응답이 반환되며, 오류를 유발하는 AVP가 포함된 실패-AVP AVP가 있습니다.

- 생략된 AVP로 명령이 수신되었으나 아직

- 명령의 ABNF에 따라 필수입니다. 수신자는 DIAMETER\_MISSING\_AVP로 설정된 결과 코드를 사용하여 응답을 발행하고 누락된 AVP에 예상대로 설정된 AVP 코드 및 기타 필드를 사용하여 AVP를 생성합니다. 생성된 AVP는 Failed-AVP AVP에 추가됩니다.

결과 코드 AVP는 Diameter 노드가 처리 중에 발생한 오류를 설명합니다. 여러 오류가 있는 경우 Diameter 노드는 발생한 첫 번째 오류만 보고해야 합니다.\(MUST\)

\(일부 구현에 따른 순서로 감지될 수 있음\) 이 AVP에서 설명할 수 있는 구체적인 오류는 다음 섹션에 설명되어 있습니다.

---
### **7.1.  Result-Code AVP**

결과 코드 AVP\(AVP 코드 268\)는 Unsigned32 유형이며 특정 요청이 성공적으로 완료되었는지 또는 오류가 발생했는지 여부를 나타냅니다. IETF 애플리케이션에 정의된 모든 Diameter 응답 메시지는 하나의 결과 코드 AVP를 포함해야 합니다. 비성공적인 결과 코드 AVP\(DIAMETER\_REDIRECT\_INDICATION 이외의 2xxx가 아닌 값을 포함하는 것\)는 결과 코드 AVP를 설정하는 호스트가 Origin-Host AVP에 인코딩된 ID와 다른 경우 오류 보고 호스트 AVP를 포함해야 합니다.\(MUST, MUST\)

결과 코드 데이터 필드에는 오류를 나타내는 IANA 관리 32비트 주소 공간이 포함되어 있습니다\(섹션 11.4 참조\). Diameter는 다음과 같은 종류의 오류를 제공하며 모두 십진수 표기법의 천 자리로 식별됩니다.

```text
      -  1xxx (Informational)
      -  2xxx (Success)
      -  3xxx (Protocol Errors)
      -  4xxx (Transient Failures)
      -  5xxx (Permanent Failure)
```

인식되지 않는 클래스\(이 섹션에서 첫 번째 숫자가 정의되지 않은 클래스\)는 영구 실패로 처리되어야 합니다.\(MUST\)

---
#### **7.1.1.  Informational**

이 범주에 속하는 오류는 요청자에게 요청을 충족할 수 없으며 액세스 권한을 부여하기 전에 추가 조치가 필요함을 알리는 데 사용됩니다.

DIAMETER\_MULTI\_ROUND\_AUTH 1001

- 이 정보 오류는 사용 중인 인증 메커니즘에 여러 번의 왕복이 필요하며 액세스가 허용되려면 후속 요청이 발행되어야 함을 액세스 장치에 알리기 위해 Diameter 서버에 의해 반환됩니다.

---
#### **7.1.2.  Success**

성공 범주에 속하는 오류는 요청이 성공적으로 완료되었음을 피어에게 알리는 데 사용됩니다.

DIAMETER\_성공 2001

- 요청이 성공적으로 완료되었습니다.

DIAMETER\_LIMITED\_SUCCESS 2002

- 반환 시 요청이 성공적으로 완료되었으나, 사용자에게 서비스를 제공하기 위해서는 애플리케이션에서 추가 처리가 필요합니다.

---
#### **7.1.3.  Protocol Errors**

프로토콜 오류 범주에 속하는 오류는 홉별로 처리되어야 하며, 직경 프록시는 가능하다면 오류 수정을 시도할 수 있습니다. 이러한 오류와 이러한 오류만 'E' 비트가 설정된 응답 메시지에만 사용해야 한다는 점에 유의하세요.\(SHOULD, MUST\)

DIAMETER\_COMMAND\_UNSUPPORTED 3001

- 요청에는 수신자가 인식하지 못하거나 지원하지 않는 명령 코드가 포함되어 있습니다. 이는 Diameter 노드가 이해하지 못하는 실험적 명령을 수신할 때 사용해야 합니다.\(MUST\)

DIAMETER\_UNABLE\_TO\_DELIVER 3002

- 이 오류는 요구된 애플리케이션을 지원하는 영역 내에서 요청을 처리하는 데 사용할 수 있는 호스트가 없거나 연결된 대상 영역 AVP 없이 대상-호스트 AVP가 제공되었기 때문에 Diameter가 메시지를 대상에 전달할 수 없을 때 발생합니다.

DIAMETER\_REALM\_NOT\_SERVED 3003

- 요청의 의도된 영역이 인식되지 않습니다.

DIAMETER\_TOO\_BUSY 3004

- 반환되면 Diameter 노드는 대체 피어에게 메시지 전송을 시도해야 합니다. 이 오류는 특정 서버가 요청된 경우에만 사용해야 하며 해당 서버는 요청된 서비스를 제공할 수 없습니다.\(SHOULD, MUST\)

DIAMETER\_LOOP\_감지됨 3005

- 에이전트가 의도된 수신자에게 메시지를 전달하는 동안 루프를 감지했습니다. 메시지는 대체 피어\(사용 가능한 경우\)로 전송될 수 있지만 오류를 보고하는 피어가 구성 문제를 식별한 것입니다.\(MAY\)

DIAMETER\_REDIRECT\_INDICATION 3006

- 리디렉션 에이전트는 요청이 로컬에서 충족될 수 없다고 판단했으며 요청 개시자는 연락처 정보가 응답에 추가된 서버로 직접 요청을 전달해야 합니다. 설정되면 Redirect-Host AVP가 있어야 합니다.\(MUST\)

DIAMETER\_APPLICATION\_UNSUPPORTED 3007

- 지원되지 않는 애플리케이션에 대한 요청이 전송되었습니다.

DIAMETER\_INVALID\_HDR\_BITS 3008

- Diameter 헤더의 비트가 잘못된 조합으로 설정되었거나 명령 코드 정의와 일치하지 않는 값으로 설정된 요청이 수신되었습니다.

DIAMETER\_INVALID\_AVP\_BITS 3009

- 플래그 비트가 인식할 수 없는 값으로 설정되어 있거나 AVP 정의와 일치하지 않는 AVP를 포함하는 요청이 수신되었습니다.

DIAMETER\_UNKNOWN\_PEER 3010

- 알 수 없는 피어로부터 CER을 받았습니다.

---
#### **7.1.4.  Transient Failures**

- 일시적 실패 범주에 속하는 오류는 요청이 수신된 당시에는 충족될 수 없었지만 나중에 요청을 충족할 수 있음을 피어에게 알리는 데 사용됩니다.\(MAY\)

DIAMETER\_AUTHENTICATION\_REJECTED 4001

- 사용자에 대한 인증 프로세스가 실패했습니다. 사용자가 사용한 잘못된 비밀번호로 인해 발생한 것 같습니다. 추가 시도는 사용자에게 새 비밀번호를 묻는 메시지를 표시한 후에만 시도해야 합니다.\(MUST\)

DIAMETER\_OUT\_OF\_SPACE 4002

- Diameter 노드가 회계 요청을 받았지만 일시적인 공간 부족으로 안정적인 저장소에 커밋하지 못했습니다.

ELECTION\_LOST 4003

- 피어는 선택 프로세스가 손실되어 전송 연결이 끊어졌다고 판단했습니다.

---
#### **7.1.5.  Permanent Failures**

- 영구 실패 범주에 속하는 오류는 요청이 실패했으며 다시 시도해서는 안 된다는 것을 피어에게 알리는 데 사용됩니다.

DIAMETER\_AVP\_UNSUPPORTED 5001

- 피어가 인식되지 않거나 지원되지 않고 필수 비트로 표시된 AVP가 포함된 메시지를 수신했습니다. 이 오류가 포함된 Diameter 메시지에는 실패를 일으킨 AVP를 포함하는 하나 이상의 Failed-AVP AVP가 포함되어야 합니다.\(MUST\)

DIAMETER\_UNKNOWN\_SESSION\_ID 5002

- 요청에 알 수 없는 세션 ID가 포함되어 있습니다.

DIAMETER\_AUTHORIZATION\_REJECTED 5003

- 사용자가 승인될 수 없는 요청이 수신되었습니다. 이 오류는 요청한 서비스가 사용자에게 허용되지 않는 경우 발생할 수 있습니다.

DIAMETER\_INVALID\_AVP\_VALUE 5004

- 요청의 데이터 부분에 잘못된 값이 있는 AVP가 포함되어 있습니다. 이 오류를 나타내는 Diameter 메시지는 Failed-AVP AVP 내에 문제가 되는 AVP를 포함해야 합니다.\(MUST\)

DIAMETER\_MISSING\_AVP 5005

- 요청에 명령 코드 정의에 필요한 AVP가 포함되어 있지 않습니다. 이 값이 결과 코드 AVP로 전송되면 Failed-AVP AVP가 메시지에 포함되어야 합니다. Failed-AVP AVP에는 해당되는 경우 Vendor-Id가 포함된 누락된 AVP의 예가 포함되어야 합니다. 누락된 AVP의 값 필드는 올바른 최소 길이를 가져야 하며 0을 포함해야 합니다.\(SHOULD, MUST\)

DIAMETER\_RESOURCES\_EXCEEDED 5006

- 사용자가 이미 허용된 리소스를 사용했기 때문에 승인할 수 없는 요청이 수신되었습니다. 이 오류 조건의 예로는 하나의 전화 접속 PPP 포트만 사용할 수 있는 사용자가 두 번째 PPP 연결을 설정하려고 시도하는 경우입니다.

DIAMETER\_CONTRADICTING\_AVPS 5007

- Home Diameter 서버는 요청에서 서로 모순되는 AVP를 감지했으며 사용자에게 서비스를 제공할 의사가 없습니다. 서로 모순되는 AVP를 포함하는 하나 이상의 Failed-AVP AVP가 있어야 합니다.\(MUST\)

DIAMETER\_AVP\_NOT\_ALLOWED 5008

- 존재해서는 안 되는 AVP와 함께 메시지가 수신되었습니다. Failed-AVP AVP는 반드시 포함되어야 하며 문제가 되는 AVP의 복사본을 포함해야 합니다.\(MUST NOT, MUST\)

DIAMETER\_AVP\_OCCURS\_TOO\_MANY\_TIMES 5009

- 메시지 정의에서 허용된 것보다 더 자주 나타나는 AVP를 포함하는 메시지가 수신되었습니다. Failed-AVP AVP는 반드시 포함되어야 하며 최대 발생 횟수를 초과한 위반 AVP의 첫 번째 인스턴스의 복사본을 포함해야 합니다.\(MUST\)

DIAMETER\_NO\_COMMON\_APPLICATION 5010

- CER 메시지가 수신되고 피어 간에 지원되는 공통 애플리케이션이 없는 경우 이 오류가 반환됩니다.

DIAMETER\_UNSUPPORTED\_VERSION 5011

- 지원되지 않는 버전의 요청을 수신한 경우 이 오류가 반환됩니다.

DIAMETER\_UNABLE\_TO\_COMPLY 5012

- 불특정 이유로 요청이 거부된 경우 이 오류가 반환됩니다.

DIAMETER\_INVALID\_BIT\_IN\_HEADER 5013

- Diameter 헤더의 인식할 수 없는 비트가 1로 설정된 경우 이 오류가 반환됩니다.

DIAMETER\_INVALID\_AVP\_LENGTH 5014

- 요청에 잘못된 길이의 AVP가 포함되어 있습니다. 이 오류를 나타내는 Diameter 메시지는 Failed-AVP AVP 내에 문제가 되는 AVP를 포함해야 합니다.\(MUST\)

DIAMETER\_INVALID\_MESSAGE\_LENGTH 5015

- 잘못된 메시지 길이로 요청을 수신한 경우 이 오류가 반환됩니다.

DIAMETER\_INVALID\_AVP\_BIT\_COMBO 5016

- 요청에는 AVP 플래그 필드에 지정된 값을 갖는 것이 허용되지 않는 AVP가 포함되어 있습니다. 이 오류를 나타내는 Diameter 메시지는 Failed-AVP AVP 내에 문제가 되는 AVP를 포함해야 합니다.\(MUST\)

DIAMETER\_NO\_COMMON\_SECURITY 5017

- 이 오류는 CER 메시지가 수신될 때 반환되며 피어 간에 지원되는 공통 보안 메커니즘이 없습니다. CEA\(Capability-Exchange-Answer\)는 DIAMETER\_NO\_COMMON\_SECURITY로 설정된 결과 코드 AVP와 함께 반환되어야 합니다.\(MUST\)

---
### **7.2.  Error Bit**

요청으로 인해 프로토콜 관련 오류가 발생하면 Diameter 헤더의 'E'\(오류 비트\)가 설정됩니다\(섹션 7.1.3 참조\). 'E' 비트가 포함된 메시지는 응답 메시지에 대한 응답으로 전송되어서는 안 됩니다. 'E' 비트가 설정된 메시지에는 여전히 섹션 6.2에 정의된 처리 규칙이 적용됩니다. 설정된 경우 응답 메시지는 명령에 대한 ABNF 사양을 따르지 않고 대신 다음 ABNF를 따릅니다.\(MUST NOT\)

```text
   Message Format

   <answer-message> ::= < Diameter Header: code, ERR [PXY] >
                     0*1< Session-Id >
                        { Origin-Host }
                        { Origin-Realm }
                        { Result-Code }
                        [ Origin-State-Id ]
                        [ Error-Reporting-Host ]
                        [ Proxy-Info ]
                      * [ AVP ]
```

헤더에 사용된 코드는 요청 메시지에 있는 코드와 동일하지만 'R' 비트가 지워지고 'E' 비트가 설정되어 있습니다. 헤더의 'P' 비트는 요청 메시지에 있는 것과 동일한 값으로 설정됩니다.

---
### **7.3.  Error-Message AVP**

오류 메시지 AVP\(AVP 코드 281\)는 UTF8String 유형입니다. 이는 사람이 읽을 수 있는 오류 메시지로 결과 코드 AVP를 동반할 수 있습니다. 오류 메시지 AVP는 실시간으로 유용하도록 의도되지 않았으며 네트워크 엔터티에 의해 구문 분석될 것으로 예상되어서는 안 됩니다.\(MAY, SHOULD NOT\)

---
### **7.4.  Error-Reporting-Host AVP**

오류 보고 호스트 AVP\(AVP 코드 294\)는 DiameterIdentity 유형입니다. 이 AVP에는 Result-Code AVP를 2001\(성공\) 이외의 값으로 보낸 Diameter 호스트의 ID가 포함되어 있습니다. 단, Result-Code를 설정한 호스트가 Origin-Host AVP에 인코딩된 것과 다른 경우에만 해당됩니다. 이 AVP는 문제 해결 목적으로 사용되도록 고안되었으며 결과 코드 AVP가 실패를 나타낼 때 설정되어야 합니다.\(MUST\)

---
### **7.5.  Failed-AVP AVP**

Failed-AVP AVP\(AVP Code 279\)는 Grouped 유형이며 특정 AVP의 잘못된 정보로 인해 요청이 거부되거나 완전히 처리되지 않는 경우 디버깅 정보를 제공합니다. Result-Code AVP의 값은 Failed-AVP AVP의 이유에 대한 정보를 제공합니다.

이 AVP의 가능한 이유는 부적절하게 구성된 AVP의 존재, 지원되지 않거나 인식되지 않는 AVP, 유효하지 않은 AVP 값, 필수 AVP의 누락, 명시적으로 제외된 AVP의 존재\(섹션 10의 표 참조\) 또는 0, 1 또는 0-1 발생으로 제한되는 AVP가 2개 이상 발생합니다.

Diameter 메시지는 성공적으로 처리될 수 없는 전체 AVP를 포함하는 하나의 Failed-AVP AVP를 포함할 수 있습니다. 실패 이유가 필수 AVP의 누락인 경우, 누락된 AVP 코드, 누락된 공급업체 ID 및 생략된 AVP에 필요한 최소 길이의 0으로 채워진 페이로드가 있는 AVP가 추가됩니다.\(MAY\)

```text
   AVP Format

      <Failed-AVP> ::= < AVP Header: 279 >
                    1* {AVP}
```

---
### **7.6.  Experimental-Result AVP**

실험 결과 AVP\(AVP 코드 297\)는 그룹화 유형이며 특정 공급업체별 요청이 성공적으로 완료되었는지 또는 오류가 발생했는지 여부를 나타냅니다. 데이터 필드에는 다음과 같은 ABNF 문법이 있습니다.

```text
   AVP Format

      Experimental-Result ::= < AVP Header: 297 >
                                 { Vendor-Id }
                                 { Experimental-Result-Code }
```

이 그룹화된 AVP의 Vendor-Id AVP\(섹션 5.3.3 참조\)는 다음에 나오는 결과 코드 할당을 담당하는 공급업체를 식별합니다. 벤더별 애플리케이션에 정의된 모든 Diameter 응답 메시지에는 하나의 결과 코드 AVP 또는 하나의 실험 결과 AVP가 포함되어야 합니다.\(MUST\)

---
### **7.7.  Experimental-Result-Code AVP**

Experimental-Result-Code AVP\(AVP 코드 298\)는 Unsigned32 유형이며 요청 처리 결과를 나타내는 공급업체 할당 값을 포함합니다.

벤더별 결과 코드는 다양한 유형의 결과 코드 및 오류 처리\(2xxx 값이 아닌 경우\)와 관련하여 결과 코드 AVP에 제공된 동일한 규칙을 따르는 것이 좋습니다.

---
## **8.  Diameter User Sessions**

Diameter는 애플리케이션에 두 가지 유형의 서비스를 제공할 수 있습니다. 첫 번째는 인증 및 권한 부여와 관련되며 선택적으로 계정을 사용할 수 있습니다. 두 번째는 회계만을 사용합니다.

서비스가 애플리케이션의 인증 및/또는 권한 부여 부분을 사용하고 사용자가 네트워크에 대한 액세스를 요청하면 Diameter 클라이언트는 로컬 서버에 인증 요청을 보냅니다. 인증 요청은 서비스별 Diameter 애플리케이션\(예: NASREQ\)에서 정의됩니다. 요청에는 사용자 세션과 관련된 후속 메시지\(예: 후속 인증, 계정 등\)에 사용되는 Session-Id AVP가 포함되어 있습니다. Session-Id AVP는 클라이언트와 서버가 Diameter 메시지를 사용자 세션과 연관시키는 수단입니다.

Diameter 서버가 사용자에게 제한된 시간 동안 네트워크 리소스를 사용할 수 있는 권한을 부여하고 향후 요청을 통해 권한 부여를 확장하려는 경우 Authorization-Lifetime AVP를 응답 메시지에 추가해야 합니다. Authorization-Lifetime AVP는 서버가 다른 인증 요청을 예상하기 전에 사용자가 리소스를 사용할 수 있는 최대 시간\(초\)을 정의합니다. Auth-Grace-Period AVP에는 Authorization-Lifetime이 만료된 후의 시간\(초\)이 포함되어 있으며 그 후 서버는 사용자 세션과 관련된 모든 상태 정보를 해제합니다. 서비스에 대한 지불이 사용자의 홈 영역에서 제공되는 영역으로 예상되는 경우 Auth-Grace-Period AVP와 결합된 Authorization-Lifetime AVP는 홈 영역이 재정적으로 책임을 질 의향이 있는 세션의 최대 길이를 의미합니다. 을 위한. Authorization-Lifetime 및 Auth-Grace-Period AVP 만료 이후에 제공되는 서비스는 액세스 장치의 책임입니다. 물론, 렌더링된 서비스의 실제 비용은 분명히 프로토콜 범위를 벗어납니다.\(MUST, MAY\)

서버에 재인증 또는 세션 종료 요청을 보낼 것으로 예상되지 않는 액세스 장치는 서버에 대한 힌트로 NO\_STATE\_MAINTAINED로 설정된 값을 가진 Auth-Session-State AVP를 포함할 수 있습니다. 서버가 힌트를 수락하면 사용자에 대한 서비스가 종료되면 세션 종료 메시지가 수신되지 않으므로 세션 상태를 유지할 수 없다는 데 동의합니다. 서버로부터의 응답 메시지가 Auth-Session-State AVP의 다른 값\(또는 AVP가 없는 경우 기본값\)을 포함하는 경우 액세스 장치는 서버의 지시어를 따라야 합니다. NO\_STATE\_MAINTAINED 값은 후속 재인증 요청 및 응답에 설정되어서는 안 됩니다.\(MAY, MUST, MUST NOT\)

기본 프로토콜에는 권한 부여 요청 메시지가 포함되어 있지 않습니다. 왜냐하면 이러한 메시지는 주로 애플리케이션별로 다르며 Diameter 애플리케이션 문서에 정의되어 있기 때문입니다. 그러나 기본 프로토콜은 사용자 세션을 종료하는 데 사용되는 메시지 집합을 정의합니다. 이는 상태 정보를 유지 관리하는 서버가 리소스를 확보할 수 있도록 하는 데 사용됩니다.

서비스가 애플리케이션과 결합하여 Diameter 프로토콜의 회계 부분만 사용하는 경우 Session-Id는 여전히 사용자 세션을 식별하는 데 사용됩니다. 다만, 어카운팅 중지 메시지를 발행하여 세션이 종료되었음을 알리므로 세션 종료 메시지는 사용되지 않는다.

---
### **8.1.  Authorization Session State Machine**

이 섹션에는 Diameter 세션의 수명 주기를 나타내는 유한 상태 머신 세트가 포함되어 있으며 Diameter 애플리케이션의 인증 및/또는 권한 부여 부분을 사용하는 모든 Diameter 구현에서 반드시 관찰해야 합니다. 아래의 특정 서비스라는 용어는 Diameter 애플리케이션\(예: 모바일 IPv4, NASREQ\)에 정의된 메시지를 나타냅니다.\(MUST\)

Diameter 기본 프로토콜에는 4개의 서로 다른 인증 세션 상태 머신이 지원됩니다. 처음 두 개는 Auth-Session-State AVP 값\(또는 해당 부재\)으로 표시되는 세션 상태를 서버가 유지하는 세션을 설명합니다. 하나는 클라이언트 관점에서 세션을 설명하고 다른 하나는 서버 관점에서 설명합니다. 두 번째 두 상태 머신은 서버가 세션 상태를 유지하지 않을 때 사용됩니다. 여기서도 하나는 클라이언트 관점에서 세션을 설명하고 다른 하나는 서버 관점에서 설명합니다.

세션이 유휴 상태로 전환되면 특정 세션에 할당된 모든 리소스가 해제되어야 합니다. 상태 머신에 나열되지 않은 모든 이벤트는 오류 조건으로 간주되어야 하며, 해당되는 경우 응답이 메시지 발신자에게 반환되어야 합니다.\(MUST\)

```text
   In the state table, the event 'Failure to send X' means that the
   Diameter agent is unable to send command X to the desired
   destination.  This could be due to the peer being down, or due to the
   peer sending back a transient failure or temporary protocol error
   notification DIAMETER_TOO_BUSY or DIAMETER_LOOP_DETECTED in the
   Result-Code AVP of the corresponding Answer command.  The event 'X
   successfully sent' is the complement of 'Failure to send X'.
```

서버에서 상태가 유지될 때 클라이언트는 다음 상태 시스템을 관찰합니다.

```text
                           CLIENT, STATEFUL
   State     Event                          Action     New State
   -------------------------------------------------------------
   Idle      Client or Device Requests      Send       Pending
             access                         service
                                            specific
                                            auth req

   Idle      ASR Received                   Send ASA   Idle
             for unknown session            with
                                            Result-Code
                                            = UNKNOWN_
                                            SESSION_ID

   Pending   Successful Service-specific    Grant      Open
             authorization answer           Access
             received with default
             Auth-Session-State value

   Pending   Successful Service-specific    Sent STR   Discon
             authorization answer received
             but service not provided

   Pending   Error processing successful    Sent STR   Discon
             Service-specific authorization
             answer

   Pending   Failed Service-specific        Cleanup    Idle
             authorization answer received

   Open      User or client device          Send       Open
             requests access to service     service
                                            specific
                                            auth req

   Open      Successful Service-specific    Provide    Open
             authorization answer received  Service

   Open      Failed Service-specific        Discon.    Idle
             authorization answer           user/device
             received.

   Open      Session-Timeout Expires on     Send STR   Discon
             Access Device
```

Open ASR 수신됨, ASA Discon 보내기

- 클라이언트는 세션 종료 요청을 준수합니다. 결과 코드 = SUCCESS, STR 전송.

```text
   Open      ASR Received,                  Send ASA   Open
             client will not comply with    with
             request to end the session     Result-Code
                                            != SUCCESS

   Open      Authorization-Lifetime +       Send STR   Discon
             Auth-Grace-Period expires on
             access device

   Discon    ASR Received                   Send ASA   Discon

   Discon    STA Received                   Discon.    Idle
                                            user/device
```

다음 상태 시스템은 세션 상태를 유지할 때 서버에서 관찰됩니다.

```text
                          SERVER, STATEFUL
   State     Event                          Action     New State
   -------------------------------------------------------------
   Idle      Service-specific authorization Send       Open
             request received, and          successful
             user is authorized             serv.
                                            specific answer

   Idle      Service-specific authorization Send       Idle
             request received, and          failed serv.
             user is not authorized         specific answer

   Open      Service-specific authorization Send       Open
             request received, and user     successful
             is authorized                  serv. specific
                                                  answer

   Open      Service-specific authorization Send       Idle
             request received, and user     failed serv.
             is not authorized              specific
                                            answer,
                                            Cleanup

   Open      Home server wants to           Send ASR   Discon
             terminate the service
```

공개 승인-수명\(및 정리 유휴\)

- Auth-Grace-Period\)가 홈 서버에서 만료됩니다.

```text
   Open      Session-Timeout expires on     Cleanup    Idle
             home server

   Discon    Failure to send ASR            Wait,      Discon
                                            resend ASR

   Discon    ASR successfully sent and      Cleanup    Idle
             ASA Received with Result-Code

   Not       ASA Received                   None       No Change.
   Discon

   Any       STR Received                   Send STA,  Idle
                                            Cleanup.
```

서버에서 상태가 유지되지 않을 때 클라이언트는 다음 상태 시스템을 관찰합니다.

```text
                           CLIENT, STATELESS
   State     Event                          Action     New State
   -------------------------------------------------------------
   Idle      Client or Device Requests      Send       Pending
             access                         service
                                            specific
                                            auth req

   Pending   Successful Service-specific    Grant      Open
             authorization answer           Access
             received with Auth-Session-
             State set to
             NO_STATE_MAINTAINED

   Pending   Failed Service-specific        Cleanup    Idle
             authorization answer
             received

   Open      Session-Timeout Expires on     Discon.    Idle
             Access Device                  user/device

   Open      Service to user is terminated  Discon.    Idle
                                            user/device
```

다음 상태 시스템은 세션 상태를 유지 관리하지 않을 때 서버에서 관찰됩니다.

```text
                           SERVER, STATELESS
   State     Event                          Action     New State
   -------------------------------------------------------------
   Idle      Service-specific authorization Send serv. Idle
             request received, and          specific
             successfully processed         answer
```

---
### **8.2.  Accounting Session State Machine**

다음 상태 머신은 회계 부분이 있거나 회계 서비스만 필요한 애플리케이션에 대해 지원되어야 합니다. 첫 번째 상태 머신은 클라이언트에 의해 관찰됩니다.\(MUST\)

회계 명령 코드에 대해서는 섹션 9.7을 참조하고 회계 AVP에 대해서는 섹션 9.8을 참조하십시오.

회계 상태 시스템의 서버 측은 경우에 따라 특정 애플리케이션에 따라 달라집니다. Diameter 기본 프로토콜은 다른 상태 머신을 지정하지 않은 모든 애플리케이션이 따라야 하는 기본 상태 머신을 정의합니다. 이는 아래에 설명된 이 섹션의 두 번째 상태 머신입니다.\(MUST\)

기본 서버 측 상태 머신은 언제든지 순서와 시간에 관계없이 회계 기록을 수신해야 하며 이러한 기록 처리에 대한 표준 요구 사항을 두지 않습니다. Diameter의 구현은 이러한 기록을 기반으로 확인, 주문, 상관 관계, 사기 감지 및 기타 작업을 수행할 수 있습니다. 기본 직경 AVP와 애플리케이션별 AVP 모두 이러한 작업의 일부로 검사될 수 있습니다. 작업은 레코드 수신 직후 또는 사후 처리 단계에서 발생할 수 있습니다. 그러나 이러한 작업은 일반적으로 애플리케이션이거나 정책에 따라 다르므로 Diameter 사양에 따라 표준화되지 않습니다. 애플리케이션은 Accounting-Realtime-Required AVP, 신용 한도 확인 등의 사용된 값을 기반으로 회계 기록을 언제 수락할지에 대한 요구 사항을 정의할 수 있습니다.\(MAY, MAY, MAY\)

그러나 Diameter 기본 프로토콜은 계정 서버에서 세션 상태를 추적해야 하는 응용 프로그램이 뒤따를 수 있는 하나의 선택적 서버 측 상태 머신을 정의합니다. 이러한 추적은 장기간 연결 문제를 지속하는 능력과 호환되지 않습니다. 따라서 이 상태 머신의 사용은 Accounting-Realtime-Required AVP 값이 DELIVER\_AND\_GRANT인 애플리케이션에서만 권장되며, 따라서 서비스 대상 사용자의 연결을 끊기 위해서는 계정 연결 문제가 필요합니다. 그렇지 않으면 고객이 생성한 기록\(MAY\)

연결이 다시 설정된 후 더 이상 이를 허용하지 않는 서버에 의해 손실될 수 있습니다. 이 상태 머신은 이 섹션의 세 번째 상태 머신입니다. 상태 기계는 감독 세션 타이머 Ts에 의해 감독되며, 이 값은 Acct\_Interim\_Interval 값보다 합리적으로 높아야 합니다. 일시적인 네트워크 오류가 발생하는 경우 Diameter 서버의 계정 세션이 유휴 상태로 변경되는 것을 방지하기 위해 Ts는 Acct\_Interim\_Interval 값의 두 배로 설정될 수 있습니다.\(MAY\)

상태 머신에 나열되지 않은 모든 이벤트는 오류 조건으로 간주되어야 하며, 해당되는 경우 해당 답변이 메시지 발신자에게 반환되어야 합니다.\(MUST\)

상태 테이블에서 '보내기 실패' 이벤트는 Diameter 클라이언트가 원하는 대상과 통신할 수 없음을 의미합니다. 이는 피어가 다운되었거나 피어가 Accounting Answer 명령의 결과 코드 AVP에서 DIAMETER\_OUT\_OF\_SPACE, DIAMETER\_TOO\_BUSY 또는 DIAMETER\_LOOP\_DETECTED를 일시적인 실패 또는 임시 프로토콜 오류 알림으로 다시 전송했기 때문일 수 있습니다.

'Failed Answer' 이벤트는 Diameter 클라이언트가 Accounting Answer 명령에서 일시적이지 않은 실패 알림을 수신했음을 의미합니다.

'사용자/개발자 연결 끊기' 작업은 인증 세션 상태 테이블에도 영향을 주어야 합니다. 예를 들어 특정 애플리케이션에 인증/권한 부여 및 계정 부분이 모두 있는 경우 STR 메시지가 전송되도록 해야 합니다.\(MUST\)

PendingS, PendingI, PendingL, PendingE 및 PendingB 상태는 각각 시작, 중간, 중지, 이벤트 또는 버퍼링된 레코드와 관련된 계정 요청에 대한 응답을 기다리는 보류 상태를 나타냅니다.

```text
                         CLIENT, ACCOUNTING
   State     Event                          Action     New State
   -------------------------------------------------------------
   Idle      Client or device requests      Send       PendingS
             access                         accounting
                                            start req.

   Idle      Client or device requests      Send       PendingE
             a one-time service             accounting
                                            event req

   Idle      Records in storage             Send       PendingB
                                            record

   PendingS  Successful accounting                     Open
             start answer received

   PendingS  Failure to send and buffer     Store      Open
             space available and realtime   Start
             not equal to DELIVER_AND_GRANT Record

   PendingS  Failure to send and no buffer             Open
             space available and realtime
             equal to GRANT_AND_LOSE
```

PendingS 전송 실패 및 버퍼 없음 연결 끊기 유휴

- 사용 가능한 공간 및 실시간 사용자/개발자가 GRANT\_AND\_LOSE와 동일하지 않음

```text
   PendingS  Failed accounting start answer            Open
             received and realtime equal
             to GRANT_AND_LOSE

   PendingS  Failed accounting start answer Disconnect Idle
             received and realtime not      user/dev
             equal to GRANT_AND_LOSE

   PendingS  User service terminated        Store      PendingS
                                            stop
                                            record

   Open      Interim interval elapses       Send       PendingI
                                            accounting
                                            interim
                                            record
   Open      User service terminated        Send       PendingL
                                            accounting
                                            stop req.

   PendingI  Successful accounting interim             Open
             answer received

   PendingI  Failure to send and (buffer    Store      Open
             space available or old record  interim
             can be overwritten) and        record
             realtime not equal to
             DELIVER_AND_GRANT

   PendingI  Failure to send and no buffer             Open
             space available and realtime
             equal to GRANT_AND_LOSE
```

PendingI 전송 실패 및 버퍼 없음 연결 끊기 유휴

- 사용 가능한 공간 및 실시간 사용자/개발자가 GRANT\_AND\_LOSE와 동일하지 않음

```text
   PendingI  Failed accounting interim                 Open
             answer received and realtime
             equal to GRANT_AND_LOSE

   PendingI  Failed accounting interim      Disconnect Idle
             answer received and realtime   user/dev
             not equal to GRANT_AND_LOSE

   PendingI  User service terminated        Store      PendingI
                                            stop
                                            record
   PendingE  Successful accounting                     Idle
             event answer received

   PendingE  Failure to send and buffer     Store      Idle
             space available                event
                                            record

   PendingE  Failure to send and no buffer             Idle
             space available

   PendingE  Failed accounting event answer            Idle
             received

   PendingB  Successful accounting answer   Delete     Idle
             received                       record

   PendingB  Failure to send                           Idle

   PendingB  Failed accounting answer       Delete     Idle
             received                       record

   PendingL  Successful accounting                     Idle
             stop answer received

   PendingL  Failure to send and buffer     Store      Idle
             space available                stop
                                            record

   PendingL  Failure to send and no buffer             Idle
             space available

   PendingL  Failed accounting stop answer             Idle
             received

                    SERVER, STATELESS ACCOUNTING
   State     Event                          Action     New State
   -------------------------------------------------------------

   Idle      Accounting start request       Send       Idle
             received, and successfully     accounting
             processed.                     start
                                            answer

   Idle      Accounting event request       Send       Idle
             received, and successfully     accounting
             processed.                     event
                                            answer

   Idle      Interim record received,       Send       Idle
             and successfully processed.    accounting
                                            interim
                                            answer

   Idle      Accounting stop request        Send       Idle
             received, and successfully     accounting
             processed                      stop answer

   Idle      Accounting request received,   Send       Idle
             no space left to store         accounting
             records                        answer,
                                            Result-Code
                                            = OUT_OF_
                                            SPACE

                         SERVER, STATEFUL ACCOUNTING
   State     Event                          Action     New State
   -------------------------------------------------------------

   Idle      Accounting start request       Send       Open
             received, and successfully     accounting
             processed.                     start
                                            answer,
                                            Start Ts

   Idle      Accounting event request       Send       Idle
             received, and successfully     accounting
             processed.                     event
                                            answer

   Idle      Accounting request received,   Send       Idle
             no space left to store         accounting
             records                        answer,
                                            Result-Code
                                            = OUT_OF_
                                            SPACE

   Open      Interim record received,       Send       Open
             and successfully processed.    accounting
                                            interim
                                            answer,
                                            Restart Ts

   Open      Accounting stop request        Send       Idle
             received, and successfully     accounting
             processed                      stop answer,
                                            Stop Ts

   Open      Accounting request received,   Send       Idle
             no space left to store         accounting
             records                        answer,
                                            Result-Code
                                            = OUT_OF_
                                            SPACE,
                                            Stop Ts

   Open      Session supervision timer Ts   Stop Ts    Idle
             expired
```

---
### **8.3.  Server-Initiated Re-Auth**

Diameter 서버는 RAR\(Re-Auth-Request\)을 발행하여 특정 세션에 대한 재인증 및/또는 재인증 서비스를 시작할 수 있습니다.

예를 들어 선불 서비스의 경우 원래 세션을 승인한 Diameter 서버는 사용자가 여전히 서비스를 사용하고 있는지 확인해야 할 수 있습니다.

현재 활성 세션과 동일한 Session-Id가 포함된 RAR 메시지를 수신하는 액세스 장치는 서비스가 이 특정 기능을 지원하는 경우 사용자에 대한 재인증을 시작해야 합니다. 각 Diameter 애플리케이션은 서비스 시작 재인증이 지원되는지 여부를 명시해야 합니다. 일부 애플리케이션은 액세스 장치가 사용자에게 재인증을 요청하는 것을 허용하지 않기 때문입니다.\(MUST, MUST\)

---
#### **8.3.1.  Re-Auth-Request**

RAR\(Re-Auth-Request\)은 258로 설정된 명령 코드와 메시지 플래그 'R' 비트 세트로 표시되며 모든 서버에서 세션 서비스를 제공하는 액세스 장치로 전송되어 다음을 요청할 수 있습니다. 사용자는 재인증 및/또는 재승인을 받아야 합니다.

```text
   Message Format

      <RAR>  ::= < Diameter Header: 258, REQ, PXY >
                 < Session-Id >
                 { Origin-Host }
                 { Origin-Realm }
                 { Destination-Realm }
                 { Destination-Host }
                 { Auth-Application-Id }
                 { Re-Auth-Request-Type }
                 [ User-Name ]
                 [ Origin-State-Id ]
               * [ Proxy-Info ]
               * [ Route-Record ]
               * [ AVP ]
```

---
#### **8.3.2.  Re-Auth-Answer**

258로 설정된 Command-Code와 메시지 플래그 'R' 비트 클리어로 표시되는 RAA\(Re-Auth-Answer\)가 RAR에 대한 응답으로 전송됩니다. 결과 코드 AVP가 있어야 하며 요청 처리를 나타냅니다.\(MUST\)

성공적인 RAA 메시지 뒤에는 애플리케이션별 인증 및/또는 권한 부여 메시지가 와야 합니다.\(MUST\)

```text
   Message Format

      <RAA>  ::= < Diameter Header: 258, PXY >
                 < Session-Id >
                 { Result-Code }
                 { Origin-Host }
                 { Origin-Realm }
                 [ User-Name ]
                 [ Origin-State-Id ]
                 [ Error-Message ]
                 [ Error-Reporting-Host ]
               * [ Failed-AVP ]
               * [ Redirect-Host ]
                 [ Redirect-Host-Usage ]
                 [ Redirect-Host-Cache-Time ]
               * [ Proxy-Info ]
               * [ AVP ]
```

---
### **8.4.  Session Termination**

상태를 유지하고 있는 세션에 권한을 부여한 Diameter 서버는 해당 세션이 더 이상 활성 상태가 아닐 때 알림을 받는 것이 필요합니다. 이는 추적 목적과 상태 저장 에이전트가 제공했을 수 있는 리소스를 해제할 수 있도록 허용하기 위한 것입니다. 사용자 세션의 경우. 상태가 유지되지 않는 세션의 경우 이 섹션은 사용되지 않습니다.

Diameter 인증이 필요한 사용자 세션이 종료되면 서비스를 제공한 액세스 장치는 서비스를 인증한 Diameter 서버에 세션 종료 요청\(STR\) 메시지를 발행하여 세션이 더 이상 활성 상태가 아님을 알려야 합니다. 사용자 로그오프, Session-Timeout 만료, 관리 조치, Abort-Session-Request 수신 시 종료\(아래 참조\), 액세스 장치의 순차적 종료 등을 포함하여 어떤 이유로든 사용자 세션이 종료되면 STR을 발행해야 합니다. .\(MUST, MUST\)

또한 액세스 장치는 승인되었지만 실제로 시작되지 않은 세션에 대해 STR을 발행해야 합니다. 이는 예를 들어 액세스 장치의 갑작스러운 자원 부족으로 인해 또는 액세스 장치가 인증에서 요청된 서비스 유형을 제공할 의사가 없거나 액세스 장치가 인증에서 반환된 필수 AVP를 지원하지 않기 때문에 발생할 수 있습니다. 허가 등\(MUST\)

승인된 세션이 프록시 작업으로 인해 실제로 시작되지 않을 수도 있습니다. 예를 들어, 프록시는 메시지를 액세스 장치에 전달하기 전에 인증 응답을 수정하여 결과를 성공에서 실패로 변환할 수 있습니다. 답변에 값이 있는 Auth-Session-State AVP가 포함되지 않은 경우

NO\_STATE\_MAINTAINED, 승인된 세션이 시작되지 않도록 하는 프록시는 세션을 승인한 Diameter 서버에 STR을 발행해야 합니다. 액세스 장치는 세션이 승인되었는지 알 수 있는 방법이 없기 때문입니다.\(MUST\)

STR 메시지를 수신한 Diameter 서버는 STR에 지정된 Session-Id와 관련된 리소스\(예: 세션 상태\)를 정리하고 Session-Termination-Answer를 반환해야 합니다.\(MUST\)

Diameter 서버는 또한 Session-Timeout이 만료되거나 Authorization-Lifetime 및 Auth-Grace-Period AVP가 재인증 요청을 받지 않고 만료될 때 해당 세션에 대한 STR이 수신되는지 여부에 관계없이 리소스를 정리해야 합니다. 액세스 장치는 이러한 타이머 만료 이후에는 서비스를 제공하지 않을 것으로 예상됩니다. 따라서 이러한 타이머 중 하나가 만료되면 액세스 장치가 예기치 않게 종료되었을 수 있음을 의미합니다.\(MUST\)

---
#### **8.4.1.  Session-Termination-Request**

Command-Code가 275로 설정되고 Command Flag의 'R' 비트가 설정된 STR\(Session-Termination-Request\)은 인증된 및/또는 승인된 세션이 있음을 Diameter 서버에 알리기 위해 액세스 장치에 의해 전송됩니다. 종료되고 있습니다.

```text
   Message Format

      <STR> ::= < Diameter Header: 275, REQ, PXY >
                < Session-Id >
                { Origin-Host }
                { Origin-Realm }
                { Destination-Realm }
                { Auth-Application-Id }
                { Termination-Cause }
                [ User-Name ]
                [ Destination-Host ]
              * [ Class ]
                [ Origin-State-Id ]
              * [ Proxy-Info ]
              * [ Route-Record ]
              * [ AVP ]
```

---
#### **8.4.2.  Session-Termination-Answer**

Command-Code가 275로 설정되고 메시지 플래그 'R' 비트가 클리어된 STA\(Session-Termination-Answer\)는 세션이 종료되었다는 알림을 확인하기 위해 Diameter 서버에 의해 전송됩니다. 결과 코드 AVP는 반드시 존재해야 하며 STR을 서비스하는 동안 오류가 발생했다는 표시를 포함할 수 있습니다.\(MUST\)

STA를 보내거나 수신하면 Diameter 서버는 Session-Id AVP가 나타내는 세션에 대한 모든 리소스를 해제해야 합니다. 필요한 경우 프록시 체인의 모든 중간 서버도 리소스를 해제할 수 있습니다.\(MUST, MAY\)

```text
   Message Format

      <STA>  ::= < Diameter Header: 275, PXY >
                 < Session-Id >
                 { Result-Code }
                 { Origin-Host }
                 { Origin-Realm }
                 [ User-Name ]
               * [ Class ]
                 [ Error-Message ]
                 [ Error-Reporting-Host ]
               * [ Failed-AVP ]
                 [ Origin-State-Id ]
               * [ Redirect-Host ]
                 [ Redirect-Host-Usage ]
                                    ^
                 [ Redirect-Max-Cache-Time ]
               * [ Proxy-Info ]
               * [ AVP ]
```

---
### **8.5.  Aborting a Session**

Diameter 서버는 ASR\(Abort-Session-Request\)을 발행하여 액세스 장치가 특정 세션에 대한 서비스 제공을 중지하도록 요청할 수 있습니다.

예를 들어 원래 세션을 승인한 Diameter 서버는 신용이나 세션이 처음 승인되었을 때 예상하지 못한 다른 이유로 인해 해당 세션이 중지되도록 해야 할 수도 있습니다. 반면, 운영자는 네트워크에서 사용자를 관리적으로 제거하기 위해 ASR을 발행할 목적으로 관리 서버를 유지할 수 있습니다.

현재 활성 세션과 동일한 Session-ID를 가진 ASR을 수신하는 액세스 장치는 세션을 중지할 수 있습니다. 접근 여부\(MAY\)

장치가 세션을 중지하는지 여부는 구현 및/또는 구성에 따라 다릅니다. 예를 들어, 액세스 장치는 특정 에이전트의 ASR만 존중할 수 있습니다. 어떤 경우든 액세스 장치는 취한 조치를 나타내는 결과 코드 AVP를 포함하여 Abort-Session-Answer로 응답해야 합니다.\(MUST\)

액세스 장치가 ASR 수신 시 세션을 중지하는 경우 다른 이유로 세션이 종료된 경우와 마찬가지로 승인 서버\(ASR을 발행하는 에이전트일 수도 있고 아닐 수도 있음\)에 STR을 발행합니다. .

---
#### **8.5.1.  Abort-Session-Request**

ASR\(Abort-Session-Request\)은 274로 설정된 Command-Code와 메시지 플래그 'R' 비트 세트로 표시되며 임의의 서버에서 세션 서비스를 제공하는 액세스 장치로 전송될 수 있습니다. Session-Id로 식별된 세션이 중지됩니다.

```text
   Message Format

      <ASR>  ::= < Diameter Header: 274, REQ, PXY >
                 < Session-Id >
                 { Origin-Host }
                 { Origin-Realm }
                 { Destination-Realm }
                 { Destination-Host }
                 { Auth-Application-Id }
                 [ User-Name ]
                 [ Origin-State-Id ]
               * [ Proxy-Info ]
               * [ Route-Record ]
               * [ AVP ]
```

---
#### **8.5.2.  Abort-Session-Answer**

ASA\(Abort-Session-Answer\)는 274로 설정된 Command-Code와 메시지 플래그 'R' 비트 클리어로 표시되며 ASR에 대한 응답으로 전송됩니다. 결과 코드 AVP가 있어야 하며 요청 처리를 나타냅니다.\(MUST\)

ASR에서 Session-Id로 식별된 세션이 성공적으로 종료된 경우 Result-Code는 DIAMETER\_SUCCESS로 설정됩니다. 세션이 현재 활성화되어 있지 않으면 결과 코드가 DIAMETER\_UNKNOWN\_SESSION\_ID로 설정됩니다. 액세스 장치가 다른 이유로 세션을 중지하지 않는 경우 Result-Code는 DIAMETER\_UNABLE\_TO\_COMPLY로 설정됩니다.

```text
   Message Format

      <ASA>  ::= < Diameter Header: 274, PXY >
                 < Session-Id >
                 { Result-Code }
                 { Origin-Host }
                 { Origin-Realm }
                 [ User-Name ]
                 [ Origin-State-Id ]
                 [ Error-Message ]
                 [ Error-Reporting-Host ]
               * [ Failed-AVP ]
               * [ Redirect-Host ]
                 [ Redirect-Host-Usage ]
                 [ Redirect-Max-Cache-Time ]
               * [ Proxy-Info ]
               * [ AVP ]
```

---
### **8.6.  Inferring Session Termination from Origin-State-Id**

Origin-State-Id는 예기치 않은 액세스 장치 종료로 인해 STR이 발행되지 않은 종료된 세션을 신속하게 감지하는 데 사용됩니다.

CER/CEA 메시지에 Origin-State-Id를 포함함으로써 액세스 장치는 다음 홉 서버가 연결 시 마지막 연결 이후 장치의 세션이 손실되었는지 여부를 즉시 확인할 수 있습니다.

요청 메시지에 Origin-State-Id를 포함함으로써 액세스 장치는 프록시를 통해 통신하는 서버가 그러한 결정을 내릴 수 있도록 허용합니다. 그러나 액세스 장치와 직접 연결되지 않은 서버는 액세스 장치로부터 새로운 요청을 수신하지 않는 한 액세스 장치가 다시 시작되었음을 발견하지 못합니다. 따라서 프록시 전반에 걸쳐 이 메커니즘을 사용하는 것은 신뢰성보다는 기회주의적이지만 그럼에도 불구하고 유용합니다.

Diameter 서버가 이전에 동일한 발급자로부터 받은 Origin-State-Id보다 큰 Origin-State-Id를 수신하면 발급자가 이전 메시지 이후 상태를 잃었고 해당 메시지에서 활성화된 모든 세션이 있다고 가정할 수 있습니다. 하위 Origin-State- ID가 종료되었습니다. Diameter 서버는 손실된 세션과 관련된 모든 세션 상태를 정리할 수 있으며, 세션 상태가 전체적으로 정리될 수 있도록 업스트림 서버에서 승인된 모든 손실된 세션에 대해 STR을 발행할 수도 있습니다.\(MAY\)

---
### **8.7.  Auth-Request-Type AVP**

Auth-Request-Type AVP\(AVP Code 274\)는 Enumerated 유형이며 애플리케이션별 인증 요청에 포함되어 사용자가 인증만 받을지, 승인만 받을지 또는 둘 다를 받을지 여부를 피어에게 알립니다. 두 가지 이외의 값을 사용하면 RADIUS 상호 운용성 문제가 발생할 수 있습니다. 다음 값이 정의됩니다.\(MAY\)

인증\_만 1

- 전송되는 요청은 인증만을 위한 것이며 사용자를 인증하기 위해 Diameter 서버에 필요한 관련 애플리케이션별 인증 AVP를 포함해야 합니다.\(MUST\)

AUTHORIZE\_ONLY 2

- 전송되는 요청은 승인만을 위한 것이며 요청/제안되는 서비스를 식별하는 데 필요한 애플리케이션별 승인 AVP를 포함해야 합니다.\(MUST\)

승인\_인증 3

- 요청에는 인증 및 승인에 대한 요청이 모두 포함됩니다. 요청에는 관련 애플리케이션별 인증 정보와 요청/제안되는 서비스를 식별하는 데 필요한 인증 정보가 모두 포함되어야 합니다.\(MUST\)

---
### **8.8.  Session-Id AVP**

Session-Id AVP\(AVP 코드 263\)는 UTF8String 유형이며 특정 세션을 식별하는 데 사용됩니다\(섹션 8 참조\). 특정 세션과 관련된 모든 메시지는 하나의 Session-Id AVP만 포함해야 하며 세션 수명 동안 동일한 값을 사용해야 합니다. 존재하는 경우 Session-Id는 Diameter 헤더 바로 뒤에 나타나야 합니다\(섹션 3 참조\).\(MUST, SHOULD\)

Session-Id는 다른 정보를 참조하지 않고 사용자 세션을 고유하게 식별하고 기록 인증 정보를 계정 정보와 연관시키는 데 필요할 수 있으므로 전역적으로 영원히 고유해야 합니다. Session-Id에는 필수 부분과 구현 정의 부분이 포함됩니다. 구현 정의 부분에 권장되는 형식은 아래에 설명되어 있습니다.\(MUST\)

Session-Id는 DiameterIdentity 유형으로 인코딩된 발신자의 ID로 시작해야 합니다\(섹션 4.4 참조\). Session-Id의 나머지 부분은 ";"으로 구분됩니다. 문자이며 클라이언트가 영원히 고유함을 보장할 수 있는 모든 시퀀스일 수 있습니다. 그러나 다음 형식이 권장됩니다. \(대괄호 \[\]는 선택적 요소를 나타냅니다\):\(MUST, MAY\)

```text
   <DiameterIdentity>;<high 32 bits>;<low 32 bits>[;<optional value>]
```

<상위 32비트\> 및 <하위 32비트\>는 단조 증가하는 64비트 값의 상위 및 하위 32비트를 10진수로 표현한 것입니다. 64비트 값은 32비트 프로세서의 형식 지정을 단순화하기 위해 두 부분으로 렌더링됩니다. 시작 시 64비트 값의 상위 32비트는 시간으로 초기화될 수 있으며 하위 32비트는 0으로 초기화될 수 있습니다. 이는 실제적인 목적을 위해 재부팅 프로세스가 1초 이상 걸린다는 가정 하에 재부팅 후 세션 ID가 겹칠 가능성을 제거합니다. 대안으로, 구현은 비휘발성 메모리에서 증가하는 값을 추적할 수 있습니다.\(MAY, MAY\)

<선택적 값\>은 구현에 따라 다르지만 모뎀의 장치 ID, 계층 2 주소, 타임스탬프 등이 포함될 수 있습니다.

선택적 값이 없는 예:

- accesspoint7.acme.com;1876543210;523

선택적 값이 있는 예:

- accesspoint7.acme.com;1876543210;523;mobile@200.1.1.88

Session-Id는 세션을 시작하는 Diameter 애플리케이션에 의해 생성되며, 대부분의 경우 클라이언트에 의해 수행됩니다. Session-Id는 특정 애플리케이션의 인증 및 계정 명령 모두에 사용될 수 있습니다.\(MAY\)

---
### **8.9.  Authorization-Lifetime AVP**

Authorization-Lifetime AVP\(AVP 코드 291\)는 Unsigned32 유형이며 사용자가 재인증 및/또는 재승인되기 전에 사용자에게 제공되는 서비스의 최대 시간\(초\)을 포함합니다. Authorization-Lifetime 값을 결정할 때는 세심한 주의가 필요합니다. 0이 아닌 낮은 값은 네트워크와 에이전트 모두를 정체시킬 수 있는 상당한 Diameter 트래픽을 생성할 수 있기 때문입니다.

0 값은 액세스 장치에서 즉시 재인증이 필요함을 의미합니다. 이는 일반적으로 여러 인증 방법이 사용되는 경우에 사용되며, 이 AVP가 0으로 설정된 성공적인 인증 응답은 다음 인증 방법이 즉시 시작된다는 신호를 보내는 데 사용됩니다. 이 AVP가 없거나 값이 모두 1인 경우\(32비트 필드의 모든 비트가 1로 설정됨을 의미\) 재인증이 예상되지 않습니다.

이 AVP와 Session-Timeout AVP가 모두 메시지에 있는 경우 후자의 값은 Authorization-Lifetime AVP보다 작아서는 안 됩니다.\(MUST NOT\)

Authorization-Lifetime AVP는 재인증 메시지에 존재할 수 있으며, 재인증 응답 메시지가 액세스 장치에 의해 수신된 시간부터 사용자가 서비스를 받을 수 있도록 인증된 시간\(초\)을 포함합니다.\(MAY\)

이 AVP는 클라이언트가 수용할 최대 수명에 대한 힌트로 클라이언트에 의해 제공될 수 있습니다. 그러나 서버는 클라이언트가 제공한 값과 같거나 작은 값을 반환할 수 있습니다.\(MAY, MAY\)

---
### **8.10.  Auth-Grace-Period AVP**

Auth-Grace-Period AVP\(AVP 코드 276\)는 Unsigned32 유형이며 Authorization-Lifetime AVP가 만료된 후 세션의 리소스를 정리하기 전에 Diameter 서버가 대기하는 시간\(초\)을 포함합니다.

---
### **8.11.  Auth-Session-State AVP**

Auth-Session-State AVP\(AVP 코드 277\)는 열거형 유형이며 특정 세션에 대해 상태가 유지되는지 여부를 지정합니다. 클라이언트는 서버에 대한 힌트로 요청에 이 AVP를 포함할 수 있지만 서버 응답 메시지의 값은 바인딩됩니다. 다음 값이 지원됩니다.\(MAY\)

상태\_유지됨 0

- 이 값은 세션 상태가 유지되고 있음을 지정하는 데 사용되며, 액세스 장치는 사용자에 대한 서비스가 종료될 때 세션 종료 메시지를 발행해야 합니다. 이것이 기본값입니다.\(MUST\)

NO\_STATE\_MAINTAINED 1

- 이 값은 Authorization-Lifetime이 만료되면 액세스 장치에서 세션 종료 메시지를 보내지 않도록 지정하는 데 사용됩니다.

---
### **8.12.  Re-Auth-Request-Type AVP**

Re-Auth-Request-Type AVP\(AVP Code 285\)는 Enumerated 유형이며 Authorization-Lifetime 만료 시 예상되는 작업을 클라이언트에 알리기 위해 애플리케이션별 인증 응답에 포함됩니다. 응답 메시지에 양수 값의 Authorization-Lifetime AVP가 포함되어 있는 경우 Re-Auth-Request-Type AVP가 응답 메시지에 있어야 합니다. 다음 값이 정의됩니다.\(MUST\)

AUTHORIZE\_ONLY 0

- Authorization-Lifetime이 만료되면 승인 전용 재인증이 예상됩니다. Authorization-Lifetime을 포함하는 응답 메시지에 AVP가 없는 경우 이는 기본값입니다.

승인\_인증 1

- Authorization-Lifetime이 만료되면 인증 및 권한 재인증이 예상됩니다.

---
### **8.13.  Session-Timeout AVP**

Session-Timeout AVP\(AVP Code 27\)\[RADIUS\]는 Unsigned32 유형이며 세션이 종료되기 전에 사용자에게 제공되는 최대 서비스 시간\(초\)을 포함합니다. Session-Timeout과 Authorization-Lifetime AVP가 모두 응답 메시지에 존재할 때 전자는 후자의 값보다 크거나 같아야 합니다.\(MUST\)

Session-Timeout 만료로 인해 액세스 장치에서 종료되는 세션은 액세스 장치와 홈 서버 모두 이전에 세션 종료 메시지가 전송되지 않을 것에 동의하지 않는 한 STR이 발행되어야 합니다\(섹션 8.9 참조\). .\(MUST\)

Session-Timeout AVP는 재인증 응답 메시지에 존재할 수 있으며 재인증 시작부터 남은 시간\(초\)을 포함합니다.\(MAY\)

값이 0이거나 이 AVP가 없으면 이 세션이 종료되기까지 무제한의 시간\(초\)이 있음을 의미합니다.

이 AVP는 클라이언트가 허용할 최대 시간 초과에 대한 힌트로 클라이언트에 의해 제공될 수 있습니다. 그러나 서버는 클라이언트가 제공한 값과 같거나 작은 값을 반환할 수 있습니다.\(MAY, MAY\)

---
### **8.14.  User-Name AVP**

사용자 이름 AVP\(AVP 코드 1\)\[RADIUS\]는 NAI 사양\[NAI\]과 일치하는 형식으로 사용자 이름을 포함하는 UTF8String 유형입니다.

---
### **8.15.  Termination-Cause AVP**

종료 원인 AVP\(AVP Code 295\)는 열거형 유형이며 액세스 장치에서 세션이 종료된 이유를 나타내는 데 사용됩니다. 다음 값이 정의됩니다.

```text
   DIAMETER_LOGOUT                   1
      The user initiated a disconnect
```

DIAMETER\_SERVICE\_NOT\_PROVIDED 2

- 인증 응답 메시지를 수신하기 전에 사용자가 연결을 끊은 경우에 사용되는 값입니다.

DIAMETER\_BAD\_ANSWER 3

- 이 값은 접근장치가 수신한 인증 응답이 성공적으로 처리되지 않았음을 나타냅니다.

DIAMETER\_ADMINISTRATIVE 4

- Abort-Session-Request 메시지 수신 등의 관리상의 이유로 사용자의 접속이 허용되지 않거나 연결이 끊어졌습니다.

DIAMETER\_LINK\_BROKEN 5

- 사용자와의 통신이 갑자기 끊어졌습니다.

DIAMETER\_AUTH\_EXPIRED 6

- 승인된 세션 시간이 만료되어 해당 사용자의 접속이 종료되었습니다.

DIAMETER\_USER\_MOVED 7

- 이용자가 다른 접속기기로부터 서비스를 받고 있는 경우

DIAMETER\_SESSION\_TIMEOUT 8

- 해당 사용자의 세션 시간이 초과되어 서비스가 종료되었습니다.

---
### **8.16.  Origin-State-Id AVP**

Unsigned32 유형의 Origin-State-Id AVP\(AVP 코드 278\)는 예를 들어 재부팅 시와 같이 Diameter 엔터티가 이전 상태를 잃어 다시 시작될 때마다 증가하는 단조롭게 증가하는 값입니다. Origin-State-Id는 CER을 포함한 모든 Diameter 메시지에 포함될 수 있습니다.\(MAY\)

이 AVP를 발행하는 Diameter 엔터티는 상태가 재설정될 때마다 이 AVP에 대해 더 높은 값을 생성해야 합니다. Diameter 엔터티는 Origin-State-Id를 시작 시간으로 설정할 수도 있고, 재시작 시 비휘발성 메모리에 유지되는 증분 카운터를 사용할 수도 있습니다.\(MUST, MAY\)

Origin-State-Id가 있는 경우 Origin-Host가 나타내는 엔터티의 상태를 반영해야 합니다. 프록시가 Origin-Host를 수정하는 경우 Origin-State-Id를 제거하거나 적절하게 수정해야 합니다.\(MUST, MUST\)

일반적으로 Origin-State-Id는 항상 활성 세션 없이 시작되는 액세스 장치에서 사용됩니다. 즉, 다시 시작하기 전에 활성화된 모든 세션이 손실됩니다. 메시지에 Origin-State-Id를 포함함으로써 다른 Diameter 엔터티가 더 낮은 Origin-State-Id와 관련된 세션이 더 이상 활성화되어 있지 않다고 추론할 수 있습니다. 액세스 장치가 그러한 추론을 할 의도가 없다면 메시지에 Origin-State-Id를 포함하지 않거나 해당 값을 0으로 설정해야 합니다.\(MUST\)

---
### **8.17.  Session-Binding AVP**

세션 바인딩 AVP\(AVP 코드 270\)는 Unsigned32 유형이며 애플리케이션별 인증 응답 메시지에 존재할 수 있습니다. 존재하는 경우, 이 AVP는 이 세션에 대한 향후 모든 애플리케이션별 재인증 메시지가 동일한 인증 서버로 전송되어야 함을 Diameter 클라이언트에게 알릴 수 있습니다. 이 AVP는 또한 이 세션에 대한 Session-Termination-Request 메시지가 동일한 인증 서버로 전송되어야 함을 지정할 수도 있습니다.\(MAY, MUST, MUST\)

이 필드는 비트 마스크이며 다음 비트가 정의되었습니다.

RE\_AUTH 1

- 설정된 경우 이 세션에 대한 향후 재인증 메시지는 대상 호스트 AVP를 포함해서는 안 됩니다. 지워지면 기본값인 대상 호스트 AVP가 이 세션에 대한 모든 재인증 메시지에 있어야 합니다.\(MUST NOT, MUST\)

STR 2

- 설정된 경우 이 세션에 대한 STR 메시지는 대상 호스트 AVP를 포함해서는 안 됩니다. 지워지면 기본값인 Destination-Host AVP가 이 세션에 대한 STR 메시지에 있어야 합니다.\(MUST NOT, MUST\)

회계 4

- 설정된 경우 이 세션에 대한 모든 계정 메시지는 대상 호스트 AVP를 포함해서는 안 됩니다. 지워지면 기본값인 대상 호스트 AVP\(알고 있는 경우\)가 이 세션에 대한 모든 계정 메시지에 존재해야 합니다.\(MUST NOT, MUST\)

---
### **8.18.  Session-Server-Failover AVP**

세션 서버 장애 조치 AVP\(AVP 코드 271\)는 열거형 유형이며 세션 바인딩 AVP를 포함하지 않거나 비트와 함께 세션 바인딩 AVP를 포함하는 애플리케이션별 인증 응답 메시지에 존재할 수 있습니다. 0 값으로 설정합니다. 존재하는 경우, 이 AVP는 Diameter 클라이언트에게 다음을 알릴 수 있습니다.\(MAY, MAY\)

재인증 또는 STR 메시지가 전달 문제로 인해 실패하면 Diameter 클라이언트는 Destination-Host AVP 없이 후속 메시지를 발행해야 합니다. 없는 경우 기본값은 REFUSE\_SERVICE입니다.\(SHOULD\)

다음 값이 지원됩니다.

REFUSE\_SERVICE 0

- 재인증 또는 STR 메시지 전달에 실패한 경우 해당 사용자와 서비스를 종료하고 후속 시도를 시도하지 않습니다.

TRY\_AGAIN 1

- 재인증 또는 STR 메시지 전달이 실패하면 대상 호스트 AVP 없이 실패한 메시지를 다시 보냅니다.

ALLOW\_SERVICE 2

- 재인증 메시지 전달에 실패할 경우, 재인증이 성공한 것으로 가정합니다. STR 메시지 전달에 실패하면 세션을 종료합니다.

TRY\_AGAIN\_ALLOW\_SERVICE 3

- 재인증 또는 STR 메시지 전달이 실패하면 대상 호스트 AVP 없이 실패한 메시지를 다시 보냅니다. 두 번째 전달이 재인증에 실패하면 재인증이 성공했다고 가정합니다. STR에 대한 두 번째 전달이 실패하면 세션을 종료합니다.

---
### **8.19.  Multi-Round-Time-Out AVP**

Multi-Round-Time-Out AVP\(AVP 코드 272\)는 Unsigned32 유형이며 결과 코드 AVP가 DIAMETER\_MULTI\_ROUND\_AUTH로 설정된 애플리케이션별 인증 응답 메시지에 있어야 합니다. 이 AVP에는 액세스 장치가 인증 요청에 응답할 때 사용자에게 제공해야 하는 최대 시간\(초\)이 포함되어 있습니다.\(SHOULD, MUST\)

---
### **8.20.  Class AVP**

클래스 AVP\(AVP 코드 25\)는 OctetString 유형이며 Diameter 서버에서 액세스 장치에 상태 정보를 반환하는 데 사용됩니다. 하나 이상의 클래스 AVP가 애플리케이션별 인증 응답 메시지에 존재할 때 후속 재인증, 세션 종료 및 계정 메시지에 존재해야 합니다. 재인증 응답 메시지에서 발견된 클래스 AVP는 이전 인증 응답 메시지에서 발견된 클래스 AVP보다 우선합니다. Diameter 서버 구현은 Diameter 클라이언트에 4096바이트 이상의 저장 공간이 필요한 클래스 AVP를 반환해서는 안 됩니다. 크기가 로컬에서 사용 가능한 스토리지를 초과하는 클래스 AVP를 수신하는 Diameter 클라이언트는 세션을 종료해야 합니다.\(MUST, SHOULD NOT, MUST\)

---
### **8.21.  Event-Timestamp AVP**

이벤트 타임스탬프\(AVP 코드 55\)는 시간 유형이며 보고된 이벤트가 발생한 시간을 1900년 1월 1일 00:00 UTC 이후 초 단위로 기록하기 위해 계정 요청 및 계정 응답 메시지에 포함될 수 있습니다.\(MAY\)

---
## **9.  Accounting**

이 회계 프로토콜은 회계 정보의 실시간 전달 기능을 갖춘 서버 지향 모델을 기반으로 합니다. 다양한 오류 상황과 사용된 장치의 기능에 대한 다양한 가정 하에서 계정 데이터의 손실을 최소화하기 위해 여러 가지 오류 복원 방법\[ACCMGMT\]이 프로토콜에 내장되어 있습니다.

---
### **9.1.  Server Directed Model**

서버 지향 모델은 계정 데이터를 생성하는 장치가 인증 서버\(연결된 경우\) 또는 계정 데이터가 전달되는 방식에 관한 계정 서버로부터 정보를 얻는다는 것을 의미합니다. 이 정보에는 회계 기록 적시성 요구 사항이 포함됩니다.

\[ACCMGMT\]에서 논의한 바와 같이 신용한도 확인, 사기 적발 등 회계기록의 실시간 이관이 요구된다. 일괄 계산은 필수 사항이 아니므로 Diameter에서는 지원되지 않습니다. 나중에 일괄 처리 회계가 필요한 경우 새로운 Diameter 애플리케이션을 생성해야 하거나 다른 프로토콜을 사용하여 처리할 수 있습니다. 그러나 Diameter 계층에서 계정 요청이 하나씩 처리되더라도 Diameter에서 사용되는 전송 프로토콜은 일반적으로 트래픽이 많은 상황에서 동일한 패킷에 여러 요청을 일괄 처리합니다. 이는 많은 애플리케이션에 충분할 수 있습니다.

인증 서버\(체인\)는 사용자에 대한 지식과 로밍 파트너십 관계를 기반으로 적절한 전송 전략의 선택을 지시합니다. 서버\(또는 에이전트\)는 클라이언트로 작동하는 Diameter 피어의 작동을 제어하기 위해 Acct-Interim-Interval 및 Accounting-Realtime-Required AVP를 사용합니다. Acct-Interim-Interval AVP가 있는 경우 클라이언트 역할을 하는 Diameter 노드에 세션 중에도 지속적으로 회계 레코드를 생성하도록 지시합니다. Accounting-Realtime-Required AVP는 Diameter 클라이언트로부터의 회계 기록 전송이 지연되거나 실패할 때 클라이언트의 동작을 제어하는 ​​데 사용됩니다.

Diameter 회계 서버는 Accounting-Answer 메시지에 Acct-Interim-Interval 또는 Accounting-Realtime-Required AVP를 포함하여 중간 간격이나 실시간 요구 사항을 무시할 수 있습니다. 이러한 AVP 중 하나가 있는 경우 수신된 최신 값은 동일한 세션에 대한 추가 회계 활동에 사용해야 합니다.\(MAY, SHOULD\)

---
### **9.2.  Protocol Messages**

홈 AAA 서버로부터 성공적인 인증 및/또는 권한 부여 메시지를 수신한 Diameter 노드는 세션에 대한 계정 정보를 수집해야 합니다. Accounting-Request 메시지는 홈 AAA 서버에 계정 정보를 전송하는 데 사용되며, 홈 AAA 서버는 수신 확인을 위해 Accounting-Answer 메시지로 응답해야 합니다. 회계-응답 메시지에는 회계 메시지에 오류가 있음을 나타낼 수 있는 결과 코드 AVP가 포함됩니다. 거부된 Accounting-Request 메시지는 문제의 세션에 대해 이전에 수신된 Accounting-Realtime-Required AVP 값에 따라 사용자 세션이 종료되도록 할 수 있습니다.\(MUST, MUST, MAY, MAY\)

각 Diameter Accounting 프로토콜 메시지는 네트워크 대역폭 사용량을 줄이기 위해 압축될 수 있습니다. IPsec 및 IKE가 Diameter 세션을 보호하는 데 사용되는 경우 IP 압축 \[IPComp\]을 사용할 수 있으며 IKE \[IKE\]를 사용하여 압축 매개변수를 협상할 수 있습니다. Diameter 세션을 보호하기 위해 TLS가 사용되는 경우 TLS 압축 \[TLS\]을 사용할 수 있습니다.\(MAY, MAY, MAY\)

---
### **9.3.  Application document requirements**

각 Diameter 애플리케이션\(예: NASREQ, MobileIP\)은 "Accounting AVP" 섹션의 Accounting-Request 메시지에 있어야 하는 서비스별 AVP를 정의해야 합니다. 애플리케이션은 이 문서에 설명된 AVP가 모든 계정 메시지에 존재할 것이라고 가정해야 하므로 이 섹션에서는 해당 서비스별 AVP만 정의하면 됩니다.\(MUST, MUST\)

---
### **9.4.  Fault Resilience**

Diameter Base 프로토콜 메커니즘은 작은 메시지 손실과 일시적인 네트워크 오류를 극복하는 데 사용됩니다.

클라이언트 역할을 하는 Diameter 피어는 서버 오류 및 특정 네트워크 오류로부터 보호하기 위해 장애 조치 사용을 구현해야 합니다. 에이전트 역할을 하는 다이어미터 피어 또는 관련 오프라인 처리 시스템은 동일한 레코드를 여러 서버로 전송하고 메시지가 중복되어 발생하는 계정 레코드의 중복을 반드시 탐지해야 합니다.\(MUST, MUST\)

운송 중. 이 탐지는 Session-Id 및 Accounting-Record-Number AVP 쌍의 검사를 기반으로 해야 합니다. 부록 C에서는 중복 감지 요구 사항과 구현 문제에 대해 설명합니다.\(MUST\)

Diameter 클라이언트는 재부팅이나 확장된 네트워크 장애, 네트워크 파티션 및 서버 장애 시 회계 기록을 안전하게 저장하기 위한 비휘발성 메모리를 가질 수 있습니다. 그러한 메모리가 사용 가능하다면, 클라이언트는 레코드가 생성되자마자 그리고 Diameter 서버로부터 수신에 대한 긍정적인 승인이 수신될 때까지 그곳에 새로운 계정 레코드를 저장해야 합니다. 재부팅 시 클라이언트는 종료 원인, 세션 길이 및 레코드의 기타 관련 정보를 적절하게 수정하여 비휘발성 메모리의 레코드를 계정 서버로 보내기 시작해야 합니다.\(MAY, SHOULD, MUST\)

이 프로토콜의 추가 응용에는 비휘발성 메모리에 커밋하거나 Diameter 서버로 전송하지 않고 Diameter 클라이언트에 최대 몇 개의 회계 기록을 저장할 수 있는지 제어하는 ​​AVP가 포함될 수 있습니다.

클라이언트는 올바른 Accounting-Answer가 수신되기 전에 메모리 영역에서 회계 데이터를 제거해서는 안 됩니다. 클라이언트는 메모리와 같은 리소스가 부족할 경우 가장 오래되었거나 전달되지 않았거나 아직 확인되지 않은 회계 데이터를 제거할 수 있습니다. 이 조건에서 클라이언트가 새 세션을 수락하는 것은 구현에 따른 문제입니다.\(SHOULD NOT, MAY\)

---
### **9.5.  Accounting Records**

모든 회계 기록에는 Session-Id AVP가 있어야 합니다. 사용자 이름 AVP는 Diameter 클라이언트에서 사용 가능한 경우 반드시 있어야 합니다. 에이전트 전반에 걸쳐 강력한 인증이 필요한 경우 인증 목적으로 종단 간 보안을 사용할 수 있습니다.\(MUST\)

실제 회계 서비스 유형과 중간 회계에 대한 권한 부여 서버의 지시에 따라 다양한 유형의 회계 기록이 전송됩니다. 계정 서비스가 일회성 이벤트인 경우, 즉 이벤트의 시작과 중지가 동시에 이루어지면 계정 기록 유형 AVP가 존재해야 하며 EVENT\_RECORD 값으로 설정되어야 합니다.\(MUST\)

계정 서비스가 측정 가능한 길이인 경우 AVP는 START\_RECORD, STOP\_RECORD 및 가능하면 INTERIM\_RECORD 값을 사용해야 합니다. 권한 부여 서버가 세션에 대해 임시 계정을 활성화하도록 지시하지 않은 경우 세션 유형의 각 서비스에 대해 두 개의 계정 레코드를 생성해야 합니다. 초기\(MUST, MUST\)

특정 세션에 대한 Accounting-Request가 전송되면 Accounting-Record-Type AVP는 START\_RECORD 값으로 설정되어야 합니다. 마지막 Accounting-Request가 전송되면 값은 STOP\_RECORD여야 합니다.\(MUST, MUST\)

인증 서버가 중간 계정을 활성화하도록 지시한 경우 Diameter 클라이언트는 START\_RECORD와 STOP\_RECORD 사이에 INTERIM\_RECORD로 표시된 추가 레코드를 생성해야 합니다. 이러한 레코드의 생성은 Acct-Interim-Interval과 세션의 재인증 또는 재승인에 의해 지시됩니다. Diameter 클라이언트는 동일한 세션에 대해 새 레코드가 생성되는 경우 전달을 위해 로컬에 저장된 이전 임시 계정 레코드를 덮어써야 합니다. 이렇게 하면 특정 세션에 대해 액세스 장치에 보류 중인 임시 레코드가 하나만 존재할 수 있습니다.\(MUST, MUST\)

Accounting-Sub-Session-Id의 특정 값은 재전송 목적을 제외하고 DIAMETER 클라이언트의 하나의 회계 레코드 시퀀스에만 나타나야 합니다. 전송되는 하나의 시퀀스는 EVENT\_RECORD 값으로 설정된 Accounting-Record-Type AVP가 있는 하나의 레코드이거나, 값이 START\_RECORD인 레코드로 시작하고 그 뒤에 0개 이상의 INTERIM\_RECORD와 단일 STOP\_RECORD가 따라오는 여러 레코드여야 합니다. 특정 Diameter 애플리케이션 사양은 반드시 사용해야 하는 시퀀스 유형을 정의해야 합니다.\(MUST, MUST, MUST\)

---
### **9.6.  Correlation of Accounting Records**

전역적으로 고유한\(8.8절 참조\) Diameter 프로토콜의 Session-Id AVP는 인증 단계에서 특정 세션을 식별하는 데 사용됩니다. 인증이 필요하지 않은 서비스는 여전히 Session-Id AVP를 사용하여 세션을 식별합니다. 계정 메시지는 인증 메시지에서 전송된 것과 다른 Session-Id를 사용할 수 있습니다. 특정 애플리케이션에는 계정 메시지에 대해 다른 세션 ID가 필요할 수 있습니다.\(MAY, MAY\)

그러나 여러 회계 하위 세션이 필요한 특정 애플리케이션이 있습니다. 이러한 애플리케이션은 일정한 Session-Id AVP를 사용하여 메시지를 보내지만 Accounting-Sub-Session-Id AVP는 다릅니다. 이러한 경우 Session-Id를 사용하여 상관 관계가 수행됩니다. 하위 세션이 원래 START\_RECORD 메시지에서 사용되었을 때 Accounting-Sub-Session-Id AVP 없이 STOP\_RECORD를 수신한다는 것은 모든 하위 세션이 종료되었음을 의미한다는 점에 유의하는 것이 중요합니다.

또한 사용자가 각각 고유한 세션 ID를 갖는 다양한 액세스 장치\(예: 모바일 IPv4\)에서 서비스를 받는 특정 애플리케이션이 있습니다. 이러한 경우 Acct-Multi-Session-Id AVP가 상관 관계에 사용됩니다. 승인 과정에서 서버는

기존 세션에 대한 요청이 Acct-Multi-Session-Id AVP를 포함해야 한다고 결정하며, 액세스 장치는 모든 후속 계정 메시지에 이를 포함해야 합니다.\(MUST\)

Acct-Multi-Session-Id AVP는 원래 Session-Id의 값을 포함할 수 있습니다. 콘텐츠는 구현별로 다르지만 다른 Acct-Multi-Session-Id 전체에서 전역적으로 고유해야 하며 세션 수명 동안 변경되어서는 안 됩니다.\(MAY, MUST NOT\)

Diameter 애플리케이션 문서는 설명되는 세션의 정확한 개념을 정의해야 하며 다중 세션의 개념을 정의할 수 있습니다. 예를 들어, NASREQ DIAMETER 애플리케이션은 네트워크 액세스 서버에 대한 단일 PPP 연결을 하나의 세션으로 처리하고 멀티링크 PPP 세션 세트를 하나의 다중 세션으로 처리합니다.\(MUST\)

---
### **9.7.  Accounting Command-Codes**

이 섹션은 회계 서비스를 제공하는 모든 Diameter 구현에 의해 지원되어야 하는 명령 코드 값을 정의합니다.\(MUST\)

---
#### **9.7.1.  Accounting-Request**

ACR\(Accounting-Request\) 명령은 Command-Code 필드가 271로 설정되고 명령 플래그의 'R' 비트가 설정되어 클라이언트 역할을 하는 Diameter 노드에 의해 전송되어 계정 정보를 클라이언트와 교환합니다. 또래.

Acct-Application-Id 및 Vendor-Specific-Application-Id AVP 중 하나가 있어야 합니다. Vendor-Specific-Application-Id 그룹화된 AVP가 있는 경우 내부에 Acct-Application-Id가 있어야 합니다.\(MUST\)

아래 나열된 AVP는 섹션 9.3에 설명된 대로 서비스별 회계 AVP를 포함해야 합니다.\(SHOULD\)

```text
   Message Format

      <ACR> ::= < Diameter Header: 271, REQ, PXY >
                < Session-Id >
                { Origin-Host }
                { Origin-Realm }
                { Destination-Realm }
                { Accounting-Record-Type }
                { Accounting-Record-Number }
                [ Acct-Application-Id ]
                [ Vendor-Specific-Application-Id ]
                [ User-Name ]
                [ Accounting-Sub-Session-Id ]
                [ Acct-Session-Id ]
                [ Acct-Multi-Session-Id ]
                [ Acct-Interim-Interval ]
                [ Accounting-Realtime-Required ]
                [ Origin-State-Id ]
                [ Event-Timestamp ]
              * [ Proxy-Info ]
              * [ Route-Record ]
              * [ AVP ]
```

---
#### **9.7.2.  Accounting-Answer**

271로 설정된 명령 코드 필드와 지워진 명령 플래그 'R' 비트로 표시되는 ACA\(계정 응답\) 명령은 계정 요청 명령을 승인하는 데 사용됩니다. Accounting-Answer 명령은 동일한 Session-Id를 포함하며 이 명령을 보낼 때 CMS가 사용 중인 경우에만 사용 AVP를 포함합니다. CMS가 사용되지 않을 때 사용 AVP를 포함하면 불필요하게 큰 응답 메시지가 발생하고 엔드투엔드 방식으로 이러한 AVP를 수신했다는 서버의 증거로 사용할 수 없습니다. Accounting-Request가 종단 간 보안으로 보호된 경우 해당 ACA 메시지도 종단 간 보안으로 보호되어야 합니다.\(MUST\)

홈 Diameter 서버로 알려진 대상 Diameter 서버만 Accounting-Answer 명령으로 응답해야 합니다.\(SHOULD\)

Acct-Application-Id 및 Vendor-Specific-Application-Id AVP 중 하나가 있어야 합니다. Vendor-Specific-Application-Id 그룹화된 AVP가 있는 경우 내부에 Acct-Application-Id가 있어야 합니다.\(MUST\)

아래 나열된 AVP는 섹션 9.3에 설명된 대로 서비스별 회계 AVP를 포함해야 합니다.\(SHOULD\)

```text
   Message Format

      <ACA> ::= < Diameter Header: 271, PXY >
                < Session-Id >
                { Result-Code }
                { Origin-Host }
                { Origin-Realm }
                { Accounting-Record-Type }
                { Accounting-Record-Number }
                [ Acct-Application-Id ]
                [ Vendor-Specific-Application-Id ]
                [ User-Name ]
                [ Accounting-Sub-Session-Id ]
                [ Acct-Session-Id ]
                [ Acct-Multi-Session-Id ]
                [ Error-Reporting-Host ]
                [ Acct-Interim-Interval ]
                [ Accounting-Realtime-Required ]
                [ Origin-State-Id ]
                [ Event-Timestamp ]
              * [ Proxy-Info ]
              * [ AVP ]
```

---
### **9.8.  Accounting AVPs**

이 섹션에는 특정 세션과 관련된 계정 사용 정보를 설명하는 AVP가 포함되어 있습니다.

---
#### **9.8.1.  Accounting-Record-Type AVP**

회계 기록 유형 AVP\(AVP 코드 480\)는 열거 유형이며 전송되는 회계 기록 유형을 포함합니다. 현재 회계 기록 유형 AVP에 대해 다음 값이 정의되어 있습니다.

이벤트\_기록 1

- 회계 사건 기록은 일회성 사건이 발생했음을 나타내는 데 사용됩니다\(사건의 시작과 끝이 동시에 발생함을 의미\). 이 기록은 서비스와 관련된 모든 정보를 담고 있으며, 서비스에 대한 유일한 기록입니다.

START\_RECORD 2

- 회계 시작, 중간, 중지 기록은 측정 가능한 기간의 서비스가 제공되었음을 나타내는 데 사용됩니다. 회계 시작 레코드는 회계 세션을 시작하는 데 사용되며 세션 시작과 관련된 회계 정보를 포함합니다.

임시\_기록 3

- 중간 회계 기록에는 기존 회계 세션에 대한 누적 회계 정보가 포함됩니다. 임시 회계 기록은 재인증 또는 재승인이 발생할 때마다 전송되어야 합니다. 또한, 추가적인 임시 기록 트리거는 애플리케이션별 Diameter 애플리케이션에 의해 정의될 수 있습니다. INTERIM\_RECORD 레코드 사용 여부의 선택은 Acct-Interim-Interval AVP에 의해 수행됩니다.\(SHOULD, MAY\)

STOP\_RECORD 4

- Accounting Stop Record는 Accounting 세션을 종료하기 위해 전송되며 기존 세션과 관련된 누적 회계 정보를 포함합니다.

---
#### **9.8.2.  Acct-Interim-Interval**

Acct-Interim-Interval AVP\(AVP 코드 85\)는 Unsigned32 유형이며 Diameter 홈 인증 서버에서 Diameter 클라이언트로 전송됩니다. 클라이언트는 이 AVP의 정보를 사용하여 회계 기록을 생성하는 방법과 시기를 결정합니다. 이 AVP의 다른 값을 사용하면 서비스 세션으로 인해 홈 조직의 요구 사항에 따라 1개, 2개 또는 2+N개의 회계 기록이 생성될 수 있습니다. 다음 회계 기록 생성 동작은 이 AVP를 포함하여 지시됩니다.

1. Acct-Interim-Interval AVP가 생략되거나 값 필드가 0으로 설정된 포함은 서비스에 맞게 EVENT\_RECORD, START\_RECORD 및 STOP\_RECORD가 생성됨을 의미합니다.

2. 값 필드가 0이 아닌 값으로 설정된 AVP를 포함한다는 것은 INTERIM\_RECORD 레코드가 START\_RECORD와 STOP\_RECORD 레코드 사이에 생성되어야 함을 의미합니다. 이 AVP의 값 필드는 이러한 레코드 간의 명목상 간격\(초\)입니다. 클라이언트로 알려진 회계 정보를 발생시키는 Diameter 노드는 대략 이 명목 간격이 START\_RECORD에서 경과되는 시점에 첫 번째 INTERIM\_RECORD 레코드를 생성해야 하며, 간격이 다시 한 번 경과하면 다음 레코드를 다시 생성해야 합니다. 세션이 종료되고 STOP\_RECORD 레코드가 생성됩니다.\(MUST, MUST\)

- 클라이언트는 기록 간이나 공통 서비스 시작 시간 전후에 대규모 회계 메시지 폭풍이 발생하지 않도록 중간 기록 생성 시간을 무작위로 지정해야 합니다.\(MUST\)

---
#### **9.8.3.  Accounting-Record-Number AVP**

회계 기록 번호 AVP\(AVP 코드 485\)는 Unsigned32 유형이며 한 세션 내에서 이 기록을 식별합니다. Session-Id AVP는 전역적으로 고유하므로 Session-Id와 Accounting-Record-Number AVP의 조합도 전역적으로 고유하며 회계 기록을 확인과 일치시키는 데 사용될 수 있습니다. 고유 번호를 생성하는 쉬운 방법은 EVENT\_RECORD 및 START\_RECORD 유형의 레코드에 대해 값을 0으로 설정하고 첫 번째 INTERIM\_RECORD에 대해 값을 1, 두 번째에 대해 2 등으로 설정하여 STOP\_RECORD의 값이 다음보다 1 커질 때까지 계속하는 것입니다. 마지막 INTERIM\_RECORD 동안.

---
#### **9.8.4.  Acct-Session-Id AVP**

Acct-Session-Id AVP\(AVP 코드 44\)는 OctetString 유형이며 RADIUS/직경 변환이 발생할 때만 사용됩니다. 이 AVP에는 RADIUS Acct-Session-Id 속성의 내용이 포함되어 있습니다.

---
#### **9.8.5.  Acct-Multi-Session-Id AVP**

Acct-Multi-Session-Id AVP\(AVP 코드 50\)는 섹션 8.8에 지정된 형식을 따르는 UTF8String 유형입니다. Acct-Multi-Session-Id AVP는 여러 관련 회계 세션을 연결하는 데 사용됩니다. 여기서 각 세션은 고유한 Session-Id를 가지지만 동일한 Acct-Multi-Session-Id AVP를 갖습니다. 이 AVP는 인증 응답으로 Diameter 서버에 의해 반환될 수 있으며, 주어진 세션에 대한 모든 계정 메시지에 사용되어야 합니다.\(MUST\)

---
#### **9.8.6.  Accounting-Sub-Session-Id AVP**

Accounting-Sub-Session-Id AVP\(AVP 코드 287\)는 Unsigned64 유형이며 회계 하위 세션 식별자를 포함합니다. Session-Id와 이 AVP의 조합은 하위 세션마다 고유해야 하며, 이 AVP의 값은 모든 새로운 하위 세션에 대해 1씩 단조롭게 증가해야 합니다. 이 AVP가 없다는 것은 Accounting-Record-Type이 STOP\_RECORD로 설정된 Accounting-Request를 제외하고 사용 중인 하위 세션이 없음을 의미합니다. Accounting-Sub-Session-Id AVP가 없는 STOP\_RECORD 메시지는 주어진 Session-Id에 대한 모든 하위 세션의 종료를 알립니다.\(MUST\)

---
#### **9.8.7.  Accounting-Realtime-Required AVP**

Accounting-Realtime-Required AVP\(AVP 코드 483\)는 Enumerated 유형이며 Diameter 홈 인증 서버에서 Diameter 클라이언트로 전송되거나 회계 서버의 Accounting-Answer로 전송됩니다. 클라이언트는 이 AVP의 정보를 사용하여 예를 들어 네트워크 문제로 인해 계정 기록을 계정 서버로 보내는 것이 일시적으로 차단된 경우 어떻게 해야 할지 결정합니다.

전달\_AND\_GRANT 1

- DELIVER\_AND\_GRANT로 설정된 값 필드가 있는 AVP는 계정 서버에 연결되어 있는 동안에만 서비스가 승인되어야 함을 의미합니다. 이러한 의미에서 대체 계정 서버 집합은 하나의 서버로 처리됩니다. 회계 기록 스트림을 백업 서버로 이동해야 한다고 해서 사용자에 대한 서비스가 중단되는 것은 아닙니다.\(MUST\)

GRANT\_AND\_STORE 2

- 값 필드가 GRANT\_AND\_STORE로 설정된 AVP는 연결이 있거나 레코드가 섹션 9.4에 설명된 대로 저장될 수 있는 한 서비스가 승인되어야 함을 의미합니다.\(SHOULD\)

- 이는 인증 서버의 응답에 AVP가 포함되지 않은 경우의 기본 동작입니다.

GRANT\_AND\_LOSE 3

- 값 필드가 GRANT\_AND\_LOSE로 설정된 AVP는 레코드가 전달되거나 저장될 수 없는 경우에도 서비스가 부여되어야 함을 의미합니다.\(SHOULD\)

---
## **10.  AVP Occurrence Table**

다음 표는 이 문서에 정의된 AVP를 제시하고 그것이 존재할 수 있거나 존재할 수 없는 Diameter 메시지를 지정합니다. 그룹화된 AVP 내에만 존재할 수 있는 AVP는 이 표에 표시되지 않습니다.\(MAY\)

표에서는 다음 기호를 사용합니다.

0 AVP는 메시지에 존재해서는 안 됩니다. 0+ 0개 이상의 AVP 인스턴스가 메시지에 존재할 수 있습니다. 0-1 AVP의 0개 또는 1개의 인스턴스가 메시지에 존재할 수 있습니다. AVP 인스턴스가 두 개 이상 있으면 오류로 간주됩니다. 1 AVP의 한 인스턴스가 메시지에 존재해야 합니다. 1+ 적어도 하나의 AVP 인스턴스가 메시지에 존재해야 합니다.\(MUST NOT, MAY, MAY, MUST, MUST\)

---
### **10.1.  Base Protocol Command AVP Table**

이 섹션의 표는 이 사양에 정의된 비계산 명령 코드로 제한됩니다.

```text
                       +-----------------------------------------------+
                       |                  Command-Code                 |
                       +---+---+---+---+---+---+---+---+---+---+---+---+
   Attribute Name      |CER|CEA|DPR|DPA|DWR|DWA|RAR|RAA|ASR|ASA|STR|STA|
   --------------------+---+---+---+---+---+---+---+---+---+---+---+---+
   Acct-Interim-       |0  |0  |0  |0  |0  |0  |0-1|0  |0  |0  |0  |0  |
     Interval          |   |   |   |   |   |   |   |   |   |   |   |   |
   Accounting-Realtime-|0  |0  |0  |0  |0  |0  |0-1|0  |0  |0  |0  |0  |
     Required          |   |   |   |   |   |   |   |   |   |   |   |   |
   Acct-Application-Id |0+ |0+ |0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |
   Auth-Application-Id |0+ |0+ |0  |0  |0  |0  |1  |0  |1  |0  |1  |0  |
   Auth-Grace-Period   |0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |
   Auth-Request-Type   |0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |
   Auth-Session-State  |0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |
   Authorization-      |0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |
     Lifetime          |   |   |   |   |   |   |   |   |   |   |   |   |
   Class               |0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |0+ |0+ |
   Destination-Host    |0  |0  |0  |0  |0  |0  |1  |0  |1  |0  |0-1|0  |
   Destination-Realm   |0  |0  |0  |0  |0  |0  |1  |0  |1  |0  |1  |0  |
   Disconnect-Cause    |0  |0  |1  |0  |0  |0  |0  |0  |0  |0  |0  |0  |
   Error-Message       |0  |0-1|0  |0-1|0  |0-1|0  |0-1|0  |0-1|0  |0-1|
   Error-Reporting-Host|0  |0  |0  |0  |0  |0  |0  |0-1|0  |0-1|0  |0-1|
   Failed-AVP          |0  |0+ |0  |0+ |0  |0+ |0  |0+ |0  |0+ |0  |0+ |
   Firmware-Revision   |0-1|0-1|0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |
   Host-IP-Address     |1+ |1+ |0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |
   Inband-Security-Id  |0+ |0+ |0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |
   Multi-Round-Time-Out|0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |
   Origin-Host         |1  |1  |1  |1  |1  |1  |1  |1  |1  |1  |1  |1  |
   Origin-Realm        |1  |1  |1  |1  |1  |1  |1  |1  |1  |1  |1  |1  |
   Origin-State-Id     |0-1|0-1|0  |0  |0-1|0-1|0-1|0-1|0-1|0-1|0-1|0-1|
   Product-Name        |1  |1  |0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |
   Proxy-Info          |0  |0  |0  |0  |0  |0  |0+ |0+ |0+ |0+ |0+ |0+ |
   Redirect-Host       |0  |0  |0  |0  |0  |0  |0  |0+ |0  |0+ |0  |0+ |
   Redirect-Host-Usage |0  |0  |0  |0  |0  |0  |0  |0-1|0  |0-1|0  |0-1|
   Redirect-Max-Cache- |0  |0  |0  |0  |0  |0  |0  |0-1|0  |0-1|0  |0-1|
     Time              |   |   |   |   |   |   |   |   |   |   |   |   |
   Result-Code         |0  |1  |0  |1  |0  |1  |0  |1  |0  |0  |0  |1  |
   Re-Auth-Request-Type|0  |0  |0  |0  |0  |0  |1  |0  |0  |0  |0  |0  |
   Route-Record        |0  |0  |0  |0  |0  |0  |0+ |0  |0+ |0  |0+ |0  |
   Session-Binding     |0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |
   Session-Id          |0  |0  |0  |0  |0  |0  |1  |1  |1  |1  |1  |1  |
   Session-Server-     |0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |
     Failover          |   |   |   |   |   |   |   |   |   |   |   |   |
   Session-Timeout     |0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |
   Supported-Vendor-Id |0+ |0+ |0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |
   Termination-Cause   |0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |1  |0  |
   User-Name           |0  |0  |0  |0  |0  |0  |0-1|0-1|0-1|0-1|0-1|0-1|
   Vendor-Id           |1  |1  |0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |

   Vendor-Specific-    |0+ |0+ |0  |0  |0  |0  |0  |0  |0  |0  |0  |0  |
     Application-Id    |   |   |   |   |   |   |   |   |   |   |   |   |
   --------------------+---+---+---+---+---+---+---+---+---+---+---+---+
```

---
### **10.2.  Accounting AVP Table**

이 섹션의 표는 이 문서에 정의된 AVP가 회계 메시지에 표시되는 것을 나타내는 데 사용됩니다. 이러한 AVP 발생 요구사항은 Diameter 애플리케이션 문서의 애플리케이션별 요구사항에 의해 확장 및/또는 무시될 수 있는 지침입니다.

```text
                                 +-----------+
                                 |  Command  |
                                 |    Code   |
                                 +-----+-----+
   Attribute Name                | ACR | ACA |
   ------------------------------+-----+-----+
   Acct-Interim-Interval         | 0-1 | 0-1 |
   Acct-Multi-Session-Id         | 0-1 | 0-1 |
   Accounting-Record-Number      | 1   | 1   |
   Accounting-Record-Type        | 1   | 1   |
   Acct-Session-Id               | 0-1 | 0-1 |
   Accounting-Sub-Session-Id     | 0-1 | 0-1 |
   Accounting-Realtime-Required  | 0-1 | 0-1 |
   Acct-Application-Id           | 0-1 | 0-1 |
   Auth-Application-Id           | 0   | 0   |
   Class                         | 0+  | 0+  |
   Destination-Host              | 0-1 | 0   |
   Destination-Realm             | 1   | 0   |
   Error-Reporting-Host          | 0   | 0+  |
   Event-Timestamp               | 0-1 | 0-1 |
   Origin-Host                   | 1   | 1   |
   Origin-Realm                  | 1   | 1   |
   Proxy-Info                    | 0+  | 0+  |
   Route-Record                  | 0+  | 0+  |
   Result-Code                   | 0   | 1   |
   Session-Id                    | 1   | 1   |
   Termination-Cause             | 0-1 | 0-1 |
   User-Name                     | 0-1 | 0-1 |
   Vendor-Specific-Application-Id| 0-1 | 0-1 |
   ------------------------------+-----+-----+
```

---
## **11.  IANA Considerations**

이 섹션에서는 BCP 26 \[IANA\]에 따라 Diameter 프로토콜과 관련된 값 등록과 관련하여 IANA\(Internet Assigned Numbers Authority\)에 대한 지침을 제공합니다. 다음 정책은 BCP 26에 정의된 의미로 사용됩니다: "개인 사용", "선착순", "전문가 검토", "사양 필요", "IETF 합의", "표준 조치".

이 섹션에서는 이 문서에 정의된 네임스페이스 내에서 번호 할당을 위해 IANA에서 사용하는 기준을 설명합니다.

Diameter는 범용 프로토콜로 의도되지 않았으며 인증, 권한 부여 또는 계정과 관련되지 않은 목적으로 할당하면 안 됩니다.\(SHOULD NOT\)

지정 전문가와 협의해야 하는 등록 요청의 경우 담당 IESG 지역 이사가 지정 전문가를 지정해야 합니다. 사양이 필요한 지정 전문가의 경우 요청은 논평 및 검토를 위해 AAA WG 메일링 리스트\(또는 해체된 경우 지역 책임자가 지정한 후임자\)에 게시되며 공개 사양에 대한 포인터를 포함해야 합니다. 30일이 경과하기 전에 지정 전문가는 등록 요청을 승인하거나 거부하고 결정 내용을 AAA WG 메일링 리스트 또는 그 후속자에게 게시합니다. 거부 통지는 설명을 통해 정당화되어야 하며, 가능한 경우 요청이 수용될 수 있도록 수정될 수 있는 방법에 대한 구체적인 제안을 제시해야 합니다.\(MUST\)

---
### **11.1.  AVP Header**

섹션 4에 정의된 대로 AVP 헤더에는 IANA 네임스페이스 관리가 필요한 세 가지 필드가 포함되어 있습니다. AVP 코드, 공급업체 ID 및 플래그 필드.

---
#### **11.1.1.  AVP Codes**

AVP 코드 네임스페이스는 속성을 식별하는 데 사용됩니다. 네임스페이스가 여러 개 있습니다. 공급업체는 공급업체 ID\(Enterprise-Number라고도 함\)로 식별되는 자체 AVP 코드 네임스페이스를 가질 수 있으며 자체 네임스페이스 내에서 공급업체별 AVP 코드 할당을 제어합니다. Vendor-ID가 없거나 Vendor-ID 값 0은 IETF IANA 제어 AVP 코드 네임스페이스를 식별합니다. AVP 코드와 때로는 AVP에서 가능한 값도 IANA에 의해 제어되고 유지됩니다.

AVP 코드 0은 사용되지 않습니다. AVP 코드 1-255는 RADIUS 속성 유형 \[RADTYPE\]으로 별도로 관리됩니다. 이 문서는 AVP 코드 257-274, 276-285, 287, 291-300, 480, 483 및 485-486을 정의합니다. 이 사양의 네임스페이스 할당은 섹션 4.5를 참조하세요.

AVP는 사양이 필요한 지정 전문가 \[IANA\]에 따라 할당될 수 있습니다. AVP 블록\(주어진 목적을 위해 한 번에 3개 이상\)을 릴리스하려면 IETF 합의가 필요합니다.

Diameter는 AVP 헤더의 Vendor-Id 필드가 0이 아닌 값으로 설정되는 Vendor-Specific AVP에 대한 메커니즘을 정의합니다. 공급업체별 AVP 코드는 개인용이며 상호 운용성이 유용하지 않은 것으로 간주되는 한 공급업체의 Diameter 구현에만 특정한 기능에 대해 전역 속성 유형을 할당하는 대신 권장되어야 합니다. 벤더별 AVP가 둘 이상의 벤더에 의해 구현되는 경우 대신 글로벌 AVP 할당이 권장되어야 합니다.

---
#### **11.1.2.  AVP Flags**

섹션 4에 정의된 AVP 헤더의 AVP 플래그 필드에는 8비트가 있습니다. 이 문서에서는 비트 0\('벤더 특정\), 비트 1\('M'필수\) 및 비트 2\('P'보호\)를 할당합니다. 나머지 비트는 표준 조치\[IANA\]를 통해서만 할당되어야 합니다.

---
### **11.2.  Diameter Header**

섹션 3에 정의된 대로 Diameter 헤더에는 IANA 네임스페이스 관리가 필요한 두 개의 필드가 포함되어 있습니다. 명령 코드 및 명령 플래그.

---
#### **11.2.1.  Command Codes**

Command Code 네임스페이스는 Diameter 명령을 식별하는 데 사용됩니다. 0-255 값은 RADIUS 이전 버전과의 호환성을 위해 예약되어 있으며 \[RADTYPE\]에서 "RADIUS 패킷 유형 코드"로 정의됩니다. 값 256-16,777,213은 IETF 합의 \[IANA\]에 의해 할당된 영구 표준 명령에 대한 것입니다. 이 문서는 명령 코드 257, 258, 271, 274-275, 280 및 282를 정의합니다. 이 사양의 네임스페이스 할당은 섹션 3.1을 참조하세요.

값 16,777,214 및 16,777,215\(16진수 값 0xfffffe - 0xffffff\)는 실험 명령용으로 예약되어 있습니다. 이러한 코드는 실험 및 테스트 목적으로만 사용되므로 \[IANA-EXP\]에 설명된 대로 실험 명령을 사용하는 Diameter 피어 간의 상호 운용성은 보장되지 않습니다.

---
#### **11.2.2.  Command Flags**

Diameter 헤더의 Command Flags 필드에는 8비트가 있습니다. 이 문서에서는 비트 0\('R'equest\), 비트 1\('P'roxy\), 비트 2\('E'rror\) 및 비트 3\('T'\)을 할당합니다. 비트 4\~7은 표준 조치\[IANA\]를 통해서만 할당되어야 합니다.\(MUST\)

---
### **11.3.  Application Identifiers**

섹션 2.4에 정의된 대로 애플리케이션 식별자는 특정 직경 애플리케이션을 식별하는 데 사용됩니다. 표준 추적 애플리케이션 ID와 공급업체별 애플리케이션 ID가 있습니다.

IANA \[IANA\]는 표준 트랙 애플리케이션에 대해 0x00000001 \~ 0x00ffffff 범위를 할당했습니다. 벤더별 애플리케이션의 경우 0x01000000 - 0xfffffffe\(선착순\)입니다. 다음 값이 할당됩니다.

```text
      Diameter Common Messages            0
      NASREQ                              1 [NASREQ]
      Mobile-IP                           2 [DIAMMIP]
      Diameter Base Accounting            3
      Relay                               0xffffffff
```

표준 트랙 애플리케이션 ID 할당은 사양이 필요한 지정 전문가\(IANA\)에 의해 할당됩니다.

Application-Id 및 Acct-Application-Id AVP는 모두 동일한 애플리케이션 식별자 공간을 사용합니다.

공급업체별 애플리케이션 식별자는 개인 용도로 사용됩니다. 공급업체별 애플리케이션 식별자는 IANA에 의해 선착순으로 할당됩니다.

---
### **11.4.  AVP Values**

Diameter의 특정 AVP는 다양한 의미를 가진 값 목록을 정의합니다. 이 섹션에 지정된 속성 이외의 속성의 경우 IANA에서는 선착순으로 목록에 추가 값을 추가할 수 있습니다.

---
#### **11.4.1.  Result-Code AVP Values**

섹션 7.1에 정의된 대로 결과 코드 AVP\(AVP 코드 268\)는 값 1001, 2001-2002, 3001-3010, 4001-4002 및 5001-5017을 정의합니다.

나머지 모든 값은 IETF 합의 \[IANA\]를 통해 할당할 수 있습니다.

---
#### **11.4.2.  Accounting-Record-Type AVP Values**

섹션 9.8.1에 정의된 대로 회계 기록 유형 AVP\(AVP 코드 480\)는 값 1-4를 정의합니다. 나머지 모든 값은 IETF 합의 \[IANA\]를 통해 할당할 수 있습니다.

---
#### **11.4.3.  Termination-Cause AVP Values**

섹션 8.15에 정의된 대로 종료 원인 AVP\(AVP 코드 295\)는 값 1-8을 정의합니다. 나머지 모든 값은 IETF 합의 \[IANA\]를 통해 할당할 수 있습니다.

---
#### **11.4.4.  Redirect-Host-Usage AVP Values**

섹션 6.13에 정의된 대로 Redirect-Host-Usage AVP\(AVP 코드 261\)는 값 0-5를 정의합니다. 나머지 모든 값은 IETF 합의 \[IANA\]를 통해 할당할 수 있습니다.

---
#### **11.4.5.  Session-Server-Failover AVP Values**

섹션 8.18에 정의된 대로 Session-Server-Failover AVP\(AVP 코드 271\)는 값 0-3을 정의합니다. 나머지 모든 값은 IETF 합의 \[IANA\]를 통해 할당할 수 있습니다.

---
#### **11.4.6.  Session-Binding AVP Values**

섹션 8.17에 정의된 대로 세션 바인딩 AVP\(AVP 코드 270\)는 비트 1-4를 정의합니다. 나머지 모든 비트는 IETF 합의\[IANA\]를 통해 할당할 수 있습니다.

---
#### **11.4.7.  Disconnect-Cause AVP Values**

섹션 5.4.3에 정의된 대로 연결 끊김 원인 AVP\(AVP 코드 273\)는 값 0\~2를 정의합니다. 나머지 모든 값은 IETF 합의 \[IANA\]를 통해 할당할 수 있습니다.

---
#### **11.4.8.  Auth-Request-Type AVP Values**

섹션 8.7에 정의된 대로 Auth-Request-Type AVP\(AVP 코드 274\)는 값 1-3을 정의합니다. 나머지 모든 값은 IETF 합의 \[IANA\]를 통해 할당할 수 있습니다.

---
#### **11.4.9.  Auth-Session-State AVP Values**

섹션 8.11에 정의된 대로 Auth-Session-State AVP\(AVP 코드 277\)는 값 0-1을 정의합니다. 나머지 모든 값은 IETF 합의 \[IANA\]를 통해 할당할 수 있습니다.

---
#### **11.4.10.  Re-Auth-Request-Type AVP Values**

섹션 8.12에 정의된 대로 Re-Auth-Request-Type AVP\(AVP 코드 285\)는 값 0-1을 정의합니다. 나머지 모든 값은 IETF 합의 \[IANA\]를 통해 할당할 수 있습니다.

---
#### **11.4.11.  Accounting-Realtime-Required AVP Values**

섹션 9.8.7에 정의된 대로 Accounting-Realtime-Required AVP\(AVP 코드 483\)는 값 1-3을 정의합니다. 나머지 모든 값은 IETF 합의 \[IANA\]를 통해 할당할 수 있습니다.

---
#### **11.4.12.   Inband-Security-Id AVP (code 299)**

섹션 6.10에 정의된 대로 Inband-Security-Id AVP\(AVP 코드 299\)는 값 0\~1을 정의합니다. 나머지 모든 값은 IETF 합의 \[IANA\]를 통해 할당할 수 있습니다.

---
### **11.5.  Diameter TCP/SCTP Port Numbers**

IANA는 Diameter에 TCP 및 SCTP 포트 번호 3868을 할당했습니다.

---
### **11.6.  NAPTR Service Fields**

RFC 등록에는 다음 정보가 포함되어야 합니다.\(MUST\)

서비스 필드: 등록되는 서비스 필드입니다. NCTP라는 새로운 가상 전송 프로토콜의 예는 "AAA+D2N"일 수 있습니다.

프로토콜: 해당 서비스 필드와 관련된 특정 전송 프로토콜입니다. 여기에는 전송 프로토콜을 설명하는 문서에 대한 참조와 함께 프로토콜의 이름과 약어가 포함되어야 합니다. 예를 들면 "새 NCTP\(Connectionless Transport Protocol\), RFC 5766"입니다.\(MUST\)

이름 및 연락처 정보: 등록을 수행하는 사람의 이름, 주소, 이메일 주소 및 전화번호.

다음 값이 레지스트리에 배치되었습니다.

```text
      Services Field               Protocol
      AAA+D2T                       TCP
      AAA+D2S                       SCTP
```

---
## **12.  Diameter protocol related configurable parameters**

이 섹션에는 이 문서 전체에서 볼 수 있는 구성 가능한 매개변수가 포함되어 있습니다.

직경 피어

- Diameter 엔터티는 정적으로 구성된 피어와 통신할 수 있습니다. 정적으로 구성된 Diameter 피어에는 IP 주소 또는 FQDN\(정규화된 도메인 이름\)이 제공되어야 하며, 이는 DNS를 통해 확인하는 데 사용됩니다.\(MAY\)

영역 라우팅 테이블

- Diameter 프록시 서버는 NAI\(Network Access Identifier\)의 영역 부분을 기반으로 메시지를 라우팅합니다. 서버에는 영역 이름 테이블과 메시지가 전달되어야 하는 피어의 주소가 있어야 합니다. 라우팅 테이블에는 로컬로 처리할 수 없는 모든 메시지에 일반적으로 사용되는 "기본 경로"도 포함될 수 있습니다.\(MUST, MAY\)

Tc 타이머

- Tc 타이머는 활성 전송 연결이 없는 피어에 대한 전송 연결 시도 빈도를 제어합니다. 권장 값은 30초입니다.

---
## **13.  Security Considerations**

Diameter 기본 프로토콜은 메시지가 IPSec 또는 TLS를 사용하여 보호된다고 가정합니다. 이 보안 메커니즘은 신뢰할 수 없는 제3자 에이전트가 없는 환경에서 허용됩니다. 다른 상황에서는 엔드투엔드 보안이 필요합니다.

NAS\(네트워크 액세스 서버\) 및 모바일 에이전트와 같은 다이어미터 클라이언트는 IP 보안\[SECARCH\]을 지원해야 하며 TLS\[TLS\]를 지원할 수 있습니다. Diameter 서버는 TLS 및 IPsec을 지원해야 합니다. Diameter 구현은 각 연결에서 일종의 전송 수준 보안\(IPsec 또는 TLS\)을 사용해야 합니다.\(MUST, MUST, MUST\)

Diameter 연결이 IPsec에 의해 보호되지 않는 경우 CER/CEA 교환에는 TLS 값을 가진 Inband-Security-ID AVP가 포함되어야 합니다. TLS 사용의 경우 CER/CEA 교환이 완료된 후 양쪽 끝이 열린 상태가 되면 TLS 핸드셰이크가 시작됩니다. TLS 핸드셰이크가 성공하면 모든 추가 메시지가 TLS를 통해 전송됩니다. Handshake가 실패하면 양쪽 끝이 닫힌 상태로 이동합니다.\(MUST\)

IPsec은 도메인 내 교환을 위해 에지에서 주로 사용되는 것이 좋습니다. 인증서가 지원되지 않는 NAS 장치의 경우 NAS와 로컬 AAA 프록시 간에 사전 공유 키를 사용할 수 있습니다.

도메인 간 교환을 보호하려면 TLS를 권장합니다. IPsec 및 TLS 사용에 대한 자세한 내용은 섹션 13.1 및 13.2를 참조하십시오.

---
### **13.1.  IPsec Usage**

모든 Diameter 구현은 패킷별 인증, 무결성 보호 및 기밀성을 제공하기 위해 null이 아닌 암호화 및 인증 알고리즘을 사용하여 전송 모드에서 IPsec ESP\[IPsec\]를 지원해야 하며 IPsec의 재생 보호 메커니즘을 지원해야 합니다.\(MUST\)

Diameter 구현은 IPsec DOI \[IPSECDOI\]를 사용하여 피어 인증, 보안 연결 협상 및 키 관리를 위해 IKE를 지원해야 합니다. Diameter 구현은 사전 공유 키를 사용하여 피어 인증을 지원해야 하며\(MUST\) 디지털 서명을 사용하여 인증서 기반 피어 인증을 지원할 수 있습니다\(MAY\). IKE의 섹션 5.2 및 5.3 \[IKE\]에 설명된 공개 키 암호화 방법을 사용하는 피어 인증은 사용하면 안 됩니다.\(MUST, MUST, SHOULD NOT\)

규격 구현은 IKE 기본 모드와 공격적 모드를 모두 지원해야 합니다. 사전 공유 키를 인증에 사용하는 경우 IKE 공격 모드를 사용해야 하며 IKE 기본 모드는 사용하면 안 됩니다. 인증을 위해 디지털 서명을 사용하는 경우 IKE 기본 모드 또는 IKE 공격적 모드를 사용할 수 있습니다.\(MUST, SHOULD NOT, MAY\)

인증을 달성하기 위해 디지털 서명을 사용할 때 IKE 협상자는 IKE 인증서 요청 페이로드를 사용하여 로컬 정책에 따라 신뢰할 수 있는 인증 기관\(또는 기관\)을 지정해야 합니다. IKE 협상자는 IKE 인증 절차에 사용할 PKI 인증서를 수락하기 전에 적절한 인증서 폐기 확인을 사용해야 합니다.\(SHOULD, SHOULD\)

Diameter 연결에 대한 보호를 협상하는 데 사용되는 2단계 빠른 모드 교환은 ID 페이로드 필드\(IDci 및 IDcr\)를 명시적으로 전달해야 합니다. DOI는 여러 유형의 식별 데이터를 제공합니다. 그러나 준수 구현에 사용되는 경우 각 ID 페이로드는 단일 IP 주소와 0이 아닌 단일 포트 번호를 전달해야 하며 IP 서브넷 또는 IP 주소 범위 형식을 사용해서는 안 됩니다. 이를 통해 2단계 보안 연결이 특정 TCP 및 SCTP 연결에 대응할 수 있습니다.\(MUST, MUST NOT\)

IPsec 가속 하드웨어는 제한된 수의 활성 IKE 2단계 SA만 처리할 수 있으므로 활성 2단계 SA 수를 최소로 유지하는 수단으로 유휴 SA에 대해 2단계 삭제 메시지가 전송될 수 있습니다. IKE 2단계 삭제 메시지의 수신은 Diameter 연결을 끊는 이유로 해석되어서는 안 됩니다. 오히려 연결을 유지하고 추가 트래픽이 전송되는 경우 이를 보호하기 위해 또 다른 IKE Phase 2 SA를 가동하는 것이 좋습니다. 이렇게 하면 연결이 지속적으로 증가하거나 중단될 가능성이 방지됩니다.\(SHOULD NOT\)

---
### **13.2.  TLS Usage**

다른 Diameter 노드에 대한 연결을 시작하는 Diameter 노드는 \[TLS\]에 따라 TLS 클라이언트 역할을 하고, 연결을 수락하는 Diameter 노드는 TLS 서버 역할을 합니다. 보안을 위해 TLS를 구현하는 Diameter 노드는 TLS 세션 설정의 일부로 상호 인증해야 합니다. 상호 인증을 보장하기 위해 TLS 서버 역할을 하는 Diameter 노드는 TLS 클라이언트 역할을 하는 Diameter 노드에 인증서를 요청해야 하며, TLS 클라이언트 역할을 하는 Diameter 노드는 요청 시 인증서를 제공할 준비를 해야 합니다.\(MUST, MUST\)

Diameter 노드는 다음 TLS 암호화 제품군을 협상할 수 있어야 합니다.\(MUST\)

```text
      TLS_RSA_WITH_RC4_128_MD5
      TLS_RSA_WITH_RC4_128_SHA
      TLS_RSA_WITH_3DES_EDE_CBC_SHA
```

Diameter 노드는 다음 TLS 암호화 제품군을 협상할 수 있어야 합니다.\(SHOULD\)

```text
      TLS_RSA_WITH_AES_128_CBC_SHA

   Diameter nodes MAY negotiate other TLS cipher suites.
```

---
### **13.3.  Peer-to-Peer Considerations**

모든 P2P 프로토콜과 마찬가지로 Diameter 피어 내 신뢰 모델의 적절한 구성은 보안에 필수적입니다. 인증서를 사용하는 경우 Diameter 피어가 신뢰하는 루트 인증 기관을 구성해야 합니다. 이러한 루트 CA는 Diameter 사용에 고유할 가능성이 높으며 웹 검색과 같은 다른 목적으로 신뢰할 수 있는 루트 CA와는 다릅니다. 일반적으로 해당 루트 CA는 Diameter 피어를 호스팅하는 조직과 다른 조직 간의 비즈니스 관계를 반영하도록 구성될 것으로 예상됩니다. 결과적으로 Diameter 피어는 일반적으로 임의의 피어와의 연결을 허용하도록 구성되지 않습니다. 인증서 인증 시 Diameter 피어를 미리 알 수 없으므로 피어 검색이 필요할 수 있습니다.

루트 CA 구성과 관련하여 IPsec은 TLS보다 유연성이 상당히 떨어집니다. IKE 1단계에서는 포트 식별자 사용이 금지되어 있으므로 IPsec 내에서는 각 애플리케이션에 대해 신뢰할 수 있는 루트 CA를 개별적으로 고유하게 구성하는 것이 불가능합니다. 모든 애플리케이션에 동일한 정책을 사용해야 합니다. 이는 예를 들어 Diameter와 함께 사용하도록 신뢰된 루트 CA도 다음과 같아야 함을 의미합니다.

SNMP를 보호하기 위해 신뢰됩니다. 이러한 제한은 기껏해야 어색할 수 있습니다. TLS는 인증서 정책에서 애플리케이션 수준의 세분성을 지원하므로 관리 도메인 간의 Diameter 연결을 보호하기 위해 TLS를 사용해야 합니다. IPsec은 사전 공유 키가 보안 메커니즘으로 사용될 때 도메인 내 사용에 가장 적합합니다.\(SHOULD\)

Diameter를 보호하기 위해 IPsec과 함께 사전 공유 키 인증을 사용하는 경우 고유한 사전 공유 키는 IP 주소\(주 모드\) 또는 FQDN\(공격 모드\)으로 식별되는 Diameter 피어로 구성됩니다. 결과적으로, Diameter 피어의 집합을 사전에 알고 있어야 합니다. 따라서 피어 검색은 일반적으로 필요하지 않습니다.

다음은 이 문제에 대한 몇 가지 지침을 제공하기 위한 것입니다.

Diameter 피어는 모든 피어 투 피어 연결에서 동일한 보안 메커니즘\(IPsec 또는 TLS\)을 구현하는 것이 좋습니다. 보안 메커니즘을 일관되지 않게 사용하면 중복된 보안 메커니즘\(예: IPsec을 통한 TLS\)이 사용되거나 더 나쁘게는 잠재적인 보안 취약성이 발생할 수 있습니다. IPsec을 Diameter와 함께 사용하는 경우 아웃바운드 트래픽에 대한 일반적인 보안 정책은 "나로부터 임의의 대상 포트 Diameter로 IPsec 시작"입니다. 인바운드 트래픽의 경우 정책은 "대상 포트 직경에 대해 IPsec 필요"입니다.

이 정책을 사용하면 Diameter 피어가 다른 Diameter 피어에 대한 연결을 시작할 때마다 IPsec이 사용되고 인바운드 Diameter 연결이 발생할 때마다 IPsec이 필요합니다. 이 정책은 새로운 Diameter 연결이 생성될 때마다 각 피어에 대해 정책을 설정하거나 동적으로 수정할 필요가 없기 때문에 매력적입니다. IPsec SA는 간단한 정적 정책을 기반으로 자동으로 생성됩니다. IPsec 확장은 일반적으로 대부분의 플랫폼에서 소켓 API에 사용할 수 없고 IPsec 정책 기능은 구현에 따라 다르므로 간단한 정적 정책을 사용하는 것이 IPsec을 활성화하는 Diameter 구현에 대한 가장 간단한 경로인 경우가 많습니다.

권장 정책의 한 가지 의미는 노드가 TLS와 IPsec을 모두 사용하는 경우 TLS 사용을 위해 추가 포트를 예약하지 않고 TLS나 IPsec 중 하나만 사용하고 둘 다 사용할 수 있는 편리한 방법이 없다는 것입니다. Diameter는 권장 IPsec 정책이 적용되는 TLS 및 비 TLS 사용에 동일한 포트를 사용하므로 TLS로 보호되는 연결은 IPsec 정책과 일치하며 IPsec과 TLS는 모두 Diameter 연결을 보호하는 데 사용됩니다. 이를 방지하려면 피어별 정책을 정적으로 또는 동적으로 연결해야 합니다.

IPsec이 Diameter P2P 연결을 보호하는 데 사용되는 경우 IPsec 정책은 인바운드 연결에 대해 IPsec 보호를 요구하고 아웃바운드 연결에 대해 IPsec 보호를 시작하도록 설정되어야 합니다. 이는 인바운드 및 아웃바운드 필터 정책을 사용하여 수행할 수 있습니다.\(SHOULD\)

---
## **14.  References**
---
### **14.1.  Normative References**

\[AAATRANS\] Aboba, B. 및 J. Wood, "AAA\(인증, 권한 부여 및 회계\) 전송 프로필", RFC 3539, 2003년 6월.

\[ABNF\] Crocker, D. 및 P. Overell, "구문 사양을 위한 보강된 BNF: ABNF", RFC 2234, 1997년 11월.

\[ASSIGNNO\] Reynolds, J., "할당된 번호: RFC 1700이 온라인 데이터베이스로 대체됨", RFC 3232, 2002년 1월.

\[DIFFSERV\] Nichols, K., Blake, S., Baker, F. 및 D. Black, "IPv4 및 IPv6 헤더의 차별화된 서비스 필드\(DS 필드\) 정의", RFC 2474, 1998년 12월.

\[DIFFSERVAF\] Heinanen, J., Baker, F., Weiss, W. 및 J. Wroclawski, "보장된 전달 PHB 그룹", RFC 2597, 1999년 6월.

\[DIFFSERVEF\] Davie, B., Charny, A., Bennet, J., Benson, K., Le Boudec, J., Courtney, W., Davari, S., Firoiu, V. 및 D. Stiliadis, "An 신속 전달 PHB", RFC 3246, 2002년 3월.

\[DNSSRV\] Gulbrandsen, A., Vixie, P. 및 L. Esibov, "서비스 위치 지정을 위한 DNS RR\(DNS SRV\)", RFC 2782, 2000년 2월.

\[EAP\] Blunk, L. 및 J. Vollbrecht, "PPP 확장 가능

- 인증 프로토콜\(EAP\)", RFC 2284, 1998년 3월.

\[FLOATPOINT\] 전기전자공학협회, "이진 부동 소수점 연산을 위한 IEEE 표준", ANSI/IEEE 표준 754-1985, 1985년 8월.

\[IANA\] Narten, T. 및 H. Alvestrand, "RFC에서 IANA 고려 사항 섹션 작성 지침", BCP 26, RFC 2434, 1998년 10월.

```text
   [IANAADFAM]    IANA; "Address Family Numbers",
                  http://www.iana.org/assignments/address-family-numbers

   [IANAWEB]      IANA, "Number assignment", http://www.iana.org
```

\[IKE\] Harkins, D. 및 D. Carrel, "인터넷 키 교환\(IKE\)", RFC 2409, 1998년 11월.

\[IPComp\] Shacham, A., Monsour, R., Pereira, R. 및 M. Thomas, "IP 페이로드 압축 프로토콜\(IPComp\)", RFC 3173, 2001년 9월.

\[IPSECDOI\] Piper, D., "ISAKMP에 대한 해석의 인터넷 IP 보안 도메인", RFC 2407, 1998년 11월.

```text
   [IPV4]         Postel, J., "Internet Protocol", STD 5, RFC 791,
                  September 1981.
```

\[IPV6\] Hinden, R. 및 S. Deering, "IP 버전 6 주소 지정 아키텍처", RFC 2373, 1998년 7월.

\[키워드\] Bradner, S., "요구 수준을 나타내기 위해 RFC에서 사용할 수 있는 키워드", BCP 14, RFC 2119, 1997년 3월.

\[NAI\] Aboba, B. 및 M. Beadles, "네트워크 액세스

- 식별자", RFC 2486, 1999년 1월.

\[NAPTR\] Mealling, M. 및 R. Daniel, "NAPTR\(명명 기관 포인터\) DNS 리소스 레코드", RFC 2915, 2000년 9월.

```text
   [RADTYPE]      IANA, "RADIUS Types",
                  http://www.iana.org/assignments/radius-types
```

\[SCTP\] Stewart, R., Xie, Q., Morneault, K., Sharp, C., Schwarzbauer, H., Taylor, T., Rytina, I., Kalla, M., Zhang, L. 및 V. Paxson, "스트림 제어 전송 프로토콜", RFC 2960, 2000년 10월.

\[SLP\] Veizades, J., Guttman, E., Perkins, C. 및 M. Day, "서비스 위치 프로토콜, 버전 2", RFC 2165, 1999년 6월.

\[SNTP\] Mills, D., "IPv4, IPv6 및 OSI용 SNTP\(Simple Network Time Protocol\) 버전 4", RFC 2030, 1996년 10월.

```text
   [TCP]          Postel, J. "Transmission Control Protocol", STD 7, RFC
                  793, January 1981.
```

\[템플릿\] Guttman, E., Perkins, C. 및 J. Kempf, "서비스 템플릿 및 서비스: 구성표", RFC 2609, 1999년 6월.

\[TLS\] Dierks, T. 및 C. Allen, "TLS 프로토콜 버전 1.0", RFC 2246, 1999년 1월.

\[TLSSCTP\] Jungmaier, A., Rescorla, E. 및 M. Tuexen, "스트림 제어 전송 프로토콜을 통한 전송 계층 보안", RFC 3436, 2002년 12월.

\[URI\] Berners-Lee, T., Fielding, R. 및 L. Masinter, "URI\(Uniform Resource Identifier\): 일반 구문", RFC 2396, 1998년 8월.

\[UTF8\] Yergeau, F., "UTF-8, ISO 10646의 변환 형식", RFC 2279, 1998년 1월.

---
### **14.2.  Informative References**

\[AAACMS\] P. Calhoun, W. Bulley, S. Farrell, "Diameter CMS 보안 애플리케이션", 작업 진행 중.

\[AAAREQ\] Aboba, B., Calhoun, P., Glass, S., Hiller, T., McCann, P., Shiino, H., Zorn, G., Dommity, G., Perkins, C., Patil, B., Mitton, D., Manning, S., Beadles, M., Walsh, P., Chen, X., Sivalingham, S., Hameed, A., Munson, M., Jacobs, S., Lim, B., Hirschman, B., Hsu, R., Xu, Y., Campbell, E., Baba, S. 및 E. Jaques, "네트워크 액세스를 위한 AAA 프로토콜 평가 기준", RFC 2989, 2000년 11월.

\[ACCMGMT\] Aboba, B., Arkko, J. 및 D. Harrington. "회계 관리 소개", RFC 2975, 2000년 10월.

\[CDMA2000\] Hiller, T., Walsh, P., Chen, X., Munson, M., Dommy, G., Sivalingham, S., Lim, B., McCann, P., Shiino, H., Hirschman, B., Manning, S., Hsu, R., Koo, H., Lipford, M., Calhoun, P., Lo, C., Jaques, E., Campbell, E., Xu, Y., Baba, S., Ayaki, T., Seki, T. 및 A. Hameed, "AAA에 대한 CDMA2000 무선 데이터 요구 사항", RFC 3141, 2001년 6월.

\[DIAMMIP\] P. Calhoun, C. Perkins, "직경 모바일 IP

- 신청', 작업 진행 중.

\[DYNAUTH\] Chiba, M., Dommity, G., Eklund, M., Mitton, D. 및 B. Aboba, "RADIUS\(원격 인증 다이얼 인 사용자 서비스\)에 대한 동적 권한 부여 확장", RFC 3576, 2003년 7월.

\[IANA-EXP\] T. Narten, "유용하다고 간주되는 실험 및 테스트 번호 지정", 작업 진행 중.

\[MIPV4\] Perkins, C., "IPv4에 대한 IP 이동성 지원", RFC 3344, 2002년 8월.

\[MIPREQ\] Glass, S., Hiller, T., Jacobs, S. 및 C. Perkins, "모바일 IP 인증, 권한 부여 및 회계 요구 사항", RFC 2977, 2000년 10월.

\[NASNG\] Mitton, D. 및 M. Beadles, "NASREQNG\(네트워크 액세스 서버 요구 사항 차세대\) NAS 모델", RFC 2881, 2000년 7월.

\[NASREQ\] P. Calhoun, W. Bulley, A. Rubens, J. Haag, "직경 NASREQ 애플리케이션", 작업 진행 중.

\[NASCRIT\] Beadles, M. 및 D. Mitton, "네트워크 액세스 서버 프로토콜 평가 기준", RFC 3169, 2001년 9월.

```text
   [PPP]          Simpson, W., "The Point-to-Point Protocol (PPP)", STD
                  51, RFC 1661, July 1994.
```

\[PROXYCHAIN\] Aboba, B. 및 J. Vollbrecht, "로밍의 프록시 연결 및 정책 구현", RFC 2607, 1999년 6월.

```text
   [RADACCT]      Rigney, C., "RADIUS Accounting", RFC 2866, June 2000.
```

\[RADEXT\] Rigney, C., Willats, W. 및 P. Calhoun, "RADIUS 확장", RFC 2869, 2000년 6월.

\[RADIUS\] Rigney, C., Willens, S., Rubens, A. 및 W. Simpson, "RADIUS\(원격 인증 다이얼 인 사용자 서비스\)", RFC 2865, 2000년 6월.

\[ROAMREV\] Aboba, B., Lu, J., Alsop, J., Ding, J. 및 W. Wang, "로밍 구현 검토", RFC 2194, 1997년 9월.

\[ROAMCRIT\] Aboba, B. 및 G. Zorn, "로밍 프로토콜 평가 기준", RFC 2477, 1999년 1월.

\[보안\] Kent, S. 및 R. Atkinson, "인터넷 프로토콜을 위한 보안 아키텍처", RFC 2401, 1998년 11월.

```text
   [TACACS]       Finseth, C., "An Access Control Protocol, Sometimes
                  Called TACACS", RFC 1492, July 1993.
```

---
## **15.  Acknowledgements**

저자들은 IETF 이전 문서 읽기 파티에 참여한 Nenad Trifunovic, Tony Johansson 및 Pankaj Patel에게 감사의 말씀을 전하고 싶습니다. Allison Mankin, Jonathan Wood 및 Bernard Aboba는 운송 문제를 해결하는 데 귀중한 지원을 제공했으며 마찬가지로 보안 영역에서 Steven Bellovin에게도 도움을 주었습니다.

Paul Funk와 David Mitton은 Peer State Machine을 올바르게 만드는 데 중요한 역할을 했으며, 시간을 내어 주신 이들에게 깊은 감사를 드립니다.

이 문서의 텍스트는 Paul Funk, Mark Eklund, Mark Jones 및 Dave Spence가 제공했습니다. Jacques Caron은 사양을 철저히 검토한 결과 많은 훌륭한 의견을 제공했습니다.

저자는 Diameter 프로토콜 개발에 기여한 다음 사람들에게도 감사의 말씀을 전하고 싶습니다.

Allan C. Rubens, Haseeb Akhtar, William Bulley, Stephen Farrell, David Frascone, Daniel C. Fox, Lol Grant, Ignacio Goyret, Nancy Greene, Peter Heitman, Fredrik Johansson, Mark Jones, Martin Julien, Bob Kopacz, Paul Krumviede, Fergal Ladley, Ryan Moats, Victor Muslin, Kenneth Peirce, John Schnizlein, Sumit Vakil, John R. Vollbrecht 및 Jeff Weisberg.

마지막으로 Pat Calhoun은 Sun Microsystems에 근무하는 동안 이 문서에 쏟은 노력의 대부분을 수행한 데 대해 감사의 말씀을 전하고 싶습니다.

---
# **Appendix A.  Diameter Service Template**

다음 서비스 템플릿은 Diameter 서버가 자신을 알리기 위해 사용하는 속성을 설명합니다. 이는 통신할 적절한 서버를 선택하는 프로세스를 단순화합니다. Diameter 클라이언트는 원하는 Diameter 서비스의 특성을 기반으로 특정 Diameter 서버를 요청할 수 있습니다\(예: 회계에 사용할 AAA 서버\).

제출자 이름: "Erik Guttman" <Erik.Guttman@sun.com\> 서비스 템플릿 언어: en

보안 고려 사항:

- Diameter 클라이언트와 서버는 다양한 암호화 메커니즘을 사용하여 통신 무결성, 기밀성을 보호하고 엔드포인트 인증을 수행합니다. 따라서 공격자가 SLPv2를 사용하여 자신을 광고하고 적절한 사전 구성된 비밀이나 암호화 키 없이 합법적인 Diameter 피어인 것처럼 가장하는 것은 불가능하지는 않더라도 어렵습니다. 그럼에도 불구하고 Diameter 서비스는 네트워크 운영에 필수적이므로 SLPv2 인증을 사용하여 공격자가 합법적인 Diameter 서버에 대한 서비스 광고를 수정하거나 제거하는 것을 방지하는 것이 중요합니다.

```text
   Template text:
   -------------------------template begins here-----------------------
   template-type=service:diameter

   template-version=0.0
```

template-description= Diameter 프로토콜은 RFC 3588에 의해 정의됩니다.

```text
   template-url-syntax=
     url-path= ; The Diameter URL format is described in Section 2.9.
               ; Example: 'aaa://aaa.example.com:1812;transport=tcp
      supported-auth-applications= string L M
      # This attribute lists the Diameter applications supported by the
      # AAA implementation.  The applications currently defined are:
      #  Application Name     Defined by
      #  ----------------     -----------------------------------
      #  NASREQ               Diameter Network Access Server Application
      #  MobileIP             Diameter Mobile IP Application
      #
      # Notes:
      #   . Diameter implementations support one or more applications.
      #   . Additional applications may be defined in the future.
      #     An updated service template will be created at that time.

      #
      NASREQ,MobileIP

      supported-acct-applications= string L M
      # This attribute lists the Diameter applications supported by the
      # AAA implementation.  The applications currently defined are:
      #  Application Name     Defined by
      #  ----------------     -----------------------------------
      #  NASREQ               Diameter Network Access Server Application
      #  MobileIP             Diameter Mobile IP Application
      #
      # Notes:
      #   . Diameter implementations support one or more applications.
      #   . Additional applications may be defined in the future.
      #     An updated service template will be created at that time.
      #
      NASREQ,MobileIP
```

지원되는 전송 = 문자열 L M

- SCTP # 이 속성은 Diameter # 구현이 허용하는 지원 전송을 나열합니다. 규정을 준수하는 Diameter # 구현은 SCTP를 지원해야 하지만 다른 전송도 # 지원할 수 있다는 점에 유의하세요. SCTP,TCP\(MUST\)

```text
   -------------------------template ends here-----------------------
```

---
# **Appendix B.  NAPTR Example**

예를 들어, aaa:ex.com을 확인하려는 클라이언트를 생각해 보세요. 클라이언트는 해당 도메인에 대해 NAPTR 쿼리를 수행하고 다음 NAPTR 레코드가 반환됩니다.

```text
   ;;          order pref flags service           regexp  replacement
      IN NAPTR 50   50  "s"  "AAA+D2S"           ""
      _diameter._sctp.example.com IN NAPTR 100  50  "s"  "AAA+D2T"
      ""  _aaa._tcp.example.com
```

이는 서버가 SCTP, TCP를 순서대로 지원함을 나타냅니다. 클라이언트가 SCTP를 통해 지원하는 경우 SCTP가 사용되며 \_diameter.\_sctp.ex.com의 SRV 조회에 의해 결정된 호스트를 대상으로 합니다. 해당 조회는 다음을 반환합니다.

```text
   ;;          Priority Weight Port   Target
      IN SRV  0        1      5060   server1.example.com IN SRV  0
      2      5060   server2.example.com
```

---
# **Appendix C.  Duplicate Detection**

섹션 9.4에 설명된 대로 계정 기록 중복 감지는 세션 식별자를 기반으로 합니다. 다음과 같은 다양한 이유로 중복 항목이 나타날 수 있습니다.

- 대체 서버로 장애 조치합니다. 실시간에 가까운 성능이 필요한 경우 장애 조치 임계값을 낮게 유지해야 하며 이로 인해 중복 가능성이 높아질 수 있습니다. 장애 조치는 클라이언트 또는 Diameter 에이전트 내에서 발생할 수 있습니다.

- 비휘발성 메모리에서 레코드를 보낸 후 애플리케이션 계층 ACK를 수신하고 레코드를 삭제하기 전에 클라이언트 또는 에이전트에 오류가 발생합니다. 전송될 기록입니다. 그러면 클라이언트나 에이전트가 재부팅된 후 곧 레코드가 재전송됩니다.

- RADIUS 게이트웨이에서 중복 항목이 수신되었습니다. 이후

- RADIUS의 재전송 동작은 \[RFC2865\] 내에서 정의되지 않으며, 복제 가능성은 구현에 따라 달라집니다.

- 구현 문제 및 잘못된 구성.

T 플래그는 예를 들어 대체 서버로의 장애 조치로 인해 애플리케이션 계층 재전송 이벤트를 표시하는 데 사용됩니다. Diameter 클라이언트나 에이전트가 보낸 요청 메시지에 대해서만 정의됩니다. 예를 들어, 재부팅 후 클라이언트는 재부팅이 발생하기 전에 이미 비휘발성 메모리에 계정 레코드 전송을 시도했는지 여부를 알 수 없습니다. Diameter 서버는 요청을 처리하고 중복 메시지를 감지할 때 보조 수단으로 T 플래그를 사용할 수 있습니다. 그러나 이를 수행하는 서버는 재전송된 요청 이후 첫 번째 전송된 요청이 서버에 도착하는 경우에도 중복 항목이 발견되도록 해야 합니다. 요청에 대해 서버로부터 응답이 수신되지 않고 요청이 다시 전송되는 경우에만 사용할 수 있습니다\(예: 대체 피어로의 장애 조치로 인해, 복구된 기본 피어로 인해 또는 클라이언트 응답으로 인해\). -클라이언트 또는 에이전트 재부팅 후와 같이 비휘발성 메모리에서 저장된 레코드를 전송합니다.\(MAY, MUST\)

경우에 따라 Diameter 회계 서버는 사후 처리 단계가 발생할 때까지 중복 감지 및 회계 기록 처리를 지연시킬 수 있습니다. 이때 레코드는 포함된 사용자 이름에 따라 정렬될 가능성이 높으며 이 경우 중복 제거가 쉽습니다. 다른 상황에서는 신용 한도가 부과되거나 실시간 사기 감지가 필요한 경우와 같이 실시간 중복 감지를 수행해야 할 수도 있습니다.

일반적으로 장애 조치 또는 비휘발성 저장소의 레코드 재전송으로 인한 중복 생성만 Diameter 클라이언트 또는 에이전트에 의해 안정적으로 감지될 수 있습니다. 그러한 경우 Diameter 클라이언트나 에이전트는 T 플래그를 설정하여 메시지를 중복 가능성이 있는 것으로 표시할 수 있습니다. Diameter 서버는 중복 감지를 담당하므로 중복 감지를 최적화하기 위해 T 플래그를 사용할지 여부를 선택할 수 있습니다. T 플래그는 상호 운용성에 영향을 주지 않으며 일부 서버에서는 필요하지 않을 수 있으므로 Diameter 클라이언트와 에이전트에는 T 플래그 생성이 필수이지만 Diameter 서버에서는 구현할 수 있습니다.\(MUST\)

예를 들어, 일반적으로 가장 긴 기록 네트워크 파티션 또는 장치 오류 기간\(예: 하루\) 내에 중복 항목이 나타나는 것으로 가정할 수 있습니다. 따라서 이 시간 창 내의 레코드만 역방향으로 살펴봐야 합니다. 둘째, 수신된 메시지에 T 플래그를 사용하는 것과 같은 해싱 기술이나 기타 방식을 사용하면 드문 경우를 제외하고는 이 세트에서도 전체 검색을 수행할 필요가 없도록 할 수 있습니다.

다음은 중복 요청을 감지하기 위해 서버에서 T 플래그를 사용하는 방법의 예입니다.

- Diameter 서버는 수신된 메시지의 T 플래그를 확인하여 레코드가 중복 가능성이 있는지 확인할 수 있습니다. 요청 메시지에 T 플래그가 설정된 경우 서버는 구성 가능한 복제 시간 창 내에서 앞뒤로 복제본을 검색합니다. 이는 데이터베이스 검색을 T 플래그가 설정된 레코드로 제한합니다. 잘 운영되는 네트워크에서는 네트워크 파티션 및 장치 오류가 거의 발생하지 않으므로 이 접근 방식은 중복 감지 프로세스의 실질적인 최적화를 나타냅니다. 장애 조치 중에 원본 및 중복 전송의 경로를 따라 발생하는 네트워크 지연의 차이로 인해 레코드로 표시된 T 플래그 이후에 원본 레코드가 수신될 수 있습니다. 장애 조치\(failover\) 간격이 줄어들면 이런 일이 발생할 가능성이 높아집니다. 순서가 잘못된 중복을 감지할 수 있으려면 Diameter 서버는 T 플래그로 표시된 요청에 대해 중복 검사를 수행할 때 역방향 및 순방향 시간 창을 사용해야 합니다. 예를 들어 원본 레코드가 네트워크를 종료하고 어카운팅 서버에 의해 기록되는 시간을 허용하기 위해 Diameter 서버는 종료 후 TIME\_WAIT + RECORD\_PROCESSING\_TIME 기간이 경과할 때까지 T 플래그를 설정하여 레코드 처리를 지연할 수 있습니다. 원래 운송 연결. 이 기간이 만료된 후에는 원본 레코드가 전송된 경우 수신 및 기록되었다는 상대적인 확신을 가지고 데이터베이스에 대해 T 플래그 표시된 레코드를 확인할 수 있습니다.\(MAY\)

---
# **Appendix D.  Intellectual Property Statement**

IETF는 이 문서에 설명된 기술의 구현 또는 사용과 관련이 있다고 주장될 수 있는 지적 재산권 또는 기타 권리의 유효성이나 범위 또는 그러한 권리에 따른 라이센스가 적용되거나 적용되지 않을 수 있는 범위에 대해 어떠한 입장도 취하지 않습니다. 사용 가능; 또한 그러한 권리를 확인하기 위해 어떠한 노력도 했다는 뜻도 아닙니다. 표준 트랙 및 표준 관련 문서의 권리와 관련된 IETF 절차에 대한 정보는 BCP-11에서 찾을 수 있습니다. 출판을 위해 제공되는 권리 주장의 사본 및 제공될 라이센스에 대한 보증, 또는 이 사양의 구현자 또는 사용자가 해당 독점 권리의 사용에 대한 일반 라이센스나 허가를 얻으려는 시도의 결과를 얻을 수 있습니다. IETF 사무국에서.

IETF는 이 표준을 실행하는 데 필요할 수 있는 기술에 적용될 수 있는 모든 저작권, 특허, 특허 출원 또는 기타 독점권에 관심을 가져오도록 관심 있는 당사자를 초대합니다. 해당 정보를 IETF 전무 이사에게 전달하십시오.

---
# **Authors' Addresses**

```text
   Pat R. Calhoun
   Airespace, Inc.
   110 Nortech Parkway
   San Jose, California, 95134
   USA

   Phone:  +1 408-635-2023
   Fax:  +1 408-635-2020
   EMail:  pcalhoun@airespace.com

   John Loughney
   Nokia Research Center
   Itamerenkatu 11-13
   00180 Helsinki
   Finland

   Phone:  +358 50 483 6242
   EMail:  john.Loughney@nokia.com

   Jari Arkko
   Ericsson
   02420 Jorvas
   Finland

   Phone: +358 40 5079256
   EMail: Jari.Arkko@ericsson.com

   Erik Guttman
   Sun Microsystems, Inc.
   Eichhoelzelstr. 7
   74915 Waibstadt
   Germany

   Phone:  +49 7263 911 701
   EMail:  erik.guttman@sun.com

   Glen Zorn
   Cisco Systems, Inc.
   500 108th Avenue N.E., Suite 500
   Bellevue, WA 98004
   USA

   Phone:  +1 425 438 8218
```

---
# **Full Copyright Statement**

저작권\(C\)인터넷학회\(2003\). 판권 소유.

이 문서와 그 번역본은 복사되어 타인에게 제공될 수 있으며, 이에 대해 설명하거나 설명하거나 구현을 지원하는 파생물은 어떤 종류의 제한 없이 전체적으로 또는 부분적으로 준비, 복사, 출판 및 배포될 수 있습니다. , 단, 위의 저작권 표시와 이 단락은 그러한 모든 사본 및 파생물에 포함됩니다. 그러나 이 문서 자체는 인터넷 표준 개발 목적으로 필요한 경우를 제외하고는 저작권 표시를 제거하거나 Internet Society 또는 기타 인터넷 조직에 대한 참조를 제거하는 등 어떤 식으로든 수정할 수 없습니다. 인터넷 표준 프로세스를 따르거나 영어 이외의 언어로 번역하는 데 필요한 대로 따라야 합니다.

위에서 부여된 제한된 권한은 영구적이며 Internet Society 또는 그 승계자 또는 양수인에 의해 취소되지 않습니다.

이 문서와 여기에 포함된 정보는 "있는 그대로" 제공되며 인터넷 사회 및 인터넷 공학 태스크포스는 여기에 포함된 정보의 사용이 상품성 또는 특정 목적에의 적합성에 대한 권리 또는 묵시적 보증을 침해하는 행위.

---
# **Acknowledgement**

RFC 편집기 기능에 대한 자금은 현재 Internet Society에서 제공하고 있습니다.