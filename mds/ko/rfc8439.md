

```text
Internet Research Task Force (IRTF)                               Y. Nir
Request for Comments: 8439                                      Dell EMC
Obsoletes: 7539                                               A. Langley
Category: Informational                                     Google, Inc.
ISSN: 2070-1721                                                June 2018

                ChaCha20 and Poly1305 for IETF Protocols
```

---
# **Abstract**

мќґ л¬ём„њм—ђм„њлЉ” ChaCha20 мЉ¤нЉёл¦ј м•”нём™Ђ Poly1305 мќём¦ќмћђмќ м‚¬мљ©мќ„ лЏ…л¦Ѕн• м•Њкі л¦¬м¦кіј "кІ°н•© лЄЁл“њ" лђлЉ” AEAD\(Authenticated Encryption with Associated Data\) м•Њкі л¦¬м¦мњјлЎњ м •мќн•©л‹€л‹¤.

мќґ л¬ём„њмќ м „м‹ мќё RFC 7539лЉ” м•€м •м Ѓмќё м°ёмЎ° л°Џ кµ¬н„ к°Ђмќґл“њ м—­н• мќ„ н•кё° мњ„н•њ кІѓмћ…л‹€л‹¤. CFRG\(Crypto Forum Research Group\)мќ м њн’€мќґм—€мЉµл‹€л‹¤. мќґ л¬ём„њлЉ” RFC 7539м—ђ лЊЂн•ґ м њм¶њлђњ м •м¤н‘њлҐј лі‘н•©н•кі  ліґм•€ кі л ¤ м‚¬н•­ м„№м…м—ђ м•Ѕк°„мќ н…ЌмЉ¤нЉёлҐј м¶”к°Ђн•©л‹€л‹¤.

---
# **Status of This Memo**

мќґ л¬ём„њлЉ” мќён„°л„· н‘њм¤Ђ нЉёлћ™ м‚¬м–‘мќґ м•„л‹™л‹€л‹¤. м •ліґ м њкіµмќ лЄ©м ЃмњјлЎњ кІЊм‹њлђ©л‹€л‹¤.

мќґ л¬ём„њлЉ” IRTF\(Internet Research Task Force\)мќ м‚°л¬јмћ…л‹€л‹¤. IRTFлЉ” мќён„°л„· кґЂл Ё м—°кµ¬к°њл°њ н™њлЏ™мќ кІ°кіјлҐј л°њн‘њн•©л‹€л‹¤. мќґлџ¬н•њ кІ°кіјлЉ” л°°нЏ¬м—ђ м Ѓн•©н•м§Ђ м•Љмќ„ м€ мћ€мЉµл‹€л‹¤. мќґ RFCлЉ” IRTF\(Internet Research Task Force\)мќ Crypto Forum Research Groupмќ н•©мќлҐј л‚нѓЂлѓ…л‹€л‹¤. IRSGк°Ђ л°њн–‰н•лЏ„лЎќ мЉ№мќён•њ л¬ём„њлЉ” м–ґл–¤ м€м¤Ђмќ мќён„°л„· н‘њм¤Ђм—ђлЏ„ м Ѓн•©н•м§Ђ м•ЉмЉµл‹€л‹¤. RFC 7841мќ м„№м… 2лҐј м°ёмЎ°н•м„ёмљ”.

мќґ л¬ём„њмќ н„мћ¬ мѓЃнѓњ, м •м¤н‘њ л°Џ н”јл“њл°± м њкіµ л°©лІ•м—ђ лЊЂн•њ м •ліґлЉ” https://www.rfc-editor.org/info/rfc8439м—ђм„њ м–»мќ„ м€ мћ€мЉµл‹€л‹¤.

---
# **Copyright Notice**

Copyright \(c\) 2018 IETF Trust л°Џ л¬ём„њ мћ‘м„±мћђлЎњ м‹ќлі„лђњ м‚¬лћЊ. нЊђк¶Њ м†Њмњ .

мќґ л¬ём„њм—ђлЉ” мќґ л¬ём„њ л°њн–‰мќјм—ђ мњ нљЁн•њ BCP 78 л°Џ IETF л¬ём„њм™Ђ кґЂл Ёлђњ IETF Trustмќ лІ•м Ѓ мЎ°н•­\(https://trustee.ietf.org/license-info\)мќґ м Ѓмљ©лђ©л‹€л‹¤. мќґ л¬ём„њм—ђ кґЂн•њ к·Ђн•мќ к¶Њл¦¬м™Ђ м њн•њ м‚¬н•­мќґ м„¤лЄ…лђм–ґ мћ€мњјлЇЂлЎњ мќґ л¬ём„њлҐј мЈјмќ к№ЉкІЊ кІЂн† н•м‹­м‹њм¤.

---
# **Table of Contents**

```text
   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   4
     1.1.  Conventions Used in This Document . . . . . . . . . . . .   5
   2.  The Algorithms  . . . . . . . . . . . . . . . . . . . . . . .   5
     2.1.  The ChaCha Quarter Round  . . . . . . . . . . . . . . . .   5
       2.1.1.  Test Vector for the ChaCha Quarter Round  . . . . . .   6
     2.2.  A Quarter Round on the ChaCha State . . . . . . . . . . .   6
       2.2.1.  Test Vector for the Quarter Round on the ChaCha State   7
     2.3.  The ChaCha20 Block Function . . . . . . . . . . . . . . .   7
       2.3.1.  The ChaCha20 Block Function in Pseudocode . . . . . .   9
       2.3.2.  Test Vector for the ChaCha20 Block Function . . . . .  10
     2.4.  The ChaCha20 Encryption Algorithm . . . . . . . . . . . .  11
       2.4.1.  The ChaCha20 Encryption Algorithm in Pseudocode . . .  12
       2.4.2.  Example and Test Vector for the ChaCha20 Cipher . . .  12
     2.5.  The Poly1305 Algorithm  . . . . . . . . . . . . . . . . .  14
       2.5.1.  The Poly1305 Algorithms in Pseudocode . . . . . . . .  16
       2.5.2.  Poly1305 Example and Test Vector  . . . . . . . . . .  17
     2.6.  Generating the Poly1305 Key Using ChaCha20  . . . . . . .  18
       2.6.1.  Poly1305 Key Generation in Pseudocode . . . . . . . .  19
       2.6.2.  Poly1305 Key Generation Test Vector . . . . . . . . .  19
     2.7.  A Pseudorandom Function for Crypto Suites Based on
           ChaCha/Poly1305 . . . . . . . . . . . . . . . . . . . . .  20
     2.8.  AEAD Construction . . . . . . . . . . . . . . . . . . . .  20
       2.8.1.  Pseudocode for the AEAD Construction  . . . . . . . .  23
       2.8.2.  Example and Test Vector for AEAD_CHACHA20_POLY1305  .  23
   3.  Implementation Advice . . . . . . . . . . . . . . . . . . . .  25
   4.  Security Considerations . . . . . . . . . . . . . . . . . . .  26
   5.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .  27
   6.  References  . . . . . . . . . . . . . . . . . . . . . . . . .  27
     6.1.  Normative References  . . . . . . . . . . . . . . . . . .  27
     6.2.  Informative References  . . . . . . . . . . . . . . . . .  28
   Appendix A.  Additional Test Vectors  . . . . . . . . . . . . . .  30
     A.1.  The ChaCha20 Block Functions  . . . . . . . . . . . . . .  30
     A.2.  ChaCha20 Encryption . . . . . . . . . . . . . . . . . . .  33
     A.3.  Poly1305 Message Authentication Code  . . . . . . . . . .  36
     A.4.  Poly1305 Key Generation Using ChaCha20  . . . . . . . . .  41
     A.5.  ChaCha20-Poly1305 AEAD Decryption . . . . . . . . . . . .  42
   Appendix B.  Performance Measurements of ChaCha20 . . . . . . . .  45
   Acknowledgements  . . . . . . . . . . . . . . . . . . . . . . . .  46
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  46
```

---
## **1.  Introduction**

кі кё‰ м•”нён™” н‘њм¤Ђ\(AES -- \[FIPS-197\]\)мќЂ м•”нён™”мќ н‘њм¤Ђмќґ лђм—€мЉµл‹€л‹¤. нљЁмњЁм Ѓмќё м„¤кі„, кґ‘лІ”мњ„н•њ кµ¬н„ л°Џ н•л“њм›Ём–ґ м§Ђм›ђмќ„ н†µн•ґ л‹¤м–‘н•њ мЃм—­м—ђм„њ л†’мќЂ м„±лЉҐмќ„ л°њнњн•  м€ мћ€мЉµл‹€л‹¤. лЊЂл¶Ђл¶„мќ мµњм‹  н”Њлћ«нЏјм—ђм„њ AESлЉ” мќґм „м—ђ к°ЂмћҐ л§Ћмќґ м‚¬мљ©лђњ м•”нёмќё Triple Data Encryption Standard\(3DES -- \[SP800-67\]\)ліґл‹¤ 4л°°м—ђм„њ 10л°° м •лЏ„ л№ л¦…л‹€л‹¤. м‹¤мљ©м Ѓмќё м„ нѓќ.

м—¬кё°м—ђлЉ” лЄ‡ к°Ђм§Ђ л¬ём њк°Ђ мћ€мЉµл‹€л‹¤. н–Ґн›„ м•”нё л¶„м„ќмќ л°њм „мњјлЎњ мќён•ґ AESмќ м•Ѕм ђмќґ л“њлџ¬л‚  кІЅмљ° м‚¬мљ©мћђлЉ” л¶€л¦¬н•њ мњ„м№м—ђ л†“мќґкІЊ лђ  кІѓмћ…л‹€л‹¤. л„ђл¦¬ м§Ђм›ђлђлЉ” мњ мќјн•њ м•”нёлЉ” н›Ём”¬ лЉђл¦° 3DESмќґлЇЂлЎњ 3DESлҐј м‚¬мљ©н•лЏ„лЎќ л°°нЏ¬лҐј мћ¬кµ¬м„±н•лЉ” кІѓмќЂ л¶€к°ЂлЉҐн•©л‹€л‹¤. \[Standby-Cipher\]м—ђм„њлЉ” мќґ л¬ём њм™Ђ лЊЂкё° м•”нёмќ н•„мљ”м„±м—ђ лЊЂн•ґ лЌ” мћђм„ёнћ€ м„¤лЄ…н•©л‹€л‹¤. лђ л‹¤лҐё л¬ём њлЉ” AESк°Ђ м „мљ© н•л“њм›Ём–ґм—ђм„њлЉ” л§¤мљ° л№ лҐґм§Ђл§Њ мќґлџ¬н•њ н•л“њм›Ём–ґк°Ђ м—†лЉ” н”Њлћ«нЏјм—ђм„њлЉ” м„±лЉҐмќґ мѓЃл‹№нћ€ л‚®л‹¤лЉ” кІѓмћ…л‹€л‹¤. лђ л‹¤лҐё л¬ём њлЉ” л§ЋмќЂ AES кµ¬н„мќґ мєђм‹њ м¶©лЏЊ нѓЂмќґл°Ќ кіµкІ©\(\[Cache-Collisions\]\)м—ђ м·Ём•Ѕн•л‹¤лЉ” кІѓмћ…л‹€л‹¤.

мќґ л¬ём„њлЉ” м„ё к°Ђм§Ђ м•Њкі л¦¬м¦м—ђ лЊЂн•њ м •мќ л°Џ кµ¬н„ к°Ђмќґл“њлҐј м њкіµн•©л‹€л‹¤.

1. ChaCha20 м•”нё. \[ChaCha\]м—ђм„њ мµњмґ€лЎњ кё°м€ лђњ кі м†Ќм•”нёмќґл‹¤. м†Њн”„нЉём›Ём–ґ м „мљ© кµ¬н„м—ђм„њлЉ” AESліґл‹¤ мѓЃл‹№нћ€ л№ лҐґлЇЂлЎњ нЉ№м€ AES н•л“њм›Ём–ґк°Ђ м—†лЉ” н”Њлћ«нЏјм—ђм„њлЉ” м•Ѕ 3л°° лЌ” л№ л¦…л‹€л‹¤. лЄ‡ к°Ђм§Ђ кµ¬мІґм Ѓмќё м€м№лЉ” л¶ЂлЎќ BлҐј м°ёмЎ°н•м„ёмљ”. ChaCha20мќЂ лђн•њ нѓЂмќґл°Ќ кіµкІ©м—ђ лЇјк°ђн•м§Ђ м•ЉмЉµл‹€л‹¤\(м„№м… 4мќ ліґм•€ кі л ¤ м‚¬н•­ м°ёмЎ°\). мќґ м•Њкі л¦¬м¦мќЂ м„№м… 2.4м—ђ м„¤лЄ…лђм–ґ мћ€мЉµл‹€л‹¤.

1. Poly1305 мќём¦ќмћђ. кі м†Ќ л©”м‹њм§Ђ мќём¦ќ мЅ”л“њмћ…л‹€л‹¤. кµ¬н„лЏ„ к°„л‹Ён•кі  м¬л°”лҐґкІЊ м€н–‰н•кё° м‰ЅмЉµл‹€л‹¤. м•Њкі л¦¬м¦мќЂ м„№м… 2.5м—ђ м„¤лЄ…лђм–ґ мћ€мЉµл‹€л‹¤.

1. м„№м… 2.8м—ђ м„¤лЄ…лђњ CHACHA20-POLY1305 AEAD\(Authenticated Encryption with Associated Data\) кµ¬м„±.

мќґ л¬ём„њм™Ђ мќґм „ л¬ём„њм—ђм„њлЉ” мќґлџ¬н•њ мѓ€лЎњмљґ м•Њкі л¦¬м¦мќ„ мІмќЊмњјлЎњ м†Њк°њн•м§Ђ м•ЉмЉµл‹€л‹¤. мќґлЉ” D. J. Bernstein \[ChaCha\]\[Poly1305\]мќ кіјн•™ л…јл¬ём—ђм„њ м •мќлђм—€мЉµл‹€л‹¤. мќґ л¬ём„њмќ лЄ©м ЃмќЂ мќґлџ¬н•њ м•Њкі л¦¬м¦мќ„ м‚¬мљ©н•лЉ” IETF л¬ём„њм—ђ лЊЂн•њ м•€м •м Ѓмќё м°ёмЎ° м—­н• мќ„ н•лЉ” кІѓмћ…л‹€л‹¤.

мќґлџ¬н•њ м•Њкі л¦¬м¦мќЂ м—„кІ©н•њ л¶„м„ќмќ„ к±°мі¤мЉµл‹€л‹¤. м—¬лџ¬ л…јл¬ём—ђм„њ Salsa л°Џ ChaChaмќ ліґм•€м—ђ лЊЂн•ґ л…јмќн•©л‹€л‹¤\(\[LatinDances\], \[LatinDances2\], \[Zhenqing2012\]\).

мќґ л¬ём„њлЉ” CFRG\(Crypto Forum Research Group\)мќ н•©мќлҐј л‚нѓЂлѓ…л‹€л‹¤. мќґлЉ” \[RFC7539\]лҐј лЊЂмІґн•©л‹€л‹¤.

---
### **1.1.  Conventions Used in This Document**

н•µм‹¬ л‹Ём–ґ "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY" л°Џ "OPTIONAL мќґ л¬ём„њмќ "лЉ” м—¬кё°м—ђ н‘њм‹њлђњ лЊЂлЎњ лЄЁл‘ђ лЊЂл¬ёмћђлЎњ н‘њм‹њлђлЉ” кІЅмљ°м—ђл§Њ BCP 14 \[RFC2119\] \[RFC8174\]м—ђ м„¤лЄ…лђњ лЊЂлЎњ н•ґм„ќлђ©л‹€л‹¤.

ChaCha м•Њкі л¦¬м¦м—ђ лЊЂн•њ м„¤лЄ…м—ђм„њлЉ” ChaCha мѓЃнѓњлҐј "лІЎн„°" лђлЉ” "н–‰л ¬"лЎњ м§Ђм№­н•лЉ” кІЅмљ°к°Ђ л§ЋмЉµл‹€л‹¤. мќґлЉ” \[ChaCha\]м—ђм„њ мќґлџ¬н•њ мљ©м–ґмќ м‚¬мљ©мќ„ л”°л¦…л‹€л‹¤. н–‰л ¬ н‘њкё°лІ•мќЂ м‹њк°Ѓм ЃмњјлЎњ лЌ” нЋёл¦¬н•л©° мќјл¶Ђ лќјмљґл“њлҐј "м—ґ лќјмљґл“њ"лќјкі  л¶ЂлҐґлЉ” л°л©ґ л‹¤лҐё лќјмљґл“њлЉ” "лЊЂк°Ѓм„  лќјмљґл“њ"лќјкі  л¶ЂлҐґлЉ” мќґмњ м—ђ лЊЂн•ґ лЌ” л‚мќЂ к°њл…ђмќ„ м њкіµн•©л‹€л‹¤. л‹¤мќЊмќЂ н–‰л ¬мќґ лІЎн„°м™Ђ м–ґл–»кІЊ кґЂл ЁлђлЉ”м§Ђ ліґм—¬мЈјлЉ” л‹¤мќґм–ґк·ёлћЁмћ…л‹€л‹¤\(мќёлЌ±мЉ¤ м›ђм ђмќ„ 0мњјлЎњ н•лЉ” C м–ём–ґ к·њм№™ м‚¬мљ©\).

```text
      0   1   2   3
      4   5   6   7
      8   9  10  11
     12  13  14  15
```

мќґ лІЎн„° лђлЉ” н–‰л ¬мќ мљ”м†ЊлЉ” 32л№„нЉё л¶Ђнё м—†лЉ” м •м€мћ…л‹€л‹¤.

м•Њкі л¦¬м¦ мќґл¦„мќЂ "ChaCha"мћ…л‹€л‹¤. "ChaCha20"мќЂ 20к°њмќ "лќјмљґл“њ"\(лђлЉ” 80к°њмќ мїјн„° лќјмљґл“њ - м„№м… 2.1 м°ёмЎ°\)к°Ђ м‚¬мљ©лђлЉ” нЉ№м • мќёмЉ¤н„ґмЉ¤мћ…л‹€л‹¤. 8лќјмљґл“њ лђлЉ” 12лќјмљґл“њлЎњ л‹¤лҐё ліЂн•мќґ м •мќлђм–ґ мћ€м§Ђл§Њ мќґ л¬ём„њм—ђм„њлЉ” 20лќјмљґл“њ ChaChaл§Њ м„¤лЄ…н•лЇЂлЎњ "ChaCha"м™Ђ "ChaCha20"мќґлќјлЉ” мќґл¦„мќЂ к°™мќЂ мќлЇёлЎњ м‚¬мљ©лђ©л‹€л‹¤.

---
## **2.  The Algorithms**

м•„лћ н•мњ„ м„№м…м—ђм„њлЉ” м‚¬мљ©лђњ м•Њкі л¦¬м¦кіј AEAD кµ¬м„±мќ„ м„¤лЄ…н•©л‹€л‹¤.

---
### **2.1.  The ChaCha Quarter Round**

ChaCha м•Њкі л¦¬м¦мќ кё°ліё м—°м‚°мќЂ 1/4 лќјмљґл“њмћ…л‹€л‹¤. мќґлЉ” a, b, c л°Џ dлЎњ н‘њм‹њлђњ 4к°њмќ 32л№„нЉё л¶Ђнё м—†лЉ” м •м€м—ђ лЊЂн•ґ мћ‘лЏ™н•©л‹€л‹¤. мћ‘м—…мќЂ л‹¤мќЊкіј к°™мЉµл‹€л‹¤\(Cм™Ђ мњ м‚¬н•њ н‘њкё°лІ•\).

- a += b; d ^= a; d <<<= 16; c += d; b ^= c; b <<<= 12; a += b; d ^= a; d <<<= 8; c += d; b ^= c; b <<<= 7;

м—¬кё°м„њ "+"лЉ” 2^32 лЄЁл“€лЎњ м •м€ лЌ§м…€мќ„ л‚нѓЂл‚ґкі , "^"мќЂ л№„нЉёлі„ л°°нѓЂм Ѓ OR\(XOR\)мќ„ л‚нѓЂл‚ґкі , "<<< n"мќЂ nл№„нЉё м™јмЄЅ лЎ¤\(мѓЃмњ„ л№„нЉё мЄЅмњјлЎњ\)мќ„ л‚нѓЂлѓ…л‹€л‹¤.

м€лҐј л“¤м–ґ мѓн”Њ лІ€нёк°Ђ нЏ¬н•Ёлђњ л„¤ лІ€м§ё м¤„мќ м¶”к°Ђ, XOR л°Џ лЎ¤ мћ‘м—…мќ„ м‚ґнЋґліґкІ мЉµл‹€л‹¤.

- a = 0x11111111 b = 0x01020304 c = 0x77777777 d = 0x01234567 c = c + d = 0x77777777 + 0x01234567 = 0x789abcde b = b ^ c = 0x01020304 ^ 0x789abcde = 0x7 998bfda b = b <<< 7 = 0x7998bfda <<< 7 = 0xcc5fed3c

---
#### **2.1.1.  Test Vector for the ChaCha Quarter Round**

н…ЊмЉ¤нЉё лІЎн„°мќ кІЅмљ° м€м њм™Ђ лЏ™мќјн•њ м€«мћђлҐј м‚¬мљ©н•м—¬ cм—ђ мћ„мќмќ кІѓмќ„ м¶”к°Ђн•©л‹€л‹¤.

- a = 0x11111111 b = 0x01020304 c = 0x9b8d6f43 d = 0x01234567

мќґ 4к°њмќ м€«мћђм—ђ лЊЂн•ґ л¶„кё° лќјмљґл“њлҐј м‹¤н–‰н•њ н›„ л‹¤мќЊмќ„ м–»мЉµл‹€л‹¤.

- a = 0xea2a92f4 b = 0xcb1cf8ce c = 0x4581472e d = 0x5881c4bb

---
### **2.2.  A Quarter Round on the ChaCha State**

ChaCha мѓЃнѓњм—ђлЉ” 4к°њмќ м •м€к°Ђ м—†мЉµл‹€л‹¤. м¦‰ 16к°њк°Ђ мћ€мЉµл‹€л‹¤. л”°лќјм„њ 1/4 л°м¬л¦ј м—°м‚°мќЂ к·ё м¤‘ 4к°њм—ђм„њл§Њ мћ‘лЏ™н•©л‹€л‹¤. л”°лќјм„њ мќґл¦„мќґ л¶™м—¬мЎЊмЉµл‹€л‹¤. к°Ѓ л¶„кё° лќјмљґл“њлЉ” ChaCha мѓЃнѓњм—ђм„њ лЇёл¦¬ кІ°м •лђњ 4к°њмќ м€«мћђм—ђ лЊЂн•ґ мћ‘лЏ™лђ©л‹€л‹¤. лІЎн„°лЎњ ліј л•Њ ChaCha мѓЃнѓњмќ мќёлЌ±мЉ¤ x, y, z л°Џ wм—ђ мћ€лЉ” м€«мћђм—ђ лЊЂн•њ 1/4 л°м¬л¦ј м—°м‚°мќ„ QUARTERROUND\(x, y, z, w\)лЎњ н‘њм‹њн•©л‹€л‹¤. м€лҐј л“¤м–ґ, QUARTERROUND\(1, 5, 9, 13\)мќ„ мѓЃнѓњм—ђ м Ѓмљ©н•л©ґ лі„н‘њк°Ђ н‘њм‹њлђњ мљ”м†Њм—ђ лЊЂн•ґ 1/4 лќјмљґл“њ м—°м‚°мќ„ м‹¤н–‰н•кі  л‹¤лҐё мљ”м†ЊлЉ” к·ёлЊЂлЎњ л‘ђлЉ” кІѓмќ„ мќлЇён•©л‹€л‹¤.

```text
      0  *a   2   3
      4  *b   6   7
      8  *c  10  11
     12  *d  14  15
```

мќґ 1/4 лќјмљґл“њ м‹¤н–‰мќЂ "м»¬лџј лќјмљґл“њ"лќјкі  л¶€л¦¬лЉ” кІѓмќ мќјл¶Ђмћ…л‹€л‹¤.

---
#### **2.2.1.  Test Vector for the Quarter Round on the ChaCha State**

н…ЊмЉ¤нЉё лІЎн„°мќ кІЅмљ° л¬ґмћ‘мњ„лЎњ мѓќм„±лђњ ChaCha мѓЃнѓњлҐј м‚¬мљ©н•©л‹€л‹¤.

```text
   Sample ChaCha State

       879531e0  c5ecf37d  516461b1  c9a62f8a
       44c20ef3  3390af7f  d9fc690b  2a5f714c
       53372767  b00a5631  974c541a  359e9963
       5c971061  3d631689  2098d9d6  91dbd320
```

мќґ мѓЃнѓњм—ђ QUARTERROUND\(2, 7, 8, 13\) м—°м‚°мќ„ м Ѓмљ©н•кІ мЉµл‹€л‹¤. л¶„лЄ…н•њ мќґмњ лЎњ мќґкІѓмќЂ "лЊЂк°Ѓм„  лќјмљґл“њ"лќјкі  л¶€л¦¬лЉ” кІѓмќ мќјл¶Ђмћ…л‹€л‹¤.

QUARTERROUND\(2, 7, 8, 13\) м Ѓмљ© н›„

```text
       879531e0  c5ecf37d *bdb886dc  c9a62f8a
       44c20ef3  3390af7f  d9fc690b *cfacafd2
      *e46bea80  b00a5631  974c541a  359e9963
       5c971061 *ccc07c79  2098d9d6  91dbd320
```

мњ„м№ 2, 7, 8, 13мќ м€«мћђл§Њ ліЂкІЅлђм—€мЉµл‹€л‹¤.

---
### **2.3.  The ChaCha20 Block Function**

ChaCha лё”лЎќ кё°лЉҐмќЂ м—¬лџ¬ л¶„кё° лќјмљґл“њлҐј м‹¤н–‰н•м—¬ ChaCha мѓЃнѓњлҐј ліЂн™н•©л‹€л‹¤.

ChaCha20м—ђ лЊЂн•њ мћ…л ҐмќЂ л‹¤мќЊкіј к°™мЉµл‹€л‹¤.

- 8к°њмќ 32л№„нЉё л¦¬н‹Ђ м—”л””м•€ м •м€ м—°кІ°лЎњ мІл¦¬лђлЉ” 256л№„нЉё н‚¤мћ…л‹€л‹¤.

- 32л№„нЉё л¦¬н‹Ђ м—”л””м•€ м •м€ 3к°њмќ м—°кІ°лЎњ мІл¦¬лђлЉ” 96л№„нЉё nonceмћ…л‹€л‹¤.

- 32л№„нЉё лё”лЎќ м€ л§¤к°њліЂм€лЉ” 32л№„нЉё л¦¬н‹Ђ м—”л””м•€ м •м€лЎњ мІл¦¬лђ©л‹€л‹¤.

м¶њл ҐмќЂ л¬ґмћ‘мњ„лЎњ ліґмќґлЉ” 64л°”мќґнЉёмћ…л‹€л‹¤.

м—¬кё°м—ђ м„¤лЄ…лђњ ChaCha м•Њкі л¦¬м¦мќЂ 256л№„нЉё н‚¤лҐј м‚¬мљ©н•©л‹€л‹¤. м›ђлћ м•Њкі л¦¬м¦мќЂ 128л№„нЉё н‚¤м™Ђ 8лќјмљґл“њ л°Џ 12лќјмљґл“њ ліЂн•лЏ„ м§Ђм •н–€м§Ђл§Њ мќґлЉ” мќґ л¬ём„њмќ лІ”мњ„лҐј лІ—м–ґл‚©л‹€л‹¤. мќґлІ€ мћҐм—ђм„њлЉ” ChaCha лё”лЎќ кё°лЉҐм—ђ лЊЂн•ґ м„¤лЄ…н•©л‹€л‹¤.

лђн•њ м›ђліё ChaChaм—ђлЉ” 64л№„нЉё nonceм™Ђ 64л№„нЉё лё”лЎќ м€к°Ђ мћ€м—€мЉµл‹€л‹¤. мљ°л¦¬лЉ” \[RFC5116\] м„№м… 3.2мќ к¶ЊмћҐ м‚¬н•­кіј лЌ”мљ± мќјм№н•лЏ„лЎќ мќґлҐј м€м •н–€мЉµл‹€л‹¤. мќґлЉ” л‹Ёмќј \(key,nonce\) мЎ°н•©мќ м‚¬мљ©мќ„ 2^32 лё”лЎќ лђлЉ” 256GBлЎњ м њн•њн•м§Ђл§Њ лЊЂл¶Ђл¶„мќ мљ©лЏ„м—ђлЉ” м¶©л¶„н•©л‹€л‹¤. м—¬лџ¬ л°њм‹ мћђк°Ђ л‹Ёмќј н‚¤лҐј м‚¬мљ©н•лЉ” кІЅмљ° лЏ™мќјн•њ nonceлҐј м‚¬мљ©н•м§Ђ м•ЉлЉ”м§Ђ н™•мќён•лЉ” кІѓмќґ м¤‘мљ”н•©л‹€л‹¤. мІмќЊ 32л№„нЉёлЉ” л°њм‹ мћђлі„лЎњ кі мњ н•кі  л‚лЁём§Ђ 64л№„нЉёлЉ” м№ґмљґн„°м—ђм„њ л‚м¤лЏ„лЎќ nonce кіµк°„мќ„ л¶„н• н•л©ґ мќґлҐј ліґмћҐн•  м€ мћ€мЉµл‹€л‹¤.

ChaCha20 мѓЃнѓњлЉ” л‹¤мќЊкіј к°™мќґ мґ€кё°н™”лђ©л‹€л‹¤.

- мІмќЊ 4к°њ л‹Ём–ґ\(0-3\)лЉ” мѓЃм€мћ…л‹€л‹¤: 0x61707865, 0x3320646e, 0x79622d32, 0x6b206574.

- л‹¤мќЊ 8к°њ л‹Ём–ґ\(4-11\)лЉ” 4л°”мќґнЉё мІ­нЃ¬мќ л¦¬н‹Ђ м—”л””м•€ м€њм„њлЎњ л°”мќґнЉёлҐј мќЅм–ґ 256л№„нЉё н‚¤м—ђм„њ к°Ђм ёмµл‹€л‹¤.

- м›Њл“њ 12лЉ” лё”лЎќ м№ґмљґн„°мћ…л‹€л‹¤. к°Ѓ лё”лЎќмќЂ 64л°”мќґнЉёмќґлЇЂлЎњ 32л№„нЉё м›Њл“њмќґл©ґ 256GBмќ лЌ°мќґн„°м—ђ м¶©л¶„н•©л‹€л‹¤.

- л‹Ём–ґ 13-15лЉ” nonceмќґлЇЂлЎњ лЏ™мќјн•њ н‚¤м—ђ лЊЂн•ґ л°ліµлђм–ґм„њлЉ” м•€ лђ©л‹€л‹¤. 13лІ€м§ё л‹Ём–ґлЉ” л¦¬н‹Ђ м—”л””м•€ м •м€лЎњ к°„мЈјлђлЉ” мћ…л Ґ л„ЊмЉ¤мќ мІмќЊ 32л№„нЉёмќґкі , 15лІ€м§ё л‹Ём–ґлЉ” л§€м§Ђл§‰ 32л№„нЉёмћ…л‹€л‹¤.

```text
       cccccccc  cccccccc  cccccccc  cccccccc
       kkkkkkkk  kkkkkkkk  kkkkkkkk  kkkkkkkk
       kkkkkkkk  kkkkkkkk  kkkkkkkk  kkkkkkkk
       bbbbbbbb  nnnnnnnn  nnnnnnnn  nnnnnnnn

   c=constant k=key b=blockcount n=nonce
```

ChaCha20мќЂ "кё°л‘Ґ лќјмљґл“њ"м™Ђ "лЊЂк°Ѓм„  лќјмљґл“њ"лҐј лІ€к°€м•„ к°Ђл©° 20лќјмљґл“њлҐј м‹¤н–‰н•©л‹€л‹¤. к°Ѓ лќјмљґл“њлЉ” 4к°њмќ мїјн„°лќјмљґл“њлЎњ кµ¬м„±лђл©°, л‹¤мќЊкіј к°™мќґ м§„н–‰лђ©л‹€л‹¤. мїјн„° лќјмљґл“њ 1-4лЉ” "м—ґ" лќјмљґл“њмќ мќјл¶Ђмќґкі , 5-8мќЂ "лЊЂк°Ѓм„ " лќјмљґл“њмќ мќјл¶Ђмћ…л‹€л‹¤.

```text
      QUARTERROUND(0, 4, 8, 12)
      QUARTERROUND(1, 5, 9, 13)
      QUARTERROUND(2, 6, 10, 14)
      QUARTERROUND(3, 7, 11, 15)
      QUARTERROUND(0, 5, 10, 15)
      QUARTERROUND(1, 6, 11, 12)
      QUARTERROUND(2, 7, 8, 13)
      QUARTERROUND(3, 4, 9, 14)
```

20нљЊ лќјмљґл“њ\(лђлЉ” мњ„ лЄ©лЎќмќ 10нљЊ л°ліµ\)к°Ђ лЃќл‚л©ґ м›ђлћ мћ…л Ґ л‹Ём–ґлҐј м¶њл Ґ л‹Ём–ґм—ђ м¶”к°Ђн•кі  л‹Ём–ґлҐј л¦¬н‹Ђ м—”л””м•€ м€њм„њлЎњ н•л‚м”© м‹њнЂЂм‹±н•м—¬ кІ°кіјлҐј м§Ѓл ¬н™”н•©л‹€л‹¤.

м°ёкі : мњ„ л‹ЁлќЅмќ "лЌ§м…€"мќЂ лЄЁл“€лЎњ 2^32лЎњ м€н–‰лђ©л‹€л‹¤. мќјл¶Ђ кё°кі„м–ґм—ђм„њлЉ” мќґлҐј 32л№„нЉё л‹Ём–ґм—ђ лЊЂн•њ мєђл¦¬л¦¬мЉ¤ м¶”к°Ђлќјкі  н•©л‹€л‹¤.

---
#### **2.3.1.  The ChaCha20 Block Function in Pseudocode**

м°ёкі : мќґ м„№м…кіј л‹¤лҐё м„№м…м—ђлЉ” мќґм „ м„№м…м—ђм„њ м„¤лЄ…н•њ м•Њкі л¦¬м¦м—ђ лЊЂн•њ мќм‚¬ мЅ”л“њк°Ђ нЏ¬н•Ёлђм–ґ мћ€мЉµл‹€л‹¤. мќм‚¬мЅ”л“њк°Ђ мќґм „ м„№м…м—ђм„њ м„¤лЄ…н•њ м•Њкі л¦¬м¦мќ„ м •н™•н•кІЊ л°мЃн•кё° мњ„н•ґ лЄЁл“  л…ёл Ґмќ„ кё°мљёмЂмЉµл‹€л‹¤. м¶©лЏЊмќґ м—¬м „нћ€ мЎґмћ¬н•лЉ” кІЅмљ° н…ЌмЉ¤нЉё м„¤лЄ…кіј н…ЊмЉ¤нЉё лІЎн„°к°Ђ к·њлІ”м Ѓмћ…л‹€л‹¤.

```text
      inner_block (state):
         Qround(state, 0, 4, 8, 12)
         Qround(state, 1, 5, 9, 13)
         Qround(state, 2, 6, 10, 14)
         Qround(state, 3, 7, 11, 15)
         Qround(state, 0, 5, 10, 15)
         Qround(state, 1, 6, 11, 12)
         Qround(state, 2, 7, 8, 13)
         Qround(state, 3, 4, 9, 14)
         end

      chacha20_block(key, counter, nonce):
         state = constants | key | counter | nonce
         initial_state = state
         for i=1 upto 10
            inner_block(state)
            end
         state += initial_state
         return serialize(state)
         end
```

м—¬кё°м„њ нЊЊмќґн”„ л¬ёмћђ\("|"\)лЉ” м—°кІ°мќ„ л‚нѓЂлѓ…л‹€л‹¤.

---
#### **2.3.2.  Test Vector for the ChaCha20 Block Function**

н…ЊмЉ¤нЉё лІЎн„°мќ кІЅмљ° ChaCha20 лё”лЎќ кё°лЉҐм—ђ л‹¤мќЊ мћ…л Ґмќ„ м‚¬мљ©н•©л‹€л‹¤.

- н‚¤ = 00:01:02:03:04:05:06:07:08:09:0a:0b:0c:0d:0e:0f:10:11:12:13:14:15:16:17 :18:19:1a:1b:1c:1d:1e:1f. н‚¤лЉ” ChaCha мѓЃнѓњм—ђ ліµм‚¬н•кё° м „м—ђ нЉ№лі„н•њ кµ¬мЎ°к°Ђ м—†лЉ” мќјл Ёмќ мҐн…џмћ…л‹€л‹¤.

```text
   o  Nonce = (00:00:00:09:00:00:00:4a:00:00:00:00)

   o  Block Count = 1.
```

ChaCha мѓЃнѓњлҐј м„¤м •н•њ н›„мќ лЄЁмЉµмќЂ л‹¤мќЊкіј к°™мЉµл‹€л‹¤.

н‚¤ м„¤м •мќґ м™„лЈЊлђњ м°Ём°Ё мѓЃнѓњмћ…л‹€л‹¤.

```text
       61707865  3320646e  79622d32  6b206574
       03020100  07060504  0b0a0908  0f0e0d0c
       13121110  17161514  1b1a1918  1f1e1d1c
       00000001  09000000  4a000000  00000000
```

20к°њмќ лќјмљґл“њ\(10к°њмќ "лЊЂк°Ѓм„  лќјмљґл“њ"лЎњ мќён„°л¦¬лёЊлђњ 10к°њмќ м—ґ лќјмљґл“њ\)лҐј м‹¤н–‰н•њ н›„ ChaCha мѓЃнѓњлЉ” л‹¤мќЊкіј к°™мЉµл‹€л‹¤.

20лќјмљґл“њ н›„ м°Ём°Ё мѓЃнѓњ

```text
       837778ab  e238d763  a67ae21e  5950bb2f
       c4f2d0c7  fc62bb2f  8fa018fc  3f5ec7b7
       335271c2  f29489f3  eabda8fc  82e46ebd
       d19c12b4  b04e16de  9e83d0cb  4e3c50a2
```

л§€м§Ђл§‰мњјлЎњ м›ђлћ мѓЃнѓњлҐј кІ°кіј\(л‹Ём€њ лІЎн„° лђлЉ” н–‰л ¬ м¶”к°Ђ\)м—ђ м¶”к°Ђн•м—¬ л‹¤мќЊмќ„ м њкіµн•©л‹€л‹¤.

ChaCha20 мћ‘м—… мў…лЈЊ м‹њ ChaCha мѓЃнѓњ

```text
       e4e7f110  15593bd1  1fdd0f50  c47120a3
       c7f4d1c7  0368c033  9aaa2204  4e6cd4c3
       466482d2  09aa9f07  05d7c214  a2028bd9
       d19c12b5  b94e16de  e883d0cb  4e3c50a2
```

мѓЃнѓњлҐј м§Ѓл ¬н™”н•њ н›„м—ђлЉ” л‹¤мќЊмќ„ м–»мЉµл‹€л‹¤.

```text
  Serialized Block:
  000  10 f1 e7 e4 d1 3b 59 15 50 0f dd 1f a3 20 71 c4  .....;Y.P.... q.
  016  c7 d1 f4 c7 33 c0 68 03 04 22 aa 9a c3 d4 6c 4e  ....3.h.."....lN
  032  d2 82 64 46 07 9f aa 09 14 c2 d7 05 d9 8b 02 a2  ..dF............
  048  b5 12 9c d1 de 16 4e b9 cb d0 83 e8 a2 50 3c 4e  ......N......P<N
```

---
### **2.4.  The ChaCha20 Encryption Algorithm**

ChaCha20мќЂ D. J. Bernsteinмќґ м„¤кі„н•њ мЉ¤нЉёл¦ј м•”нёмћ…л‹€л‹¤. мќґлЉ” Salsa20 м•Њкі л¦¬м¦мќ„ к°њм„ н•њ кІѓмќґл©° 256л№„нЉё н‚¤лҐј м‚¬мљ©н•©л‹€л‹¤.

ChaCha20мќЂ лЏ™мќјн•њ н‚¤м™Ђ nonceлҐј м‚¬мљ©н•кі  м—°м†Ќм ЃмњјлЎњ м¦ќк°Ђн•лЉ” лё”лЎќ м№ґмљґн„° л§¤к°њліЂм€лҐј м‚¬мљ©н•м—¬ ChaCha20 лё”лЎќ н•Ём€лҐј м—°м†Ќм ЃмњјлЎњ нём¶њн•©л‹€л‹¤. к·ёлџ° л‹¤мќЊ ChaCha20мќЂ л¦¬н‹Ђ м—”л””м•€ м€њм„њлЎњ м€«мћђлҐј мћ‘м„±н•м—¬ кІ°кіј мѓЃнѓњлҐј м§Ѓл ¬н™”н•кі  н‚¤мЉ¤нЉёл¦ј лё”лЎќмќ„ мѓќм„±н•©л‹€л‹¤. м—°м†Ќ лё”лЎќмќ н‚¤мЉ¤нЉёл¦ј лё”лЎќмќ„ м—°кІ°н•л©ґ н‚¤мЉ¤нЉёл¦јмќґ н•м„±лђ©л‹€л‹¤. к·ёлџ° л‹¤мќЊ ChaCha20 н•Ём€лЉ” мќґ н‚¤мЉ¤нЉёл¦јмќ„ мќјл° н…ЌмЉ¤нЉём™Ђ XORн•©л‹€л‹¤. лђлЉ” л‹¤мќЊ лё”лЎќ мѓќм„±мќ„ м§„н–‰н•кё° м „м—ђ к°Ѓ н‚¤мЉ¤нЉёл¦ј лё”лЎќмќ„ мќјл° н…ЌмЉ¤нЉё лё”лЎќкіј XORн•м—¬ мќјл¶Ђ л©”лЄЁл¦¬лҐј м €м•Ѕн•  м€ мћ€мЉµл‹€л‹¤. мќјл° н…ЌмЉ¤нЉёк°Ђ 512л№„нЉёмќ м •м€л°°к°Ђ лђм–ґм•ј н•њл‹¤лЉ” мљ”кµ¬ м‚¬н•­мќЂ м—†мЉµл‹€л‹¤. л§€м§Ђл§‰ лё”лЎќм—ђ м¶”к°Ђ н‚¤мЉ¤нЉёл¦јмќґ мћ€мњјл©ґ нЏђкё°лђ©л‹€л‹¤. нЉ№м • н”„лЎњн† мЅњм—ђм„њлЉ” мќјл° н…ЌмЉ¤нЉём™Ђ м•”нёл¬ёмќ нЉ№м • кёёмќґлҐј мљ”кµ¬н•  м€ мћ€мЉµл‹€л‹¤. мќґлџ¬н•њ н”„лЎњн† мЅњмќЂ мќјл° н…ЌмЉ¤нЉёк°Ђ м±„м›Њм§ЂлЉ” л°©м‹ќкіј л°›лЉ” нЊЁл”©мќ м–‘мќ„ м§Ђм •н•ґм•ј н•©л‹€л‹¤.

ChaCha20м—ђ лЊЂн•њ мћ…л ҐмќЂ л‹¤мќЊкіј к°™мЉµл‹€л‹¤.

- 256л№„нЉё н‚¤

- 32л№„нЉё мґ€кё° м№ґмљґн„°. мћ„мќмќ м€«мћђлЎњ м„¤м •н•  м€ мћ€м§Ђл§Њ мќјл°м ЃмњјлЎњ 0 лђлЉ” 1мћ…л‹€л‹¤. AEAD м•Њкі л¦¬м¦мќ мќјл¶ЂлЎњ мќјнљЊмљ© мќём¦ќ н‚¤лҐј мѓќм„±н•лЉ” л“± л‹¤лҐё мљ©лЏ„лЎњ м њлЎњ лё”лЎќмќ„ м‚¬мљ©н•лЉ” кІЅмљ° н•л‚лҐј м‚¬мљ©н•лЉ” кІѓмќґ н•©л¦¬м Ѓмћ…л‹€л‹¤.

- 96л№„нЉё л…јмЉ¤. мќјл¶Ђ н”„лЎњн† мЅњм—ђм„њлЉ” мќґлҐј мґ€кё°н™” лІЎн„°лќјкі  н•©л‹€л‹¤.

- мћ„мќ кёёмќґмќ мќјл° н…ЌмЉ¤нЉё

м¶њл ҐмќЂ лЏ™мќјн•њ кёёмќґмќ м•”нён™”лђњ л©”м‹њм§Ђ лђлЉ” "м•”нёл¬ё"мћ…л‹€л‹¤.

ліµнён™”лЏ„ к°™мќЂ л°©м‹ќмњјлЎњ мќґлЈЁм–ґм§‘л‹€л‹¤. ChaCha20 лё”лЎќ кё°лЉҐмќЂ н‚¤лҐј н‚¤мЉ¤нЉёл¦јмњјлЎњ н™•мћҐн•лЉ” лЌ° м‚¬мљ©лђл©°, мќґлЉ” мќјл° н…ЌмЉ¤нЉёлҐј л°н™н•лЉ” м•”нёл¬ёкіј XORлђ©л‹€л‹¤.

---
#### **2.4.1.  The ChaCha20 Encryption Algorithm in Pseudocode**

```text
     chacha20_encrypt(key, counter, nonce, plaintext):
        for j = 0 upto floor(len(plaintext)/64)-1
           key_stream = chacha20_block(key, counter+j, nonce)
           block = plaintext[(j*64)..(j*64+63)]
           encrypted_message +=  block ^ key_stream
           end
        if ((len(plaintext) % 64) != 0)
           j = floor(len(plaintext)/64)
           key_stream = chacha20_block(key, counter+j, nonce)
           block = plaintext[(j*64)..len(plaintext)-1]
           encrypted_message += (block^key_stream)[0..len(plaintext)%64]
           end
        return encrypted_message
        end
```

---
#### **2.4.2.  Example and Test Vector for the ChaCha20 Cipher**

н…ЊмЉ¤нЉё лІЎн„°мќ кІЅмљ° ChaCha20 лё”лЎќ кё°лЉҐм—ђ л‹¤мќЊ мћ…л Ґмќ„ м‚¬мљ©н•©л‹€л‹¤.

```text
   o  Key = 00:01:02:03:04:05:06:07:08:09:0a:0b:0c:0d:0e:0f:10:11:12:13:
      14:15:16:17:18:19:1a:1b:1c:1d:1e:1f.

   o  Nonce = (00:00:00:00:00:00:00:4a:00:00:00:00).

   o  Initial Counter = 1.
```

мќјл° н…ЌмЉ¤нЉём—ђлЉ” л‹¤мќЊмќ„ м‚¬мљ©н•©л‹€л‹¤. л‘ђ к°њ мќґмѓЃмќ лё”лЎќмќґ н•„мљ”н•  л§ЊнЃј кёём§Ђл§Њ мќґ м€м њлҐј лІ€к±°лЎ­кІЊ л§Њл“¤ л§ЊнЃј кёём§ЂлЉ” м•ЉлЏ„лЎќ м„ нѓќлђм—€мЉµл‹€л‹¤\(л”°лќјм„њ 3к°њ лё”лЎќ лЇёл§Њ\).

мќјл° н…ЌмЉ¤нЉё мћђм™ём„  м°Ёл‹Ём њ: 000 4c 61 64 69 65 73 20 61 6e 64 20 47 65 6e 74 6c м€™л…Ђ л°Џ м‹ м‚¬ 016 65 6d 65 6e 20 6f 66 20 74 68 65 20 63 6c 61 73 emen of the class 032 73 20 6f 66 20 27 39 39 3a 20 49 66 20 49 20 99л…„ 63мґ€: л§Њм•Ѕ л‚ґк°Ђ c 048 6f 75 6c 64 20 6f 66 66 65 72 20 79 6f 75 20 6fк°Ђ л‹№м‹ м—ђкІЊ 064 6e 6c 79 20 6f 6eлҐј м њм•€н•њл‹¤л©ґ 65 20 74 69 70 20 66 6f 72 20 080 74 68 65 20 66 75 74 75 72 65 2c 20 73 75 6e 73 лЇёлћ, нѓњм–‘м—ђ лЊЂн•њ нЊЃ н•л‚л§Њ 096 63 72 65 65 6e 20 77 6f 75 6c 64 20 62 65 20 69 нЃ¬л¦° л‚лЉ” 112 74 2e tк°Ђ лђ  кІѓмќґл‹¤.

л‹¤мќЊ к·ёл¦јмќЂ 4к°њмќ ChaCha мѓЃнѓњ л§¤нЉёл¦­мЉ¤лҐј ліґм—¬м¤Ќл‹€л‹¤.

1. м„¤м •лђњ мІ« лІ€м§ё лё”лЎќмћ…л‹€л‹¤.

1. м„¤м •лђњ л‘ђ лІ€м§ё лё”лЎќ. мќґл“¤ лё”лЎќмќЂ л‹Ём§Ђ 2л№„нЉёл§Њ л–Ём–ґм ё мћ€л‹¤лЉ” м ђм—ђ мњ мќн•м‹­м‹њм¤. м¦‰, мњ„м№ 12мќ м№ґмљґн„°л§Њ л‹¤л¦…л‹€л‹¤.

1. м„ё лІ€м§ё лё”лЎќмќЂ ChaCha20 лё”лЎќ м—°м‚°мќґ м Ѓмљ©лђњ н›„ мІ« лІ€м§ё лё”лЎќмћ…л‹€л‹¤.

1. мµњмў… лё”лЎќмќЂ ChaCha20 лё”лЎќ м—°м‚°мќґ м Ѓмљ©лђњ н›„ л‘ђ лІ€м§ё лё”лЎќмћ…л‹€л‹¤.

к·ё н›„ н‚¤мЉ¤нЉёл¦јмќ„ ліґм—¬м¤Ќл‹€л‹¤.

```text
   First block setup:
       61707865  3320646e  79622d32  6b206574
       03020100  07060504  0b0a0908  0f0e0d0c
       13121110  17161514  1b1a1918  1f1e1d1c
       00000001  00000000  4a000000  00000000

   Second block setup:
       61707865  3320646e  79622d32  6b206574
       03020100  07060504  0b0a0908  0f0e0d0c
       13121110  17161514  1b1a1918  1f1e1d1c
       00000002  00000000  4a000000  00000000
```

лё”лЎќ мћ‘м—… н›„ мІ« лІ€м§ё лё”лЎќ: - f3514f22 e1d91b40 6f27de2f ed1d63b8 821f138c e2062c3d ecca4f7e 78cff39e a30a3b8a 920a6072 cd7479b5 34932bed 40ba4c79 cd343ec6 4c2c2 b7417df0 1к°њ

лё”лЎќ мћ‘м—… н›„ л‘ђ лІ€м§ё лё”лЎќ: - 9f74a669 410f633f 28feca22 7ec44dec 6d34d426 738cb970 3ac5e9f3 45590cc4 da6e8b39 892c831a cdea67c1 2b7e1d90 037463f3 a11a2073 e8b cfb88 edc49139

```text
   Keystream:
   22:4f:51:f3:40:1b:d9:e1:2f:de:27:6f:b8:63:1d:ed:8c:13:1f:82:3d:2c:06
   e2:7e:4f:ca:ec:9e:f3:cf:78:8a:3b:0a:a3:72:60:0a:92:b5:79:74:cd:ed:2b
   93:34:79:4c:ba:40:c6:3e:34:cd:ea:21:2c:4c:f0:7d:41:b7:69:a6:74:9f:3f
   63:0f:41:22:ca:fe:28:ec:4d:c4:7e:26:d4:34:6d:70:b9:8c:73:f3:e9:c5:3a
   c4:0c:59:45:39:8b:6e:da:1a:83:2c:89:c1:67:ea:cd:90:1d:7e:2b:f3:63
```
лл§€м§Ђл§‰мњјлЎњ н‚¤мЉ¤нЉёл¦јмќ„ мќјл° н…ЌмЉ¤нЉём™Ђ XORн•м—¬ м•”нёл¬ёмќ„ мѓќм„±н•©л‹€л‹¤.

```text
  Ciphertext Sunscreen:
  000  6e 2e 35 9a 25 68 f9 80 41 ba 07 28 dd 0d 69 81  n.5.%h..A..(..i.
  016  e9 7e 7a ec 1d 43 60 c2 0a 27 af cc fd 9f ae 0b  .~z..C`..'......
  032  f9 1b 65 c5 52 47 33 ab 8f 59 3d ab cd 62 b3 57  ..e.RG3..Y=..b.W
  048  16 39 d6 24 e6 51 52 ab 8f 53 0c 35 9f 08 61 d8  .9.$.QR..S.5..a.
  064  07 ca 0d bf 50 0d 6a 61 56 a3 8e 08 8a 22 b6 5e  ....P.jaV....".^
  080  52 bc 51 4d 16 cc f8 06 81 8c e9 1a b7 79 37 36  R.QM.........y76
  096  5a f9 0b bf 74 a3 5b e6 b4 0b 8e ed f2 78 5e 42  Z...t.[......x^B
  112  87 4d                                            .M
```

---
### **2.5.  The Poly1305 Algorithm**

Poly1305лЉ” D. J. Bernsteinмќґ л””мћђмќён•њ мќјнљЊм„± мќём¦ќкё°мћ…л‹€л‹¤. Poly1305лЉ” 32л°”мќґнЉё мќјнљЊмљ© н‚¤м™Ђ л©”м‹њм§ЂлҐј к°Ђм ём™Ђ 16л°”мќґнЉё нѓњк·ёлҐј мѓќм„±н•©л‹€л‹¤. мќґ нѓњк·ёлЉ” л©”м‹њм§ЂлҐј мќём¦ќн•лЉ” лЌ° м‚¬мљ©лђ©л‹€л‹¤.

м›ђліё кё°м‚¬\(\[Poly1305\]\)мќ м њлЄ©мќЂ "Poly1305-AES л©”м‹њм§Ђ мќём¦ќ мЅ”л“њ"мќґл©°, к±°кё°мќ MAC кё°лЉҐм—ђлЉ” 128л№„нЉё AES н‚¤, 128л№„нЉё "м¶”к°Ђ н‚¤" л°Џ 128л№„нЉё\(л№„ - л№„л°Ђ\) nonce. AESлЉ” кі мњ н•њ\(к·ёл¦¬кі  л№„л°Ђ\) 128л№„нЉё л¬ёмћђм—ґмќ„ м–»кё° мњ„н•ґ nonceлҐј м•”нён™”н•лЉ” лЌ° м‚¬мљ©лђ©л‹€л‹¤. к·ёлџ¬л‚ л…јл¬ём—ђ л”°лҐґл©ґ "м—¬кё°м„њ AESм—ђлЉ” нЉ№лі„н•њ кІѓмќґ м—†мЉµл‹€л‹¤. AESлҐј мћ„мќмќ н‚¤ н•Ём€лЎњ лЊЂмІґн•  м€ мћ€мЉµл‹€л‹¤. мћ„мќмќ nonce м„ёнЉёлҐј 16л°”мќґнЉё л¬ёмћђм—ґлЎњ ліЂн™н•©л‹€л‹¤."

н‚¤ мѓќм„± л°©лІ•м—ђ кґЂкі„м—†мќґ н‚¤лЉ” "r"кіј "s"лќјлЉ” л‘ђ л¶Ђл¶„мњјлЎњ л¶„н• лђ©л‹€л‹¤. \(r,s\) мЊЌмќЂ кі мњ н•ґм•ј н•л©° к°Ѓ нём¶њм—ђ лЊЂн•ґ м€мёЎн•  м€ м—†м–ґм•ј н•©л‹€л‹¤\(мќґкІѓмќґ м›ђлћ nonceлҐј м•”нён™”н•м—¬ м–»мќЂ мќґмњ мћ…л‹€л‹¤\). л°л©ґ "r"мќЂ мѓЃм€мќј м€ мћ€м§Ђл§Њ м‚¬мљ©н•кё° м „м—ђ л‹¤мќЊкіј к°™мќґ м€м •н•ґм•ј н•©л‹€л‹¤. : \("r"мќЂ 16мҐн…џ л¦¬н‹Ђ м—”л””м•€ м€«мћђлЎњ мІл¦¬лђ©л‹€л‹¤\):

- r\[3\], r\[7\], r\[11\] л°Џ r\[15\]лЉ” мѓЃмњ„ 4л№„нЉёлҐј м§Ђм›Њм•ј н•©л‹€л‹¤\(16ліґл‹¤ мћ‘мќЊ\).

- r\[4\], r\[8\], r\[12\]лЉ” н•мњ„ 2л№„нЉёлҐј л№„м›Њм•ј н•©л‹€л‹¤\(4лЎњ л‚л€Њ м€ мћ€мќЊ\).

л‹¤мќЊ мѓн”Њ мЅ”л“њлЉ” "r"мќ„ м Ѓм €н•кІЊ кі м •н•©л‹€л‹¤.

```text
   /*
   Adapted from poly1305aes_test_clamp.c version 20050207
   D. J. Bernstein
   Public domain.
   */

   #include "poly1305aes_test.h"

   void poly1305aes_test_clamp(unsigned char r[16])
   {
     r[3] &= 15;
     r[7] &= 15;
     r[11] &= 15;
     r[15] &= 15;
     r[4] &= 252;
     r[8] &= 252;
     r[12] &= 252;
   }
```

м—¬кё°м„њ "&="лЉ” C м–ём–ґ л№„нЉё AND н• л‹№ м—°м‚°мћђмћ…л‹€л‹¤.

"s"лЉ” м€мёЎн•  м€ м—†м–ґм•ј н•м§Ђл§Њ л§¤лІ€ "r"кіј "s"лҐј лЄЁл‘ђ кі мњ н•кІЊ мѓќм„±н•лЉ” кІѓмќЂ м™„лІЅн•кІЊ н—€мљ©лђ©л‹€л‹¤. к°Ѓк°ЃмќЂ 128л№„нЉёмќґлЇЂлЎњ мќм‚¬ л¬ґмћ‘мњ„лЎњ мѓќм„±н•лЉ” кІѓ\(м„№м… 2.6 м°ёмЎ°\)лЏ„ н—€мљ©лђ©л‹€л‹¤.

Poly1305м—ђ лЊЂн•њ мћ…л ҐмќЂ л‹¤мќЊкіј к°™мЉµл‹€л‹¤.

- 256л№„нЉё мќјнљЊмљ© н‚¤

- мћ„мќ кёёмќґмќ л©”м‹њм§Ђ

м¶њл ҐмќЂ 128л№„нЉё нѓњк·ёмћ…л‹€л‹¤.

лЁјм Ђ "r" к°’мќґ кі м •лђ©л‹€л‹¤.

л‹¤мќЊмњјлЎњ, мѓЃм€ м†Њм€ "P"лҐј 2^130-5лЎњ м„¤м •н•©л‹€л‹¤: 3ffffffffffffffffffffffffffffffffb. лђн•њ ліЂм€ "accumulator"лҐј 0мњјлЎњ м„¤м •н•©л‹€л‹¤.

л‹¤мќЊмњјлЎњ л©”м‹њм§ЂлҐј 16л°”мќґнЉё лё”лЎќмњјлЎњ л‚л€•л‹€л‹¤. л§€м§Ђл§‰ кІѓмќЂ лЌ” м§§мќ„ м€ мћ€мЉµл‹€л‹¤.

- лё”лЎќмќ„ л¦¬н‹Ђ м—”л””м•€ м€«мћђлЎњ мќЅмЉµл‹€л‹¤.

- мҐн…џ м€ліґл‹¤ 1л№„нЉё лЌ” м¶”к°Ђн•©л‹€л‹¤. 16л°”мќґнЉё лё”лЎќмќ кІЅмљ° мќґлЉ” м€«мћђм—ђ 2^128мќ„ м¶”к°Ђн•лЉ” кІѓкіј к°™мЉµл‹€л‹¤. лЌ” м§§мќЂ кІЅмљ°

- лё”лЎќ, 2^120, 2^112 лђлЉ” 8лЎњ к· л“±н•кІЊ л‚л€Њ м€ мћ€лЉ” 2мќ к±°л“­м њкі±\(2^8к№Њм§Ђ\)мќґ лђ  м€ мћ€мЉµл‹€л‹¤.

- лё”лЎќ кёёмќґк°Ђ 17л°”мќґнЉёк°Ђ м•„л‹Њ кІЅмљ°\(л§€м§Ђл§‰ лё”лЎќ\) 0мњјлЎњ м±„м›Ѓл‹€л‹¤. лё”лЎќмќ„ м€«мћђлЎњ м·Ёкё‰н•лЉ” кІЅмљ° мќґлЉ” мќлЇёк°Ђ м—†мЉµл‹€л‹¤.

- мќґ м€«мћђлҐј л€„м‚°кё°м—ђ м¶”к°Ђн•©л‹€л‹¤.

- "r"мќ„ кі±н•м„ёмљ”.

- л€„м‚°кё°лҐј кІ°кіј лЄЁл“€лЎњ pлЎњ м„¤м •н•©л‹€л‹¤. мљ”м•Ѕн•мћђл©ґ: Acc = \(\(Acc+block\)\*r\) % p.

л§€м§Ђл§‰мњјлЎњ л№„л°Ђ н‚¤ "s"мќ к°’мќґ л€„м‚°кё°м—ђ м¶”к°Ђлђкі  128к°њмќ мµњн•мњ„ л№„нЉёк°Ђ л¦¬н‹Ђ м—”л””м•€ м€њм„њлЎњ м§Ѓл ¬н™”лђм–ґ нѓњк·ёлҐј н•м„±н•©л‹€л‹¤.

---
#### **2.5.1.  The Poly1305 Algorithms in Pseudocode**

```text
      clamp(r): r &= 0x0ffffffc0ffffffc0ffffffc0fffffff
      poly1305_mac(msg, key):
         r = le_bytes_to_num(key[0..15])
         clamp(r)
         s = le_bytes_to_num(key[16..31])
         a = 0  /* a is the accumulator */
         p = (1<<130)-5
         for i=1 upto ceil(msg length in bytes / 16)
            n = le_bytes_to_num(msg[((i-1)*16)..(i*16)] | [0x01])
            a += n
            a = (r * a) % p
            end
         a += s
         return num_to_16_le_bytes(a)
         end
```

---
#### **2.5.2.  Poly1305 Example and Test Vector**

мќґ м€м—ђм„њлЉ” AESлҐј м‚¬мљ©н•м—¬ мќјнљЊмљ© н‚¤лҐј мѓќм„±н•м§Ђ м•Љкі  л‹¤мќЊкіј к°™мќЂ н‚¤ кґЂл Ё мћђлЈЊлҐј м–»м—€л‹¤кі  к°Ђм •н•©л‹€л‹¤.

```text
   o  Key Material: 85:d6:be:78:57:55:6d:33:7f:44:52:fe:42:d5:06:a8:01:0
      3:80:8a:fb:0d:b2:fd:4a:bf:f6:af:41:49:f5:1b
```

- мҐн…џ л¬ёмћђм—ґ: 01:03:80:8a:fb:0d:b2:fd:4a:bf:f6:af:41:49:f5:1b

- 128л№„нЉё м€«мћђмќё s: 1bf54941aff6bf4afdb20dfb8a800301

- нЃґлћЁн•‘ м „ r: 85:d6:be:78:57:55:6d:33:7f:44:52:fe:42:d5:06:a8

- rмќ„ м€«мћђлЎњ кі м •: 806d5400e52447c036d555408bed685

л©”м‹њм§Ђм—ђлЉ” л‹¤мќЊкіј к°™мќЂ м§§мќЂ н…ЌмЉ¤нЉёлҐј м‚¬мљ©н•©л‹€л‹¤.

```text
  Message to be Authenticated:
  000  43 72 79 70 74 6f 67 72 61 70 68 69 63 20 46 6f  Cryptographic Fo
  016  72 75 6d 20 52 65 73 65 61 72 63 68 20 47 72 6f  rum Research Gro
  032  75 70                                            up
```

Poly1305лЉ” 16л°”мќґнЉё мІ­нЃ¬лЎњ мћ‘лЏ™н•лЇЂлЎњ 34л°”мќґнЉё л©”м‹њм§ЂлЉ” 3к°њмќ лё”лЎќмњјлЎњ л‚л‰©л‹€л‹¤. л‹¤мќЊ кі„м‚°м—ђм„њ "Acc"лЉ” л€„м‚°кё°лҐј л‚нѓЂл‚ґкі  "Block"мќЂ н„мћ¬ лё”лЎќмќ„ л‚нѓЂлѓ…л‹€л‹¤.

```text
   Block #1
```

Acc = 00 лё”лЎќ = 6f4620636968706172676f7470797243 0x01 л°”мќґнЉёмќ лё”лЎќ = 016f4620636968706172676f7470797243 Acc + лё”лЎќ = 016f4620636968706172676f7470797243 \(Acc+м°Ёл‹Ё\) \* r = b83fe991ca66800489155dcd69e8426ba2779453994ac90ed284034da565ecf Acc = \(\(Acc+м°Ёл‹Ё\)\*r\) % P = 2c88c77849d64ae9147ddeb88e69c83fc

```text
   Block #2
```

Acc = 2c88c77849d64ae9147ddeb88e69c83fc лё”лЎќ = 6f7247206863726165736552206d7572 0x01 л°”мќґнЉёмќ лё”лЎќ = 016f7247206863726165736552206d7572 Acc + лё”лЎќ = 437febea5 05c820f2ad5150db0709f96e \(Acc+м°Ёл‹Ё\) \* r = 21dcc992d0c659ba4036f65bb7f88562ae59b32c2b3b8f7efc8b00f78e548a26 Acc = \(\(Acc+м°Ёл‹Ё\)\*r\) % P = 2d8adaf23b0337fa7cccf b4ea344b30de

```text
   Last Block
```

Acc = 2d8adaf23b0337fa7cccfb4ea344b30de лё”лЎќ = 7075 0x01 л°”мќґнЉёмќ лё”лЎќ = 017075 Acc + лё”лЎќ = 2d8adaf23b0337fa7cccfb4ea344ca153 \(Acc + лё”лЎќ\) \* r = 16d8e08a0f3fe1de4fe4a15486aca7a270a 29f1e6c849221e4a6798b8e45321f \(\(Acc + лё”лЎќ\) \* r\) % P = 28d31b7caff946c77c8844335369d03a7

sлҐј м¶”к°Ђн•л©ґ мќґ лІ€нёлҐј м–»кі  нѓњк·ёлҐј м–»мњјл ¤л©ґ м§Ѓл ¬н™”н•©л‹€л‹¤.

```text
   Acc + s = 2a927010caf8b2bc2c6365130c11d06a8

   Tag: a8:06:1d:c1:30:51:36:c6:c2:2b:8b:af:0c:01:27:a9
```

---
### **2.6.  Generating the Poly1305 Key Using ChaCha20**

м„№м… 2.5м—ђм„њ м„¤лЄ…н•њ лЊЂлЎњ мќјнљЊмљ© Poly1305 н‚¤лҐј мќм‚¬ л¬ґмћ‘мњ„лЎњ мѓќм„±н•лЉ” кІѓмќґ н—€мљ©лђ©л‹€л‹¤. мќґ м„№м…м—ђм„њлЉ” к·ёлџ¬н•њ л°©лІ•мќ„ м •мќн•©л‹€л‹¤.

мќґлџ¬н•њ н‚¤ мЊЌ\(r,s\)мќ„ мѓќм„±н•кё° мњ„н•ґ м„№м… 2.3м—ђ м„¤лЄ…лђњ ChaCha20 лё”лЎќ кё°лЉҐмќ„ м‚¬мљ©н•©л‹€л‹¤. м—¬кё°м„њлЉ” MAC\(л©”м‹њм§Ђ мќём¦ќ мЅ”л“њ\) кё°лЉҐмќ„ мњ„н•њ 256л№„нЉё м„ём… н‚¤к°Ђ мћ€л‹¤кі  к°Ђм •н•©л‹€л‹¤. мќјл¶Ђ н”„лЎњн† мЅњм—ђ лЊЂн•њ MAC м•Њкі л¦¬м¦мњјлЎњ Poly1305 м‚¬мљ©мќ„ м§Ђм •н•лЉ” лЄЁл“  л¬ём„њм—ђм„њлЉ” л¬ґкІ°м„± н‚¤м—ђ 256л№„нЉёк°Ђ н• л‹№лђлЏ„лЎќ м§Ђм •н•ґм•ј н•©л‹€л‹¤. м„№м… 2.8м—ђ м •мќлђњ AEAD кµ¬м„±м—ђм„њлЉ” м•”нён™” л°Џ н‚¤ мѓќм„±м—ђ лЏ™мќјн•њ н‚¤к°Ђ м‚¬мљ©лђ©л‹€л‹¤.

л°©лІ•мќЂ л‹¤мќЊ л§¤к°њліЂм€лҐј м‚¬мљ©н•м—¬ лё”лЎќ н•Ём€лҐј нём¶њн•лЉ” кІѓмћ…л‹€л‹¤.

- ChaCha20 н‚¤лЉ” 256л№„нЉё м„ём… л¬ґкІ°м„± н‚¤лҐј м‚¬мљ©н•©л‹€л‹¤.

- лё”лЎќ м№ґмљґн„°к°Ђ 0мњјлЎњ м„¤м •лђ©л‹€л‹¤.
- н”„лЎњн† мЅњмќЂ 96л№„нЉё лђлЉ” 64л№„нЉё nonceлҐј м§Ђм •н•©л‹€л‹¤. мќґлЉ” лЏ™мќјн•њ н‚¤лҐј м‚¬мљ©н•лЉ” нём¶њл§€л‹¤ кі мњ н•ґм•ј н•лЇЂлЎњ л¬ґмћ‘мњ„лЎњ мѓќм„±лђм–ґм„њлЉ” м•€ лђ©л‹€л‹¤. м№ґмљґн„°лЉ” мќґлҐј кµ¬н„н•лЉ” мў‹мќЂ л°©лІ•мќґм§Ђл§Њ LFSR\(м„ н• н”јл“њл°± м‹њн”„нЉё л €м§ЂмЉ¤н„°\)кіј к°™мќЂ л‹¤лҐё л°©лІ•лЏ„ н—€мљ©лђ©л‹€л‹¤. м—¬кё°м—ђ м§Ђм •лђњ лЊЂлЎњ ChaCha20м—ђлЉ” 96л№„нЉё nonceк°Ђ н•„мљ”н•©л‹€л‹¤. л”°лќјм„њ м њкіµлђњ nonceк°Ђ 64л№„нЉёмќё кІЅмљ° nonceмќ мІмќЊ 32л№„нЉёлЉ” мѓЃм€лЎњ м„¤м •лђ©л‹€л‹¤. мќґлЉ” мќјл°м ЃмњјлЎњ 0мќґм§Ђл§Њ м—¬лџ¬ л°њм‹ мћђк°Ђ мћ€лЉ” н”„лЎњн† мЅњмќ кІЅмљ° к°Ѓ л°њм‹ мћђл§€л‹¤ л‹¤лҐј м€ мћ€м§Ђл§Њ нЉ№м • л°њм‹ мћђк°Ђ лЏ™мќјн•њ н‚¤лҐј м‚¬мљ©н•лЉ” лЄЁл“  н•Ём€ нём¶њм—ђ лЊЂн•ґ лЏ™мќјн•ґм•ј н•©л‹€л‹¤.

лё”лЎќ кё°лЉҐмќ„ м‹¤н–‰н•л©ґ 512л№„нЉё мѓЃнѓњк°Ђ лђ©л‹€л‹¤. м§Ѓл ¬н™”лђњ мѓЃнѓњмќ мІмќЊ 256л№„нЉёлҐј к°Ђм ём™Ђ мќґлҐј мќјнљЊмљ© Poly1305 н‚¤лЎњ м‚¬мљ©н•©л‹€л‹¤. мІмќЊ 128л№„нЉёлЉ” кі м •лђм–ґ "r"мќ„ н•м„±н•кі  л‹¤мќЊ 128л№„нЉёлЉ” "s"к°Ђ лђ©л‹€л‹¤. л‚лЁём§Ђ 256л№„нЉёлЉ” лІ„л ¤м§‘л‹€л‹¤.

л§ЋмќЂ н”„лЎњн† мЅњм—ђлЉ” м•”нён™” м•Њкі л¦¬м¦\(мў…мў… мґ€кё°н™” лІЎн„° лђлЉ” IVлќјкі  н•Ё\)м—ђ лЊЂн•њ мћ„м‹њ мЎ°н•­мќґ мћ€м§Ђл§Њ мќјл°м ЃмњјлЎњ MAC кё°лЉҐм—ђ лЊЂн•њ мЎ°н•­мќЂ м—†мЉµл‹€л‹¤. мќґ кІЅмљ° нём¶њлі„ nonceлЉ” л©”м‹њм§Ђ м№ґмљґн„°м™Ђ к°™мќЂ л‹¤лҐё кіім—ђм„њ к°Ђм ём™Ђм•ј н•©л‹€л‹¤.

---
#### **2.6.1.  Poly1305 Key Generation in Pseudocode**

```text
      poly1305_key_gen(key,nonce):
         counter = 0
         block = chacha20_block(key,counter,nonce)
         return block[0..31]
         end
```

---
#### **2.6.2.  Poly1305 Key Generation Test Vector**

мќґ м€м—ђм„њлЉ” л‹¤мќЊмќ„ м„¤м •н•©л‹€л‹¤.

```text
  Key:
  000  80 81 82 83 84 85 86 87 88 89 8a 8b 8c 8d 8e 8f  ................
  016  90 91 92 93 94 95 96 97 98 99 9a 9b 9c 9d 9e 9f  ................

   Nonce:
   000  00 00 00 00 00 01 02 03 04 05 06 07              ............
```

н‚¤, nonce л°Џ лё”лЎќ м№ґмљґн„° 0мќґ нЏ¬н•Ёлђњ ChaCha мѓЃнѓњ м„¤м •: - вЂ‹вЂ‹61707865 3320646e 79622d32 6b206574 83828180 87868584 8b8a8988 8f8e8d8c 93929190 97969594 9b9a9998 9f9e9d9 c 00000000 00000000 03020100 07060504

20 лќјмљґл“њ н›„ ChaCha мѓЃнѓњ: - 8ba0d58a cc815f90 27405081 7194b24a 37b633a8 a50dfde3 e2b8db08 46a6d1fd 7da03782 9183a233 148ad271 b46773d1 3cc1875a 8607 def1 ca5c3086 7085eb87

```text
  Output bytes:
  000  8a d5 a0 8b 90 5f 81 cc 81 50 40 27 4a b2 94 71  ....._...P@'J..q
  016  a8 33 b6 37 e3 fd 0d a5 08 db b8 e2 fd d1 a6 46  .3.7...........F
```

к·ёл¦¬кі  н•ґл‹№ м¶њл ҐмќЂ Poly1305м—ђ м‚¬мљ©лђлЉ” 32л°”мќґнЉё мќјнљЊмљ© н‚¤мќґкё°лЏ„ н•©л‹€л‹¤.

---
### **2.7.  A Pseudorandom Function for Crypto Suites Based on ChaCha/Poly1305**

IKEv2\(\[RFC7296\]\)м™Ђ к°™мќЂ мќјл¶Ђ н”„лЎњн† мЅњм—ђлЉ” мЈјлЎњ н‚¤ нЊЊмѓќмќ„ мњ„н•ґ PRF\(мќм‚¬ л¬ґмћ‘мњ„ н•Ём€\)к°Ђ н•„мљ”н•©л‹€л‹¤. IKEv2 м •мќм—ђм„њ PRFлЉ” к°ЂліЂ кёёмќґ н‚¤м™Ђ к°ЂліЂ кёёмќґ мћ…л Ґмќ„ н—€мљ©н•кі  кі м • кёёмќґ м¶њл Ґмќ„ л°н™н•лЉ” н•Ём€мћ…л‹€л‹¤. к°ЂмћҐ мќјл°м ЃмњјлЎњ н•ґм‹њлђњ MAC\(HMAC\) кµ¬м„±мќґ мќґ лЄ©м ЃмњјлЎњ м‚¬мљ©лђл©° л©”м‹њм§Ђ мќём¦ќкіј PRF лЄЁл‘ђм—ђ лЏ™мќјн•њ кё°лЉҐмќґ м‚¬мљ©лђлЉ” кІЅмљ°к°Ђ л§ЋмЉµл‹€л‹¤.

Poly1305лЉ” PRFм—ђ м Ѓн•©н•њ м„ нѓќмќґ м•„л‹™л‹€л‹¤. Poly1305лЉ” лЏ™мќјн•њ н‚¤лҐј л‘ђ лІ€ м‚¬мљ©н•лЉ” кІѓмќ„ кё€м§Ђн•лЉ” л°л©ґ, IKEv2мќ PRFлЉ” лЏ™мќјн•њ н‚¤лЎњ м—¬лџ¬ лІ€ м‚¬мљ©лђ©л‹€л‹¤. лђн•њ HMACм™Ђ л‹¬л¦¬ Poly1305лЉ” нЋён–Ґлђм–ґ мћ€мњјлЇЂлЎњ н‚¤ нЊЊмѓќм—ђ мќґлҐј м‚¬мљ©н•л©ґ лЊЂм№­ м•”нён™”мќ ліґм•€мќґ м Ђн•лђ©л‹€л‹¤.

Chacha20мќЂ мћ„мќлЎњ кёґ н‚¤мЉ¤нЉёл¦јмќ„ мѓќм„±н•м—¬ н‚¤ нЊЊмѓќ н•Ём€лЎњ м‚¬мљ©лђ  м€ мћ€мЉµл‹€л‹¤. к·ёлџ¬л‚ мќґлЉ” IKEv2м™Ђ к°™мќЂ н”„лЎњн† мЅњмќґ мљ”кµ¬н•лЉ” кІѓмќґ м•„л‹™л‹€л‹¤.

мќґлџ¬н•њ мќґмњ лЎњ мќґ л¬ём„њм—ђм„њлЉ” PRFлҐј м§Ђм •н•м§Ђ м•ЉмЉµл‹€л‹¤.

---
### **2.8.  AEAD Construction**

AEAD\_CHACHA20\_POLY1305лЉ” м¶”к°Ђ лЌ°мќґн„° м•Њкі л¦¬м¦мќ„ м‚¬мљ©н•њ мќём¦ќлђњ м•”нён™”мћ…л‹€л‹¤. AEAD\_CHACHA20\_POLY1305м—ђ лЊЂн•њ мћ…л ҐмќЂ л‹¤мќЊкіј к°™мЉµл‹€л‹¤.

- 256л№„нЉё н‚¤

- 96л№„нЉё nonce - лЏ™мќјн•њ н‚¤лҐј м‚¬мљ©н•м—¬ нём¶њн•  л•Њл§€л‹¤ л‹¤л¦…л‹€л‹¤.

- мћ„мќ кёёмќґмќ мќјл° н…ЌмЉ¤нЉё

```text
   o  Arbitrary length additional authenticated data (AAD)
```

мќјл¶Ђ н”„лЎњн† мЅњм—ђлЉ” кёёмќґк°Ђ 96л№„нЉёк°Ђ м•„л‹Њ кі мњ н•њ нём¶њлі„ мћ…л Ґмќґ мћ€мќ„ м€ мћ€мЉµл‹€л‹¤. м€лҐј л“¤м–ґ IPsecмќЂ 64л№„нЉё nonceлҐј м§Ђм •н•  м€ мћ€мЉµл‹€л‹¤. к·ёлџ¬н•њ кІЅмљ°, м€лҐј л“¤м–ґ мѓЃм€ к°’мќ„ м—°кІ°н•м—¬ н”„лЎњн† мЅњ мћ„м‹њк°’мќ„ 96л№„нЉё мћ„м‹њк°’мњјлЎњ ліЂн™н•лЉ” л°©лІ•мќ„ м •мќн•лЉ” кІѓмќЂ н”„лЎњн† мЅњ л¬ём„њм—ђ л‹¬л ¤ мћ€мЉµл‹€л‹¤.

ChaCha20 л°Џ Poly1305 н”„л¦¬лЇён‹°лёЊлЉ” л‹¤мќЊкіј к°™мќґ 256л№„нЉё н‚¤м™Ђ 96л№„нЉё nonceлҐј м‚¬мљ©н•лЉ” AEADлЎњ кІ°н•©лђ©л‹€л‹¤.

- лЁјм Ђ м„№м… 2.6м—ђ м„¤лЄ…лђњ м €м°ЁлҐј м‚¬мљ©н•м—¬ 256л№„нЉё н‚¤м™Ђ nonceм—ђм„њ Poly1305 мќјнљЊмљ© н‚¤лҐј мѓќм„±н•©л‹€л‹¤.

- л‹¤мќЊмњјлЎњ ChaCha20 м•”нён™” н•Ём€лҐј нём¶њн•м—¬ лЏ™мќјн•њ н‚¤м™Ђ nonceлҐј м‚¬мљ©н•кі  мґ€кё° м№ґмљґн„°лҐј 1лЎњ м„¤м •н•м—¬ мќјл° н…ЌмЉ¤нЉёлҐј м•”нён™”н•©л‹€л‹¤.

- л§€м§Ђл§‰мњјлЎњ мњ„м—ђм„њ кі„м‚°лђњ Poly1305 н‚¤лҐј м‚¬мљ©н•м—¬ Poly1305 н•Ём€к°Ђ нём¶њлђкі  л‹¤мќЊмќ„ м—°кІ°н•м—¬ л©”м‹њм§Ђк°Ђ кµ¬м„±лђ©л‹€л‹¤.

- \* AAD

- \* padding1 -- нЊЁл”©мќЂ мµњлЊЂ 15к°њмќ 0л°”мќґнЉёмќґл©°, м§Ђкё€к№Њм§Ђмќ м „мІґ кёёмќґлЉ” 16мќ м •м€л°°к°Ђ лђ©л‹€л‹¤. AADмќ кёёмќґк°Ђ мќґлЇё 16л°”мќґнЉёмќ м •м€л°°мќё кІЅмљ° мќґ н•„л“њлЉ” кёёмќґк°Ђ 0мћ…л‹€л‹¤. .

- \* м•”нёл¬ё

- \* padding2 -- нЊЁл”©мќЂ мµњлЊЂ 15к°њмќ 0л°”мќґнЉёмќґл©° мґќ кёёмќґлЉ” 16мќ м •м€л°°к°Ђ лђ©л‹€л‹¤. м•”нёл¬ёмќ кёёмќґк°Ђ мќґлЇё 16л°”мќґнЉёмќ м •м€л°°мќё кІЅмљ° мќґ н•„л“њлЉ” кёёмќґк°Ђ 0мћ…л‹€л‹¤. .

- \* мҐн…џ л‹Ёмњ„мќ м¶”к°Ђ лЌ°мќґн„° кёёмќґмћ…л‹€л‹¤\(64л№„нЉё л¦¬н‹Ђ м—”л””м•€ м •м€\).

- \* мҐн…џ л‹Ёмњ„мќ м•”нёл¬ё кёёмќґмћ…л‹€л‹¤\(64л№„нЉё л¦¬н‹Ђ м—”л””м•€ м •м€\).

AEADмќ м¶њл ҐмќЂ л‹¤мќЊмќ„ м—°кІ°н•њ кІѓмћ…л‹€л‹¤.

- нЏ‰л¬ёкіј кёёмќґк°Ђ к°™мќЂ м•”нёл¬ё.

- Poly1305 кё°лЉҐмќ м¶њл Ґмќё 128л№„нЉё нѓњк·ёмћ…л‹€л‹¤.

ліµнён™”лЉ” л‹¤мќЊкіј к°™мќЂ м°Ёмќґм ђмќ„ м њм™ён•кі  мњ м‚¬н•©л‹€л‹¤.

- м•”нёл¬ёкіј нЏ‰л¬ёмќ м—­н• мќґ л°”лЂЊлЇЂлЎњ м•”нёл¬ём—ђ ChaCha20 м•”нён™” кё°лЉҐмќ„ м Ѓмљ©н•м—¬ нЏ‰л¬ёмќ„ мѓќм„±н•©л‹€л‹¤.

- Poly1305 кё°лЉҐмќЂ мќјл° н…ЌмЉ¤нЉёк°Ђ м•„л‹Њ AAD л°Џ м•”нёл¬ём—ђм„њ кі„м†Ќ м‹¤н–‰лђ©л‹€л‹¤.

- кі„м‚°лђњ нѓњк·ёлЉ” м€м‹ лђњ нѓњк·ём™Ђ л№„нЉё л‹Ёмњ„лЎњ л№„кµђлђ©л‹€л‹¤. нѓњк·ёк°Ђ мќјм№н•лЉ” кІЅмљ°м—ђл§Њ л©”м‹њм§Ђк°Ђ мќём¦ќлђ©л‹€л‹¤.

мќґ л””мћђмќём—ђ лЊЂн•њ лЄ‡ к°Ђм§Ђ м°ёкі  м‚¬н•­:

1. л‹Ёмќј нём¶њм—ђм„њ к°ЂлЉҐн•њ м•”нён™”лђњ лЌ°мќґн„°мќ м–‘мќЂ ChaCha20 лё”лЎќ н•Ём€мќ лё”лЎќ м№ґмљґн„° н•„л“њ нЃ¬кё°лЎњ мќён•ґ к°Ѓк°Ѓ 64л°”мќґнЉёмќ 2^32-1 лё”лЎќмћ…л‹€л‹¤. мќґлЉ” мґќ 274,877,906,880л°”мќґнЉё лђлЉ” к±°мќ 256GBлҐј м њкіµн•©л‹€л‹¤. мќґлЉ” IPsec л°Џ TLSм™Ђ к°™мќЂ нЉёлћн”Ѕ н”„лЎњн† мЅњм—ђлЉ” м¶©л¶„н•м§Ђл§Њ нЊЊмќј л°Џ/лђлЉ” л””мЉ¤нЃ¬ м•”нён™”м—ђлЉ” л„€л¬ґ мћ‘мќ„ м€ мћ€мЉµл‹€л‹¤. мќґлџ¬н•њ мљ©лЏ„лЎњ м›ђлћ м„¤кі„лЎњ лЏЊм•„к°Ђ nonceлҐј 64л№„нЉёлЎњ м¤„мќґкі  мњ„м№ 13мќ м •м€лҐј 64л№„нЉё лё”лЎќ м№ґмљґн„°мќ мѓЃмњ„ 32л№„нЉёлЎњ м‚¬мљ©н•м—¬ м „мІґ л©”м‹њм§Ђ нЃ¬кё°лҐј л°±л§Њ нЋнѓЂл°”мќґнЉё мќґмѓЃмњјлЎњ лЉл¦ґ м€ мћ€мЉµл‹€л‹¤\( м •н™•нћ€лЉ” 1,180,591,620,717,411,303,360л°”мќґнЉё\).

1. мќґм „ н•­лЄ©м—ђлЏ„ л¶€кµ¬н•кі  Poly1305к°Ђ м‹¤н–‰лђлЉ” лІ„нЌј кµ¬м„±мќ м•”нёл¬ё кёёмќґ н•„л“њлЉ” м•”нёл¬ё\(л°Џ мќјл° н…ЌмЉ¤нЉё\) нЃ¬кё°лҐј 2^64л°”мќґнЉё, м¦‰ 16,000нЋнѓЂл°”мќґнЉё\(м •н™•нћ€лЉ” 18,446,744,073,709,551,616л°”мќґнЉё\)лЎњ м њн•њн•©л‹€л‹¤.

мќґ м„№м…мќ AEAD кµ¬м„±мќЂ ChaCha20кіј Poly1305мќ мѓ€лЎњмљґ кµ¬м„±мћ…л‹€л‹¤. мќґ кµ¬м„±м—ђ лЊЂн•њ ліґм•€ л¶„м„ќмќЂ \[Procter\]м—ђ л‚м™Ђ мћ€мЉµл‹€л‹¤.

л‹¤мќЊмќЂ \[RFC5116\]мќ м„№м… 4м—ђ м •мќлђњ мќґ кµ¬м„±м—ђ лЊЂн•њ л§¤к°њліЂм€ лЄ©лЎќмћ…л‹€л‹¤.

- K\_LEN\(н‚¤ кёёмќґ\)мќЂ 32мҐн…џмћ…л‹€л‹¤.

- P\_MAX\(мќјл° н…ЌмЉ¤нЉёмќ мµњлЊЂ нЃ¬кё°\)лЉ” 274,877,906,880л°”мќґнЉё лђлЉ” к±°мќ 256GBмћ…л‹€л‹¤.

- A\_MAX\(м—°кґЂ лЌ°мќґн„°мќ мµњлЊЂ нЃ¬кё°\)лЉ” м—°кґЂ лЌ°мќґн„°мќ кёёмќґ н•„л“њм—ђ мќн•ґ 2^64-1 мҐн…џмњјлЎњ м„¤м •лђ©л‹€л‹¤.

```text
   o  N_MIN = N_MAX = 12 octets.

   o  C_MAX = P_MAX + tag length = 274,877,906,896 octets.
```

ккі мњ н•њ AAD мћ…л Ґ\(\[RFC5116\]мќ м„№м… 3.3м—ђ м„¤лЄ…лђњ лЊЂлЎњ\)мќЂ AEAD\_CHACHA20\_POLY1305м—ђ лЊЂн•њ л‹Ёмќј мћ…л ҐмњјлЎњ м—°кІ°лђм–ґм•ј н•©л‹€л‹¤. н•„мљ”н•њ кІЅмљ° AAD мћ…л Ґм—ђ кµ¬мЎ°лҐј л§Њл“њлЉ” кІѓмќЂ м• н”Њл¦¬мјЂмќґм…м—ђ л‹¬л ¤ мћ€мЉµл‹€л‹¤.

---
#### **2.8.1.  Pseudocode for the AEAD Construction**

```text
      pad16(x):
         if (len(x) % 16)==0
            then return NULL
            else return copies(0, 16-(len(x)%16))
         end

      chacha20_aead_encrypt(aad, key, iv, constant, plaintext):
         nonce = constant | iv
         otk = poly1305_key_gen(key, nonce)
         ciphertext = chacha20_encrypt(key, 1, nonce, plaintext)
         mac_data = aad | pad16(aad)
         mac_data |= ciphertext | pad16(ciphertext)
         mac_data |= num_to_8_le_bytes(aad.length)
         mac_data |= num_to_8_le_bytes(ciphertext.length)
         tag = poly1305_mac(mac_data, otk)
         return (ciphertext, tag)
```

---
#### **2.8.2.  Example and Test Vector for AEAD_CHACHA20_POLY1305**

н…ЊмЉ¤нЉё лІЎн„°мќ кІЅмљ° AEAD\_CHACHA20\_POLY1305 н•Ём€м—ђ л‹¤мќЊ мћ…л Ґмќ„ м‚¬мљ©н•©л‹€л‹¤.

нЏ‰л¬ё: 000 4c 61 64 69 65 73 20 61 6e 64 20 47 65 6e 74 6c Ladies and Gentl 016 65 6d 65 6e 20 6f 66 20 74 68 65 20 63 6c 61 73 emen of the class 032 73 20 6f 66 20 27 39 39 3a 20 49 66 20 49 20 99л…„ 63мґ€: л§Њм•Ѕ л‚ґк°Ђ c 048 6f 75 6c 64 20 6f 66 66 65 72 20 79 6f 75 20 6fк°Ђ л‹№м‹ м—ђкІЊ 064 6e 6c 79 20 6f 6e 65лҐј м њм•€н•њл‹¤л©ґ 20 74 69 70 20 66 6f 72 20 080 74 68 65 20 66 75 74 75 72 65 2c 20 73 75 6e 73 лЇёлћ, нѓњм–‘м—ђ лЊЂн•њ нЊЃ н•л‚л§Њ 096 63 72 65 65 6e 20 77 6f 75 6c 64 20 62 65 20 69 нЃ¬л¦° кІѓ л‚њ 112 74 2e tм•ј.

```text
   AAD:
   000  50 51 52 53 c0 c1 c2 c3 c4 c5 c6 c7              PQRS........

  Key:
  000  80 81 82 83 84 85 86 87 88 89 8a 8b 8c 8d 8e 8f  ................
  016  90 91 92 93 94 95 96 97 98 99 9a 9b 9c 9d 9e 9f  ................

   IV:
   000  40 41 42 43 44 45 46 47                          @ABCDEFG

   32-bit fixed-common part:
   000  07 00 00 00                                      ....
```

Poly1305 мќјнљЊмљ© н‚¤ мѓќм„±мќ„ мњ„н•њ м„¤м •\(л°њм‹ мћђ ID=7\): - 61707865 3320646e 79622d32 6b206574 83828180 87868584 8b8a8988 8f8e8d8c 93929190 97969594 9b9a9998 9f 9e9d9c 00000000 00000007 43424140 47464544

Poly1305 мќјнљЊмљ© н‚¤ мѓќм„± н›„: - 252bac7b af47b42d 557ab609 8455e9a4 73d6e10a ebd97510 7875932a ff53d53e decc7ea2 b44ddbad e49c17d1 d8430bc9 8c94b7bc 8b7d4b4b 39 27f67d 1669a432

```text
  Poly1305 Key:
  000  7b ac 2b 25 2d b4 47 af 09 b6 7a 55 a4 e9 55 84  {.+%-.G...zU..U.
  016  0a e1 d6 73 10 75 d9 eb 2a 93 75 78 3e d5 53 ff  ...s.u..*.ux>.S.

  Poly1305 r =  455e9a4057ab6080f47b42c052bac7b
  Poly1305 s = ff53d53e7875932aebd9751073d6e10a

   keystream bytes:
   9f:7b:e9:5d:01:fd:40:ba:15:e2:8f:fb:36:81:0a:ae:
   c1:c0:88:3f:09:01:6e:de:dd:8a:d0:87:55:82:03:a5:
   4e:9e:cb:38:ac:8e:5e:2b:b8:da:b2:0f:fa:db:52:e8:
   75:04:b2:6e:be:69:6d:4f:60:a4:85:cf:11:b8:1b:59:
   fc:b1:c4:5f:42:19:ee:ac:ec:6a:de:c3:4e:66:69:78:
   8e:db:41:c4:9c:a3:01:e1:27:e0:ac:ab:3b:44:b9:cf:
   5c:86:bb:95:e0:6b:0d:f2:90:1a:b6:45:e4:ab:e6:22:
   15:38
```

м•”нёл¬ё: 000 d3 1a 8d 34 64 8e 60 db 7b 86 af bc 53 ef 7e c2 ...4d.\`.{...S.\~. 016 a4 ad ed 51 29 6e 08 fe a9 e2 b5 a7 36 ee 62 d6 ...Q\)n......6.b. 032 3d be a4 5e 8c a9 67 12 82 fa fb 69 da 92 72 8b =..^..g....i..r. 048 1a 71 de 0a 9e 06 0b 29 05 d6 a5 b6 7e cd 3b 36 .q.....\)....\~.;6 064 92 dd bd 7f 2d 77 8b 8c 98 03 ae e3 28 09 1b 58 ....-w......\(..X 080 fa b3 24 e4 fa d6 75 94 55 85 80 8b 48 31 d7 bc ..$...u.U...H1.. 096 3f f4 de f0 8e 4b 7a 9d e5 76 d2 65 86 ce c6 4b ?....Kz..v.e...K 112 61 16 a.

Poly1305м—ђ лЊЂн•њ AEAD кµ¬м„±: 000 50 51 52 53 c0 c1 c2 c3 c4 c5 c6 c7 00 00 00 00 PQRS........... 016 d3 1a 8d 34 64 8e 60 db 7b 86 af bc 53 ef 7e c2 ...4d.\`.{...S.\~. 032 a4 кґ‘кі  51 29 6e 08 fe a9 e2 b5 a7 36 ee 62 d6 ...Q\)n......6.b. 048 3d be a4 5e 8c a9 67 12 82 fa fb 69 da 92 72 8b =..^..g....i..r. 064 1a 71 л“њ 0a 9e 06 0b 29 05 d6 a5 b6 7e cd 3b 36 .q.....\)....\~.;6 080 92 dd bd 7f 2d 77 8b 8c 98 03 ae e3 28 09 1b 58 ....-w......\(..X 096 fa b3 24 e4 fa d6 75 94 55 85 80 8b 48 31 d7 bc ..$...u.U...H1.. 112 3f f4 de f0 8e 4b 7a 9d e5 76 d2 65 86 ce c6 4b ?....Kz..v.e...K 128 61 16 00 00 00 00 00 00 00 00 00 00 00 00 00 00 a........ .......144 0c 00 00 00 00 00 00 00 72 00 00 00 00 00 00 00 ........r.......

000н–‰м—ђ 4к°њмќ 0л°”мќґнЉёк°Ђ мћ€кі  128н–‰м—ђ 14к°њмќ 0л°”мќґнЉёк°Ђ мћ€мЉµл‹€л‹¤.

```text
   Tag:
   1a:e1:0b:59:4f:09:e2:6a:7e:90:2e:cb:d0:60:06:91
```

---
## **3.  Implementation Advice**

ChaCha20мќ к°Ѓ лё”лЎќм—ђлЉ” мѓЃнѓњ лЎњл“њлҐј мњ„н•њ 16к°њмќ мќґлЏ™ мћ‘м—…кіј 1к°њмќ м¦ќл¶„ мћ‘м—…, к°Ѓ 80к°њмќ XOR, лќјмљґл“њм—ђ лЊЂн•њ м¶”к°Ђ л°Џ лЎ¤ мћ‘м—…, 16к°њмќ м¶”к°Ђ м¶”к°Ђ мћ‘м—… л°Џ мќјл° н…ЌмЉ¤нЉё ліґнёлҐј мњ„н•њ 16к°њмќ XOR мћ‘м—…мќґ нЏ¬н•Ёлђ©л‹€л‹¤. м„№м… 2.3м—ђм„њлЉ” ChaCha лё”лЎќ кё°лЉҐмќ„ "м›ђлћ мћ…л Ґ л‹Ём–ґ м¶”к°Ђ"лЎњ м„¤лЄ…н•©л‹€л‹¤. мќґлЉ” ChaCha мѓЃнѓњм—ђм„њ лќјмљґл“њлҐј м‹њмћ‘н•кё° м „м—ђ мќґлҐј л”°лЎњ ліµм‚¬н•кі  л‚м¤‘м—ђ м¶”к°Ђн•њл‹¤лЉ” кІѓмќ„ мќлЇён•©л‹€л‹¤. мќґлЉ” л§ћмЉµл‹€л‹¤. к·ёлџ¬л‚ лЊЂм‹  мѓЃнѓњлҐј ліµм‚¬н•кі  ліµм‚¬ліём—ђ лЊЂн•њ мћ‘м—…мќ„ м€н–‰н•л©ґ лЄ‡ к°Ђм§Ђ мћ‘м—…мќ„ м ЂмћҐн•  м€ мћ€мЉµл‹€л‹¤. мќґл ‡кІЊ н•л©ґ л‹¤мќЊ лё”лЎќм—ђ лЊЂн•ґ мѓЃнѓњлҐј л‹¤м‹њ мѓќм„±н•  н•„мљ”к°Ђ м—†кі  лё”лЎќ м№ґмљґн„°л§Њ м¦ќк°Ђм‹њн‚¬ н•„мљ”к°Ђ мћ€мЉµл‹€л‹¤. мќґлЎњмЌЁ м‚¬мќґнЃґмќ м•Ѕ 5.5%к°Ђ м €м•Ѕлђ©л‹€л‹¤.

Poly1305мќ м‚°м€  м—°м‚°мќ„ мњ„н•ґ OpenSSLмќ лќјмќґлёЊлџ¬л¦¬м™Ђ к°™мќЂ мќјл°м Ѓмќё нЃ° м€«мћђ лќјмќґлёЊлџ¬л¦¬лҐј м‚¬мљ©н•лЉ” кІѓмќЂ к¶ЊмћҐлђм§Ђ м•ЉмЉµл‹€л‹¤. мќґлџ¬н•њ лќјмќґлёЊлџ¬л¦¬лЉ” лЏ™м Ѓ н• л‹№мќ„ м‚¬мљ©н•м—¬ лЄЁл“  нЃ¬кё°мќ м •м€лҐј мІл¦¬н•  м€ мћ€м§Ђл§Њ мќґлџ¬н•њ мњ м—°м„±м—ђлЉ” м„±лЉҐкіј л¶Ђм±„л„ђ ліґм•€мќґ нќ¬мѓќлђ©л‹€л‹¤. мќјм •н•њ м‹њк°„м—ђ м‹¤н–‰лђлЉ” ліґл‹¤ нљЁмњЁм Ѓмќё кµ¬н„мќ„ м‚¬мљ©н•  м€ мћ€мњјл©° к·ё м¤‘ н•л‚лЉ” DJ Bernsteinмќ мћђмІґ лќјмќґлёЊлџ¬л¦¬мќё NaCl\(\[NaCl\]\)м—ђ мћ€мЉµл‹€л‹¤. мѓЃм€ м‹њк°„мќґм§Ђл§Њ мµњм Ѓмќґ м•„л‹Њ м ‘к·ј л°©м‹ќмќЂ 288л№„нЉё м •м€м—ђ лЊЂн•њ м‚°м€  м—°м‚°мќ„ м€њм§„н•кІЊ кµ¬н„н•лЉ” кІѓмћ…л‹€л‹¤. м€њм§„н•њ кµ¬н„мќґлќјлЏ„ \(acc+block\)кіј rмќ кі±м…€м—ђм„њ 2^288мќ„ мґ€кіјн•м§Ђ м•Љкё° л•Њл¬ёмћ…л‹€л‹¤. нљЁмњЁм Ѓмќё мѓЃм€ м‹њк°„ кµ¬н„мќЂ кіµк°њ лЏ„л©”мќё лќјмќґлёЊлџ¬л¦¬ poly1305-donna\(\[Poly1305\_Donna\]\)м—ђм„њ м°ѕмќ„ м€ мћ€мЉµл‹€л‹¤.

---
## **4.  Security Considerations**

ChaCha20 м•”нёлЉ” 256л№„нЉё ліґм•€мќ„ м њкіµн•лЏ„лЎќ м„¤кі„лђм—€мЉµл‹€л‹¤.

Poly1305 мќём¦ќмћђлЉ” 2^64к°њмќ н•©лІ•м Ѓмќё л©”м‹њм§ЂлҐј ліґл‚ё н›„м—ђлЏ„ 16nл°”мќґнЉё л©”м‹њм§Ђм—ђ лЊЂн•ґ 1-\(n/\(2^102\)\)мќ н™•лҐ лЎњ мњ„мЎ°лђњ л©”м‹њм§Ђк°Ђ к±°л¶ЂлђлЏ„лЎќ м„¤кі„лђм—€мњјлЇЂлЎњ SUF-CMA\( м„ нѓќн•њ л©”м‹њм§Ђ кіµкІ©м—ђ лЊЂн•њ к°•л Ґн•њ мњ„мЎ° л¶€к°ЂлЉҐм„±\)мќ„ \[AE\]лќјлЉ” мљ©м–ґлЎњ м‚¬мљ©н•©л‹€л‹¤.

мќґл“¤ м¤‘ н•л‚мќ ліґм•€мќ„ м¦ќлЄ…н•лЉ” кІѓмќЂ мќґ л¬ём„њмќ лІ”мњ„лҐј лІ—м–ґл‚©л‹€л‹¤. мќґлџ¬н•њ м¦ќлЄ…мќЂ м°ёмЎ° н•™м€  л…јл¬ё\(\[ChaCha\], \[Poly1305\], \[LatinDances\], \[LatinDances2\] л°Џ \[Zhenqing2012\]\)м—ђм„њ н™•мќён•  м€ мћ€мЉµл‹€л‹¤.

мќґ л¬ём„њлҐј кµ¬н„н•  л•Њ к°ЂмћҐ м¤‘мљ”н•њ ліґм•€ кі л ¤ м‚¬н•­мќЂ ChaCha20м—ђм„њ м‚¬мљ©лђлЉ” nonceмќ кі мњ м„±мћ…л‹€л‹¤. м№ґмљґн„°м™Ђ LFSRмќЂ лЄЁл‘ђ DESм™Ђ к°™мќЂ 64л№„нЉё лё”лЎќ нЃ¬кё°мќ лё”лЎќ м•”нёлҐј м‚¬мљ©н•м—¬ м№ґмљґн„°лҐј м•”нён™”н•лЉ” кІѓмІлџј кі мњ  nonceлҐј мѓќм„±н•лЉ” лЌ° н—€мљ©лђлЉ” л°©лІ•мћ…л‹€л‹¤. 128л№„нЉё лђлЉ” 256л№„нЉё лё”лЎќмќ лё”лЎќ м•”нёлЎњ м•”нён™”лђњ м№ґмљґн„°мќ м €л‹Ёмќ„ м‚¬мљ©н•лЉ” кІѓмќЂ н—€мљ©лђм§Ђ м•ЉмЉµл‹€л‹¤. мќґлџ¬н•њ м €л‹ЁмќЂ м§§мќЂ м‹њк°„ н›„м—ђ л°ліµлђ  м€ мћ€кё° л•Њл¬ёмћ…л‹€л‹¤.

Nonce л°ліµмќ кІ°кіј: Nonceк°Ђ л°ліµлђл©ґ л©”м‹њм§Ђ к°„м—ђ мќјнљЊмљ© Poly1305 н‚¤м™Ђ н‚¤ мЉ¤нЉёл¦јмќґ лЄЁл‘ђ лЏ™мќјн•©л‹€л‹¤. мќґлЉ” мќјл° н…ЌмЉ¤нЉёмќ XORмќґ м•”нёл¬ёмќ XORкіј лЏ™мќјн•кё° л•Њл¬ём—ђ мќјл° н…ЌмЉ¤нЉёмќ XORмќPoly1305 н‚¤лЉ” кіµкІ©мћђк°Ђ м€мёЎн•  м€ м—†м–ґм•ј н•©л‹€л‹¤. н‚¤лҐј л¬ґмћ‘мњ„лЎњ мѓќм„±н•л©ґ мќґ мљ”кµ¬ м‚¬н•­мќ„ м¶©мЎ±н•  м€ мћ€мЉµл‹€л‹¤. л‹Ё, Poly1305лЉ” н†µм‹  н”„лЎњн† мЅњм—ђ мћђмЈј м‚¬мљ©лђлЇЂлЎњ м€м‹ мћђк°Ђ н‚¤лҐј м•Њм•„м•ј н•©л‹€л‹¤. м№ґмљґн„° м•”нён™”м™Ђ к°™мќЂ мќм‚¬ л‚њм€ мѓќм„±мќґ н—€мљ©лђ©л‹€л‹¤. л№„л°Ђ н‚¤м™Ђ nonceм™Ђ н•Ёк» ChaChaлҐј м‚¬мљ©н•лЉ” кІѓлЏ„ н—€мљ©лђ©л‹€л‹¤.

м—¬кё°м—ђ м њм‹њлђњ м•Њкі л¦¬м¦мќЂ л¶Ђм±„л„ђ м·Ём•Ѕм ђмќ„ л°©м§Ђн•кё° мњ„н•ґ мќјм •н•њ м‹њк°„м—ђ м‰ЅкІЊ кµ¬н„н•  м€ мћ€лЏ„лЎќ м„¤кі„лђм—€мЉµл‹€л‹¤. ChaCha20м—ђм„њ м‚¬мљ©лђлЉ” м—°м‚°мќЂ лЄЁл‘ђ лЌ§м…€, XOR, кі м •лЎ¤мћ…л‹€л‹¤. мќґ лЄЁл“  кІѓмќЂ мќјм •н•њ м‹њк°„ л‚ґм—ђ кµ¬н„лђ  м€ мћ€кі  кµ¬н„лђм–ґм•ј н•©л‹€л‹¤. ChaCha мѓЃнѓњм—ђ лЊЂн•њ м¤н”„м…‹м—ђ лЊЂн•њ м•Ўм„ёмЉ¤ л°Џ мћ‘м—… м€лЉ” н‚¤мќ м†Ќм„±м—ђ мќмЎґн•м§Ђ м•ЉмњјлЇЂлЎњ мєђм‹њ л€„лќЅ нѓЂмќґл°Ќмќ„ н†µн•ґ н‚¤м—ђ лЊЂн•њ м •ліґк°Ђ мњ м¶њлђ  к°ЂлЉҐм„±мќ„ м њк±°н•©л‹€л‹¤.

Poly1305мќ кІЅмљ° м—°м‚°мќЂ лЌ§м…€, кі±м…€мћ…л‹€л‹¤. лЄЁл“€лџ¬мЉ¤лЉ” лЄЁл‘ђ 128л№„нЉёліґл‹¤ нЃ° м€«мћђм—ђ м Ѓмљ©лђ©л‹€л‹¤. мќґлЉ” мѓЃм€ м‹њк°„м—ђ м€н–‰лђ  м€ мћ€м§Ђл§Њ л‹Ём€њн•њ кµ¬н„\(м€: мќјл°м Ѓмќё нЃ° м€«мћђ лќјмќґлёЊлџ¬л¦¬ м‚¬мљ©\)мќЂ мѓЃм€ м‹њк°„мќґ м•„л‹™л‹€л‹¤. м€лҐј л“¤м–ґ, кі±м…€мќґ м—°м‚°кіј лі„лЏ„мќ м—°м‚°мњјлЎњ м€н–‰лђлЉ” кІЅмљ°

лЄЁл“€лџ¬мЉ¤мќ кІЅмљ° кІ°кіјлЉ” л•Њл•ЊлЎњ 2^256 лЇёл§Њмќј м€лЏ„ мћ€кі  л•ЊлЎњлЉ” 2^256 мќґмѓЃмќј м€лЏ„ мћ€мЉµл‹€л‹¤. кµ¬н„мћђлЉ” мќґлџ¬н•њ мћ‘м—…мќ м Ѓм €н•њ кµ¬н„мќ„ м‚¬мљ©н•м—¬ Poly1305мќ л¶Ђм±„л„ђ нѓЂмќґл°Ќм—ђ мЈјмќн•ґм•ј н•©л‹€л‹¤.

л©”м‹њм§Ђмќ м‹ лў°м„±мќ„ кІЂм¦ќн•л ¤л©ґ кі„м‚°лђњ нѓњк·ём™Ђ м€м‹ лђњ нѓњк·ёлҐј л№„нЉё л‹Ёмњ„лЎњ л№„кµђн•ґм•ј н•©л‹€л‹¤. лЊЂл¶Ђл¶„мќ м‚¬мљ© м‚¬лЎЂм—ђм„њ nonceм™Ђ AAD мЅн…ђмё лЉ” мњ нљЁн•њ л©”м‹њм§Ђк°Ђ м€м‹ лђ  л•Њк№Њм§Ђ "м‚¬мљ©"лђм§Ђ м•ЉмЉµл‹€л‹¤. мќґлҐј н†µн•ґ кіµкІ©мћђлЉ” нѓњк·ё л№„кµђлҐј н†µкіјн•  л•Њк№Њм§Ђ м„њлЎњ л‹¤лҐё нѓњк·ёлҐј м‚¬мљ©н•м—¬ м—¬лџ¬ к°њмќ лЏ™мќјн•њ л©”м‹њм§ЂлҐј ліґл‚ј м€ мћ€мЉµл‹€л‹¤. кіµкІ©мћђк°Ђ 2^128к°њмќ к°ЂлЉҐн•њ лЄЁл“  нѓњк·ёлҐј н•л‚м”© м‹њлЏ„н•ґм•ј н•њл‹¤л©ґ мќґлЉ” м–ґл µмЉµл‹€л‹¤. к·ёлџ¬л‚ нѓњк·ё л№„кµђ лЏ™мћ‘мќ нѓЂмќґл°Ќмќ„ н†µн•ґ кі„м‚°лђњ нѓњк·ём™Ђ м€м‹ лђњ нѓњк·ёмќ н”„л¦¬н”ЅмЉ¤к°Ђ м–јл§€л‚ лЏ™мќјн•њм§Ђ м•Њ м€ мћ€л‹¤л©ґ л©”м‹њм§Ђ м€лҐј нЃ¬кІЊ м¤„мќј м€ мћ€л‹¤. мќґлџ¬н•њ мќґмњ лЎњ мЁлќјмќё н”„лЎњн† мЅњмќ кµ¬н„м—ђм„њлЉ” C м–ём–ґмќ memcmp\(\)м™Ђ к°™мќґ мµњм Ѓн™”лђм—€м§Ђл§Њ м•€м „н•м§Ђ м•ЉмќЂ лќјмќґлёЊлџ¬л¦¬ кё°лЉҐм—ђ мќмЎґн•кё°ліґл‹¤лЉ” мѓЃм€ м‹њк°„ л№„кµђ кё°лЉҐмќ„ м‚¬мљ©н•ґм•ј н•©л‹€л‹¤.

лђн•њ мќґ м•Њкі л¦¬м¦мќ„ м‚¬мљ©н•лЉ” лЄЁл“  н”„лЎњн† мЅњмќЂ мњ„мЎ° к°ЂлЉҐм„±мќ„ мµњм†Њн™”н•кё° мњ„н•ґ м™„м „н•њ нѓњк·ёлҐј нЏ¬н•Ён•ґм•ј н•©л‹€л‹¤. нѓњк·ё мћл¦јмќЂ м€н–‰лђм–ґм„њлЉ” м•€ лђ©л‹€л‹¤.

---
## **5.  IANA Considerations**

IANAлЉ” мќґ л¬ём„њлҐј м°ёмЎ°лЎњ к°Ђл¦¬н‚¤лЏ„лЎќ м€«мћђ IDк°Ђ 29мќґкі  мќґл¦„мќґ "AEAD\_CHACHA20\_POLY1305"мќё "AEAD\(Authenticated Encryption with Associated Data\) л§¤к°њліЂм€" л €м§ЂмЉ¤нЉёл¦¬ н•­лЄ©мќ„ м—…лЌ°мќґнЉён–€мЉµл‹€л‹¤.

---
## **6.  References**
---
### **6.1.  Normative References**

```text
   [ChaCha]   Bernstein, D., "ChaCha, a variant of Salsa20", January
              2008, <http://cr.yp.to/chacha/chacha-20080128.pdf>.

   [Poly1305]
              Bernstein, D., "The Poly1305-AES message-authentication
              code", March 2005,
              <http://cr.yp.to/mac/poly1305-20050329.pdf>.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <https://www.rfc-editor.org/info/rfc2119>.

   [RFC8174]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in RFC
              2119 Key Words", BCP 14, RFC 8174, DOI 10.17487/RFC8174,
              May 2017, <https://www.rfc-editor.org/info/rfc8174>.
```

---
### **6.2.  Informative References**

```text
   [AE]       Bellare, M. and C. Namprempre, "Authenticated Encryption:
              Relations among notions and analysis of the generic
              composition paradigm", DOI 10.1007/s00145-008-9026-x,
              September 2008,
              <http://dl.acm.org/citation.cfm?id=1410269>.

   [Cache-Collisions]
              Bonneau, J. and I. Mironov, "Cache-Collision Timing
              Attacks Against AES", 2006,
              <http://research.microsoft.com/pubs/64024/aes-timing.pdf>.

   [FIPS-197]
              National Institute of Standards and Technology, "Advanced
              Encryption Standard (AES)", FIPS PUB 197, November 2001,
              <http://csrc.nist.gov/publications/fips/fips197/
              fips-197.pdf>.

   [LatinDances]
              Aumasson, J., Fischer, S., Khazaei, S., Meier, W., and C.
              Rechberger, "New Features of Latin Dances: Analysis of
              Salsa, ChaCha, and Rumba", December 2007,
              <http://cr.yp.to/rumba20/newfeatures-20071218.pdf>.

   [LatinDances2]
              Ishiguro, T., Kiyomoto, S., and Y. Miyake, "Modified
              version of 'Latin Dances Revisited: New Analytic Results
              of Salsa20 and ChaCha'", February 2012,
              <https://eprint.iacr.org/2012/065.pdf>.

   [NaCl]     Bernstein, D., Lange, T., and P. Schwabe, "NaCl:
              Networking and Cryptography library", July 2012,
              <http://nacl.cr.yp.to>.

   [Poly1305_Donna]
              "poly1305-donna", commit e6ad6e0, March 2016,
              <https://github.com/floodyberry/poly1305-donna>.

   [Procter]  Procter, G., "A Security Analysis of the Composition of
              ChaCha20 and Poly1305", August 2014,
              <http://eprint.iacr.org/2014/613.pdf>.

   [RFC5116]  McGrew, D., "An Interface and Algorithms for Authenticated
              Encryption", RFC 5116, DOI 10.17487/RFC5116, January 2008,
              <https://www.rfc-editor.org/info/rfc5116>.

   [RFC7296]  Kaufman, C., Hoffman, P., Nir, Y., Eronen, P., and T.
              Kivinen, "Internet Key Exchange Protocol Version 2
              (IKEv2)", STD 79, RFC 7296, DOI 10.17487/RFC7296, October
              2014, <https://www.rfc-editor.org/info/rfc7296>.

   [RFC7539]  Nir, Y. and A. Langley, "ChaCha20 and Poly1305 for IETF
              Protocols", RFC 7539, DOI 10.17487/RFC7539, May 2015,
              <https://www.rfc-editor.org/info/rfc7539>.

   [SP800-67]
              National Institute of Standards and Technology,
              "Recommendation for the Triple Data Encryption Algorithm
              (TDEA) Block Cipher", NIST 800-67, Rev. 2, November 2017,
              <https://csrc.nist.gov/publications/detail/sp/800-67/
              rev-2/final>.

   [Standby-Cipher]
              McGrew, D., Grieco, A., and Y. Sheffer, "Selection of
              Future Cryptographic Standards", Work in Progress, draft-
              mcgrew-standby-cipher-00, January 2013.

   [Zhenqing2012]
              Zhenqing, S., Bin, Z., Dengguo, F., and W. Wenling,
              "Improved Key Recovery Attacks on Reduced-Round Salsa20
              and ChaCha*", 2012.
```

---
# **Appendix A.  Additional Test Vectors**

мќґ л¶ЂлЎќмќ н•мњ„ м„№м…м—ђлЉ” м„№м… 2мќ н•мњ„ м„№м…м—ђ мћ€лЉ” м•Њкі л¦¬м¦м—ђ лЊЂн•њ лЌ” л§ЋмќЂ н…ЊмЉ¤нЉё лІЎн„°к°Ђ нЏ¬н•Ёлђм–ґ мћ€мЉµл‹€л‹¤.

---
### **A.1.  The ChaCha20 Block Functions**

```text
  Test Vector #1:
  ==============

  Key:
  000  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
  016  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................

  Nonce:
  000  00 00 00 00 00 00 00 00 00 00 00 00              ............

  Block Counter = 0

    ChaCha state at the end
        ade0b876  903df1a0  e56a5d40  28bd8653
        b819d2bd  1aed8da0  ccef36a8  c70d778b
        7c5941da  8d485751  3fe02477  374ad8b8
        f4b8436a  1ca11815  69b687c3  8665eeb2

  Keystream:
  000  76 b8 e0 ad a0 f1 3d 90 40 5d 6a e5 53 86 bd 28  v.....=.@]j.S..(
  016  bd d2 19 b8 a0 8d ed 1a a8 36 ef cc 8b 77 0d c7  .........6...w..
  032  da 41 59 7c 51 57 48 8d 77 24 e0 3f b8 d8 4a 37  .AY|QWH.w$.?..J7
  048  6a 43 b8 f4 15 18 a1 1c c3 87 b6 69 b2 ee 65 86  jC.........i..e.

  Test Vector #2:
  ==============

  Key:
  000  00 00   Key:
  000  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
  016  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................

  Nonce:
  000  00 00 00 00 00 00 00 00 00 00 00 00              ............

  Block Counter = 1

    ChaCha state at the end
        bee7079f  7a385155  7c97ba98  0d082d73
        a0290fcb  6965e348  3e53c612  ed7aee32
        7621b729  434ee69c  b03371d5  d539d874
        281fed31  45fb0a51  1f0ae1ac  6f4d794b

  Keystream:
  000  9f 07 e7 be 55 51 38 7a 98 ba 97 7c 73 2d 08 0d  ....UQ8z...|s-..
  016  cb 0f 29 a0 48 e3 65 69 12 c6 53 3e 32 ee 7a ed  ..).H.ei..S>2.z.
  032  29 b7 21 76 9c e6 4e 43 d5 71 33 b0 74 d8 39 d5  ).!v..NC.q3.t.9.
  048  31 ed 1f 28 51 0a fb 45 ac e1 0a 1f 4b 79 4d 6f  1..(Q..E....KyMo

  Test Vector #3:
  ==============

  Key:
  000  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
  016  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01  ................

  Nonce:
  000  00 00 00 00 00 00 00 00 00 00 00 00              ............

  Block Counter = 1

    ChaCha state at the end
        2452eb3a  9249f8ec  8d829d9b  ddd4ceb1
        e8252083  60818b01  f38422b8  5aaa49c9
        bb00ca8e  da3ba7b4  c4b592d1  fdf2732f
        4436274e  2561b3c8  ebdd4aa6  a0136c00

  Keystream:
  000  3a eb 52 24 ec f8 49 92 9b 9d 82 8d b1 ce d4 dd  :.R$..I.........
  016  83 20 25 e8 01 8b 81 60 b8 22 84 f3 c9 49 aa 5a  . %....`."...I.Z
  032  8e ca 00 bb b4 a7 3b da d1 92 b5 c4 2f 73 f2 fd  ......;...../s..
  048  4e 27 36 44 c8 b3 61 25 a6 4a dd eb 00 6c 13 a0  N'6D..a%.J...l..

  Test Vector #4:
  ==============

  Key:
  000  00 ff 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
  016  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................

  Nonce:
  000  00 00 00 00 00 00 00 00 00 00 00 00              ............

  Block Counter = 2

    ChaCha state at the end
        fb4dd572  4bc42ef1  df922636  327f1394
        a78dea8f  5e269039  a1bebbc1  caf09aae
        a25ab213  48a6b46c  1b9d9bcb  092c5be6
        546ca624  1bec45d5  87f47473  96f0992e
```

```text
  Keystream:
  000  72 d5 4d fb f1 2e c4 4b 36 26 92 df 94 13 7f 32  r.M....K6&.....2
  016  8f ea 8d a7 39 90 26 5e c1 bb be a1 ae 9a f0 ca  ....9.&^........
  032  13 b2 5a a2 6c b4 a6 48 cb 9b 9d 1b e6 5b 2c 09  ..Z.l..H.....[,.
  048  24 a6 6c 54 d5 45 ec 1b 73 74 f4 87 2e 99 f0 96  $.lT.E..st......
```

```text
  Test Vector #5:
  ==============

  Key:
  000  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
  016  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................

  Nonce:
  000  00 00 00 00 00 00 00 00 00 00 00 02              ............

  Block Counter = 0

    ChaCha state at the end
        374dc6c2  3736d58c  b904e24a  cd3f93ef
        88228b1a  96a4dfb3  5b76ab72  c727ee54
        0e0e978a  f3145c95  1b748ea8  f786c297
        99c28f5f  628314e8  398a19fa  6ded1b53

  Keystream:
  000  c2 c6 4d 37 8c d5 36 37 4a e2 04 b9 ef 93 3f cd  ..M7..67J.....?.
  016  1a 8b 22 88 b3 df a4 96 72 ab 76 5b 54 ee 27 c7  ..".....r.v[T.'.
  032  8a 97 0e 0e 95 5c 14 f3 a8 8e 74 1b 97 c2 86 f7  .....\....t.....
  048  5f 8f c2 99 e8 14 83 62 fa 19 8a 39 53 1b ed 6d  _......b...9S..m
```

---
### **A.2.  ChaCha20 Encryption**

```text
  Test Vector #1:
  ==============

  Key:
  000  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
  016  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................

  Nonce:
  000  00 00 00 00 00 00 00 00 00 00 00 00              ............

  Initial Block Counter = 0

  Plaintext:
  000  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
  016  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
  032  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
  048  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................

  Ciphertext:
  000  76 b8 e0 ad a0 f1 3d 90 40 5d 6a e5 53 86 bd 28  v.....=.@]j.S..(
  016  bd d2 19 b8 a0 8d ed 1a a8 36 ef cc 8b 77 0d c7  .........6...w..
  032  da 41 59 7c 51 57 48 8d 77 24 e0 3f b8 d8 4a 37  .AY|QWH.w$.?..J7
  048  6a 43 b8 f4 15 18 a1 1c c3 87 b6 69 b2 ee 65 86  jC.........i..e.

  Test Vector #2:
  ==============

  Key:
  000  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
  016  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01  ................

  Nonce:
  000  00 00 00 00 00 00 00 00 00 00 00 02              ............

  Initial Block Counter = 1

  Plaintext:
  000  41 6e 79 20 73 75 62 6d 69 73 73 69 6f 6e 20 74  Any submission t
  016  6f 20 74 68 65 20 49 45 54 46 20 69 6e 74 65 6e  o the IETF inten
  032  64 65 64 20 62 79 20 74 68 65 20 43 6f 6e 74 72  ded by the Contr
  048  69 62 75 74 6f 72 20 66 6f 72 20 70 75 62 6c 69  ibutor for publi
  064  63 61 74 69 6f 6e 20 61 73 20 61 6c 6c 20 6f 72  cation as all or
  080  20 70 61 72 74 20 6f 66 20 61 6e 20 49 45 54 46   part of an IETF
  096  20 49 6e 74 65 72 6e 65 74 2d 44 72 61 66 74 20   Internet-Draft
  112  6f 72 20 52 46 43 20 61 6e 64 20 61 6e 79 20 73  or RFC and any s
  128  74 61 74 65 6d 65 6e 74 20 6d 61 64 65 20 77 69  tatement made wi
  144  74 68 69 6e 20 74 68 65 20 63 6f 6e 74 65 78 74  thin the context
  160  20 6f 66 20 61 6e 20 49 45 54 46 20 61 63 74 69   of an IETF acti
  176  76 69 74 79 20 69 73 20 63 6f 6e 73 69 64 65 72  vity is consider
  192  65 64 20 61 6e 20 22 49 45 54 46 20 43 6f 6e 74  ed an "IETF Cont
  208  72 69 62 75 74 69 6f 6e 22 2e 20 53 75 63 68 20  ribution". Such
  224  73 74 61 74 65 6d 65 6e 74 73 20 69 6e 63 6c 75  statements inclu
  240  64 65 20 6f 72 61 6c 20 73 74 61 74 65 6d 65 6e  de oral statemen
  256  74 73 20 69 6e 20 49 45 54 46 20 73 65 73 73 69  ts in IETF sessi
  272  6f 6e 73 2c 20 61 73 20 77 65 6c 6c 20 61 73 20  ons, as well as
  288  77 72 69 74 74 65 6e 20 61 6e 64 20 65 6c 65 63  written and elec
  304  74 72 6f 6e 69 63 20 63 6f 6d 6d 75 6e 69 63 61  tronic communica
  320  74 69 6f 6e 73 20 6d 61 64 65 20 61 74 20 61 6e  tions made at an
  336  79 20 74 69 6d 65 20 6f 72 20 70 6c 61 63 65 2c  y time or place,
  352  20 77 68 69 63 68 20 61 72 65 20 61 64 64 72 65   which are addre
  368  73 73 65 64 20 74 6f                             ssed to

  Ciphertext:
  000  a3 fb f0 7d f3 fa 2f de 4f 37 6c a2 3e 82 73 70  ...}../.O7l.>.sp
  016  41 60 5d 9f 4f 4f 57 bd 8c ff 2c 1d 4b 79 55 ec  A`].OOW...,.KyU.
  032  2a 97 94 8b d3 72 29 15 c8 f3 d3 37 f7 d3 70 05  *....r)....7..p.
  048  0e 9e 96 d6 47 b7 c3 9f 56 e0 31 ca 5e b6 25 0d  ....G...V.1.^.%.
  064  40 42 e0 27 85 ec ec fa 4b 4b b5 e8 ea d0 44 0e  @B.'....KK....D.
  080  20 b6 e8 db 09 d8 81 a7 c6 13 2f 42 0e 52 79 50   ........./B.RyP
  096  42 bd fa 77 73 d8 a9 05 14 47 b3 29 1c e1 41 1c  B..ws....G.)..A.
  112  68 04 65 55 2a a6 c4 05 b7 76 4d 5e 87 be a8 5a  h.eU*....vM^...Z
  128  d0 0f 84 49 ed 8f 72 d0 d6 62 ab 05 26 91 ca 66  ...I..r..b..&..f
  144  42 4b c8 6d 2d f8 0e a4 1f 43 ab f9 37 d3 25 9d  BK.m-....C..7.%.
  160  c4 b2 d0 df b4 8a 6c 91 39 dd d7 f7 69 66 e9 28  ......l.9...if.(
  176  e6 35 55 3b a7 6c 5c 87 9d 7b 35 d4 9e b2 e6 2b  .5U;.l\..{5....+
  192  08 71 cd ac 63 89 39 e2 5e 8a 1e 0e f9 d5 28 0f  .q..c.9.^.....(.
  208  a8 ca 32 8b 35 1c 3c 76 59 89 cb cf 3d aa 8b 6c  ..2.5.<vY...=..l
  224  cc 3a af 9f 39 79 c9 2b 37 20 fc 88 dc 95 ed 84  .:..9y.+7 ......
  240  a1 be 05 9c 64 99 b9 fd a2 36 e7 e8 18 b0 4b 0b  ....d....6....K.
  256  c3 9c 1e 87 6b 19 3b fe 55 69 75 3f 88 12 8c c0  ....k.;.Uiu?....
  272  8a aa 9b 63 d1 a1 6f 80 ef 25 54 d7 18 9c 41 1f  ...c..o..%T...A.
  288  58 69 ca 52 c5 b8 3f a3 6f f2 16 b9 c1 d3 00 62  Xi.R..?.o......b
  304  be bc fd 2d c5 bc e0 91 19 34 fd a7 9a 86 f6 e6  ...-.....4......
  320  98 ce d7 59 c3 ff 9b 64 77 33 8f 3d a4 f9 cd 85  ...Y...dw3.=....
  336  14 ea 99 82 cc af b3 41 b2 38 4d d9 02 f3 d1 ab  .......A.8M.....
  352  7a c6 1d d2 9c 6f 21 ba 5b 86 2f 37 30 e3 7c fd  z....o!.[./70.|.
  368  c4 fd 80 6c 22 f2 21                             ...l".!

  Test Vector #3  Key:
  000  1c 92 40 a5 eb 55 d3 8a f3 33 88 86 04 f6 b5 f0  ..@..U...3......
  016  47 39 17 c1 40 2b 80 09 9d ca 5c bc 20 70 75 c0  G9..@+....\. pu.

  Nonce:
  000  00 00 00 00 00 00 00 00 00 00 00 02              ............

  Initial Block Counter = 42
```

мќјл° н…ЌмЉ¤нЉё: 000 27 54 77 61 73 20 62 72 69 6c 6c 69 67 2c 20 61 'Twas brillig, a 016 6e 64 20 74 68 65 20 73 6c 69 74 68 79 20 74 6f nd the slithy to 032 76 65 73 0a 44 69 64 20 67 79 72 65 20 61 6e 64 ves.Did gyre and 048 20 67 69 6d 62 6c 65 20 69 6e 20 74 68 65 20 77 w 064 61 62 65 3a 0a 41 6c 6c 20 6d 69 6d 73 79 20 77 abe:.лЄЁл‘ђ mimsy w 080 65 72 65 20 74 68 65 20 62 6f 72 6f 67 6f 76 65 ліґлЎњкі лёЊ м•ћм—ђм„њ 096 73 2c 0a 41 6e 64 20 74 68 65 20 6d 6f 6d 65 20мґ€, .к·ёл¦¬кі  м—„л§€лЉ” 112 72 61 74 68 73 20 6f 75 74 67 72 61 62 65 2e RathsлҐј л№„л‚њн•©л‹€л‹¤.

```text
  Ciphertext:
  000  62 e6 34 7f 95 ed 87 a4 5f fa e7 42 6f 27 a1 df  b.4....._..Bo'..
  016  5f b6 91 10 04 4c 0d 73 11 8e ff a9 5b 01 e5 cf  _....L.s....[...
  032  16 6d 3d f2 d7 21 ca f9 b2 1e 5f b1 4c 61 68 71  .m=..!...._.Lahq
  048  fd 84 c5 4f 9d 65 b2 83 19 6c 7f e4 f6 05 53 eb  ...O.e...l....S.
  064  f3 9c 64 02 c4 22 34 e3 2a 35 6b 3e 76 43 12 a6  ..d.."4.*5k>vC..
  080  1a 55 32 05 57 16 ea d6 96 25 68 f8 7d 3f 3f 77  .U2.W....%h.}??w
  096  04 c6 a8 d1 bc d1 bf 4d 50 d6 15 4b 6d a7 31 b1  .......MP..Km.1.
  112  87 b5 8d fd 72 8a fa 36 75 7a 79 7a c1 88 d1     ....r..6uzyz...
```

---
### **A.3.  Poly1305 Message Authentication Code**

н…ЊмЉ¤нЉё лІЎн„° #2м—ђм„њ rмќґ 0кіј к°™мќЊмќ„ мЈјлЄ©н•м„ёмљ”. л€„м‚°кё°м—ђ rмќ„ кі±н•лЉ” Poly1305 м•Њкі л¦¬м¦ л¶Ђл¶„мќЂ rмќґ 0мќё кІЅмљ° н…ЌмЉ¤нЉё л‚ґмљ©м—ђ кґЂкі„м—†мќґ нѓњк·ёк°Ђ sм™Ђ лЏ™мќјн•л‹¤лЉ” кІѓмќ„ мќлЇён•©л‹€л‹¤. л‹¤н–‰мЉ¤лџЅкІЊлЏ„ rмќ„ мѓќм„±н•лЉ” м њм•€лђњ лЄЁл“  л°©лІ•м—ђм„њлЉ” мќґ нЉ№м •н•њ м·Ём•Ѕн•њ н‚¤лҐј м–»мќ„ к°ЂлЉҐм„±мќґ к±°мќ м—†мЉµл‹€л‹¤.

```text
  Test Vector #1:
  ==============

  One-time Poly1305 Key:
  000  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
  016  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
```

MACм—ђ н…ЌмЉ¤нЉё: 000 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 .......... 016 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ....... 032 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ............. ... 048 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ..........

```text
  Tag:
  000  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................

  Test Vector #2:
  ==============

  One-time Poly1305 Key:
  000  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
  016  36 e5 f6 b5 c5 e0 60 70 f0 ef ca 96 22 7a 86 3e  6.....`p...."z.>

  Text to MAC:
  000  41 6e 79 20 73 75 62 6d 69 73 73 69 6f 6e 20 74  Any submission t
  016  6f 20 74 68 65 20 49 45 54 46 20 69 6e 74 65 6e  o the IETF inten
  032  64 65 64 20 62 79 20 74 68 65 20 43 6f 6e 74 72  ded by the Contr
  048  69 62 75 74 6f 72 20 66 6f 72 20 70 75 62 6c 69  ibutor for publi
  064  63 61 74 69 6f 6e 20 61 73 20 61 6c 6c 20 6f 72  cation as all or
  080  20 70 61 72 74 20 6f 66 20 61 6e 20 49 45 54 46   part of an IETF
  096  20 49 6e 74 65 72 6e 65 74 2d 44 72 61 66 74 20   Internet-Draft
  112  6f 72 20 52 46 43 20 61 6e 64 20 61 6e 79 20 73  or RFC and any s
  128  74 61 74 65 6d 65 6e 74 20 6d 61 64 65 20 77 69  tatement made wi
  144  74 68 69 6e 20 74 68 65 20 63 6f 6e 74 65 78 74  thin the context
  160  20 6f 66 20 61 6e 20 49 45 54 46 20 61 63 74 69   of an IETF acti
  176  76 69 74 79 20 69 73 20 63 6f 6e 73 69 64 65 72  vity is consider
  192  65 64 20 61 6e 20 22 49 45 54 46 20 43 6f 6e 74  ed an "IETF Cont
  208  72 69 62 75 74 69 6f 6e 22 2e 20 53 75 63 68 20  ribution". Such
  224  73 74 61 74 65 6d 65 6e 74 73 20 69 6e 63 6c 75  statements inclu
  240  64 65 20 6f 72 61 6c 20 73 74 61 74 65 6d 65 6e  de oral statemen
  256  74 73 20 69 6e 20 49 45 54 46 20 73 65 73 73 69  ts in IETF sessi
  272  6f 6e 73 2c 20 61 73 20 77 65 6c 6c 20 61 73 20  ons, as well as
  288  77 72 69 74 74 65 6e 20 61 6e 64 20 65 6c 65 63  written and elec
  304  74 72 6f 6e 69 63 20 63 6f 6d 6d 75 6e 69 63 61  tronic communica
  320  74 69 6f 6e 73 20 6d 61 64 65 20 61 74 20 61 6e  tions made at an
  336  79 20 74 69 6d 65 20 6f 72 20 70 6c 61 63 65 2c  y time or place,
  352  20 77 68 69 63 68 20 61 72 65 20 61 64 64 72 65   which are addre
  368  73 73 65 64 20 74 6f                             ssed to

  Tag:
  000  36 e5 f6 b5 c5 e0 60 70 f0 ef ca 96 22 7a 86 3e  6.....`p...."z.>

  Test Vector #3:
  ==============

  One-time Poly1305 Key:
  000  36 e5 f6 b5 c5 e0 60 70 f0 ef ca 96 22 7a 86 3e  6.....`p...."z.>
  016  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................

  Text to MAC:
  000  41 6e 79 20 73 75 62 6d 69 73 73 69 6f 6e 20 74  Any submission t
  016  6f 20 74 68 65 20 49 45 54 46 20 69 6e 74 65 6e  o the IETF inten
  032  64 65 64 20 62 79 20 74 68 65 20 43 6f 6e 74 72  ded by the Contr
  048  69 62 75 74 6f 72 20 66 6f 72 20 70 75 62 6c 69  ibutor for publi
  064  63 61 74 69 6f 6e 20 61 73 20 61 6c 6c 20 6f 72  cation as all or
  080  20 70 61 72 74 20 6f 66 20 61 6e 20 49 45 54 46   part of an IETF
  096  20 49 6e 74 65 72 6e 65 74 2d 44 72 61 66 74 20   Internet-Draft
  112  6f 72 20 52 46 43 20 61 6e 64 20 61 6e 79 20 73  or RFC and any s
  128  74 61 74 65 6d 65 6e 74 20 6d 61 64 65 20 77 69  tatement made wi
  144  74 68 69 6e 20 74 68 65 20 63 6f 6e 74 65 78 74  thin the context
  160  20 6f 66 20 61 6e 20 49 45 54 46 20 61 63 74 69   of an IETF acti
  176  76 69 74 79 20 69 73 20 63 6f 6e 73 69 64 65 72  vity is consider
  192  65 64 20 61 6e 20 22 49 45 54 46 20 43 6f 6e 74  ed an "IETF Cont
  208  72 69 62 75 74 69 6f 6e 22 2e 20 53 75 63 68 20  ribution". Such
  224  73 74 61 74 65 6d 65 6e 74 73 20 69 6e 63 6c 75  statements inclu
  240  64 65 20 6f 72 61 6c 20 73 74 61 74 65 6d 65 6e  de oral statemen
  256  74 73 20 69 6e 20 49 45 54 46 20 73 65 73 73 69  ts in IETF sessi
  272  6f 6e 73 2c 20 61 73 20 77 65 6c 6c 20 61 73 20  ons, as well as
  288  77 72 69 74 74 65 6e 20 61 6e 64 20 65 6c 65 63  written and elec
  304  74 72 6f 6e 69 63 20 63 6f 6d 6d 75 6e 69 63 61  tronic communica
  320  74 69 6f 6e 73 20 6d 61 64 65 20 61 74 20 61 6e  tions made at an
  336  79 20 74 69 6d 65 20 6f 72 20 70 6c 61 63 65 2c  y time or place,
  352  20 77 68 69 63 68 20 61 72 65 20 61 64 64 72 65   which are addre
  368  73 73 65 64 20 74 6f                             ssed to

  Tag:
  000  f3 47 7e 7c d9 54 17 af 89 a6 b8 79 4c 31 0c f0  .G~|.T.....yL1..

  Test Vector #4:
  ==============

  One-time Poly1305 Key:
  000  1c 92 40 a5 eb 55 d3 8a f3 33 88 86 04 f6 b5 f0  ..@..U...3......
  016  47 39 17 c1 40 2b 80 09 9d ca 5c bc 20 70 75 c0  G9..@+....\. pu.
```

MACм—ђ ліґл‚ґлЉ” н…ЌмЉ¤нЉё: 000 27 54 77 61 73 20 62 72 69 6c 6c 69 67 2c 20 61 'м°ё л°ќм•м–ґмљ”, 016 6e 64 20 74 68 65 20 73 6c 69 74 68 79 20 74 6f nd the slithy 032 76 65лЎњ 73 0a 44 69 64 20 67 79 72 65 20 61 6e 64 ves.Did gyre and 048 20 67 69 6d 62 6c 65 20 69 6e 20 74 68 65 20 77 w 064 61 62 65 3м•„ 0м•„ 41 6м‹њ 6м‹њ 20 6d 69 6d 73 79 20 77 abe:.лЄЁл“  mimsy w 080 65 72 65 20 74 68 65 20 62 6f 72 6f 67 6f 76 65 ліґлЎњкі лёЊ м•ћм—ђм„њ 096 73 2c 0a 41 6e 64 20 74 68 65 20 6мќј 6н”„ 6мќј 65 20 s,.к·ёл¦¬кі  м—„л§€лЉ” 112 72 61 74 68 73 20 6f 75 74 67 72 61 62 65 2e ratsлҐј л№„л‚њн•©л‹€л‹¤.

```text
  Tag:
  000  45 41 66 9a 7e aa ee 61 e7 08 dc 7c bc c5 eb 62  EAf.~..a...|...b
```

н…ЊмЉ¤нЉё лІЎн„° #5: 130л№„нЉё л¶Ђл¶„ м¶•м†ЊлҐј м‚¬мљ©н•лЉ” кІЅмљ° л¶Ђл¶„ м¶•м†Њлђњ мµњмў… кІ°кіјк°Ђ м™„м „нћ€ м¶•м†Њлђм§Ђ м•ЉлЉ” кІЅмљ°лҐј мЅ”л“њм—ђм„њ мІл¦¬н•©л‹€к№Њ?

```text
   R:
   02 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
   S:
   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
   data:
   FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF
   tag:
   03 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
```

н…ЊмЉ¤нЉё лІЎн„° #6: sлҐј м¶”к°Ђн•л©ґ лЄЁл“€лЎњ 2^128мќґ м¤лІ„н”ЊлЎњлђл©ґ м–ґл–»кІЊ лђл‚мљ”?

```text
   R:
   02 00 00 00   R:
   02 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
   S:
   FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF
   data:
   02 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
   tag:
   03 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
```

н…ЊмЉ¤нЉё лІЎн„° #7: лЌ°мќґн„° м‚¬м§Ђк°Ђ лЄЁл‘ђ 1мќґкі  н•м§Ђм—ђм„њ мєђл¦¬к°Ђ мћ€лЉ” кІЅмљ° м–ґл–»кІЊ лђл‚мљ”?

```text
   R:
   01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
   S:
   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
   data:
   FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF
   F0 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF
   11 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
   tag:
   05 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
```

н…ЊмЉ¤нЉё лІЎн„° #8: л‹¤н•­м‹ќ л¶Ђл¶„мќ мµњмў… кІ°кіјк°Ђ м •н™•нћ€ 2^130-5мќґл©ґ м–ґл–»кІЊ лђл‚мљ”?

```text
   R:
   01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
   S:
   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
   data:
   FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF
   FB FE FE FE FE FE FE FE FE FE FE FE FE FE FE FE
   01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01
   tag:
   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
```

н…ЊмЉ¤нЉё лІЎн„° #9: л‹¤н•­м‹ќ л¶Ђл¶„мќ мµњмў… кІ°кіјк°Ђ м •н™•нћ€ 2^130-6мќґл©ґ м–ґл–»кІЊ лђл‚мљ”?

```text
   R:
   02 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
   S:
   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
   data:
   FD FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF
   tag:
   FA FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF
```

н…ЊмЉ¤нЉё лІЎн„° #10: 5\*H+L мњ н• м¶•м†ЊлЎњ 131л№„нЉё м¤‘к°„ кІ°кіјк°Ђ мѓќм„±лђл©ґ м–ґл–»кІЊ лђл‚мљ”?

```text
   R:
   01 00 00 00 00 00 00 00 04 00 00 00 00 00 00 00
   S:
   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
   data:
   E3 35 94 D7 50 5E 43 B9 00 00 00 00 00 00 00 00
   33 94 D7 50 5E 43 79 CD 01 00 00 00 00 00 00 00
   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
   01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
   tag:
   14 00 00 00 00 00 00 00 55 00 00 00 00 00 00 00
```

н…ЊмЉ¤нЉё лІЎн„° #11: 5\*H+L мњ н• м¶•м†ЊлЎњ 131л№„нЉё мµњмў… кІ°кіјк°Ђ мѓќм„±лђл©ґ м–ґл–»кІЊ лђ©л‹€к№Њ?

```text
   R:
   01 00 00 00 00 00 00 00 04 00 00 00 00 00 00 00
   S:
   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
   data:
   E3 35 94 D7 50 5E 43 B9 00 00 00 00 00 00 00 00
   33 94 D7 50 5E 43 79 CD 01 00 00 00 00 00 00 00
   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
   tag:
   13 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
```

---
### **A.4.  Poly1305 Key Generation Using ChaCha20**

```text
  Test Vector #1:
  ==============
```

ChaCha20 н‚¤: 000 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 .......... 016 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ..........

л…јмЉ¤: 000 00 00 00 00 00 00 00 00 00 00 00 00 ............

```text
  Poly1305 one-time key:
  000  76 b8 e0 ad a0 f1 3d 90 40 5d 6a e5 53 86 bd 28  v.....=.@]j.S..(
  016  bd d2 19 b8 a0 8d ed 1a a8 36 ef cc 8b 77 0d c7  .........6...w..

  Test Vector #2:
  ==============
```

ChaCha20 н‚¤ 000 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 .......... 016 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 ..........

л…јмЉ¤: 000 00 00 00 00 00 00 00 00 00 00 00 02 ............

```text
  Poly1305 one-time key:
  000  ec fa 25 4f 84 5f 64 74 73 d3 cb 14 0d a9 e8 76  ..%O._dts......v
  016  06 cb 33 06 6c 44 7b 87 bc 26 66 dd e3 fb b7 39  ..3.lD{..&f....9
```

```text
  Test Vector #3:
  ==============
```

ChaCha20 н‚¤ 000 1c 92 40 a5 eb 55 d3 8a f3 33 88 86 04 f6 b5 f0 ..@..U...3...... 016 47 39 17 c1 40 2b 80 09 9d ca 5c bc 20 70 75 c0 G9..@+....\. н‘ё.

л…јмЉ¤: 000 00 00 00 00 00 00 00 00 00 00 00 02 ............

```text
  Poly1305 one-time key:
  000  96 5e 3b c6 f9 ec 7e d9 56 08 08 f4 d2 29 f9 4b  .^;...~.V....).K
  016  13 7f f2 75 ca 9b 3f cb dd 59 de aa d2 33 10 ae  ...u..?..Y...3..
```

---
### **A.5.  ChaCha20-Poly1305 AEAD Decryption**

м•„лћм—ђм„њлЉ” л©”м‹њм§ЂлҐј н•ґлЏ…н•лЉ” лЄЁмЉµмќ„ ліј м€ мћ€мЉµл‹€л‹¤. мљ°л¦¬лЉ” м•”нёл¬ё, nonce, нѓњк·ёлҐј л°›мЉµл‹€л‹¤. мљ°л¦¬лЉ” м—ґм‡ лҐј м•Њкі  мћ€мЉµл‹€л‹¤. нѓњк·ёлҐј н™•мќён•њ л‹¤мќЊ \(мњ нљЁн•л‹¤кі  к°Ђм •н•м—¬\) м•”нёл¬ёмќ„ н•ґлЏ…н•кІ мЉµл‹€л‹¤. мќґ нЉ№м • н”„лЎњн† мЅњм—ђм„њлЉ” мќјл° н…ЌмЉ¤нЉём—ђ нЊЁл”©мќґ м—†л‹¤кі  к°Ђм •н•©л‹€л‹¤.

ChaCha20 н‚¤ 000 1c 92 40 a5 eb 55 d3 8a f3 33 88 86 04 f6 b5 f0 ..@..U...3...... 016 47 39 17 c1 40 2b 80 09 9d ca 5c bc 20 70 75 c0 G9..@+....\. н‘ё.

```text
  Ciphertext:
  000  64 a0 86 15 75 86 1a f4 60 f0 62 c7 9b e6 43 bd  d...u...`.b...C.
  016  5e 80 5c fd 34 5c f3 89 f1 08 67 0a c7 6c 8c b2  ^.\.4\....g..l..
  032  4c 6c fc 18 75 5d 43 ee a0 9e e9 4e 38 2d 26 b0  Ll..u]C....N8-&.
  048  bd b7 b7 3c 32 1b 01 00 d4 f0 3b 7f 35 58 94 cf  ...<2.....;.5X..
  064  33 2f 83 0e 71 0b 97 ce 98 c8 a8 4a bd 0b 94 81  3/..q......J....
  080  14 ad 17 6e 00 8d 33 bd 60 f9 82 b1 ff 37 c8 55  ...n..3.`....7.U
  096  97 97 a0 6e f4 f0 ef 61 c1 86 32 4e 2b 35 06 38  ...n...a..2N+5.8
  112  36 06 90 7b 6a 7c 02 b0 f9 f6 15 7b 53 c8 67 e4  6..{j|.....{S.g.
  128  b9 16 6c 76 7b 80 4d 46 a5 9b 52 16 cd e7 a4 e9  ..lv{.MF..R.....
  144  90 40 c5 a4 04 33 22 5e e2 82 a1 b0 a0 6c 52 3e  .@...3"^.....lR>
  160  af 45 34 d7 f8 3f a1 15 5b 00 47 71 8c bc 54 6a  .E4..?..[.Gq..Tj
  176  0d 07 2b 04 b3 56 4e ea 1b 42 22 73 f5 48 27 1a  ..+..VN..B"s.H'.
  192  0b b2 31 60 53 fa 76 99 19 55 eb d6 31 59 43 4e  ..1`S.v..U..1YCN
  208  ce bb 4e 46 6d ae 5a 10 73 a6 72 76 27 09 7a 10  ..NFm.Z.s.rv'.z.
  224  49 e6 17 d9 1d 36 10 94 fa 68 f0 ff 77 98 71 30  I....6...h..w.q0
  240  30 5b ea ba 2e da 04 df 99 7b 71 4d 6c 6f 2c 29  0[.......{qMlo,)
  256  a6 ad 5c b4 02 2b 02 70 9b                       ..\..+.p.
```

л…јмЉ¤: 000 00 00 00 00 01 02 03 04 05 06 07 08 ............

AAD: 000 f3 33 88 86 00 00 00 00 00 00 4e 91 .3........N.

```text
  Received Tag:
  000  ee ad 9d 67 89 0c bb 22 39 23 36 fe a1 85 1f 38  ...g..."9#6....8
```

лЁјм Ђ мќјнљЊмљ© Poly1305 н‚¤лҐј кі„м‚°н•©л‹€л‹¤.

```text
    ChaCha state with key setup
        61707865  3320646e  79622d32  6b206574
        a540921c  8ad355eb  868833f3  f0b5f604
        c1173947  09802b40  bc5cca9d  c0757020
        00000000  00000000  04030201  08070605

    ChaCha state after 20 rounds
        a94af0bd  89dee45c  b64bb195  afec8fa1
        508f4726  63f554c0  1ea2c0db  aa721526
        11b1e514  a0bacc0f  828a6015  d7825481
        e8a4a850  d9dcbbd6  4c2de33a  f8ccd912
```

м¶њл Ґ л°”мќґнЉё: bd:f0:4a:a9:5c:e4:de:89:95:b1:4b:b6:a1:8f:ec:af: 26:47:8f:50:c0:54:f5:63 :db:c0:a2:1e:26:15:72:aa

```text
  Poly1305 one-time key:
  000  bd f0 4a a9 5c e4 de 89 95 b1 4b b6 a1 8f ec af  ..J.\.....K.....
  016  26 47 8f 50 c0 54 f5 63 db c0 a2 1e 26 15 72 aa  &G.P.T.c....&.r.
```

л‹¤мќЊмњјлЎњ AEAD лІ„нЌјлҐј кµ¬м„±н•©л‹€л‹¤.

```text
  Poly1305 Input:
  000  f3 33 88 86 00 00 00 00 00 00 4e 91 00 00 00 00  .3........N.....
  016  64 a0 86 15 75 86 1a f4 60 f0 62 c7 9b e6 43 bd  d...u...`.b...C.
  032  5e 80 5c fd 34 5c f3 89 f1 08 67 0a c7 6c 8c b2  ^.\.4\....g..l..
  048  4c 6c fc 18 75 5d 43 ee a0 9e e9 4e 38 2d 26 b0  Ll..u]C....N8-&.
  064  bd b7 b7 3c 32 1b 01 00 d4 f0 3b 7f 35 58 94 cf  ...<2.....;.5X..
  080  33 2f 83 0e 71 0b 97 ce 98 c8 a8 4a bd 0b 94 81  3/..q......J....
  096  14 ad 17 6e 00 8d 33 bd 60 f9 82 b1 ff 37 c8 55  ...n..3.`....7.U
  112  97 97 a0 6e f4 f0 ef 61 c1 86 32 4e 2b 35 06 38  ...n...a..2N+5.8
  128  36 06 90 7b 6a 7c 02 b0 f9 f6 15 7b 53 c8 67 e4  6..{j|.....{S.g.
  144  b9 16 6c 76 7b 80 4d 46 a5 9b 52 16 cd e7 a4 e9  ..lv{.MF..R.....
  160  90 40 c5 a4 04 33 22 5e e2 82 a1 b0 a0 6c 52 3e  .@...3"^.....lR>
  176  af 45 34 d7 f8 3f a1 15 5b 00 47 71 8c bc 54 6a  .E4..?..[.Gq..Tj
  192  0d 07 2b 04 b3 56 4e ea 1b 42 22 73 f5 48 27 1a  ..+..VN..B"s.H'.
  208  0b b2 31 60 53 fa 76 99 19 55 eb d6 31 59 43 4e  ..1`S.v..U..1YCN
  224  ce bb 4e 46 6d ae 5a 10 73 a6 72 76 27 09 7a 10  ..NFm.Z.s.rv'.z.
  240  49 e6 17 d9 1d 36 10 94 fa 68 f0 ff 77 98 71 30  I....6...h..w.q0
  256  30 5b ea ba 2e da 04 df 99 7b 71 4d 6c 6f 2c 29  0[.......{qMlo,)
  272  a6 ad 5c b4 02 2b 02 70 9b 00 00 00 00 00 00 00  ..\..+.p........
  288  0c 00 00 00 00 00 00 00 09 01 00 00 00 00 00 00  ..Poly1305 нѓњк·ёлҐј кі„м‚°н•кі  мќјм№н•лЉ”м§Ђ н™•мќён•©л‹€л‹¤.

```text
  Calculated Tag:
  000  ee ad 9d 67 89 0c bb 22 39 23 36 fe a1 85 1f 38  ...g..."9#6....8
```

л§€м§Ђл§‰мњјлЎњ м•”нёл¬ёмќ„ н•ґлЏ…н•©л‹€л‹¤.

мќјл° н…ЌмЉ¤нЉё:: 000 49 6e 74 65 72 6e 65 74 2d 44 72 61 66 74 73 20 мќён„°л„· мґ€м•€ 016 61 72 65 20 64 72 61 66 74 20 64 6f 63 75 6d 65лЉ” мґ€м•€ л¬ём„њ 032мћ…л‹€л‹¤. 6e 74 73 20 76 61 6c 69 64 20 66 6f 72 20 61 20 ntsлЉ” 048 6d 61 78 69 6d 75 6d 20 6f 66 20 73 69 78 20 6d мµњлЊЂ 6mм—ђ мњ нљЁн•©л‹€л‹¤. 064 6f 6e 74 68 73 20 61 6e 64 20 6мќј 61 79 20 62 65 мќґн›„ л°Џ 080 20 75 70 64 61 74 65 64 2c 20 72 65 70 6c 61 63 м—…лЌ°мќґнЉёмќј м€ мћ€мќЊ, 096 65 64 2c 20 6f 72 20 6f 62 73 6f 6c 65 74 65 64 ed лђлЉ” кµ¬м‹ќ 112 20 62 79 20 6f 74 68 65 72 20 64 6f 63 75 6d 65 л‹¤лҐё л¬ём„њлЎњ 128 6e 74 73 20 61 74 20 61 6e 79 20 74 69 6d 65 2e nts. 144 20 49 74 20 69 73 20 69 6e 61 70 70 72 6f 70 72 л¶Ђм Ѓм €н•©л‹€л‹¤ 160 69 61 74 65 20 74 6f 20 75 73 65 20 49 6e 74 65 InteлҐј м‚¬мљ©н•лЉ” кІѓмќґ мў‹мЉµл‹€л‹¤ 176 72 6e 65 74 2d 44 72 61 66 74 73 20 61 73 20 72 rnet-Drafts as r 192 65 66 65 72 65 6e 63 65 20 6d 61 74 65 72 69 61 кё°м¤Ђ л¬јм§€ 208 6c 20 6f 72 20 74 6f 20 63 69 74 65 20 74 68 65 л¦¬н„° лђлЉ” 224 6d 20 6f 74 68 65 72 20 74 68 61 6e 20 61 73 20 mмќ„ 240 2f e2 80 9c 77 6f 72 6b 20 69 6e 20 70 72 6f 67 /...prog 256м—ђм„њ мћ‘лЏ™н•лЉ” кІѓмњјлЎњ мќёмљ©н•л ¤л©ґ 72 65 73 73 2e 2f e2 80 9d res./...

---
# **Appendix B.  Performance Measurements of ChaCha20**

л‹¤мќЊ мёЎм •к°’мќЂ 2014л…„ 2м›” 27мќјм—ђ кІЊм‹њлђњ лё”лЎњк·ё кІЊм‹њл¬јм—ђ лЊЂн•ґ Adam Langleyк°Ђ м€н–‰н–€мЉµл‹€л‹¤. м›ђліё лё”лЎњк·ё кІЊм‹њл¬јмќЂ мќґ кёЂмќ„ м“°лЉ” л‹№м‹њ <https://www.imperialviolet.org/2014/02/27/tlssymmetriccryptoм—ђм„њ н™•мќён•  м€ мћ€м—€мЉµл‹€л‹¤. .html\>.

```text
     +----------------------------+-------------+-------------------+
     | Chip                       | AES-128-GCM | ChaCha20-Poly1305 |
     +----------------------------+-------------+-------------------+
     | OMAP 4460                  |  24.1 MB/s  |     75.3 MB/s     |
     | Snapdragon S4 Pro          |  41.5 MB/s  |     130.9 MB/s    |
     | Sandy Bridge Xeon (AES-NI) |   900 MB/s  |      500 MB/s     |
     +----------------------------+-------------+-------------------+

                         Table 1: Speed Comparison
```

---
# **Acknowledgements**

ChaCha20кіј Poly1305лЉ” Daniel J. Bernsteinмќґ л°њлЄ…н–€мЉµл‹€л‹¤. AEAD кµ¬м„±кіј мќјнљЊмљ© Poly1305 н‚¤лҐј мѓќм„±н•лЉ” л°©лІ•мќЂ Adam Langleyк°Ђ л°њлЄ…н–€мЉµл‹€л‹¤.

мњ мљ©н•њ мќкІ¬кіј м„¤лЄ…мќ„ н•ґмЈјм‹  Robert Ransom, Watson Ladd, Stefan Buhler, Dan Harkins л°Џ Kenny Patersonм—ђкІЊ к°ђм‚¬л“њл¦Ѕл‹€л‹¤. мќґ л¬ём„њм—ђм„њ ліґл‹¤ нљЁмњЁм Ѓмќё AEAD кµ¬м„±мќ„ м њм•€н•њ Niels Mollerм—ђкІЊ к°ђм‚¬л“њл¦Ѕл‹€л‹¤. м¶”к°Ђ н…ЊмЉ¤нЉё лІЎн„°м™Ђ мњ мљ©н•њ м„¤лЄ…мќ„ м њкіµн•кі  мќґ л¬ём„њм—ђм„њ кµ¬н„мќ„ м‹њлЏ„н•њ мµњмґ€мќ Ilari Liusvaaraм—ђкІЊ нЉ№лі„нћ€ к°ђм‚¬л“њл¦Ѕл‹€л‹¤. м€м њм™Ђ мќм‚¬мЅ”л“њм—ђ лЊЂн•њ к°њм„ мќ„ м њм•€н•њ Sean Parkinsonм—ђкІЊ к°ђм‚¬л“њл¦Ѕл‹€л‹¤. мќм‚¬ мЅ”л“њмќ лІ„к·ёлҐј м§Ђм Ѓн•њ David Irelandм™Ђ ліґм•€ кі л ¤ м‚¬н•­м—ђм„њ л€„лќЅлђњ мЎ°м–ёмќ„ м§Ђм Ѓн•њ Stephen Farrell л°Џ Alyssa Rowanм—ђкІЊ к°ђм‚¬л“њл¦Ѕл‹€л‹¤.

\[Procter\]мќ кµ¬м„±кіј м¶њнЊђм—ђ лЊЂн•њ ліґм•€ л¶„м„ќмќ„ м€н–‰н•њ Gordon Procterм—ђкІЊ нЉ№лі„н•њ к°ђм‚¬лҐј л“њл¦Ѕл‹€л‹¤.

Jim Schaadм™Ђ John MattsonмќЂ нѓњк·ё мћл¦јм—ђ лЊЂн•њ н”јл“њл°±мќ„ м њкіµн–€мњјл©° Russ Housley, Stanislav Smyshlyaev л°Џ John MattsonмќЂ к°Ѓк°Ѓ мќґ лІ„м „м—ђ лЊЂн•њ л¦¬л·°лҐј м њкіµн–€мЉµл‹€л‹¤.

---
# **Authors' Addresses**

```text
   Yoav Nir
   Dell EMC
   9 Andrei Sakharov St
   Haifa  3190500
   Israel

   Email: ynir.ietf@gmail.com

   Adam Langley
   Google, Inc.

   Email: agl@google.com
```   Email: agl@google.com
```