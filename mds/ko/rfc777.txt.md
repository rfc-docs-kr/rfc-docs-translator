

```text
Network Working Group                                          J. Postel
Request for Comments: 777                                            ISI
                                                              April 1981
Updates:  IENs 109, 128
Updates:  RFC  760

                   Internet Control Message Protocol
```

---
# **Introduction**

인터넷 프로토콜\(IP\)\[1\]은 Catenet\[2\]이라고 하는 상호 연결된 네트워크 시스템에서 호스트 간 데이터그램 서비스에 사용됩니다. 네트워크 연결 장치를 게이트웨이라고 합니다. 이러한 게이트웨이는 GGP\(Gateway to Gateway Protocol\)\[3,4\]를 통해 제어 목적으로 서로 간에 통신합니다. 경우에 따라 게이트웨이 또는 대상 호스트는 예를 들어 데이터그램 처리 오류를 보고하기 위해 소스 호스트와 통신합니다. 이러한 목적을 위해 이 프로토콜인 ICMP\(Internet Control Message Protocol\)가 사용됩니다. ICMP는 상위 수준 프로토콜인 것처럼 IP의 기본 지원을 사용하지만 ICMP는 실제로 IP의 필수 부분이며 모든 IP 모듈에서 구현해야 합니다.

ICMP 메시지는 몇 가지 상황에서 전송됩니다. 예를 들어 데이터그램이 대상에 도달할 수 없는 경우, 게이트웨이에 데이터그램을 전달할 버퍼링 용량이 없는 경우, 게이트웨이가 더 짧은 경로로 트래픽을 전송하도록 호스트에 지시할 수 있는 경우입니다.

인터넷 프로토콜은 절대적으로 신뢰할 수 있도록 설계되지 않았습니다. 이러한 제어 메시지의 목적은 IP를 안정적으로 만드는 것이 아니라 통신 환경의 문제에 대한 피드백을 제공하는 것입니다. 데이터그램이 전달되거나 제어 메시지가 반환된다는 보장은 아직 없습니다. 일부 데이터그램은 손실 보고 없이 여전히 배달되지 않을 수 있습니다. IP를 사용하는 상위 수준 프로토콜은 안정적인 통신이 필요한 경우 고유한 안정성 절차를 구현해야 합니다.

ICMP 메시지는 일반적으로 메시지 등에 대한 메시지의 무한 회귀를 피하기 위해 데이터그램 처리 오류를 보고합니다. ICMP 메시지에 대한 ICMP 메시지는 전송되지 않습니다.

---
# **Message Formats**

ICMP 메시지는 기본 IP 헤더를 사용하여 전송됩니다. 데이터그램 데이터 부분의 첫 번째 옥텟은 ICMP 유형 필드입니다. 이 필드의 값은 나머지 데이터의 형식을 결정합니다. "unused" 레이블이 붙은 모든 필드는 이후 확장을 위해 예약되어 있으며 보낼 때 0이어야 하지만 수신자는 이 필드를 확인해서는 안 됩니다. 개별 형식 설명에 달리 명시되지 않는 한 인터넷 헤더 필드의 값은 다음과 같습니다.

```text
   Version

      4

   IHL
```

- 32비트 단어의 인터넷 헤더 길이.

서비스 유형

```text
      0

   Total Length
```

- 옥텟 단위의 인터넷 헤더 및 데이터 길이.

```text
   Identification, Flags, Fragment Offset
```

- 단편화에 사용됨, \[1\] 참조.

TTL\(Time to Live\)

- 몇 초 안에 살 수 있는 시간; 이 필드는 데이터그램이 처리되는 각 시스템에서 감소하므로 이 필드의 값은 적어도 이 데이터그램이 통과할 게이트웨이의 수만큼 커야 합니다.

```text
   Protocol

      ICMP = 1

   Header Checksum
```

- 헤더에 있는 모든 16비트 워드의 1의 보수 합의 16비트 1의 보수. 체크섬을 계산하려면 체크섬 필드가 0이어야 합니다. 이 체크섬은 나중에 대체될 수 있습니다.

```text
   Source Address
```

- ICMP 메시지를 구성하는 게이트웨이 또는 호스트의 주소. 달리 명시되지 않는 한 이것은 게이트웨이의 주소 중 하나일 수 있습니다.

```text
   Destination Address
```

- 메시지를 보내야 하는 게이트웨이 또는 호스트의 주소입니다.

---
# **Destination Unreachable Message**

```text
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Type      |     Code      |           unused              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Internet Header + 64 bits of Original Data Datagram      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   IP Fields:

   Destination Address
```

- 원래 데이터그램 데이터의 소스 네트워크 및 주소.

```text
   ICMP Fields:

   Type

      3

   Code

      0 = net unreachable;

      1 = host unreachable;

      2 = protocol unreachable;

      3 = port unreachable;
```

- 4 = 조각화가 필요하고 DF가 설정되었습니다.

인터넷 헤더 + 64비트 데이터 데이터그램

- 인터넷 헤더와 원본 데이터그램 데이터의 처음 64비트. 이 데이터는 메시지를 적절한 프로세스에 일치시키기 위해 호스트에서 사용됩니다. 더 높은 수준의 프로토콜이 포트 번호를 사용하는 경우 원래 데이터그램 데이터의 처음 64 데이터 비트에 있다고 가정합니다.

```text
   Description
```

- 게이트웨이의 라우팅 테이블 정보에 따라 데이터그램의 인터넷 대상 필드에 지정된 네트워크에 도달할 수 없는 경우\(예: 네트워크까지의 거리가 무한대인 경우\) 게이트웨이는 대상 도달 불가능 메시지를

- 데이터그램의 인터넷 소스 호스트. 또한 일부 네트워크에서는 게이트웨이가 인터넷 대상 호스트에 연결할 수 없는지 확인할 수 있습니다. 이러한 네트워크의 게이트웨이는 목적지 호스트에 도달할 수 없을 때 소스 호스트에 목적지 도달 불가능 메시지를 보낼 수 있습니다.

- 대상 호스트에서 IP 모듈이 표시된 프로토콜 모듈 또는 프로세스 포트가 활성화되지 않아 데이터그램을 전달할 수 없는 경우 대상 호스트는 대상 호스트에 도달할 수 없음 메시지를 소스 호스트에 보낼 수 있습니다.

- 또 다른 경우는 Don't Fragment 플래그가 켜져 있지만 게이트웨이에서 전달하기 위해 데이터그램을 조각화해야 하는 경우입니다. 이 경우 게이트웨이는 데이터그램을 버리고 목적지에 도달할 수 없다는 메시지를 반환해야 합니다.

---
# **Time Exceeded Message**

```text
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Type      |     Code      |           unused              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Internet Header + 64 bits of Original Data Datagram      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   IP Fields:

   Destination Address
```

- 원래 데이터그램 데이터의 소스 네트워크 및 주소.

```text
   ICMP Fields:

   Type

      11

   Code

      0 = time to live exceeded in transit;

      1 = fragment reassembly time exceeded.
```

인터넷 헤더 + 64비트 데이터 데이터그램

- 인터넷 헤더와 원본 데이터그램 데이터의 처음 64비트. 이 데이터는 메시지를 적절한 프로세스에 일치시키기 위해 호스트에서 사용됩니다. 더 높은 수준의 프로토콜이 포트 번호를 사용하는 경우 원래 데이터그램 데이터의 처음 64 데이터 비트에 있다고 가정합니다.

```text
   Description
```

- 데이터그램을 처리하는 게이트웨이가 TTL\(Time to Live\) 필드가 0인 경우 데이터그램을 폐기해야 합니다. 게이트웨이는 시간 초과 메시지를 통해 소스 호스트에 알릴 수도 있습니다.

- 조각난 데이터그램을 재조립하는 호스트가 제한 시간 내에 조각이 없어 재조립을 완료할 수 없으면 데이터그램을 버리고 시간 초과 메시지를 보낼 수 있습니다.

---
# **Parameter Problem Message**

```text
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Type      |     Code      |   Parameter   |     unused    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Internet Header + 64 bits of Original Data Datagram      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   IP Fields:

   Destination Address
```

- 원래 데이터그램 데이터의 소스 네트워크 및 주소.

```text
   ICMP Fields:

   Type

      12

   Code
```

- 0 = 옵션 문제.

```text
   Parameter
```

- code = 0이면 IP 옵션 유형.

인터넷 헤더 + 64비트 데이터 데이터그램

- 인터넷 헤더와 원본 데이터그램 데이터의 처음 64비트. 이 데이터는 메시지를 적절한 프로세스에 일치시키기 위해 호스트에서 사용됩니다. 더 높은 수준의 프로토콜이 포트 번호를 사용하는 경우 원래 데이터그램 데이터의 처음 64 데이터 비트에 있다고 가정합니다.

```text
   Description
```

- 데이터그램을 처리하는 게이트웨이 또는 호스트가 데이터그램 처리를 완료할 수 없는 헤더 매개변수에 문제가 있는 경우 데이터그램을 폐기해야 합니다. 이러한 문제의 잠재적 원인 중 하나는 구현되지 않은 옵션 또는 옵션의 잘못된 인수입니다. 게이트웨이 또는 호스트는 매개변수 문제 메시지를 통해 소스 호스트에 알릴 수도 있습니다.

---
# **Source Quench Message**

```text
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Type      |                 unused                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Internet Header + 64 bits of Original Data Datagram      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   IP Fields:

   Destination Address
```

- 원래 데이터그램 데이터의 소스 네트워크 및 주소.

```text
   ICMP Fields:

   Type

      4
```

인터넷 헤더 + 64비트 데이터 데이터그램

- 인터넷 헤더와 원본 데이터그램 데이터의 처음 64비트. 이 데이터는 메시지를 적절한 프로세스에 일치시키기 위해 호스트에서 사용됩니다. 더 높은 수준의 프로토콜이 포트 번호를 사용하는 경우 원래 데이터그램 데이터의 처음 64 데이터 비트에 있다고 가정합니다.

```text
   Description
```

- 게이트웨이는 대상 네트워크로 가는 경로에서 다음 네트워크로 출력하기 위해 데이터그램을 대기시키는 데 필요한 버퍼 공간이 없는 경우 인터넷 데이터그램을 버릴 수 있습니다. 게이트웨이가 데이터그램을 버리면 데이터그램의 인터넷 소스 호스트에 소스 종료 메시지를 보낼 수 있습니다. 대상 호스트는 데이터그램이 너무 빨리 도착하여 처리할 수 없는 경우 소스 종료 메시지를 보낼 수도 있습니다. 소스 끄기 메시지는 호스트가 인터넷 대상으로 트래픽을 전송하는 속도를 줄이기 위해 호스트에 요청하는 것입니다. 게이트웨이는 폐기하는 모든 메시지에 대해 소스 종료 메시지를 보낼 수 있습니다. 소스 quench 메시지를 수신하면 소스 호스트는 게이트웨이에서 소스 quench 메시지를 더 이상 수신하지 않을 때까지 지정된 대상으로 트래픽을 보내는 속도를 줄여야 합니다. 그런 다음 소스 호스트는 소스 끄기 메시지를 다시 받을 때까지 대상으로 트래픽을 보내는 속도를 점진적으로 높일 수 있습니다.

- 게이트웨이나 호스트는 용량이 초과될 때까지 기다리지 않고 용량 한계에 도달했을 때 소스 quench 메시지를 보낼 수 있습니다. 이는 소스 quench 메시지를 트리거한 데이터 데이터그램이 전달될 수 있음을 의미합니다.

---
# **Redirect Message**

```text
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Type      |     Code      |            unused             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                 Gateway Internet Address                      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Internet Header + 64 bits of Original Data Datagram      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   IP Fields:

   Destination Address
```

- 원래 데이터그램 데이터의 소스 네트워크 및 주소.

```text
   ICMP Fields:

   Type

      5

   Code
```

- 0 = 네트워크에 대한 데이터그램을 리디렉션합니다.

- 1 = 호스트에 대한 데이터그램을 리디렉션합니다.

- 2 = 서비스 유형 및 네트워크에 대한 데이터그램을 리디렉션합니다.

- 3 = 서비스 유형 및 호스트에 대한 데이터그램을 리디렉션합니다.

```text
   Gateway Internet Address
```

- 원래 데이터그램 데이터의 인터넷 대상 네트워크 필드에 지정된 네트워크에 대한 트래픽이 전송되어야 하는 게이트웨이의 주소.

인터넷 헤더 + 64비트 데이터 데이터그램

- 인터넷 헤더와 원본 데이터그램 데이터의 처음 64비트. 이 데이터는 메시지를 적절한 프로세스에 일치시키기 위해 호스트에서 사용됩니다. 더 높은 수준의 프로토콜이 포트 번호를 사용하는 경우 원래 데이터그램 데이터의 처음 64 데이터 비트에 있다고 가정합니다.

```text
   Description
```

- 게이트웨이는 다음과 같은 상황에서 호스트로 리디렉션 메시지를 보냅니다. 게이트웨이 G1은 게이트웨이가 연결된 네트워크의 호스트로부터 인터넷 데이터그램을 수신합니다. 게이트웨이 G1은 라우팅 테이블을 확인하고 데이터그램의 인터넷 대상 네트워크인 X로 가는 경로에서 다음 게이트웨이 G2의 주소를 얻습니다. G2와 데이터그램의 인터넷 소스 주소로 식별되는 호스트가 동일한 네트워크에 있으면 경로 재지정 메시지가 호스트로 전송됩니다. 경로 재지정 메시지는 네트워크 X에 대한 트래픽을 대상에 대한 더 짧은 경로인 게이트웨이 G2로 직접 보내도록 호스트에 조언합니다. 게이트웨이는 원본 데이터그램의 데이터를 인터넷 대상으로 전달합니다.

---
# **Echo or Echo Reply Message**

```text
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Type      |                  unused                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Data ...
   +-+-+-+-+-

   IP Fields:

   Addresses
```

에코 메시지의 소스 주소는

- 에코 응답 메시지의 목적지. 에코 응답 메시지를 형성하기 위해 소스 및 대상 주소는 간단히 반전됩니다.

```text
   IP Fields:

   Type

      8 for echo message;
```

- 에코 응답 메시지의 경우 0입니다.

```text
   Description
```

- 에코 메시지로 수신된 데이터는 에코 응답 메시지로 반환되어야 합니다.

---
# **Timestamp or Timestamp Reply Message**

```text
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Type      |                  unused                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Originate Timestamp                                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Receive Timestamp                                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Transmit Timestamp                                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   IP Fields:

   Addresses
```

- 타임스탬프 메시지의 소스 주소는 타임스탬프 응답 메시지의 목적지가 됩니다. 타임스탬프 응답 메시지를 구성하기 위해 소스 및 대상 주소는 간단히 반전됩니다.

```text
   IP Fields:

   Type

      13 for timestamp message;
```

- 타임스탬프 응답 메시지의 경우 14입니다.

```text
   Description
```

- 메시지에 수신된 데이터\(타임스탬프\)는 추가 타임스탬프와 함께 응답으로 반환됩니다. 타임스탬프는 UT 자정 이후 32비트 밀리초입니다. 이러한 타임스탬프의 한 가지 용도는 Mills \[5\]에 의해 설명됩니다.

---
# **Summary of Message Types**

```text
    0  Echo Reply

    3  Destination Unreachable

    4  Source Quench

    5  Redirect

    8  Echo

   11  Time Exceeded

   12  Parameter Problem

   13  Timestamp

   14  Timestamp Reply
```

---
# **References**

\[1\] Postel, J., ed., "DOD Standard Internet Protocol", IEN 128, RFC 760, USC/Information Sciences Institute, NTIS ADA079730, 1980년 1월. 등장: Computer Communication Review, Special Interest Group on Data Communications, ACM, V.10, N.4, 1980년 10월.

\[2\] Cerf, V., "인터네트워킹을 위한 Catenet 모델" 정보 처리 기술 사무소, 국방 첨단 연구 계획국, IEN 48, 1978년 7월.

\[3\] Strazisar, V., "게이트웨이 라우팅: 구현

- 사양", IEN 30, Bolt Beranek 및 Newman, 1979년 4월.

\[4\] Strazisar, V., "게이트웨이 구축 방법", IEN 109, Bolt Beranek 및 Newman, 1979년 8월.

```text
   [5]  Mills, D., "DCNET Internet Clock Service," RFC 778, COMSAT
         Laboratories, April 1981.

   
```