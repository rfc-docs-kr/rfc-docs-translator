

```text
Network Working Group                                          D. Burdett
Request for Comments: 2801                                   Commerce One
Category: Informational                                        April 2000

                 Internet Open Trading Protocol - IOTP
                              Version 1.0
```

---
# **Status of this Memo**

이 메모는 인터넷 커뮤니티에 대한 정보를 제공합니다. 어떤 종류의 인터넷 표준도 지정하지 않습니다. 이 메모의 배포는 무제한입니다.

---
# **Copyright Notice**

저작권\(C\)인터넷학회\(2000\). 판권 소유.

---
# **Abstract**

IOTP\(Internet Open Trading Protocol\)는 인터넷 상거래를 위한 상호 운용 가능한 프레임워크를 제공합니다. 결제 시스템 독립적이며 SET, Secure Channel Credit/Debit, Mondex, CyberCoin, GeldKarte 등과 같은 결제 시스템을 캡슐화합니다. IOTP는 판매자가 쇼핑 사이트, 결제 핸들러, 배달 핸들러 등의 역할을 하는 경우를 처리할 수 있습니다. 상품 또는 서비스와 고객 지원 제공자는 서로 다른 당사자 또는 일방에 의해 수행됩니다.

---
# **Table of Contents**

```text
   1.  Background .....................................................7
     1.1  Commerce on the Internet, a Different Model .................7
     1.2  Benefits of IOTP ............................................9
     1.3  Baseline IOTP ..............................................10
     1.4  Objectives of Document .....................................10
     1.5  Scope of Document ..........................................11
     1.6  Document Structure .........................................11
     1.7  Intended Readership ........................................13
         1.7.1  Reading Guidelines ...................................13
   2.  Introduction ..................................................14
     2.1  Trading Roles ..............................................16
     2.2  Trading Exchanges ..........................................18
         2.2.1  Offer Exchange .......................................19
         2.2.2  Payment Exchange .....................................21
         2.2.3  Delivery Exchange ....................................24
         2.2.4  Authentication Exchange ..............................26
     2.3  Scope of Baseline IOTP .....................................28
   3.  Protocol Structure ............................................31
     3.1  Overview ...................................................32
         3.1.1  IOTP Message Structure ...............................32
         3.1.2  IOTP Transactions ....................................34
     3.2  IOTP Message ...............................................35
         3.2.1  XML Document Prolog ..................................37
     3.3  Transaction Reference Block ................................37
         3.3.1  Transaction Id Component .............................38
         3.3.2  Message Id Component .................................39
         3.3.3  Related To Component .................................41
     3.4  ID Attributes ..............................................42
         3.4.1  IOTP Message ID Attribute Definition .................43
         3.4.2  Block and Component ID Attribute Definitions .........44
         3.4.3  Example of use of ID Attributes ......................46
     3.5  Element References .........................................46
     3.6  Extending IOTP .............................................48
         3.6.1  Extra XML Elements ...................................49
         3.6.2  Opaque Embedded Data .................................50
     3.7  Packaged Content Element ...................................50
         3.7.1  Packaging HTML .......................................52
         3.7.2  Packaging XML ........................................53
     3.8  Identifying Languages ......................................54
     3.9  Secure and Insecure Net Locations ..........................54
     3.10 Cancelled Transactions .....................................55
         3.10.1 Cancelling Transactions ..............................55
         3.10.2 Handling Cancelled Transactions ......................56
   4.  IOTP Error Handling ...........................................56
     4.1  Technical Errors ...........................................57
     4.2  Business Errors ............................................57
     4.3  Error Depth ................................................58
         4.3.1  Transport Level ......................................58
         4.3.2  Message Level ........................................58
         4.3.3  Block Level ..........................................59
     4.4  Idempotency, Processing Sequence, and Message Flow .........61
     4.5  Server Role Processing Sequence ............................62
         4.5.1  Initiating Transactions ..............................62
         4.5.2  Processing Input Messages ............................63
         4.5.3  Cancelling a Transaction .............................70
         4.5.4  Retransmitting Messages ..............................70
     4.6  Client Role Processing Sequence ............................71
         4.6.1  Initiating Transactions ..............................71
         4.6.2  Processing Input Messages ............................72
         4.6.3  Cancelling a Transaction .............................74
         4.6.4  Retransmitting Messages ..............................74
   5.  Security Considerations .......................................74
     5.1  Determining whether to use digital signatures ..............74
     5.2  Symmetric and Asymmetric Cryptography ......................76
     5.3  Data Privacy ...............................................77
     5.4  Payment Protocol Security ..................................77
   6.  Digital Signatures and IOTP ...................................77
     6.1  How IOTP uses Digital Signatures ...........................77
         6.1.1  IOTP Signature Example ...............................80
         6.1.2  OriginatorInfo and RecipientInfo Elements ............82
         6.1.3  Using signatures to Prove Actions Complete
                Successfully .........................................83
     6.2  Checking a Signature is Correctly Calculated ...............84
     6.3  Checking a Payment or Delivery can occur ...................85
         6.3.1  Check Request Block sent Correct Organisation ........86
         6.3.2  Check Correct Components present in Request Block ....91
         6.3.3  Check an Action is Authorised ........................91
   7.  Trading Components ............................................93
     7.1  Protocol Options Component .................................96
     7.2  Authentication Request Component ...........................97
     7.3  Authentication Response Component ..........................98
     7.4  Trading Role Information Request Component .................99
     7.5  Order Component ...........................................100
         7.5.1  Order Description Content ...........................101
         7.5.2  OkFrom and OkTo Timestamps ..........................101
     7.6  Organisation Component ....................................102
         7.6.1  Organisation IDs ....................................104
         7.6.2  Trading Role Element ................................105
         7.6.3  Contact Information Element .........................108
         7.6.4  Person Name Element .................................109
         7.6.5  Postal Address Element ..............................110
     7.7  Brand List Component ......................................111
         7.7.1  Brand Element .......................................113
         7.7.2  Protocol Brand Element ..............................115
         7.7.3  Protocol Amount Element .............................116
         7.7.4  Currency Amount Element .............................117
         7.7.5  Pay Protocol Element ................................118
     7.8  Brand Selection Component .................................120
         7.8.1  Brand Selection Brand Info Element ..................122
         7.8.2  Brand Selection Protocol Amount Info Element ........122
         7.8.3  Brand Selection Currency Amount Info Element ........123
     7.9  Payment Component .........................................123
     7.10 Payment Scheme Component ..................................125
     7.11 Payment Receipt Component .................................126
     7.12 Payment Note Component ....................................128
     7.13 Delivery Component ........................................129
         7.13.1 Delivery Data Element ...............................130
     7.14 Consumer Delivery Data Component ..........................132
     7.15 Delivery Note Component ...................................133
     7.16 Status Component ..........................................134
         7.16.1 Offer Completion Codes ..............................137
         7.16.2 Payment Completion Codes ............................138
         7.16.3 Delivery Completion Codes ...........................140
         7.16.4 Authentication Completion Codes .....................142
         7.16.5 Undefined Completion Codes ..........................144
         7.16.6 Transaction Inquiry Completion Codes ................144
     7.17 Trading Role Data Component ...............................144
         7.17.1 Who Receives a Trading Role Data Component ..........145
     7.18 Inquiry Type Component ....................................146
     7.19 Signature Component .......................................147
         7.19.1 IOTP usage of signature elements and attributes .....148
         7.19.2 Offer Response Signature Component ..................150
         7.19.3 Payment Receipt Signature Component .................151
         7.19.4 Delivery Response Signature Component ...............152
         7.19.5 Authentication Request Signature Component ..........152
         7.19.6 Authentication Response Signature Component .........153
         7.19.7 Inquiry Request Signature Component .................153
         7.19.8 Inquiry Response Signature Component ................153
         7.19.9 Ping Request Signature Component ....................153
         7.19.10 Ping Response Signature Component...................154
     7.20 Certificate Component .....................................154
         7.20.1 IOTP usage of signature elements and attributes .....154
     7.21 Error Component ...........................................154
         7.21.1 Error Processing Guidelines .........................157
         7.21.2 Error Codes .........................................158
         7.21.3 Error Location Element ..............................162
   8.  Trading Blocks ...............................................163
     8.1  Trading Protocol Options Block ............................166
     8.2  TPO Selection Block .......................................167
     8.3  Offer Response Block ......................................168
     8.4  Authentication Request Block ..............................169
     8.5  Authentication Response Block .............................170
     8.6  Authentication Status Block ...............................171
     8.7  Payment Request Block .....................................171
     8.8  Payment Exchange Block ....................................173
     8.9  Payment Response Block ....................................173
     8.10 Delivery Request Block ....................................175
     8.11 Delivery Response Block ...................................176
     8.12 Inquiry Request Trading Block .............................177
     8.13 Inquiry Response Trading Block ............................177
     8.14 Ping Request Block ........................................179
     8.15 Ping Response Block .......................................179
     8.16 Signature Block ...........................................181
         8.16.1 Signature Block with Offer Response .................182
         8.16.2 Signature Block with Payment Request ................182
         8.16.3 Signature Block with Payment Response ...............182
         8.16.4 Signature Block with Delivery Request ...............182
         8.16.5 Signature Block with Delivery Response ..............182
     8.17 Error Block ...............................................183
     8.18 Cancel Block ..............................................184
   9.  Internet Open Trading Protocol Transactions ..................184
     9.1  Authentication and Payment Related IOTP Transactions ......185
         9.1.1  Authentication Document Exchange ....................188
         9.1.2  Offer Document Exchange .............................194
         9.1.3  Payment Document Exchange ...........................203
         9.1.4  Delivery Document Exchange ..........................209
         9.1.5  Payment and Delivery Document Exchange ..............212
         9.1.6  Baseline Authentication IOTP Transaction ............216
         9.1.7  Baseline Deposit IOTP Transaction ...................218
         9.1.8  Baseline Purchase IOTP Transaction ..................220
         9.1.9  Baseline Refund IOTP Transaction ....................222
         9.1.10 Baseline Withdrawal IOTP Transaction ................224
         9.1.11 Baseline Value Exchange IOTP Transaction ............226
         9.1.12 Valid Combinations of Document Exchanges ............230
         9.1.13 Combining Authentication Transactions with other
                Transactions ........................................234
     9.2  Infrastructure Transactions ...............................235
         9.2.1  Baseline Transaction Status Inquiry IOTP Transaction 235
         9.2.2  Baseline Ping IOTP Transaction ......................241
   10. Retrieving Logos .............................................244
     10.1 Logo Size .................................................245
     10.2 Logo Color Depth ..........................................245
     10.3 Logo Net Location Examples ................................246
   11. Brands .......................................................246
     11.1 Brand Definitions and Brand Selection .....................246
         11.1.1 Definition of Payment Instrument ....................247
         11.1.2 Definition of Brand .................................247
         11.1.3 Definition of Dual Brand ............................248
         11.1.4 Definition of Promotional Brand .....................248
         11.1.5 Identifying Promotional Brands ......................249
     11.2 Brand List Examples .......................................251
         11.2.1 Simple Credit Card Based Example ....................252
         11.2.2 Credit Card Brand List Including Promotional Brands..253
         11.2.3 Brand Selection Example .............................254
         11.2.4 Complex Electronic Cash Based Brand List ............255
   12. IANA Considerations ..........................................257
     12.1 Codes Controlled by IANA ..................................257
     12.2 Codes not controlled by IANA ..............................263
   13. Internet Open Trading Protocol Data Type Definition ..........263
   14. Glossary .....................................................277
   15. References ...................................................284
   16. Author's Address .............................................287
   17. Full Copyright Statement .....................................290
```

---
# **Table of Figures**

```text
   Figure 1 IOTP Trading Roles                                       16
   Figure 2 Offer Exchange                                           19
   Figure 3 Payment Exchange                                         22
   Figure 4 Delivery Exchange                                        25
   Figure 5 Authentication Exchange                                  27
   Figure 6 IOTP Message Structure                                   33
   Figure 7 An IOTP Transaction                                      34
   Figure 8 Example use of ID attributes                             46
   Figure 9 Element References                                       48
   Figure 10 Signature Digests                                       79
   Figure 11 Example use of Signatures for Baseline Purchase         81
   Figure 12 Checking a Payment Handler can carry out a Payment      87
   Figure 13 Checking a Delivery Handler can carry out a Delivery    90
   Figure 14 Trading Components                                      94
   Figure 15 Brand List Element Relationships                       113
   Figure 16 Trading Blocks                                         164
   Figure 17 Payment and Authentication Message Flow Combinations   187
   Figure 18 Authentication Document Exchange                       190
   Figure 19 Brand Dependent Offer Document Exchange                196
   Figure 20 Brand Independent Offer Exchange                       198
   Figure 21 Payment Document Exchange                              204
   Figure 22 Delivery Document Exchange                             210
   Figure 23 Payment and Delivery Document Exchange                 214
   Figure 24 Baseline Authentication IOTP Transaction               217
   Figure 25 Baseline Deposit IOTP Transaction                      219
   Figure 26 Baseline Purchase IOTP Transaction                     221
   Figure 27 Baseline Refund IOTP Transaction                       223
   Figure 28 Baseline Withdrawal IOTP Transaction                   225
   Figure 29 Baseline Value Exchange IOTP Transaction               228
   Figure 30 Baseline Value Exchange Signatures                     230
   Figure 31 Valid Combinations of Document Exchanges               231
   Figure 32 Baseline Transaction Status Inquiry                    238
   Figure 33 Baseline Ping Messages                                 242
```

---
## **1. Background**

IOTP\(Internet Open Trading Protocol\)는 인터넷 상거래를 위한 상호 운용 가능한 프레임워크를 제공합니다. 결제 시스템 독립적이며 SET, Mondex, CyberCash, DigiCash, GeldKarte 등과 같은 결제 시스템을 캡슐화합니다. IOTP는 판매자가 쇼핑 사이트, 결제 핸들러, 상품 또는 서비스의 배송 핸들러, 고객 지원 제공자는 서로 다른 당사자 또는 한 당사자에 의해 수행됩니다.

IOTP 개발자는 수백 년 동안 존재해 온 종이 기반의 전통적이며 이해되고 수용된 거래, 구매, 판매, 가치 교환 방법인 현실 세계를 안전하게 복제하는 가상 기능을 제공하려고 합니다. 거래 당사자가 누구인지, 거래 수행 방법, 제안 제시, 지불 방법, 지불 영수증 제공, 상품 배송 및 상품 수령에 대한 협상입니다. 이는 실제 무역 과정에서 당연하게 여겨지는 사건들입니다. IOTP는 가상 세계에도 이를 제공하고, 가상 세계의 존재감 확대에 따른 새로운 거래 모델의 도입을 준비하고 제공하기 위해 제작되었습니다.

IOTP 노력의 또 다른 근본적인 이상은 어디에서 생산되든 전자 상거래 기능을 사용하여 IOTP 사양을 준수하는 구매 및 판매를 수행하는 익숙하지 않은 두 당사자가 이벤트를 완료할 수 있도록 이러한 거래 이벤트의 정의를 생성하는 것입니다. 안전하고 성공적으로 사업하세요.

요약하면 IOTP는 다음을 지원합니다.

```text
   o Familiar trading models

   o New trading models

   o Global interoperability
```

이 섹션의 나머지 부분에서는 IOTP가 개발된 이유에 대한 배경을 제공합니다. 사양 자체는 다음 장에서 시작됩니다.

---
## **1.1 Commerce on the Internet, a Different Model**

인터넷의 성장과 전자상거래의 출현은 전 세계적으로 사회, 정치, 정부, 비즈니스 분야에 엄청난 변화를 가져오고 있습니다. 거래 파트너가 의사소통하고, 상거래를 수행하고, 관리하는 방식이 풍부해지고 영원히 바뀌었습니다.

IOTP와 관련된 매우 근본적인 변화 중 하나는 소비자와 판매자의 거래 방식에서 발생하고 있다는 것입니다. 눈에 띄게 변화된 거래 특성은 다음과 같습니다.

o 존재감: 대면 거래는 규칙이 아닌 예외가 됩니다. 이미 우편 주문과 전화 주문이 증가하면서 이러한 변화가 서구 상업에서 감지되었습니다. 인터넷을 통한 전자상거래는 거래하는 기업의 구성원을 직접 보지 않고도 거래의 범위와 규모를 더욱 확대할 것이다.

o 인증: 개인 존재의 중요한 부분은 당사자가 친숙한 물건과 대화를 사용하여 자신이 주장하는 사람이 누구인지 확인하는 능력입니다. 판매자는 구매 결제 부분에서 널리 사용되는 신용 및 직불 수단을 사용할 수 있음을 선언하는 하나 이상의 잘 알려진 금융 로고를 표시합니다. 구매자는 판매자에게 대금을 지급할 것임을 보장하는 정부 또는 금융 기관 신분증을 가져옵니다. 사람들은 공식적인 인증 수단을 강화하기 위해 개인의 외모와 행동, 매장 위치, 상품 브랜드에 대한 명백한 품질과 친숙도, 선명한 눈매와 같은 무형의 요소를 사용합니다.

o 결제 수단: 은행 카드 금융 결제 협회와 그 회원의 엄청난 규모에도 불구하고 세계 무역의 대부분은 여전히 ​​해당 영역의 동전이나 물물교환을 사용하여 이루어집니다. 현재 결제 사업의 인프라는 소액 거래를 경제적으로 지원할 수 없으며 소액 거래를 수용하더라도 그에 따른 거래량으로 인해 생존할 수 없습니다.

o 거래 가치: 판매자가 예를 들어 현실 세계에 존재하지 않는 화폐 단위에 대한 정보 페이지를 제공하고자 하는 인터넷에서 소액 거래에 대한 새로운 의미가 발생합니다.

o 배송: 직접 전자 배송과 같은 새로운 배송 방식이 수용되어야 합니다. 상품이나 서비스의 배송 비용이 극히 낮지만 실제로는 가치가 매우 높은 경우 수령 확인 및 결제 실행 방법이 크게 달라집니다. 또는 값이 높지 않지만 일단 배송이 이루어지면 값이 복구 불가능하게 전달되므로 결제는 최종적이고 환불 불가능해야 하지만 그럼에도 불구하고 결제 전에 배송을 확인해야 합니다. 청취 또는 시청 시간이나 재생 시간과 같은 증분 전달은 가상 세계에서 다소 다르게 작동하는 다른 모델입니다.

---
## **1.2 Benefits of IOTP**

```text
   ELECTRONIC COMMERCE SOFTWARE VENDORS
```

전자 상거래 소프트웨어 공급업체는 다른 공급업체의 소프트웨어와 상호 운용되므로 더욱 매력적인 전자 상거래 제품을 개발할 수 있습니다. 그러나 IOTP는 이러한 솔루션의 통신 방식에 중점을 두기 때문에 제품 차별화를 위한 기회는 여전히 많습니다.

```text
   PAYMENT BRANDS
```

IOTP는 결제 프로토콜을 캡슐화하기 위한 표준 프레임워크를 제공합니다. 이는 결제 제품을 IOTP 솔루션에 통합하는 것이 더 쉽다는 것을 의미합니다. 결과적으로 결제 브랜드는 더욱 광범위하게 배포되고 더욱 다양한 플랫폼에서 이용 가능하게 될 것입니다.

```text
   MERCHANTS
```

판매자에게는 여러 가지 이점이 있습니다.

o 더욱 다양한 결제 브랜드를 제공할 수 있을 것입니다.

o 고객이 구매를 완료하는 데 필요한 소프트웨어를 갖게 될 것이라는 확신을 가질 수 있습니다.

o 고객으로부터 결제 및 배송 영수증을 받음으로써 원래 거래했던 개인 또는 조직과 거래하고 있음을 알면서 고객 관리를 제공할 수 있습니다.

o 새로운 판매자는 IOTP가 제공하는 새로운 거래 기회를 사용하여 새로운 제품과 서비스로 이 새로운 \(인터넷\) 시장에 진입할 수 있습니다.

은행 및 금융 기관

은행 및 금융 기관에도 여러 가지 이점이 있습니다.

o 판매자에게 IOTP 지원을 제공할 수 있습니다.

o IOTP 관련 서비스에 대한 새로운 기회를 찾을 것입니다.

- 가맹점에 대한 고객 관리 제공

- - 신규 결제 및 입금 처리에 따른 수수료

o 새로운 유형의 판매자와 관계를 구축할 수 있는 기회가 있습니다.

```text
   CUSTOMERS
```

고객에게는 다음과 같은 여러 가지 이점이 있습니다.

o 그들은 거래할 수 있는 더 많은 상인을 갖게 될 것입니다.

o 구매 시 더욱 일관된 인터페이스가 있습니다.

```text
   o  there are ways in which they can get their problems fixed through
      the merchant (rather than the bank!)
```

o 예를 들어 회계 시스템에 제공하거나 잠재적으로 세무 당국에 제출하는 데 사용할 수 있는 거래 기록이 있습니다.

---
## **1.3 Baseline IOTP**

이 사양은 Baseline IOTP입니다. 이는 구매 및 환불과 같이 가장 일반적인 인터넷 거래 방법을 포함한다는 점에서 기준입니다.

IOTP 작업을 진행한 그룹은 시간이 지남에 따라 확장 버전이 개발되는 것을 보지만 구현자가 현재 작동하는 솔루션을 개발할 수 있도록 제한된 기능이지만 완전히 사용 가능한 사양에 집중해야 할 필요성을 느낍니다.

이 기간 동안 이 사양의 범위는 변경되지 않으며 문제가 발견된 수정 사항만 변경될 것으로 예상됩니다. 소프트웨어 솔루션은 IOTP가 작동함을 입증하는 이 사양의 이전 버전\(예: 1998년 초에 게시된 버전 0.9 및 1999년에 게시된 버전 1.0의 이전 개정판\)을 기반으로 개발되었습니다.

---
## **1.4 Objectives of Document**

이 문서의 목적은 인터넷 공개 거래 프로토콜을 사용하여 인터넷에서 전자 거래를 지원하는 시스템을 설계하고 구현하는 데 사용할 수 있는 인터넷 공개 거래 프로토콜 버전 1.0의 사양을 제공하는 것입니다.

문서의 목적은 다음과 같습니다.

o 프로토콜을 기반으로 하는 제품의 잠재적인 개발자가 프로토콜을 사용하는 소프트웨어/하드웨어 솔루션을 개발할 수 있도록 허용합니다.

o 금융 서비스 업계가

- 판매자 고객 기반이 현재 사용하거나 고려하고 있는 현재 또는 개발 중인 결제 방식을 \(수정 없이\) 캡슐화하는 전자 상거래 거래 프로토콜을 개발합니다.

---
## **1.5 Scope of Document**

이 프로토콜은 전자 거래 참가자\(소비자, 판매자, 은행, 기타 금융 기관, 고객 관리 제공업체\) 간에 전달되는 메시지의 내용, 형식 및 순서를 설명합니다. 이는 위의 목표에 설명된 전자 상거래를 지원하는 데 필요합니다.

이 프로토콜은 지불인에서 수취인으로의 전자 가치 이동이 거래를 완료하는 데 포함될 수 있는 많은 단계 중 하나일 뿐이지만 중요한 단계인 전체 구매 프로세스를 목표로 하기 때문에 모든 전자 지불 체계에 적용할 수 있도록 설계되었습니다.

IOTP가 지원할 수 있는 결제 체계에는 MasterCard Credit, Visa Credit, Mondex Cash, Visa Cash, GeldKarte, eCash, CyberCoin, Millicent, Proton 등이 포함됩니다.

각 지불 체계에는 해당 체계에 특정한 일부 메시지 흐름이 포함되어 있습니다. 프로토콜의 이러한 체계별 부분은 이 사양에 대한 지불 체계 보완 세트에 포함되어 있습니다.

이 문서는 각 참가자가 구현해야 하는 소프트웨어와 프로세스를 규정하지 않습니다. 이는 거래가 발생하는 데 필요한 프레임워크를 설명합니다.

또한 이 문서는 프로토콜 또는 이를 사용하는 정보 시스템의 구현과 관련된 법적 또는 규제 문제를 다루지 않습니다.

---
## **1.6 Document Structure**

이 문서는 다음 섹션으로 구성됩니다.

o 섹션 1 - 배경: 이 섹션에서는 전자 상거래에 대한 간략한 배경과 IOTP가 제공하는 이점을 제공합니다.

o 섹션 2 - 소개: 이 섹션에서는 다양한 거래 교환을 설명하고 이러한 거래 교환이 IOTP 거래를 구성하는 데 사용되는 방법을 보여줍니다. 이 섹션에서는 전자 거래에 참여하는 다양한 거래 역할도 설명합니다.

o 섹션 3 - 프로토콜 구조: 이 섹션에서는 IOTP 트랜잭션의 기본 구성 요소인 트레이딩 블록 및 트레이딩 구성 요소를 사용하여 다양한 IOTP 트랜잭션을 구성하는 방법을 요약합니다. 모든 IOTP 트랜잭션 메시지는 잘 구성된 XML 문서입니다.

o 섹션 4 - IOTP 오류 처리: 이 섹션에서는 프로토콜 메시지 교환 및 거래 교환 처리 중에 예외 및 오류를 처리하는 방법을 설명합니다. 이 섹션에서는 예외 처리에 대한 일반적인 개요를 제공합니다. 이 섹션을 주의 깊게 읽어야 합니다.

o 섹션 5 - 보안 고려 사항: 이 섹션에서는 IETF 관점에서 IOTP가 보안을 처리하는 방법을 고려합니다. 여기에는 IOTP와 함께 디지털 서명을 사용할지 여부를 결정하는 방법, IOTP가 데이터 개인 정보 보호를 처리하는 방법, 지불 프로토콜에 내장된 보안이 IOTP 보안과 어떻게 관련되는지가 포함됩니다.

o 섹션 6 - 디지털 서명 및 IOTP: 이 섹션에서는 IOTP가 디지털 서명을 사용하는 방법에 대한 개요를 제공합니다. 서명을 확인하는 방법은 올바르게 계산되며 거래에 참여하는 다양한 거래 역할이 필요할 때 서명을 확인하는 방법입니다.

o 섹션 7 - 거래 구성요소: 이 섹션은 거래 구성요소에 필요한 XML 요소를 정의합니다.

o 섹션 8 - 거래 블록: 이 섹션에서는 거래 구성요소로부터 거래 블록을 구성하는 방법을 설명합니다.

o 섹션 9 - 인터넷 개방형 거래 프로토콜 트랜잭션: 이 섹션에서는 모든 IOTP 기본 트랜잭션을 설명합니다. 이는 거래 블록, 거래 구성요소 및 서명을 의미합니다. 이 섹션에서는 프로토콜 교환 중 오류 처리를 직접 연결하지 않습니다. 독자는 이 섹션을 읽기 전에 섹션에 정의된 대로 오류 처리를 이해하는 것이 좋습니다.

o 섹션 10 - 로고 검색: 이 섹션에서는 IOTP 특정 로고를 검색할 수 있는 방법을 설명합니다.

o 섹션 11 - 브랜드: 이 섹션에서는 소비자가 판매자가 제공한 목록에서 브랜드를 선택할 수 있는 방법을 설명하는 브랜드 정의 및 브랜드 선택에 대한 개요를 제공합니다. 브랜드 목록의 몇 가지 예도 포함됩니다.

o 섹션 12 - IANA 고려 사항: 이 섹션에서는 IOTP에서 사용하는 코드의 새로운 값이 어떻게 조정되는지 설명합니다.

o 섹션 13 - 인터넷 개방형 거래 프로토콜 데이터 유형 정의: 이 섹션에는 IOTP에 대한 XML 데이터 유형 정의가 포함되어 있습니다.

o 섹션 14 - 용어집. 이는 IOTP에서 사용되는 모든 주요 용어를 설명합니다.

o 섹션 15 - IOTP 사양에서 참조하는 기타 문서 목록입니다.

o 섹션 16 - 저자의 주소

```text
   o  Section 17 - Full Copyright Statement
```

---
## **1.7 Intended Readership**

소프트웨어 및 하드웨어 개발자; 개발 분석가; 비즈니스 및 기술 기획자; 업계 분석가; 상인; 은행 및 기타 결제 처리자 지불 프로토콜의 소유자, 관리인 및 사용자.

---
### **1.7.1 Reading Guidelines**

이 IOTP 사양은 주로 IOTP의 원리를 이해하려는 사람들을 대상으로 하는 순서로 구성됩니다. 그러나 이전 버전의 프로토콜 구현자의 실제 구현 경험을 통해 IOTP를 구현하려는 새로운 독자는 아래 설명된 대로 다른 순서로 문서를 읽는 것을 선호할 수 있습니다.

사양의 전송 독립적인 부분을 검토합니다. 여기에는 다음이 포함됩니다.

```text
   o Section 14 - Glossary

   o Section 1 - Background

   o Section 2 - Introduction

   o Section 3 - Protocol Structure

   o Section 4 - IOTP Error Handling

   o Section 5 - Security Considerations

   o Section 9 - Internet Open Trading Protocol Transactions

   o Section 11 - Brands

   o Section 12 - IANA Considerations

   o Section 10 - Retrieving Logos
```

자세한 XML 정의를 검토하세요.

```text
   o Section 8 - Trading Blocks

   o Section 7 - Trading Components
```

o 섹션 6 - 디지털 서명 및 IOTP

---
## **2. Introduction**

IOTP\(인터넷 공개 거래 프로토콜\)는 다양한 유형의 IOTP 거래를 정의합니다.

o 구매. 이는 제안, 결제 및 선택적으로 배송과 관련된 구매를 지원합니다.

o 환불. 이는 일반적으로 이전 구매로 인한 결제 환불을 지원합니다.

o 가치 교환. 여기에는 하나의 통화 및 결제 방법 조합에서 다른 조합으로 가치가 교환되는 두 가지 결제가 포함됩니다.

o 인증. 이는 한 조직이나 개인이 다른 조직이나 개인이 누구인지 확인할 수 있도록 지원합니다.

o 탈퇴. 금융기관으로부터의 전자현금 인출을 지원합니다.

o 입금. 금융기관의 전자현금 입금을 지원합니다.

o 문의. IOTP 상태에 대한 문의를 지원합니다.

- 진행 중이거나 완료된 거래

오 핑. 이는 하나의 IOTP 인식 애플리케이션이 다른 곳에서 실행되는 다른 IOTP 애플리케이션이 작동하는지 여부를 확인할 수 있는 간단한 쿼리를 지원합니다.

이러한 IOTP 트랜잭션은 최소한의 유용한 트랜잭션 집합으로 식별되었으므로 "기준" 트랜잭션입니다. 최신 버전의 IOTP에는 추가 유형의 트랜잭션이 포함될 수 있습니다.

위의 각 IOTP 트랜잭션에는 다음이 포함됩니다.

o 거래 역할을 수행하는 여러 조직, 그리고

o 일련의 거래 거래소. 각 거래 거래소에는 거래 구성요소 세트의 형태로 거래 역할 간 데이터 교환이 포함됩니다.

거래 역할, 거래 거래소 및 거래 구성요소는 아래에 설명되어 있습니다.

---
## **2.1 Trading Roles**

거래 역할은 조직이 거래에서 취할 수 있는 다양한 부분을 식별합니다. IOTP 내에서 사용되는 5가지 거래 역할은 아래 다이어그램에 설명되어 있습니다.

```text
   *+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*

              Merchant Customer Care Provider resolves   ----------
         ---------------------------------------------->| Merchant |
        |          Consumer disputes and problems       |Cust.Care.|
        |                                               | Provider |
        |                                                ----------
        |
                   Payment Handler accepts or makes     ----------
        |    ------------------------------------------>| Payment  |
        |   |             Payment for Merchant          | Handler  |
        |   |                                            ----------
        v   v
    ----------    Consumer makes purchases or obtains    ----------
   | Consumer |<--------------------------------------->| Merchant |
    ----------             refund from Merchant          ----------
        ^
        |         Delivery Handler supplies goods or     ----------
        |---------------------------------------------->|Deliverer |
                       services for Merchant            | Handler  |
                                                         ----------

   *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*

                    Figure 1 IOTP Trading Roles
```

역할은 다음과 같습니다.

o 소비자. 재화나 용역을 받고 그 대가를 지불하는 개인이나 조직

오 상인. 구매가 이루어지고 상품이나 서비스를 제공할 법적 책임이 있으며 결제된 혜택을 받는 개인 또는 조직

o 지불 처리자. 판매자를 대신하여 소비자로부터 물리적으로 지불금을 받는 실체

o 배달 핸들러. 판매자를 대신하여 소비자에게 상품이나 서비스를 물리적으로 전달하는 주체입니다.

o 판매자 고객 관리 제공자. 가맹점을 대신하여 고객 분쟁 협상 및 해결에 참여하는 주체

역할은 동일한 조직 또는 다른 조직에서 수행될 수 있습니다. 예를 들어:

o 가장 간단한 경우 하나의 물리적 조직\(예: 판매자\)이 구매를 처리하고, 지불을 수락하고, 상품을 배송하고, 판매자 고객 관리를 제공할 수 있습니다.

o 반대쪽 극단적인 경우에는 판매자가 구매를 처리하면서도 소비자에게 은행이나 금융 기관에 비용을 지불하고 익일 택배 회사를 통해 배송하도록 요청하며 문제가 발생할 경우 연중무휴 서비스를 제공하는 기관에 연락하도록 지시할 수 있습니다.

달리 명시하지 않는 한 이 사양에서 소비자, 판매자, 지불 처리자, 배달 처리자 또는 고객 관리 제공자라는 단어가 사용되는 경우 실제 조직이 아닌 거래 역할을 의미합니다.

개별 조직은 여러 역할을 맡을 수 있습니다. 예를 들어, 인터넷에서 상품과 서비스를 판매하는 회사는 상품이나 서비스를 판매할 때 판매자의 역할을, 회사가 상품이나 서비스 자체를 구매할 때 소비자의 역할을 맡을 수 있습니다.

역할이 서로 다른 장소에서 발생하기 때문에 거래가 완료될 수 있도록 거래에 관련된 조직이 데이터를 교환해야 합니다. 즉, 거래 교환을 수행해야 합니다.

---
## **2.2 Trading Exchanges**

인터넷 공개 거래 프로토콜은 거래 역할 간의 데이터 교환을 포함하는 4개의 거래 교환을 식별합니다. 거래 거래소는 다음과 같습니다:

o 제안. 제안 교환을 통해 판매자는 거래가 발생하는 이유를 소비자에게 제공하게 됩니다. 거래를 계속하려면 소비자가 제안을 수락해야 하므로 이를 제안이라고 합니다.

o 지불. 지불 교환은 소비자와 지불 처리자 사이에 일종의 지불을 발생시킵니다. 이는 어느 방향에서든 발생할 수 있습니다.

o 배송. 배송교환소는 온라인 상품 또는 실제 상품에 대한 배송정보를 배송 핸들러로부터 소비자에게 전송하며,

o 인증. 인증 교환은 모든 거래 역할에서 다른 거래 역할을 인증하여 자신이 누구인지 확인하는 데 사용할 수 있습니다.

IOTP 거래는 이러한 거래 거래소의 다양한 조합으로 구성됩니다. 예를 들어, IOTP 구매 거래에는 제안, 지불 및 배송 거래 교환이 포함됩니다. 또 다른 예로, IOTP 가치 교환 거래는 제안 거래 교환과 두 개의 지불 거래 교환으로 구성됩니다.

거래 교환은 다양한 거래 역할 간에 전송되는 거래 구성 요소로 구성됩니다. 가능한 경우 여러 거래소의 구성 요소를 IOTP 메시지 조합으로 압축하여 IOTP 트랜잭션의 왕복 지연 횟수를 최소화합니다. 예를 들어, IOTP 구매 트랜잭션은 추가 소비자 요청 및 응답을 피하기 위해 배달 조직 구성 요소와 제안 응답 구성 요소를 결합합니다.

각 IOTP 거래 거래소에 대한 자세한 내용은 아래에 설명되어 있습니다. 설명의 명확성을 위해 이는 거래 거래소를 독립 실행형 운영인 것처럼 설명합니다. 성능상의 이유로 실제 IOTP 트랜잭션 정의에는 거래 교환이 혼합되어 있습니다.

---
### **2.2.1 Offer Exchange**

제안 교환의 목표는 판매자가 소비자에게 거래에 대한 정보를 제공하여 소비자가 거래를 계속할지 여부를 결정할 수 있도록 하는 것입니다. 이는 아래 그림에 설명되어 있습니다.

\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+ \*+\*+\*+\*+\*+\*+\*+\*+\*+\* 소비자 | 상인
단계 | | 1. 소비자는 거래를 결정하고 HTML 등을 사용하여 거래에 대한 정보\(제안 요청\)를 판매자에게 보냅니다.

```text
     C --> M Data: Information on what is being purchased (Offer Request)
             - outside scope of IOTP
```

2. 판매자는 소비자가 제공한 정보를 확인하고 선택적으로 서명한 제안을 생성하여 소비자에게 보냅니다.

```text
     C <-- M OFFER RESPONSE. Components: Status; Organisation(s)
             (Consumer, DelivTo, Merchant, Payment Handler, Customer
             Care); Order; Payment; Delivery; TradingRoleData (optional)
             Offer Response Signature (optional) that signs other
             components
```

3. 소비자는 가맹점의 정보를 확인하고 계속할지 여부를 결정합니다.

```text
 *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*

                           Figure 2 Offer Exchange
```

제안 교환은 소비자와 판매자 사이에 전달되는 다음 거래 구성요소를 사용합니다.

o 상태 구성 요소는 유효한 제안 응답이 생성되었음을 다른 당사자에게 알리는 데 사용됩니다.

o 조직 구성 요소에는 거래에서 역할을 수행하는 조직을 설명하는 정보가 포함됩니다.

- - 소비자는 소비자가 누구인지, 상품이나 서비스가 배송되는 경우 상품이나 서비스가 배송될 위치에 대한 정보를 제공합니다.

- - 판매자는 판매자, 결제 처리자, 고객 관리 제공자 및 상품이나 서비스가 배송되는 경우 배달 처리자에 대한 정보를 제공하여 이 정보를 강화합니다.

o 주문 구성요소에는 소비자가 제안에 동의할 경우 거래로 인해 발생하게 될 상품 또는 서비스에 대한 설명이 포함되어 있습니다. 이 정보는 판매자가 이를 확인해야 하는 소비자에게 전송됩니다.

o 판매자가 생성한 결제 구성 요소에는 지불 금액, 통화 및 지불 방향에 대한 세부 정보가 포함되어 있습니다. 예를 들어 소비자가 환불을 요청할 수 있습니다. 거래에는 두 번 이상의 지불이 있을 수 있습니다.

o 판매자가 생성한 배송 구성요소는 상품이나 서비스가 배송되는 경우 사용됩니다. 여기에는 우편이나 이메일 등을 통해 배송 방법에 대한 정보가 포함됩니다.

o 거래 역할 데이터 구성 요소에는 판매자가 결제 처리자 또는 배달 처리자와 같은 다른 거래 역할로 전달하려는 데이터가 포함되어 있습니다.

o "제공 응답" 서명 구성요소가 있는 경우 위의 모든 구성요소에 디지털 서명을 하여 무결성을 보장합니다.

판매자가 소비자에게 제공하는 정보의 정확한 내용은 IOTP 거래 유형에 따라 다릅니다. 예를 들어:

o 저가 구매에는 서명이 필요하지 않을 수도 있습니다.

o 지불할 금액은 사용된 지불 브랜드 및 지불 프로토콜에 따라 달라질 수 있습니다.

o 일부 제안에는 상품 배송이 포함되지 않을 수 있습니다.

o 가치 교환에는 두 번의 지불이 포함됩니다.

o 판매자는 고객 관리를 제공할 수 없습니다.

소비자가 판매자에게 제공하는 정보는 다양한 방법을 사용하여 제공됩니다. 예를 들어 다음과 같습니다.

o 소비자의 "쇼핑 경험"의 일부로 \[HTML\] 페이지를 사용합니다.

o 최근 제안된 오픈 프로파일링 표준\(OPS\)을 사용하여,

o 다음과 관련된 조직 구성 요소의 형태로

- 가맹점의 소비자 인증

o IOTP 최신 버전의 주문 구성 요소로 사용됩니다.

---
### **2.2.2 Payment Exchange**

결제 교환의 목표는 소비자가 선택한 결제 브랜드 및 결제 프로토콜을 사용하여 소비자에서 결제 처리자에게 또는 그 반대로 결제가 이루어지는 것입니다. 두 번째 목표는 제안 교환에 설명된 대로 지불을 지불 사유에 연결하는 데 사용할 수 있는 디지털 서명된 지불 영수증을 선택적으로 소비자에게 제공하는 것입니다.

지불 교환은 다양한 방식으로 이루어질 수 있습니다. 거래가 사용된 결제 브랜드 및 프로토콜에 따라 달라지는 가장 일반적인 경우는 아래 다이어그램에 설명되어 있습니다. 더욱 간편한 결제교환이 가능합니다.

\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+ \*+\*+\*+\*+\*+\*+\*+\*+\*+\* 소비자 지불 처리자 | 상인 |
단계 | | | 1. 소비자는 거래를 결정하고 HTML 등을 사용하여 거래에 대한 정보\(제안 요청\)를 판매자에게 보냅니다.

```text
     C --> M        Information on what is being paid for (outside
                    scope of IOTP
```

2. 판매자는 제공할 결제 브랜드, 결제 프로토콜 및 통화/금액을 결정한 다음 브랜드 목록 구성 요소에 배치하고 이를 소비자에게 보냅니다.

```text
     C <-- M        Components: Brand List
```

3. 소비자는 사용할 결제 브랜드, 프로토콜 및 통화/금액을 선택하고 브랜드 선택 구성 요소를 생성하여 가맹점에 보냅니다.

```text
     C --> M        Component: Brand List Selection
```

4. 가맹점은 브랜드 선택을 확인하고 결제 금액 정보를 생성한 후 선택적으로 서명하여 결제를 승인한 후 소비자에게 보냅니다.

```text
     C <-- M        Component: Payment; Organisation(s) (Merchant and
                    Payment Handler); Optional Offer Response Signature
                    that signs other components
```

5. 소비자는 결제금액 정보를 확인하고, OK인 경우 결제 핸들러에게 해당 정보를 전송하여 결제를 시작하도록 요청합니다.

```text
     C --------> P  PAYMENT REQUEST. Components: Status, Payment;
                    Organisations (Merchant and Payment Handler);
                    Trading Role Data (optional); Optional Offer
                    Response Signature that signs other components;
                    Pay Scheme Data
```

6. 결제 핸들러는 선택적 서명을 포함한 정보를 확인하고, OK일 경우 선택한 결제 브랜드 및 결제 프로토콜에 대한 급여 체계 데이터 구성요소 교환을 시작합니다.

```text
     C <-------> P  PAYMENT EXCHANGE. Component: Pay Scheme Data
```

7. 결국 결제 프로토콜 메시지가 완료되어 결제 핸들러가 결제 증거로 소비자에게 결제 영수증과 선택적인 서명을 보냅니다.

```text
     C <-------> P  PAYMENT RESPONSE. Components: Status, Pay Receipt;
                    Payment Note; Trading Role Data (optional);
                    Optional Offer Response Signature; Optional
                    Payment Receipt Signature that binds the payment
                    to the Offer
```

8. 소비자가 결제 영수증을 확인합니다.

```text
 *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*

                          Figure 3 Payment Exchange
```

결제 교환은 소비자, 판매자 및 결제 처리자 간에 전달되는 다음 거래 구성요소를 사용합니다.

o 브랜드 목록 구성 요소에는 결제 브랜드\(예: MasterCard, Visa, Mondex, GeldKarte\), 결제 프로토콜\(예: SET 버전 1.0, Secure Channel Credit Debit\(SCCD - 신용 카드 또는 직불 카드 결제에 사용되는 이름\) 목록이 포함되어 있습니다. 어디

- SSL/TLS 등의 보안 채널 전송 메커니즘과 해당 통화/금액을 사용하여 계정 정보에 대한 무단 접근을 방지합니다. 판매자는 브랜드 목록을 소비자에게 보냅니다. 소비자는 제공되는 결제 브랜드, 프로토콜 및 통화/금액을 소비자가 지원하는 것과 비교하고 선택합니다.

o 브랜드 선택 구성요소에는 소비자의 선택이 포함됩니다. 결제 브랜드, 프로토콜, 통화/금액 및 프로토콜별 정보가 판매자에게 다시 전송됩니다. 이 정보는 제안 교환의 정보를 변경하는 데 사용될 수 있습니다. 예를 들어, 판매자는 상점 카드 사용을 장려하기 위해 할인을 제공하도록 선택할 수 있습니다.

o 상태 구성요소는 이전 교환\(예: 제안 교환\)이 성공적으로 완료되었음을 지불 처리자에게 표시하고 지불 처리자에 의해 지불 교환의 완료 상태를 표시하는 데 사용됩니다.

o 조직 구성요소는 판매자에 의해 생성됩니다. 여기에는 판매자 및 결제 처리자 역할에 대한 세부정보가 포함되어 있습니다.

- - 결제 처리자가 결제를 시작한 판매자를 식별할 수 있도록 판매자 역할이 필요합니다. 일반적으로 지불 처리자가 판매자를 대신하여 지불을 수락\(또는 수행\)한 결과는 지불 처리자가 보유한 판매자 계좌에 대한 신용 또는 차변 거래가 됩니다. 이러한 트랜잭션은 이 IOTP 버전의 범위를 벗어납니다.

- - 결제 핸들러가 결제에 사용될 올바른 결제 핸들러인지 확인할 수 있도록 결제 핸들러 역할이 필요합니다.

o 지불 구성 요소에는 지불 금액, 통화 및 지불 방향에 대한 세부 정보가 포함됩니다.

```text
   o  The "Offer Response" Signature Component, if present, digitally
      signs all of the above components to ensure their integrity. Note
      that the Brand List and Brand Selection Components are not signed
      until the payment information is created (step 4 in the diagram)
```

o 거래 역할 데이터 구성 요소에는 지불 처리기로 전달되어야 하는 다른 역할\(예: 판매자\)이 포함되어 있습니다.

o 결제 체계 구성 요소에는 거래에 사용되는 결제 프로토콜의 메시지가 포함되어 있습니다. 예를 들어 SET 메시지, Mondex 메시지, GeldKarte 메시지 또는 IOTP에서 지원하는 기타 결제 방법 중 하나일 수 있습니다. 결제 내용

- Scheme Component는 IOTP가 다양한 결제 프로토콜과 어떻게 작동하는지 설명하는 보충 자료에 정의되어 있습니다.

o 지급 영수증 구성요소에는 지급 기록이 포함되어 있습니다. 내용은 사용된 결제 프로토콜에 따라 다릅니다.

o "지불 영수증" 서명 구성 요소는 지불 영수증 구성 요소와 제안 응답 서명 모두에 디지털 서명을 하여 지불 증거를 제공합니다. 제안의 서명은 제안에 포함된 주문, 조직 및 배송 구성 요소에 디지털 방식으로 서명됩니다. 이 서명은 결제를 제안에 효과적으로 바인딩합니다.

위의 결제 교환 예시는 가장 일반적인 경우입니다. 더 간단한 경우도 가능합니다. 예를 들어, 지불 금액이 선택한 지불 브랜드 및 프로토콜에 의존하지 않는 경우 3단계에서 생성된 지불 정보는 1단계에서 생성된 브랜드 목록 구성 요소와 동시에 소비자에게 전송될 수 있습니다. 기본 구매 IOTP 거래\(섹션 9.1.8 참조\)에 설명되어 있습니다.

---
### **2.2.3 Delivery Exchange**

배송 교환의 목표는 구매한 상품이 온라인이나 실제 배송을 통해 소비자에게 배송되도록 하는 것입니다. 두 번째 목표는 배송 추적 번호와 같은 배송 세부 정보를 제공하는 "배송 메모"를 소비자에게 제공하는 것입니다. 또한, 배송 결과에 서명을 하여 물리적 배송에 문제가 있는 경우 고객 관리에 활용될 수도 있습니다. 메시지 흐름은 아래 다이어그램에 설명되어 있습니다.

\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+ \*+\*+\*+\*+\*+\*+\*+\*+\*+\* 소비자 배송 | 핸들러 | 상인 |
단계 | | | 1. 소비자는 거래를 결정하고 HTML 등을 사용하여 무엇을 배송하고 누가 배송을 받을지에 대한 정보를 판매자에게 보냅니다.

```text
     C --> M        Information on what is being delivered (outside
                    scope of IOTP)
```

2. 가맹점은 소비자가 제공한 정보를 확인하고 배송 방법에 대한 정보, 배송과 관련된 조직에 대한 정보를 추가하고 선택적으로 이를 노래하여 소비자에게 보냅니다.

```text
     C <-- M        Components: Delivery; Organisations (Delivery
                    Handler, Deliver To); Order, Optional Offer
                    Response Signature
```

3. 소비자는 배송정보가 OK인지 확인하고, 결제 등 배송 승인을 받아 배송 핸들러에게 배송정보를 전송합니다.

```text
     C --------> D  DELIVERY REQUEST. Components: Status; Delivery,
                    Organisations: (Merchant, Delivery Handler,
                    DelivTo); Order, Trading Role Data (optional);
                    Optional Offer Response Signature, Optional
                    Payment Receipt Signature (from Payment Exchange)
```

4. 배송 핸들러는 정보 및 승인을 확인합니다. 전달을 시작하거나 예약하고 선택적으로 서명할 수 있는 전달을 생성한 다음 소비자에게 보내지 않습니다.

```text
     C <-------- D  DELIVERY RESPONSE. Components: Status; Delivery
                    Note, Trading Role Data (optional); Optional
                    Delivery Response Signature
```

5. 소비자는 배송 메모가 정상인지 확인하고 배송 메모에 설명된 대로 배송을 수락하거나 기다립니다.

```text
 *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*

                         Figure 4 Delivery Exchange
```

배달 교환은 다음과 같은 거래 구성요소를 사용합니다.
소비자, 판매자 및 배달 핸들러 간에 전달됩니다.

o 상태 구성 요소는 이전 교환\(예: 제안 교환 또는 지불 교환\)이 성공적으로 완료되었음을 배달 핸들러에게 알리고 배달 핸들러가 배달 교환의 완료 상태를 나타내는 데 사용됩니다.

o 조직 구성 요소에는 배송 대상, 배송 처리자 및 판매자 역할에 대한 세부 정보가 포함됩니다.

- - 배송지 역할은 상품이나 서비스가 배송될 위치를 나타냅니다.

- - 배달 핸들러가 자신이 배달을 수행할 올바른 배달 핸들러인지 확인할 수 있도록 배달 핸들러 역할이 필요합니다.

- - 배달 핸들러가 배송을 시작한 판매자를 식별할 수 있도록 판매자 역할이 필요합니다.

o 주문 구성요소에는 배송될 상품이나 서비스에 대한 정보가 포함되어 있습니다.

o 배송 구성요소에는 우편이나 이메일 등을 통해 배송이 이루어지는 방법에 대한 정보가 포함되어 있습니다.

o "제공 응답" 서명 구성 요소가 있는 경우 위의 모든 구성 요소에 디지털 서명을 하여 무결성을 보장합니다.

o "지불 영수증" 서명 구성 요소는 지불 영수증 구성 요소와 제안 서명에 디지털 서명을 함으로써 지불 증거를 제공합니다. 배달 핸들러가 배달이 승인되었는지 확인하는 데 사용됩니다.

o 배송 메모 구성 요소에는 실제 배송 또는 실제 "전자 제품"과 관련된 고객 관리 정보가 포함되어 있습니다. 소비자의 소프트웨어는 실제 배송에 대한 정보를 해석하지 않지만 배송 당시와 나중에 소비자가 거래 목록에서 이 배송과 관련된 거래를 선택한 경우 정보를 표시할 수 있는 기능이 있어야 합니다.

o "배달 응답" 서명 구성 요소\(있는 경우\)는 배달 처리자가 받은 배달 메모와 제안 응답 또는 지불 응답 서명에 디지털 서명을 하여 배달 결과에 대한 증거를 제공합니다.

---
### **2.2.4 Authentication Exchange**

인증 교환의 목표는 금융 기관과 같은 한 조직이 소비자와 같은 다른 조직이 누구인지 확인할 수 있도록 하는 것입니다.

인증 교환에는 다음이 포함됩니다.

o 인증자 - 인증을 요청하는 조직, 그리고

o 인증 대상자 - 인증되는 조직입니다.

이는 아래 다이어그램에 설명되어 있습니다.

+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\* +\*+\*+\*+\*+\*+\*+\*+\*+\* 조직 1\(인증 대상자\) | 조직 2 | \(인증자\)
단계 | | 1. 첫 번째 조직\(예: 소비자\)은 조직의 인증을 요구하는 조치\(예: HTML 페이지의 버튼 누르기\)를 수행합니다.

```text
     1 --> 2 Need for Authentication (outside scope of IOTP)
```

2. 두 번째 조직은 챌린지 데이터와 인증에 사용될 수 있는 알고리즘 목록을 포함하는 인증 요청 및/또는 조직 정보에 대한 요청을 생성한 다음 이를 첫 번째 조직에 보냅니다.

```text
     1 <-- 2 AUTHENTICATION REQUEST. Components: Authentication
             Request, Trading Role Information Request
```

3. 첫 번째 조직은 선택적으로 인증 요청과 관련된 서명을 확인한 다음 지정된 인증 알고리즘을 사용하여 요청된 조직 정보의 세부 정보와 함께 두 번째 조직으로 다시 전송되는 인증 응답을 생성합니다.

```text
     1 --> 2 AUTHENTICATION RESPONSE. Component: Authentication
             Response, Organisation(s)
```

4. 인증 응답은 챌린지 데이터와 비교하여 첫 번째 조직이 누구인지 확인하고 결과가 상태 구성 요소에 기록되었는지 확인한 다음 첫 번째 조직으로 다시 전송됩니다.

```text
     1 <-- 2 AUTHENTICATION STATUS. Component: Status
```

5. 그런 다음 첫 번째 조직은 선택적으로 상태 및 관련 서명에 표시된 결과를 확인하고 적절한 조치를 취하거나 중지합니다.

```text
 *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*

                      Figure 5 Authentication Exchange
```

인증 교환은 두 조직 간에 전달되는 다음 거래 구성요소를 사용합니다.

o 인증 요청 구성요소

- 인증은 사용할 인증 알고리즘과 선택적 챌린지 데이터를 나타냅니다.

o 조직에 대한 정보\(예: 배송지 주소\)를 요청하는 거래 역할 정보 요청 구성요소.

o 인증 요청 구성요소의 수신자가 생성한 시도 응답을 포함하는 인증 응답 구성요소.

o 거래 역할 정보 요청의 결과를 포함하는 조직 구성 요소

o 인증 응답에 대한 제2자의 검증 결과를 포함하는 상태 구성요소.

---
## **2.3 Scope of Baseline IOTP**

```text
   This specification describes the IOTP Transactions which make up
   Baseline IOTP. As described in the preface, IOTP will evolve over
   time. This section defines the initial conformance criteria for
   implementations that claim to "support IOTP."
```

IOTP 구현 범위를 결정하는 주요 요인은 솔루션이 지원하도록 설계된 역할입니다. IOTP 내의 역할은 섹션 2.1 거래 역할에 자세히 설명되어 있습니다. 역할을 요약하면 판매자, 소비자, 결제 처리자, 배달 처리자 및 고객 관리 제공자가 있습니다.

결제 처리자는 세 가지 유형이 될 수 있습니다.

o 구매의 일부로 결제를 수락하거나 환불의 일부로 결제하는 사람,

o 예금 거래의 일부로 가치를 받는 사람, 또는

o 출금 거래 가치를 발행하는 회사

다음 표는 각 역할에 대해 해당 역할에 대해 지원되어야 하는 IOTP 트랜잭션 및 거래 블록을 정의합니다.

```text
                       Merchants

                        ECash    ECash
                Store   Value    Value    Consumer  Payment   Delivery
                        Issuer Acquirer             Handler   Handler

 TRANSACTIONS
```

---
# **Purchase        Must                        Must**

```text
                       Merchants

                        ECash    ECash
                Store   Value    Value    Consumer  Payment   Delivery
                        Issuer Acquirer             Handler   Handler

Refund          Must                         b)
                                          Depends

Authentication   May     Must     May        b)
                                          Depends
```

---
# **Value Exchange   May                        Must**

```text
Withdrawal               Must                b)
                                          Depends

Deposit                          Must        b)
                                          Depends
```

---
# **Inquiry         Must     Must    Must       May       Must      Must**
---
# **Ping            Must     Must    Must       May       Must      Must**
---
# **TRADING BLOCKS**
---
# **TPO             Must     Must    Must       Must**
---
# **TPO Selection   Must     Must    Must       Must**

```text
Auth-Request     a)               a)         a)
               Depends          Depends   Depends

Auth-Reply       a)               a)         a)
               Depends          Depends   Depends
```

---
# **Offer Response  Must     Must    Must       Must**

```text
Payment                                     Must      Must
Request

Payment                                     Must      Must
Exchange

Payment                                     Must      Must
Response

Delivery                                    Must                Must
Request

Delivery                                    Must                Must
Response

                       Merchants

                        ECash    ECash
                Store   Value    Value    Consumer  Payment   Delivery
                        Issuer Acquirer             Handler   Handler

Inquiry         Must     Must    Must       Must      Must      Must
Request

Inquiry         Must     Must    Must       Must      Must      Must
Response
```

---
# **Ping Request    Must     Must    Must       Must      Must      Must**
---
# **Ping Response   Must     Must    Must       Must      Must      Must**
---
# **Signature       Must     Must    Must     Limited     Must      Must**
---
# **Error           Must     Must    Must       Must      Must      Must**

위의 표에서:

o "반드시"는 거래 역할이 거래 또는 거래 블록을 지원해야 함을 의미합니다.

o "5월"은 구현이 개발자의 선택에 따라 거래 또는 거래 블록을 지원할 수 있음을 의미합니다.

o "의존한다"는 거래 또는 거래 블록의 구현이 다음 조건 중 하나에 달려 있음을 의미합니다.

```text
      -  if Baseline Authentication IOTP Transaction is supported;
```

- IOTP에 정의된 결제 방법에 의해 요구되는 경우

- 보충서류.

o "제한적"은 거래 블록을 이해하고 그 내용을 조작해야 하지만 모든 측면에서 그렇지는 않음을 의미합니다. 특히 서명 블록에서는 소비자가 디지털 서명을 확인할 필요가 없습니다.

IOTP 솔루션은 해당 솔루션이 "IOTP 지원"으로 설명되려면 위 표에 설명된 대로 하나 이상의 역할\(열\)에 필요한 모든 IOTP 트랜잭션 및 거래 블록을 지원해야 합니다.

---
## **3. Protocol Structure**

이전 섹션에서는 다음을 설명하는 소개를 제공했습니다.

o 거래에서 조직이 취할 수 있는 다양한 역할인 거래 역할: 소비자, 판매자, 지불 처리자, 배달 처리자 및 고객 관리 제공자

o 각 거래 거래소는 거래 구성요소 세트의 형태로 거래 역할 간 데이터 교환을 포함하는 거래 거래소입니다.

이 섹션에서는 다음을 설명합니다.

o 트레이딩 구성요소가 트레이딩 블록 및 다양한 트레이딩 역할 간에 \[XML\] 문서 형식으로 물리적으로 전송되는 IOTP 메시지로 구성되는 방법,

o IOTP 트랜잭션을 생성하기 위해 거래 역할 간에 IOTP 메시지를 교환하는 방법

o 트랜잭션 참조 블록을 포함하는 IOTP 메시지의 XML 정의 - IOTP 트랜잭션과 그 안에 있는 IOTP 메시지를 식별하는 XML 요소

o IOTP 메시지, 거래 블록 및 거래 구성 요소를 식별하는 데 사용되는 XML ID 속성의 정의와 이러한 속성이 다른 XML 요소의 요소 참조를 사용하여 참조되는 방법

o IOTP를 확장할 때 기존 IOTP 코드에 대한 추가 XML 요소와 새로운 사용자 정의 값을 어떻게 사용할 수 있는지,

o IOTP가 패키지 콘텐츠 요소를 사용하여 지불 프로토콜 메시지 또는 세부 주문 정의와 같은 데이터를 IOTP 메시지 내에 삽입하는 방법

o IOTP 메시지 내에서 다양한 언어를 사용할 수 있도록 IOTP가 언어를 식별하는 방법

o IOTP가 메시지를 보낼 때 안전한 네트워크 위치와 안전하지 않은 네트워크 위치를 모두 처리하는 방법

o IOTP 거래를 취소하는 방법.

---
## **3.1 Overview**
---
### **3.1.1 IOTP Message Structure**

IOTP 메시지의 구조와 거래 블록 및 거래 구성 요소와의 관계는 아래 다이어그램에 설명되어 있습니다.

```text
*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*

IOTP MESSAGE  <---------- IOTP Message - an XML Document which is
 |                        transported between the Trading Roles
 |-Trans Ref Block <----- Trans Ref Block - contains information which
 |  |                     describes the IOTP Transaction and the IOTP
 |  |                     Message.
 |  |-Trans Id Comp. <--- Transaction Id Component - uniquely
 |  |                     identifies the IOTP Transaction. The Trans Id
 |  |                     Components are the same across all IOTP
 |  |                     messages that comprise a single IOTP
 |  |                     transaction.
 |  |-Msg Id Comp. <----- Message Id Component - identifies and
 |                        describes an IOTP Message within an IOTP
 |                        Transaction
 |-Signature Block <----- Signature Block (optional) - contains one or
 |  |                     more Signature Components and their
 |  |                     associated Certificates
 |  |-Signature Comp. <-- Signature Component - contains digital
 |  |                     signatures. Signatures may sign digests of
 |  |                     the Trans Ref Block and any Trading Component
 |  |                     in any IOTP Message in the same IOTP
 |  |                     transaction.
 |  |-Certificate Comp. < Certificate Component (Optional) Used to check
 |                        the signature.
 |-Trading Block <------- Trading Block - an XML Element within an IOTP
 |  |-Trading Comp.       Message that contains a predefined set of
 |  |-Trading Comp.      Trading Components
 |  |-Trading Comp.
 |  |-Trading Comp. <--- Trading Components - XML Elements within a
 |                        Trading Block that contain a predefined set
 |-Trading Block          of XML elements and attributes containing
 |  |-Trading Comp.       information required to support a Trading
 |  |-Trading Comp.       Exchange
 |  |-Trading Comp.
 |  |-Trading Comp.
 |  |-Trading Comp.

*-*-*-*-*-*--*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*

                      Figure 6 IOTP Message Structure
```

이 다이어그램은 또한 트랜잭션 참조 블록의 개념을 소개합니다. 이 블록에는 무엇보다도 IOTP 트랜잭션에 대한 전역적으로 고유한 식별자가 포함되어 있습니다. 또한 각 블록과 구성 요소에는 IOTP 트랜잭션 내에서 고유한 ID 속성\(섹션 3.4 참조\)이 제공됩니다. 따라서 ID 속성과

거래 참조 블록의 전역 고유 식별자는 모든 거래 블록 또는 거래 구성 요소를 고유하게 식별하는 데 충분합니다.

---
### **3.1.2 IOTP Transactions**

거래 역할 간에 교환되는 사전 정의된 IOTP 메시지 세트는 IOTP 트랜잭션을 구성합니다. 이는 아래 다이어그램에 설명되어 있습니다.

```text
*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*

     CONSUMER                                              MERCHANT
                                                       Generate first
                                                        IOTP Message
                                   ---                        |
                                  |   |                       v
 Process incoming                 | I |                 -------------
  IOTP Message &   <------------- |   | ------------ | IOTP Message |
generate next IOTP                |   |                 -------------
     Message                      | N |
        |                         |   |
        v                         |   |
  -------------                   | T |              Process incoming
 | IOTP Message |  -------------- |   | ----------->  IOTP Message &
  -------------                   |   |                 generate next
                                  | E |                  IOTP Message
                                  |   |                       |
                                  |   |                       v
 Process incoming                 | R |                 -------------
   IOTP Message    <------------- |   | ------------ | IOTP Message |
generate last IOTP                |   |                 -------------
  Message & stop                  | N |
        |                         |   |
        v                         |   |
  -------------                   | E |                  Process last
 | IOTP Message |  -------------- |   | ------------->  incoming IOTP
  -------------                   |   |                Message & stop
        |                         | T |                       |
        v                         |   |                       v
       STOP                        ---                       STOP

*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-

                       Figure 7 An IOTP Transaction
```

위 다이어그램에서는 인터넷이 전송 메커니즘으로 표시됩니다. 반드시 그런 것은 아닙니다. IOTP 메시지는 다양한 전송 메커니즘을 사용하여 전송될 수 있습니다.

이 IOTP 버전의 IOTP 트랜잭션\(섹션 9 참조\)은 구체적으로 다음과 같습니다.

o 구매. 이는 제안, 결제 및 선택적으로 배송과 관련된 구매를 지원합니다.

o 환불. 이는 일반적으로 이전 구매로 인한 결제 환불을 지원합니다.

o 가치 교환. 여기에는 하나의 통화 및 결제 방법 조합에서 다른 조합으로 가치가 교환되는 두 가지 결제가 포함됩니다.

o 인증. 이는 다양한 인증 알고리즘을 사용하여 하나의 거래 역할에 의한 다른 거래 역할의 원격 인증을 지원하고, 예를 들어 제안 생성에 사용하기 위해 인증되는 거래 역할에 대한 조직 정보 제공을 지원합니다.

o 탈퇴. 금융기관으로부터의 전자현금 인출을 지원합니다.

o 입금. 금융기관의 전자현금 입금을 지원합니다.

o Inquiry IOTP 상태에 대한 조회를 지원합니다.

- 진행 중이거나 완료된 거래

o Ping 이는 하나의 IOTP 인식 응용 프로그램이 다른 곳에서 실행되는 다른 IOTP 응용 프로그램이 작동하는지 여부를 확인할 수 있는 간단한 쿼리를 지원합니다.

---
## **3.2 IOTP Message**

앞서 설명한 대로 IOTP 메시지는 거래에 참여하는 다양한 거래 역할 간에 물리적으로 전송되는 \[XML\] 문서입니다.

IOTP 메시지의 XML 정의는 다음과 같습니다.

```text
   <!ELEMENT IotpMessage
      ( TransRefBlk,
        SigBlk?,
        ErrorBlk?,

        ( AuthReqBlk |
          AuthRespBlk |
          AuthStatusBlk |
          CancelBlk |
          DeliveryReqBlk |
          DeliveryRespBlk |
          InquiryReqBlk |
          InquiryRespBlk |
          OfferRespBlk |
          PayExchBlk |
          PayReqBlk |
          PayRespBlk |
          PingReqBlk |
          PingRespBlk |
          TpoBlk |
          TpoSelectionBlk
        )*
      ) >
   <!ATTLIST IotpMessage
     xmlns                     CDATA
     'iotp:ietf.org/iotp-v1.0'

   Content:

   TransRefBlk        This contains information which describes an IOTP
                      Message within an IOTP Transaction (see section
                      3.3 immediately below)

   AuthReqBlk,        These are the Trading Blocks.
   AuthRespBlk,
   DeliveryReqBlk,    The Trading Blocks present within an IOTP Message,
   DeliveryRespBlk    and the content of a Trading Block itself is
   ErrorBlk           dependent on the type of IOTP Transaction being
   InquiryReqBlk,     carried out - see the definition of each
   InquiryRespBlk,    transaction in section 9 Internet Open Trading
   OfferRespBlk,      Protocol Transactions.
   PayExchBlk,
   PayReqBlk,         Full definitions of each Trading Block are
   PayRespBlk,        described in section 8.
   PingReqBlk,
   PingRespBlk,
   SigBlk,
   TpoBlk,
   TpoSelectionBlk

   Attributes:
```

xmlns IOTP 메시지에 대한 \[XML 네임스페이스\] 정의입니다.

---
### **3.2.1 XML Document Prolog**

IOTP 메시지는 XML 문서의 루트 요소입니다. 따라서 적절한 XML 문서 프롤로그가 앞에 와야 합니다. 예를 들어:

```text
   <?XML Version='1.0'?>
   <!DOCTYPE IotpMessage >
   <IotpMessage>
    ...
   </IotpMessage>
```

---
## **3.3 Transaction Reference Block**

트랜잭션 참조 블록에는 IOTP 트랜잭션 및 IOTP 메시지를 식별하는 정보가 포함됩니다. 트랜잭션 참조 블록에는 다음이 포함됩니다.

o IOTP 트랜잭션을 전역적으로 고유하게 식별하는 트랜잭션 ID 구성 요소. 트랜잭션 ID 구성 요소는 단일 IOTP 트랜잭션을 구성하는 모든 IOTP 메시지에서 동일합니다.

o IOTP 메시지에 대한 제어 정보를 제공하고 IOTP 트랜잭션 내에서 IOTP 메시지를 고유하게 식별하는 메시지 ID 구성 요소, 그리고

o 이 IOTP를 연결하는 0개 이상의 관련 구성 요소

- 해당 이벤트의 식별자를 사용하여 다른 IOTP 트랜잭션 또는 다른 이벤트에 대한 트랜잭션입니다.

트랜잭션 참조 블록의 정의는 다음과 같습니다.

```text
   <!ELEMENT TransRefBlk (TransId, MsgId, RelatedTo*) >
   <!ATTLIST TransRefBlk
    ID                 ID      #REQUIRED >

   Attributes:
```

ID IOTP 트랜잭션 내에서 트랜잭션 참조 블록을 고유하게 식별하는 식별자입니다\(섹션 3.4 ID 속성 참조\).

```text
   Content:

   TransId            See 3.3.1 Transaction Id Component immediately
                      below.

   MsgId              See 3.3.2 Message Id Component immediately below.
```

관련 항목 바로 아래의 3.3.3 관련 구성 요소를 참조하십시오.

---
### **3.3.1 Transaction Id Component**

여기에는 IOTP 트랜잭션을 전역적으로 고유하게 식별하는 정보가 포함됩니다. 그 정의는 다음과 같습니다:

```text
   <!ELEMENT TransId EMPTY >
   <!ATTLIST TransId
    ID                 ID      #REQUIRED
    Version            NMTOKEN #FIXED '1.0'
    IotpTransId        CDATA   #REQUIRED
    IotpTransType      CDATA   #REQUIRED
    TransTimeStamp     CDATA   #REQUIRED >

   Attributes:
```

ID IOTP 트랜잭션 내에서 트랜잭션 ID 구성 요소를 고유하게 식별하는 식별자입니다.

버전 IOTP 버전을 식별하므로 IOTP 트랜잭션이 사용하는 IOTP 메시지의 구조를 식별합니다.

IotpTransId IOTP 트랜잭션을 고유하게 식별하는 데이터를 포함합니다. \[RFC 822\]의 메시지 ID 규칙을 준수해야 합니다.

```text
   IotpTransTyp       This is the type of IOTP Transaction being carried
                      out. For Baseline IOTP it identifies a "standard"
                      IOTP Transaction and implies the sequence and
                      content of the IOTP Messages exchanged between the
                      Trading Roles. The valid values for Baseline IOTP
                      are:
                       o BaselineAuthentication
                       o BaselineDeposit
                       o BaselinePurchase
                       o BaselineRefund
                       o BaselineWithdrawal
                       o BaselineValueExchange
                       o BaselineInquiry
                       o BaselinePing
```

- IotpTransType 값은 IotpTransType의 사용자 정의 값을 정의할 수 있는 섹션 12 IANA 고려 사항에 설명된 절차에 따라 관리됩니다.

- IOTP의 이후 버전에서는 이 목록이 확장되어 다양한 유형의 표준 IOTP 트랜잭션을 지원합니다. 또한 트랜잭션 내의 단계 순서가 비표준임을 나타내는 Dynamic 유형을 지원할 가능성이 높습니다.

TransTimeStamp IOTP 트랜잭션을 시작하는 시스템에 내부 시계가 있는 경우 IOTP 트랜잭션이 시작된 시간으로 \[UTC\] 형식으로 설정됩니다.

- 이 속성의 주요 목적은 트랜잭션이 시작된 시간을 지정하여 트랜잭션을 식별하는 대체 방법을 제공하는 것입니다.

- 일부 시스템\(예: 휴대용 장치\)에서는 타임 스탬프를 생성하지 못할 수도 있습니다. 이 경우 이 속성에는 사용할 수 없음에 대한 "NA" 값이 포함되어야 합니다.

---
### **3.3.2 Message Id Component**

메시지 ID 구성 요소는 IOTP 메시지에 대한 제어 정보를 제공할 뿐만 아니라 IOTP 트랜잭션 내에서 IOTP 메시지를 고유하게 식별합니다. 그 정의는 다음과 같습니다.

```text
   <!ELEMENT MsgId EMPTY >
   <!ATTLIST MsgId
    ID                 ID      #REQUIRED
    RespIotpMsg        NMTOKEN #IMPLIED
    xml:lang           NMTOKEN #REQUIRED
    LangPrefList       NMTOKENS #IMPLIED
    CharSetPrefList    NMTOKENS #IMPLIED
    SenderTradingRoleRef NMTOKEN #IMPLIED
    SoftwareId         CDATA   #REQUIRED
    TimeStamp          CDATA   #IMPLIED >

   Attributes:
```

ID IOTP 트랜잭션 내에서 IOTP 메시지를 고유하게 식별하는 식별자입니다\(섹션 3.4 ID 속성 참조\). IOTP 메시지가 다시 전송되면 이 속성의 값은 동일하게 유지됩니다.

```text
   RespIotpMsg            This contains the ID attribute of the Message
                          Id Component of the IOTP Message to which this
                          IOTP Message is a response. In this way all
```

- IOTP 트랜잭션의 IOTP 메시지는 명확하게 서로 연결됩니다. 이 필드는 IOTP 트랜잭션의 첫 번째 IOTP 메시지를 제외한 모든 IOTP 메시지에 필요합니다.

SenderTradingRoleRef IOTP 메시지를 생성한 거래 역할의 요소 참조\(섹션 3.5 참조\)입니다. 이는 트레이딩 블록에 대한 기술적 오류\(섹션 4.1 참조\)가 보고되어야 하는 트레이딩 역할의 네트워크 위치\(섹션 3.9 참조\)를 식별하는 데 사용됩니다.

Xml:lang 하위 요소의 xml:lang 속성으로 재정의되지 않는 한 이 구성 요소 내의 속성 또는 하위 요소에서 사용되는 언어를 정의합니다. 섹션 3.8 언어 식별을 참조하세요.

LangPrefList \[XML\] 언어 식별을 준수하는 언어 코드의 선택적 목록입니다. 이는 보낸 사람이 기본 설정 순서에 따라 메시지 수신자가 응답을 생성할 때 이상적으로 사용해야 하는 언어를 나타내는 데 사용됩니다. 수신자가 표시된 언어 중 하나를 사용하여 응답해야 할 의무는 없지만, 해당 언어 중 하나를 사용하면 향상된 사용자 경험을 제공할 수 있습니다.

CharSetPrefList \[XML\] 문자를 준수하는 문자 세트 식별자의 선택적 목록입니다. 이는 보낸 사람이 기본 설정 순서에 따라 메시지 수신자가 응답을 생성할 때 이상적으로 사용해야 하는 문자 집합을 나타내는 데 사용됩니다. 수신자가 표시된 문자 집합 중 하나를 사용하여 응답해야 할 의무는 없지만 문자 집합 중 하나를 사용하면 향상된 사용자 경험을 제공할 수 있습니다.

```text
   SoftwareId             This contains information which identifies the
                          software which generated the IOTP Message. Its
                          purpose is to help resolve interoperability
                          problems that might occur as a result of
                          incompatibilities between messages produced by
                          different software. It is a single text string
                          in the language defined by xml:lang. It must
                          contain, as a minimum:

                          o the name of the software manufacturer
                          o the name of the software
                          o the version of the software, and
                          o the build of the software
```

TimeStamp 메시지를 보내는 장치에 내부 시계가 있는 경우 IOTP 메시지가 생성된 시간을 \[UTC\] 형식으로 설정합니다.

---
### **3.3.3 Related To Component**

관련 구성 요소는 해당 이벤트의 식별자를 사용하여 IOTP 트랜잭션을 다른 IOTP 트랜잭션 또는 다른 이벤트에 연결합니다. 그 정의는 다음과 같습니다.

```text
   <!ELEMENT RelatedTo (PackagedContent) >
   <!ATTLIST RelatedTo
    ID                 ID      #REQUIRED
    xml:lang           NMTOKEN #REQUIRED
    RelationshipType   NMTOKEN #REQUIRED
    Relation           CDATA   #REQUIRED
    RelnKeyWords       NMTOKENS #IMPLIED >

   Attributes:
```

ID IOTP 트랜잭션 내에서 관련 구성 요소를 고유하게 식별하는 식별자입니다.

xml:lang 하위 요소의 xml:lang 속성으로 재정의되지 않는 한 이 구성 요소 내의 속성 또는 하위 요소에서 사용되는 언어를 정의합니다. 섹션 3.8 언어 식별을 참조하세요.

RelationshipType 관계 유형을 정의합니다. 유효한 값은 다음과 같습니다.

-o IotpTransaction. 이 경우 패키지 콘텐츠 요소에는 다른 IOTP 트랜잭션의 IotpTransId가 포함됩니다. o 참조 이 경우 패키지 콘텐츠 요소에는 IOTP가 아닌 다른 문서의 참조가 포함됩니다.

- RelationshipType 값은 사용자 정의 값 정의를 허용하는 섹션 12 IANA 고려 사항에 정의된 절차에 따라 제어됩니다.

Relation Relation 속성에는 이 구성 요소를 포함하는 IOTP 트랜잭션과 다른 IOTP 트랜잭션 또는 기타 이벤트 간의 관계 특성을 설명하는 xml:lang에 의해 정의된 언어로 된 문구가 포함되어 있습니다. 사용되는 정확한 단어는 IOTP 소프트웨어 구현자에게 달려 있습니다.

- 속성의 목적은 IOTP 거래와 관련된 거래 역할에 거래 간 관계의 성격에 대한 설명을 제공하는 것입니다.

- 관계 속성에 사용된 단어가 관계의 "방향"을 올바르게 나타내도록 주의해야 합니다. 예를 들어, 한 거래가 다른 이전 거래에 대한 환불일 수 있습니다. 이 경우 환불인 거래에는 "refund to" 또는 단순히 "refund"가 아닌 "refund for"와 같은 단어가 Relation 속성에 포함되어야 합니다.

RelnKeyWords 이 속성에는 유사한 관계\(예: 모든 환불\)를 식별하는 데 사용할 수 있는 키워드가 포함되어 있습니다. 실제 활용도 조사를 통해 추천 키워드가 개발될 것으로 예상된다. 이 버전의 사양에는 구체적인 권장 사항이 없으며 사용되는 키워드는 구현자의 재량에 따릅니다.

```text
   Content:
```

PackagedContent 패키지 콘텐츠\(섹션 3.7 참조\)에는 관련 거래를 식별하는 데이터가 포함되어 있습니다. 해당 형식은 RelationshipType 값에 따라 달라집니다.

---
## **3.4 ID Attributes**

IOTP 메시지, 블록\(예: 거래 참조 블록 및 거래 블록\), 거래 구성 요소\(거래 ID 구성 요소 및 서명 구성 요소 포함\) 및 일부 하위 요소에는 각각 인스턴스를 식별하는 데 사용되는 XML "ID" 속성이 제공됩니다. 이러한 XML 요소. 이러한 식별자는 한 요소를 다른 요소에서 참조할 수 있도록 사용됩니다. 이러한 모든 속성에는 속성 이름 ID가 부여됩니다.

각 ID 속성의 값은 IOTP 트랜잭션 내에서 고유합니다. 즉, 전역적으로 고유한 트랜잭션 ID 구성 요소가 동일한 IOTP 메시지 집합입니다. 또한 요소의 ID 속성에 값이 할당되면 변경되지 않습니다. 이는 요소가 복사될 때마다 ID 속성의 값이 동일하게 유지됨을 의미합니다.

결과적으로 이러한 ID를 사용하여 요소 참조를 사용하는 동일한 IOTP 트랜잭션의 다른 IOTP 메시지, 블록 또는 구성 요소에서 IOTP 메시지, 블록 또는 구성 요소의 콘텐츠를 참조하고 찾을 수 있습니다\(섹션 3.5 참조\).

이 섹션에서는 IOTP 메시지, 블록 및 구성 요소의 ID 속성 값을 설정하기 위한 규칙을 정의합니다.

---
### **3.4.1 IOTP Message ID Attribute Definition**

IOTP 메시지의 메시지 ID 구성 요소의 ID 속성은 IOTP 트랜잭션 내에서 고유해야 합니다. 그 정의는 다음과 같습니다.

```text
   IotpMsgId_value  ::= IotpMsgIdPrefix IotpMsgIdSuffix
   IotpMsgIdPrefix  ::= NameChar (NameChar)*
   IotpMsgIdSuffix  ::= Digit (Digit)*

   IotpMsgIdPrefix    Apart from messages which contain: an Inquiry
                      Request Trading Block, an Inquiry Response Trading
                      Block, a Ping Request Trading Block or a Ping
                      Response Trading Block; then the same prefix is
                      used for all messages sent by the Merchant or
                      Consumer role as follows:

                       o "M" - Merchant
                       o "C" - Consumer
```

- 인콰이어리 요청 트레이딩 블록 또는 핑 요청 트레이딩 블록을 포함하는 메시지의 경우 인콰이어리의 접두사는 "I"로 설정됩니다.

- 문의 응답 거래 블록 또는 Ping 응답 거래 블록이 포함된 메시지의 경우 접두사는 "Q"로 설정됩니다.

- 거래의 다른 역할에 대한 접두사는 역할에 대한 조직 구성 요소 내에 포함되며 일반적으로 판매자가 설정합니다. 다음은 지침으로 권장되며 의존해서는 안 됩니다.

```text
                       o "P" - First (only) Payment Handler
                       o "R" - Second Payment Handler
                       o "D" - Delivery Handler
                       o "C" - Deliver To
```

- 지침에 따라 접두사는 한 문자로 제한되어야 합니다.

- NameChar는 NameChar의 \[XML\] 정의와 동일한 정의를 갖습니다.

```text
   IotpMsgIdSuffix    The suffix consists of one or more digits. The
                      suffix must be unique within a Trading Role within
                      an IOTP Transaction. The following is recommended
                      as a guideline and must not be relied upon:

                       o the first IOTP Message sent by a trading role
                         is given the suffix "1"
                       o the second and subsequent IOTP Messages sent
                         by the same trading role are incremented by one
                         for each message
                       o no leading zeroes are included in the suffix
```

- 더 간단히 말하면 소비자가 보낸 첫 번째 IOTP 메시지의 메시지 ID 구성 요소는 ID 속성 "C1", 두 번째 "C2", 세 번째 "C3" 등을 갖습니다.

- Digit은 Digit의 \[XML\] 정의와 동일한 정의를 갖습니다.

---
### **3.4.2 Block and Component ID Attribute Definitions**

블록 및 구성요소의 ID 속성은 IOTP 트랜잭션 내에서도 고유해야 합니다. 그들의 정의는 다음과 같습니다:

```text
   BlkOrCompId_value ::= IotpMsgId_value "." IdSuffix
   IdSuffix ::= Digit (Digit)*
```

IotpMsgId\_value 블록 또는 구성 요소가 처음 사용되는 IOTP 메시지의 메시지 ID 구성 요소에 대한 ID 속성입니다.

- IOTP에서는 거래 구성요소와 거래 블록이 하나의 IOTP 메시지에서 다른 메시지로 복사됩니다. 기존 거래 블록 또는 구성 요소가 다른 IOTP 메시지에 복사될 때 ID 속성은 변경되지 않습니다.

```text
   IdSuffix           The suffix consists of one or more digits. The
                      suffix must be unique within the ID attribute of
                      the Message ID Component used to generate the ID
                      attribute. The following is recommended as a
                      guideline and must not be relied upon:

                       o the first Block or Component sent by a trading
                         role is given the suffix "1"
                       o the ID attributes of the second and subsequent
                         Blocks or Components are incremented by one for
                         each new Block or Component added to an IOTP
                         Message
                       o no leading zeroes are included in the suffix
```

- 더 간단히 말하면, 예를 들어 소비자가 보낸 두 번째 IOTP 메시지에 추가된 첫 번째 새 블록 또는 구성 요소의 ID 속성은 "C2.1", 두 번째는 "C2.2", 세 번째는 "C2"입니다. .3" 등

- Digit은 Digit의 \[XML\] 정의와 동일한 정의를 갖습니다.

---
### **3.4.3 Example of use of ID Attributes**

아래 다이어그램은 ID 속성 값이 사용되는 방법을 보여줍니다.

```text
*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*

      1st  IOTP MESSAGE                          2nd IOTP MESSAGE
    (e.g., from Merchant to                    (e.g., from Consumer to
           Consumer                              Payment Handler)

IOTP MESSAGE                               IOTP MESSAGE *
 |-Trans Ref Block. ID=M1.1                 |-Trans Ref Block.ID=C1.1*
 |  |-Trans Id Comp. ID = M1.2 ------------>|  |-Trans Id Comp.
 |  |                         Copy Element  |  |  ID=M1.2
 |  |-Msg Id Comp. ID = M1                  |  |-Msg Id Comp. ID=C1 *
 |                                          |
 |-Signature Block. ID=M1.8                 |-Signature Block.ID=C1.5*
 |  |-Sig Comp. ID=M1.15 ------------------>|  |-Comp. ID=M1.15
 |                            Copy Element  |
 |-Trading Block. ID=M1.3                   |-Trading Block.ID=C1.2 *
 |  |-Comp. ID=M1.4 -------------------------->|-Comp. ID=M1.4
 |  |                         Copy Element     |
 |  |-Comp. ID=M1.5 -------------------------->|-Comp. ID=M1.5
 |  |                         Copy Element     |
 |  |-Comp. ID=M1.6                            |-Comp. ID=C1.3 *
 |  |-Comp. ID=M1.7                            |-Comp. ID=C1.4 *
 |
 |-Trading Block. ID=M1.9
    |-Comp. ID=M1.10                             * = new elements
    |-Comp. ID=M1.11
    |-Comp. ID=M1.12
    |-Comp. ID=M1.13

*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-

                   Figure 8 Example use of ID attributes
```

---
## **3.5 Element References**

거래 구성요소 또는 그 하위 XML 요소 중 하나에는 다른 블록\(예: 거래 참조 블록 또는 거래 블록\) 또는 거래 구성요소\(거래 ID 및 서명 구성요소 포함\)를 참조하는 XML 속성이 포함될 수 있습니다. 이러한 요소 참조는 다양한 목적으로 사용되며 몇 가지 예는 다음과 같습니다.

o 서명 구성 요소에 다이제스트가 포함된 XML 요소를 식별합니다.

o 지불을 할 때 사용되는 지불 처리기 조직 구성 요소를 참조

요소 참조에는 항상 블록 또는 구성요소의 ID 속성 값이 포함됩니다.

요소 참조에서 참조하는 IOTP 메시지, 거래 블록 또는 거래 구성 요소를 식별하려면 다음과 같은 XML 요소를 찾는 것이 포함됩니다.

o 동일한 IOTP 트랜잭션에 속합니다\(즉, IOTP 메시지 일치의 트랜잭션 ID 구성 요소\).

o 요소의 ID 속성 값이 요소 참조 값과 일치하는 경우.

참고: 이 사양에서 "일치"라는 용어는 \[XML\] 일치 정의와 동일한 정의를 갖습니다.

아래 예에서는 요소 참조를 "일치"하는 예를 보여줍니다.

```text
   *+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*

         1st  IOTP MESSAGE                          2nd IOTP MESSAGE
       (e.g., from Merchant to                    (e.g., from Consumer to
              Consumer                              Payment Handler)

   IOTP MESSAGE                               IOTP MESSAGE
    |-Trans Ref Block. ID=M1.1     Trans ID    |-Trans RefBlock. ID=C1.1
    |  |-Trans Id Comp. ID = M1.2 <-Components-|->|-TransId Comp.ID=M1.2
    |  |                            must be    |  |
    |  |-Msg Id Comp. ID = M1      Identical   |  |-Msg Id Comp. ID=C1
    |                                  ^       |
    |-Signature Block. ID=M1.8         |       |-Signature Block.ID=C1.5
    |  |-Sig Comp. ID=M1.15            |       |  |-Comp. ID=M1.15
    |                                 AND      |
    |-Trading Block. ID=M1.3           |       |-Trading Block. ID=C1.2
    |  |-Comp. ID=M1.4                 |          |-Comp. ID=M1.4
    |  |                               v          |
    |  |-Comp. ID=M1.5 <-------- -ID Attribute    |-Comp. ID=M1.5
    |  |                          and El Ref      |
    |  |-Comp. ID=M1.6            values must     |-Comp. ID=C1.3
    |  |                             match--------|--> El Ref=M1.5
    |  |-Comp. ID=M1.7                            |-Comp. ID=C1.4
    |
    |-Trading Block. ID=M1.9
       |-Comp. ID=M1.10
       |-Comp. ID=M1.11
       |-Comp. ID=M1.12
       |-Comp. ID=M1.13

   *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-

                           Figure 9 Element References
```

참고: 요소 참조 속성은 "IDREF"가 아닌 "NMTOKEN"으로 정의됩니다\(\[XML\] 참조\). 이는 IDREF에서 참조되는 XML 요소가 동일한 XML 문서에 있어야 하기 때문입니다. IOTP의 경우 반드시 그런 것은 아닙니다.

---
## **3.6 Extending IOTP**

기준 IOTP는 IOTP를 지원하는 시스템이 수용할 수 있어야 하는 최소 프로토콜을 정의합니다. IOTP의 새 버전이 개발됨에 따라 추가 유형의 IOTP 트랜잭션이 정의됩니다. 이 외에도 IOTP의 기본 버전과 향후 버전은 두 가지 메커니즘을 통해 IOTP에 대한 사용자 확장을 지원합니다.

```text
   o  extra XML elements, and
```

o 기존 IOTP 코드에 대한 새로운 값.

---
### **3.6.1 Extra XML Elements**

IOTP 내에서 사용되는 XML 요소 및 속성 이름은 IotpMessage 요소의 xmlns 속성으로 식별되는 \[XML 네임스페이스\]를 구성합니다. 이를 통해 IOTP는 \[XML 네임스페이스\]를 사용하여 IOTP 메시지 내에 추가 XML 요소의 포함을 지원할 수 있습니다.

XML 네임스페이스를 사용하면 다음을 포함하여 IOTP 메시지 내의 모든 수준에 추가 XML 요소가 포함될 수 있습니다.

```text
   o  new Trading Blocks

   o  new Trading Components
```

o 거래 구성요소 내의 새로운 XML 요소.

다음 규칙이 적용됩니다.

o 새로운 XML 요소는 \[XML 네임스페이스\] 규칙에 따라 선언되어야 합니다.

o 거래 블록 또는 거래 구성 요소인 새 XML 요소에는 속성 이름이 ID인 ID 속성이 포함되어야 합니다.

추가 XML 요소가 제대로 처리될 수 있도록 하기 위해 IOTP는 True 또는 False 값을 사용하고 IOTP 메시지에 추가된 추가 요소에 나타날 수 있는 IOTP:Critical이라는 특수 속성의 사용을 예약합니다.

이 속성의 목적은 IOTP 인식 애플리케이션이 IOTP 트랜잭션을 안전하게 계속할 수 있는지 확인할 수 있도록 하는 것입니다. 구체적으로:

o 추가 XML 요소에 값이 "True"인 "IOTP:Critical" 속성이 있고 IOTP 인식 응용 프로그램이 요소와 해당 하위 요소를 처리하는 방법을 모르는 경우 IOTP 트랜잭션에 기술 오류가 있습니다\(섹션 참조\). 4.1\) 반드시 실패해야 합니다.

o 추가 XML 요소에 값이 "False"인 "IOTP:Critical" 속성이 있는 경우 IOTP 인식 응용 프로그램이 이를 처리하는 방법을 모르면 IOTP 트랜잭션이 계속될 수 있습니다. 이 경우:

- - IOTP 네임스페이스 내에 정의된 XML 요소 내에 포함된 추가 XML 요소는 IOTP에서 IOTP XML 요소를 사용하거나 복사할 때마다 해당 요소와 함께 포함되어야 합니다.

- - 서명 생성의 일부로 다이제스트 생성에 사용될 때 포함되어야 한다는 점을 제외하고 추가 요소의 내용은 무시되어야 합니다.

```text
   o  if an extra XML element has no "IOTP:Critical" attribute then it
      must be treated as if it had an "IOTP:Critical" attribute with a
      value of "True"
```

o XML 요소에 "IOTP:Critical" 속성이 포함된 경우 해당 속성의 값은 해당 요소 내의 모든 하위 요소에 적용되는 것으로 간주됩니다.

"IOTP:Critical"이 포함된 문서가 유효한지 확인하기 위해 다음과 같이 추가 요소에 대한 DTD의 일부로 선언됩니다.

```text
   IOTP:Critical     (True | False ) 'True'
```

---
### **3.6.2 Opaque Embedded Data**

불투명 임베디드 데이터를 사용하여 IOTP를 확장하려면 패키지 콘텐츠 요소\(섹션 3.7 참조\)를 사용하여 데이터를 캡슐화해야 합니다.

---
## **3.7 Packaged Content Element**

패키지 콘텐츠 요소는 전송 시스템에 의한 잘못된 해석을 방지하고 XML 호환성을 보장하기 위해 변환된 포함된 데이터 스트림의 개념을 지원합니다. IOTP에서의 사용 예는 다음과 같습니다.

o SET 메시지와 같은 지불 계획 메시지를 캡슐화합니다.

o 주문 설명, 지불 메모 또는 배달 메모를 요약합니다.

일반적으로 하나 이상의 데이터 스트림을 캡슐화하는 데 사용됩니다.

이 데이터 스트림에는 콘텐츠의 식별, 디코딩 및 해석을 허용하는 세 가지 표준화된 속성이 있습니다. 그 정의는 다음과 같습니다.

```text
   <!ELEMENT PackagedContent (#PCDATA) >
   <!ATTLIST PackagedContent
    Name             CDATA     #IMPLIED
    Content          NMTOKEN   "PCDATA"
    Transform (NONE|BASE64)    "NONE" >

   Attributes:

   Name               Optional. Distinguishes between multiple
                      occurrences of Packaged Content Elements at the
                      same point in IOTP. For example:
                        <ABCD>
                          <PackagedContent Name='FirstPiece'>
                            snroasdfnas934k
                          </PackagedContent>
                          <PackagedContent Name='SecondPiece'>
                            dvdsjnl5poidsdsflkjnw45
                          </PackagedContent>
                        </ABCD>
```

- name 속성은 생략될 수 있습니다. 예를 들어 패키지 콘텐츠 요소가 하나만 있는 경우입니다.

콘텐츠 이는 패키지 콘텐츠 요소의 콘텐츠 내에 어떤 유형의 데이터가 포함되어 있는지 식별합니다. Content 속성의 유효한 값은 다음과 같습니다. o PCDATA. 패키지 콘텐츠 요소의 콘텐츠는 추가 처리 없이 PCDATA로 처리될 수 있습니다. o 마임. 패키지 콘텐츠 요소의 콘텐츠는 완전한 MIME 항목입니다. 처리에는 패키지 콘텐츠 요소 내부의 MIME 헤더를 찾는 것이 포함되어야 합니다. o MIME:마임 유형. 패키지 콘텐츠 요소의 콘텐츠는 "Content-Type: mimetype" 헤더가 있는 MIME 콘텐츠입니다. Transform 속성이 NONE으로 설정된 MIME:mimetype을 가질 수도 있지만 Transform 속성이 BASE64로 설정될 가능성이 훨씬 더 높습니다. Transform이 NONE을 사용하는 경우 전체 내용은 여전히 ​​PCDATA를 준수해야 합니다. 일부 문자는 XML 기본 엔터티 또는 숫자 문자 엔터티로 인코딩되어야 합니다.

- o XML. 패키지 콘텐츠 요소의 콘텐츠는 XML 문서로 처리될 수 있습니다. 엔터티 및 CDATA 섹션 또는 BASE64로 설정된 변환을 사용하여 패키지 콘텐츠 요소 콘텐츠가 적법한 PCDATA인지 확인해야 합니다.

- Content 속성의 값은 사용자 정의 값 정의를 허용하는 섹션 12 IANA 고려사항에 정의된 절차에 따라 제어됩니다.

```text
   Transform          This identifies the transformation that has been
                      done to the data before it was placed in the
                      content. Valid values are:
```

- o 없음. 패키지 콘텐츠 요소의 PCDATA 콘텐츠는 데이터를 정확하게 표현합니다. 데이터를 검사하기 전에 엔터티 확장이 먼저 발생해야 합니다\(예: &amp; 및 &#9; 교체\). CDATA 섹션은 Transform 속성이 NONE으로 설정된 패키지 콘텐츠 요소에서 합법적으로 발생할 수 있습니다. o BASE64. 패키지 콘텐츠 요소의 PCDATA 콘텐츠는 실제 콘텐츠의 BASE64 인코딩을 나타냅니다.

```text
   Content:

   PCDATA             This is the actual data which has been embedded.
                      The format of the data and rules on how to decode
                      it are contained in the Content and the Transform
                      attributes
```

특별한 세부정보, 특히 사용자 정의 속성은 더 높은 수준에서 표시되어야 합니다.

---
### **3.7.1 Packaging HTML**

패키지된 콘텐츠에는 HTML이 포함될 수 있습니다. 이 경우 다음 규칙을 따릅니다.

o 패키징되는 데이터에 대한 수신자의 이해에 영향을 미칠 수 있는 사운드나 웹 페이지와 같은 문서, 이미지 또는 기타 항목에 대한 참조는 동일한 상위 요소\(예: 주문 설명\) 내에 포함된 다른 패키지 요소를 참조해야 합니다.

o 이전 요구 사항을 충족하기 위해 상위 요소 내에 두 개 이상의 패키지 콘텐츠 요소가 포함된 경우 다른 모든 패키지 요소에 대한 참조를 결정할 수 있는 최상위 패키지 콘텐츠의 이름 속성은 Main 값을 가져야 합니다.

o 하나의 패키지 콘텐츠 요소에서 다른 패키지 콘텐츠 요소로의 다른 문서, 이미지 등에 대한 상대 참조는 동일한 수준 및 동일한 상위 요소 내에서 다른 패키지 콘텐츠 요소의 Name 속성에 대한 상대 참조 값을 설정함으로써 실현됩니다.

o 참조를 즉시 해결해야 하는 외부 참조를 사용해서는 안 됩니다. 이로 인해 HTML을 완전히 표시하는 것이 어렵거나 불가능해질 수 있습니다.

o \[MIME\]은 각 패키지 요소 내부의 데이터를 캡슐화하는 데 사용됩니다. 이는 캡슐화된 데이터 유형과 표시 방법을 식별하는 데 사용되는 MIME 헤더의 정보를 의미합니다.

예를 들어, 해결해야 하는 외부 참조를 포함하여 위의 규칙을 따르지 않는 경우 HTML 수신자에게 이를 알려야 합니다.

참고: 구현 지침에 따라 패키지 콘텐츠 요소에 할당된 이름 속성 값을 사용하면 각 패키지 콘텐츠를 디렉터리로 추출한 다음 HTML을 직접 표시할 수 있어야 합니다.

---
### **3.7.2 Packaging XML**

XML 지원이 권장됩니다. 예를 들어 소비자에게 주문 설명 내용을 표시하기 위해 XML을 표시해야 하는 경우 구현자는 World Wide Web Consortium의 최신 권장 사항을 따라야 합니다.

참고: 이 사양을 작성할 당시 XML 문서가 표시되는 방법을 보여주는 XML 스타일 시트를 지정하는 표준이 개발 중입니다. 보다:

o http://www.w3.org/TR/WD-xsl의 "XSL\(Extensible Stylesheet Language\) 사양" 및

o http://www.w3.org/TR/xml-stylesheet의 "스타일시트와 XML 문서 연결".

이러한 표준이 W3C "권장 사항"이 되면 이 사양은 실용적으로 수정될 것으로 예상됩니다.

---
## **3.8 Identifying Languages**

IOTP는 \[XML\] 언어 식별을 사용하여 IOTP 메시지의 콘텐츠 및 속성 내에서 사용되는 언어를 지정합니다.

xml:lang 속성을 포함하는 XML 요소를 결정하기 위해 다음 원칙이 사용되었습니다.

o 필수 xml:lang 속성은 특정 언어로 표시되거나 인쇄되어야 할 수 있는 속성이나 콘텐츠를 포함하는 모든 거래 구성요소에 포함되어 있습니다.

o 선택적인 xml:lang 속성은 이러한 거래 구성요소의 하위 요소에 포함됩니다. 이 경우 xml:lang의 값\(있는 경우\)은 거래 구성요소의 값을 대체합니다.

이러한 원칙을 따르는 xml:lang 속성은 섹션 7에 정의된 거래 구성요소 및 해당 하위 XML 요소에 포함되어 있습니다.

메시지 발신자\(일반적으로 소비자\)는 메시지 ID 구성 요소\(섹션 3.3.2 참조\)에서 기본 언어/문자 집합 목록을 지정하여 언어 및 문자 집합에 대한 기본 설정을 나타낼 수 있습니다. 그러한 메시지를 받는 사람은 나열된 언어/문자 집합 중 하나를 사용하여 응답할 의무가 없습니다. 왜냐하면 응답할 수 있는 기술이 없을 수 있기 때문입니다. 이는 또한 이러한 목록을 처리하는 능력이 이 사양을 준수하기 위한 요구 사항이 아니라는 것을 의미합니다. 그러나 예를 들어 명시된 언어/문자 집합 중 하나를 사용하여 응답하는 기능은 더 나은 사용자 경험을 제공할 가능성이 높습니다.

---
## **3.9 Secure and Insecure Net Locations**

IOTP에는 일반적으로 IOTP 메시지가 전송될 수 있는 장소를 식별하는 여러 "넷 위치"가 포함되어 있습니다. Net Location에는 두 가지 유형이 있습니다.

o 예를 들어 \[SSL/TLS\]와 같은 암호화 방법을 사용하여 데이터의 개인 정보가 보호되는 넷 위치인 "보안" 넷 위치

o 데이터의 개인정보 보호가 보장되지 않는 "안전하지 않은" 넷 위치.

Secure Net Location이나 Insecure Net Location 또는 둘 다 존재해야 합니다.

두 개의 Net Location 중 하나만 존재하는 경우 존재하는 하나를 사용해야 합니다.

두 가지 유형의 네트 위치가 모두 존재하는 경우 메시지 보낸 사람의 선호도에 따라 둘 중 하나를 사용할 수 있습니다.

---
## **3.10 Cancelled Transactions**

IOTP 거래와 관련된 모든 거래 역할은 언제든지 해당 거래를 취소할 수 있습니다.

---
### **3.10.1 Cancelling Transactions**

IOTP 거래는 적절한 상태 구성 요소와 함께 취소 블록만 포함된 IOTP 메시지를 거래 거래소와 관련된 다른 거래 역할에 전송하여 취소됩니다.

참고: 취소 블록은 다른 IOTP 메시지와 비동기적으로 전송될 수 있습니다. 특히 다른 거래 역할로부터 IOTP 메시지를 보내기 전이나 받은 후에 보낼 수 있습니다.

거래 교환 중에 IOTP 거래가 취소되면\(즉, "요청" 블록 전송과 일치하는 "응답" 블록 수신 사이의 간격\) 취소 블록은 거래 교환의 다음 IOTP 메시지와 동일한 위치로 전송됩니다. 전송되었습니다.

거래 교환이 완료된 후\(즉, 거래 교환에 대한 "응답" 블록이 수신됨\) 그러나 IOTP 거래가 완료되기 전에 소비자가 거래를 취소하는 경우 소비자는 적절한 상태 구성 요소와 함께 취소 블록을 네트워크에 보냅니다. 트랜잭션에 대한 TPO 블록\(섹션 8.1 참조\)에 포함된 프로토콜 옵션 구성 요소\(섹션 7.1 참조\)에 포함된 SenderNetLocn 또는 SecureSenderNetLocn에 의해 식별된 위치입니다. 이는 일반적으로 판매자 거래 역할입니다.

소비자는 IOTP 트랜잭션이 완료된 후 취소 블록을 보내서는 안 됩니다. 전체 거래를 취소하는 것은 기술적인 오류로 처리되어야 합니다.

IOTP 트랜잭션을 취소한 후 소비자는 취소 블록을 보낸 조직의 거래 역할 요소에 포함된 CancelNetLocn 속성에 지정된 네트 위치로 이동해야 합니다.

비소비자 거래 역할은 거래만 취소해야 합니다.

o 요청 블록이 수신된 후

o 응답 블록이 전송되기 전

소비자 거래 역할이 아닌 사람이 언제든지 거래를 취소하는 경우 수신자는 이를 오류로 처리해야 합니다.

---
### **3.10.2 Handling Cancelled Transactions**

취소가 허용되는 IOTP 트랜잭션의 한 지점에서 소비자가 취소 블록을 수신하는 경우 소비자는 트랜잭션을 중지해야 합니다.

비소비자 역할이 취소 차단을 수신한 경우 거래 역할은 소비자가 거래 역할의 거래 역할 요소에 포함된 CancelNetLocn 속성에 의해 지정된 위치로 이동할 수 있다고 예상해야 합니다.

---
## **4. IOTP Error Handling**

IOTP는 각 메시지가 다수의 거래 구성요소를 포함하는 다수의 거래 블록으로 구성되는 요청/응답 프로토콜로 설계되었습니다. 오류, 재전송, 중복 등을 처리하는 데에는 여러 가지 상호 관련된 고려 사항이 있습니다. 이러한 요소는 IOTP 인식 애플리케이션이 단순한 요청/응답 모델보다 더 복잡한 메시지 흐름을 관리해야 함을 의미합니다. 또한 메시지뿐만 아니라 전송 수준이나 거래 블록이나 구성 요소에서도 다양한 오류가 발생할 수 있습니다.

이 섹션에서는 IOTP가 오류, 재시도 및 멱등성을 처리하는 방법을 높은 수준에서 설명합니다. 그것은 다음을 다룬다:

o 발생할 수 있는 다양한 유형의 오류. 이는 다음과 같이 구분됩니다.

- - IOTP 메시지의 목적과 무관한 "기술적 오류",

- - 수행 중인 프로세스\(예: 결제 또는 배송\)에 특정한 문제가 있음을 나타내는 "비즈니스 오류" 및

o 오류가 전송, 메시지 또는 블록/구성 요소 수준에 있는지 여부를 나타내는 오류의 깊이

o 다양한 거래 역할이 수신할 수 있는 다양한 유형의 메시지를 어떻게 처리해야 하는지.

---
## **4.1 Technical Errors**

기술적 오류는 메시지의 의미와 무관한 오류입니다. 즉, IOTP 통신 시도에 영향을 미칠 수 있습니다. 일반적으로 사용자를 위한 제한된 수의 표준 옵션을 사용하여 표준 방식으로 처리됩니다. 구체적으로 다음과 같습니다.

o 전송을 재시도하는 중, 또는

o 거래를 취소합니다.

통신이 충분히 잘 작동하는 경우 기술적 오류는 IOTP 메시지에서 오류를 감지한 당사자가 오류 메시지를 보낸 당사자에게 보낸 오류 블록\(8.17절 참조\)의 오류 구성요소\(7.21절 참조\)로 표시됩니다. .

통신 상태가 좋지 않으면 보낸 메시지가 목적지에 도달하지 못할 수도 있습니다. 이 경우 시간 초과가 발생할 수 있습니다.

기술 오류와 관련된 오류 코드는 설정할 수 있는 다양한 기술 오류를 모두 나열하는 오류 구성 요소에 기록됩니다.

---
## **4.2 Business Errors**

IOTP 메시지가 "기술적으로" 올바른 경우 비즈니스 오류가 발생할 수 있습니다. 이는 제안, 지불, 배송 또는 인증과 같은 특정 프로세스와 연결되어 있으며 각 프로세스에는 서로 다른 가능한 비즈니스 오류 세트가 있습니다.

예를 들어, "자금 부족"은 합리적인 결제 오류이지만 배송에는 의미가 없고, "이월 주문"은 합리적인 배송 오류이지만 결제에는 의미가 없습니다. 비즈니스 오류는 적절한 유형의 "응답 블록"\(예: 지불 응답 블록 또는 배달 응답 블록\)의 상태 구성 요소\(섹션 7.16 참조\)에 표시됩니다. 이는 오류 표시와 함께 필요한 추가 응답 관련 정보를 허용합니다.

일반적으로 비즈니스 오류는 사용자가 다음에 수행할 작업을 결정할 수 있도록 사용자에게 제시되어야 합니다. 예를 들어, 브랜드 독립 제안\(섹션 9.1.2.2 참조\)에서 오류로 인해 자금이 부족한 경우 사용자는 동일한 브랜드의 다른 결제 수단/계좌 또는 다른 브랜드 또는 결제 시스템을 선택하기를 원할 수 있습니다. 또는 다음과 같은 경우

IOTP 기반 구현은 이를 허용하고 해당 상품에 적합하므로 사용자는 상품/계좌에 더 많은 자금을 투입하고 다시 시도하기를 원할 수 있습니다.

---
## **4.3 Error Depth**

IOTP 오류가 발생할 수 있는 세 가지 수준은 전송 수준, 메시지 수준 및 블록 수준입니다. 각각은 아래에 설명되어 있습니다.

---
### **4.3.1 Transport Level**

이 수준의 오류는 IOTP 통신이 발생하는 전송 메커니즘의 근본적인 문제를 나타냅니다.

모든 전송 수준 오류는 기술적 오류이며 TCP/IP의 "대상 경로 없음" 오류와 같은 명시적인 전송 수준 오류 표시 또는 요청에 대한 응답이 수신되지 않은 시간 초과로 표시됩니다.

전송 수준 오류가 발생한 경우 유일하게 합리적인 자동 조치는 재시도하고 일정 횟수의 자동 재시도 후에 사용자에게 알리는 것입니다.

수신될 수 있는 명시적인 오류 표시는 전송에 따라 다르며 오류 및 적절한 조치에 대해서는 해당 IOTP 전송 보충 자료에 대한 문서를 참조해야 합니다.

사용하기에 적절한 시간 초과는 사용 중인 전송과 요청에 결제 정보가 포함된 경우 결제 시스템의 기능입니다. 시간 초과 및 자동 재시도 매개변수에 대해서는 운송 및 결제 시스템 관련 문서를 참조해야 합니다. 전송 수준 오류를 상대방에게 직접 알릴 수 있는 방법이 없는 경우가 많지만 일반적으로 기록해야 하며 자동 복구에 실패하고 사람 사용자가 있는 경우 사용자에게 알려야 합니다.

---
### **4.3.2 Message Level**

이 오류 수준은 전체 IOTP 메시지에 근본적인 기술적 문제가 있음을 나타냅니다. 예를 들어, XML이 "잘 구성된" 것이 아니거나 메시지가 수신자가 처리하기에는 너무 크거나 트랜잭션 참조 블록\(섹션 3.3 참조\)에 오류가 있어 메시지가 어떤 트랜잭션과 관련되어 있는지 파악하는 것이 불가능합니다. 에게.

모든 메시지 수준 오류는 기술적 오류이며 상대방에게 전송되는 오류 구성요소\(섹션 7.21 참조\)를 통해 표시됩니다. 오류 구성 요소에는 오류가 발생했는지 여부를 나타내는 심각도 속성이 포함되어 있습니다.

오류는 경고이며 무시될 수 있습니다. 재시도를 통해 문제가 해결될 수 있음을 나타내는 TransientError 또는 트랜잭션이 실패해야 하는 경우 HardError입니다.

메시지 수준 오류인 기술적 오류\(섹션 7.21.2 오류 코드 참조\)는 다음과 같습니다.

```text
   o  XML not well formed. The document is not well formed XML (see
      [XML])

   o  XML not valid. The document is not valid XML (see [XML])
```

o 블록 수준 기술 오류\(섹션 4.3.3 참조\)

- 트랜잭션 참조 블록\(섹션 3.3 참조\) 및 서명 블록만 해당됩니다. 이러한 블록에 대한 검사는 XML이 유효한 경우에만 수행되어야 합니다.

서명 블록 검사에는 가능한 경우 각 서명 구성 요소가 올바르게 계산되었는지 확인하는 것도 포함됩니다. 서명이 잘못 계산되면 서명에 포함되어야 하는 데이터를 신뢰할 수 없으며 잘못된 것으로 처리해야 합니다. 서명이 올바르게 계산되었는지 확인하는 방법에 대한 설명은 섹션 6.2에 포함되어 있습니다.

---
### **4.3.3 Block Level**

블록 수준 오류는 IOTP 메시지의 블록 또는 해당 구성 요소 중 하나\(트랜잭션 참조 또는 서명 블록 제외\)에 문제가 있음을 나타냅니다. 메시지가 제대로 전송되었으며 전체 메시지 구조와 트랜잭션 참조 및 서명 블록을 포함한 블록/구성 요소는 의미가 있지만 다른 블록 중 하나와 관련된 일부 오류가 있습니다.

블록 수준 오류는 다음 중 하나일 수 있습니다.

```text
   o  technical errors, or

   o  business errors
```

기술적 오류는 다음과 같이 더 세분화됩니다.

o 블록 수준 속성 및 요소 확인

o 블록 및 구성요소 일관성 검사

```text
   o  Transient Technical Errors
```

블록이나 구성 요소와 관련된 기술적 오류가 발생하면 반환을 위해 오류 구성 요소가 생성됩니다.

---
#### **4.3.3.1 Block Level Attribute and Element Checks**

블록 수준 속성 및 요소 확인은 동일한 블록 내에서만 발생합니다. 다른 블록에 대한 교차 검사를 포함하는 검사는 블록 및 구성 요소 일관성 검사에 포함됩니다.

블록 수준 속성 및 요소 확인은 다음과 같습니다.

o 블록의 각 요소 내의 각 속성 값이 이 IOTP 사양에 포함된 규칙을 준수하는지 확인합니다.

o 각 요소의 내용이 본 IOTP 사양에 포함된 규칙을 준수하는지 확인합니다.

o 이전 검사가 괜찮다면 속성 값과 요소 내용의 일관성을 동일한 블록의 다른 구성 요소 내 다른 속성 값이나 요소 내용과 비교하여 확인합니다.

---
#### **4.3.3.2 Block and Component Consistency Checks**

블록 및 구성요소 일관성 검사는 다음으로 구성됩니다.

o IOTP 메시지에 있는 블록 및/또는 구성 요소의 조합이 본 IOTP 사양에 포함된 규칙과 일치하는지 확인합니다.

o 동일한 IOTP 메시지 내의 블록 내 속성과 요소 콘텐츠 간의 일관성을 확인합니다.

o 이 IOTP 메시지의 블록과 동일한 IOTP 트랜잭션에 대한 이전 IOTP 메시지에서 수신된 블록의 속성과 요소 간의 일관성을 확인합니다.

블록이 "블록 수준 속성 및 요소 검사"와 "블록 및 구성 요소 일관성 검사"를 통과하면 IOTP 인식 애플리케이션이나 결제 서버와 같은 일부 "백엔드" 시스템에 의해 처리됩니다.

---
#### **4.3.3.3 Transient Technical Errors**

블록을 처리하는 동안 다른 거래 역할이 보낸 원래 메시지를 약간 나중에 다시 전송하여 잠재적으로 복구할 수 있는 일시적인 오류가 발생할 수 있습니다. 이 경우 다른 역할에게 임시 역할에 대한 정보가 전달됩니다.

심각도 속성이 TransientError로 설정되고 MinRetrySecs 속성이 사용 중인 전송 메커니즘 및/또는 결제 프로토콜에 적합한 값으로 설정된 오류 구성 요소\(섹션 7.21 참조\)를 보내 오류가 발생합니다\(해당 전송 및 결제 프로토콜 보충 자료 참조\).

일시적인 기술 오류는 거래와 관련된 모든 거래 역할에 의해 생성될 수 있습니다.

---
#### **4.3.3.4 Block Level Business Errors**

결제 또는 배송과 같은 프로세스에서 비즈니스 오류가 발생하면 ProcessState 속성이 Failed로 설정되고 문제의 성격을 나타내는 CompletionCode가 포함된 상태 구성 요소\(섹션 7.16 참조\)가 포함된 적절한 유형의 응답 블록이 반환됩니다. .

일부 비즈니스 오류는 소비자 역할이 다른 방식으로 트랜잭션을 복구하고 완료할 수 있다는 점에서 "일시적"일 수 있습니다. 예를 들어 소비자가 제공한 신용카드에 구매에 필요한 자금이 부족한 경우 소비자는 다른 신용카드를 사용하여 복구할 수 있습니다.

"일시적인" 비즈니스 오류로부터의 복구는 CompletionCode에 따라 달라집니다. 무엇이 가능한지 알아보려면 상태 구성요소의 정의를 참조하세요.

비즈니스 오류에 대해서는 오류 구성 요소나 오류 블록이 생성되지 않습니다.

---
## **4.4 Idempotency, Processing Sequence, and Message Flow**

IOTP 메시지는 실제로 3.1.1 IOTP 메시지 구조에 설명된 대로 블록과 구성 요소의 조합입니다. 특히 향후 IOTP 확장에서는 이러한 블록과 구성 요소의 다양한 조합이 발생할 수 있습니다. 상태를 변경하는 작업에 대한 "동일한" 요청을 여러 번 전송/수신해도 해당 작업이 두 번 이상 발생하지 않는 것이 중요합니다. 이것을 멱등성이라고 합니다. 예를 들어, 주문 비용을 지불하는 고객은 전체 금액을 한 번만 지불하기를 원할 것입니다. 대부분의 네트워크 전송 메커니즘에는 메시지를 두 번 이상 전달하거나 전혀 전달하지 않아 재전송이 필요할 가능성이 있습니다. 반면에 상태 요청은 합리적으로 반복될 수 있으며 수신될 때마다 새로 처리되어야 합니다.

IOTP의 올바른 구현은 아래에 설명된 대로 특정 처리 순서에 따라 모델링될 수 있습니다. 당사자 간에 전송되는 메시지에서 구별할 수 없는 다른 방법도 동일하게 허용됩니다.

---
## **4.5 Server Role Processing Sequence**

"서버 역할"은 소비자 역할이 아닌 모든 거래 역할을 의미합니다. 이들은 일반적으로 서비스해야 하는 요청을 받은 다음 응답을 생성하므로 "서버 역할"입니다. 그러나 서버 역할은 트랜잭션을 시작할 수도 있습니다. 보다 구체적으로 서버 역할은 다음을 수행할 수 있어야 합니다.

o 거래를 시작합니다\(섹션 4.5.1 참조\). 이들은 다음과 같이 나뉩니다:

```text
      -  payment related transactions and

      -  infrastructure transactions
```

o 다른 역할로부터 받은 메시지를 수락하고 처리합니다\(섹션 4.5.2 참조\). 여기에는 다음이 포함됩니다.

- - 메시지가 이전에 수신된 트랜잭션에 속하는지 식별

```text
      -  handling duplicate messages
```

- - 입력 메시지를 처리하는 서버가 너무 바빠서 처리할 수 없는 경우 일시적 오류 생성

- - 오류가 없고 승인된 경우 메시지를 처리하고 적절한 경우 다른 역할로 다시 보내기 위한 응답을 생성합니다.

```text
   o  Cancel a current transaction if requested (see section 4.5.3)
```

o 응답이 예상되었으나 합리적인 시간 내에 수신되지 않은 경우 메시지를 재전송합니다\(섹션 4.5.4 참조\).

---
### **4.5.1 Initiating Transactions**

서버 역할은 다양한 유형의 트랜잭션을 시작할 수 있습니다. 구체적으로:

```text
   o  an Inquiry Transaction (see section 9.2.1)

   o  a Ping Transaction (see section 9.2.2)

   o  an Authentication Transaction (see section 9.1.6)
```

o 다음과 같은 지급 관련 거래:

```text
      -  a Deposit (see section 9.1.7)

      -  a Purchase (see section 9.1.8)

      -  a Refund (see section 9.1.9)

      -  a Withdrawal (see section 9.1.10)

      -  a Value Exchange (see section 9.1.11)
```

---
### **4.5.2 Processing Input Messages**

입력 메시지 처리에는 다음이 포함됩니다.

o 메시지의 구조와 정체성을 확인합니다.

o 중복 메시지 확인 및 처리

o 다음을 포함하는 중복되지 않은 원본 메시지를 처리합니다.

- - 오류를 확인한 후 오류가 발견되지 않은 경우

- 다음과 같은 경우 출력 메시지를 생성하기 위해 메시지를 처리합니다.

-     적절한

이들 각각에 대해서는 아래에서 더 자세히 설명합니다.

---
#### **4.5.2.1 Checking Structure and Message Identity**

메시지가 "잘 구성된" XML인지, 응답을 생성하려면 IotpTransId가 필요하므로 IOTP 메시지 내의 트랜잭션 식별자\(TransId 구성 요소의 IotpTransId 특성\)를 성공적으로 식별할 수 있는지 확인하는 것이 중요합니다.

입력 메시지의 형식이 올바르지 않으면 심각도가 HardError이고 ErrorCode가 XmlNotWellFrmd인 오류 구성 요소를 생성합니다.

메시지의 형식은 올바르지만 IotpTransId를 식별할 수 없는 경우 다음을 사용하여 ErrorComponent를 생성합니다.

o HardError의 심각도 및 AttMissing의 ErrorCode,

o "IotpTransId"를 포함하는 PackagedContent - 누락됨

-  기인하다.

새 IotpTransId가 포함된 새 TransactionId 구성 요소가 포함된 오류 블록 내에 오류 구성 요소를 삽입하고 원본 메시지의 보낸 사람에게 반환합니다.

---
#### **4.5.2.2 Checking/Handling Duplicate Messages**

입력 메시지가 잠재적으로 유효한 입력 메시지로 식별될 수 있는 경우 "동일한" 입력 메시지가 이전에 수신되었는지 확인하십시오. 동일하다는 것은 입력 메시지의 모든 블록, 구성 요소, 요소, 속성 값 및 요소 내용이 동일함을 의미합니다.

참고: 동일한 메시지를 확인하는 권장 방법은 \[DOM-HASH\]의 동일한 값을 확인하는 것입니다.

이전에 동일한 메시지가 수신된 경우 이전 메시지 처리가 완료되었는지 확인하세요.

처리가 완료되지 않은 경우 일시적 오류 심각도 및 MsgBeingProc 오류 코드를 사용하여 오류 구성 요소를 생성하여 메시지가 처리 중임을 나타내고 적절한 조치 후에 원본 메시지를 다시 보내도록 요청하는 입력 메시지 발신자에게 다시 보냅니다. 기간.

그렇지 않고 처리가 완료되어 출력 메시지가 나타나면 전송된 마지막 메시지를 검색하여 다시 보냅니다.

메시지가 중복되지 않으면 처리되어야 합니다.

---
#### **4.5.2.3 Processing Non-Duplicate Message**

메시지가 중복되지 않는 것으로 확인되면 처리할 수 있습니다. 여기에는 다음이 포함됩니다.

o 서버가 메시지를 처리할 수 있는지 확인하고 그렇지 않은 경우 일시적인 오류를 생성합니다.

o 거래가 아직 오류가 아니거나 취소되었는지 확인

o 입력 메시지의 유효성을 검사합니다. 여기에는 다음이 포함됩니다.

- - 메시지 수준 오류 확인

- - 블록 수준 오류 확인

```text
      -  checking any encapsulated data
```

o 블록이 수신된 순서에서 오류를 확인합니다.

o 결과로 발생한 오류에 대한 오류 구성 요소 생성

o 심각한 오류나 일시적인 오류가 발생하지 않으면

- 입력 메시지의 발신자에게 반환하기 위해 필요한 경우 메시지를 처리하고 출력 메시지를 생성합니다.

참고: 중복 입력 메시지를 처리하는 이 접근 방식은 완전히 "동일한" 메시지가 수신되면 완전히 "동일한" 메시지가 반환된다는 의미입니다. 이는 실제로 트랜잭션 상태나 서버 처리 능력이 변경되었을 수 있는 조회 및 핑 트랜잭션에도 적용됩니다. 트랜잭션 또는 서버의 최신 상태가 필요한 경우 MsgId 구성 요소의 ID 속성에 대한 새 값이 있는 IOTP 트랜잭션을 사용해야 합니다.

위의 각 단계는 아래에서 설명됩니다.

사용 가능한 서버 확인 중

입력 메시지를 처리하는 프로세스는 시스템의 나머지 부분이 너무 바빠서 적절한 시간 내에 응답을 생성할 수 없는지 확인해야 합니다.

서버 사용량이 너무 많으면 일시적 오류 심각도와 SystemBusy 오류 코드가 포함된 오류 구성 요소를 생성하고 이를 입력 메시지 발신자에게 다시 보내어 적절한 시간이 지난 후 원본 메시지를 다시 보내도록 요청해야 합니다. .

참고: 일부 서버는 예상치 못한 작업 부하 증가로 인해 사용량이 매우 많아지는 경우가 있습니다. 이 접근 방식을 사용하면 메시지 보낸 사람에게 나중에 다시 제출하도록 요청하여 메시지 입력을 지연함으로써 짧은 시간 동안 최대 작업 부하를 처리할 수 있습니다.

거래 확인이 아직 오류이거나 취소되지 않았습니다.

```text
   Check that:
```

o 이전에 받거나 보낸 메시지에 하드 오류가 포함되거나 발생하지 않았습니다.

o 소비자 또는 서버 거래 역할에 의해 거래가 취소되지 않았습니다.

그렇다면 메시지를 무시하십시오. 심각한 오류가 있거나 취소된 거래는 다시 시작할 수 없습니다.

메시지 및 블록 수준 오류를 확인하세요.

트랜잭션이 여전히 정상이면 메시지 수준 오류를 확인하십시오. 여기에는 다음이 포함됩니다.

o XML이 유효한지 확인하는 중입니다.

o 해당 항목의 요소, 속성 및 내용을 확인합니다.

- Transaction Reference Block은 오류가 없으며 본 사양을 준수합니다.

o 다음과 관련된 디지털 서명을 확인합니다.

- - 서명 값이 올바르게 계산되었는지 확인하고

- - 해시 값의 소스를 사용할 수 있는 경우 다이제스트의 해시 값이 올바르게 계산됩니다.

블록 수준 오류 확인에는 다음이 포함됩니다.

o 각 블록 내에서\(트랜잭션 참조 블록 제외\) 다음 사항을 확인합니다.

- - 속성, 요소 및 요소 내용이 유효합니다.

- - 속성, 요소 및 요소 내용의 값이 블록 내에서 일관됩니다.

o 블록 조합이 유효한지 확인

o 속성, 요소 및 요소 내용의 값이 입력 메시지의 블록과 전송되거나 수신된 이전 메시지의 블록 간에 일관성이 있는지 확인합니다. 여기에는 블록의 존재가 특정 거래 유형에 유효한지 확인하는 것이 포함됩니다.

메시지에 캡슐화된 데이터가 포함되어 있는 경우 가능하면 추가 소프트웨어를 사용하여 캡슐화된 데이터에 오류가 있는지 확인하여 적절한 위치에서 데이터를 확인하십시오.

---
#### **4.5.2.4 Check for Errors in Block Sequence**

참고: 간결성을 위해 블록 시퀀스의 오류를 확인하는 방법에 대한 다음 설명에서는 "IOTP 트랜잭션을 참조합니다"라는 문구는 "IOTP 메시지에 포함되어 있습니다.

```text
   the Trans Ref Block contains an IotpTransId that refers to". So, for
   example, " If an Error or Cancel Block refers to an IOTP transaction
   that is not recognised then ..."  should be interpreted as " If an
   Error or Cancel Block is contained in an IOTP Message where the Trans
   Ref Block contains an IotpTransId that refers to an IOTP transaction
   that is not recognised then ...
```

블록이 도착하는 순서의 오류는 블록에 따라 다릅니다. 시퀀스 확인이 필요한 블록은 다음과 같습니다.

o 오류 및 취소 블록. 오류 또는 취소 블록이 인식되지 않는 IOTP 트랜잭션을 참조하는 경우 이는 하드 오류입니다. 루핑을 방지하기 위해 이전에 IOTP 트랜잭션에 대해 오류 또는 블록 취소가 수신된 경우 오류를 반환하지 마십시오.

o 문의 요청 및 응답 차단. 조회 요청 또는 조회 응답 블록이 인식되지 않는 IOTP 트랜잭션을 참조하는 경우 이는 하드 오류입니다.

o 인증 요청 블록. 인증 요청 블록이 인식된 IOTP 트랜잭션을 참조하는 경우 이는 하드 오류입니다.

o 인증 응답 차단. 다음과 같이 확인하십시오.

- - 인증 응답 블록이 인식된 IOTP 트랜잭션을 참조하지 않는 경우 하드 오류입니다. 그렇지 않으면

- - 인증 응답 블록이 이전에 전송된 인증 요청을 참조하지 않는 경우 하드 오류입니다. 그렇지 않으면

- - 동일한 IOTP 트랜잭션에 대한 인증 응답이 이전에 수신되었고 인증이 성공한 경우 하드 오류입니다.

o 인증 상태 차단. 다음과 같이 확인하십시오.

- - 인증 상태 블록이 인식된 IOTP 트랜잭션을 참조하지 않는 경우 하드 오류입니다. 그렇지 않으면

- 인증 상태 블록이 인증 상태 블록을 참조하지 않는 경우

- 이전에 전송된 인증 응답은 하드 오류입니다. 그렇지 않으면

- - 동일한 IOTP 트랜잭션에 대한 인증 상태가 이전에 수신된 경우 경고 오류입니다.

o TPO 선택 블록\(가맹점만 해당\). 다음과 같이 확인하십시오.

- - TPO 선택 블록이 인식된 IOTP 트랜잭션을 참조하지 않는 경우 하드 오류이고, 그렇지 않은 경우

- - TPO 선택 블록이 TPO 블록 및 제안 응답\(한 메시지에서\)이 이전에 전송된 IOTP 트랜잭션을 참조하는 경우 하드 오류입니다. 그렇지 않으면 하드 오류입니다.

- TPO 선택 블록이 IOTP를 참조하지 않는 경우

- 이전에 TPO 블록만\(즉, 제안 응답 없이\) 전송된 트랜잭션은 하드 오류입니다. 그렇지 않으면 하드 오류입니다.

- - 동일한 TPO 블록에 대한 TPO 선택 블록이 이전에 수신된 경우 하드 오류입니다.

o 지불 요청 차단\(지불 처리자에만 해당\). 다음과 같이 확인하십시오.

- - 지불 요청 블록이 인식되지 않는 IOTP 거래를 참조하는 경우에는 괜찮습니다. 그렇지 않으면 괜찮습니다.

- - 지불 요청 블록이 지불을 위한 것이 아닌 IOTP 트랜잭션을 참조하는 경우 이는 하드 오류입니다. 그렇지 않으면

- - 복구할 수 없는 완료 코드로 인해 이전 결제가 실패한 경우 이는 하드 오류이고, 그렇지 않은 경우

- - 이전 결제가 아직 진행 중인 경우 하드 오류입니다.

o 지불 교환 차단\(지불 처리자만 해당\). 다음과 같이 확인하십시오.

- 지불 교환 블록이 IOTP를 참조하지 않는 경우

- 인식된 거래는 하드 오류, 그렇지 않은 경우

- - 지불 교환이 이전에 지불 교환이 전송된 IOTP 거래를 참조하지 않는 경우 하드 오류입니다.

o 배달 요청\(배달 핸들러만 해당\). 배달 요청 블록이 서버에서 인식하는 IOTP 트랜잭션을 참조하는 경우 이는 하드 오류입니다.

오류 구성요소가 생성된 경우 이를 오류 블록으로 수집하여 입력 메시지 발신자에게 보냅니다. 오류 블록은 메시지 보낸 사람과 보낸 사람의 거래 역할에 대한 ErrorLogNetLocn\(지정된 경우\)으로 다시 전송되어야 합니다.

참고: 위의 인증 응답 및 지불 요청 순서 확인은 소비자가 이전 요청이 실패한 이후 반복 작업 요청을 다시 제출하는 것을 지원합니다. 예를 들면 다음과 같습니다.

o 인증에 대한 올바른 응답\(예: 비밀번호\)을 몰랐기 때문에 또는

o 신용카드 잔액이 부족하여 결제할 수 없었습니다.

오류 없는 입력 메시지 처리

입력 메시지가 이전 검사를 통과하면 필요한 경우 출력 메시지를 생성하도록 처리될 수 있습니다. 참고 사항:

o Ping 거래에 대한 조회 요청은 무시되어야 합니다.

o 입력 메시지에 일시적인 오류가 있는 오류 블록이 포함된 경우 필요한 시간 동안 기다린 후 이전 메시지에 대한 응답을 받지 못한 경우 이전 메시지를 다시 보냅니다.

o 입력 메시지에 HardError 또는 취소 블록이 있는 오류 구성 요소가 포함되어 있으면 트랜잭션의 모든 추가 처리를 중지합니다. 여기에는 현재 생성 중인 메시지의 전송을 억제하거나 중복되지 않은 새로운 메시지에 응답하는 것이 포함됩니다.

o 캡슐화된 메시지\(예: 결제 프로토콜 메시지\)를 처리하면 추가적인 일시적인 오류가 발생할 수 있습니다.

o 디지털 서명은 모든 블록과 구성 요소가 생성되고 메시지의 어떤 요소에 서명해야 하는지 알려진 후에만 안전하게 생성될 수 있습니다.

출력 메시지가 생성되면 동일한 입력 메시지가 다시 수신될 경우 필요에 따라 다시 보낼 수 있도록 저장해야 합니다. 일시적 오류가 포함된 출력 메시지는 입력 메시지가 다시 수신될 때 새로 처리될 수 있도록 저장되지 않습니다.

---
### **4.5.3 Cancelling a Transaction**

이 프로세스는 IOTP 서버에서 실행 중인 트랜잭션을 취소하는 데 사용됩니다. 이는 동일한 거래 역할에 의해 실행되는 다른 시스템이나 서버의 외부 요청의 결과로 다른 프로세스에 의해 시작됩니다. 필요한 처리는 다음과 같습니다.

o 취소할 트랜잭션의 IotpTransId가 인식되지 않거나 완료되면 요청이 실패합니다. 그렇지 않으면

o IotpTransId가 Ping 트랜잭션을 참조하는 경우 요청이 실패합니다. 그렇지 않으면

o 취소할 문서 교환을 결정하고 취소 차단을 생성하여 상대방에게 보냅니다.

참고: IOTP 서버에서 트랜잭션을 취소하는 것은 일반적으로 비즈니스상의 이유로 발생합니다. 예를 들어 판매자가 인증을 여러 번 시도했지만 성공하지 못했고 그 결과 거래를 취소하기로 결정했을 수 있습니다. 따라서 이 작업을 수행하기로 결정한 프로세스는 비즈니스 결정을 내린 프로세스/서버에서 IOTP 트랜잭션을 취소해야 한다는 지침과 함께 IOTP 서버로 메시지를 보내야 합니다.

---
### **4.5.4 Retransmitting Messages**

서버는 메시지가 반환될 것으로 예상되지만 다음과 같은 요인에 따라 시간이 지나도 수신되지 않은 트랜잭션을 주기적으로 확인해야 합니다.

```text
   o  the Transport Mechanism being used;
```

o 캡슐화된 메시지\(예: 결제 메시지\)를 처리하는 데 필요한 시간

o 사람의 입력이 필요한지 여부.

메시지가 수신되지 않은 경우 원본 메시지를 다시 보내야 합니다. 이는 사용 중인 전송 메커니즘의 신뢰성에 따라 최대 횟수까지 발생해야 합니다.

필요한 시간 이후에도 응답이 수신되지 않으면 트랜잭션이 "시간 초과"되어야 합니다. 이 경우 트랜잭션의 프로세스 상태를 실패로 설정하고 완료 코드를 다음 중 하나로 설정합니다.

o TimedOutRcvr\(트랜잭션이 나중에 잠재적으로 복구될 수 있는 경우\) 또는

o 트랜잭션이 복구 불가능한 경우 TimedOutNoRcvr

---
## **4.6 Client Role Processing Sequence**

IOTP의 "클라이언트 역할"은 소비자 거래 역할입니다.

참고: 예를 들어 판매자인 회사나 조직은 구매를 하거나 전자 현금을 다운로드하거나 인출할 때 소비자의 거래 역할을 맡을 수 있습니다.

보다 구체적으로 소비자 역할은 다음을 수행할 수 있어야 합니다.

o 거래를 시작합니다\(섹션 4.6.1 참조\). 이들은 다음과 같이 나뉩니다:

```text
      -  payment related transactions and

      -  infrastructure transactions
```

o 다른 역할로부터 받은 메시지를 수락하고 처리합니다\(섹션 4.6.2 참조\). 여기에는 다음이 포함됩니다.

- - 메시지가 이전에 수신된 트랜잭션에 속하는지 식별

```text
      -  handling duplicate messages
```

- - 입력 메시지를 처리하는 서버가 너무 바빠서 처리할 수 없는 경우 일시적 오류 생성

- - 오류가 없는 경우 메시지를 처리하고, 적절한 경우 다른 역할로 다시 보내기 위한 응답을 생성합니다.

```text
   o  Cancel a current transaction if requested, for example by the User
      (see section 4.6.3)
```

o 응답이 예상되었으나 합리적인 시간 내에 수신되지 않은 경우 메시지를 재전송합니다\(섹션 4.6.4 참조\).

---
### **4.6.1 Initiating Transactions**

소비자 역할은 다양한 유형의 거래를 시작할 수 있습니다. 구체적으로:

```text
   o an Inquiry Transaction (see section 9.2.1)

   o a Ping Transaction (see section 9.2.2)

   o an Authentication Transaction (see section 9.1.6)
```

---
### **4.6.2 Processing Input Messages**

소비자 역할에 대한 입력 메시지 처리는 블록 시퀀스의 오류 확인 영역\(IOTP 서버의 경우 섹션 4.5.2.4 참조\)을 제외하고 IOTP 서버\(섹션 4.5.2 참조\)와 동일합니다. 이에 대해서는 아래에 설명되어 있습니다.

참고: IOTP 서버 처리에 대한 설명에는 입력 메시지의 멀티스레딩 및 요청의 멀티태스킹에 대한 고려가 포함됩니다. 소비자 역할의 경우\(특히 PC와 같은 독립 실행형 시스템에서 실행되는 경우\) 멀티스레딩 사용은 소비자 역할 IOTP 솔루션 구현자의 결정입니다.

---
#### **4.6.2.1 Check for Errors in Block Sequence**

다음 블록의 처리는 소비자 역할이 IOTP 서버 역할을 대체한다는 점을 제외하면 IOTP 서버\(섹션 4.5.2.4 참조\)와 동일합니다.

o 오류 및 취소 블록,

o 문의 요청 및 응답 차단,

o 인증 요청, 응답 및 상태 블록.

소비자 역할이 수신할 수 있는 다른 블록의 경우 블록이 도착하는 순서의 잠재적인 오류는 블록에 따라 다릅니다. 시퀀스 확인이 필요한 블록은 다음과 같습니다.

o TPO 블록. 다음과 같이 확인하십시오.

- - 입력 메시지에 인증 요청 블록과 응답 제공 블록도 포함되어 있으면 하드 오류가 있는 것입니다. 그렇지 않으면

- - 입력 메시지에 인증 요청 블록과 인증 상태 블록도 포함되어 있으면 하드 오류가 발생합니다.

- - 입력 메시지에 인증 요청 블록도 포함되어 있고 IOTP 트랜잭션이 소비자 역할의 시스템에서 인식되면 하드 오류가 발생합니다. 그렇지 않으면

- - 입력 메시지에 인증 상태 블록도 포함되어 있고 소비자 역할의 시스템에서 IOTP 트랜잭션을 인식하지 못하는 경우 하드 오류가 발생합니다. 그렇지 않으면

- - 입력 메시지에 인증 상태 블록도 포함되어 있고 이전 인증 응답 메시지 이후에 인증 상태 블록이 전송되지 않은 경우 하드 오류가 있는 것입니다.

- - 입력 메시지에 제안 응답 블록도 포함되어 있고 IOTP 트랜잭션이 소비자 역할의 시스템에 의해 인식되면 하드 오류가 발생합니다. 그렇지 않으면

- - TPO 블록이 자체적으로 발생하고 IOTP 트랜잭션이 소비자 역할의 시스템에서 인식되면 하드 오류가 발생합니다.

o 응답 차단을 제안합니다. 다음과 같이 확인하십시오.

- - 제안 응답 블록이 브랜드 독립적 제안 교환\(섹션 9.1.2.2 참조\)의 일부인 경우 수신된 첫 번째 메시지의 일부이므로 순서 확인이 없습니다. 그렇지 않은 경우

- - 제안 응답 블록이 소비자 역할에 의해 인식되는 IOTP 트랜잭션의 일부가 아닌 경우 하드 오류가 발생합니다. 그렇지 않으면

- 제안 응답 블록이 IOTP를 참조하지 않는 경우

- TPO 선택 블록이 전송된 마지막 메시지이고 하드 오류가 있는 트랜잭션

o 결제 교환 차단. 다음과 같이 확인하십시오.

- 지불 교환 블록이 IOTP를 참조하지 않는 경우

- 소비자 역할의 시스템에서 인식되는 트랜잭션은 하드 오류가 발생합니다. 그렇지 않으면

- - 지불 교환이 지불 ​​요청 또는 지불 교환 블록이 가장 최근에 전송된 IOTP 거래를 참조하지 않는 경우 하드 오류가 있는 것입니다.

o 결제 응답 차단. 다음과 같이 확인하십시오.

- 결제 응답 블록이 IOTP를 참조하지 않는 경우

- 소비자 역할의 시스템에서 인식되는 트랜잭션은 하드 오류가 발생합니다. 그렇지 않으면

- - 지불 응답이 지불 요청 또는 지불 교환 블록이 가장 최근에 전송된 IOTOP 거래를 참조하지 않는 경우 하드 오류가 있는 것입니다.

o 배달 응답 차단. 다음과 같이 확인하십시오.

- - 배달 응답 블록이 소비자 역할의 시스템에서 인식되는 IOTP 트랜잭션을 참조하지 않으면 하드 오류가 발생합니다. 그렇지 않으면

- - 배달 응답이 지불 요청 또는 지불 교환 블록이 가장 최근에 전송된 IOTP 트랜잭션을 참조하지 않는 경우 하드 오류가 있는 것입니다.

---
### **4.6.3 Cancelling a Transaction**

이 프로세스는 사용자 또는 소비자 역할의 다른 시스템이나 서버의 외부 요청으로 인해 소비자 역할의 시스템에서 현재 트랜잭션을 취소합니다. 처리는 IOTP 서버와 동일합니다\(섹션 4.5.3 참조\).

---
### **4.6.4 Retransmitting Messages**

메시지 재전송 프로세스는 IOTP 서버의 경우와 동일합니다\(섹션 4.5.4 참조\).

---
## **5. Security Considerations**

이 섹션에서는 IETF 관점에서 IOTP가 보안을 처리하는 방법을 고려합니다. 다음 섹션\(섹션 6. 디지털 서명 및 IOTP 참조\)에서는 필요할 때 IOTP가 디지털 서명을 사용하는 방법을 설명합니다.

이 섹션에서는 다음 내용을 다룹니다.

o 디지털 서명 사용 여부 결정

```text
   o data privacy, and

   o payment protocol security.
```

---
## **5.1 Determining whether to use digital signatures**

IOTP 내에서 디지털 서명을 사용하는 것은 전적으로 선택 사항입니다. IOTP는 디지털 서명을 사용하지 않고도 완전히 성공적으로 작동할 수 있습니다.

궁극적으로 IOTP 메시지에 서명이 포함될지 여부를 결정하는 것은 판매자 또는 기타 거래 역할에 달려 있으며 소비자는

서명 없이 거래를 수행하는 것이 허용 가능한 위험인지 여부를 결정합니다. 판매자가 서명이 없는 거래가 허용되지 않음을 발견한 경우 다음 중 하나를 수행합니다.

```text
   o start using signatures,
```

o 서명이 필요하지 않은 작업 방법을 찾거나

o 더 적은 규모와 가치의 사업을 수용합니다.

디지털 서명이 사용되는 이유에 대한 대략적인 목록은 다음과 같습니다.

o 판매자\(또는 기타 거래 역할\)는 신뢰할 수 있음을 보여주고 싶어합니다. 예를 들어 판매자가 소비자에게 알려진 신뢰할 수 있는 제3자의 인증서를 사용하여 제안 응답 서명\(섹션 7.19.2 참조\)을 생성하는 경우 소비자는 서명과 인증서를 확인할 수 있으므로 제안에 더 합리적으로 의존할 수 있습니다. 판매자가 주장하는 실제 조직 출신입니다. 이 경우 비대칭 암호화를 사용한 서명이 필요할 수 있습니다.

o 판매자 또는 기타 거래 역할이 특정 목적에 적합한 거래 기록을 생성하려고 합니다. 예를 들어 적절한 신뢰 계층을 사용하면 소비자가 디지털 서명을 확인하여 다음을 결정할 수 있습니다.

- - 세무 당국이 유효한 거래 기록으로 인정하는 경우, 또는

- - "Better Business Bureau" 또는 이와 유사한 보증이 제공되는 경우

o 지불 처리자 또는 배달 처리자는 요청이 변경되지 않았으며 승인되었는지 알아야 합니다. 예를 들어 IOTP에서는 지불할 금액에 대한 세부 정보가 제안 응답을 통해 소비자에게 전송된 다음 지불 요청을 통해 지불 처리기로 전달됩니다. 요청이 서명되지 않은 경우 소비자는 예를 들어 숫자를 제거하여 지불 금액을 변경할 수 있습니다. 결제 처리자가 제안 응답의 원래 결제 정보에 액세스할 수 없는 경우 서명이 없으면 결제 처리자는 데이터가 변경되지 않았는지 확인할 수 없습니다. 마찬가지로 결제 정보가 디지털 서명되지 않은 경우 결제 처리자는 결제를 요청하는 판매자가 누구인지 확인할 수 없습니다.

o 결제 처리자 또는 배송 처리자가 결제 또는 배송 완료 상태에 대해 반박할 수 없는 기록을 제공하려고 합니다. 결제 응답 또는 배송 응답이 서명된 경우,

- 소비자는 나중에 결제 또는 배송 기록을 사용하여 해당 일이 발생했음을 증명할 수 있습니다. 예를 들어 고객 관리 목적으로 사용될 수 있습니다.

디지털 서명이 사용되지 않는 이유에 대한 대략적인 목록은 다음과 같습니다.

```text
   o  trading roles are combined therefore changes to data made by the
      consumer can be detected. One of the reasons for using signatures
      is so that one trading role can determine if data has been changed
      by the Consumer or some other party. However if the trading roles
      have access to the necessary data, then it might be possible to
      compare, for example, the payment information in the Payment
      Request with the payment information in the Offer Response. Access
      to the data necessary could be realised by, for example, the
      Merchant and Payment Handler roles being carried out by the same
      Organisation on the same system, or the Merchant and Payment
      Handler roles being carried out on different systems but the
      systems can communicate in some way. (Note this type of
      communication is outside the current scope of IOTP)
```

o 암호화 처리 비용이 너무 높습니다. 예를 들어, 단 몇 센트로 결제가 이루어지는 경우 디지털 서명 생성 및 확인과 관련된 모든 암호화를 수행하는 데 드는 비용으로 인해 전체 거래가 비경제적일 수 있습니다. 거래 역할을 공동 배치하면 이 문제를 방지하는 데 도움이 될 수 있습니다.

---
## **5.2 Symmetric and Asymmetric Cryptography**

IOTP와 함께 대칭 키를 사용하면 공개 키 인프라를 설정할 필요가 없으며 판매자, 지불 처리기 및 배송 처리기만 사용할 공유 비밀에 동의하면 된다는 이점이 있습니다.

그러나 대칭 암호화의 단점은 소비자가 자신이 상대하는 판매자, 결제 처리자 등의 자격 증명을 쉽게 확인할 수 없다는 것입니다. 이는 소비자가 거래를 수행하게 될 신뢰를 다소 감소시킬 가능성이 있습니다.

그러나 비대칭 암호화가 사용되는 경우에도 거래의 무결성은 예를 들어 결제 처리기가 복사된 제안 응답 서명을 확인하여 결정되므로 소비자에게 디지털 인증서를 제공할 필요가 없다는 점에 유의해야 합니다. 결제 요청.

단일 트랜잭션에서는 대칭형, 비대칭형 또는 두 가지 유형의 암호화를 모두 사용할 수 있습니다.

---
## **5.3 Data Privacy**

\[SSL/TLS\]와 같은 보안 채널을 사용하여 다양한 거래 역할 간에 IOTP 메시지를 전송함으로써 정보 보호가 제공됩니다. IOTP 내에서 보안 채널을 사용하는 것은 선택 사항입니다.

---
## **5.4 Payment Protocol Security**

IOTP는 결제에 사용되는 결제 프로토콜을 전혀 인식하지 못하도록 설계되었습니다. 보안 관점에서 이는 IOTP가 결제 보안 달성을 돕지도, 방해하지도 않는다는 것을 의미합니다.

IOTP 관점에서 결제 보안을 고려해야 하는 경우 IOTP가 해당 결제 프로토콜을 지원하는 방법을 설명하는 결제 프로토콜 보충 자료에 이를 포함해야 합니다.

그러나 IOTP가 수행하도록 설계된 작업은 디지털 서명을 사용하여 거래의 각 거래 교환에 대한 "응답" 메시지에 포함된 기록을 함께 묶는 것입니다. 예를 들어 IOTP는 제안, 지불 및 배송을 하나로 묶을 수 있습니다.

---
## **6. Digital Signatures and IOTP**

IOTP는 디지털 서명을 사용하지 않고도 성공적으로 작동할 수 있지만 개방형 네트워킹 환경에서는 보안 수준이 낮습니다. 고려해야 할 요소에 대한 설명은 5. 보안 고려 사항을 참조하세요.

그러나 이 섹션에서는 디지털 서명이 필요한 다양한 상황에서 디지털 서명을 사용하는 방법에 대해 설명합니다. 다루는 주제는 다음과 같습니다:

o IOTP가 디지털 서명을 사용하는 방법에 대한 개요

o 서명이 올바르게 계산되었는지 확인하는 방법

o 결제 처리자와 배송 처리자가 판매자를 대신하여 결제 또는 배송을 수행할 수 있는지 확인하는 방법.

---
## **6.1 How IOTP uses Digital Signatures**

일반적으로 IOTP와 함께 사용되는 서명은 다음과 같습니다.

```text
   o  are always treated as IOTP Components (see section 7)
```

o 동일한 IOTP 트랜잭션 내의 IOTP 메시지에 다른 서명 구성요소를 포함하여 하나 이상의 IOTP 구성요소 또는 거래 블록의 다이제스트를 포함합니다.

```text
   o  identify:
```

- - 서명을 서명한\(원본\) 조직, 그리고

- - 조직이 취해야 할 조치가 발생할 수 있는지 확인하기 위해 어떤 조직이 서명을 처리해야 하는지.

비대칭 암호화를 사용하는 경우 디지털 인증서가 디지털 서명과 연결될 수 있습니다. 그러나 대칭 암호화를 사용하는 경우 디지털 인증서는 사용할 비밀 키의 일부 식별자로 대체됩니다.

서명 구성 요소가 하나 이상의 요소를 소화하는 방식은 아래 그림에 설명되어 있습니다.

```text
 *+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*

 IOTP MESSAGE                                  SIGNATURE COMPONENT

 IOTP Message                                   Signature Id = P1.3
  |-Trans Ref Block        digest TransRefBlk   |-Manifest
  |  |      ID=P1.1-----------------------------|->|-Digest of P1.1--
  |  |-Trans Id Comp       digest TransIdComp   |  |                 |
  |  |     ID = M1.2----------------------------|->|-Digest of M1.2--|
  |  |-Msg Id Comp.           digest Signature  |  |                 |
  |  |      ID = P1          -------------------|->|-Digest of M1.5--|
  |                         |   digest element  |  |                 |
  |-Signatures Block        |  -----------------|->|-Digest of M1.7--|
  |  |       ID=P1.2        | |  digest element |  |                 |
  |  |-Signature ID=P1.3    | |  ---------------|->|-Digest of C1.4--|
  |  |-Signature ID=M1.5----  | |               |  |                 |
  |  |-Signature ID=P1.4      | | Points to     |   -RecipientInfo*  |
  |  |-Certificate ID=M1.6<---|-|---------------|------CertRef=M1.6  |
  |  |                        | | Certs to use  |  Sig.ValueRef=P1.4 |
  |  |                        | |               |        |           |
  |  |                        | |               |        |           |
  |-Trading Block. ID=P1.5    | |               |        v           |
  |  |-Comp. ID=M1.7----------  |                -Value* ID=P1.4:    |
  |  |                          |                   JtvwpMdmSfMbhK<--
  |  |-Comp. ID=P1.6            |                   r1Ln3vovbMQttbBI
  |  |                          |                   J8pxLjoSRfe1o6k
  |  |-Comp. ID=C1.4------------                    OGG7nTFzTi+/0<-
  |  |-Comp. ID=C1.5
                             Digital signature of Manifest element
                             using certificate identified by CertRef

   Elements that are digested can be in any IOTP Message
        within the same IOTP Transaction
 *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*

                         Figure 10 Signature Digests
```

참고: IOTP에서 한 서명이 다른 서명에 서명하는 전형적인 예는 판매자가 "제안 응답" 서명을 생성하여 제안에 처음 서명한 다음 나중에 "제안 응답" 서명을 생성하는 지불 기록과 함께 결제 처리자가 서명하는 경우입니다. 지불 영수증' 서명. 이러한 방식으로 IOTP 거래의 지불은 판매자의 제안에 구속됩니다.

하나의 매니페스트는 여러 서명 "값" 요소와 연관될 수 있으며, 여기서 각 값 요소는 동일한\(또는 다른\) 서명 알고리즘을 사용하지만 다른 인증서 또는 공유 비밀 키를 사용하여 동일한 매니페스트에 대한 디지털 서명을 포함합니다. 특히 이를 통해 판매자는 결제 처리기 및 배송 처리기와 서로 다른 공유 비밀 키에 동의할 수 있습니다.

서명 구성 요소의 자세한 정의는 섹션 7.19에 포함되어 있습니다.

이 섹션의 나머지 부분에는 다음이 포함됩니다.

o IOTP가 서명을 사용하는 방법의 예

o 서명 구성 요소 내의 OriginatorInfo 및 RecipientInfo 요소를 사용하여 서명과 관련된 조직을 식별하는 방법

o IOTP가 서명을 사용하여 작업이 성공적으로 완료되었음을 증명하는 방법

---
### **6.1.1 IOTP Signature Example**

서명이 사용되는 방법의 예는 기본 구매의 다양한 구성 요소와 요소가 서로 어떻게 관련되어 있는지 보여주는 아래 그림에 설명되어 있습니다. 결제 또는 배송이 발생할 수 있는지 확인하기 위해 서명을 사용하는 방법에 대한 이후 설명에서 이 예를 참조하세요\(섹션 6.3 참조\).

참고: 기본 구매 거래는 설명 목적으로 사용되었습니다. 요소와 속성의 사용법은 모든 유형의 IOTP 트랜잭션에서 동일합니다.

```text
*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*

TPO SELECTION BLOCK          TPO BLOCK           IOTPSIGNATURE BLOCK
                                                 | (Offer Response)
 Brand Selection             Organisation<---    |------Signature
   Component                 Component       |   |      Component
      |                       |              |           -Manifest
      |BrandList               -Trading Role |            |
      |  Ref                     Element     | Originator |-Orig.
      v                         (Merchant)    ------------|--Info
    Brand List                                    Ref     |
  >Component                                              |
 | |-Protocol       ------>  Organisation     Recipient   |-Recipient
 | | Amount Elem   |         Component <------------------|--Info
 | |   |           |          |                 Refs      |
 | |Pay|Protocol   |Action     -Trading Role              |
 | |   | Ref       |OrgRef       Element                  |
 | |   v           |          (Payment Handler)           |
 |  -PayProtocol--                                        |
 |    Elem                  ->Organisation    Recipient   |-Recipient
 |                         |  Component <--------------------Info
 |                         |  |                 Refs
 |                         |   -Trading Role
 |                         |     Element
 |                         | (Delivery Handler
 |
 |           OFFER RESPONSE BLOCK
 |                         |
 |BrandListRef             |ActionOrgRef
 |                         |
  --Payment                 ---Delivery
   Component                  Component
```

서명 구성 요소의 매니페스트 요소에는 다음의 다이제스트가 포함됩니다.
Trans Ref 블록\(표시되지 않음\); 거래 ID 구성요소\(
표시됨\); 조직 구성 요소\(가맹점, 결제 처리자, 배송
매니저\); 브랜드 목록 구성요소 주문 구성요소, 결제
배송 구성요소와 브랜드 선택 구성요소\(해당되는 경우\)
브랜드 의존 구매\).

```text
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
```

- 그림 11 기본 구매를 위한 서명 사용 예

---
### **6.1.2 OriginatorInfo and RecipientInfo Elements**

서명 구성 요소에 있는 OriginatorInfo 요소의 OriginatorRef 속성에는 서명을 생성한 조직의 조직 구성 요소를 가리키는 요소 참조\(섹션 3.5 참조\)가 포함되어 있습니다. 이 예에서는 판매자입니다.

Type 속성이 IOTP 서명 유형으로 설정된 Attribute 요소의 콘텐츠 값은 서명한 조직의 거래 역할과 일치해야 합니다. 그렇지 않으면 오류입니다. 유효한 조합은 아래 표에 나와 있습니다.

```text
         IOTP Signature Type    Valid Trading Role

         OfferResponse           Merchant

         PaymentResponse         PaymentHandler

         DeliveryResponse        DeliveryHandler

         AuthenticationRequest   any role

         AuthenticationResponse  any role

         PingRequest             any role

         PingResponse            any role
```

서명 구성 요소에 있는 RecipientInfo 요소의 RecipientRefs 특성에는 다음을 확인하기 위해 서명을 사용해야 하는 조직의 조직 구성 요소에 대한 요소 참조가 포함되어 있습니다.

o 서명을 생성한 조직과 기존 관계가 있고,

o 서명으로 보호되는 데이터는 변경되지 않았습니다.

o 데이터가 올바르게 서명되었으며

o 따라서 판매자를 대신하여 수행해야 하는 조치가 승인되었습니다.

대칭 암호화를 사용하는 경우 서로 다른 공유 비밀 키 집합에 대한 별도의 RecipientInfo 및 Value 요소가 서명 구성 요소 내에 있을 가능성이 높습니다.

또는 비대칭 암호화가 사용되는 경우 하나의 RecipientInfo 요소의 RecipientRefs 속성이 모두 동일한 인증서를 사용하는 경우 여러 조직 구성 요소를 참조할 수 있습니다.

---
### **6.1.3 Using signatures to Prove Actions Complete Successfully**

작업이 성공적으로 완료되었음을 증명하는 것은 응답 메시지에 데이터를 서명함으로써 달성됩니다. 구체적으로:

o 제안 응답에서 판매자가 소비자에게 제안을 할 때 다음 중 하나로 보낼 수 있습니다.

- - 판매자가 결제를 승인했음을 증명하는 결제 처리자, 또는

```text
      -  a Delivery Handler to prove that Merchant authorises Delivery,
         provided other necessary authorisations are complete (see
         below)
```

o 결제 응답에서 결제 핸들러가 다음 중 하나로 보낼 수 있는 결제 영수증을 생성하는 경우:

- - 제안 응답 서명과 함께 배달을 승인하기 위한 배달 요청 블록의 배달 핸들러, 또는

- - 가치 교환 IOTP 거래에서 두 번째 지불을 승인하기 위한 두 번째 지불 요청의 또 다른 지불 핸들러

o 배달 응답\(배달 핸들러가 배달 메모를 생성하는 경우\) 이는 이벤트 이후 배달 핸들러가 무엇을 하겠다고 말했는지 증명하는 데 사용될 수 있습니다.

o 인증 응답. 거래에 대해 다른 당사자를 인증하는 한 가지 방법은 인증에 디지털 서명을 사용해야 함을 지정하는 인증 요청을 보내는 것입니다.

o 거래 상태 조회. 질의 응답 블록은 응답의 신뢰성을 증명하기 위해 디지털 서명될 수 있습니다.

오 핑. Ping 응답은 서명을 이해할 수 있는지 확인할 수 있도록 디지털 서명될 수 있습니다.

이 작업 증명은 IOTP의 향후 버전에서 IOTP 트랜잭션이 발생한 후 증명하는 데 사용될 수도 있습니다. 예를 들어 고객 관리 제공자에게.

---
## **6.2 Checking a Signature is Correctly Calculated**

서명이 올바르게 계산되었는지 확인하는 것은 메시지 수준 오류 확인의 일부입니다\(섹션 4.3.2 참조\). 모든 서명 및 보안 관련 고려 사항이 함께 유지되도록 여기에 포함되었습니다.

거래 역할이 서명을 확인하기 전에 잠재적으로 여러 서명 요소 중 확인해야 할 요소를 식별해야 합니다. 관련된 단계는 다음과 같습니다.

o 서명 블록이 있고 하나 이상의 서명 구성 요소가 포함되어 있는지 확인하십시오.

o 서명 확인을 수행하는 조직에 대한 OrgId 속성을 포함하는 조직 구성요소를 식별합니다. 조직 구성 요소가 하나 이상 발견되지 않으면 오류입니다.

o 조직 구성요소의 ID 속성을 사용하여 해당 조직 구성요소를 참조하는 RecipientRefs 속성을 포함하는 RecipientInfo 요소를 찾습니다. 확인할 서명이 없을 수도 있습니다.

o 식별된 RecipientInfo 요소가 포함된 서명 구성 요소를 다음과 같이 확인하십시오.

- - SignatureValueRef 및 SignatureAlgorithmRef 속성을 사용하여 각각 확인할 서명을 포함하는 Value 요소와 서명을 확인하는 데 사용할 서명 알고리즘을 설명하는 Signature Algorithm 요소를 식별합니다.

- - 서명 알고리즘 요소가 비대칭 암호화가 사용되고 있음을 나타내는 경우 SignatureCertRef를 사용하여 서명 알고리즘에서 사용할 인증서를 식별합니다.

- - 서명 알고리즘 요소가 대칭 암호화가 사용되고 있음을 나타내는 경우 RecipientInfo 요소의 콘텐츠는 사용할 올바른 공유 비밀 키를 식별하는 데 사용됩니다.

- - 지정된 서명 알고리즘을 사용하여 값 요소가 매니페스트 요소에 올바르게 서명하는지 확인합니다.

- - 다이제스트에서 참조하는 구성 요소 또는 블록이 서명을 확인하는 조직에 의해 수신된 경우 매니페스트 요소의 다이제스트 요소가 올바르게 계산되었는지 확인합니다.

---
## **6.3 Checking a Payment or Delivery can occur**

이 섹션에서는 결제 처리자 또는 배달 처리자가 결제 또는 배송이 발생할 수 있는지 확인하는 데 필요한 프로세스에 대해 설명합니다. 판매자가 명시한 경우 여기에는 서명 확인이 포함될 수 있습니다.

개략적인 단계는 다음과 같습니다.

o 결제 요청 또는 배송 요청이 올바른 조직으로 전송되었는지 확인하세요.

o 요청에 올바른 IOTP 구성 요소가 있는지 확인하고

o 결제 또는 배송이 승인되었는지 확인하세요.

명확성과 간결성을 위해 이 섹션에서는 다음 용어나 문구를 사용합니다.

o "요청 블록"은 다르게 명시되지 않는 한 지불 요청 블록\(8.7항 참조\) 또는 배달 요청 블록\(8.10항 참조\)을 지칭하는 데 사용됩니다.

```text
   o  a "Response Block" is used to refer to either a Payment Response
      Block (see section 8.9) or a Delivery Response Block (see section
      8.11)
```

o "작업"은 요청 블록 수신 시 발생하는 작업을 나타내는 데 사용됩니다. 작업은 결제 또는 배송일 수 있습니다.

o "작업 조직"은 작업을 수행하는 지불 처리자 또는 배송 처리자를 지칭하는 데 사용됩니다.

o "작업 서명자"는 작업 전체 또는 일부를 승인하기 위해 작업에 대한 데이터에 서명하는 조직을 참조하는 데 사용됩니다.

o "조치 검증자"는 해당 조치를 수행할 권한이 있는지 결정하기 위해 데이터를 검증하는 조직을 지칭하는 데 사용됩니다.

o ActionOrgRef 속성에는 작업을 수행해야 하는 "작업 조직"을 식별하는 데 사용할 수 있는 요소 참조가 포함되어 있습니다.

---
### **6.3.1 Check Request Block sent Correct Organisation**

요청 블록이 올바른 조직으로 전송되었는지 확인하는 것은 요청이 지불을 참조하는지 아니면 배달을 참조하는지에 따라 다릅니다.

---
#### **6.3.1.1 Payment**

개요적으로 결제 핸들러는 수신한 결제 요청 블록에서 결제 구성 요소를 식별한 다음 결제 구성 요소의 ID를 사용하여 브랜드 목록 및 브랜드 선택 구성 요소를 추적하여 조직을 식별함으로써 결제를 수락하거나 결제할 수 있는지 확인합니다. 소비자가 선택한 다음 이 조직이 자신인지 확인합니다.

이를 위해 데이터에 액세스하는 방법은 아래 그림에 설명되어 있습니다.

```text
   *+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*
                                                     Start
                                                      |
                                                      v
   Brand List<--------------------------+-----------Payment
   Component         BrandListRef       |          Component
    |                                   |
    |-Brand<--------------------------  |
    | Element        BrandRef         | |
    |  |                          Brand Selection
    |  |Protocol                     Component
    |  | AmountRefs                   | |
    |  v                  Protocol    | |
    |-Protocol Amount<----------------  |
    | Element----------  AmountRef      |
    |  |               |                |
    |  |Currency       |Pay             |
    |  | AmountRefs    |Protocol        |
    |  v               |Ref             |
    |-Currency Amount  |                |
    | Element<---------|----------------
    |                  |
     -PayProtocol<-----
      Element---------------------->Organisation
                     Action         Component
                     OrgRef          |
                                      -Trading Role
                                        Element
                                     (Payment Handler)

   *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
```

- 그림 12 결제 처리자가 결제를 수행할 수 있는지 확인

다음은 관련 단계와 수행해야 할 점검 사항에 대해 설명합니다.

o 수신된 지불 요청 블록에서 지불 구성 요소\(섹션 7.9 참조\)를 식별합니다.

o 지불 구성요소에 대한 브랜드 목록 및 브랜드 선택 구성요소를 식별합니다. 여기에는 다음이 포함됩니다.

- - ID 속성 값이 결제 구성요소의 BrandListRef 속성과 일치하는 브랜드 목록 구성요소\(7.7항 참조\)를 식별합니다. 브랜드 목록 구성 요소가 하나 이상 발견되지 않으면 오류가 발생합니다.

- - BrandListRef 속성 값이 결제 구성요소의 BrandListRef와 일치하는 브랜드 선택 구성요소\(7.8항 참조\)를 식별합니다. 일치하는 브랜드 선택 구성 요소가 하나 이상 발견되지 않으면 오류가 발생합니다.

o 다음과 같이 소비자가 선택한 브랜드 목록 내 브랜드, 프로토콜 금액, 지불 프로토콜 및 통화 금액 요소를 식별합니다.

- - 선택된 브랜드 요소\(섹션 7.7.1 참조\)는 Id 속성 값이 브랜드 선택의 BrandRef 속성 값과 일치하는 요소입니다. 일치하는 브랜드 요소가 하나 이상 발견되지 않으면 오류가 발생합니다.

- - 선택된 프로토콜 금액 요소\(섹션 7.7.3 참조\)는 Id 속성 값이 브랜드 선택 구성 요소의 ProtocolAmountRef 속성 값과 일치하는 요소입니다. 일치하는 프로토콜 금액 요소가 하나 이상 발견되지 않으면 오류가 발생합니다.

- - 선택된 지불 프로토콜 요소\(섹션 7.7.5 참조\)는 Id 속성 값이 식별된 프로토콜 금액 요소의 PayProtocolRef 속성 값과 일치하는 요소입니다. 일치하는 지불 프로토콜 요소가 하나 이상 발견되지 않으면 오류가 발생합니다.

- - 선택된 통화 금액 요소\(섹션 7.7.4 참조\)는 Id 속성 값이 브랜드 선택 구성 요소의 통화AmountRef 속성 값과 일치하는 요소입니다. 일치하는 통화 금액 요소가 하나 이상 발견되지 않으면 오류가 발생합니다.

o 브랜드 목록 및 브랜드 선택 구성 요소의 참조 일관성을 확인하십시오.

- 요소 참조가 존재하는지 확인하십시오.

- 식별된 프로토콜 금액 요소의 Id 속성과 일치하는 식별된 브랜드 요소의 ProtocolAmountRefs 속성. 일치하는 요소 참조를 하나 이상 찾을 수 없으면 오류가 발생합니다.

- - 식별된 프로토콜 금액 요소의 통화AmountRefs 속성에 식별된 통화 금액 요소의 Id 속성과 일치하는 요소 참조가 포함되어 있는지 확인하세요. 일치하는 요소 참조가 하나 이상 발견되지 않으면 오류가 발생합니다.

- - 브랜드 목록에 있는 요소의 일관성을 확인하세요. 특히 선택한 브랜드, 프로토콜 금액, 지불 프로토콜 및 통화 금액 요소는 모두 식별된 브랜드 목록 구성 요소의 하위 요소입니다. 그렇지 않으면 오류가 있는 것입니다.

o 결제 요청 블록을 수신한 결제 핸들러가 소비자가 선택한 결제 핸들러인지 확인하세요. 여기에는 다음이 포함됩니다.

- - 지불 처리기에 대한 조직 구성 요소를 식별합니다. 이는 ID 속성이 식별된 지불 프로토콜 요소의 ActionOrgRef 속성과 일치하는 조직 구성요소입니다. 일치하는 조직 구성 요소가 하나 이상 발견되지 않으면 오류가 발생합니다.

- - 조직 구성 요소에 PaymentHandler의 역할 속성이 있는 거래 역할 요소가 있는지 확인합니다. 그렇지 않으면 오류가 발생합니다

- - 마지막으로 식별된 조직 구성요소가 지불 요청 블록을 수신한 조직과 동일하지 않은 경우 오류가 발생합니다.

---
#### **6.3.1.2 Delivery**

배달을 수행할 수 있는지 확인하기 위해 배달 핸들러가 데이터에 액세스하는 방법은 아래 그림에 설명되어 있습니다.

```text
   *+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*
                            Start
                              |
                              v
                           Delivery
                           Component
                              |
                              |ActionOrgRef
                              |
                              v
                           Organisation
                           Component
                           |
                            -Trading Role
                              Element
                           (Delivery Handler)

   *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
```

- 그림 13 Delivery Handler가 Delivery를 수행할 수 있는지 확인

관련된 단계는 다음과 같습니다.

o 배달 요청 블록에서 배달 구성요소를 식별합니다. 일치하는 전달 구성요소가 하나 이상 없거나 둘 이상인 경우 오류가 발생합니다.

o 배달 핸들러의 조직 구성요소를 식별하려면 배달 구성요소의 ActionOrgRef 속성을 사용하십시오. 일치하는 조직 구성 요소가 하나 이상인 경우 오류가 발생합니다.

o 배달 처리기의 조직 구성 요소에 DeliveryHandler의 역할 속성이 있는 거래 역할 요소가 없으면 오류가 발생합니다.

o 마지막으로, 배달 요청 블록을 수신한 조직이 배달 핸들러에 대한 조직 구성 요소를 자체적으로 식별하지 않으면 오류가 발생합니다.

---
### **6.3.2 Check Correct Components present in Request Block**

지불 요청 블록\(섹션 8.7 참조\) 또는 배달 요청 블록\(섹션 8.10 참조\)에 올바른 구성 요소가 있는지 확인하십시오.

구성요소가 누락된 경우 오류가 발생합니다.

---
### **6.3.3 Check an Action is Authorised**

이전 단계에서는 작업 조직을 식별했으며 필요한 모든 구성 요소가 존재함을 확인했습니다. 이 단계에서는 작업 조직이 작업을 수행할 권한이 있는지 확인합니다.

개요적으로 작업 조직은 가맹점을 식별하고 작업 수행을 허용하는 가맹점과의 기존 계약이 있는지, 해당 계약에 의해 암시된 모든 제약 사항이 준수되는지 확인한 다음 서명이 필요한 경우 확인합니다. 올바른 데이터에 서명했는지 확인하세요.

관련된 단계는 다음과 같습니다.

o 판매자를 식별합니다. 이는 값이 Merchant인 역할 속성을 갖는 거래 역할 요소가 있는 조직 구성요소입니다. 하나 이상의 거래 역할 요소가 발견되지 않으면 오류가 발생합니다.

o 조치 수행을 허용하는 판매자와 조치 조직의 합의를 확인하십시오. 이를 위해 활동 조직은 다음을 확인해야 합니다.

- - 판매자가 알려져 있고 조치 조직이 지불 또는 배송에 대한 대리인이 되는 기존 계약이 존재합니다.

- - 발생 중인 IOTP 트랜잭션 유형에 참여할 수 있습니다. 예를 들어 결제 처리자는 기본 구매의 일부로 결제를 수락하지만 기본 환불의 일부로 결제를 하지 않는 데 동의했을 수 있습니다.

- - 판매자와의 계약에 대한 모든 제약 조건을 준수하고 있습니다\(예: 제안 응답 서명이 필요한지 여부\).

o 서명이 올바른지 확인하세요. 서명이 필요한 경우에는 확인이 필요합니다. 여기에는 다음이 포함됩니다.

- - 확인할 올바른 서명을 식별합니다. 여기에는 행동 조직에 대한 참조가 포함된 서명 구성요소를 식별하는 행동 조직이 포함됩니다\(6.3.1 참조\). 수행 중인 IOTP 트랜잭션\(섹션 9 참조\)에 따라 하나 또는 두 개의 서명이 식별될 수 있습니다.

- - 서명 구성요소가 올바른지 확인합니다. 여기에는 필요한 거래 구성 요소를 참조하는 Manifest 요소 내에 Digest 요소가 존재하는지 확인하는 작업이 포함됩니다\(섹션 6.3.3.1 참조\).

---
#### **6.3.3.1 Check the Signatures Digests are correct**

IOTP 메시지에 포함된 모든 서명 구성 요소에는 다음을 참조하는 다이제스트 요소가 포함되어야 합니다.

o 서명 구성요소를 포함하는 IOTP 메시지의 트랜잭션 ID 구성요소\(섹션 3.3.1 참조\). 이는 전역적으로 고유한 IotpTransId를 IOTP 트랜잭션을 구성하는 다른 구성 요소에 바인딩합니다.

o 서명이 포함된 첫 번째 IOTP 메시지의 트랜잭션 참조 블록\(섹션 3.3 참조\). 이는 IotpTransId를 메시지 ID 구성 요소 내에 포함된 IOTP 메시지에 대한 정보와 바인딩합니다\(섹션 3.3.2 참조\).

각 서명 구성 요소에 필요한 올바른 데이터를 참조하는 다이제스트 요소가 포함되어 있는지 확인하십시오.

존재해야 하는 다이제스트 요소는 서명을 생성\(서명\)한 조직의 거래 역할에 따라 다릅니다.

o 서명 서명자가 판매자인 경우:

- - 선택 사항인 브랜드 선택 구성 요소를 제외하고 요청 블록의 모든 구성 요소에 대해 다이제스트 요소가 있어야 합니다.

o 서명 서명자가 결제 처리자라면 다음 항목에 대한 다이제스트 요소가 있어야 합니다.

- - 판매자가 서명한 서명 구성 요소 및 선택적으로

- - 거래에서 이전 결제 처리자가 서명한 하나 이상의 서명 구성요소.

---
## **7. Trading Components**

이 섹션에서는 IOTP 내에서 사용되는 거래 구성요소에 대해 설명합니다. 거래 구성요소는 아래 다이어그램에 표시된 대로 거래 블록 바로 아래에 나타나는 하위 XML 요소입니다.

```text
   *+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*

             IOTP MESSAGE  <----------- IOTP Message - an XML Document
              |                         which is transported between the
              |                         Trading Roles
              |-Trans Ref Block <-----  Trans Ref Block - contains
              |  |                      information which describes the
              |  |                      IOTP Transaction and the IOTP
                                        Message.
    --------> |  |-Trans Id Comp. <---  Transaction Id Component -
   |          |  |                      uniquely identifies the IOTP
   |          |  |                      Transaction. The Trans Id
   |          |  |                      Components are the same across
   |          |  |                      all IOTP messages that comprise
   |          |  |                      a single IOTP transaction.
   |          |  |-Msg Id Comp. <-----  Message Id Component -
   |          |                         identifies and describes an IOTP
   |          |                         Message within an IOTP
   |          |                         Transaction
   |          |-Signature Block <-----  Signature Block (optional) -
   |          |  |                      contains one or more Signature
   |          |  |                      Components and their associated
   |          |  |                      Certificates
   |     ---> |  |-Signature Comp. <--  Signature Component - contains
   |    |     |  |                      digital signatures. Signatures
   |    |     |  |                      may sign digests of the Trans Ref
   |    |     |  |                      Block and any Trading Component
   |    |     |  |                      in any IOTP Message in the same
   |    |     |  |                      IOTP Transaction.
   |    |     |  |-Certificate Comp. <- Certificate Component. Used to
   |    |     |                         check the signature.
     Trading  |-Trading Block <-------- Trading Block - an XML Element
   Components |  |-Trading Comp.        within an IOTP Message that
   |    |     |  |-Trading Comp.        contains a predefined set of
   |     ---> |  |-Trading Comp.        Trading Components
   |          |  |-Trading Comp.
   |          |  |-Trading Comp. <----- Trading Components - XML
   |          |                         Elements within a Trading Block
   |          |-Trading Block           that contain a predefined set of
    --------> |  |-Trading Comp.        XML elements and attributes
              |  |-Trading Comp.        containing information required
              |  |-Trading Comp.        to support a Trading Exchange
              |  |-Trading Comp.
              |  |-Trading Comp.
   *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*

                          Figure 14 Trading Components
```

이 섹션에 설명된 거래 구성요소는 대략 사용되는 순서대로 나열되어 있습니다.

```text
   o  Protocol Options Component

   o  Authentication Request Component

   o  Authentication Response Component

   o  Trading Role Information Request Component

   o  Order Component

   o  Organisation Component

   o  Brand List Component

   o  Brand Selection Component

   o  Payment Component

   o  Payment Scheme Component

   o  Payment Receipt Component

   o  Delivery Component

   o  Delivery Data Component

   o  Delivery Note Component

   o  Signature Component

   o  Certificate Component

   o  Error Component
```

이 사양의 다른 섹션에는 다음 구성 요소가 나열되어 있습니다.

```text
   o  Transaction Id Component (see section 3.3.1)

   o  Message Id Component (see section 3.3.2)
```

---
## **7.1 Protocol Options Component**

프로토콜 옵션은 IOTP 트랜잭션 전체에 적용되는 옵션입니다. 기본적으로 전체 트랜잭션에 대한 간단한 설명과 IOTP 트랜잭션이 성공한 경우 소비자 역할이 분기되어야 하는 순 위치를 제공합니다.

프로토콜 옵션 구성요소의 정의는 다음과 같습니다.

```text
   <!ELEMENT ProtocolOptions EMPTY >
   <!ATTLIST ProtocolOptions
    ID                 ID      #REQUIRED
    xml:lang           NMTOKEN #REQUIRED
    ShortDesc          CDATA   #REQUIRED
    SenderNetLocn      CDATA   #IMPLIED
    SecureSenderNetLocn CDATA  #IMPLIED
    SuccessNetLocn     CDATA   #REQUIRED >

   Attributes:
```

ID IOTP 트랜잭션 내에서 프로토콜 옵션 구성 요소를 고유하게 식별하는 식별자입니다.

Xml:lang 하위 요소의 xml:lang 특성으로 재정의되지 않는 한 이 구성 요소 내의 특성 또는 하위 요소에서 사용되는 언어를 정의합니다. 섹션 3.8 언어 식별을 참조하세요.

ShortDesc 여기에는 xml:lang에 정의된 언어로 된 IOTP 트랜잭션에 대한 간단한 설명이 포함되어 있습니다. 그 목적은 관련 당사자가 어떤 유형의 IOTP 거래를 수행하고 있는지 설명을 제공하는 것입니다.

- 유사한 거래 목록\(예: 소비자, 판매자 등이 저장한 IOTP 거래 데이터베이스\)에서 개별 거래를 쉽게 선택하는 데 사용됩니다.

SenderNetLocn 여기에는 프로토콜 옵션 구성 요소가 포함된 TPO 블록 발신자의 비보안 네트워크 위치가 포함됩니다.

- TPO 블록 수신자가 필요할 경우 TPO 선택 블록을 보내야 하는 네트 위치입니다.

- 이 속성의 내용은 전송 메커니즘에 따라 달라집니다. 전송 메커니즘 보충 자료를 참조하세요.

SecureSenderNetLocn 여기에는 프로토콜 옵션 구성 요소가 포함된 TPO 블록 발신자의 보안된 네트워크 위치가 포함됩니다.

- 이 속성의 내용은 전송 메커니즘에 따라 달라집니다. 전송 메커니즘 보충 자료를 참조하세요.

SuccessNetLocn 여기에는 IOTP 트랜잭션이 성공적으로 완료된 후 표시되어야 하는 네트 위치가 포함됩니다.

- 이 속성의 내용은 전송 메커니즘에 따라 달라집니다. 전송 메커니즘 보충 자료를 참조하세요.

SenderNetLocn, SecureSenderNetLocn 또는 둘 다 존재해야 합니다.

---
## **7.2 Authentication Request Component**

이 거래 구성요소에는 다른 거래 역할에 의한 하나의 거래 역할 인증에 사용되는 매개변수 데이터가 포함되어 있습니다. 그 정의는 다음과 같습니다.

```text
   <!ELEMENT AuthReq (Algorithm, PackagedContent*)>
   <!ATTLIST AuthReq
    ID                 ID      #REQUIRED
    AuthenticationId   CDATA   #REQUIRED
    ContentSoftwareId  CDATA   #IMPLIED >
```

필요한 경우 알고리즘은 인증 요청 구성 요소 내의 패키지 콘텐츠 요소에 포함된 챌린지 데이터를 계산에 사용할 수 있습니다. 패키지 콘텐츠의 형식은 알고리즘에 따라 다릅니다.

```text
   Attributes:
```

ID IOTP 트랜잭션 내에서 인증 요청 구성 요소를 고유하게 식별하는 식별자입니다.

AuthenticationId 인증 요청을 수신하는 조직이 반환하는 경우 인증자가 지정한 식별자입니다.

- 어떤 인증이 참조되고 있는지 식별하는 인증자입니다.

```text
   ContentSoftwareId  See section 14.Glossary

   Content:
```

PackagedContent 여기에는 Algorithm 요소에 의해 정의된 알고리즘을 사용하여 응답할 하나 이상의 패키지 콘텐츠\(섹션 3.7 참조\)로서의 챌린지 데이터가 포함됩니다.

알고리즘 여기에는 인증 응답을 생성하는 데 사용해야 하는 알고리즘\(7.19 서명 구성 요소 참조\)을 설명하는 정보가 포함됩니다.

- 사용될 수 있는 알고리즘은 Algorithm 요소의 Name 속성으로 식별됩니다. 유효한 값은 섹션 12. IANA 고려사항을 참조하세요.

---
## **7.3 Authentication Response Component**

인증 응답 구성 요소에는 인증 요청 결과가 포함되어 있습니다. 이는 인증 요청 블록\(섹션 8.4 참조\)에서 선택된 인증 요청 구성 요소\(섹션 7.2 참조\)에 포함된 알고리즘을 사용합니다.

선택한 알고리즘에 따라 알고리즘 적용 결과는 인증 응답과 잠재적으로 다른 데이터를 모두 서명하는 서명 구성 요소에 포함되거나 인증 응답 구성 요소 내의 패키지 콘텐츠 요소에 포함됩니다. 그 정의는 다음과 같습니다.

```text
   <!ELEMENT AuthResp (PackagedContent*) >
   <!ATTLIST AuthResp
    ID                 ID      #REQUIRED
    AuthenticationId   CDATA   #REQUIRED
    SelectedAlgorithmRef NMTOKEN #REQUIRED
    ContentSoftwareId  CDATA   #IMPLIED >

   Attributes:
```

ID IOTP 트랜잭션 내에서 인증 응답 구성 요소를 고유하게 식별하는 식별자입니다.

AuthenticationId 인증 요청 구성 요소에 포함된 인증자가 지정한 인증 식별자입니다\(섹션 7.2 참조\). 이를 통해 인증자는 참조되는 인증을 식별할 수 있습니다.

SelectedAlgorithmRef 인증 응답을 생성하는 데 사용되는 알고리즘 요소를 식별하는 요소 참조입니다.

```text
   ContentSoftwareId      See section 14.Glossary.

   Content:
```

PackagedContent 여기에는 섹션 7.2를 참조하여 인증 요청 구성 요소에서 선택한 알고리즘을 적용한 결과 생성된 응답이 포함될 수 있습니다.

- 예를 들어 특정 결제 방식의 경우 해당 방식별 데이터가 포함될 수 있습니다. 내용의 정의는 제도별 보충 문서를 참조하십시오.

---
## **7.4 Trading Role Information Request Component**

이 거래 구성요소에는 정보가 요청되는 거래 역할 목록\(섹션 2.1 참조\)이 포함되어 있습니다. 거래 역할 요청의 결과는 요청된 각 거래 역할을 설명하는 조직 구성 요소 집합\(섹션 7.6 참조\)입니다.

```text
   Example usage includes:
```

o 소비자가 소비자 및 DelivTo 거래 역할을 위한 조직 구성 요소를 제공하도록 요청하는 판매자

o 판매자가 사용하는 결제 처리자 및 배달 처리자에 대한 정보를 판매자에게 요청하는 소비자.

그 정의는 다음과 같습니다.

```text
   <!ELEMENT TradingRoleInfoReq EMPTY>
   <!ATTLIST TradingRoleInfoReq
    ID                 ID      #REQUIRED
    TradingRoleList    NMTOKENS #REQUIRED >

   Attributes:
```

ID IOTP 거래 내에서 거래 역할 정보 요청 구성 요소를 고유하게 식별하는 식별자입니다.

TradingRoleList 정보가 요청되는 하나 이상의 거래 역할\(거래 역할 요소의 TradingRole 속성 - 섹션 7.6.2 참조\) 목록을 포함합니다.

---
## **7.5 Order Component**

주문 구성요소에는 주문에 대한 정보가 포함되어 있습니다. 그 정의는 다음과 같습니다.

```text
   <!ELEMENT Order (PackagedContent*) >
   <!ATTLIST Order
    ID                 ID      #REQUIRED
    xml:lang           NMTOKEN #REQUIRED
    OrderIdentifier    CDATA   #REQUIRED
    ShortDesc          CDATA   #REQUIRED
    OkFrom             CDATA   #REQUIRED
    OkTo               CDATA   #REQUIRED
    ApplicableLaw      CDATA   #REQUIRED
    ContentSoftwareId  CDATA   #IMPLIED >

   Attributes:
```

ID IOTP 트랜잭션 내에서 주문 구성요소를 고유하게 식별하는 식별자입니다.

xml:lang 하위 요소의 xml:lang 속성으로 재정의되지 않는 한 이 구성 요소 내의 속성 또는 하위 요소에서 사용되는 언어를 정의합니다. 섹션 3.8 언어 식별을 참조하세요.

OrderIdentifier 이것은 코드, 참조 번호 또는 기타입니다.

- 주문 작성자가 주문을 식별하는 데 사용할 수 있는 식별자입니다. IOTP 트랜잭션 내에서 고유해야 합니다. 이러한 방식으로 사용되면 참조를 사용하여 데이터베이스에서 필요한 정보를 검색할 수 있으므로 Order 요소에 대한 콘텐츠를 지정할 필요가 없습니다.

```text
   ShortDesc          A short description of the order in the language
                      defined by xml:lang. It is used to facilitate
                      selecting an individual order from a list of
```

- 예를 들어 소비자, 판매자 등이 저장한 주문 데이터베이스의 주문

OkFrom 판매자가 제공한 제안이 만료되는 날짜 및 시간\(\[UTC\] 형식\)입니다.

OkTo 가치 획득자가 판매자의 제안을 수락할 수 있는 \[UTC\] 형식의 날짜 및 시간은 유효하지 않습니다.

ApplicableLaw 문제나 분쟁 해결에 적용될 관할권의 주 또는 국가를 설명하는 xml:lang에 의해 정의된 언어로 된 문구입니다.

```text
   ContentSoftwareId  See section 14.Glossary.

   Content:
```

PackagedContent 하나 이상의 패키지 콘텐츠로 주문 정보에 대한 선택적 설명입니다\(섹션 3.7 참조\).

---
### **7.5.1 Order Description Content**

패키지 콘텐츠 요소는 일반적으로 필요하지만 ShortDesc 속성에 구매에 대한 충분한 정보가 제공될 수 있는 경우 생략될 수 있습니다. 전체 주문 설명에 필요한 경우 여러 패키지 콘텐츠 요소를 사용할 수 있습니다.

금액과 통화가 주문 설명의 패키지 콘텐츠에 나타날 가능성이 높더라도 신뢰할 수 있는 것은 결제 관련 거래 구성요소\(브랜드 목록, 브랜드 선택 및 결제\)에 포함된 금액과 통화입니다. 이는 실제로 지불되는 금액\(결제 관련 거래 구성요소에 포함됨\)이 소비자에게 눈에 띄게 표시되는 것이 중요하다는 것을 의미합니다.

상호 운용성을 위해 구현은 쉽게 표시될 수 있도록 최소한 일반 텍스트, HTML 및 XML을 지원해야 합니다.

---
### **7.5.2 OkFrom and OkTo Timestamps**

```text
   Note that:
```

o OkFrom 날짜는 이 주문과 관련된 결제 구성요소\(섹션 7.9 참조\)의 OkFrom 날짜보다 이후일 수 있습니다.

o 마찬가지로 OkTo 날짜는 결제 구성요소의 OkTo 날짜보다 이전일 수 있습니다\(섹션 7.9 참조\).

참고: 면책조항. 이 노트에 제공된 다음 정보는 이 사양 작성자의 공식적인 조언을 나타내지 않습니다. 이 사양의 독자는 이 정보의 유용성과 적용 가능성에 대해 자신의 견해를 형성하고 법적 조언을 구해야 합니다.

익명의 소비자와의 인터넷 상거래 맥락에서 판매자는 처음에 웹 페이지에 제안 조건을 구성하고, 상품이나 서비스를 얻으려면 소비자가 이를 수락해야 합니다.

시간 제한이 있는 제안이 있을 경우 판매자는 이를 소비자에게 알리고 주문 설명에 다음 사항을 소비자에게 명확히 명시하는 것이 좋습니다.

o 제안은 시간 제한이 있습니다

o OkFrom 및 OkTo 타임스탬프는 제안의 유효성을 지정합니다.

o 제안의 유효성을 결정하는 데 사용되는 시계\(예: 판매자의 시계\)

또한 OkFrom 및 OkTo 날짜가 주문 설명의 패키지 콘텐츠에 나타날 수 있지만 신뢰할 수 있는 것은 주문 구성 요소에 포함된 날짜입니다. 즉, 실제로 사용되는 OkFrom 및 OkTo 날짜가 소비자에게 눈에 띄게 표시되는 것이 중요합니다.

---
## **7.6 Organisation Component**

조직 구성요소는 개인이나 조직에 대한 정보를 제공합니다. 이는 다양한 목적으로 사용될 수 있습니다. 예를 들어:

o 상품을 판매하는 상인을 설명하기 위해,

o 누가 구매했는지 확인하기 위해,

o 상품 배송을 받을 사람을 식별하기 위해,

o 고객 관리 연락처를 제공하기 위해

o 누가 지불 처리자가 될 것인지 설명합니다.

IOTP 메시지에 있어야 하는 조직 구성 요소는 수행되는 특정 트랜잭션에 따라 달라집니다. 자세한 내용은 섹션 9. 인터넷 공개 거래 프로토콜 거래를 참조하십시오.

그 정의는 다음과 같습니다.

```text
   <!ELEMENT Org (TradingRole+, ContactInfo?,
        PersonName?, PostalAddress?)>
   <!ATTLIST Org
    ID                 ID      #REQUIRED
    xml:lang           NMTOKEN #REQUIRED
    OrgId              CDATA   #REQUIRED
    LegalName          CDATA   #IMPLIED
    ShortDesc          CDATA   #IMPLIED
    LogoNetLocn        CDATA   #IMPLIED >

   Attributes:
```

ID IOTP 트랜잭션 내에서 조직 구성 요소를 고유하게 식별하는 식별자입니다.

xml:lang 하위 요소의 xml:lang 속성으로 재정의되지 않는 한 이 구성 요소 내의 속성 또는 하위 요소에서 사용되는 언어를 정의합니다. 섹션 3.8 언어 식별을 참조하세요.

OrgId 조직 구성요소가 설명하는 조직을 식별하는 코드입니다. 아래의 7.6.1 조직 ID를 참조하세요.

LegalName 회사인 조직의 경우 이는 xml:lang에 의해 정의된 언어로 된 법적 이름입니다. 소비자 또는 DelivTo 이외의 거래 역할을 가진 조직에 필요합니다.

ShortDesc xml:lang에 정의된 언어로 된 조직에 대한 간단한 설명입니다. 일반적으로 조직이 일반적으로 알려진 이름입니다. 예를 들어 법적 이름이 "Blue Meadows Financial Services Inc."인 경우입니다. 그렇다면 짧은 이름은 "Blue Meadows"가 될 것입니다.

```text
                      It is used to facilitate selecting an individual
                      Organisation from a list of Organisations, for
                      example from a database of Organisations involved
```

- 소비자가 저장한 IOTP 트랜잭션에서.

LogoNetLocn 조직의 로고를 다운로드하는 데 사용할 수 있는 네트워크 위치입니다.

```text
                      See section 10 Retrieving Logos.
```

- 이 속성의 내용은 \[RFC1738\]을 준수해야 합니다.

```text
   Content:

   TradingRole        See 7.6.2 Trading Role Element below.

   ContactInfo        See 7.6.3 Contact Information Element below.

   PersonName         See 7.6.4 Person Name below.

   PostalAddress      See 7.6.5 Postal Address below.
```

---
### **7.6.1 Organisation IDs**

조직 ID는 하나의 IOTP 거래 역할에서 다른 역할을 식별하는 데 사용됩니다. 혼란을 피하기 위해 이는 이러한 ID가 전역적으로 고유해야 함을 의미합니다.

원칙적으로 이는 다음과 같은 방식으로 달성됩니다.

o 소비자 거래 역할을 제외한 모든 거래 역할의 조직 ID는 도메인 이름을 전역 고유 식별자로 사용합니다.

o 소비자 거래 역할에 대한 조직 ID는 IOTP 거래의 다른 거래 역할 중 하나에 의해 할당되며 이를 다른 역할의 조직 ID와 연결하여 고유하게 만들어집니다.

o IOTP 트랜잭션 내에서 소비자에게 조직 ID가 할당되면 해당 IOTP 트랜잭션의 다른 모든 거래 역할에서 동일한 조직 ID를 사용하여 해당 소비자를 식별합니다.

구체적으로 조직 ID의 내용은 다음과 같이 정의됩니다.

```text
   OrgId ::= NonConsumerOrgId | ConsumerOrgId
   NonConsumerOrgId ::= DomainName
   ConsumerOrgId ::= ConsumerOrgIdPrefix (namechar)+ "/" NonConsumerOrgId
   ConsumerOrgIdPrefix ::= "Consumer:"

   ConsumerOrgId      The Organisation ID for a Consumer consists of:
                       o a standard prefix to identify that the
                         Organisation Id is for a consumer, followed by
```

- o XML "namechar"의 정의를 따르는 하나 이상의 문자. o ConsumerOrgId를 할당한 조직에 대한 NonConsumerOrgId가 뒤따르는 \[XML\] 사양을 참조하세요. 일반적으로 판매자 역할입니다.

- 대문자, 소문자의 사용은 중요하지 않습니다.

NonConsumerOrgId 역할이 소비자가 아닌 경우 조직 구성 요소에서 설명하는 비소비자 조직의 정식 이름이 포함됩니다. NonConsumerOrgId를 고유하게 만들려면 필요한 경우 선택적으로 추가 문자가 뒤에 오는 \[DNS\]를 참조하세요.

- NonConsumerOrgId는 ConsumerOrgIdPrefix로 시작되지 않을 수 있습니다.

- 대문자, 소문자의 사용은 중요하지 않습니다.

조직 ID의 예는 다음과 같습니다.

o newjerseybooks.com - 판매자 조직 ID

o westbank.co.uk - 결제 처리자 조직 ID

o 소비자:1000247ABH/newjerseybooks.com - 판매자가 할당한 소비자 조직 ID

---
### **7.6.2 Trading Role Element**

이는 IOTP 거래에서 개인 또는 조직의 거래 역할을 식별합니다. 조직은 하나 이상의 거래 역할을 가질 수 있으며 하나의 조직 요소에 여러 역할이 존재할 수 있습니다. 그 정의는 다음과 같습니다:

```text
   <!ELEMENT TradingRole EMPTY >
   <!ATTLIST TradingRole
    ID                 ID      #REQUIRED
    TradingRole        NMTOKEN #REQUIRED
    IotpMsgIdPrefix    NMTOKEN #REQUIRED
    CancelNetLocn      CDATA   #IMPLIED
    ErrorNetLocn       CDATA   #IMPLIED

    ErrorLogNetLocn    CDATA   #IMPLIED >

   Attributes:
```

ID IOTP 트랜잭션 내에서 거래 역할 요소를 고유하게 식별하는 식별자입니다.

TradingRole 조직의 거래 역할입니다. 유효한 값은 다음과 같습니다. o 소비자. IOTP 트랜잭션에서 소비자 역할을 수행하는 개인 또는 조직입니다. 오 상인. IOTP 거래에서 판매자 역할을 수행하는 개인 또는 조직입니다. o 지불 처리기. IOTP 거래에 대한 결제 처리자인 금융 기관 또는 기타 조직 o DeliveryHandler. IOTP 거래 o DelivTo를 위해 상품 또는 서비스를 제공하는 개인 또는 조직입니다. IOTP 거래 또는 CustCare에서 상품 또는 서비스를 제공받는 개인 또는 조직입니다. IOTP 거래에 대한 고객 관리를 제공할 조직 및/또는 개인입니다.

- TradingRole 값은 사용자 정의 값 정의를 허용하는 섹션 12 IANA 고려 사항에 정의된 절차에 따라 제어됩니다.

IotpMsgIdPrefix 이 IOTP 트랜잭션에서 거래 역할이 보낸 모든 IOTP 메시지에 사용해야 하는 접두사를 포함합니다. 사용되는 값은 3.4.1 IOTP 메시지 ID 속성 정의에 정의되어 있습니다.

CancelNetLocn 소비자가 어떤 이유로 트랜잭션을 취소하는 경우 소비자가 이동해야 하는 순 위치를 포함합니다. 특정 거래의 상황에 더 적합한 응답을 제공하기 위해 거래 역할에서 사용할 수 있습니다.

```text
                      This attribute:
                       o must not be present when TradingRole is set to
                         Consumer role or DelivTo,
```

- o TradingRole이 Merchant, PaymentHandler 또는 DeliveryHandler로 설정된 경우 존재해야 합니다.

- 이 속성의 내용은 전송 메커니즘에 따라 달라집니다. 전송 메커니즘 보충 자료를 참조하세요.

ErrorNetLocn 여기에는 소비자가 심각도 속성이 다음 중 하나로 설정된 오류 구성 요소를 포함하는 오류 블록을 수신하거나 생성한 후 소비자가 표시해야 하는 순 위치가 포함됩니다. o HardError, o 경고. 그러나 소비자는 해당 오류를 계속하지 않기로 결정합니다. 트랜잭션 o TransientError 및 트랜잭션이 이후에 시간 초과되었습니다.

- 자세한 내용은 섹션 7.21.1 오류 처리 지침을 참조하세요.

이 속성은 다음과 같습니다.

- o TradingRole이 Consumer 또는 DelivTo로 설정된 경우에는 없어야 하며, o TradingRole이 Merchant, PaymentHandler 또는 DeliveryHandler로 설정된 경우에는 있어야 합니다.

- 이 속성의 내용은 전송 메커니즘에 따라 달라집니다. 전송 메커니즘 보충 자료를 참조하세요.

ErrorLogNetLocn 선택사항. 여기에는 심각도 속성이 다음 중 하나로 설정된 오류 구성 요소와 함께 오류 블록을 포함하는 오류 블록이 포함된 IOTP 메시지를 소비자가 보내야 하는 순 위치가 포함됩니다. o HardError, o 경고가 있지만 소비자가 트랜잭션을 계속하지 않기로 결정함 o TransientError 및 이후에 트랜잭션 시간이 초과됨 밖으로.

```text
                      This attribute:
                       o must not be present when TradingRole is set to
                         Consumer role,
```

- o TradingRole이 Merchant, PaymentHandler 또는 DeliveryHandler로 설정된 경우 존재해야 합니다.

- 이 속성의 내용은 전송 메커니즘에 따라 달라집니다. 전송 메커니즘 보충 자료를 참조하세요.

- ErrorLogNetLocn은 소프트웨어 회사나 수신 메시지를 보낸 소프트웨어의 문제를 해결하는 다른 조직에 오류 메시지를 보내는 데 사용될 수 있습니다. 자세한 내용은 섹션 7.21.1 오류 처리 지침을 참조하세요.

---
### **7.6.3 Contact Information Element**

여기에는 조직이나 개인에게 연락하는 데 사용할 수 있는 정보가 포함되어 있습니다. 모든 속성은 선택 사항이지만 연락처 정보 항목이 하나 이상 있어야 합니다. 그 정의는 다음과 같습니다.

```text
   <!ELEMENT ContactInfo EMPTY >
   <!ATTLIST ContactInfo
    xml:lang           NMTOKEN #IMPLIED
    Tel                CDATA   #IMPLIED
    Fax                CDATA   #IMPLIED
    Email              CDATA   #IMPLIED
    NetLocn            CDATA   #IMPLIED >

   Attributes:
```

xml:lang 이 요소 내의 속성에 사용되는 언어를 정의합니다. 섹션 3.8 언어 식별을 참조하세요.

Tel 조직에 연락할 수 있는 전화번호입니다. 이는 텍스트 필드이므로 유효성 검사가 수행되지 않습니다.

팩스 조직에 연락할 수 있는 팩스 번호입니다. 이는 텍스트 필드이므로 유효성 검사가 수행되지 않습니다.

이메일 조직에 연락할 수 있는 이메일 주소입니다. 이 필드는 \[RFC822\]에 포함된 주소 사양에 대한 규칙을 준수해야 합니다.

NetLocn 웹 브라우저를 사용하여 표시할 수 있으며 조직에 대한 정보를 얻을 수 있는 인터넷상의 위치입니다.

- 이 속성의 내용은 \[RFC1738\]을 준수해야 합니다.

---
### **7.6.4 Person Name Element**

여기에는 개인의 이름이 포함됩니다. 모든 필드는 선택 사항이지만 최소한 GiveName 또는 FamilyName이 있어야 합니다. 그 정의는 다음과 같습니다.

```text
   <!ELEMENT PersonName EMPTY >
   <!ATTLIST PersonName
    xml:lang           NMTOKEN #IMPLIED
    Title              CDATA   #IMPLIED
    GivenName          CDATA   #IMPLIED
    Initials           CDATA   #IMPLIED
    FamilyName         CDATA   #IMPLIED >

   Attributes:
```

xml:lang 이 요소 내의 속성에 사용되는 언어를 정의합니다. 섹션 3.8 언어 식별을 참조하세요.

```text
   Title              A distinctive name; personal appellation,
                      hereditary or not, denoting or implying office
                      (e.g., judge, mayor) or nobility (e.g., duke,
                      duchess, earl), or used in addressing or referring
                      to a person (e.g., Mr, Mrs, Miss)
```

GiveName 개인이 가족, 친구, 지인에게 알려지고 식별되는 기본 또는 기본 이름입니다. 그렇지 않으면 이름 또는 기독교 이름으로 알려져 있습니다.

이니셜 개인이 가족, 친구, 지인에게 알려지거나 식별되는 보조 이름\(이름 제외\)의 첫 글자입니다.

FamilyName 관련 개인의 가족이 알려진 이름입니다. 이는 일반적으로 부모가 자녀에게 전달하는 개인 이름의 일부입니다.

---
### **7.6.5 Postal Address Element**

여기에는 상품, 서비스 또는 서신의 물리적 배송 등에 사용될 수 있는 주소가 포함됩니다. 그 정의는 다음과 같습니다.

```text
   <!ELEMENT PostalAddress EMPTY >
   <!ATTLIST PostalAddress
    xml:lang           NMTOKEN #IMPLIED
    AddressLine1       CDATA   #IMPLIED
    AddressLine2       CDATA   #IMPLIED
    CityOrTown         CDATA   #IMPLIED
    StateOrRegion      CDATA   #IMPLIED
    PostalCode         CDATA   #IMPLIED
    Country            CDATA   #IMPLIED
    LegalLocation (True | False) 'False' >

   Attributes:
```

xml:lang 이 요소 내의 속성에 사용되는 언어를 정의합니다. 섹션 3.8 언어 식별을 참조하세요.

```text
   AddressLine1       The first line of a postal address. e.g., "The
                      Meadows"

   AddressLine2       The second line of a postal address. e.g., "Sandy
                      Lane"

   CityOrTown         The city of town of the address. e.g., "Carpham"

   StateOrRegion      The state or region within a country where the
                      city or town is placed. e.g., "Surrey"

   PostalCode        The code known as, for example a post code or zip
                      code, that is typically used by Postal
                      Organisations to organise postal deliveries into
                      efficient sequences. e.g., "KT22 1AA"

   Country            The country for the address. e.g., "UK"
```

LegalLocation 주소가 조직에 등록된 주소인지 여부를 식별합니다. 거래 역할이 소비자 또는 DeliverTo가 아닌 한 조직에 대한 하나 이상의 주소는 True로 설정된 값을 가져야 합니다.

---
## **7.7 Brand List Component**

브랜드 목록 구성요소는 IOTP 거래의 거래 프로토콜 옵션 블록\(섹션 8.1 참조\) 내에 포함되어 있습니다. 여기에는 다음 목록이 포함됩니다.

```text
   o  payment Brands (see also section 11.1 Brand Definitions and Brand
      Selection),
```

o 판매자가 수락하거나 제안한 통화로 지불할 금액

o 브랜드를 통해 결제하는 데 사용할 수 있는 결제 프로토콜, 그리고

o 지불 프로토콜에 대한 지불을 수락하는 지불 처리자의 순 위치

브랜드 목록 구성요소의 정의는 다음과 같습니다.

```text
   <!ELEMENT BrandList (Brand+, ProtocolAmount+,
    CurrencyAmount+, PayProtocol+) >
   <!ATTLIST BrandList
    ID                 ID      #REQUIRED
    xml:lang           NMTOKEN #REQUIRED
    ShortDesc          CDATA   #REQUIRED
    PayDirection (Debit | Credit) #REQUIRED >

   Attributes:
```

ID IOTP 거래 내에서 브랜드 목록 구성 요소를 고유하게 식별하는 식별자입니다.

xml:lang 하위 요소의 xml:lang 속성으로 재정의되지 않는 한 이 구성 요소 내의 속성 또는 하위 요소에서 사용되는 언어를 정의합니다. 섹션 3.8 언어 식별을 참조하세요.

ShortDesc 브랜드 목록의 목적에 대한 세부 정보를 제공하는 xml:Lang에 의해 정의된 언어로 된 텍스트 설명입니다. 이 정보는 선택을 돕기 위해 브랜드 목록 수신자에게 표시되어야 합니다. IOTP 거래에 2회 이상의 결제가 포함될 때 소비자가 브랜드 목록의 목적을 구별할 수 있도록 허용하는 것은 특히 이점이 있습니다.

PayDirection 선택한 브랜드에 대한 결제 방향을 나타냅니다. 그 값은 다음과 같습니다: o 차변 이 브랜드 목록과 관련된 지불 요청 블록의 발송인\(예: 소비자\)이 지불 처리자에게 지불을 할 것입니다. 또는 o 신용 이 브랜드 목록과 관련된 지불 요청 블록의 발송인입니다 관련된 사람은 결제 처리자로부터 결제를 받습니다.

```text
   Content:
```

브랜드 브랜드를 설명합니다. 브랜드 목록 내 브랜드 요소의 순서\(섹션 7.7.1 참조\)는 어떤 선호도도 나타내지 않습니다. 이 브랜드 목록을 처리하는 소프트웨어는 브랜드 목록 수신자가 선호하는 순서로 브랜드를 표시하는 것이 좋습니다.

```text
   ProtocolAmount     This links a particular Brand to:
                       o the currencies and amounts in CurrencyAmount
                         elements that can be used with the Brand, and
                       o the Payment Protocols and Payment Handlers,
                         which can be used with those currencies and
                         amounts, and a particular Brand
```

통화Amount 여기에는 통화 코드와 금액이 포함됩니다.

PayProtocol 여기에는 특정 브랜드와 함께 사용될 수 있는 결제 프로토콜 및 결제 핸들러에 대한 정보가 포함되어 있습니다.

브랜드 목록의 콘텐츠를 구성하는 요소 간의 관계는 아래 다이어그램에 설명되어 있습니다.

```text
   *+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*

                    Brand List Component

                      |                   ProtocolAmountRefs
                      |-Brand Element-----------------------------
                      |  |                                        |
                      |   - Protocol Brand Element--------        |
                      |                                   |       |
                      |                         ProtocolId|       |
                      |                                   |       |
                      |-Protocol Amount Element<----------+-------
                      |  |                      |         |
                      |  |                      |         |
                      |  |CurrencyAmountRefs    |Pay      |
                      |  |                      |Protocol |
                      |  v                      |Ref      |
                      |-Currency Amount Element |         |
                      | Element                 |         |
                      |                         |         |
                       -PayProtocolElement<------<--------

   *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*

                   Figure 15 Brand List Element Relationships
```

전체 브랜드 목록의 예는 섹션 11.2 브랜드 목록 예에 포함되어 있습니다.

---
### **7.7.1 Brand Element**

브랜드 요소는 결제에 사용할 수 있는 브랜드를 설명합니다. 이러한 요소 중 하나 이상이 PayDirection 속성이 Debit으로 설정된 각 브랜드 목록 구성 요소에 포함됩니다. PayDirection 속성이 Credit으로 설정된 브랜드 목록 구성 요소에는 정확히 하나의 브랜드 요소가 포함될 수 있습니다.

```text
   <!ELEMENT Brand (ProtocolBrand*, PackagedContent*) >
   <!ATTLIST Brand
    ID                 ID      #REQUIRED
    xml:lang           NMTOKEN #IMPLIED
    BrandId            CDATA   #REQUIRED
    BrandName          CDATA   #REQUIRED
    BrandLogoNetLocn   CDATA   #REQUIRED
    BrandNarrative     CDATA   #IMPLIED
    ProtocolAmountRefs IDREFS  #REQUIRED
    ContentSoftwareId  CDATA   #IMPLIED >

   Attributes:
```

나중에 지불 요청 메시지에 포함된 브랜드 선택 구성 요소에서 잠재적으로 참조되고 IOTP 트랜잭션 내에서 브랜드 요소를 고유하게 식별하는 ID 요소 식별자입니다.

xml:lang 이 요소의 속성과 콘텐츠에 사용되는 언어를 정의합니다. 섹션 3.8 언어 식별을 참조하세요.

BrandId 브랜드\(또는 판촉 브랜드\)에 대한 고유 식별자가 포함됩니다. 이는 소비자가 브랜드를 사용하여 결제할 수 있는지 여부를 결정하기 위해 소비자가 보유하고 있는 결제 수단 목록과 비교하는 데 사용됩니다.

- BrandId 값은 섹션 12 IANA 고려 사항에 설명된 절차에 따라 관리됩니다.

- BrandId 값은 섹션 12 IANA 고려사항에 정의된 절차에 따라 제어되므로 사용자 정의 값이 정의될 수 있습니다.

BrandName 여기에는 MasterCard Credit과 같은 브랜드 이름이 포함됩니다. 이는 xml:lang에 정의된 소비자 언어로 소비자에게 표시되는 브랜드에 대한 설명입니다. 예를 들어 "American Airlines Advantage Visa"일 수 있습니다. 이 속성은 소비자가 보유한 결제 수단과 대조하는 데 사용되지 않습니다.

BrandLogoNetLocn 조직의 로고를 다운로드하는 데 사용할 수 있는 네트워크 위치입니다. 로고 검색 섹션을 참조하십시오\(섹션 10 참조\).

- 이 속성의 내용은 \[RFC1738\]을 준수해야 합니다.

BrandNarrative 이 선택 속성은 판매자가 소비자가 해당 브랜드를 선택한 경우 적용되는 특별한 조건이나 혜택을 나타내기 위해 사용하도록 설계되었습니다. 예를 들어 '5% 할인', '배송 및 취급 무료', '1년 무료 파손 보험', '항공 마일리지 두 배 적용' 등이 있습니다.

ProtocolAmountRefs 이 브랜드에 사용할 수 있는 프로토콜과 관련 통화 및 금액을 식별합니다. 브랜드 목록에 포함된 프로토콜 금액 요소\(섹션 7.7.3 참조\)의 ID 목록으로 지정됩니다.

```text
   ContentSoftwareId   See section 14.Glossary.

   Content:

   ProtocolBrand      Protocol Brand elements contain brand information
                      to be used with a specific payment protocol (see
                      section 7.7.2)
```

PackagedContent 선택적 패키지 콘텐츠\(섹션 3.7 참조\) 결제 프로토콜에서 사용할 수 있는 브랜드에 대한 정보가 포함된 요소입니다. 이 정보의 내용은 결제 프로토콜이 IOTP와 어떻게 작동하는지 설명하는 결제 프로토콜 보충 문서에 정의되어 있습니다.

브랜드 요소의 예는 섹션 11.2 브랜드 목록 예에 포함되어 있습니다.

---
### **7.7.2 Protocol Brand Element**

프로토콜 브랜드 요소에는 브랜드와 함께 특정 프로토콜을 사용하는 것과 관련된 정보가 포함되어 있습니다. 그 정의는 다음과 같습니다.

```text
   <!ELEMENT ProtocolBrand (PackagedContent*) >
   <!ATTLIST ProtocolBrand
    ProtocolId         CDATA   #REQUIRED
    ProtocolBrandId    CDATA   #REQUIRED >

   Attributes:
```

ProtocolId 이는 ProtocolId 값과 일치해야 합니다.

- 지불 프로토콜 요소의 속성\(섹션 7.7.5 참조\)

- ProtocolId 값은 브랜드 요소 내에서 고유해야 합니다. 그렇지 않으면 오류가 발생합니다.

ProtocolBrandId 특정 결제 프로토콜과 함께 사용되는 결제 브랜드 ID입니다. 예를 들어 SET 및 EMV에는 잘 정의되어 있지만 각 프로토콜에 사용되는 브랜드 ID에 대한 서로 다른 값이 있습니다.

- 이 속성의 유효한 값은 결제 프로토콜이 IOTP와 작동하는 방식을 설명하는 ProtocolId로 식별되는 결제 프로토콜에 대한 보충 항목에 정의됩니다.

```text
   Content:
```

PackagedContent 선택사항 결제 프로토콜에서 사용할 수 있는 프로토콜/브랜드에 대한 정보가 포함된 패키지 콘텐츠\(섹션 3.7 참조\) 요소입니다. 이 정보의 내용은 결제 프로토콜이 IOTP와 어떻게 작동하는지 설명하는 결제 프로토콜 보충 문서에 정의되어 있습니다.

---
### **7.7.3 Protocol Amount Element**

프로토콜 금액 요소는 브랜드를 다음과 연결합니다.

o 브랜드와 함께 사용할 수 있는 통화 금액 요소\(섹션 7.7.4 참조\)의 통화 및 금액, 그리고

o 해당 통화 및 금액과 함께 사용할 수 있는 지불 프로토콜 요소\(섹션 7.7.5 참조\)에 정의된 지불 프로토콜 및 지불 처리기.

그 정의는 다음과 같습니다:

```text
   <!ELEMENT ProtocolAmount (PackagedContent*) >
   <!ATTLIST ProtocolAmount
    ID                 ID      #REQUIRED
    PayProtocolRef     IDREF   #REQUIRED
    CurrencyAmountRefs IDREFS  #REQUIRED
    ContentSoftwareId  CDATA   #IMPLIED >

   Attributes:
```

브랜드 요소에서 잠재적으로 참조되는 ID 요소 식별자입니다. 또는 IOTP 거래 내의 프로토콜 금액 요소를 고유하게 식별하는 이후 지불 요청 메시지에 포함된 브랜드 선택 구성 요소에 있습니다.

PayProtocolRef에는 브랜드와 함께 사용할 수 있는 결제 프로토콜 및 결제 핸들러가 포함된 결제 프로토콜 요소\(섹션 7.7.5 참조\)를 참조하는 요소 참조\(섹션 3.5 참조\)가 포함되어 있습니다.

MoneyAmountRefs 브랜드와 함께 사용할 수 있는 통화 및 금액을 설명하는 통화 금액 요소\(섹션 7.7.4 참조\)를 참조하는 요소 참조\(섹션 3.5 참조\) 목록이 포함되어 있습니다.

```text
   ContentSoftwareId   See section 14. Glossary.

   Content:
```

PackagedContent 선택사항 결제 프로토콜에서 사용할 수 있는 프로토콜 금액에 대한 정보가 포함된 패키지 콘텐츠\(섹션 3.7 참조\) 요소입니다. 이 정보의 내용은 결제 프로토콜이 IOTP와 어떻게 작동하는지 설명하는 결제 프로토콜 보충 문서에 정의되어 있습니다.

프로토콜 금액 요소의 예는 섹션 11.2 브랜드 목록 예에 포함되어 있습니다.

---
### **7.7.4 Currency Amount Element**

통화 금액 요소에는 다음이 포함됩니다.

o 통화 코드\(및 해당 유형\), 그리고

아 금액.

이러한 요소 중 하나 이상이 각 브랜드 목록 구성요소에 포함됩니다. 그 정의는 다음과 같습니다:

```text
   <!ELEMENT CurrencyAmount EMPTY >
   <!ATTLIST CurrencyAmount
    ID                 ID      #REQUIRED
    Amount             CDATA   #REQUIRED
    CurrCodeType       NMTOKEN 'ISO4217-A'
    CurrCode           CDATA   #REQUIRED >

   Attributes:

   ID                 Element identifier, potentially referenced in a
                      Brand element; or in a Brand Selection Component
```

- IOTP 거래 내의 통화 금액 요소를 고유하게 식별하는 이후 지불 요청 메시지에 포함됩니다.

금액 통화의 전체 및 분수 단위로 지불할 금액을 나타냅니다. 예를 들어 $245.35는 "245.35"로 표시됩니다. 가장 작은 단위보다 작은 값도 허용됩니다. 예를 들어 1/10센트는 "0.001"입니다.

```text
   CurrCodeType       Indicates the domain of the CurrCode. This
                      attribute is included so that the currency code
                      may support non-standard "currencies" such as
                      frequent flyer points, trading stamps, etc. Its
                      values may be:
                       o ISO4217-A (the default) indicates the currency
                         code is a three character alphabetic currency
                         code that conforms to [ISO 4217]
                       o IOTP indicates that values of CurrCode are
                         managed under the procedure described in
                         section 12 IANA Considerations

   CurrCode           A code which identifies the currency to be used in
                      the payment. The domain of valid currency codes is
                      defined by CurrCodeType
```

- CurrCodeType의 값은 섹션 12 IANA 고려 사항에 설명된 절차에 따라 관리되므로 CurrCodeType의 사용자 정의 값이 정의될 수 있습니다.

통화 금액 요소의 예는 섹션 11.2 브랜드 목록 예에 포함되어 있습니다.

---
### **7.7.5 Pay Protocol Element**

결제 프로토콜 요소는 브랜드와 함께 사용할 수 있는 결제 프로토콜 및 결제 핸들러의 세부정보를 지정합니다. 이러한 요소 중 하나 이상이 각 브랜드 목록에 포함되어 있습니다.

```text
   <!ELEMENT PayProtocol (PackagedContent*) >
   <!ATTLIST PayProtocol
    ID                 ID      #REQUIRED
    xml:lang           NMTOKEN #IMPLIED
    ProtocolId         NMTOKEN #REQUIRED
    ProtocolName       CDATA   #REQUIRED
    ActionOrgRef       NMTOKEN #REQUIRED

    PayReqNetLocn      CDATA   #IMPLIED
    SecPayReqNetLocn   CDATA   #IMPLIED
    ContentSoftwareId  CDATA   #IMPLIED >

   Attributes:
```

브랜드 요소에서 잠재적으로 참조되는 ID 요소 식별자입니다. 또는 IOTP 거래 내의 지불 프로토콜 요소를 고유하게 식별하는 이후 지불 요청 메시지에 포함된 브랜드 선택 구성 요소에 있습니다.

xml:lang 이 요소의 속성과 콘텐츠에 사용되는 언어를 정의합니다. 섹션 3.8 언어 식별을 참조하세요.

ProtocolId 프로토콜 이름과 버전으로 구성됩니다. 예를 들어 "SETv1.0"입니다.

- ProtocolId의 값은 IOTP 내에 결제 프로토콜을 캡슐화하는 방법을 설명하는 문서의 결제 체계/방법 소유자에 의해 정의됩니다.

ProtocolName xml:lang으로 식별되는 언어로 된 결제 프로토콜 및 해당 버전에 대한 설명입니다. 예를 들어 "안전한 전자거래 버전 1.0"입니다. 그 목적은 문제가 발생할 경우 사용되는 결제 프로토콜에 대한 정보를 제공하는 것입니다.

ActionOrgRef 결제 프로토콜용 결제 핸들러에 대한 조직 구성 요소에 대한 요소 참조\(섹션 3.5 참조\)입니다.

PayReqNetLocn 이 프로토콜 선택이 사용되는 경우 보안되지 않은 지불 요청 메시지를 보내야 하는 위치를 나타내는 네트워크 위치입니다.

- 이 속성의 내용은 전송 메커니즘\(\[RFC1738\]을 준수해야 함\)에 따라 달라집니다.

SecPayReqNetLocn 이 프로토콜 선택이 사용되는 경우 보안 지불 요청 메시지가 전송되어야 하는 위치를 나타내는 네트워크 위치입니다.

- 보안 결제에는 결제 처리자와 통신하기 위해 \[SSL/TLS\]와 같은 보안 채널을 사용하는 것이 포함됩니다.

- 이 속성의 내용은 \[RFC1738\]을 준수해야 합니다. 섹션 3.9 보안 및 안전하지 않은 네트워크 위치도 참조하세요.

```text
   ContentSoftwareId  See section 14. Glossary.

   Content:
```

PackagedContent 선택적 패키지 콘텐츠 요소\(섹션 3.7 참조\)에는 결제 프로토콜에서 사용되는 프로토콜에 대한 정보가 포함되어 있습니다. 이 정보의 내용은 결제 프로토콜이 IOTP와 어떻게 작동하는지 설명하는 결제 프로토콜 보충 문서에 정의되어 있습니다. 그 사용의 예는 지불 프로토콜 메시지를 포함하는 것입니다.

지불 프로토콜 요소의 예는 섹션 11.2 브랜드 목록 예에 포함되어 있습니다.

---
## **7.8 Brand Selection Component**

브랜드 선택 구성요소는 결제 브랜드, 결제 프로토콜 및 결제 처리자의 선택을 식별합니다. 이 요소는 다음과 같이 사용됩니다.

o 기준 구매 및 기준 가치 교환 IOTP 거래 내 결제 요청 메시지에서 결제에 대한 브랜드, 프로토콜 및 결제 처리자를 식별합니다.

o 선택적으로, 제안 및 주문 세부 사항이 그에 따라 수정될 수 있도록 사용 중인 결제 브랜드 구매 시 판매자에게 알립니다.

Baseline IOTP에서는 브랜드 선택 구성 요소의 무결성이 보장되지 않습니다. 그러나 브랜드 선택 구성 요소를 수정하면 지불 프로토콜 자체가 메시지 수정, 복제 및 교환 공격으로부터 안전한 경우에만 서비스 거부가 발생할 수 있습니다.

브랜드 선택 구성요소의 정의는 다음과 같습니다.

```text
   <!ELEMENT BrandSelection (BrandSelBrandInfo?,
        BrandSelProtocolAmountInfo?,
        BrandSelCurrencyAmountInfo?) >
   <!ATTLIST BrandSelection

    ID                 ID      #REQUIRED
    BrandListRef       NMTOKEN #REQUIRED
    BrandRef           NMTOKEN #REQUIRED
    ProtocolAmountRef  NMTOKEN #REQUIRED
    CurrencyAmountRef  NMTOKEN #REQUIRED >

   Attributes:
```

ID IOTP 거래 내에서 브랜드 선택 구성 요소를 고유하게 식별하는 식별자입니다.

```text
   BrandListRef       The Element Reference (see section 3.5) of the
                      Brand List Component from which a Brand is being
                      selected
```

BrandRef 결제에 사용될 선택 중인 브랜드 목록 구성 요소 내의 브랜드 요소에 대한 요소 참조입니다.

ProtocolAmountRef 결제 시 사용되는 브랜드 목록 구성 요소 내 프로토콜 금액 요소의 요소 참조입니다.

통화AmountRef 결제 시 사용되는 브랜드 목록 구성 요소 내 통화 금액 요소의 요소 참조입니다.

```text
   Content:
```

BrandSelBrandInfo, 여기에는 BrandSelProtocolAmountInfo가 특정 결제 BrandSelCurrencyAmountInfo 브랜드 또는 프로토콜에 필요할 수 있는 추가 데이터가 포함되어 있습니다. 섹션 7.8.1, 7.8.2 및 7.8.3을 참조하십시오.

다음 규칙이 적용됩니다.

o BrandListRef에는 동일한 IOTP 트랜잭션의 브랜드 목록 구성 요소 ID가 포함되어야 합니다.

o 거래 프로토콜 옵션 블록\(섹션 8.1 참조\)의 모든 브랜드 목록 구성 요소는 단 하나의 브랜드 선택 구성 요소에 의해 참조되어야 합니다.

o BrandRef는 BrandListRef가 참조하는 브랜드 목록 구성 요소 내에 포함된 브랜드의 ID를 참조해야 합니다.

o ProtocolAmountRef는 BrandRef에 의해 식별된 브랜드 요소의 ProtocolAmountRefs 속성에 나열된 요소 ID 중 하나를 참조해야 합니다.

o 통화AmountRef는 ProtocolAmountRef에 의해 식별된 프로토콜 금액 요소의 통화AmountRefs 속성에 나열된 요소 ID 중 하나를 참조해야 합니다.

브랜드 선택 구성요소의 예는 11.2 브랜드 목록 예에 포함되어 있습니다.

---
### **7.8.1 Brand Selection Brand Info Element**

브랜드 선택 브랜드 정보 요소에는 특정 결제 브랜드에 필요할 수 있는 추가 데이터가 포함되어 있습니다. 사용 방법과 시기에 대한 설명은 IOTP 결제 방법 보충 자료를 참조하세요.

```text
   <!ELEMENT BrandSelBrandInfo (PackagedContent+) >
   <!ATTLIST BrandSelBrandInfo
    ID                 ID      #REQUIRED
    ContentSoftwareId  CDATA   #IMPLIED >

   Attributes:

   ContentSoftwareId  See section 14. Glossary.

   Content:
```

특정 결제 브랜드에서 요구할 수 있는 추가 데이터를 포함하는 PackagedContent 패키지 콘텐츠 요소\(섹션 3.7 참조\). 이것이 어떻게 사용되는지에 대한 규칙은 IOTP의 지불 방법 보충 자료를 참조하십시오.

---
### **7.8.2 Brand Selection Protocol Amount Info Element**

브랜드 선택 프로토콜 금액 정보 요소에는 특정 결제 브랜드 또는 결제 프로토콜에서 요구할 수 있는 결제 프로토콜별 추가 데이터가 포함되어 있습니다. 사용 방법과 시기에 대한 설명은 IOTP 결제 방법 보충 자료를 참조하세요.

```text
   <!ELEMENT BrandSelProtocolAmountInfo (PackagedContent+) >
   <!ATTLIST BrandSelProtocolAmountInfo
    ID                 ID      #REQUIRED
    ContentSoftwareId  CDATA   #IMPLIED >

   Attributes:

   ContentSoftwareId  See section 14. Glossary.

   Content:
```

특정 결제 브랜드에서 요구할 수 있는 추가 데이터를 포함할 수 있는 PackagedContent 패키지 콘텐츠 요소\(섹션 3.7 참조\). 이것이 어떻게 사용되는지에 대한 규칙은 IOTP의 지불 방법 보충 자료를 참조하십시오.

---
### **7.8.3 Brand Selection Currency Amount Info Element**

브랜드 선택 통화 금액 정보 요소에는 특정 결제 브랜드에서 요구할 수 있는 결제 브랜드 및 통화별 추가 데이터가 포함되어 있습니다. 사용 방법과 시기에 대한 설명은 IOTP 결제 방법 보충 자료를 참조하세요.

```text
   <!ELEMENT BrandSelCurrencyAmountInfo (PackagedContent+) >
   <!ATTLIST BrandSelCurrencyAmountInfo
    ID                 ID      #REQUIRED
    ContentSoftwareId  CDATA   #IMPLIED >

   Attributes:

   ContentSoftwareId  See section 14. Glossary.

   Content:
```

PackagedContent 결제 브랜드 및 통화와 관련된 추가 데이터를 포함하는 패키지 콘텐츠 요소\(섹션 3.7 참조\). 이것이 어떻게 사용되는지에 대한 규칙은 IOTP의 지불 방법 보충 자료를 참조하십시오.

---
## **7.9 Payment Component**

결제 구성요소에는 결제 수행 방법을 제어하는 ​​데 사용되는 정보가 포함되어 있습니다. 다음에 대한 정보를 제공합니다.

o 결제 처리자를 통한 결제가 시작될 수 있는 시간

o 결제에 사용할 수 있는 브랜드, 프로토콜, 통화 및 금액을 식별하는 브랜드 목록\(섹션 7.7 참조\)에 대한 참조

o 결제 영수증 제공 여부

o 이번 지급보다 다른 지급이 먼저 이루어졌는지 여부.

그 정의는 다음과 같습니다.

```text
   <!ELEMENT Payment EMPTY >
   <!ATTLIST Payment
    ID                 ID      #REQUIRED
    OkFrom             CDATA   #REQUIRED
    OkTo               CDATA   #REQUIRED
    BrandListRef       NMTOKEN #REQUIRED
    SignedPayReceipt (True | False) #REQUIRED
    StartAfterRefs     NMTOKENS #IMPLIED >

   Attributes:
```

ID IOTP 거래 내에서 결제 구성요소를 고유하게 식별하는 식별자입니다.

OkFrom 지불 핸들러가 지불 구성요소를 포함하는 지불 요청 블록\(섹션 8.7 참조\) 처리를 수락할 수 있는 \[UTC\] 형식의 날짜 및 시간입니다.

OkTo 결제 구성요소가 포함된 결제 요청 블록 처리를 위해 결제 핸들러가 수락할 수 있는 \[UTC\] 형식의 날짜 및 시간입니다.

BrandListRef IOTP 거래를 위한 TPO 거래 블록 내 브랜드 목록 구성 요소\(섹션 7.7 참조\)의 요소 참조\(섹션 3.5 참조\)입니다. 브랜드 목록은 결제가 이루어질 수 있는 대체 방법을 식별합니다.

SignedPayReceipt 지불을 위해 지불 핸들러가 생성한 지불 응답 블록\(섹션 8.9 참조\)이 디지털 서명되어야 하는지 여부를 나타냅니다.

```text
   StartAfter         Contains Element References (see section 3.5) of
                      other Payment Components which describe payments
                      which must be complete before this payment can
                      start. If no StartAfter attribute is present then
                      there are no dependencies and the payment can
                      start immediately
```

---
## **7.10 Payment Scheme Component**

지불 체계 구성요소에는 지불에 관련된 당사자들 사이에 전송되는 특정 지불 체계에 대한 지불 프로토콜 정보가 포함되어 있습니다\(예: \[SET\] 메시지\). 그 정의는 다음과 같습니다.

```text
   <!ELEMENT PaySchemeData (PackagedContent+) >
   <!ATTLIST PaySchemeData
    ID                 ID      #REQUIRED
    PaymentRef         NMTOKEN #IMPLIED
    ConsumerPaymentId  CDATA   #IMPLIED
    PaymentHandlerPayId CDATA  #IMPLIED
    ContentSoftwareId  CDATA   #IMPLIED >

   Attributes:
```

ID IOTP 거래 내에서 지불 체계 구성 요소를 고유하게 식별하는 식별자입니다.

PaymentRef 이 지불 체계 구성 요소와 관련된 지불 구성 요소\(섹션 7.9 참조\)에 대한 요소 참조\(섹션 3.5 참조\)입니다. 결제 체계 구성 요소가 거래 조회 상태 거래의 일부가 아닌 한 필요합니다\(섹션 9.2.1 참조\).

ConsumerPaymentId 소비자가 지정한 식별자로, 결제 핸들러가 다른 결제 체계 구성 요소나 다른 수단을 통해 반환하는 경우 소비자는 어떤 결제가 참조되는지 식별할 수 있습니다.

PaymentHandlerPayId 결제 핸들러가 지정한 식별자로, 소비자가 다른 결제 체계 구성요소로 또는 다른 수단을 통해 반환하는 경우 결제 핸들러가 어떤 결제가 참조되는지 식별할 수 있습니다. 지불 요청 블록에 포함된 구성 요소를 제외한 모든 지불 체계 구성 요소에 필요합니다.

```text
   ContentSoftwareId    See section 14. Glossary.

   Content:
```

PackagedContent 결제 체계 프로토콜 정보를 패키지 콘텐츠 요소로 포함합니다\(섹션 3.7 참조\). 내용의 정의는 지불 제도 보충 자료를 참조하십시오.

```text
                      Note that:
                       o the values of the Name attribute of each
                         packaged content element are defined by the
                         Payment Protocol Supplement
                       o the value of each Name must be unique within a
                         Payment where a Payment is defined as all
                         Payment Scheme or Payment Receipt Components
                         with the same value of the PaymentRef attribute
```

---
## **7.11 Payment Receipt Component**

지급영수증은 지급 또는 수령된 금액을 나타내는 지급 기록입니다. 구매 영수증에는 구매 내역이 포함되어 있지 않다는 점에서 구매 영수증과 다릅니다.

일반적으로 지불 영수증 구성요소의 내용에는 다음을 설명하는 데이터가 포함됩니다.

o 지불 금액 및 통화

o 결제 날짜 및 시간

o 결제 시스템에 대한 결제를 식별하는 내부 참조 번호

o 지불이 발생한 사건 이후에 증명하는 데 사용할 수 있는 지불 방법에 의해 생성된 잠재적인 디지털 서명.

사용 중인 결제 방법이 기능을 제공하는 경우 결제 영수증 구성 요소에는 결제 프로토콜 메시지 또는 결제가 발생했음을 증명하는 메시지에 대한 참조가 포함되어야 합니다.

콘텐츠의 정확한 정의는 결제 방법에 따라 다릅니다. 적용되는 규칙을 결정하려면 사용되는 결제 방법에 대한 보충 자료를 참조하세요.

지불 영수증 구성요소에 포함된 정보는 소비자에게 표시되거나 다른 방식으로 제공되어야 합니다.

참고: 지불 영수증 구성 요소에 지불 프로토콜 메시지가 포함된 경우 해당 메시지는 지불 방법 소프트웨어에서 처리되어 소비자가 이해할 수 있는 형식으로 변환되어야 합니다.

지급영수성분의 정의는 다음과 같습니다.

```text
   <!ELEMENT PayReceipt (PackagedContent*) >
   <!ATTLIST PayReceipt
    ID                 ID      #REQUIRED
    PaymentRef         NMTOKEN #REQUIRED
    PayReceiptNameRefs NMTOKENS #IMPLIED
    ContentSoftwareId  CDATA   #IMPLIED >

   Attributes:
```

ID IOTP 거래 내에서 지불 영수증 구성 요소를 고유하게 식별하는 식별자입니다.

```text
   PaymentRef          Contains an Element Reference (see section 3.5)
                       to the Payment Component (see section 7.9) to
                       which this payment receipt applies

   PayReceiptNameRefs  Optionally contains a list of the values of the
                       Name attributes of Packaged Content elements that
                       together make up the receipt. The Packaged
                       Content elements are contained either within:
                        o Payment Scheme Data components exchanged
                          between the Payment Handler and the Consumer
                          roles during the Payment, and/or
                        o the Payment Receipt component itself.
                       Note that:
                        o each payment scheme defines in its supplement
                          the Names of the Packaged Content elements
                          that must be listed in this attribute (if
                          any).
                        o if a Payment Scheme Component contains
                          Packaged Content elements with a name that
                          matches a name within PayReceiptNameRefs, then
                          those Payment Scheme Components must be
                          referenced by Digests in the Payment Response
                          signature component (if such a signature is
                          being used)
```

클라이언트 소프트웨어는 모든 내용을 저장해야 합니다.

- 필요할 때 지불 영수증을 재구성할 수 있도록 참조되는 구성 요소입니다.

```text
   ContentSoftwareId   See section 14. Glossary.

   Content:
```

PackagedContent 선택적으로 결제 체계 결제 영수증 정보를 패키지 콘텐츠 요소로 포함합니다\(섹션 3.7 참조\). 내용의 정의는 지불 제도 보충 자료를 참조하십시오.

```text
                      Note that:
                       o the values of the Name attribute of each
                         packaged content element are defined by the
                         Payment Protocol Supplement
                       o the value of each Name must be unique within a
                         Payment where a Payment is defined as all
                         Payment Scheme or Payment Receipt Components,
                         with the same value of the PaymentRef attribute
```

PayReceiptNameRefs 속성, PackagedContent 요소 또는 둘 다 존재해야 합니다.

---
## **7.12 Payment Note Component**

결제 전표 구성 요소에는 결제 처리자가 소비자에게 제공하려는 결제와 관련되지 않은 추가 정보가 포함되어 있습니다. 예를 들어, 인출 또는 입금이 이루어진 경우 이체 완료 후 계정의 남은 잔액에 대한 정보가 포함될 수 있습니다. 해당 정보는 지불 영수증 구성요소에 포함된 정보와 중복되어야 합니다.

지불 전표 구성요소에 포함된 정보는 소비자에게 표시되거나 다른 방식으로 제공되어야 합니다. 상호 운용성을 위해 지불 메모 구성 요소는 최소한 "일반 텍스트", HTML 및 XML의 콘텐츠 유형을 지원해야 합니다. 그 정의는 다음과 같습니다.

```text
   <!ELEMENT PaymentNote (PackagedContent+) >
   <!ATTLIST PaymentNote
     ID                ID      #REQUIRED
     ContentSoftwareId CDATA   #IMPLIED >

   Attributes:
```

ID IOTP 거래 내에서 지불 영수증 구성 요소를 고유하게 식별하는 식별자입니다.

```text
   ContentSoftwareId  See section 14. Glossary.

   Content:
```

PackagedContent 추가 비결제 관련 내용이 포함되어 있습니다.

- 결제 처리자가 소비자에게 하나 이상의 패키지 콘텐츠 요소로 제공하려는 정보\(섹션 3.7 참조\).

---
## **7.13 Delivery Component**

배송 요소에는 상품이나 서비스를 배송하는 데 필요한 정보가 포함됩니다. 그 정의는 다음과 같습니다.

```text
   <!ELEMENT Delivery (DeliveryData?, PackagedContent*) >
   <!ATTLIST Delivery
    ID                 ID      #REQUIRED
    xml:lang           NMTOKEN #REQUIRED
    DelivExch          (True | False) #REQUIRED
    DelivAndPayResp    (True | False) #REQUIRED
    ActionOrgRef       NMTOKEN #IMPLIED >

   Attributes:
```

ID IOTP 트랜잭션 내에서 전달 구성 요소를 고유하게 식별하는 식별자입니다.

xml:lang 하위 요소의 xml:lang 속성으로 재정의되지 않는 한 이 구성 요소 내의 속성 또는 하위 요소에서 사용되는 언어를 정의합니다. 섹션 3.8 언어 식별을 참조하세요.

```text
   DelivExch           Indicates if this IOTP Transaction includes the
                       messages associated with a Delivery Exchange.
                       Valid values are:
                        o True indicates it does include a Delivery
                          Exchange
                        o False indicates it does not include a
                          Delivery Exchange
```

- true로 설정된 경우 DeliveryData 요소가 있어야 합니다. false로 설정하면 없을 수도 있습니다.

```text
   DelivAndPayResp     Indicates if the Delivery Response Block (see
                       section 8.11) and the Payment Response Block (see
                       section 8.9 ) are combined into one IOTP Message.
                       Valid values are:
                        o True indicates both blocks will be in the
                          same IOTP Message, and
```

- o False는 각 블록이 다른 IOTP 메시지에 있음을 나타냅니다.

- DelivExch가 False인 경우 DelivAndPayResp는 true가 아니어야 합니다.

```text
                       In practice combining the Delivery Response Block
                       and Payment Response Block is only likely to be
                       practical if the Merchant, the Payment Handler
                       and the Delivery Handler are the same
                       Organisation since:
                        o the Payment Handler must have access to Order
                          Component information so that they know what
                          to deliver, and
                        o the Payment Handler must be able to carry out
                          the delivery
```

ActionOrgRef 조직에 대한 요소 참조

- 이 배달을 위한 배달 핸들러의 구성요소입니다.

```text
   Content:
```

DeliveryData 배송 수행 방법에 대한 세부 정보가 포함됩니다. 아래 7.13.1 배송 데이터 요소를 참조하세요.

PackagedContent 하나 이상의 패키지 콘텐츠 요소로서 배달 핸들러에서 요구하는 판매자에 대해 정의된 "사용자" 데이터를 포함합니다\(섹션 3.7 참조\).

---
### **7.13.1 Delivery Data Element**

DeliveryData 요소에는 상품이 배송될 위치와 방법에 대한 정보가 포함됩니다. 그 정의는 다음과 같습니다.

```text
   <!ELEMENT DeliveryData (PackagedContent*) >
   <!ATTLIST DeliveryData
    xml:lang           NMTOKEN #IMPLIED
    OkFrom             CDATA   #REQUIRED
    OkTo               CDATA   #REQUIRED
    DelivMethod        NMTOKEN #REQUIRED
    DelivToRef         NMTOKEN #REQUIRED
    DelivReqNetLocn    CDATA   #REQUIRED
    SecDelivReqNetLocn CDATA   #REQUIRED
    ContentSoftwareId  CDATA   #IMPLIED >

   Attributes:
```

xml:lang 이 구성 요소 내의 속성에 사용되는 언어를 정의합니다. 섹션 3.8 언어 식별을 참조하세요.

OkFrom 배달 핸들러가 배달 요청 블록 처리를 수락할 수 있는 \[UTC\] 형식의 날짜 및 시간입니다\(섹션 8.10 참조\).

OkTo 배달 핸들러가 배달 요청 블록 처리를 수락할 수 있는 \[UTC\] 형식의 날짜 및 시간입니다.

```text
   DelivMethod         Indicates the method by which goods or services
                       may be delivered. Valid values are:
                        o Post the goods will be delivered by post or
                          courier
                        o Web the goods will be delivered
                          electronically in the Delivery Note Component
                        o Email the goods will be delivered
                          electronically by e-mail
```

- DelivMethod의 값은 사용자 정의 코드 정의를 허용하는 섹션 12 IANA 고려 사항에 설명된 절차에 따라 관리됩니다.

```text
   DelivToRef          The Element Reference (see section 3.4) of an
                       Organisation Component within the IOTP
                       Transaction which has a role of DelivTo. The
                       information in this block is used to determine
                       where delivery is to be made. It must be
                       compatible with DelivMethod. Specifically if the
                       DelivMethod is:
                        o Post, then the there must be a Postal Address
                          Element containing sufficient information for
                          a postal delivery,
                        o Web, then there are no specific requirements.
                          The information will be sent in a web page
                          back to the Consumer
                        o Email, then there must be Contact Information
                          Element with a valid e-mail address
```

DelivReqNetLocn 여기에는 배달 구성 요소가 포함된 보안되지 않은 배달 요청 블록\(섹션 8.10 참조\)이 전송되어야 하는 네트워크 위치가 포함됩니다.

- 이 속성의 내용은 전송 메커니즘에 따라 다르며 \[RFC1738\]을 준수해야 합니다.

SecDelivReqNetLocn 여기에는 배달 구성 요소가 포함된 보안 배달 요청 블록\(섹션 8.10 참조\)이 전송되어야 하는 네트워크 위치가 포함됩니다.

- 보안 배송 요청에는 결제 핸들러와 통신하기 위해 \[SSL/TLS\]와 같은 보안 채널을 사용하는 것이 포함됩니다.

- 이 속성의 내용은 전송 메커니즘에 따라 달라지며 \[RFC1738\]을 준수해야 합니다.

- 섹션 3.9 보안 및 안전하지 않은 네트워크 위치도 참조하세요.

```text
   ContentSoftwareId   See section 14. Glossary.

   Content:
```

PackagedContent 판매자가 배달 핸들러에 제공하는 하나 이상의 패키지 콘텐츠 요소\(섹션 3.7 참조\)로서의 배달에 대한 추가 정보입니다.

---
## **7.14 Consumer Delivery Data Component**

소비자 배달 데이터 구성요소는 소비자가 배달을 식별하는 데 사용할 수 있는 식별자를 지정하는 데 사용됩니다.

그 정의는 다음과 같습니다:

```text
   <!ELEMENT ConsumerDeliveryData EMPTY >
   <!ATTLIST ConsumerDeliveryData
    ID                 ID      #REQUIRED
    ConsumerDeliveryId CDATA   #REQUIRED>

   Attributes:
```

ID IOTP 트랜잭션 내에서 소비자 배달 데이터 구성 요소를 고유하게 식별하는 식별자입니다.

ConsumerDeliveryId 소비자가 지정한 식별자로, 배달 핸들러가 반환한 경우 소비자는 어떤 배달이 참조되고 있는지 식별할 수 있습니다.

---
## **7.15 Delivery Note Component**

배송 메모에는 상품이나 서비스 배송에 대한 배송 지침이 포함되어 있거나 실제 배송 정보 자체가 포함될 수 있습니다. 배송서를 받은 개인이나 기관이 배송 시 활용할 수 있는 정보입니다.

상호 운용성을 위해 배달 노트 구성 요소 패키지 콘텐츠는 일반 텍스트, HTML 및 XML을 모두 지원해야 합니다.

그 정의는 다음과 같습니다.

```text
   <!ELEMENT DeliveryNote (PackagedContent+) >
   <!ATTLIST DeliveryNote
    ID                 ID      #REQUIRED
    xml:lang           NMTOKEN #REQUIRED
    DelivHandlerDelivId CDATA  #IMPLIED
    ContentSoftwareId  CDATA   #IMPLIED >

   Attributes:
```

ID IOTP 트랜잭션 내에서 배송 메모 구성 요소를 고유하게 식별하는 식별자입니다.

xml:lang 하위 요소의 xml:lang 속성으로 재정의되지 않는 한 이 구성 요소 내의 속성 또는 하위 요소에서 사용되는 언어를 정의합니다. 섹션 3.8 언어 식별을 참조하세요.

DelivHandlerDelivId 배달 핸들러가 지정하는 선택적 식별자로, 소비자가 다른 배달 구성 요소에서 또는 다른 방법으로 반환하는 경우 배달 핸들러가 참조되는 배달을 식별할 수 있습니다. 이는 배달 요청 블록에 포함된 구성 요소를 제외한 모든 배달 구성 요소에 필요합니다.

- 이 속성의 사용 예는 배송 추적 번호를 포함하는 것입니다.

```text
   ContentSoftwareId    See section 14. Glossary.

   Content:
```

PackagedContent 하나 이상의 패키지 콘텐츠 요소로 실제 배송 메모 정보를 포함합니다\(섹션 3.7 참조\).

참고: 배달 메시지의 내용이 Mime 메시지인 경우 배달 메모는 실제 배달이 발생하도록 하는 애플리케이션을 트리거할 수 있습니다.

---
## **7.16 Status Component**

상태 구성 요소에는 프로세스의 비즈니스 성공 또는 실패\(섹션 4.2 참조\)에 대한 상태 정보가 포함되어 있습니다.

그 정의는 다음과 같습니다.

```text
   <!ELEMENT Status EMPTY >
   <!ATTLIST Status
    ID                 ID      #REQUIRED
    xml:lang           NMTOKEN #REQUIRED
    StatusType         NMTOKEN #REQUIRED
    ElRef              NMTOKEN #IMPLIED
    ProcessState (NotYetStarted | InProgress |
        CompletedOk | Failed | ProcessError) #REQUIRED
    CompletionCode     NMTOKEN #IMPLIED
    ProcessReference   CDATA   #IMPLIED
    StatusDesc         CDATA   #IMPLIED >

   Attributes:
```

ID IOTP 트랜잭션 내에서 상태 구성 요소를 고유하게 식별하는 식별자입니다.

xml:lang 이 구성 요소 내의 속성에 사용되는 언어를 정의합니다. 섹션 3.8 언어 식별을 참조하세요.

StatusType 상태가 보고하는 문서 교환 유형을 나타냅니다. 제안, 결제, 배송, 인증 또는 정의되지 않음으로 설정할 수 있습니다.

- 정의되지 않음은 문서 교환 유형을 식별할 수 없음을 의미합니다. 이는 거래소 초기 입력 메시지의 오류로 인해 발생합니다.

- StatusType 값은 StatusType의 사용자 정의 값을 정의할 수 있는 섹션 12 IANA 고려 사항에 설명된 절차에 따라 관리됩니다.

ElRef StatusType이 정의되지 않음으로 설정되지 않은 경우 ElRef에는 상태가 설명되는 구성 요소에 대한 요소 참조\(섹션 3.5 참조\)가 포함됩니다. 이는 다음 중 하나를 참조해야 합니다. o StatusType이 Offer인 경우 Order 구성 요소\(섹션 7.5 참조\) o StatusType이 Payment인 경우 Payment 구성 요소\(섹션 7.9 참조\) o StatusType이 경우 Delivery 구성 요소\(섹션 7.13 참조\) StatusType이 인증인 경우 인증 요청 구성 요소\(섹션 7.2 참조\) 전달입니다.

ProcessState 수행 중인 프로세스의 현재 상태를 나타내는 상태 코드를 포함합니다. ProcessState의 유효한 값은 다음과 같습니다. o NotYetStarted. 요청 블록이 수신되었지만 프로세스가 아직 시작되지 않았습니다. o InProgress. 요청 블록 처리가 시작되었지만 아직 완료되지 않았습니다. o 완료되었습니다. 요청 블록 처리가 오류 없이 성공적으로 완료되었습니다. o 실패. 비즈니스 오류로 인해 요청 블록 처리가 실패했습니다\(섹션 4.2 참조\). o ProcessError. 이 값은 상태 구성요소가 조회 요청 거래 블록과 관련하여 사용되는 경우에만 사용됩니다\(섹션 8.12 참조\). 처리 중인 요청 블록에 기술적 오류\(섹션 4.1 참조\)가 있거나 일부 내부 처리 오류가 있음을 나타냅니다.

- 이 코드는 요청 블록 처리에 대해 보고합니다. 또한 프로세스와 관련된 응답 블록이 전송된 후에 비동기 처리가 발생할 수 있습니다.

CompletionCode 프로세스가 완료된 방법을 나타냅니다. CompletionCode의 유효한 값은 반드시 존재해야 하는 조건 및 오류 복구가 가능한 시기에 대한 표시와 함께 아래에 제공됩니다.

- CompletionCode의 길이는 최대 14자입니다.

ProcessReference 이 선택적 속성은 상태가 보고되는 프로세스에 대한 참조를 보유합니다. 다음 값을 보유할 수 있습니다. o StatusType이 Offer로 설정된 경우 주문 구성 요소의 OrderIdentifier가 포함되어야 합니다. o StatusType이 결제로 설정된 경우 결제 체계 데이터 구성 요소의 PaymentHandlerPayId가 포함되어야 합니다. o StatusType이 배송으로 설정된 경우 , 배달 메모 구성 요소의 DelivHandlerDelivId를 포함해야 합니다. o StatusType이 인증으로 설정된 경우 인증 요청 구성 요소의 AuthenticationId를 포함해야 합니다.

- IOTP 서비스 공급자가 소비자에게 참조 번호를 제공하지 않은 경우 조회 요청 메시지에 이 속성이 없어야 합니다.

- 이 속성은 이전에 사용할 수 없었던 거래에 대한 참조 번호를 제공하기 위해 조회 응답 블록\(섹션 8.13 참조\) 내에서 사용될 수 있습니다.

- 예를 들어, 배송 응답을 받은 시점에 배송 추적 번호가 할당되지 않을 수 있습니다. 그러나 소비자가 나중에 기본 거래 상태 조회를 발행하는 경우 배달 핸들러는 조회 응답 메시지의 이 속성에 패키지 추적 번호를 입력하고 이를 소비자에게 다시 보낼 수 있습니다.

StatusDesc xml:lang으로 식별되는 언어로 된 프로세스의 현재 상태에 대한 선택적 텍스트 설명입니다.

---
### **7.16.1 Offer Completion Codes**

완료 코드는 ProcessState 속성이 Failed로 설정된 경우에만 필요합니다. 다음 표에는 사용할 수 있는 CompletionCode의 유효한 값이 포함되어 있으며 복구가 가능한지 여부를 나타냅니다. 적절한 경우 추가 설명을 제공하기 위해 StatusDesc 속성을 사용하는 것이 좋습니다.

```text
       Value                            Description
```

AuthError 인증 오류입니다. 수표는

- 수행된 인증 응답이 실패했습니다.

- 소비자가 수정된 정보가 포함된 새로운 인증 응답 블록을 다시 제출하면 복구가 가능할 수 있습니다.

ConsCancelled 소비자가 취소되었습니다. 소비자가 어떤 이유로 거래를 취소하기로 결정했습니다. 이 코드는 취소 블록 또는 조회 응답 블록에 포함된 상태 구성 요소에서만 유효합니다.

```text
                    No recovery possible.
```

MerchCancelled 제안이 취소되었습니다. 판매자가 어떤 이유로 제안 생성을 거부하고 거래를 취소합니다. 이 코드는 취소 블록 또는 조회 응답 블록에 포함된 상태 구성 요소에서만 유효합니다.

```text
                    No recovery possible.
```

지정되지 않음 지정되지 않은 오류입니다. 다른 CompletionCode 중 하나에 속하지 않는 알 수 없는 문제나 오류가 있습니다.

```text
                    No recovery possible.
```

TimedOutRcvr 복구 가능한 시간 초과. 메시지를 재전송했지만 응답을 받지 못했습니다. 따라서 문서 교환이 "시간 초과"되었습니다. 이 코드는 거래 문의에만 유효합니다.

- 다른 Trading Role의 마지막 메시지를 다시 수신하면 복구가 가능합니다.

TimedOutNoRcvr 복구할 수 없는 시간 초과입니다. 메시지를 재전송했지만 응답을 받지 못했습니다. 따라서 문서 교환이 "시간 초과"되었습니다. 이 코드는 거래 문의에만 유효합니다.

```text
                    No recovery possible.
```

---
### **7.16.2 Payment Completion Codes**

CompletionCode는 ProcessState 속성이 Failed로 설정된 경우에만 필요합니다. 다음 표에는 사용할 수 있는 CompletionCode의 유효한 값이 포함되어 있으며 복구가 가능한 위치를 나타냅니다. 적절한 경우 추가 설명을 제공하기 위해 개별 결제 방식에서 StatusDesc 속성을 사용하는 것이 좋습니다.

```text
         Value                           Description
```

BrandNotSupp 브랜드는 지원되지 않습니다. 결제 브랜드가 결제 핸들러에서 지원되지 않습니다.

- 복구 옵션은 아래를 참조하세요.

CurrNotSupp 통화는 지원되지 않습니다. 결제 수단이나 결제 핸들러에서 결제 통화를 지원하지 않습니다.

- 결제가 브랜드 독립적인 경우 소비자는 가능한 경우 다른 통화나 다른 브랜드를 선택하여 복구할 수 있습니다. 여기에는 다른 결제 핸들러가 포함될 수 있습니다.

ConsCancelled 소비자가 취소되었습니다. 소비자가 어떤 이유로 결제를 취소하기로 결정했습니다. 이 코드는 취소 블록 또는 조회 응답 블록에 포함된 상태 구성 요소에서만 유효합니다.

- 복구가 불가능합니다.

PaymtCancelled 결제가 취소되었습니다. 결제 처리자가 어떤 이유로 결제 완료를 거부하고 거래를 취소합니다. 이 코드는 취소 블록 또는 조회 응답 블록에 포함된 상태 구성 요소에서만 유효합니다.

- 복구 옵션은 아래를 참조하세요.

AuthError 인증 오류입니다. 수행된 결제 수단별 인증 확인에 실패했습니다.

- 회복이 가능할 수도 있습니다. 허용되는 금액을 확인하려면 지불 체계 보충 자료를 참조하세요.

InsuffFunds 자금이 부족합니다. 결제할 수 있는 자금이 부족합니다.

- 복구 옵션은 아래를 참조하세요.

InstBrandInvalid 결제 수단이 브랜드에 유효하지 않습니다. 선택한 브랜드와 일치하지 않는 결제 수단을 사용하고 있습니다. 예를 들어 MasterCard가 브랜드로 선택되었을 때 Visa 신용카드가 사용되고 있습니다.

- 복구 옵션은 아래를 참조하세요.

InstNotValid 결제 수단이 거래에 유효하지 않습니다. 어떤 이유로 인해 제안된 거래 유형에 결제 수단을 사용할 수 없습니다.

- 복구 옵션은 아래를 참조하세요.

BadInstrument 잘못된 악기입니다. 사용 중인 결제 수단에 문제가 있어 결제에 사용할 수 없습니다.

- 복구 옵션은 아래를 참조하세요.

지정되지 않음 지정되지 않은 오류입니다. 다른 CompletionCode 중 하나에 속하지 않는 알 수 없는 문제나 오류가 있습니다. StatusDesc 속성은 원인에 대한 설명을 제공해야 합니다.

- 복구 옵션은 아래를 참조하세요.

TimedOutRcvr 복구 가능한 시간 초과. 메시지를 재전송했지만 응답을 받지 못했습니다. 따라서 문서 교환이 "시간 초과"되었습니다. 이 코드는 거래 문의에만 유효합니다.

- 다른 Trading Role의 마지막 메시지를 다시 수신하면 복구가 가능합니다.

TimedOutNoRcvr 복구할 수 없는 시간 초과입니다. 메시지를 재전송했지만 응답을 받지 못했습니다. 따라서 문서 교환이 "시간 초과"되었습니다. 이 코드는 거래 문의에만 유효합니다.

```text
                      No recovery possible.
```

결제가 브랜드 독립적인 경우 소비자가 다른 결제 브랜드 또는 동일한 브랜드에 대해 다른 결제 수단을 선택하면 완료 코드의 일부 값에 대해 복구가 가능할 수 있습니다. 여기에는 다른 결제 핸들러가 포함될 수 있습니다. 이것이 적용되는 코드는 BrandNotSupp, PaymtCancelled, InsuffFunds, InstBrandInvalid, InstNotValid, BadInstrument 및 Unspecified입니다.

브랜드 의존 구매와 관련된 지불금 복구는 판매자가 소비자에게 보낸 브랜드 선택 구성요소가 변경되지 않는 경우에만 가능합니다. 실제로 이는 동일한 브랜드, 프로토콜 금액 및 PayProtocol 요소를 사용해야 함을 의미합니다. 변경할 수 있는 것은 결제수단뿐입니다. 다른 변경 사항은 판매자의 제안을 무효화하며, 선택 사항을 변경하면 제안 응답이 무효화됩니다.

---
### **7.16.3 Delivery Completion Codes**

다음 표에는 배달에 대한 CompletionCode 속성의 유효한 값이 포함되어 있습니다. 필요한 경우 추가 설명을 제공하기 위해 StatusDesc 속성을 사용하는 것이 좋습니다.

```text
        Value                           Description
```

이월주문됨 이월주문됨. 배송할 상품이 주문되었으나 아직 수령되지 않았습니다. 배송은 접수되면 준비됩니다. 이는 ProcessState가 CompletedOk인 경우에만 유효합니다.

- 복구가 불가능합니다.

PermNotAvail을 영구적으로 사용할 수 없습니다. 해당 상품은 영구적으로 구매할 수 없으며 재주문할 수 없습니다. 이는 ProcessState가 Failed인 경우에만 유효합니다.

- 복구가 불가능합니다.

TempNotAvail을 일시적으로 사용할 수 없습니다. 해당 상품은 일시적으로 판매가 불가능하며, 주문이 가능한 경우 이용 가능해질 수 있습니다. 이는 ProcessState가 CompletedOk인 경우에만 유효합니다.

- 복구가 불가능합니다.

ShipPending 배송 보류 중입니다. 상품이 준비되어 있으며 배송 예정이지만 아직 배송되지 않았습니다. 이는 ProcessState가 CompletedOk인 경우에만 유효합니다.

- 복구가 불가능합니다.

배송된 상품이 배송되었습니다. 상품이 배송되었습니다.

- 배송 확인을 기다리고 있습니다. 이는 ProcessState가 CompletedOk인 경우에만 유효합니다.

- 복구가 불가능합니다.

ShippedNoConf 배송됨 - 배송 확인이 없습니다. 상품은 발송되었으나 배송 확인이 불가능합니다. 이는 ProcessState가 CompletedOk인 경우에만 유효합니다.

- 복구가 불가능합니다.

ConsCancelled 소비자가 취소되었습니다. 소비자가 어떤 이유로 배송을 취소하기로 결정했습니다. 이 코드는 취소 블록 또는 조회 응답 블록에 포함된 상태 구성 요소에서만 유효합니다.

- 복구가 불가능합니다.

DelivCancelled 배송이 취소되었습니다. 배달 핸들러가 어떤 이유로 배달 완료를 거부하고 거래를 취소합니다. 이 코드는 취소 블록 또는 조회 응답 블록에 포함된 상태 구성 요소에서만 유효합니다.

- 복구가 불가능합니다.

확인됨 확인됨. 모든 상품이 배송되었으며,

- 배송 확인이 접수되었습니다. 이는 ProcessState가 CompletedOk인 경우에만 유효합니다.

- 복구가 불가능합니다.

지정되지 않음 지정되지 않은 오류입니다. 다른 CompletionCode 중 하나에 속하지 않는 알 수 없는 문제나 오류가 있습니다. StatusDesc 속성은 원인에 대한 설명을 제공해야 합니다.

- 복구가 불가능합니다.

TimedOutRcvr 복구 가능한 시간 초과. 메시지를 재전송했지만 응답을 받지 못했습니다. 따라서 문서 교환이 "시간 초과"되었습니다. 이 코드는 거래 문의에만 유효합니다.

- 다른 Trading Role의 마지막 메시지를 다시 수신하면 복구가 가능합니다.

TimedOutNoRcvr 복구할 수 없는 시간 초과입니다. 메시지를 재전송했지만 응답을 받지 못했습니다. 따라서 문서 교환이 "시간 초과"되었습니다. 이 코드는 거래 문의에만 유효합니다.

```text
                   No recovery possible.
```

참고: 실패했거나 부분적으로 완료된 배달에서는 복구가 불가능합니다. 소비자는 현재 상태에 대한 최신 정보를 확인하기 위해 트랜잭션 상태 조회 트랜잭션\(섹션 9.2.1 참조\)을 사용해야 합니다.

---
### **7.16.4 Authentication Completion Codes**

완료 코드는 ProcessState 속성이 Failed로 설정된 경우에만 필요합니다. 다음 표에는 사용할 수 있는 CompletionCode의 유효한 값이 포함되어 있습니다. 적절한 경우 추가 설명을 제공하기 위해 StatusDesc 속성을 사용하는 것이 좋습니다.

```text
        Value                           Description
```

AutEeCancel 인증 대상을 취소합니다. 조직은

- authenticated는 어떤 이유로든 인증을 거부합니다. 예를 들어, 인증 요청의 서명이 유효하지 않거나 인증자가 알려지지 않았거나 인증 대상자가 수락할 수 없기 때문일 수 있습니다.

- 복구가 불가능합니다.

AutoOrCancel 인증자 취소. 인증을 요청한 기관은 어떤 이유로 수신된 인증 응답의 유효성을 거부하고 거래를 취소합니다.

- 복구가 불가능합니다.

NoAuthReq 인증 요청을 사용할 수 없습니다. 그만큼

- 피인증자는 성공적으로 인증되기 위해 제공되어야 하는 데이터를 가지고 있지 않습니다. 예를 들어, 비밀번호를 잊어버렸거나, 인증 대상자가 아직 회원이 아니었거나, 스마트 카드 토큰이 없을 수 있습니다.

```text
                   Recovery is not possible
```

AuthFailed 인증에 실패했습니다. 인증자가 인증 응답을 확인했지만 어떤 이유로 인증에 실패했습니다. 예를 들어, 비밀번호가 정확하지 않았을 수 있습니다.

- 피인증자가 수정된 데이터를 포함하여 수정된 인증 응답을 다시 보내면 복구가 가능할 수 있습니다.

TradRolesIncon 거래 역할이 일관되지 않습니다. 거래 역할 정보 요청 구성 요소\(섹션 7.4 참조\)의 TradingRoleList 속성에 포함된 거래 역할은 인증 대상이 IOTP 거래에서 취하고 있거나 취할 수 있는 거래 역할과 일치하지 않습니다. 불일치의 예는 다음과 같습니다. o PaymentHandler에 DeliveryHandler 정보 요청 o 소비자에게 판매자 정보 요청

- 인증자가 수정된 정보를 포함하여 수정된 인증 요청 블록을 재전송함으로써 복구가 가능할 수 있습니다.

지정되지 않음 지정되지 않은 오류입니다. 다른 CompletionCode 중 하나에 속하지 않는 알 수 없는 문제나 오류가 있습니다.

- 복구가 불가능합니다.

TimedOutRcvr 복구 가능한 시간 초과. 메시지를 재전송했지만 응답을 받지 못했습니다. 따라서 문서 교환이 "시간 초과"되었습니다. 이 코드는 거래 문의에만 유효합니다.

- 다른 Trading Role의 마지막 메시지를 다시 수신하면 복구가 가능합니다.

TimedOutNoRcvr 복구할 수 없는 시간 초과입니다. 메시지를 재전송했지만 응답을 받지 못했습니다. 따라서 문서 교환이 "시간 초과"되었습니다. 이 코드는 거래 문의에만 유효합니다.

```text
                   No recovery possible.
```

---
### **7.16.5 Undefined Completion Codes**

완료 코드는 ProcessState 속성이 Failed로 설정된 경우에만 필요합니다. 다음 표에는 사용할 수 있는 CompletionCode의 유효한 값이 포함되어 있습니다. 적절한 경우 추가 설명을 제공하기 위해 StatusDesc 속성을 사용하는 것이 좋습니다.

```text
        Value                           Description
```

InMsgHardError 입력 메시지 하드 오류입니다. 요청 블록 유형을 식별할 수 없거나 일치하지 않습니다. 따라서 단일 문서 교환을 식별할 수 없습니다. 이로 인해 거래에 하드 오류가 발생합니다.

---
### **7.16.6 Transaction Inquiry Completion Codes**

완료 코드는 ProcessState 속성이 Failed로 설정된 경우에만 필요합니다. 다음 표에는 사용할 수 있는 CompletionCode의 유효한 값이 포함되어 있습니다. 적절한 경우 추가 설명을 제공하기 위해 StatusDesc 속성을 사용하는 것이 좋습니다.

```text
        Value                           Description
```

UnAuthReq 무단 요청. 받는 사람

- 거래 상태 요청이 요청에 대한 응답을 거부합니다.

---
## **7.17 Trading Role Data Component**

거래 역할 데이터 구성요소에는 IOTP 거래와 관련된 거래 역할 간에 통신해야 하는 불투명 데이터가 포함되어 있습니다.

```text
   Trading Role Components identify:
```

o 구성 요소를 생성한 조직, 그리고

o 이를 수신할 조직.

먼저 생성되어 "응답" 블록에 포함된 다음 적절한 "요청" 블록에 복사됩니다. 예를 들어 결제 핸들러는 신용 카드 결제가 승인되었지만 캡처되지 않았음을 배달 핸들러에게 알려야 할 수 있습니다. 전달해야 하는 배달 핸들러와 비공개적으로 형식이 합의된 경우 결제 핸들러가 생성한 다른 정보도 있을 수 있습니다. 또 다른 예에서 판매자는 소비자가 지불로 두 배의 로열티 포인트를 얻을 수 있도록 소비자에 대한 특정 정보를 지불 핸들러에 제공해야 할 수도 있습니다.

그 정의는 다음과 같습니다.

```text
   <!ELEMENT TradingRoleData (PackagedContent+) >
   <!ATTLIST TradingRoleData
     ID                ID      #REQUIRED
     OriginatorElRef   NMTOKEN #REQUIRED
     DestinationElRefs NMTOKENS #REQUIRED >

   Attributes:
```

ID IOTP 거래 내에서 거래 역할 데이터 구성 요소를 고유하게 식별하는 식별자입니다.

OrginatorElRef 거래 역할 데이터 구성요소를 생성하고 이를 "응답" 블록\(예: 제안 응답 또는 지불 응답 블록\)에 포함시킨 조직의 조직 구성요소에 대한 요소 참조를 포함합니다.

DestinationElRefs "요청" 블록\(예: 지불 요청 또는 배달 요청 블록\)에서 거래 역할 데이터 구성요소를 수신할 조직의 조직 구성요소에 대한 요소 참조를 포함합니다.

```text
   Content:
```

PackagedContent 여기에는 하나 이상의 PackagedContent 요소로서 다양한 거래 역할 간에 전송되는 데이터가 포함됩니다\(섹션 3.7 참조\).

---
### **7.17.1 Who Receives a Trading Role Data Component**

거래 역할 데이터 구성요소로 무엇을 할지 결정하는 규칙은 아래에 설명되어 있습니다.

o 거래 역할 데이터 구성요소가 "응답" 블록에서 수신될 때마다 DestinationElRefs 속성에 의해 식별된 대로 이를 수신할 조직의 조직 구성요소를 식별합니다.

o "요청" 블록이 전송될 때마다 DestinationElRefs 속성으로 식별된 조직 중 하나로 전송되고 있는지 확인하십시오. 그런 다음 "요청" 블록에 포함되는 경우:

- - 거래 역할 데이터 구성요소 및

```text
      -  the Organisation Component of the Organisation identified by
         the OriginatorElRef attribute (if not already present)
```

---
## **7.18 Inquiry Type Component**

조회 유형 구성요소에는 조회 중인 프로세스 유형을 나타내는 정보가 포함됩니다. 그 정의는 다음과 같습니다.

```text
   <!ELEMENT InquiryType EMPTY >
   <!ATTLIST InquiryType
    ID                 ID      #REQUIRED
    Type               NMTOKEN #REQUIRED
    ElRef              NMTOKEN #IMPLIED
    ProcessReference   CDATA   #IMPLIED >

   Attributes:
```

ID IOTP 트랜잭션 내에서 조회 유형 구성요소를 고유하게 식별하는 식별자입니다.

유형 문의 유형이 포함됩니다. 유형의 유효한 값은 다음과 같습니다. o 제안. 문의는 제안 상태에 관한 것이며 판매자에게 전달됩니다. o 지불. 문의는 결제 상태에 관한 것이며 결제 처리자에게 전달됩니다. o 배송. 문의는 배송 상태에 관한 것이며 배송 핸들러에게 전달됩니다.

```text
   ElRef              Contains an Element Reference (see section 3.5) to
                      the component to which this Inquiry Type Component
                      applies. That is,
                       o TPO Block when Type is Offer

                       o Payment Component when Type is Payment
                       o Delivery Component when Type is Delivery
```

ProcessReference 선택적으로 조회 중인 프로세스에 대한 참조를 포함합니다. 정보가 사용 가능한 경우 설정해야 합니다. 포함될 수 있는 값의 정의는 상태 구성 요소의 ProcessReference 특성을 참조하세요\(섹션 7.16 참조\).

---
## **7.19 Signature Component**

참고: 서명 및 인증서에 대한 XML 구조의 정의는 이 문서와 동시에 출판된 Kent Davidson 및 Yoshiaki Kawatsura의 "인터넷 공개 거래 프로토콜을 위한 디지털 서명"이라는 제목의 문서에 설명되어 있습니다. \[IOTPDSIG\]를 참조하십시오.

앞으로는 IOTP의 향후 버전이 XML의 디지털 서명 방법이 표준이 되는 방식을 채택할 것으로 예상됩니다.

각 서명 구성 요소는 다른 서명 구성 요소를 포함하여 하나 이상의 블록 또는 구성 요소에 디지털 방식으로 서명합니다.

시그니처 구성 요소:

o 동일한 IOTP 트랜잭션 내의 하나 이상의 IOTP 메시지에 있는 하나 이상의 블록 또는 구성 요소의 다이제스트를 포함하고 결과를 다이제스트 요소에 배치합니다.

o 이러한 Digest 요소를 서명 유형, 서명 작성자 및 잠재적 수신자, 사용 중인 서명 알고리즘의 세부 사항에 대한 기타 정보와 연결하여 Manifest 요소에 배치합니다.

o 선택적 인증서를 사용하여 Manifest 요소에 서명합니다.

- 서명 구성 요소 내의 값 요소에 결과를 배치하는 서명 블록 내의 인증서 요소에서 식별됩니다.

매니페스트 요소의 서명을 포함하는 여러 값 요소가 있을 수 있습니다.

서명 구성 요소는 다음 네 가지 유형 중 하나일 수 있습니다.

o 제안 응답 서명,

o 지불 응답 서명,

o 배송 응답 서명, 또는

o 인증 응답 서명.

서명에 대한 일반적인 설명은 섹션 6 디지털 서명을 참조하십시오.

---
### **7.19.1 IOTP usage of signature elements and attributes**

요소와 속성의 정의는 \[IOTPDSIG\]에 포함되어 있습니다. 다음에는 IOTP에서 이러한 요소와 속성을 사용하는 방법을 설명하는 추가 정보가 포함되어 있습니다.

```text
   SIGNATURE ELEMENT
```

ID 속성은 필수입니다.

```text
   MANIFEST ELEMENT
```

선택적 LocatorHrefBase 속성에는 매니페스트 내 모든 Digest 요소의 LocatorHREF 속성에 포함된 텍스트 앞에 연결되어야 하는 텍스트가 포함되어 있습니다.

동일한 서명에 있는 LocatorHREF 속성의 첫 번째 부분이 동일할 가능성이 높기 때문에 그 목적은 LocatorHREF 속성 값의 크기를 줄이는 것입니다.

일반적으로 IOTP 내에서는 LocatorHref 속성의 모든 문자를 샤프\("#"\) 문자까지 포함합니다\(바로 아래 참조\).

알고리즘 및 매개변수 요소

알고리즘 요소는 서명 생성에 사용되는 알고리즘을 식별합니다. 알고리즘의 유형은 다이제스트 알고리즘, 서명 알고리즘 또는 키 계약 알고리즘으로 사용되는지 여부를 나타내는 유형 속성의 값으로 정의됩니다.

다음 다이제스트 알고리즘을 구현해야 합니다.

```text
   o  a [DOM-HASH] algorithm. This is identified by setting the Name
      attribute of the Algorithm element to "urn:ibm:dom-hash"
```

o \[SHA1\] 알고리즘. 이는 Algorithm 요소의 Name 속성을 "urn:fips:sha1"로 설정하여 식별됩니다.

```text
   o  a [MD5] algorithm. This is identified by setting the Name
      attribute of the Algorithm element to "urn:rsa:md5"
```

o 다음 서명 알고리즘을 구현해야 합니다.

```text
   o  a [DSA] algorithm. This is identified by setting the Name
      attribute of the Algorithm element to "urn:us.gov:dsa"

   o  a [HMAC] algorithm. This is identified by setting the Name
      attribute of the Algorithm element to "urn:ibm:hmac"
```

다음 서명 알고리즘도 구현하는 것이 좋습니다.

```text
   o  a [RSA] algorithm. This is identified by setting the Name
      attribute of the Algorithm element to "urn:rsa:rsa"
```

또한 다른 결제 방식별 알고리즘을 사용할 수도 있습니다. 이 경우 사용할 이름 속성의 값은 해당 알고리즘에 대한 지불 체계 보충 항목에 지정됩니다.

한 알고리즘은 Parameter 요소를 사용하여 다른 알고리즘을 사용할 수 있습니다. 예를 들면 다음과 같습니다.

```text
   <Algorithm ID=A1 type="digest" name="urn:ibm:dom-hash">
     <Parameter type='AlgorithmRef'>A2</Parameter>
   </Algorithm>
   <Algorithm ID=A2 type="digest" name="urn:fips:sha1">
   </Algorithm>
   <Algorithm ID=A3 type="signature" name="urn:ibm:hmac">
       <Parameter type='AlgorithmRef'>A1</Parameter>
   </Algorithm>

   DIGEST ELEMENT
```

LocatorHREF 속성은 디지털 서명되는 IOTP 요소를 식별합니다. 구체적으로 다음과 같이 구성됩니다.

o 트랜잭션 ID 구성 요소의 IotpTransId 속성 값 다음에 다음이 옵니다.

o 날카로운 문자\(예: "#"\)

o 다이제스트의 주제인 IOTP 트랜잭션 내의 요소에 대한 요소 참조\(섹션 3.5 참조\).

LocatorHREF 속성의 구조를 분석하기 전에 Manifest 요소의 LocatorHrefBase 속성 값과 연결되어야 합니다\(바로 위 참조\).

```text
   ATTRIBUTE ELEMENT
```

값이 IOTP 서명 유형이고 내용이 OfferResponse, PaymentResponse, DeliveryResponse 중 하나로 설정된 Type 속성을 포함하는 속성 요소는 하나만 있어야 합니다.

AuthenticationRequest, AuthenticationResponse, PingRequest 또는 PingResponse; 서명 유형에 따라 다릅니다.

Attribute 요소의 내용 값은 사용자 정의 값 정의를 허용하는 섹션 12 IANA 고려 사항에 정의된 절차에 따라 제어됩니다.

Critical 속성은 true로 설정되어야 합니다.

```text
   ORIGINATORINFO ELEMENT
```

OriginatorInfo 요소의 OriginatorRef 속성은 항상 존재해야 하며 서명 구성 요소를 생성한 조직의 조직 구성 요소에 대한 요소 참조\(섹션 3.5 참조\)를 포함해야 합니다.

```text
   RECIPIENTINFO ELEMENT
```

RecipientRefs 속성에는 서명의 유효성을 검사해야 할 수 있는 조직을 가리키는 요소 참조 목록\(섹션 3.5 참조\)이 포함되어 있습니다. 자세한 내용은 아래를 참조하세요.

---
### **7.19.2 Offer Response Signature Component**

OfferResponse 유형을 가진 서명의 매니페스트 요소에는 다음 구성 요소에 대한 다이제스트 요소가 포함되어야 합니다.

o 제안 응답 서명을 포함하는 IOTP 메시지의 트랜잭션 ID 구성 요소\(섹션 3.3.1 참조\)

o 제안 응답 서명이 포함된 IOTP 메시지의 트랜잭션 참조 블록\(섹션 3.3 참조\)

o TPO 블록에서:

- - 프로토콜 옵션 구성요소

- - 각 조직 구성 요소

- - 각 브랜드 목록 구성요소

o 선택적으로 모든 브랜드 선택 구성요소\(TPO 선택 블록에서 판매자에게 전송된 경우\)

o 제안 응답 블록에서:

- - 주문 구성요소

- - 각 결제 구성요소

- - 전달 구성요소

- - 각 인증 요청 구성 요소

```text
      - any Trading Role Data Components
```

제안 응답 서명에는 서명을 확인해야 하거나 확인해야 하는 각 조직을 설명하는 구성 요소에 대한 다이제스트 요소도 포함되어야 합니다. 여기에는 다음이 포함됩니다.

o 판매자가 브랜드 선택 구성요소를 포함하는 TPO 선택 블록을 수신한 경우 브랜드 선택 구성요소에 의해 식별된 지불 핸들러와 배송 구성요소에 의해 식별된 배송 핸들러에 대한 다이제스트 요소를 생성합니다. 이 작업을 수행하는 방법에 대한 설명은 섹션 6.3.1 요청 블록 전송 올바른 조직 확인을 참조하세요.

o 판매자가 TPO 선택 블록을 수신할 것으로 예상하지 않는 경우 배송 핸들러 및 관련된 모든 결제 핸들러에 대한 다이제스트 요소를 생성합니다.

---
### **7.19.3 Payment Receipt Signature Component**

지불 영수증 서명 구성 요소의 매니페스트 요소에는 다음 구성 요소에 대한 다이제스트 요소가 포함되어야 합니다.

o 지불 영수증 서명이 포함된 IOTP 메시지의 거래 ID 구성 요소\(섹션 3.3.1 참조\)

o 지불 영수증 서명이 포함된 IOTP 메시지의 거래 참조 블록\(섹션 3.3 참조\)

o 제안 응답 서명 구성 요소

o 지불 영수증 구성 요소

o 지불 메모 구성 요소

o 상태 구성 요소

o 브랜드 선택 구성요소.

```text
   o  any Trading Role Data Components
```

---
### **7.19.4 Delivery Response Signature Component**

배달 응답 서명 구성 요소의 매니페스트 요소에는 다음 구성 요소에 대한 다이제스트 요소가 포함되어야 합니다.

o 배달 응답 서명을 포함하는 IOTP 메시지의 트랜잭션 ID 구성 요소\(섹션 3.3.1 참조\)

o 배달 응답 서명을 포함하는 IOTP 메시지의 트랜잭션 참조 블록\(섹션 3.3 참조\)

```text
   o  the Consumer Delivery Data component contained in the preceding
      Delivery Request (if any)

   o  the Signature Components contained in the preceding Delivery
      Request (if any)
```

o 상태 구성 요소

o 납품서 구성요소

---
### **7.19.5 Authentication Request Signature Component**

인증 요청 서명 구성 요소의 매니페스트 요소에는 다음 구성 요소에 대한 다이제스트 요소가 포함되어야 합니다.

o IOTP 메시지 및 IOTP 트랜잭션을 설명하는 정보가 포함된 IOTP 메시지에 대한 트랜잭션 참조 블록\(섹션 3.3 참조\)

o IOTP 트랜잭션을 전역적으로 고유하게 식별하는 트랜잭션 ID 구성 요소\(섹션 3.3.1 참조\)

o TPO 블록의 다음 구성요소:

- - 프로토콜 옵션 구성요소

- - 조직 구성요소

o 인증 요청 블록의 다음 구성요소:

```text
      -  the Authentication Request Component(s) (if present)

      -  the Trading Role Information Request Component (if present)
```

---
### **7.19.6 Authentication Response Signature Component**

인증 응답 서명 구성 요소의 매니페스트 요소에는 다음 구성 요소에 대한 다이제스트 요소가 포함되어야 합니다.

o IOTP 메시지 및 IOTP 트랜잭션을 설명하는 정보가 포함된 IOTP 메시지에 대한 트랜잭션 참조 블록\(섹션 3.3 참조\)

o IOTP 트랜잭션을 전역적으로 고유하게 식별하는 트랜잭션 ID 구성 요소\(섹션 3.3.1 참조\)

o 인증 요청 블록의 다음 구성요소:

```text
      -  the Authentication Request Component that was used in the
         Authentication (if present)

      -  the Trading Role Information Request Component (if present)
```

o 인증 응답 블록에 포함된 조직 구성 요소

---
### **7.19.7 Inquiry Request Signature Component**

조회 요청이 서명되는 경우\(섹션 9.2.1 참조\) 조회 요청 서명 구성 요소의 매니페스트 요소에는 조회 유형 구성 요소의 다이제스트 요소가 포함되어야 하며, 존재하는 경우 결제 체계 구성 요소도 포함되어야 합니다.

---
### **7.19.8 Inquiry Response Signature Component**

문의 응답이 서명되는 경우\(섹션 9.2.1 참조\) 문의 응답 서명 구성 요소의 매니페스트 요소에는 거래 응답 블록 및 상태 구성 요소의 다이제스트 요소가 포함되어야 합니다.

---
### **7.19.9 Ping Request Signature Component**

Ping 요청이 전송되는 경우\(섹션 9.2.2 참조\) Ping 요청 서명 구성 요소의 매니페스트 요소에는 모든 조직 구성 요소에 대한 다이제스트 요소가 포함되어야 합니다.

---
### **7.19.10 Ping Response Signature Component**

Ping 응답이 전송되는 경우\(섹션 9.2.2 참조\) Ping 응답 서명 구성 요소의 매니페스트 요소에는 모든 조직 구성 요소에 대한 다이제스트 요소가 포함되어야 합니다.

---
## **7.20 Certificate Component**

참고: 서명 및 인증서에 대한 XML 구조 정의는 "인터넷 개방형 거래 프로토콜에 대한 디지털 서명" 문서에 설명되어 있습니다. \[IOTPDSIG\]를 참조하세요.

자세한 내용은 섹션 7.19 서명 구성 요소 시작 부분의 참고를 참조하세요.

인증서 구성 요소에는 디지털 인증서가 포함되어 있습니다. 예를 들어 비대칭 암호화가 사용되고 확인해야 하는 서명 수신자가 아직 공개 키를 받지 않은 경우와 같이 필요한 경우에만 사용됩니다.

인증서 구성요소의 구조는 \[IOTPDSIG\]에 정의되어 있습니다.

---
### **7.20.1 IOTP usage of signature elements and attributes**

위의 요소와 속성에 대한 자세한 정의는 \[IOTPDSIG\]에 포함되어 있다. 다음에는 IOTP에서 이러한 요소와 속성을 사용하는 방법을 설명하는 추가 정보가 포함되어 있습니다.

```text
   CERTIFICATE COMPONENT
```

ID 속성은 필수입니다.

```text
   VALUE ELEMENT
```

ID 속성은 필수입니다.

---
## **7.21 Error Component**

오류 구성요소에는 거래에 관련된 거래 역할 중 하나가 수신한 IOTP 메시지의 기술적 오류\(섹션 4.1 참조\)에 대한 정보가 포함되어 있습니다.

명확성을 위해 오류 구성 요소 설명에 사용되는 두 가지 문구가 정의됩니다.

o 메시지에 오류가 있습니다. 어떤 종류의 오류를 포함하거나 발생시키는 IOTP 메시지

o 오류를 보고하는 메시지입니다. 오류 메시지에서 발견된 오류를 설명하는 오류 구성요소가 포함된 IOTP 메시지입니다.

Error Component의 정의는 다음과 같습니다.

```text
   <!ELEMENT ErrorComp (ErrorLocation+, PackagedContent*) >
   <!ATTLIST ErrorComp
    ID                 NMTOKEN #REQUIRED
    xml:lang           NMTOKEN #REQUIRED
    ErrorCode          NMTOKEN #REQUIRED
    ErrorDesc          CDATA   #REQUIRED
    Severity (Warning|TransientError|HardError) #REQUIRED
    MinRetrySecs       CDATA   #IMPLIED
    SwVendorErrorRef   CDATA   #IMPLIED >

   Attributes:
```

ID IOTP 트랜잭션 내에서 오류 구성 요소를 고유하게 식별하는 식별자입니다.

xml:lang 하위 요소의 xml:lang 속성으로 재정의되지 않는 한 이 구성 요소 내의 속성 또는 하위 요소에서 사용되는 언어를 정의합니다. 섹션 3.8 언어 식별을 참조하세요.

ErrorCode 오류 메시지에 있는 오류의 성격을 나타내는 오류 코드를 포함합니다. ErrorCode의 유효한 값은 섹션 7.21.2 오류 코드에 나와 있습니다.

```text
   ErrorDesc          Contains a narrative description of the error in
                      the language defined by xml:lang. The content of
                      this attribute is defined by the vendor/developer
                      of the software which generated the Error
                      Component

   Severity           Indicates the severity of the error.  Valid values
                      are:
                       o Warning. This indicates that although there is
                         a message in error the IOTP Transaction can
                         still continue.
                       o TransientError. This indicates that the error
                         in the message in error may be recovered if the
                         message in error  that is referred to by the
                         ErrorLocation element is resent
```

-o 하드 오류. 이는 오류가 발생한 메시지에 복구할 수 없는 오류가 있어 IOTP 트랜잭션을 중지해야 함을 나타냅니다.

MinRetrySecs 심각도가 TransientError로 설정된 경우 이 특성이 있어야 합니다. 오류를 보고하는 메시지를 수신한 IOTP 인식 응용 프로그램이 ErrorLocation 요소로 식별된 오류가 있는 메시지를 다시 보내기 전에 기다려야 하는 최소 시간\(초\)입니다.

- Severity가 TransientError로 설정되지 않은 경우 이 속성의 값은 무시됩니다.

SwVendorErrorRef 이 속성은 오류 구성 요소를 생성한 소프트웨어의 공급업체/개발자가 값을 설정한 참조입니다. 여기에는 공급업체가 소프트웨어의 정확한 위치와 소프트웨어가 오류를 보고하는 메시지를 생성하게 만든 일련의 상황을 식별할 수 있는 데이터가 포함되어야 합니다. 트랜잭션 참조 블록\(섹션 3.3\)에 있는 메시지 Id 요소의 SoftwareId 속성도 참조하세요.

```text
   Content:
```

ErrorLocation 이는 오류가 발생한 메시지의 IOTP 트랜잭션 ID를 식별하고, 가능한 경우 오류 구성 요소를 생성한 오류가 발생한 메시지의 요소 및 속성을 식별합니다.

오류의 심각도가 아닌 경우

- TransientError, 오류의 성격\(섹션 7.21.2 오류 코드 참조\) 및 IOTP 인식 응용 프로그램의 공급업체/개발자의 재량에 따라 둘 이상의 ErrorLocation이 적절하게 지정될 수 있습니다.

PackagedContent 여기에는 오류를 이해하는 데 사용할 수 있는 추가 데이터가 포함되어 있습니다. 그 내용은 오류의 성격\(섹션 7.21.2 오류 코드 참조\)과 IOTP 인식 응용 프로그램의 공급업체/개발자의 재량에 따라 적절하게 달라질 수 있습니다. PackagedContent의 정의는 섹션 3.7을 참조하세요.

---
### **7.21.1 Error Processing Guidelines**

오류를 보고하는 메시지에 오류 구성 요소가 두 개 이상 있는 경우 심각도가 가장 높은 오류 구성 요소에 적합한 작업을 수행합니다. 이 맥락에서 HardError는 Warning보다 심각도가 높은 TransientError보다 심각도가 높습니다.

---
#### **7.21.1.1 Severity - Warning**

IOTP 인식 응용 프로그램이 심각도 속성이 경고로 설정된 오류 구성 요소가 있는 오류를 보고하는 메시지를 생성하는 경우 오류를 보고하는 메시지에 심각도가 경고보다 높은 다른 오류 구성 요소가 포함되어 있지 않으면 IOTP 메시지도 다음과 같아야 합니다. 오류가 보고되지 않은 경우 포함되었을 거래 블록 및 거래 구성요소를 포함합니다.

심각도가 경고로 설정된 오류 구성 요소와 함께 오류를 보고하는 메시지가 수신되면 다음을 수행합니다.

o 오류에 대한 정보를 기록하거나 사용자에게 보고하는 것이 좋습니다.

o IOTP 인식 애플리케이션의 구현자는 자신 또는 사용자의 재량에 따라 다음 중 하나를 수행해야 합니다.

- - IOTP 트랜잭션을 정상적으로 계속하거나, 또는

- - 심각도가 HardError로 설정된 오류 구성 요소를 사용하여 오류를 보고하는 메시지를 생성하여 IOTP 트랜잭션을 실패시킵니다\(섹션 7.21.1.3 참조\).

IOTP 트랜잭션을 계속하려는 의도인 경우 심각도가 더 높은 다른 오류 구성요소가 없으면 계속하려면 트랜잭션의 정상적인 처리에 필요한 거래 블록 및 거래 구성요소가 있는지 확인하십시오. 그렇지 않은 경우 심각도가 HardError로 설정된 오류 구성 요소를 사용하여 오류를 보고하는 메시지를 생성합니다.

---
#### **7.21.1.2 Severity - Transient Error**

IOTP 인식 응용 프로그램이 Severity 속성이 TransientError로 설정된 오류 구성 요소를 사용하여 오류를 보고하는 메시지를 생성하는 경우 오류를 보고하는 메시지에는 오류 구성 요소가 하나만 있어야 합니다. 또한 MinRetrySecs 특성이 있어야 합니다.

심각도가 TransientError로 설정된 오류 구성 요소와 함께 오류를 보고하는 메시지가 수신되는 경우:

o MinRetrySecs 속성이 존재하고 유효한 숫자인 경우 제공된 MinRetrySecs 값을 사용합니다. 그렇지 않고 MinRetrySecs가 누락되었거나 유효하지 않은 경우:

- - 심각도가 경고인 오류 구성 요소가 포함된 오류를 보고하는 메시지를 생성하고 다음 IOTP 메시지\(있는 경우\)에서 이를 전송하여 유효하지 않은 MinRetrySecs로 오류를 보고하는 메시지를 보낸 거래 역할에 보냅니다.

- MinRetrySecs에 의해 설정된 값을 사용합니다.

- IOTP 인식 애플리케이션의 공급업체/개발자.

o 오류 구성요소 내에 단 하나의 ErrorLocation 요소가 포함되어 있고 심각도가 TransientError인 오류 구성요소의 수신자가 전송한 IOTP 메시지를 참조하는지 확인하십시오. 두 개 이상의 ErrorLocation이 있는 경우 심각도가 HardError인 오류를 보고하는 메시지를 생성합니다.

---
#### **7.21.1.3 Severity - Hard Error**

IOTP 인식 응용 프로그램이 심각도 속성이 HardError로 설정된 오류 구성 요소와 함께 오류를 보고하는 메시지를 생성하는 경우 오류를 보고하는 메시지에는 오류 구성 요소가 하나만 있어야 합니다.

심각도가 HardError로 설정된 오류 구성 요소와 함께 오류를 보고하는 메시지가 수신되면 IOTP 트랜잭션을 종료합니다.

---
### **7.21.2 Error Codes**

다음 표에는 오류 구성 요소의 ErrorCode 속성에 대한 유효한 값이 포함되어 있습니다. 설명의 첫 번째 문장에는 오류가 표시되거나 보고될 때 오류를 설명하는 데 사용해야 하는 텍스트가 포함되어 있습니다. 개별 구현에서는 재량에 따라 이를 대체 언어로 번역할 수 있습니다.

오류 코드는 14자를 초과할 수 없습니다.

```text
        Value                           Description
```

예약됨 예약됨. 이 오류는

- 소프트웨어 공급업체/개발자. 자세한 내용은 소프트웨어 공급업체/개발자에게 문의하세요. 트랜잭션 참조 블록\(섹션 3.3\)에 있는 메시지 ID 요소의 SoftwareId 특성을 참조하세요.

XmlNotWellFrmd XML의 형식이 잘못되었습니다. XML 문서의 형식이 올바르지 않습니다. "잘 구성된"의 의미는 \[XML\]을 참조하세요. XML이 제대로 구성되지 않은 경우에도 올바른 형식의 오류 응답이 생성될 수 있도록 트랜잭션 참조 블록을 찾기 위해 스캔해야 합니다.

XmlNotValid XML이 유효하지 않습니다. XML 문서의 형식은 올바르지만 문서가 유효하지 않습니다. "유효"의 의미는 \[XML\]을 참조하세요. 구체적으로: o XML 문서는 IOTP 문서 유형 선언\(DTD\)에 정의된 제약 조건을 준수하지 않습니다\(섹션 13 인터넷 공개 거래 프로토콜 데이터 유형 정의 참조\). o XML 문서는 문서에 정의된 제약 조건을 준수하지 않습니다. 선언된 추가 \[XML 네임스페이스\]의 유형 선언입니다.

- XML의 형식이 올바르지 않은 경우에도 올바른 형식의 오류 응답이 생성될 수 있도록 트랜잭션 참조 블록을 추출하려는 시도가 계속 이루어져야 합니다.

ElUnexpected 예상치 못한 요소입니다. XML 문서가 잘 구성되고 유효하더라도 이 사양에 포함된 규칙 및 제약 조건에 따라 특정 상황에서 예상되지 않는 요소가 존재합니다.

ElNotSupp 요소가 지원되지 않습니다. 문서가 잘 구성되고 유효하더라도 다음 요소가 존재합니다. o 이 사양에 포함된 규칙 및 제약 조건과 일치하지만 o IOTP 메시지를 처리하는 IOTP 인식 응용 프로그램에서 지원되지 않습니다.

ElMissing 요소가 누락되었습니다. 문서는 잘 구성되어 있고 유효하지만, 이 사양에 포함된 규칙과 제약 조건을 따르면 존재해야 하는 요소가 누락되었습니다.

- 이 경우 오류 구성요소의 PackagedContent를 누락된 요소 유형으로 설정합니다.

ElContIllegal 요소 콘텐츠가 잘못되었습니다. 문서는 잘 구성되어 있고 유효하지만 Content 요소에는 이 사양에 포함된 규칙 및 제약 조건을 따르지 않는 값이 포함되어 있습니다.

EncapProtErr 캡슐화된 프로토콜 오류입니다. 문서의 형식이 올바르고 유효하더라도 요소의 PackagedContent에는 오류가 있는 캡슐화된 프로토콜의 데이터가 포함되어 있습니다.

AttUnexpected 예상치 못한 특성입니다. XML 문서가 잘 구성되고 유효하더라도 이 사양에 포함된 규칙 및 제약 조건에 따라 특정 컨텍스트에서는 속성이 존재할 것으로 예상되지 않습니다.

AttNotSupp 속성이 지원되지 않습니다. XML 문서의 형식이 올바르고 유효하며 요소의 속성 존재가 이 사양에 포함된 규칙 및 제약 조건과 일치하더라도 IOTP 메시지를 처리하는 IOTP 인식 애플리케이션에서는 이를 지원하지 않습니다.

AttMissing 속성이 누락되었습니다. 문서가 잘 구성되고 유효하더라도 이 사양에 포함된 규칙과 제약 조건을 따르면 존재해야 하는 속성이 누락되었습니다.

- 이 경우 오류 구성 요소의 PackagedContent를 누락된 속성 유형으로 설정합니다.

AttValIllegal 속성 값이 잘못되었습니다. 속성에 이 사양에 포함된 규칙 및 제약 조건을 따르지 않는 값이 포함되어 있습니다.

AttValNotRecog 속성 값이 인식되지 않습니다. 속성에는 오류를 보고하는 메시지를 생성하는 IOTP 인식 애플리케이션이 인식할 수 없는 값이 포함되어 있습니다.

MsgTooLarge 메시지가 너무 큽니다. 메시지가 너무 커서 IOTP 인식 애플리케이션에서 처리할 수 없습니다.

```text
   ElTooLarge      Element too large. The element is too large to be
                   processed by the IOTP Aware Application
```

ValueTooSmall 값이 너무 작거나 빠릅니다. 요소나 속성의 콘텐츠 전체 또는 일부 값이 유효하지만 너무 작습니다.

ValueTooLarge 값이 너무 크거나 미래입니다. 요소나 속성의 콘텐츠 전체 또는 일부 값이 유효하지만 너무 큽니다.

ElInconstant 요소가 일관성이 없습니다. 문서가 잘 구성되고 유효하더라도 이 사양에 포함된 규칙 및 제약 조건에 따라: o 요소의 내용이 다른 요소 또는 해당 속성의 내용과 일치하지 않습니다. 또는 o 속성의 값이 값과 일치하지 않습니다. 하나 이상의 다른 속성.

- 이 경우 일관성이 없는 모든 속성이나 요소를 식별하는 ErrorLocation 요소를 만듭니다.

TransportError 전송 오류입니다. 이 오류 코드는 메시지 수신을 방해하는 전송 메커니즘에 문제가 있음을 나타내는 데 사용됩니다. 일반적으로 일시적인 오류와 관련이 있습니다. 전송 오류에 대한 설명은 ErrorDesc 속성에 포함되어 있습니다. TransportError와 함께 ErrorDesc 내부에서 사용할 수 있는 값은 전송 메커니즘에 대한 IOTP 보충 문서에 지정되어 있습니다.

MsgBeingProc 메시지가 처리 중입니다. 이 오류 코드는 일시적 오류 심각도에만 사용됩니다. 이는 교환 메시지 또는 요청 메시지일 수 있는 이전 메시지가 처리 중임을 나타내며, MinRetrySecs 속성이 지정한 시간까지 응답이 수신되지 않으면 원본 메시지를 다시 보내야 함을 나타냅니다.

```text
   SystemBusy      System Busy. This error code is only used with a
                   Severity of Transient Error. It indicates that the
                   server that received a message is currently too busy
                   to handle the message. If no response is received by
```

- MinRetrySecs 속성에 표시된 시간이면 원본 메시지가 다시 전송되어야 합니다.

참고: 전송 메커니즘\(예: HTTP\)을 처리하는 서버/시스템이 사용 중인 경우 IOTP 오류 메시지 대신 전송 관련 오류 메시지를 사용해야 합니다. 이 코드는 IOTP 서버/시스템 또는 IOTP 서버가 연결된 다른 서버/시스템과 관련하여 사용해야 합니다.

UnknownError 알 수 없는 오류입니다. 다른 오류에 의해 명시적으로 다루어지지 않는 어떤 이유로 인해 트랜잭션을 완료할 수 없음을 나타냅니다. ErrorDesc 속성은 문제의 성격을 나타내는 데 사용되어야 합니다.

- 예를 들어 백엔드 서버 또는 클라이언트 프로세스의 내부 오류를 나타내는 데 사용될 수 있습니다.

---
### **7.21.3 Error Location Element**

오류 위치 요소는 오류와 관련된 오류 메시지의 요소와 선택적으로 속성을 식별합니다. 여기에는 오류가 있는 IOTP 메시지, 거래 블록, 거래 구성 요소, 요소 및 속성에 대한 참조가 포함되어 있습니다.

```text
   <!ELEMENT ErrorLocation EMPTY >
   <!ATTLIST ErrorLocation
    ElementType        NMTOKEN #REQUIRED
    IotpMsgRef         NMTOKEN #IMPLIED
    BlkRef             NMTOKEN #IMPLIED
    CompRef            NMTOKEN #IMPLIED
    ElementRef         NMTOKEN #IMPLIED
    AttName            NMTOKEN #IMPLIED >

   Attributes:
```

ElementType 오류가 발생한 요소의 유형 이름입니다. 예를 들어 요소가 <!ELEMENT Org ...로 선언된 경우 해당 이름은 "Org"입니다.

IotpMsgRef 이는 이 오류 구성요소가 적용되는 오류가 발생한 메시지의 메시지 ID 구성요소\(섹션 3.3.2 참조\)의 ID 속성 값입니다.

BlkRef 오류가 특정 거래 블록과 관련된 경우 이는 오류가 있는 거래 블록의 ID 속성 값입니다.

CompRef 오류가 특정 거래 구성요소와 연관된 경우 이는 오류가 있는 거래 구성요소의 ID 속성 값입니다.

ElementRef 오류가 거래 구성요소 내의 특정 요소와 연관되어 있는 경우 해당 요소에 "ID"의 "속성 유형"\(\[XML\] 참조\)이 있는 속성이 있는 경우 이는 해당 속성의 값입니다.

AttName 오류가 속성 값과 연관된 경우 이는 해당 속성의 이름입니다. 이 경우 오류 구성 요소의 PackagedContent에는 속성 값이 포함되어야 합니다.

가능한 한 많은 속성을 포함해야 합니다. 예를 들어, 거래 구성요소의 하위 요소에 있는 속성에 잘못된 값이 포함된 경우 ErrorLocation의 모든 속성이 존재해야 합니다.

---
## **8. Trading Blocks**

트레이딩 블록은 거래에 참여하는 다양한 트레이딩 역할 간에 직접 \[XML\] 문서 형식으로 전송되는 최상위 IOTP 메시지의 하위 요소입니다.

각 거래 블록은 하나 이상의 거래 구성요소로 구성됩니다\(섹션 7 참조\). 이는 아래 다이어그램에 설명되어 있습니다.

```text
   *+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*

             IOTP MESSAGE  <-----------IOTP Message - an XML Document
              |                        which is transported between the
              |                        Trading Roles
              |-Trans Ref Block <----- Trans Ref Block - contains
              |  |                     information which describes the
              |  |                     IOTP Transaction and the IOTP
              |  |                     Message.
              |  |-Trans Id Comp. <--- Transaction Id Component -
              |  |                     uniquely identifies the IOTP
              |  |                     Transaction. The Trans Id
              |  |                     Components are the same across
              |  |                     all IOTP messages that comprise a
              |  |                     single IOTP transaction.
              |  |-Msg Id Comp. <----- Message Id Component - identifies
              |                        and describes an IOTP Message
              |                        within an IOTP Transaction
              |-Signature Block <----- Signature Block (optional) -
              |  |                     contains one or more Signature
              |  |                     Components and their associated
              |  |                     Certificates
              |  |-Signature Comp. <-- Signature Component - contains
              |  |                     digital signatures. Signatures
              |  |                     may sign digests of the Trans Ref
              |  |                     Block and any Trading Component
              |  |                     in any IOTP Message in the same
              |  |                     IOTP Transaction.
              |  |-Certificate Comp. <-Certificate Component. Used to
              |                        check the signature. (Optional)
      ------> |-Trading Block <--------Trading Block - an XML Element
     |        |  |-Trading Comp.       within an IOTP Message that
   Trading    |  |-Trading Comp.       contains a predefined set of
   Blocks     |  |-Trading Comp.       Trading Components
     |        |  |-Trading Comp.
     |        |  |-Trading Comp. <-----Trading Components - XML Elements
     |        |                        within a Trading Block that
      ------> |-Trading Block          contain a predefined set of XML
              |  |-Trading Comp.       elements and attributes
              |  |-Trading Comp.       containing information required
              |  |-Trading Comp.       to support a Trading Exchange
              |  |-Trading Comp.
              |  |-Trading Comp.
              |
   *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*

                            Figure 16 Trading Blocks
```

거래 블록은 IOTP 메시지 정의의 일부로 정의됩니다\(섹션 3.1.1 참조\). IOTP 메시지 요소의 정의는 여기서 반복됩니다.

```text
   <!ELEMENT IotpMessage
      ( TransRefBlk,
        SigBlk?,
        ErrorBlk?,
        ( AuthReqBlk |
          AuthRespBlk |
          AuthStatusBlk |
          CancelBlk |
          DeliveryReqBlk |
          DeliveryRespBlk |
          InquiryReqBlk |
          InquiryRespBlk |
          OfferRespBlk |
          PayExchBlk |
          PayReqBlk |
          PayRespBlk |
          PingReqBlk |
          PingRespBlk |
          TpoBlk |
          TpoSelectionBlk
        )*
      ) >
```

이 섹션의 나머지 부분에서는 이 IOTP 버전의 거래 블록을 정의합니다. 그들은:

```text
   o  Authentication Request Block

   o  Authentication Response Block

   o  Authentication Status Block

   o  Cancel Block

   o  Delivery Request Block

   o  Delivery Response Block

   o  Error Block

   o  Inquiry Request Block

   o  Inquiry Response Block

   o  Offer Response Block

   o  Payment Exchange Block

   o  Payment Request Block

   o  Payment Response Block

   o  Signature Block

   o  Trading Protocol Options Block

   o  TPO Selection Block
```

트랜잭션 참조 블록은 섹션 3.3에 설명되어 있습니다.

---
## **8.1 Trading Protocol Options Block**

TPO 트레이딩 블록에는 IOTP 거래에 적용되는 옵션이 포함되어 있습니다. TPO 트레이딩 블록의 정의는 다음과 같습니다.

```text
   <!ELEMENT TpoBlk ( ProtocolOptions, BrandList*, Org* ) >
   <!ATTLIST TpoBlk
    ID                 ID      #REQUIRED >

   Attributes:
```

ID IOTP 거래 내에서 거래 프로토콜 옵션 블록을 고유하게 식별하는 식별자입니다\(섹션 3.4 ID 속성 참조\).

```text
   Content:
```

프로토콜 옵션 프로토콜 옵션 구성 요소\(섹션 7.1 참조\)는 전체 IOTP 트랜잭션\(섹션 9 참조\)에 적용되는 옵션을 정의합니다.

BrandList 이 브랜드 목록 구성 요소에는 선택할 수 있는 하나 이상의 결제 브랜드와 프로토콜이 포함되어 있습니다\(섹션 7.7 참조\).

조직 조직 구성 요소\(섹션 7.6 참조\)는 IOTP 트랜잭션에서 조직과 해당 역할을 식별합니다. 존재해야 하는 역할과 조직은 특정 유형의 IOTP 트랜잭션에 따라 달라집니다. 섹션 9. 인터넷 공개 거래 프로토콜 거래에서 각 거래의 정의를 참조하세요.

TPO 블록에는 다음이 포함되어야 합니다.

o 프로토콜 옵션 구성요소

o 판매자의 거래 역할을 가진 조직 구성요소

o 소비자의 거래 역할을 하는 조직 구성요소

o IOTP 트랜잭션에 배송이 포함된 경우 선택적으로 DeliverTo 거래 역할을 가진 조직 구성 요소

o IOTP 거래의 각 결제에 대한 브랜드 목록 구성 요소

o 관련된 모든 결제 처리자를 위한 조직 구성 요소

o 선택적으로 트랜잭션의 배달 처리기\(있는 경우\)에 대한 조직 구성 요소

o 판매자가 포함할 수 있는 추가 조직 구성 요소. 예를 들어

- - 고객 관리 제공자

- - 제공되는 상품이나 서비스에 대해 판매자 "자격 증명" 또는 기타 보증을 제공하는 인증 기관.

---
## **8.2 TPO Selection Block**

TPO 선택 블록에는 거래 프로토콜 옵션 블록\(섹션 8.1 참조\)에 포함된 옵션에서 이루어진 선택 결과가 포함됩니다. TPO 선택 블록의 정의는 다음과 같습니다.

```text
   <!ELEMENT TpoSelectionBlk (BrandSelection+) >
   <!ATTLIST TpoSelectionBlk
    ID                 ID      #REQUIRED >

   Attributes:
```

ID IOTP 트랜잭션 내에서 TPO 선택 블록을 고유하게 식별하는 식별자입니다.

```text
   Content:
```

BrandSelection 이는 IOTP 거래 내에서 결제에 사용할 결제 브랜드 및 결제 프로토콜의 선택을 식별합니다. IOTP 거래에서 이루어지는 각 결제에는 하나의 브랜드 선택 구성 요소\(섹션 7.8 참조\)가 있습니다.

TPO 선택 블록에는 TPO 블록의 각 브랜드 목록에 대해 하나의 브랜드 선택 구성 요소가 포함되어야 합니다.

---
## **8.3 Offer Response Block**

제안 응답 블록에는 발생할 상품, 서비스, 금액, 배송 지침 또는 금융 거래에 대한 세부 정보가 포함됩니다. 그 정의는 다음과 같습니다.

```text
   <!ELEMENT OfferRespBlk (Status, Order?, Payment*,
                Delivery?, TradingRoleData*) >
   <!ATTLIST OfferRespBlk
    ID                 ID      #REQUIRED >

   Attributes:
```

ID IOTP 트랜잭션 내에서 제안 응답 블록을 고유하게 식별하는 식별자입니다.

```text
   Content:
```

상태 비즈니스 성공\(섹션 4.2 참조\) 또는 제안 생성 실패에 대한 상태 정보를 포함합니다. 제안 응답 블록에서 NotYetStarted 또는 InProgress의 ProcessState는 잘못된 값입니다.

주문 주문 구성요소에는 발생하는 상품, 서비스 또는 금융 거래에 대한 세부정보가 포함되어 있습니다\(섹션 7.5 참조\).

- 상태 구성요소의 ProcessState 속성이 실패로 설정되지 않은 경우 주문 구성요소가 있어야 합니다.

결제 결제 구성요소에는 결제에 관한 정보가 포함되어 있습니다\(섹션 7.9 참조\).

배송 배송 구성 요소에는 배송에 대한 세부 정보가 포함됩니다\(섹션 7.13 참조\).

TradingRoleData 거래 역할 데이터 구성 요소에는 IOTP 거래와 관련된 거래 역할 간에 통신해야 하는 불투명 데이터가 포함되어 있습니다\(섹션 7.17 참조\).

제안 응답 블록에는 다음이 포함되어야 합니다.

o IOTP 거래를 위한 주문 구성요소

o IOTP 거래의 각 결제에 대한 결제 구성요소

o IOTP 트랜잭션에 필요한 전달 구성 요소\(있는 경우\).

---
## **8.4 Authentication Request Block**

인증 요청 블록에는 하나의 거래 역할이 다른 거래 역할에 대한 정보를 얻고 선택적으로 인증하는 데 사용하는 데이터가 포함되어 있습니다.

개요에는 다음이 포함됩니다.

o 인증 자체가 수행되는 방법에 대한 정보 및/또는

o 인증되는 조직에 대한 추가 정보 요청.

그 정의는 다음과 같습니다.

```text
   <!ELEMENT AuthReqBlk (AuthReq*, TradingRoleInfoReq?) >
   <!ATTLIST AuthReqBlk
    ID                 ID      #REQUIRED >

   Attributes:
```

ID IOTP 트랜잭션 내에서 인증 요청 블록을 고유하게 식별하는 식별자입니다.

```text
   Content:
```

AuthReq 각 인증 요청\(섹션 7.2 참조\) 구성 요소는 인증 요청 수신자가 인증 응답 구성 요소\(섹션 7.3 참조\)를 생성하여 자신을 인증할 수 있는 대체 방법을 설명합니다.

- 하나의 인증 요청 구성요소가 있는 경우 해당 인증 요청 구성요소를 사용해야 합니다.

- 인증 요청 구성 요소가 두 개 이상 있는 경우 수신자는 수신자 또는 해당 소프트웨어의 개인 선호도에 따라 구성 요소 중 하나를 선택해야 합니다.

- 인증 요청 구성 요소가 없으면 인증 요청 블록이 거래 역할 정보 요청 구성 요소에 지정된 조직 구성 요소의 반환을 요청하고 있음을 의미합니다.

TradingRoleInfoReq 거래 역할 정보 요청 구성 요소\(섹션 7.4 참조\)에는 정보가 요청되는 거래 역할 목록이 포함되어 있습니다.

인증 블록 내에 최소한 하나의 구성요소\(인증 요청 또는 거래 역할 정보 요청\)가 있어야 하며, 그렇지 않으면 오류입니다.

---
## **8.5 Authentication Response Block**

인증 응답 블록에는 인증 요청 블록을 처리한 결과로 얻은 응답이 포함됩니다. 그 정의는 다음과 같습니다.

```text
   <!ELEMENT AuthRespBlk (AuthResp?, Org*) >
   <!ATTLIST AuthRespBlk
    ID                 ID      #REQUIRED >

   Attributes:
```

ID IOTP 트랜잭션 내에서 인증 응답 블록을 고유하게 식별하는 식별자입니다.

```text
   Content:
```

AuthResp 인증 요청 구성 요소 처리 결과를 포함하는 선택적 인증 응답 구성 요소 - 섹션 7.3을 참조하세요.

Org 거래 역할 정보 요청 구성 요소의 TradingRoleList 속성에 의해 요청된 거래 역할에 해당하는 정보를 포함하는 선택적 조직 구성 요소입니다.

인증 응답 블록에 있는 구성 요소는 해당 인증 요청 블록의 요구 사항과 일치해야 하며 그렇지 않으면 오류입니다.

---
## **8.6 Authentication Status Block**

인증 상태 블록은 인증자에 의한 인증 응답 블록 검증의 성공 또는 실패를 나타냅니다. 그 정의는 다음과 같습니다.

```text
   <!ELEMENT AuthStatusBlk (Status) >
   <!ATTLIST AuthStatusBlk
    ID                 ID      #REQUIRED >

   Attributes:
```

ID IOTP 트랜잭션 내에서 인증 상태 블록을 고유하게 식별하는 식별자입니다.

```text
   Content:

   Status             Contains status information about the business
                      success (see section 4.2) or failure of the
                      authentication
```

---
## **8.7 Payment Request Block**

결제 요청 블록에는 결제 시작을 요청하는 정보가 포함됩니다. 그 정의는 다음과 같습니다.

```text
   <!ELEMENT PayReqBlk (Status+, BrandList, BrandSelection,
        Payment, PaySchemeData?, Org*, TradingRoleData*) >
   <!ATTLIST PayReqBlk
    ID                 ID      #REQUIRED >

   Attributes:
```

ID IOTP 트랜잭션 내에서 지불 요청 블록을 고유하게 식별하는 식별자입니다.

```text
   Content:

   Status             Contains the Status Components (see section 7.13)
                      of the responses of the steps (e.g., an Offer
                      Response and/or a Payment Response) on which this
```

- 단계에 따라 다릅니다. 해당 단계의 성공 또는 실패를 나타내는 데 사용됩니다. 이전 단계가 성공한 경우에만 결제가 이루어져야 합니다.

브랜드 목록 브랜드 목록 구성 요소에는 선택할 수 있는 하나 이상의 결제 브랜드 및 프로토콜 목록이 포함되어 있습니다\(섹션 7.7 참조\).

BrandSelection 이는 IOTP 거래 내에서 결제에 사용할 결제 브랜드, 결제 프로토콜 및 결제 핸들러의 선택을 식별합니다. IOTP 거래에서 이루어지는 각 결제에는 하나의 브랜드 선택 구성 요소\(섹션 7.8 참조\)가 있습니다.

결제 결제 구성요소에는 진행 중인 결제에 대한 정보가 포함되어 있습니다\(섹션 7.9 참조\).

PaySchemeData 지불 체계 구성 요소에는 지불 체계별 데이터가 포함되어 있습니다\(섹션 7.10 참조\).

조직 조직 구성 요소에는 지불과 관련된 조직의 세부 정보가 포함됩니다\(섹션 7.6 참조\). 존재하는 조직은 IOTP 트랜잭션과 서명할 데이터에 따라 달라집니다. 자세한 내용은 섹션 6 디지털 서명을 참조하십시오.

TradingRoleData 거래 역할 데이터 구성 요소에는 IOTP 거래와 관련된 거래 역할 간에 통신해야 하는 불투명 데이터가 포함되어 있습니다\(섹션 7.17 참조\).

지불 요청 블록에는 다음이 포함되어야 합니다.

o 판매자의 거래 역할을 가진 조직 구성요소

o 소비자의 거래 역할을 하는 조직 구성요소

o 지불을 위한 지불 구성요소

o 지불을 위한 브랜드 목록 구성요소

o 브랜드 목록의 브랜드 선택 구성요소

o 지불의 지불 핸들러를 위한 조직 구성요소

o 이전 단계를 수행한 조직에 대한 조직 구성 요소\(있는 경우\)\(예: 다른 결제 처리자\)

o 다음 단계를 수행할 조직의 조직 구성요소\(있는 경우\). 예를 들어 배달 핸들러 또는 결제 핸들러가 될 수 있습니다.

o 판매자가 제안 응답 블록에 포함시킨 추가 조직에 대한 조직 구성 요소

o 지불 방법에 대한 IOTP 보충 문서에 정의된 대로 지불 방법에 의해 요구되는 경우 선택적 지불 체계 데이터 구성요소

o 필요할 수 있는 거래 역할 데이터 구성요소\(섹션 7.17.1 참조\).

---
## **8.8 Payment Exchange Block**

지불 교환 블록에는 거래에서 두 역할 간에 교환되는 지불 체계별 데이터가 포함되어 있습니다. 그 정의는 다음과 같습니다.

```text
   <!ELEMENT PayExchBlk (PaySchemeData+) >
   <!ATTLIST PayExchBlk
    ID                 ID      #REQUIRED >

   Attributes:
```

ID IOTP 거래 내에서 지불 교환 블록을 고유하게 식별하는 식별자입니다.

```text
   Content:
```

PaySchemeData 이 거래 구성요소에는 지불 체계별 데이터가 포함되어 있습니다\(섹션 7.10 지불 체계 구성요소 참조\).

---
## **8.9 Payment Response Block**

이 지불 응답 블록에는 지불 상태, 선택적 지불 영수증 및 선택적 지불 프로토콜 메시지에 대한 정보가 포함됩니다. 그 정의는 다음과 같습니다.

```text
   <!ELEMENT PayRespBlk (Status, PayReceipt?, PaySchemeData?,
        PaymentNote?, TradingRoleData*) >
   <!ATTLIST PayRespBlk
    ID                 ID      #REQUIRED >

   Attributes:
```

ID IOTP 트랜잭션 내에서 결제 응답 블록을 고유하게 식별하는 식별자입니다.

```text
   Content:
```

상태 비즈니스 성공\(섹션 4.2 참조\) 또는 결제 실패에 대한 상태 정보가 포함됩니다. 지불 응답 블록에서 NotYetStarted 또는 InProgress의 ProcessState는 잘못된 값입니다.

PayReceipt 결제가 이루어졌는지 확인하는 데 사용할 수 있는 결제 체계별 데이터가 포함되어 있습니다. 섹션 7.11 지불 영수증 구성요소를 참조하십시오. 상태 구성 요소의 ProcessState 특성이 CompletedOk로 설정된 경우 존재해야 합니다. PayReceipt는 해당 지불 체계 보충 항목에 지정된 대로 다른 값에 대해서는 선택 사항입니다.

PaySchemeData 결제 프로토콜 메시지와 같은 결제 체계별 데이터\(섹션 참조\)가 포함되어 있습니다. 7.10 지불 체계 구성요소를 참조하십시오.

PaymentNote 결제와 관련된 추가 내용이 포함되어 있습니다.

- 결제 처리자가 소비자에게 제공하려는 정보. 예를 들어, 인출 또는 입금이 이루어진 경우 이체 완료 후 계정의 남은 잔액에 대한 정보가 포함될 수 있습니다. 섹션 7.12 지불 메모 구성요소를 참조하십시오.

TradingRoleData 거래 역할 데이터 구성 요소에는 IOTP 거래와 관련된 거래 역할 간에 통신해야 하는 불투명 데이터가 포함되어 있습니다\(섹션 7.17 참조\).

---
## **8.10 Delivery Request Block**

배송 요청 블록에는 배송이 승인되었는지 확인하는 데 사용할 수 있는 서명과 함께 배송될 상품 또는 서비스에 대한 세부 정보가 포함되어 있습니다. 그 정의는 다음과 같습니다.

```text
   <!ELEMENT DeliveryReqBlk (Status+, Order, Org*, Delivery,
        ConsumerDeliveryData?, TradingRoleData*) >
   <!ATTLIST DeliveryReqBlk
    ID                 ID      #REQUIRED >

   Attributes:
```

ID IOTP 트랜잭션 내에서 배달 요청 블록을 고유하게 식별하는 식별자입니다.

```text
   Content:
```

상태 이 단계가 종속된 단계 응답\(예: 지불 응답\)의 상태 구성 요소\(섹션 7.13 참조\)를 포함합니다. 해당 단계의 성공 또는 실패를 나타내는 데 사용됩니다. 이전 단계가 성공한 경우에만 배송이 이루어져야 합니다.

주문 주문 구성요소에는 발생하는 상품, 서비스 또는 금융 거래에 대한 세부정보가 포함되어 있습니다\(섹션 7.5 참조\).

- 조직 구성 요소\(섹션 7.6 참조\)는 IOTP 트랜잭션 조직에서 조직과 해당 역할을 식별합니다. 존재해야 하는 역할과 조직은 특정 유형의 IOTP 트랜잭션에 따라 달라집니다. 섹션 9. 인터넷 공개 거래 프로토콜 거래에서 각 거래의 정의를 참조하세요.

배송 배송 구성 요소에는 배송에 대한 세부 정보가 포함됩니다\(섹션 7.13 참조\).

ConsumerDeliveryData 선택사항. 소비자가 지정한 식별자가 포함되어 있으며, 배달 핸들러가 반환한 경우 소비자는 어떤 배달이 참조되고 있는지 식별할 수 있습니다.

TradingRoleData 거래 역할 데이터 구성 요소에는 IOTP 거래와 관련된 거래 역할 간에 통신해야 하는 불투명 데이터가 포함되어 있습니다\(섹션 7.17 참조\).

배달 요청 블록에는 다음이 포함됩니다.

o 판매자의 거래 역할을 가진 조직 구성요소

o 소비자 및 DeliverTo 거래 역할을 위한 조직 구성요소

o 배송을 위한 배송 구성요소

o 배달 처리기를 위한 조직 구성요소. 특히 전달 구성 요소의 ActionOrgRef 속성으로 식별되는 조직 구성 요소

o 이전 단계를 수행한 조직에 대한 조직 구성 요소\(있는 경우\)\(예: 결제 처리자\)

o 판매자가 제안 응답 블록에 포함시킨 추가 조직에 대한 조직 구성 요소

o 필요할 수 있는 거래 역할 데이터 구성요소\(섹션 7.17.1 참조\).

---
## **8.11 Delivery Response Block**

배송 응답 블록에는 상품 배송 방법에 대한 세부 정보가 포함된 배송 메모가 포함되어 있습니다. 그 정의는 다음과 같습니다. 배달 응답 블록에서 DeliveryStatusCode가 NotYetStarted 또는 InProgress인 배달 상태 요소는 유효하지 않습니다.

```text
   <!ELEMENT DeliveryRespBlk (Status, DeliveryNote) >
   <!ATTLIST DeliveryRespBlk
    ID                 ID      #REQUIRED >

   Attributes:
```

ID IOTP 트랜잭션 내에서 배달 응답 블록을 고유하게 식별하는 식별자입니다.

```text
   Content:
```

상태 비즈니스 성공\(섹션 4.2 참조\) 또는 전달 실패에 대한 상태 정보가 포함됩니다. 배달 응답 블록에서 NotYetStarted 또는 InProgress의 ProcessState는 잘못된 값입니다.

배송 노트 배송 노트 구성 요소에는 상품이나 서비스가 배송되는 방법에 대한 세부 정보가 포함되어 있습니다\(섹션 7.15 참조\).

---
## **8.12 Inquiry Request Trading Block**

조회 요청 거래 블록에는 조회 유형 구성요소와 결제 체계별 조회 메시지를 포함하는 선택적 결제 체계 구성요소가 포함되어 있습니다.

```text
   <!ELEMENT InquiryReqBlk ( InquiryType, PaySchemeData? ) >
   <!ATTLIST InquiryReqBlk
    ID                 ID      #REQUIRED >

   Attributes:
```

ID IOTP 거래 내에서 조회 요청 거래 블록을 고유하게 식별하는 식별자입니다.

```text
   Content:
```

InquiryType 문의 유형을 포함하는 문의 유형 구성 요소\(섹션 7.18 참조\)입니다.

지불 문의에 대한 지불 체계별 문의 메시지를 포함하는 PaySchemeData 지불 체계 구성 요소\(섹션 7.10 참조\). 이는 조회 유형 구성요소의 유형 속성이 결제인 경우에 나타납니다.

---
## **8.13 Inquiry Response Trading Block**

문의 응답 거래 블록에는 상태 구성 요소와 지불 체계별 문의 메시지를 포함하는 선택적 지불 체계 구성 요소가 포함되어 있습니다. 그 목적은 서버에서 IOTP 트랜잭션의 현재 상태를 조회하는 것입니다.

```text
   <!ELEMENT InquiryRespBlk (Status, PaySchemeData?) >
   <!ATTLIST InquiryRespBlk
    ID                 ID      #REQUIRED
    LastReceivedIotpMsgRef NMTOKEN #IMPLIED
    LastSentIotpMsgRef  NMTOKEN #IMPLIED >

   Attributes:
```

ID IOTP 트랜잭션 내에서 문의 응답 거래 블록을 고유하게 식별하는 식별자입니다.

LastReceivedIotpMsgRef는 이 서버가 소비자로부터 받은 마지막 메시지의 메시지 ID 구성 요소\(섹션 3.3.2 참조\)에 대한 요소 참조\(섹션 3.5 참조\)를 포함합니다. 해당 트랜잭션에서 Consumer로부터 이전에 수신한 메시지가 없는 경우 이 속성에는 Null 값이 포함되어야 합니다. 이 속성은 디버깅 목적으로 존재합니다.

LastSentIotpMsgRef에는 이 서버가 소비자에게 보낸 마지막 메시지의 메시지 ID 구성 요소\(섹션 3.3.2 참조\)에 대한 요소 참조\(섹션 3.5 참조\)가 포함되어 있습니다. 해당 트랜잭션에서 이전에 소비자에게 보낸 메시지가 없는 경우 이 속성에는 Null 값이 포함되어야 합니다. 이 속성은 디버깅 목적으로 존재합니다.

```text
   Content:
```

상태 비즈니스 성공\(섹션 4.2 참조\) 또는 특정 거래 교환\(예: 제안, 지불 또는 배송\) 실패에 대한 상태 정보가 포함됩니다.

지불 문의에 대한 지불 체계별 문의 메시지를 포함하는 PaySchemeData 지불 체계 구성 요소\(섹션 7.10 참조\). 이는 상태 구성 요소의 StatusType 속성 중 Type 속성이 Payment로 설정된 경우에 나타납니다.

---
## **8.14 Ping Request Block**

Ping 요청 블록은 서버가 작동 중인지, 암호화가 호환되는지 여부를 확인하는 데 사용됩니다.

Ping 요청 블록의 정의는 다음과 같습니다.

```text
   <!ELEMENT PingReqBlk (Org*)>
   <!ATTLIST PingReqBlk
    ID                 ID      #REQUIRED>

   Attributes:
```

ID IOTP 트랜잭션 내에서 Ping 요청 거래 블록을 고유하게 식별하는 식별자입니다.

```text
   Content:

   Org                Optional Organisation Components (see section
                      7.6).
```

- 조직 구성 요소가 없으면 Ping 요청은 익명이며 서버가 작동 중인지 확인합니다.

- 그러나 조직 구성 요소가 있는 경우 Ping 요청 보낸 사람이 디지털 서명을 처리할 수 있는지 확인하려고 함을 나타냅니다.

이 경우 발신자에게는 다음이 포함됩니다.

- o IOTP 거래\(가맹점, 결제 처리자 등\)에서 수행하는 거래 역할을 지정하여 자신을 식별하는 조직 구성 요소. o 메시지의 의도된 수신자를 식별하는 조직 구성 요소.

- 그런 다음 Ping 응답 블록을 통해 서명을 생성하는 데 사용됩니다.

---
## **8.15 Ping Response Block**

핑 응답 트레이딩 블록은 핑 요청의 결과를 제공합니다.

여기에는 Ping 응답의 보낸 사람을 식별하는 조직 구성 요소가 포함되어 있습니다.

이 블록이 응답인 Ping 요청에 조직 구성 요소가 포함된 경우 해당 조직 구성 요소도 포함됩니다.

```text
   <!ELEMENT PingRespBlk (Org+)>
   <!ATTLIST PingRespBlk
    ID                 ID      #REQUIRED
    PingStatusCode (Ok | Busy | Down) #REQUIRED
    SigVerifyStatusCode (Ok | NotSupported | Fail) #IMPLIED
    xml:lang           NMTOKEN #IMPLIED
    PingStatusDesc     CDATA   #IMPLIED>

   Attributes:
```

ID IOTP 트랜잭션 내에서 Ping 요청 거래 블록을 고유하게 식별하는 식별자입니다.

PingStatusCode IOTP 메시지를 처리하는 발신자 소프트웨어의 상태를 표시하는 코드가 포함되어 있습니다. 유효한 값은 다음과 같습니다. o 좋습니다. 서명 확인을 포함하여 서비스의 모든 것이 정상적으로 작동합니다. o 바빠요. 정상적으로 작동하고 있지만 약간의 지연이 있을 수 있습니다. 오 다운. 서버가 완전히 작동하지 않지만 여전히 Ping 응답을 제공할 수 있습니다.

SigVerifyStatusCode 서명 확인 상태를 표시하는 코드가 포함되어 있습니다. 이는 Ping 요청 블록이 포함된 메시지에 서명 블록도 포함된 경우에만 나타납니다. 유효한 값은 다음과 같습니다. o 좋습니다. 서명이 성공적으로 확인되었으며 호환성이 입증되었습니다. o 지원되지 않음 이 Ping 요청 블록의 수신자는 서명 검증을 지원하지 않습니다. o 실패. 서명 검증 실패.

Xml:lang PingStatusDesc에 사용되는 언어를 정의합니다. 이는 PingStatusDesc가 있을 때 나타납니다.

```text
   PingStatusDesc       Contains a short description of the status of
                        the server which sends this Ping Response Block.
                        Servers, if their designers want, can use this
```

좀 더 정제된 상태를 전송하는 속성

- 예를 들어 디버깅 목적으로 사용할 수 있는 PingStatusCode 이외의 정보.

```text
   Content:
```

조직 조직 구성 요소입니다\(섹션 7.6 참조\).

- Ping 응답을 보낸 사람의 조직 구성 요소는 Ping 요청에 전송된 조직 구성 요소에 추가로 항상 포함됩니다.

참고: Ping 상태 코드 값에는 실패와 같은 값이 포함되지 않습니다. Ping 요청 메시지를 수신하는 소프트웨어가 전혀 작동하지 않으면 Ping 응답 메시지가 다시 전송되지 않기 때문입니다.

---
## **8.16 Signature Block**

서명 블록에는 IOTP 트랜잭션과 관련된 데이터에 서명하는 하나 이상의 서명 구성 요소 및 관련 인증서\(필요한 경우\)가 포함되어 있습니다. IOTP가 서명을 사용하는 방법에 대한 일반적인 논의 및 소개는 섹션 6 디지털 서명을 참조하세요. 서명 구성 요소 및 인증서의 정의는 "인터넷 개방형 거래 프로토콜에 대한 디지털 서명" 문서에 포함되어 있습니다. \[IOTPDSIG\]를 참조하세요. IOTP에서 이러한 기능을 사용하는 방법에 대한 설명은 섹션 7.19 및 7.20에 포함되어 있습니다.

서명 블록의 정의는 다음과 같습니다.

```text
   <!ELEMENT IotpSignatures (Signature+, Certificate*) >
   <!ATTLIST IotpSignatures
     ID                ID      #IMPLIED >

   Attributes:
```

ID IOTP 트랜잭션 내에서 서명 블록을 고유하게 식별하는 식별자입니다.

```text
   Content:
```

서명 서명 구성 요소. 섹션 7.19를 참조하세요.

인증서 인증서 구성 요소입니다. 섹션 7.20을 참조하세요.

서명 블록의 내용은 서명 블록과 동일한 IOTP 메시지에 포함된 거래 블록에 따라 다릅니다.

---
### **8.16.1 Signature Block with Offer Response**

제안 응답 블록과 동일한 메시지에 있는 서명 블록에는 제안 응답 서명 구성 요소만 포함됩니다\(섹션 7.19.2 참조\).

---
### **8.16.2 Signature Block with Payment Request**

지불 요청 블록과 동일한 메시지에 있는 서명 블록에는 다음이 포함됩니다.

o 제안 응답 서명 구성요소\(섹션 7.19.2 참조\), 그리고

o 지불이 이전 단계에 종속된 경우\(지불 구성 요소의 StartAfter 속성에 표시됨\) 이전 단계에서 생성된 지불 영수증 서명 구성 요소\(섹션 7.19.3 참조\)

---
### **8.16.3 Signature Block with Payment Response**

- 지불 응답 블록과 동일한 메시지에 있는 서명 블록에는 단계에서 생성된 지불 영수증 서명 구성 요소\(섹션 7.19.3 참조\)만 포함됩니다.

---
### **8.16.4 Signature Block with Delivery Request**

- 배달 요청 블록과 동일한 메시지에 있는 서명 블록에는 다음이 포함됩니다.

o 제안 응답 서명 구성요소\(섹션 7.19.2 참조\), 그리고

o 이전 단계에서 생성된 지불 영수증 서명 구성요소\(섹션 7.19.3 참조\).

---
### **8.16.5 Signature Block with Delivery Response**

배달 응답 블록과 동일한 메시지에 있는 서명 블록에는 단계에서 생성된 배달 응답 서명 구성 요소\(섹션 7.19.4 참조\)만 포함됩니다.

---
## **8.17 Error Block**

오류 거래 블록에는 거래에 관련된 거래 역할 중 하나가 수신한 IOTP 메시지의 기술적 오류\(섹션 4.1 참조\)에 대한 정보가 포함된 하나 이상의 오류 구성 요소\(섹션 7.21 참조\)가 포함되어 있습니다.

명확성을 위해 오류 거래 블록 설명에 사용되는 두 가지 문구가 정의됩니다.

o 메시지에 오류가 있습니다. 어떤 종류의 오류를 포함하거나 발생시키는 IOTP 메시지

o 오류를 보고하는 메시지입니다. 오류 메시지에서 발견된 오류를 설명하는 오류 거래 블록이 포함된 IOTP 메시지입니다.

오류 거래 블록은 오류를 보고하는 모든 메시지에 포함될 수 있습니다. 이후에 수행되는 조치는 오류의 심각도에 따라 달라집니다. 다양한 유형의 심각도와 그에 따라 발생할 수 있는 작업에 대한 설명은 오류 구성 요소의 정의를 참조하세요.

in3 참고: 오류 거래 블록은 여러 오류 구성 요소를 사용하여 여러 가지 오류를 보고할 수 있지만 IOTP 인식 응용 프로그램 개발자가 그렇게 할 의무는 없습니다.

오류 거래 블록의 구조는 다음과 같습니다.

```text
   <!ELEMENT ErrorBlk (ErrorComp+, PaySchemeData*) >
   <!ATTLIST ErrorBlk
    ID                 ID      #REQUIRED >

   Attributes:
```

ID IOTP 거래 내에서 오류 거래 블록을 고유하게 식별하는 식별자입니다.

```text
   Content:
```

ErrorComp 개별 기술 오류에 대한 정보가 포함된 오류 구성 요소\(섹션 7.21 참조\)입니다.

```text
   PaySchemeData      An optional Payment Scheme Component (see section
                      7.10) which contains a Payment Scheme Message. See
                      the appropriate payment scheme supplement to
```

- 이 구성 요소가 있어야 하는지 여부와 포함해야 하는 내용을 정의합니다.

---
## **8.18 Cancel Block**

취소 블록은 거래가 취소되었음을 다른 거래 역할에 알리기 위해 한 거래 역할에서 사용됩니다. 사용 예는 다음과 같습니다.

o 비소비자 역할에게 더 이상 거래를 계속할 계획이 없음을 알리는 소비자 역할. 이를 통해 서버는 시간 초과가 발생할 때까지 기다리지 않고 트랜잭션을 깔끔하게 종료할 수 있습니다.

o 트랜잭션이 중지되고 있음을 소비자 역할에 알리는 비소비자 역할. 이 경우 소비자는 원본을 받지 못했다고 잘못 이해하여 전송된 이전 메시지를 다시 보낼 가능성이 없습니다.

그 정의는 다음과 같습니다.

```text
   <!ELEMENT CancelBlk (Status) >
   <!ATTLIST CancelBlk
    ID                 ID      #REQUIRED >

   Attributes:
```

ID IOTP 트랜잭션 내에서 취소 블록을 고유하게 식별하는 식별자입니다.

```text
   Content:
```

상태 IOTP 트랜잭션이 취소되었음을 나타내는 상태 정보가 포함됩니다.

---
## **9. Internet Open Trading Protocol Transactions**

Baseline Internet Open Trading Protocol은 다양한 목적을 위해 세 가지 유형의 거래를 지원합니다. 이것들은

o 거래에서 한 당사자의 다른 당사자 인증을 지원하고/하거나 다른 거래 역할에 대한 정보를 요청하는 인증 IOTP 트랜잭션

o 하나 이상의 지불이 포함된 IOTP 거래. 구체적으로:

```text
      -  Deposit

      -  Purchase

      -  Refund

      -  Withdrawal, and

      -  Value Exchange
```

o IOTP 인프라의 올바른 기능을 확인하도록 설계된 IOTP 트랜잭션. 구체적으로:

```text
      -  Transaction Status Inquiry, and

      -  Ping
```

인증 IOTP 트랜잭션은 자체적으로 작동할 수 있지만 선택적으로 인증은 "지불" 트랜잭션보다 우선할 수 있습니다. 따라서 이 섹션의 나머지 부분은 다음을 다루는 두 부분으로 나뉩니다.

```text
   o  Authentication and Payment transactions (Authentication, Deposit,
      Purchase, Refund, Withdrawal and Value Exchange)
```

o 거래가 성공했는지 또는 거래 역할의 서버가 올바르게 작동하는지에 대한 조회를 지원하도록 설계된 인프라 거래\(거래 상태 조회 및 핑\), 그리고

---
## **9.1 Authentication and Payment Related IOTP Transactions**

- 인증 및 결제 관련 IOTP 거래는 6개의 문서 교환으로 구성되며, 이는 특정 거래를 구현하기 위해 순서대로 결합됩니다.

- 일반적으로 문서 교환소와 무역 교환소 사이에는 밀접하지만 정확하지는 않은 통신이 있습니다. 주요 차이점은 일부 문서 교환은 인터넷을 통해 전송되어야 하는 실제 IOTP 메시지 수를 최소화하기 위해 두 개의 거래 교환 중 일부 또는 전체를 동시에 구현한다는 것입니다.

- 6개의 문서 교환은 다음과 같습니다.

o 인증. 이는 다음을 직접 구현한 것입니다.

- 인증거래소

o 브랜드에 따른 제안. 이것은 지불 거래 거래소의 브랜드 선택 부분과 결합된 제안 거래 거래소입니다. 그 목적은 판매자에게 선택한 브랜드에 대한 정보를 제공하여 제안 응답의 내용을 적절하게 조정하는 것입니다.

o 브랜드 독립적인 제안. 이것은 또한 제안 거래 교환입니다. 그러나 이 경우 제안 응답의 내용은 선택한 브랜드에 따라 달라지지 않습니다.

o 지불. 이것은 지불 거래 거래소의 지불 부분을 직접 구현한 것입니다.

o 배송. 이는 배달 교환을 직접 구현한 것입니다.

o 결제 후 배송. 결제와 배송을 ​​결합한 거래 거래소를 구현한 것입니다.

이러한 문서 교환은 서로 다른 순서로 결합되어 각 IOTP 트랜잭션을 구현합니다. 이들이 결합되는 방식은 아래 다이어그램에 설명되어 있습니다.

```text
   *+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*

     START -----------------------------------------------------
      |                                                         v
      |                                                ----------------
      |                                               | AUTHENTICATION |
      |                                                ----------------
       --------------------------------------               |    |
                       |                     |              |    |
                       |      -------------- | -------------     |
                       v      v              v      v            |
                  -------------------     -----------------      |
                 | BRAND INDEPENDENT |   | BRAND DEPENDENT |     |
                 |       OFFER       |   |      OFFER      |     |
                  -------------------     -----------------      |
                        |    |                   |   |           |
                        |     ---------------    |   |           |
                        |                    |   |   |           |
                        |     -------------- | --    |           |
                        v    v               v       v           |
                      ---------           --------------         |
                     | PAYMENT |         | PAYMENT WITH |        |
                     | (first) |         |   DELIVERY   |        |
                      ---------           --------------         |
                          |                      |               |
              -----------------------------      |               |
              v                v           |     |               |
         ----------        ---------       |     |               |
        | DELIVERY |      | PAYMENT |      |     |               |
        |          |      | {second)|      |     |               |
         ----------        ---------       |     |               |
              |                |           |     |               v
               ----------------------------------------------> STOP

   *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
```

- 그림 17 결제 및 인증 메시지 흐름 조합

유효한 문서 교환 조합은 특정 IOTP 트랜잭션에 따라 다릅니다.

이 하위 섹션의 나머지 부분에서는 다음을 설명합니다.

o 문서 교환의 각 거래 블록 내용에 대한 설명을 포함하여 각 문서 교환에 대한 자세한 내용, 그리고

o 각 IOTP 트랜잭션이 문서 교환을 사용하여 원하는 결과를 얻는 방법에 대한 설명.

참고: 다음 문서 교환 설명에서는 다양한 비즈니스 오류\(섹션 4.2 참조\)가 처리되는 방식을 설명합니다. 그러나 기술적 오류\(섹션 4.1 참조\) 처리에 대해서는 언급하지 않습니다. 이는 메시지가 전송되는 상황에 관계없이 동일한 방식으로 처리되기 때문입니다. 자세한 내용은 섹션 4를 참조하세요.

---
### **9.1.1 Authentication Document Exchange**

인증 문서 교환은 인증 거래 교환을 직접 구현한 것입니다\(섹션 2.2.4 참조\). 여기에는 다음이 포함됩니다.

o 인증자 - 인증을 요청하는 조직, 그리고

o 인증 대상자 - 인증되는 조직입니다.

인증은 다음으로 구성됩니다.

o 인증자가 인증 대상자에게 전송하는 인증 요청,

o 인증 응답이 그 대가로 전송됩니다.

- 인증자에게 인증 대상을 확인한 다음 확인합니다.

o 인증의 성공 또는 실패에 대한 표시를 제공하기 위해 인증자가 인증 대상에게 보내는 인증 상태.

인증 문서 교환은 또한 다음을 수행합니다.

o 인증자를 설명하는 조직 구성 요소를 인증 대상자에게 제공합니다.

o 선택적으로 인증 대상자를 설명하는 조직 구성요소를 인증자에게 제공합니다.

인증 요청은 인증 대상자가 인증자의 자격 증명을 확인할 수 있도록 디지털 서명될 수도 있습니다.

관련된 IOTP 메시지는 아래 다이어그램에 설명되어 있습니다.

\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+ \*+\*+\*+\*+\*+\*+\*+\*+\*+\* 조직 1\(인증 대상자\) | 조직 2 | \(인증자\)
단계 | | 1. 첫 번째 조직은 조직의 인증을 요구하는 조치\(예: HTML 페이지의 버튼 누르기\)를 수행합니다.

```text
     1 --> 2 Authentication Need (outside scope of IOTP)
```

2. 두 번째 조직은 하나 이상의 인증 요청 구성 요소 및/또는 거래 역할 정보 요청 구성 요소를 포함하는 인증 요청 블록을 생성한 다음 이를 첫 번째 조직으로 보냅니다.

```text
     1 <-- 2 TPO & AUTHENTICATION REQUEST. IotpMsg: Trans Ref Block;
             Signature Block (optional); TPO Block; Auth Request Block
```

3. IOTP 인식 애플리케이션이 시작되었습니다. 서명 블록이 있는 경우 첫 번째 조직은 이를 사용하여 두 번째 조직의 자격 증명을 확인할 수 있습니다. 자격 증명이 정상이면 첫 번째 조직은 사용할 인증 요청\(있는 경우 둘 이상\)을 선택한 다음 선택한 인증 알고리즘을 사용하여 인증 응답 블록을 생성합니다. 존재하는 경우 거래 역할 정보 요청 구성요소는 조직 구성요소를 생성하는 데 사용됩니다. 마지막으로 필요한 경우 서명 구성 요소가 생성되고 모든 구성 요소는 검증을 위해 두 번째 조직으로 다시 전송됩니다.

```text
     1 --> 2 AUTHENTICATION RESPONSE. IotpMsg; Trans Ref Block;
             Signature Block (optional) ; Auth Response Block
```

4. 두 번째 조직은 인증 요청 블록의 데이터에 대해 인증 응답을 확인하여 첫 번째 조직이 자신이 누구인지 확인하고 인증 상태 블록을 첫 번째 조직에 보내 결과를 표시한 다음 중지합니다.

```text
     1 <-- 2 AUTHENTICATION STATUS. IotpMsg: Trans Ref Block;
             Signature Block (optional); Auth Response Block
```

5. 첫 번째 조직은 인증 상태 차단을 확인하고 선택적으로 기록 보관 목적으로 IOTP 트랜잭션에 대한 정보를 보관하고 중지합니다.

```text
 *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*

                 Figure 18 Authentication Document Exchange
```

---
#### **9.1.1.1 Message Processing Guidelines**

TPO 및 인증 요청 IOTP 메시지\(아래 참조\)를 수신하면 인증 대상자는 다음 중 하나를 수행할 수 있습니다.

o 인증 응답 IOTP 메시지를 생성하여 인증자에게 다시 보냅니다. 또는

o StatusType이 인증이고 ProcessState가 실패이고 CompletionCode\(섹션 7.16.4 참조\)가 AutEeCancel, NoAuthReq, TradRolesIncon으로 설정된 상태 구성 요소를 포함하는 인증자에게 취소 블록을 다시 전송하여 인증 요청 준수 실패를 나타냅니다. 또는 지정되지 않음.

인증 응답 IOTP 메시지\(아래 참조\)를 수신하면 인증자는 StatusType이 인증으로 설정된 상태 구성 요소가 있는 상태 블록을 포함하는 인증 상태 IOTP 메시지\(아래 참조\)를 반환하여 보내야 합니다.

o 상태 구성요소의 ProcessState 속성은 성공적인 완료를 나타내는 CompletedOk로 설정됩니다. 또는

o ProcessState 속성은 Failed로 설정되고 CompletionCode 속성은 실패한 인증을 나타내는 AutOrCancel, AuthFailed 또는 Unspecified로 설정됩니다.

인증 상태 IOTP 메시지\(아래 참조\)를 수신하면 인증 대상자는 상태 블록에서 상태 구성 요소를 확인해야 합니다. 이것이 다음을 나타내는 경우:

o 인증이 성공하면 인증 대상자는 다음 중 하나를 수행해야 합니다.

- - 인증 문서 교환이 포함된 IOTP 트랜잭션의 다음 단계를 계속 진행합니다\(있는 경우\).

- - StatusType이 인증이고 ProcessState가 Failed이며 CompletionCode\(섹션 7.16.4 참조\)가 다음으로 설정된 상태 구성 요소가 포함된 취소 블록을 인증자에게 다시 전송하여 IOTP 트랜잭션의 나머지 부분을 계속할 수 없음을 나타냅니다. 자동취소.

o 인증이 실패하면 인증 대상자에게 실패가 보고되고 추가 처리가 중지됩니다.

인증자가 소비자로부터 취소 블록이 포함된 IOTP 메시지를 받으면 인증 대상자는 거래 프로토콜 옵션 블록에 포함된 인증자에 대한 조직 구성 요소의 거래 역할 요소에 지정된 CancelNetLocn으로 이동할 수 있습니다.

---
#### **9.1.1.2 TPO & Authentication Request IOTP Message**

트랜잭션 참조 블록\(섹션 3.3 참조\) 외에도 이 메시지는 다음으로 구성됩니다.

```text
   o a Trading Protocol Options Block (see section 8.1)
```

o 인증 요청 블록\(섹션 8.4 참조\), 그리고

o 선택적 서명 블록\(섹션 8.16 참조\).

이들 각각은 아래에 설명되어 있습니다.

```text
   TRADING PROTOCOL OPTIONS BLOCK
```

거래 프로토콜 옵션 블록\(섹션 8.1 참조\)에는 다음 거래 구성요소가 포함되어야 합니다.

o 전체 인증 문서 교환에 적용되는 옵션을 정의하는 하나의 프로토콜 옵션 구성요소\(섹션 7.1 참조\).

o 인증자를 설명하는 하나의 조직 구성 요소\(섹션 7.6 참조\). 조직 구성요소의 거래 역할은 인증자가 거래에서 수행하는 역할\(예: 판매자 또는 소비자\)을 나타내야 합니다.

```text
   AUTHENTICATION REQUEST BLOCK
```

인증 요청 블록\(섹션 8.4 참조\)에는 다음 거래 구성요소가 포함되어야 합니다.

```text
   o  one Authentication Request Component (see section 7.2), and

   SIGNATURE BLOCK (AUTHENTICATION REQUEST)
```

인증 요청이 디지털 서명되는 경우 서명 블록이 포함되어야 합니다. 여기에는 다음 XML 요소의 다이제스트가 포함되어 있습니다.

o IOTP 메시지 및 IOTP 트랜잭션을 설명하는 정보가 포함된 IOTP 메시지에 대한 트랜잭션 참조 블록\(섹션 3.3 참조\)

o IOTP 트랜잭션을 전역적으로 고유하게 식별하는 트랜잭션 ID 구성 요소\(섹션 3.3.1 참조\)

o TPO 블록의 다음 구성요소:

- - 프로토콜 옵션 구성요소

- - 조직 구성요소

o 인증 요청 블록의 다음 구성요소:

- - 인증 요청 구성요소

- - 거래 역할 정보 요청 구성요소

---
#### **9.1.1.3 Authentication Response IOTP Message**

트랜잭션 참조 블록\(섹션 3.3 참조\) 외에도 이 메시지는 다음으로 구성됩니다.

o 인증 응답 블록\(섹션 8.5 참조\), 그리고

o 선택적 서명 블록\(섹션 8.16 참조\).

이들 각각은 아래에 설명되어 있습니다.

```text
   AUTHENTICATION RESPONSE BLOCK
```

인증 응답 블록에는 다음 거래 구성요소가 포함되어야 합니다.

```text
   o  one Authentication Response Component (see section 7.3)
```

o 인증 요청 블록에 포함된 거래 역할 정보 요청 구성 요소의 TradingRoleList 속성에서 식별된 모든 거래 역할에 대한 하나의 조직 구성 요소.

```text
   SIGNATURE BLOCK (AUTHENTICATION RESPONSE)
```

인증 요청 블록에 포함된 인증 요청 구성 요소 내의 알고리즘 요소\(섹션 12. IANA 고려 사항 참조\)가 인증 응답이 디지털 서명으로 구성되어야 함을 나타내는 경우 서명 블록은 인증을 포함하는 동일한 IOTP 메시지에 포함되어야 합니다. 응답 블록. 서명 구성 요소에는 다음 XML 요소에 대한 다이제스트 요소가 포함되어 있습니다.

o IOTP 메시지 및 IOTP 트랜잭션을 설명하는 정보가 포함된 IOTP 메시지에 대한 트랜잭션 참조 블록\(섹션 3.3 참조\)

o IOTP 트랜잭션을 전역적으로 고유하게 식별하는 트랜잭션 ID 구성 요소\(섹션 3.3.1 참조\)

o 인증 요청 블록의 다음 구성요소:

- - 인증 요청 구성요소

- - 거래 역할 정보 요청 구성요소

o 인증 응답 블록에 포함된 조직 구성 요소

참고: 모든 거래 역할이 데이터 서명을 지원할 수 있다고 가정해서는 안 됩니다. 특히 소비자가 데이터 서명을 지원한다고 가정해서는 안 됩니다.

---
#### **9.1.1.4 Authentication Status IOTP Message**

트랜잭션 참조 블록\(섹션 3.3 참조\) 외에도 이 메시지는 다음으로 구성됩니다.

o 인증 상태 블록\(섹션 8.5 참조\), 그리고

o 선택적 서명 블록\(섹션 8.16 참조\).

이들 각각은 아래에 설명되어 있습니다.

```text
   AUTHENTICATION STATUS BLOCK
```

인증 상태 블록\(섹션 8.6 참조\)에는 다음 거래 구성요소가 포함되어야 합니다.

o ProcessState 속성이 CompletedOk로 설정된 하나의 상태 구성 요소\(7.16절 참조\).

```text
      SIGNATURE BLOCK (AUTHENTICATION STATUS)
```

- 인증 상태 블록이 디지털 서명되는 경우 다음 XML 요소에 대한 다이제스트 요소가 있는 서명 구성 요소를 포함하는 서명 블록이 포함되어야 합니다.

o IOTP 메시지 및 IOTP 트랜잭션을 설명하는 정보가 포함된 IOTP 메시지에 대한 트랜잭션 참조 블록\(섹션 3.3 참조\)

o IOTP 트랜잭션을 전역적으로 고유하게 식별하는 트랜잭션 ID 구성 요소\(섹션 3.3.1 참조\)

o 인증 상태 블록의 다음 구성 요소:

- - 상태 구성 요소\(섹션 7.16 참조\).

참고: 인증 문서 교환 후에 제안 문서 교환\(섹션 9.1.2 참조\)이 이어지는 경우 인증 상태 블록과 서명 블록\(인증 상태\)은 다음 중 하나와 결합될 수 있습니다.

o TPO IOTP 메시지\(섹션 9.1.2.3 참조\), 또는

```text
   o a TPO and Offer Response IOTP Message (see section 9.1.2.6)
```

---
### **9.1.2 Offer Document Exchange**

제안 문서 교환은 두 가지 기본 형태로 이루어집니다.

o 브랜드에 따른 제안 교환. 제안 내용\(예: 주문 세부정보, 금액, 배송 세부정보 등\)이 소비자가 선택한 결제 브랜드 및 프로토콜에 따라 달라지는 경우

o 브랜드 독립적 제안 교환. 제안 내용은 선택한 결제 브랜드 및 프로토콜에 따라 달라지지 않습니다.

- 이러한 각 유형의 제안 문서 교환은 인증 문서 교환이 선행될 수 있습니다\(섹션 9.1.1 참조\).

---
#### **9.1.2.1 Brand Dependent Offer Document Exchange**

- 브랜드 종속 제안 문서 교환에서 TPO 블록과 제안 응답 블록은 판매자가 소비자에게 별도로 전송합니다. 즉:

o 브랜드 목록 구성요소는 TPO 블록으로 소비자에게 전송됩니다.

o 소비자는 브랜드 목록 구성요소에서 결제 브랜드, 결제 프로토콜 및 선택적으로 통화 및 금액을 선택합니다.

o 소비자는 선택한 브랜드, 프로토콜 및

- TPO 선택 블록에서 판매자에게 통화/금액을 돌려줍니다.

o 판매자는 받은 정보를 사용하여 내용을 정의한 다음 제안 응답 블록을 소비자에게 보냅니다.

이는 아래 다이어그램으로 설명됩니다.

\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+ \*+\*+\*+\*+\*+\*+\*+\*+\*+\* 소비자 | 상인
단계 | | 1. 소비자는 거래를 결정하고 판매자가 제안을 생성할 수 있도록 하는 정보\(예: HTML 사용\)를 판매자에게 보냅니다.

```text
     C --> M Offer information - outside scope of IOTP
```

2. 판매자는 적용되는 결제 브랜드 프로토콜, 통화 및 금액을 결정한 다음 TPO 블록 내의 브랜드 목록 구성 요소에 배치하고 소비자에게 보냅니다.

```text
     C <-- M TPO. IotpMsg: Trans Ref Block; TPO Block
```

3. IOTP 인식 애플리케이션이 시작되었습니다. 소비자는 결제 브랜드, 결제 프로토콜, 사용할 통화/금액을 선택합니다. 브랜드 선택 구성요소에 선택 항목을 기록하고 판매자에게 다시 보냅니다.

```text
     C --> M TPO SELECTION. IotpMsg: Trans Ref Block; TPO Selection
             Block
```

4. 판매자는 선택한 결제 브랜드, 결제 프로토콜, 통화/금액 및 제안 정보를 사용하여 가격 등을 포함하여 IOTP 거래에 대한 세부 정보가 포함된 제안 응답 블록을 생성합니다. 선택적으로 서명하여 소비자에게 보냅니다.

```text
     C <-- M OFFER RESPONSE. IotpMsg: Trans Ref Block; Signature Block
             (optional); Offer Response Block
```

5. 소비자는 제안이 OK인지 확인한 다음 TPO 블록, TPO 선택 블록 및 제안 응답 블록의 구성 요소를 결합하여 거래에 대한 다음 IOTP 메시지를 생성하고 필요한 거래 역할에 서명 블록이 있는 경우 서명 블록과 함께 보냅니다.

```text
     CONTINUED ...

 *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*

              Figure 19 Brand Dependent Offer Document Exchange
```

소비자는 첫 번째 IOTP 메시지에 제안 응답 블록이 없음으로 브랜드 종속 제안 문서 교환을 식별합니다.

```text
   MESSAGE PROCESSING GUIDELINES
```

TPO IOTP 메시지\(아래 참조\)를 수신하면 소비자는 다음 중 하나를 수행할 수 있습니다.

o TPO 선택 IOTP 메시지를 생성하여 판매자에게 다시 보내거나, 또는

o StatusType이 Offer이고 ProcessState가 Failed이고 CompletionCode\(섹션 7.16.4 참조\)가 ConsCancelled 또는 Unspecified로 설정된 상태 구성 요소를 포함하는 판매자에게 취소 블록을 다시 보내 IOTP 거래를 계속할 수 없음을 나타냅니다.

TPO 선택 IOTP 메시지\(아래 참조\)를 수신하면 판매자는 다음 중 하나를 수행할 수 있습니다.

o 제안 응답 IOTP 메시지를 생성하여 소비자에게 다시 보냅니다. 또는

o StatusType이 Offer이고 ProcessState가 Failed이며 CompletionCode\(섹션 7.16.4 참조\)가 MerchCancelled 또는 Unspecified로 설정된 상태 구성 요소를 포함하는 취소 블록을 소비자에게 다시 전송하여 IOTP 거래를 계속할 수 없음을 나타냅니다.

제안 응답 IOTP 메시지\(아래 참조\)를 수신하면 소비자는 다음 중 하나를 수행할 수 있습니다.

o IOTP 트랜잭션에서 다음 IOTP 메시지를 생성 및 전송하고 이를 필요한 거래 역할에 전송합니다. 이는 IOTP 트랜잭션에 따라 다릅니다.

o StatusType이 Offer이고 ProcessState가 Failed이고 CompletionCode\(섹션 7.16.4 참조\)가 ConsCancelled 또는 Unspecified로 설정된 상태 구성 요소를 포함하는 판매자에게 취소 블록을 다시 보내 IOTP 거래를 계속할 수 없음을 나타냅니다.

판매자가 취소 블록이 포함된 IOTP 메시지를 받으면 소비자는 판매자의 조직 구성 요소에 있는 거래 역할 요소에 지정된 CancelNetLocn으로 이동할 가능성이 높습니다.

소비자가 취소 블록이 포함된 IOTP 메시지를 수신하면 IOTP 메시지에 포함된 정보가 소비자에게 보고되어야 하지만 추가 조치는 취해지지 않습니다.

---
#### **9.1.2.2 Brand Independent Offer Document Exchange**

브랜드 독립적 제안 문서 교환에서는 TPO 블록과 제안 응답 블록이 판매자에 의해 소비자에게 함께 전송됩니다. 즉, TPO 블록과 제안 응답 블록을 모두 포함하는 하나의 IOTP 메시지가 있습니다.

메시지 흐름은 아래 다이어그램으로 설명됩니다.

\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+ \*+\*+\*+\*+\*+\*+\*+\*+\*+\* 소비자 | 상인
단계 | | 1. 소비자는 거래를 결정하고 판매자가 제안을 생성할 수 있도록 하는 정보\(예: HTML 사용\)를 판매자에게 보냅니다.

```text
     C --> M Offer information - outside scope of IOTP
```

2. 판매자는 적용되는 결제 브랜드 프로토콜, 통화 및 금액을 결정하고 TPO 블록 내의 브랜드 목록 구성 요소에 배치하고 가격 등을 포함하여 IOTP 거래에 대한 세부 정보가 포함된 제안 응답을 생성하고 선택적으로 서명하여 소비자에게 보냅니다.

```text
     C <-- M TPO & OFFER RESPONSE. IotpMsg: Trans Ref Block; Signature
             Block; TPO Block; Offer Response Block
```

3. IOTP 인식 애플리케이션이 시작되었습니다. 소비자는 결제 브랜드, 결제 프로토콜, 사용할 통화/금액을 선택합니다. 브랜드 선택 구성 요소에 선택을 기록하고 제안이 괜찮은지 확인하고 브랜드 선택 구성 요소를 TPO 블록 및 제안 응답 블록의 정보와 결합하여 트랜잭션에 대한 다음 IOTP 메시지를 생성하고 필요한 경우 서명 블록과 함께 보냅니다. 거래 역할.

```text
     CONTINUED ...

 *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*

                 Figure 20 Brand Independent Offer Exchange
```

브랜드 독립적 제안 문서 교환은 판매자가 하나의 결제 브랜드, 프로토콜 및 통화/금액만 소비자에게 제공하는 경우 항상 발생합니다. 또한 여러 브랜드가 제공되고 결제 처리기가 동일하며 모든 브랜드가 동일한 프로토콜 세트를 사용하는 경우에도 발생할 가능성이 있지만 반드시 그런 것은 아닙니다.

Offer Response 블록이 변경되지 않더라도 TPO 블록과 Offer Response 블록은 별도의 IOTP 메시지로 전송될 수 있습니다\(브랜드에 따른 제안 문서 교환 참조\). 그러나 이로 인해 트랜잭션의 메시지 수가 증가하므로 트랜잭션 응답 시간이 늘어날 가능성이 높습니다.

소비자 거래 역할을 지원하는 IOTP 인식 애플리케이션은 제안 문서 교환이 브랜드에 종속되는지 여부를 결정하기 위해 첫 번째 IOTP 메시지에 제안 응답 블록이 있는지 확인해야 합니다.

```text
   MESSAGE PROCESSING GUIDELINES
```

TPO 및 제안 응답 IOTP 메시지\(아래 참조\)를 수신하면 소비자는 다음 중 하나를 수행할 수 있습니다.

o IOTP 트랜잭션에서 다음 IOTP 메시지를 생성 및 전송하고 이를 필요한 거래 역할에 전송합니다. 이는 IOTP 트랜잭션에 따라 다릅니다.

o StatusType이 Offer이고 ProcessState가 Failed이며 CompletionCode\(섹션 7.16.1 참조\)가 ConsCancelled 또는 Unspecified로 설정된 상태 구성 요소를 포함하는 판매자에게 취소 블록을 다시 전송하여 IOTP 거래를 계속할 수 없음을 나타냅니다.

판매자가 취소 블록이 포함된 IOTP 메시지를 받으면 소비자는 판매자의 조직 구성 요소에 있는 거래 역할 요소에 지정된 CancelNetLocn으로 이동할 가능성이 높습니다.

---
#### **9.1.2.3 TPO IOTP Message**

TPO IOTP 메시지는 브랜드 종속 제안 문서 교환에만 사용됩니다. 거래 참조 블록\(섹션 3.3 참조\)과는 별도로 이 메시지는 아래에 설명된 거래 프로토콜 옵션 블록\(섹션 8.1 참조\)으로 구성됩니다.

```text
   TPO (TRADING PROTOCOL OPTIONS) BLOCK
```

거래 프로토콜 옵션 블록\(섹션 8.1 참조\)에는 다음 거래 구성요소가 포함되어야 합니다.

o 전체 IOTP 트랜잭션에 적용되는 옵션을 정의하는 하나의 프로토콜 옵션 구성요소. 섹션 7.1을 참조하세요.

o 각 결제에 사용하기 위해 선택할 수 있는 하나 이상의 결제 브랜드 및 프로토콜을 포함하는 IOTP 거래의 각 결제에 대한 하나의 브랜드 목록 구성요소\(섹션 7.7 참조\)

o 다음 역할을 가진 조직 구성요소\(섹션 7.6 참조\):

- - 제안을 하는 판매자

- - 거래를 수행하는 소비자

- - 결제에 대한 PaymentHandler입니다. 지불 처리기 조직 구성요소의 "ID"는 지불 구성요소의 PhOrgRef 속성 내에 포함되어 있습니다.

IOTP 트랜잭션에 전달이 포함된 경우 TPO 블록에는 다음도 포함되어야 합니다.

o 다음 역할을 가진 조직 구성요소:

- - 상품이나 서비스를 배송할 DeliveryHandler

- - DelivTo\(배송을 받을 개인 또는 조직\)

인증 상태 및 서명 블록

제안 문서 교환 앞에 인증 문서 교환이 수행된 경우 TPO IOTP 메시지에는 다음이 포함될 수도 있습니다.

o 인증 상태 블록\(섹션 8.6 참조\), 그리고

o 선택적 서명 블록\(인증 상태\) 서명 블록

자세한 내용은 섹션 9.1.1.4 인증 상태 IOTP 메시지를 참조하세요.

---
#### **9.1.2.4 TPO Selection IOTP Message**

TPO 선택 IOTP 메시지는 브랜드 종속 제안 문서 교환에만 사용됩니다. 트랜잭션 참조 블록\(섹션 3.3 참조\)과는 별도로 이 메시지는 아래에 설명된 TPO 선택 블록\(섹션 8.1 참조\)으로 구성됩니다.

```text
   TPO SELECTION BLOCK
```

TPO 선택 블록\(섹션 8.2 참조\)에는 다음이 포함됩니다.

o 차후 지불 교환에 사용하기 위한 하나의 브랜드 선택 구성 요소\(섹션 7.8 참조\). 여기에는 소비자가 브랜드 목록 구성 요소에 제공된 목록에서 결제 브랜드, 결제 프로토콜 및 통화/금액을 선택한 결과가 포함됩니다.

---
#### **9.1.2.5 Offer Response IOTP Message**

제안 응답 IOTP 메시지는 브랜드 종속 제안 문서 교환에만 사용됩니다. 트랜잭션 참조 블록\(섹션 3.3 참조\) 외에도 이 메시지는 다음으로 구성됩니다.

o 제안 응답 블록\(섹션 8.1 참조\) 및

o 선택적 서명 블록\(섹션 8.16 참조\).

```text
   OFFER RESPONSE BLOCK
```

제안 응답 블록\(섹션 8.3 참조\)에는 다음 구성 요소가 포함되어 있습니다.

o 제안 응답의 상태를 나타내는 하나의 상태 구성 요소\(섹션 7.16 참조\). ProcessState 특성은 CompletedOk로 설정되어야 합니다.

o 구매 중인 상품 및 서비스 또는 진행 중인 금융 거래에 대한 세부정보가 포함된 하나의 주문 구성요소\(섹션 7.5 참조\)

o 이루어질 각 지불에 대한 하나 이상의 지불 구성 요소\(섹션 7.9 참조\)

o IOTP 거래에 배달이 포함된 경우 전달 세부 정보가 포함된 0개 또는 1개의 배달 구성 요소\(섹션 7.13 참조\)

o 판매자가 요구하는 경우 0개 이상의 거래 역할 데이터 구성요소\(섹션 7.17 참조\).

```text
   SIGNATURE BLOCK (OFFER RESPONSE)
```

인증 상태 블록이 디지털 서명되는 경우 다음 XML 요소에 대한 다이제스트 요소가 있는 서명 구성 요소\(섹션 7.19 참조\)를 포함하는 서명 블록이 포함되어야 합니다.

제안 응답이 디지털 서명되는 경우 다음 XML 요소에 대한 다이제스트 요소와 함께 서명 구성 요소\(섹션 7.19 참조\)를 포함하는 서명 블록이 포함되어야 합니다.

o IOTP 메시지 및 IOTP 트랜잭션을 설명하는 정보가 포함된 IOTP 메시지에 대한 트랜잭션 참조 블록\(섹션 3.3 참조\)

o IOTP 트랜잭션을 전역적으로 고유하게 식별하는 트랜잭션 ID 구성 요소\(섹션 3.3.1 참조\)

o TPO 블록의 다음 구성요소:

- - 프로토콜 옵션 구성요소, 그리고

- - 브랜드 목록 구성요소

- - 존재하는 모든 조직 구성 요소

o 제안 응답 블록의 다음 구성요소:

- - 주문 구성요소

- - 존재하는 모든 결제 구성요소

- - 전달 구성요소\(있는 경우\)

```text
      -  any Trading Role Data Components present
```

---
#### **9.1.2.6 TPO and Offer Response IOTP Message**

TPO 및 제안 응답 IOTP 메시지는 브랜드 독립적 제안 문서 교환에만 사용됩니다. 트랜잭션 참조 블록\(섹션 3.3 참조\) 외에도 이 메시지는 다음으로 구성됩니다.

```text
   o  a Trading Protocol Options Block (see section 8.1)
```

o 제안 응답 블록\(섹션 8.1 참조\) 및

o 선택적 서명 블록\(섹션 8.16 참조\).

```text
   TPO (TRADING PROTOCOL OPTIONS) BLOCK
```

이는 TPO IOTP 메시지에 설명된 거래 프로토콜 옵션 블록과 동일합니다\(섹션 9.1.2.3 참조\).

```text
   OFFER RESPONSE BLOCK
```

이는 제안 응답 IOTP 메시지의 제안 응답 블록과 동일합니다\(섹션 9.1.2.5 참조\).

```text
   AUTHENTICATION STATUS
```

제안 문서 교환이 인증 문서 교환에 의해 선행된 경우 TPO 및 제안 응답 IOTP 메시지에도 인증 상태 블록이 포함될 수 있습니다\(섹션 8.6 참조\).

```text
   SIGNATURE BLOCK
```

이는 다음을 추가하여 제안 응답 IOTP 메시지\(섹션 9.1.2.5 참조\)의 서명 블록과 동일합니다.

o 제안 문서 교환이 브랜드에 따라 달라지는 경우 서명 블록의 서명 구성 요소에는 TPO 선택 블록에 포함된 브랜드 선택 구성 요소에 대한 다이제스트 요소가 추가로 포함됩니다.

o 제안 문서 교환 앞에 인증 문서 교환이 있었던 경우 서명 블록의 서명 구성 요소에는 인증 상태 블록에 대한 다이제스트 요소가 추가로 포함됩니다.

---
### **9.1.3 Payment Document Exchange**

지불 문서 교환은 소비자가 브랜드를 선택한 후 지불 거래 교환\(섹션 2.2.2 참조\)의 마지막 부분을 직접 구현하는 것입니다. 결제 교환은 다음으로 구성됩니다.

o 소비자는 Transaction에서 이전 IOTP 메시지의 정보를 사용하여 Payment Request IOTP 메시지를 생성한 후 이를 Payment Handler로 전송하여 결제 시작을 요청합니다.

o 결제 핸들러와 소비자는 결제가 완료될 때까지 결제 프로토콜 메시지를 캡슐화하는 결제 교환 IOTP 메시지를 교환합니다.

o 지불 핸들러는 지불 영수증이 포함된 지불 응답 IOTP 메시지를 소비자에게 보냅니다.

관련된 IOTP 메시지는 아래 다이어그램에 설명되어 있습니다.

\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+ \*+\*+\*+\*+\*+\*+\*+\*+\*+\* 소비자 | 결제 | 매니저
단계 | | 1. 소비자는 필요한 경우 지불 프로토콜 메시지를 캡슐화하는 지불 요청 블록을 생성하고 서명 블록이 있는 경우 지불 처리기로 보냅니다.

```text
     C --> P PAYMENT REQUEST. IotpMsg: Trans Ref Block; Signature
             Block (optional); Pay Request Block
```

2. 지불 핸들러는 지불 요청 블록을 처리하고 선택적 서명을 확인한 후 지불 교환 블록에 캡슐화된 지불 프로토콜 메시지를 소비자와 교환하기 시작합니다.

```text
     C <-> P PAYMENT EXCHANGE. IotpMsg: Trans Ref Block; Pay Exchange
             Block
```

3. 소비자와 지불 처리기는 결국 지불 프로토콜 메시지가 완료될 때까지 지불 교환 블록을 계속 교환하므로 지불 처리기는 지불 응답 블록 내에 지불 영수증 구성 요소를 생성하고 서명 블록 내에 선택적 서명 구성 요소를 생성하여 이를 소비자에게 보내고 중지합니다.

```text
     C <-- P PAYMENT RESPONSE. IotpMsg: Trans Ref Block; Signature
             Block (optional); Pay Response Block
```

4. 소비자는 결제 응답이 OK인지 확인합니다. 선택적으로 기록 보관 목적으로 IOTP 거래에 대한 정보를 유지하고 거래에 대한 다음 IOTP 메시지를 중지하거나 생성하고 서명 블록\(있는 경우\)과 함께 필요한 거래 역할로 보냅니다.

```text
 *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*

                     Figure 21 Payment Document Exchange
```

---
#### **9.1.3.1 Message Processing Guidelines**

지불 요청 IOTP 메시지를 수신하면 지불 핸들러는 지불을 수행할 권한이 있는지 확인해야 합니다\(섹션 6 디지털 서명 참조\). 그런 다음 다음 중 하나를 수행할 수 있습니다.

o 더 많은 지불 프로토콜 메시지를 교환해야 하는 경우 지불 교환 IOTP 메시지를 생성하여 소비자에게 다시 보냅니다.

o 결제 프로토콜 메시지 교환이 완료되면 결제 응답 IOTP 메시지를 생성하여 전송합니다.

o StatusType이 Payment, ProcessState가 Failed, CompletionCode\(섹션 7.16.4 참조\)가 BrandNotSupp, CurrNotSupp, PaymtCancelled로 설정된 상태 구성 요소를 포함하는 취소 블록을 소비자에게 다시 전송하여 결제를 계속할 수 없음을 나타냅니다. , AuthError, InsuffFunds, InstBrandInvalid, InstNotValid, BadInstrument 또는 지정되지 않음.

Payment Exchange IOTP 메시지를 수신하면 소비자는 다음 중 하나를 수행할 수 있습니다.

o 지불 교환 메시지를 생성하여 지불 처리자에게 다시 보내거나

o StatusType이 Payment이고 ProcessState가 Failed이며 CompletionCode\(섹션 7.16.2 참조\)가 ConsCancelled 또는 Unspecified로 설정된 상태 구성 요소를 포함하는 Payment Handler에 취소 블록을 다시 보내서 결제를 계속할 수 없음을 나타냅니다.

지불 교환 IOTP 메시지를 수신하면 지불 핸들러는 다음 중 하나를 수행할 수 있습니다.

o 더 많은 지불 프로토콜 메시지를 교환해야 하는 경우 지불 교환 IOTP 메시지를 생성하여 소비자에게 다시 보냅니다.

o 결제 프로토콜 메시지 교환이 완료되면 결제 응답 IOTP 메시지를 생성하여 전송합니다.

o StatusType이 Payment, ProcessState가 Failed, CompletionCode\(섹션 7.16.2 참조\)가 PaymtCancelled 또는 Unspecified로 설정된 상태 구성 요소를 포함하는 취소 블록을 소비자에게 다시 전송하여 결제를 계속할 수 없음을 나타냅니다.

결제 응답 IOTP 메시지를 수신하면 소비자는 다음 중 하나를 수행할 수 있습니다.

o IOTP 트랜잭션에서 다음 IOTP 메시지를 생성 및 전송하고 이를 필요한 거래 역할에 전송합니다. 이는 IOTP 트랜잭션에 따라 달라집니다.

o IOTP 트랜잭션이 종료되었으므로 중지하거나

o StatusType이 Payment이고 ProcessState가 Failed이며 CompletionCode\(섹션 7.16.1 참조\)가 ConsCancelled 또는 Unspecified로 설정된 상태 구성 요소를 포함하는 판매자에게 취소 블록을 다시 전송하여 IOTP 거래를 계속할 수 없음을 나타냅니다.

소비자가 취소 블록이 포함된 IOTP 메시지를 수신하면 IOTP 메시지에 포함된 정보가 소비자에게 보고되어야 하지만 추가 조치는 취해지지 않습니다.

결제 핸들러가 취소 블록이 포함된 IOTP 메시지를 수신하면 소비자는 추가 작업이 수행될 수 있는 결제 핸들러의 조직 구성 요소에 있는 거래 역할 요소에 지정된 CancelNetLocn으로 이동할 가능성이 높습니다.

판매자가 취소 블록이 포함된 IOTP 메시지를 받은 경우 소비자는 결제를 완료했지만 어떤 이유로 인해 거래를 계속하지 않아야 합니다. 이 경우 소비자는 판매자의 조직 구성요소에 있는 거래 역할 요소에 지정된 CancelNetLocn으로 이동하여 추가 조치가 발생할 수 있습니다.

---
#### **9.1.3.2 Payment Request IOTP Message**

트랜잭션 참조 블록\(섹션 3.3 참조\) 외에도 이 메시지는 다음으로 구성됩니다.

o 지불 요청 블록, 그리고

o 선택적 서명 블록

```text
   PAYMENT REQUEST BLOCK
```

지불 요청 블록\(섹션 8.7 참조\)에는 다음이 포함됩니다.

o 이전 제안 문서 교환의 제안 응답 블록에서 복사된 다음 구성 요소:

- - 상태 구성 요소

- - 수행 중인 결제에 대한 결제 구성요소

o TPO 블록의 다음 구성요소:

- - 판매자 역할과 지불 요청 블록이 전송되는 PaymentHandler의 조직 구성요소

- - 결제를 위한 브랜드 목록 구성요소\(즉, 결제 구성요소의 BrandListRef 속성에 의해 참조되는 브랜드 목록\)

o 브랜드 목록을 위한 하나의 브랜드 선택 구성요소, 즉 BrandListRef 속성이 브랜드 목록을 가리키는 브랜드 선택 구성요소. 이 구성요소는 다음 중 하나일 수 있습니다.

- - 지불이 브랜드 의존 제안 문서 교환에 의해 선행된 경우 TPO 선택 블록에서 복사됨\(섹션 9.1.2.1 참조\), 또는

```text
      -  created by the Consumer, containing the payment brand, payment
         protocol and currency/amount selected from the Brand List, if
         the payment was preceded by a Brand Independent Offer Document
         Exchange (see section 9.1.2.2)
```

o 사용된 결제 방법에 따라 필요한 경우 선택적 결제 체계 구성 요소\(섹션 7.10 참조\)\(필요한지 확인하려면 결제 방법 보충 자료 참조\).

o 0개 이상의 거래 역할 데이터 구성요소\(섹션 7.17 참조\).

```text
   Note that:
```

o 제안 응답 블록에 하나 이상의 지불 구성요소가 있는 경우 두 번째 지불은 첫 번째 지불에 대한 지불 구성요소를 식별하는 StartAfter 속성\(섹션 7.9 참조\)을 포함하는 제안 응답 블록 내의 지불입니다.

o 포함할 결제 처리자는 브랜드로 식별됩니다.

- 지불을 위한 선택 구성요소\(섹션 7.8 참조\). 결제 처리자를 식별하는 방법에 대한 설명은 섹션 6.3.1 확인 요청 블록 전송 올바른 조직을 참조하세요.

o 포함할 브랜드 목록 구성요소는 식별된 지불에 대한 지불 구성요소의 BrandListRef 속성에 의해 식별된 것입니다.

o 제안 응답 블록에서 포함할 브랜드 선택 구성 요소는 두 번째 지불에 대한 브랜드 목록 구성 요소를 식별하는 BrandListRef 속성\(섹션 3.5 참조\)을 포함하는 구성 요소입니다.

```text
   SIGNATURE BLOCK (PAYMENT REQUEST)
```

이전 제안 문서 교환에 제안 응답 서명\(섹션 9.1.2.5 제안 응답 IOTP 메시지 참조\)이 포함되었거나 이전 지불 교환에 지불 응답 서명이 포함된 경우

\(섹션 9.1.3.4 지불 응답 IOTP 메시지 참조\) 둘 다 지불 요청 IOTP 메시지의 서명 블록에 복사되어야 합니다.

---
#### **9.1.3.3 Payment Exchange IOTP Message**

거래 참조 블록\(섹션 3.3 참조\)과는 별개로 이 메시지는 지불 교환 블록으로만 구성됩니다.

```text
   PAYMENT EXCHANGE BLOCK
```

지불 교환 블록\(섹션 8.8 참조\)에는 다음이 포함됩니다.

o 지불 방법별 데이터를 포함하는 하나의 지불 체계 구성 요소\(섹션 7.10 참조\). 여기에 포함되어야 하는 내용을 결정하는 데 사용되는 결제 방법에 대한 결제 방법 보충 자료를 참조하세요.

---
#### **9.1.3.4 Payment Response IOTP Message**

트랜잭션 참조 블록\(섹션 3.3 참조\) 외에도 이 메시지는 다음으로 구성됩니다.

o 결제 응답 블록, 그리고

o 선택적 서명 블록

```text
   PAYMENT RESPONSE BLOCK
```

지불 응답 블록\(섹션 8.9 참조\)에는 다음이 포함됩니다.

o 지급이 이루어졌는지 확인하는 데 사용할 수 있는 제도별 데이터가 포함된 하나의 지급 영수증 구성요소\(섹션 7.11 참조\)

o 필요한 경우 지불 방법별 데이터를 포함하는 하나의 지불 체계 구성 요소\(섹션 7.10 참조\). 여기에 포함되어야 하는 내용을 결정하는 데 사용되는 결제 방법에 대한 결제 방법 보충 자료를 참조하세요.

```text
   o  an optional Payment Note Component (see section 7.12)
```

o 0개 이상의 거래 역할 데이터 구성요소\(섹션 7.17 참조\).

```text
   SIGNATURE BLOCK (PAYMENT RESPONSE)
```

서명된 지불 영수증이 제공되는 경우\(True로 설정된 지불 구성 요소의 SignedPayReceipt 속성에 의해 표시됨\) 서명 블록에는 다음에 대한 다이제스트 요소가 포함된 서명 구성 요소가 포함되어야 합니다.

o 지불 응답 블록의 첫 번째 사용을 포함하는 IOTP 메시지에 대한 트랜잭션 참조 블록\(섹션 3.3 참조\),

o IOTP 트랜잭션을 전역적으로 고유하게 식별하는 트랜잭션 참조 블록 내의 트랜잭션 ID 구성 요소\(섹션 3.3.1 참조\),

o 지불 응답 블록의 지불 영수증 구성 요소,

o 지불 응답 블록의 지불 메모 구성 요소,

o PayReceiptNameRefs에서 참조하는 기타 구성요소

- 지급 영수증 구성요소의 속성\(존재하는 경우\),

o 지불 응답 블록의 상태 구성 요소,

o 지불 응답 블록의 거래 역할 데이터 구성요소, 그리고

o 지불 요청 블록에 포함된 모든 서명 구성요소\(있는 경우\).

---
### **9.1.4 Delivery Document Exchange**

배달 문서 교환은 배달 거래 교환을 직접 구현한 것입니다\(섹션 2.2.3 참조\). 그것은 다음으로 구성됩니다:

o Consumer는 Transaction에서 이전 IOTP 메시지의 정보를 이용하여 Delivery Request IOTP 메시지를 생성한 후 Delivery Handler로 전송하여 Delivery를 요청한다.

o 배달 핸들러는 선택적 서명과 함께 요청에 대한 핸들러의 응답에 대한 세부 정보가 포함된 배달 응답 IOTP 메시지를 소비자에게 보냅니다.

메시지 흐름은 아래 다이어그램으로 설명됩니다.

\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+ \*+\*+\*+\*+\*+\*+\*+\*+\*+\* 소비자 | 배송 | 매니저
단계 | | 1. 소비자는 배달 요청 블록을 생성하고 이를 서명 블록이 있는 배달 핸들러\(있는 경우\)로 보냅니다.

```text
     C --> D DELIVERY REQUEST. IotpMsg: Trans Ref Block; Signature
             Block; Delivery Request Block
```

2. 배달 핸들러는 배달 요청 및 선택적 서명의 상태 및 주문 구성 요소를 확인하고 배달 응답 블록을 생성한 후 소비자에게 전송하고 중지합니다.

```text
     C <-- D DELIVERY RESPONSE. IotpMsg: Trans Ref Block; Signature
             Block; Delivery Response Block
```

3. 소비자는 배송 응답 차단 및 선택적 서명 차단이 정상인지 확인합니다. 선택적으로 기록 보관 목적을 위해 IOTP 트랜잭션에 대한 정보를 유지하고 중지합니다.

```text
 *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*

                    Figure 22 Delivery Document Exchange
```

---
#### **9.1.4.1 Message Processing Guidelines**

배달 요청 IOTP 메시지를 수신하면 배달 핸들러는 배달을 수행할 권한이 있는지 확인해야 합니다\(섹션 6 디지털 서명 참조\). 그런 다음 다음 중 하나를 수행할 수 있습니다.

o 배달 응답 IOTP 메시지를 생성하여

- 소비자 또는

o StatusType이 Delivery이고 ProcessState가 Failed이고 CompletionCode\(섹션 7.16.4 참조\)가 DelivCanceled 또는 Unspecified로 설정된 상태 구성 요소를 포함하는 취소 블록을 소비자에게 다시 전송하여 배달을 계속할 수 없음을 나타냅니다.

배달 응답 IOTP 메시지를 수신하면 소비자는 IOTP 트랜잭션이 완료되었으므로 중지해야 합니다.

소비자가 취소 블록이 포함된 IOTP 메시지를 수신하면 IOTP 메시지에 포함된 정보가 소비자에게 보고되어야 하지만 추가 조치는 취해지지 않습니다.

---
#### **9.1.4.2 Delivery Request IOTP Message**

배달 요청 IOTP 메시지는 다음으로 구성됩니다.

o 배달 요청 블록, 그리고

o 선택적 서명 블록

```text
   DELIVERY REQUEST BLOCK
```

배달 요청 블록\(섹션 8.10 참조\)에는 다음이 포함됩니다.

o 제안 응답 블록에서 복사된 다음 구성 요소:

```text
      -  the Status Component (see section 7.16)

      -  the Order Component (see section 7.5)
```

- - 역할이 Merchant, DeliveryHandler 및 DeliverTo인 조직 구성 요소\(섹션 7.6 참조\)

```text
      -  the Delivery Component (see section 7.13)
```

o 결제 응답 블록의 다음 구성요소:

- - 상태 구성 요소\(섹션 7.16 참조\).

o 0개 이상의 거래 역할 데이터 구성요소\(섹션 7.17 참조\).

```text
   SIGNATURE BLOCK (DELIVERY REQUEST)
```

이전 제안 문서 교환에 제안 응답 서명이 포함되었거나 지불 문서 교환에 지불 응답 서명이 포함된 경우 둘 다 서명 블록에 복사해야 합니다.

---
#### **9.1.4.3 Delivery Response IOTP Message**

배달 응답 IOTP 메시지에는 배달 응답 블록과 선택적 서명 블록이 포함됩니다.

```text
   DELIVERY RESPONSE BLOCK
```

배달 응답 블록에는 다음이 포함됩니다.

o 상품 또는 서비스 배송에 대한 배송 지침이 포함된 배송 메모 구성 요소\(섹션 7.15 참조\) 1개

```text
      in3 SIGNATURE BLOCK (DELIVERY RESPONSE)
```

- 서명 블록에는 다음을 참조하는 다이제스트 요소가 포함된 하나의 서명 구성 요소가 포함되어야 합니다.

o 배달 응답 서명을 포함하는 IOTP 메시지의 트랜잭션 ID 구성 요소\(섹션 3.3.1 참조\)

o 배달 응답 서명을 포함하는 IOTP 메시지의 트랜잭션 참조 블록\(섹션 3.3 참조\)

```text
   o  the Consumer Delivery Data component contained in the Delivery
      Request Block (if any)

   o  the Signature Components contained in the Delivery Request Block
      (if any)
```

o 상태 구성 요소

o 납품서 구성요소

---
### **9.1.5 Payment and Delivery Document Exchange**

지급 및 배송 문서 교환은 지급 거래 교환\(2.2.2항 참조\)의 마지막 부분과 배달 거래 교환\(2.2.3항 참조\)의 조합입니다. 그것은 다음으로 구성됩니다:

o 소비자는 Transaction에서 이전 IOTP 메시지의 정보를 사용하여 Payment Request IOTP 메시지를 생성한 후 이를 Payment Handler로 전송하여 결제 시작을 요청합니다.

o 결제 핸들러와 소비자는 결제가 완료될 때까지 결제 프로토콜 메시지를 캡슐화하는 결제 교환 IOTP 메시지를 교환합니다.

o 하나의 IOTP 메시지로 소비자에게 보내는 결제 핸들러:

- - 지불 영수증이 포함된 지불 응답 블록, 그리고

- - 배송될 상품 또는 서비스의 세부정보가 포함된 배송 응답 블록

관련된 IOTP 메시지는 아래 다이어그램에 설명되어 있습니다.

\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+ \*+\*+\*+\*+\*+\*+\*+\*+\*+\* 소비자 | 결제 | 매니저
단계 | | 1. 소비자는 필요한 경우 지불 프로토콜 메시지를 캡슐화하는 지불 요청 블록을 생성하고 서명 블록이 있는 경우 지불 처리기로 보냅니다.

```text
     C --> P PAYMENT REQUEST. IotpMsg: Trans Ref Block; Signature
             Block; Pay Request Block
```

2. 지불 핸들러는 지불 요청 블록을 처리하고 선택적 서명을 확인한 후 지불 교환 블록에 캡슐화된 지불 프로토콜 메시지를 소비자와 교환하기 시작합니다.

```text
     C <-> P PAYMENT EXCHANGE. IotpMsg: Trans Ref Block; Pay Exchange
             Block
```

3. 소비자와 지불 처리기는 결국 지불 프로토콜 메시지가 완료될 때까지 지불 교환 블록을 계속 교환하므로 지불 처리기는 지불 응답 블록 내에 지불 영수증 구성 요소를 생성하고 서명 블록 내부에 선택적 서명 구성 요소를 생성한 다음 제안 응답 블록의 정보를 사용합니다. 배달 응답 블록을 생성하고 소비자와 중지 모두에 보냅니다.

```text
     C <-- P PAYMENT RESPONSE & DELIVERY RESPONSE. IotpMsg: Trans Ref
             Block; Signature Block; Pay Response Block; Delivery
             Response Block
```

4. 소비자는 결제 응답 및 배송 응답 차단이 정상인지 확인합니다. 선택적으로 기록 유지 목적으로 IOTP 거래에 대한 정보를 유지하고 거래에 대한 다음 IOTP 메시지를 중지하거나 생성하고 서명 블록\(있는 경우\)과 함께 필요한 거래 역할로 보냅니다.

```text
 *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*

              Figure 23 Payment and Delivery Document Exchange
```

배달 응답 블록과 지불 응답 블록은 지불 핸들러가 배달 응답 블록을 보낼 수 있는 정보를 가지고 있는 경우에만 동일한 IOTP 메시지로 결합될 수 있습니다. 이는 판매자, 결제 처리자 및 배송 처리자 역할이 결합될 때 발생할 가능성이 있지만 반드시 그런 것은 아닙니다.

Offer Response Block\(8.3 참조\) 내에 포함된 Delivery Component\(7.13 참조\)의 DelivAndPayResp 속성은 Delivery Response Block과 Payment Response Block이 동일한 IOTP 메시지로 결합된 경우 True로 설정되고, 다음과 같은 경우 False로 설정됩니다. 배달 응답 블록과 지불 응답 블록은 별도의 IOTP 메시지로 전송됩니다.

---
#### **9.1.5.1 Message Processing Guidelines**

지불 요청 IOTP 메시지 또는 지불 교환 IOTP 메시지를 수신하면 지불 핸들러는 지불 문서 교환과 동일한 작업을 수행해야 합니다\(섹션 9.1.3.1 참조\).

지불 교환 IOTP 메시지를 수신하면 소비자는 지불 문서 교환과 동일한 작업을 수행해야 합니다\(섹션 9.1.3.1 참조\).

결제 응답 및 배달 응답 IOTP 메시지를 수신하면 IOTP 거래가 완료되며 추가 조치를 취해서는 안 됩니다.

소비자가 취소 블록이 포함된 IOTP 메시지를 수신하면 IOTP 메시지에 포함된 정보가 소비자에게 보고되어야 하지만 추가 조치는 취해지지 않습니다.

결제 핸들러가 취소 블록이 포함된 IOTP 메시지를 수신하면 소비자는 추가 작업이 수행될 수 있는 결제 핸들러의 조직 구성 요소에 있는 거래 역할 요소에 지정된 CancelNetLocn으로 이동할 가능성이 높습니다.

판매자가 취소 블록이 포함된 IOTP 메시지를 받은 경우 소비자는 결제를 완료했지만 어떤 이유로 인해 거래를 계속하지 않아야 합니다. 이 경우 소비자는 판매자의 조직 구성요소에 있는 거래 역할 요소에 지정된 CancelNetLocn으로 이동하여 추가 조치가 발생할 수 있습니다.

---
#### **9.1.5.2 Payment Request IOTP Message**

이 메시지의 내용은 지불 문서 교환\(섹션 9.1.3.2 참조\)의 지불 요청 IOTP 메시지와 동일합니다.

---
#### **9.1.5.3 Payment Exchange IOTP Message**

이 메시지의 내용은 지불 문서 교환의 지불 교환 IOTP 메시지와 동일합니다\(섹션 9.1.3.3 참조\).

---
#### **9.1.5.4 Payment Response and Delivery Response IOTP Message**

이 메시지의 내용은 다음과 같이 구성됩니다.

o 지불 응답 블록,

o 선택적 서명 블록\(지불 응답\) 및

o 배달 응답 블록.

```text
   PAYMENT RESPONSE BLOCK
```

이 블록의 내용은 지불 문서 교환과 관련된 지불 응답 IOTP 메시지의 지불 응답 블록과 동일합니다\(섹션 9.1.3.4 참조\).

```text
   SIGNATURE BLOCK (PAYMENT RESPONSE)
```

이 블록의 내용은 지불 문서 교환과 관련된 지불 응답 IOTP 메시지의 서명 블록\(지불 응답\)과 동일합니다\(섹션 9.1.3.4 참조\).

```text
   DELIVERY RESPONSE BLOCK
```

이 블록의 내용은 배달 문서 교환과 관련된 배달 응답 IOTP 메시지의 배달 응답 블록과 동일합니다\(섹션 9.1.4.3 참조\).

---
### **9.1.6 Baseline Authentication IOTP Transaction**

기본 인증 IOTP 거래는 IOTP 거래와 관련된 거래 역할 간에 언제든지 발생할 수 있습니다. 이는 다음과 같은 일이 발생할 수 있음을 의미합니다.

o 다른 IOTP 트랜잭션 이전

o 다른 IOTP 트랜잭션과 동시에

o 다른 IOTP 거래와는 독립적으로.

기본 인증 IOTP 트랜잭션은 아래 다이어그램에 표시된 대로 인증 문서 교환\(9.1.1 섹션 참조\)으로만 구성됩니다.

```text
   *+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*

   START -------------------------------------------------------
                                                                v
                                                       ----------------
                                                      | AUTHENTICATION |
                                                       ----------------
                                                                 |
                                                                 |
                                                                 |
                                                                 |
                  -------------------     -----------------      |
                 | BRAND INDEPENDENT |   | BRAND DEPENDENT |     |
                 |       OFFER       |   |      OFFER      |     |
                  -------------------     -----------------      |
                                                                 |
                                                                 |
                                                                 |
                                                                 |
                                                                 |
                      ---------           --------------         |
                     | PAYMENT |         | PAYMENT WITH |        |
                     | (first) |         |   DELIVERY   |        |
                      ---------           --------------         |
                                                                 |
                                                                 |
                                                                 |
         ----------        ---------                             |
        | DELIVERY |      | PAYMENT |                            |
        |          |      | {second)|                            |
         ----------        ---------                             |
                                                                 v
                                                               STOP

   *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*

               Figure 24 Baseline Authentication IOTP Transaction
```

기본 인증 IOTP 트랜잭션의 사용 예는 다음과 같습니다.

o 기본 인증 IOTP 트랜잭션이 강력한 연속성이 존재하는 세션의 초기 부분으로 발생하는 경우. 예를 들어 금융 기관은 다음을 수행할 수 있습니다.

- - 고객과 보안 채널\(예: \[SSL/TLS\] 사용\)을 설정합니다.

- - 기본 인증 IOTP 트랜잭션을 사용하여 고객을 인증한 다음

- - 고객이 선의의 고객과 소통하고 있다는 확신을 가지고 계정 정보 및 기타 서비스에 대한 액세스를 제공합니다.

o 조직에 판매자 역할을 제공하는 수단으로

- 소비자 및 DelivTo 거래 역할에 대한 정보를 포함하는 구성 요소

o 소비자가 결제를 시작하기 전에 결제 처리자를 인증할 수 있도록 하기 위함입니다.

---
### **9.1.7 Baseline Deposit IOTP Transaction**

Baseline Deposit IOTP 거래는 금융 기관에 전자 현금을 입금하는 것을 지원합니다.

참고: 금융 기관은 IOTP 용어에서 수수료\(예: 일종의 은행 수수료\)에 대한 대가로 서비스\(예: 전자 현금 예금\)를 제공하는 판매자의 역할을 갖습니다. 명확성을 위해 도표와 본문에서는 "금융 기관"이라는 용어를 사용했습니다.

기본 예금 IOTP 거래는 다음 문서 교환으로 구성됩니다.

```text
   o  an optional Authentication Document Exchange (see section 9.1.1)
```

o 문서 교환 제안\(섹션 9.1.2 참조\), 그리고

o 지급 문서 교환\(9.1.3항 참조\).

이러한 문서 교환이 함께 결합되는 방식은 아래 다이어그램에 설명되어 있습니다.

```text
   *+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*

   START -----------------------------------------------------
      |                                                       v
      |                                                ----------------
      |                                               | AUTHENTICATION |
      |                                                ----------------
       --------------------------------------               |
                       |                     |              |
                       |      -------------- | -------------
                       v      v              v      v
                  -------------------     -----------------
                 | BRAND INDEPENDENT |   | BRAND DEPENDENT |
                 |       OFFER       |   |      OFFER      |
                  -------------------     -----------------
                        |                        |
                        |                        |
                        |                        |
                        |     -------------------
                        v    v
                      ---------           --------------
                     | PAYMENT |         | PAYMENT WITH |
                     | (first) |         |   DELIVERY   |
                      ---------           --------------
                          |
                           ----------------
                                           |
         ----------        ---------       |
        | DELIVERY |      | PAYMENT |      |
        |          |      | {second)|      |
         ----------        ---------       |
                                           |
                                            -----------------> STOP

   *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*

                   Figure 25 Baseline Deposit IOTP Transaction
```

IOTP 트랜잭션의 특정 인스턴스에 적용되는 문서 교환 조합을 결정하려면 섹션 9.1.12 "문서 교환의 유효한 조합"을 참조하십시오.

```text
   Note that:
```

o 가맹점\(금융 기관\)은 다양한 유형의 전자 현금으로 예금을 받을 수 있지만, 전자 현금을 예치하는 소비자 역할은 일반적으로 어떤 유형의 현금을 예치할지 알고 있으므로 일반적으로 제한됩니다.

- 실제로는 한 가지 유형에만 적용됩니다. 그러나 동일한 "브랜드"의 전자 현금에 사용될 수 있는 여러 가지 프로토콜이 있을 수 있습니다. 이 경우 사용할 프로토콜을 협상하는 데 브랜드 종속 제안이 적절할 수 있습니다.

o 가맹점\(금융기관\)은 인증 결과를 이용하여 소비자뿐만 아니라 결제금액을 입금할 계좌도 식별할 수 있습니다. 단일 계정을 식별할 수 없는 경우 다른 방법으로 획득해야 합니다. 예를 들어:

- - 소비자는 기본 예금 IOTP 거래가 시작되기 전에 계좌 번호를 지정할 수 있습니다. 또는

- - 소비자는 예를 들어 기본 인증 IOTP 거래를 사용하고 금융 기관이 제공한 목록에서 선택한 계정을 사용하여 이전에 식별되었을 수 있습니다.

o 인증 문서 교환 없이 기본 예금 IOTP 거래를 사용할 수 있습니다.

- 이전 IOTP 트랜잭션\(예: 기준선\)인 경우

- 출금 또는 기본 인증을 통해 소비자를 인증하고 보안 채널이 유지되어 소비자의 진위 여부가 알려집니다.

- - 고유 지불 프로토콜의 일부로 인증이 달성되어 지불 문서 교환에 포함되는 경우

- - 소비자 인증이 IOTP 범위를 벗어나는 다른 수단\(예: 비밀번호 문구 또는 독점 뱅킹 소프트웨어 솔루션 사용\)을 통해 달성된 경우.

---
### **9.1.8 Baseline Purchase IOTP Transaction**

기본 구매 IOTP 거래는 모든 결제 방법을 사용하여 상품 또는 서비스 구매를 지원합니다. 이는 다음과 같은 문서 교환으로 구성됩니다.

```text
   o  an optional Authentication Document Exchange (see section 9.1.1)

   o  an Offer Document Exchange (see section 9.1.2)

   o  either:
```

- - 지급 문서 교환\(9.1.3항 참조\) 이후

```text
      -  a Delivery Document Exchange (see section 9.1.4)
```

o 지급 서류 교환만 가능, 또는

o 결합된 지불 및 배송 문서 교환\(9.1.5항 참조\).

이러한 문서 교환이 결합되는 방식은 아래 다이어그램에 설명되어 있습니다.

```text
   *+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*

   START -----------------------------------------------------
      |                                                       v
      |                                                ----------------
      |                                               | AUTHENTICATION |
      |                                                ----------------
       --------------------------------------               |    |
                       |                     |              |    |
                       |      -------------- | -------------     |
                       v      v              v      v            |
                  -------------------     -----------------      |
                 | BRAND INDEPENDENT |   | BRAND DEPENDENT |     |
                 |       OFFER       |   |      OFFER      |     |
                  -------------------     -----------------      |
                        |    |                   |   |           |
                        |     ---------------    |   |           |
                        |                    |   |   |           |
                        |     -------------- | --    |           |
                        v    v               v       v           |
                      ---------           --------------         |
                     | PAYMENT |         | PAYMENT WITH |        |
                     | (first) |         |   DELIVERY   |        |
                      ---------           --------------         |
                          |                      |               |
              -----------------------------      |               |
              v                            |     |               |
         ----------        ---------       |     |               |
        | DELIVERY |      | PAYMENT |      |     |               |
        |          |      | {second)|      |     |               |
         ----------        ---------       |     |               |
              |                            |     |               v
               ----------------------------------------------> STOP

   *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*

                  Figure 26 Baseline Purchase IOTP Transaction
```

IOTP 트랜잭션의 특정 인스턴스에 적용되는 문서 교환 조합을 확인하려면 섹션 9.1.12 "문서 교환의 유효한 조합"을 참조하십시오.

---
### **9.1.9 Baseline Refund IOTP Transaction**

비즈니스 측면에서 환불 프로세스는 일반적으로 다음으로 구성됩니다.

o 소비자가 판매자에게 환불을 요청하는 경우 일반적으로 다음을 입증하는 증거로 뒷받침됩니다.

- - 원래 거래가 발생했습니다\(예: 원래 거래에 대한 영수증 제공\).

- - 일부 유형의 인증을 사용하여 환불을 요청하는 소비자가 원래 거래를 수행한 소비자 또는 소비자의 대리인임을 확인합니다.

- - 판매자가 환불을 해야하는 이유

o 판매자가 환불에 동의\(또는 동의하지 않음\)합니다. 여기에는 소비자와 판매자 간의 협상이 포함될 수 있으며, 판매자가 동의하는 경우

o 판매자가 소비자에게 지불한 환불금.

기본 환불 IOTP 거래는 위의 하위 집합을 지원하며 특히 다음을 지원합니다.

```text
   o  stand alone authentication of the Consumer using a separate
      Baseline Authentication IOTP Transaction (see section 9.1.6)
```

o 다음 두 가지 거래소를 통해 판매자가 소비자에게 지불한 금액을 환불합니다.

```text
      -  an optional Authentication Document Exchange (see section
         9.1.1)
```

- - 문서 교환 제안\(섹션 9.1.2 참조\), 그리고

- - 지급 문서 교환\(9.1.3항 참조\).

이러한 문서 교환이 결합되는 방식은 아래 다이어그램에 설명되어 있습니다.

```text
   *+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*

   START -----------------------------------------------------
      |                                                       v
      |                                                ----------------
      |                                               | AUTHENTICATION |
      |                                                ----------------
       --------------------------------------               |
                       |                     |              |
                       |      -------------- | -------------
                       v      v              v      v
                  -------------------     -----------------
                 | BRAND INDEPENDENT |   | BRAND DEPENDENT |
                 |       OFFER       |   |      OFFER      |
                  -------------------     -----------------
                        |                        |
                        |                        |
                        |                        |
                        |     -------------------
                        v    v
                      ---------           --------------
                     | PAYMENT |         | PAYMENT WITH |
                     | (first) |         |   DELIVERY   |
                      ---------           --------------
                          |
                           ----------------
                                           |
         ----------        ---------       |
        | DELIVERY |      | PAYMENT |      |
        |          |      | {second)|      |
         ----------        ---------       |
                                           |
                                            -----------------> STOP

   *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*

                   Figure 27 Baseline Refund IOTP Transaction
```

인증 문서 교환 없이 기본 환불 IOTP 거래를 사용할 수 있습니다.

o 다른 수단으로 소비자 인증이 달성된 경우, 예를 들어 소비자는 자신과 해당 코드가 적용되는 환불을 식별하기 위해 이전에 제공된 일부 코드를 입력했습니다. 코드는 웹페이지나 이메일 등을 통해 제공될 수 있습니다.

o 이전 IOTP 트랜잭션\(예: Baseline\)인 경우

- 인증, 소비자 인증, 안전한 채널이 유지되어 소비자의 진위 여부를 알 수 있어 사전에 약정된 환불액을 확인할 수 있습니다.

o 결제 방식 인증 알고리즘을 사용하여 결제 처리자가 소비자 인증을 수행하는 경우.

---
### **9.1.10 Baseline Withdrawal IOTP Transaction**

기본 인출 IOTP 거래는 금융 기관에서 전자 현금 인출을 지원합니다.

참고: IOTP 용어에서 금융 기관은 수수료\(예: 일종의 은행 수수료\)에 대한 대가로 서비스\(예: 전자 현금 인출\)를 제공하는 판매자의 역할을 갖습니다. 명확성을 위해 도표와 본문에서는 "금융 기관"이라는 용어를 사용했습니다.

기본 출금 IOTP 거래는 다음 문서 교환으로 구성됩니다.

```text
   o  an optional Authentication Document Exchange (see section 9.1.1)
```

o 문서 교환 제안\(섹션 9.1.2 참조\), 그리고

o 지급 문서 교환\(9.1.3항 참조\).

이러한 문서 교환이 함께 결합되는 방식은 아래 다이어그램에 설명되어 있습니다.

```text
   *+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*

   START -----------------------------------------------------
      |                                                       v
      |                                                ----------------
      |                                               | AUTHENTICATION |
      |                                                ----------------
       --------------------------------------               |
                       |                     |              |
                       |      -------------- | -------------
                       v      v              v      v
                  -------------------     -----------------
                 | BRAND INDEPENDENT |   | BRAND DEPENDENT |
                 |       OFFER       |   |      OFFER      |
                  -------------------     -----------------
                        |                        |
                        |                        |
                        |                        |
                        |     -------------------
                        v    v
                      ---------           --------------
                     | PAYMENT |         | PAYMENT WITH |
                     | (first) |         |   DELIVERY   |
                      ---------           --------------
                          |
                           ----------------
                                           |
         ----------        ---------       |
        | DELIVERY |      | PAYMENT |      |
        |          |      | {second)|      |
         ----------        ---------       |
                                           |
                                            -----------------> STOP

   *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*

                 Figure 28 Baseline Withdrawal IOTP Transaction

   Note that:
```

o 가맹점\(금융 기관\)은 다양한 유형의 전자 현금 인출을 제안할 수 있습니다. 실제로는 일반적으로 한 가지 형태의 전자 현금만 제공될 수 있습니다. 그러나 동일한 "브랜드"의 전자 현금에 사용될 수 있는 여러 가지 프로토콜이 있을 수 있습니다.

o 가맹점\(금융기관\)은 인증 결과를 이용하여 소비자뿐만 아니라 출금 계좌를 식별할 수도 있습니다. 단일 계정을 식별할 수 없는 경우 다른 방법으로 획득해야 합니다. 예를 들어:

- - 소비자는 기본 인출 IOTP 거래가 시작되기 전에 계좌 번호를 지정할 수 있습니다. 또는

- - 소비자는 예를 들어 기본 인증 IOTP 거래를 사용하고 금융 기관이 제공한 목록에서 선택한 계정을 사용하여 이전에 식별되었을 수 있습니다.

o 인증 없이 기본 인출을 사용할 수 있습니다.

- - 이전 IOTP 거래\(예: 기준 예금 또는 기준 인증\)가 소비자를 인증하고 보안 채널이 유지되는 경우 소비자의 진위 여부가 알려집니다.

- - 고유 지불 프로토콜의 일부로 인증이 달성되어 지불 문서 교환에 포함되는 경우

- - 소비자 인증이 비밀번호 문구나 독점 뱅킹 소프트웨어 솔루션 등 다른 수단을 통해 달성된 경우.

---
### **9.1.11 Baseline Value Exchange IOTP Transaction**

기준 가치 교환 거래는 지급 문서 교환을 사용하여 하나의 결제 방법을 사용하여 획득한 하나의 통화 가치와 동일하거나 다른 결제 방법을 사용하는 동일 또는 다른 통화의 가치 교환을 지원합니다. 사용 예는 다음과 같습니다.

o 신용 카드로 전자 현금 서비스 제공. 예를 들어, 첫 번째 결제는 신용카드를 사용한 "달러 SET 결제"이고, 두 번째 결제는 달러로 Visa Cash e-cash를 다운로드하는 것일 수 있습니다.

o 동일한 결제수단을 이용한 외환. 예를 들어 결제는 영국 파운드로 Mondex 가치를 업로드하고 두 번째는 유로로 Mondex 가치를 다운로드하는 것일 수 있습니다.

o 다양한 지불 방법을 사용한 외환. 예를 들어, 첫 번째 결제는 캐나다 달러로 SET 결제를 한 후 Deutchmarks로 GeldKarte를 다운로드하는 것일 수 있습니다.

기준 가치 교환은 다음 문서 교환을 사용합니다.

```text
   o  an optional Authentication Document Exchange (see section 9.1.1)
```

o 교환할 가치와 통화에 대한 세부 정보를 제공하는 문서 교환 제안\(섹션 9.1.2 참조\), 그리고

o 관련된 두 가지 지불을 수행하는 두 가지 지불 문서 교환\(섹션 9.1.3 참조\).

이러한 문서 교환이 함께 결합되는 방식은 아래 다이어그램에 설명되어 있습니다.

```text
   *+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*

   START -----------------------------------------------------
      |                                                         v
      |                                                ----------------
      |                                               | AUTHENTICATION |
      |                                                ----------------
       --------------------------------------               |
                       |                     |              |
                       |      -------------- | -------------
                       v      v              v      v
                  -------------------     -----------------
                 | BRAND INDEPENDENT |   | BRAND DEPENDENT |
                 |       OFFER       |   |      OFFER      |
                  -------------------     -----------------
                        |                        |
                        |                        |
                        |                        |
                        |     -------------------
                        v    v
                      ---------           --------------
                     | PAYMENT |         | PAYMENT WITH |
                     | (first) |         |   DELIVERY   |
                      ---------           --------------
                          |
                           ----
                               v
         ----------        ---------
        | DELIVERY |      | PAYMENT |
        |          |      | {second)|
         ----------        ---------
                               |
                                -----------------------------> STOP

   *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*

               Figure 29 Baseline Value Exchange IOTP Transaction
```

기준 가치 교환 IOTP 트랜잭션은 두 가지 기본 형태로 발생합니다.

o 브랜드 의존적 가치 교환. 제안의 내용\(예: 한 형태의 가치가 다른 가치로 교환되는 비율\)이 소비자가 선택한 결제 브랜드 및 프로토콜에 따라 달라지는 경우

o 브랜드 독립적인 가치 교환. 제안의 내용은 선택한 결제 브랜드 및 프로토콜에 따라 달라지지 않습니다.

참고: 위의 역할은 가치 교환을 수행하는 조직이 은행이나 기타 금융 기관일 수 있더라도 판매자입니다. 이는 은행이 소비자가 수락하거나 거절할 수 있는 제안을 한다는 점에서 판매자 역할을 하기 때문입니다.

TPO 블록과 제안 응답 블록은 가치 교환에 사용할 결제 브랜드와 지불 프로토콜을 선택한 결과 제안 응답 블록의 내용이 변경되지 않는 경우에만 동일한 IOTP 메시지로 결합될 수 있습니다.

```text
   BASELINE VALUE EXCHANGE SIGNATURES
```

기준 가치 교환의 무결성을 보장하기 위한 서명 사용은 아래 다이어그램에 설명되어 있습니다.

```text
*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*

Signature generated                  IotpMsg (TPO)
by Merchant ensures                  - Trans Ref Block
integrity of the Offer -------->  -  - Signature Block
                                 |   - TPO Block              MERCHANT
                                 |   - Offer Response Block
                                 |
Signature generated by           |
the Payment Handler of           |   IotpMsg (Pay Resp 1)
the first payment binds          |   - Trans Ref Block         PAYMENT
Pay Receipt for the first ----->  -> - Signature Block -----   HANDLER
payment to the Offer                 - Pay Response Block 1 |    1
                                                            |
Signature generated by                                      |
the Payment Handler of           IotpMsg (Pay Resp 2)       |  PAYMENT
the second payment binds           - Trans Ref Block        |  HANDLER
the second payment to the ----->   - Signature Block <------     2
first payment and therefore        - Pay Response Block 2
to the Offer

*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*

              Figure 30 Baseline Value Exchange Signatures
```

---
### **9.1.12 Valid Combinations of Document Exchanges**

다음 다이어그램은 문서 교환 조합이 유효한지 여부를 결정하기 위해 소비자 거래 역할에서 사용할 수 있는 다양한 IOTP 메시지의 데이터 조건을 보여줍니다.

```text
   *+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*

   START
     |
     v
   Auth Request Block in  =TRUE
    first IOTP Message ? ---------------------------------------
      | = FALSE                                                 |
      v                                                         v
   Offer Response Block in                             ----------------
     first IOTP Message ?                             | AUTHENTICATION |
      |=TRUE         |=FALSE                           ----------------
      |              |                                        |
      |              |                                        v

      |                ----------------------       TPO & Offer Response
       -------------                         |   Blocks in last IOTP Msg
                    |                        |     |=TRUE        |=FALSE
                    |                        |     |             v
                    |          ------------- | ----    TPO Block only if
                    |         |              |         last IOTP Message
                    |         |              |         of Authentication
                    |         |              |          |=TRUE   |=FALSE
                    v         v              v          v        |
                  -------------------     -----------------      |
                 | BRAND INDEPENDENT |   | BRAND DEPENDENT |     |
                 |       OFFER       |   |      OFFER      |     |
                  -------------------     -----------------      |
                          |                   |                  |
                          v                   v                  |
                       Offer Response Block contains             |
                             Delivery Component ?                |
                            |=FALSE        |=TRUE                |
                         ---               v                     |
                        |        Value of DelivAndPayResp        |
                        |    attribute of Delivery Component ?   |
                        |    |=FALSE         |=TRUE              |
                        |    |               |                   |
                        v    v               v                   |
                      ---------           --------------         |
                     | PAYMENT |         | PAYMENT WITH |        |
                     | (first) |         |   DELIVERY   |        |
                      ---------           --------------         |
                          |                      |               |
                          v                      |               |
            Offer and Response Block contains     -------------->|
                  Delivery Component ?                           |
                  |=TRUE           |=FALSE                       |
                  |                v                             |
                  |         Two Payment Components               |
                  |      present in Offer Response Block?        |
                  |           |=TRUE             |=FALSE         |
                  v           v                  |               |
         ----------        ---------             |               |
        | DELIVERY |      | PAYMENT |            |               |
        |          |      | {second)|            |               |
         ----------        ---------             |               |
              |                |                 |               v
               ----------------------------------------------> STOP

   *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
```

- 그림 31 유효한 문서 교환 조합

1\) IOTP 트랜잭션의 첫 번째 IOTP 메시지에

- 인증 요청 후:

```text
      a) IOTP Transaction includes an Authentication Document Exchange
         (see section 9.1.1). (Note 1)
```

- b\) 인증 문서 교환의 마지막 IOTP 메시지에 TPO 블록과 제안 응답 블록이 포함되어 있는 경우:

```text
         i) IOTP Transaction includes a Brand Independent Offer Document
            Exchange (see section 9.1.2.2). (Note 2)
```

- c\) 그렇지 않고 인증 교환의 마지막 IOTP 메시지에 TPO 블록이 포함되어 있지만 제안 응답 블록이 없는 경우:

```text
         i) IOTP Transaction includes a Brand Dependent Offer Document
            Exchange (see section 9.1.2.1). (Note 2)

      d) Otherwise (Authentication Status IOTP Message of the
         Authentication Document Exchange contains neither a TPO Block
         but nor an Offer Response Block)

         i) IOTP Transaction consists of just an Authentication Document
            Exchange. (Note 3)
```

2\) 그렇지 않은 경우\(첫 번째 IOTP 메시지에 인증 요청이 없음\):

```text
      e) IOTP Transaction does not include an Authentication Document
         Exchange (Note 2)
```

- f\) 첫 번째 IOTP 메시지에 제안 응답 블록이 포함된 경우:

```text
         i) the IOTP Transaction contains a Brand Independent Offer
            Document Exchange (Note 2)
```

- g\) 그렇지 않은 경우\(첫 번째 IOTP 메시지에 응답 블록 제공 없음\):

```text
         i) the IOTP Transaction includes a Brand Dependent Offer
            Document Exchange (Note 2)
```

3\) IOTP 메시지에 제안 응답 블록이 있는 경우:

- h\) 제안 응답 블록에 전달 구성요소가 포함된 경우:

- i\) Delivery Component의 DelivAndPayResp 속성이 True로 설정된 경우:

```text
            (1) the IOTP Transaction consists of a Payment And Delivery
                Document Exchange (see section 9.1.5) (Note 4)

        ii) otherwise (the DelivAndPayResp attribute of the Delivery
            Component is set to False)

            (1) the IOTP Transaction consists of a Payment Document
                Exchange (see section 9.1.3) followed by a Delivery
                Document Exchange (see section 9.1.4) (Note 4)

      i) otherwise (the Offer Response Block does not contain a Delivery
         Component)
```

- i\) 제안 응답 블록에 하나의 지불 구성요소만 포함된 경우:

```text
            (1) the IOTP Transaction contains just one Payment Document
                Exchange (Note 5)
```

- ii\) 제안 응답 블록에 두 개의 지불 구성요소가 포함된 경우:

```text
            (1) the IOTP Transaction contains two Payment Document
                Exchanges.  The StartAfter attribute of the Payment
                Components is used to indicate which payment occurs
                first (Note 6)

       iii) if the Offer Response Block contains no or more than two
            Payment Components, then there is an error
```

4\) 그렇지 않으면\(오퍼 응답 블록 없음\) 오류가 발생합니다.

다음 표는 위에 표시된 조건을 유효하게 가질 수 있는 IOTP 트랜잭션의 유형을 나타냅니다.

```text
   Note                     IOTP Transaction Validity
```

1. 모든 결제 및 인증 IOTP 거래

2. 기본 인증을 제외한 모든 결제 및 인증 IOTP 거래

3. 기본 인증 또는 실패한 인증으로 인한 기본 구매, 환불, 예금, 출금 또는 가치 교환

```text
   4. Baseline Purchase only
```

5. 기본 구매, 환불, 입금 또는 출금

```text
   6. Baseline Value Exchange only
```

---
### **9.1.13 Combining Authentication Transactions with other Transactions**

이전 섹션에서는 인증 문서 교환이 동일한 IOTP 트랜잭션 ID를 가진 단일 IOTP 트랜잭션의 일부로 제안 문서 교환 앞에 표시되었습니다.

또한 다른 IOTP 트랜잭션과 병행하여 언제든지 별도의 인증 트랜잭션을 실행할 수도 있습니다. 일반적으로 다음과 같이 사용됩니다.

o 소비자가 판매자, 지불 처리자 또는 배송 처리자를 인증하기 위해, 또는

o 결제 처리자 또는 배달 처리자를 통해 소비자를 인증합니다.

개요적으로 기본 프로세스는 다음과 같이 구성됩니다.

o 거래를 수행하기로 결정하는 거래 역할

- 다른 역할의 인증으로 인해 현재 수행 중인 IOTP 트랜잭션이 일시 중지됩니다.

o 그런 다음 독립형 인증 트랜잭션이 수행됩니다. 이는 구현자의 선택에 따라 트랜잭션 참조 블록의 관련 구성 요소\(섹션 3.3.3 참조\)를 사용하여 원본 IOTP 트랜잭션에 연결될 수 있습니다.

o 인증 트랜잭션이 성공하면 원래 IOTP 트랜잭션이 다시 시작됩니다.

o 인증이 실패하면 원래 IOTP 트랜잭션이 취소됩니다.

예를 들어 소비자는 다음을 수행할 수 있습니다.

o 판매자로부터 제안 응답을 받은 후 해당 결제 핸들러에게 결제 요청을 보내기 전에 결제에 대한 결제 핸들러를 인증합니다.

o 결제 핸들러로부터 결제 응답을 수신한 후 배달 요청을 보내기 전 사이에 배달에 대한 배달 핸들러를 인증합니다.

결제 핸들러는 결제 요청을 받은 후 다음 결제 관련 메시지를 보내기 전에 소비자를 인증할 수 있습니다.

배달 핸들러는 배달 요청을 받은 후 배달 응답을 보내기 전에 소비자를 인증할 수 있습니다.

참고: 일부 결제 방법은 결제 교환 내에서 인증을 수행할 수 있습니다. 이 경우 인증을 수행하는 데 필요한 정보는 결제 체계 구성 요소에 포함됩니다.

이 경우 IOTP 인식 애플리케이션은 인증 요청 정보가 포함된 결제 체계 구성요소가 다른 결제 체계 구성요소와 구별되지 않으므로 인증이 발생했다는 사실을 인식하지 못합니다.

---
## **9.2 Infrastructure Transactions**

인프라 트랜잭션은 트랜잭션이 성공했는지 또는 거래 역할의 서버가 올바르게 작동하는지에 대한 문의를 지원하도록 설계되었습니다. 거래에는 두 가지 유형이 있습니다.

o 다음을 제공하는 거래 상태 조회 거래

- 기존 또는 전체 IOTP 트랜잭션 상태에 대한 정보

o 하나의 IOTP 인식 응용 프로그램이 다른 거래 역할의 IOTP 인식 응용 프로그램이 작동 중인지 확인하고 서명을 처리할 수 있는지 여부를 확인할 수 있는 Ping 트랜잭션입니다.

이들 각각은 아래에 설명되어 있습니다.

---
### **9.2.1 Baseline Transaction Status Inquiry IOTP Transaction**

기준 IOTP 트랜잭션 상태 조회는 기존 또는 전체 IOTP 트랜잭션의 상태에 대한 정보를 제공합니다.

기본 거래 상태 조회 거래에 사용되는 거래 블록은 다음과 같습니다.

```text
   o  an Inquiry Request Trading Block (see section 8.12),

   o  an Inquiry Response Trading Block (see section 8.13)
```

o 선택적 서명 블록\(섹션 8.16 참조\).

Inquiry IOTP 트랜잭션은 다양한 이유로 사용될 수 있습니다. 예를 들어:

o 다른 역할 중 하나의 현재 처리 상태를 확인하기 위해 일시 ​​중지된 트랜잭션을 재개하는 데 도움을 주기 위해,

o 판매자가 결제, 배송 등이 완료되었는지 확인합니다. 예를 들어 소비자는 결제가 이루어졌지만 이를 증명할 수 있는 서명된 IOTP 결제 영수증이 없다고 주장할 수 있습니다. 판매자가 결제 처리자에게 문의하면 판매자는 결제가 이루어졌는지 여부를 확인할 수 있습니다.

참고: 기준 Ping IOTP 트랜잭션에 대한 문의\(섹션 9.2.2 참조\)는 무시됩니다.

다른 거래 역할에 대한 문의

하나의 거래 역할은 언제든지 다른 거래 역할을 조회할 수 있습니다.

소비자 거래 역할을 지원하는 IOTP 인식 소프트웨어는 다음을 수행할 수 없습니다.

o 응답에 기능이 없을 수 있으므로 요청 시 응답에 디지털 서명을 합니다.

o 질의 요청이 온라인이 아니기 때문에 전혀 응답하지 않거나, 예를 들어 요청이 디지털 서명되지 않았기 때문에 요청이 합리적이지 않다고 생각할 수 있습니다.

지침:

o 소비자는 다음 이벤트가 발생한 후에만 거래 역할에 거래 상태 조회 블록을 보내야 합니다.

- - 판매자에게 TPO 선택 블록을 보낸 후,

- - 결제 처리자에게 결제 요청 블록을 보낸 후,

- - Delivery Handler로 Delivery Request Block을 보낸 후,

o 다른 거래 역할은 소비자로부터 메시지를 받은 후 최종 "응답" 메시지를 소비자에게 보내기 전에만 소비자에게 거래 상태 조회 블록을 보내야 합니다.

o 비소비자 거래 역할이 다른 거래 역할에 문의를 보내는 데에는 제한이 없습니다.

```text
   TRANSACTION STATUS INQUIRY TRANSPORT SESSION
```

진행 중인 트랜잭션에 대한 트랜잭션 상태 조회의 경우 진행 중인 트랜잭션과 다른 전송 세션이 사용됩니다. 과거 트랜잭션에 대한 트랜잭션 상태 조회의 경우 IOTP가 어떻게

거래 역할의 소프트웨어 모듈은 IOTP에 대한 각 매핑 대 전송 보충 자료에 정의된 문의 요청 메시지 수신 시 시작됩니다.

```text
   TRANSACTION STATUS INQUIRY ERROR HANDLING
```

거래현황조회 오류는 다음 세 가지 경우 중 하나로 분류할 수 있습니다.

o 원본\(조회\) 메시지의 비즈니스 오류\(섹션 4.2 참조\)

o 원본 IOTP\(조회\) 메시지의 기술적 오류\(섹션 4.1 참조\) - IOTP 및 결제 체계 관련 오류 모두

o 문의 요청 블록 자체가 포함된 메시지에 기술적인 오류가 있습니다.

다음은 각 경우에 소프트웨어가 수행해야 하는 작업을 간략하게 설명합니다.

원본 메시지의 비즈니스 오류

소비자 역할에 마지막으로 전송된 상태 구성 요소가 포함된 조회 응답 블록을 반환합니다.

원본 메시지의 기술적 오류

상태 구성요소가 포함된 조회 응답 블록을 반환합니다. 상태 구성 요소에는 ProcessError로 설정된 ProcessState 특성이 포함되어야 합니다. 이 경우 원본 메시지에서 오류가 발견된 위치를 나타내는 오류 블록을 다시 보냅니다.

문의 요청 블록의 기술적 오류

오류 메시지를 반환합니다. 즉, 조회 요청 메시지의 오류 성격을 설명하는 오류 코드\(섹션 7.21.2 참조\)가 포함된 오류 블록을 다시 보냅니다.

```text
   INQUIRY TRANSACTION MESSAGES
```

다음 그림은 기준 IOTP 트랜잭션 상태 조회 프로세스를 간략하게 설명합니다.

```text
 *+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*+*
```

첫 번째 역할 | 두 번째 역할
단계 | | 1. 첫 번째 역할은 예를 들어 IOTP 인식 애플리케이션의 조회 버튼을 클릭하여 IOTP 트랜잭션을 조회하기로 결정합니다. 그러면 조회 요청 블록이 생성되어 적절한 거래 역할로 전송됩니다.

```text
     1 --> 2 INQUIRY REQUEST. IotpMsg: TransRef Block; Signature Block
             (optional); Inquiry Request Block
```

2. 거래 역할은 디지털 서명\(있는 경우\)을 확인합니다. 수신자가 응답을 원하면 거래 역할은 트랜잭션 참조 블록의 트랜잭션 ID 구성 요소에 있는 IotpTransId를 사용하여 조회 중인 트랜잭션의 트랜잭션 상태를 확인한 다음 적절한 조회 응답 블록을 생성하고 메시지를 다시 보냅니다. 첫 번째 역할로 이동하고 중지합니다.

```text
     1 <-- 2 INQUIRY RESPONSE. IotpMsg: TransRef Block; Inquiry
             Response Block; Signature Block (Optional)
```

3. 첫 번째 역할은 문의 응답 블록 및 선택적 서명을 확인하고 적절한 조치를 취하거나 중지할 수도 있습니다. 여기에는 최종 사용자에게 상태 정보를 표시하는 것이 포함될 수 있습니다.

```text
 *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*

                Figure 32 Baseline Transaction Status Inquiry
```

기본 거래 상태 조회 IOTP 거래에 대한 이 하위 섹션의 나머지 부분은 각 거래 블록의 내용을 정의합니다. "원래 거래"라는 용어는 거래 역할이 일부 정보를 검색하려는 거래입니다.

```text
   TRANSACTION REFERENCE BLOCK
```

조회를 수행하는 거래 역할은 IotpTransId 및 TransTimeStamp 속성이 모두 조회 중인 원래 거래의 거래 ID 구성 요소와 동일한 거래 ID 구성 요소\(섹션 3.3.1 참조\)를 사용해야 합니다. 이 구성 요소의 IotpTransId 특성은

거래 역할 사이트에서 유지되는 거래 로그. 메시지 ID 구성요소의 ID 속성 값은 원래 트랜잭션의 ID 속성 값과 달라야 합니다\(섹션 3.4.1 참조\).

최신 상태 정보가 필요한 경우 MsgId 구성 요소, 특히 MsgId 구성 요소의 ID 속성은 거래 역할에서 보낸 다른 IOTP 메시지와 달라야 합니다. 이는 IOTP가 멱등성을 처리하는 방식 때문에 필요합니다\(섹션 4.5.2.2 중복 메시지 확인/처리 참조\).

```text
   INQUIRY REQUEST BLOCK
```

문의 요청 블록\(섹션 8.12 참조\)에는 다음 구성 요소가 포함되어 있습니다.

o 하나의 문의 유형 구성요소\(섹션 7.18 참조\). 이는 문의가 제안, 결제 또는 배송에 관한 것인지 식별합니다.

o 0개 또는 1개의 지불 체계 구성 요소\(섹션 7.10 참조\). 결제 문의에 대한 결제 방식별 문의 메시지를 캡슐화하기 위한 것입니다.

```text
   SIGNATURE BLOCK (INQUIRY REQUEST)
```

조회 요청 블록이 포함된 메시지에 서명 블록이 있는 경우 조회 요청이 승인되었는지 확인하기 위해 확인할 수 있습니다.

존재하는 경우 문의 요청 서명 블록\(섹션 8.12 참조\)에는 다음 구성 요소가 포함됩니다.

```text
   o  one Signature Component (see section 7.19)
```

o 필요한 경우 하나 이상의 인증서 구성요소.

문의 응답 블록은 거래가 승인된 경우에만 생성되어야 합니다.

참고: 조회 요청의 디지털 서명은 요청 수신자가 조회 요청에 서명할 것으로 예상하는 경우에만 발생할 수 있습니다. 이 IOTP 버전에서는 일종의 사전 합의가 필요합니다. 이는 다음을 의미합니다.

o 소비자는 서명이 있는 요청을 생성할 가능성이 낮습니다. 하지만 그렇게 하면 오류는 아닙니다.

o 다른 거래 역할은 디지털 서명이 필요하다는 데 동의할 수 있습니다. 예를 들어 결제 처리자는 요청이 유효한지 확인할 수 있도록 판매자가 문의 요청에 디지털 서명을 요구할 수 있습니다.

반면에 문의와 관련된 원래 거래가 보안 채널\(예: \[SSL\]\)을 통해 수행된 경우 문의 보낸 사람이 원본 메시지의 거래 ID 구성 요소를 알고 있다고 가정하는 것이 합리적일 수 있습니다. \(예를 들어 타임스탬프 포함\) 그러면 문의가 진짜일 가능성이 높습니다.

```text
   INQUIRY RESPONSE BLOCK
```

문의 응답 블록\(섹션 8.13 참조\)에는 다음 구성 요소가 포함되어 있습니다.

o 하나의 상태 구성 요소\(섹션 7.16 참조\). 이 구성요소는 조회된 트랜잭션에 대한 상태 정보를 보유하며,

o 0개 또는 1개의 지불 체계 구성요소. 여기에는 결제 문의에 대한 결제 방식별 문의 메시지가 캡슐화되어 있습니다.

```text
   SIGNATURE BLOCK (INQUIRY RESPONSE)
```

조회 응답 블록을 포함하는 메시지에 서명 블록이 있는 경우 조회 응답이 유효한지 확인하기 위해 블록 수신자가 서명 블록을 확인할 수 있습니다.

존재하는 경우 문의 응답 서명 블록\(섹션 8.13 참조\)에는 다음 구성 요소가 포함됩니다.

```text
   o one Signature Component (see section 7.19)
```

o 필요한 경우 하나 이상의 인증서 구성요소.

참고: 문의 응답의 디지털 서명은 응답 수신자가 문의 요청에 서명할 것으로 예상하는 경우에만 발생할 수 있습니다. 이 IOTP 버전에서는 일종의 사전 합의가 필요합니다. 이는 다음을 의미합니다.

o 소비자는 서명이 있는 응답을 생성할 가능성이 낮습니다. 하지만 그렇게 하면 오류는 아닙니다.

o 다른 거래 역할은 디지털 서명이 필요하다는 데 동의할 수 있습니다. 예를 들어 판매자는 요청 응답이 유효한지 확인할 수 있도록 결제 처리자가 문의 응답에 디지털 서명을 요구할 수 있습니다.

---
### **9.2.2 Baseline Ping IOTP Transaction**

기준 IOTP 핑 트랜잭션의 목적은 IOTP 트랜잭션에 참여할 수 있는 거래 역할 간의 기본 연결을 테스트하는 것입니다.

```text
   It enables IOTP aware application software to:
```

o 다른 거래 역할의 IOTP 인식 애플리케이션이 작동 중인지 확인하고,

o 두 가지 거래 역할 서명이 처리될 수 있는지 여부를 확인하십시오.

예를 들어 판매자는 해당 거래 역할을 사용하는 구매 거래를 시작하기 전에 지불 처리기 또는 배달 처리기가 작동되어 실행 중인지 확인하는 데 사용할 수 있습니다.

베이스라인 Ping IOTP 거래에 사용되는 거래 블록은 다음과 같습니다.

```text
   o a Ping Request Block (see section 8.14)
```

o 핑 응답 블록\(섹션 8.15 참조\), 그리고

o 서명 블록\(섹션 8.16 참조\).

```text
   PING MESSAGES
```

다음 그림은 기준 IOTP Ping 트랜잭션의 메시지 흐름을 간략하게 설명합니다.

\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+\*+ \*+\*+\*+\*+\*+\*+\*+\*+\*+\* 1차 역할 | 두 번째 역할
단계 | | 1. 첫 번째 거래 역할의 IOTP 인식 애플리케이션은 상대방 IOTP 애플리케이션이 실행 중인지 확인하기로 결정합니다. Ping 요청 블록과 선택적 서명 블록을 생성하여 두 번째 거래 역할로 보냅니다.

```text
     1 --> 2 PING REQUEST. IotpMsg: Trans Ref Block; Signature Block
             (Optional); Ping Request Block
```

2. Ping 요청 블록을 수신하는 두 번째 거래 역할은 Ping 응답 블록을 생성하고 필요한 경우 서명 블록과 함께 원래 Ping 요청 보낸 사람에게 다시 보냅니다.

```text
     1 <-- 2 PING Response. IotpMsg: Trans Ref Block; Signature Block
             (Optional); Ping Response Block
```

3. 첫 번째 거래 역할은 핑 응답 블록을 확인하고 필요한 경우 적절한 조치를 취합니다.

```text
 *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*

                      Figure 33 Baseline Ping Messages
```

서명이 처리될 수 있다는 확인은 다음을 포함하여 Ping 요청 블록의 발신자에 의해 표시됩니다.

o 자신과 Ping 요청 블록의 의도된 수신자를 식별하는 조직 구성 요소

o Ping 요청의 데이터에 서명하는 서명 블록.

이런 방식으로 Ping 요청 수신자는 다음을 수행합니다.

o 누가 Ping 요청을 보내는지 알고 있으므로 요청의 서명을 확인할 수 있습니다.

o Ping 응답에 대한 서명을 생성할 사람을 알고 있습니다.

Ping 요청에 유의하세요.

```text
   o  does not affect any on-going transaction
```

o 다른 IOTP와 달리 IOTP 트랜잭션을 시작하지 않습니다.

- TPO 또는 거래 상태 조회와 같은 거래 메시지.

모든 IOTP 인식 애플리케이션은 Ping 요청 메시지가 수신되면 보낸 사람에게 Ping 응답 메시지를 반환해야 합니다.

기준 IOTP Ping 요청에는 선택적 서명 블록도 포함될 수 있습니다. 예를 들어, IOTP 인식 애플리케이션은 서명 블록을 사용하여 Ping 요청 수신자가 성공적으로 처리할 수 있는지 확인하고 수신한 서명을 확인할 수 있습니다.

각 기준 Ping IOTP 트랜잭션에 대해 각 IOTP 역할은 다른 IOTP 트랜잭션과 다른 전송 세션을 설정해야 합니다.

모든 IOTP 거래 역할은 원할 때 언제든지 다른 IOTP 거래 역할에 Ping 요청을 보낼 수 있습니다. Ping 메시지에는 다른 IOTP 트랜잭션과 다른 자체 IotpTransId가 있습니다.

베이스라인 Ping IOTP 거래에 대한 이 하위 섹션의 나머지 부분은 각 거래 블록의 내용을 정의합니다.

```text
   TRANSACTION REFERENCE BLOCK
```

Ping 트랜잭션의 IotpTransId는 다른 IOTP 트랜잭션과 달라야 합니다.

```text
   PING REQUEST BLOCK
```

Ping 트랜잭션이 익명인 경우 Ping 요청 블록에 조직 구성 요소가 포함되지 않습니다\(섹션 8.7 참조\).

Ping 트랜잭션이 익명이 아닌 경우 Ping 요청 블록에는 다음을 위한 조직 구성 요소가 포함됩니다.

o Ping 요청 블록의 발신자, 그리고

o 서명 구성 요소의 검증자

조직 구성 요소가 있는 경우 Ping 요청 메시지의 보낸 사람이 서명 블록을 생성했음을 나타냅니다. 서명 블록은 Ping 요청 블록을 수신하는 거래 역할에 의해 검증되어야 합니다.

```text
   SIGNATURE BLOCK (PING REQUEST)
```

Ping 요청 서명 블록\(섹션 8.16 참조\)에는 다음 구성 요소가 포함되어 있습니다.

```text
   o  one Signature Component (see section 7.19)
```

o 필요한 경우 하나 이상의 인증서 구성요소.

```text
   PING RESPONSE BLOCK
```

Ping 응답 블록\(섹션 8.15 참조\)에는 다음 구성 요소가 포함되어 있습니다.

o Ping 응답 메시지 발신자의 조직 구성 요소

Ping 트랜잭션이 익명이 아닌 경우 Ping 응답에는 다음이 추가로 포함됩니다.

o Ping 요청 블록에 포함된 조직 구성요소의 사본.

```text
   SIGNATURE BLOCK (PING RESPONSE)
```

Ping 응답 서명 블록\(8.16절 참조\)에는 다음 구성 요소가 포함되어 있습니다.

```text
   o  one Signature Component (see section 7.19)
```

o 필요한 경우 하나 이상의 인증서 구성요소.

---
## **10. Retrieving Logos**

이 섹션에서는 브랜드 요소\(섹션 7.7.1 참조\) 및 조직 구성 요소\(섹션 7.6 참조\)에 포함된 로고 네트 위치 속성을 사용하여 IOTP 인식 소프트웨어에서 표시할 로고를 검색하는 방법을 설명합니다.

```text
   The full address of a logo is defined as follows:  Logo_address ::=
   Logo_net_location "/" Logo_size Logo_color_depth ".gif"

   Where:
```

o Logo\_net\_location은 브랜드 요소\(섹션 7.7.1 참조\) 또는 조직 구성 요소의 LogoNetLocn 속성에서 가져옵니다. 참고 사항:

- - 이 속성의 내용은 사용되는 전송 메커니즘\(예: HTTP\)에 따라 달라집니다. 운송 메커니즘 보충 자료를 참조하세요.

- - 구현자는 로고 넷 위치의 가장 오른쪽 문자가 오른쪽 슬래시 "/"로 설정된 경우 로고 주소 생성 시 또 다른 오른쪽 슬래시가 포함되어서는 안 된다는 점을 확인해야 합니다.

o Logo\_size는 로고의 크기를 식별합니다.

o Logo\_color\_length는 로고의 색상 심도를 식별합니다.

o "gif"는 로고가 "gif" 형식임을 나타냅니다.

Logo\_size 및 Logo\_color\_length는 사용하려는 크기와 색상에 따라 로고를 검색하는 IOTP 소프트웨어 구현자가 지정합니다.

---
## **10.1 Logo Size**

로고에는 5가지 표준 크기가 있습니다. 픽셀 단위의 크기와 로고 크기에 해당하는 값은 아래 표에 나와 있습니다.

```text
           Size in     Logo Size
           Pixels        Value
```

32 x 32 또는 특소형

- 32x20

```text
        53 x 33      small

        103 x 65     medium

        180 x 114    large

        263 x 166    exlarge
```

---
## **10.2 Logo Color Depth**

세 가지 표준 색상 심도가 있습니다. 색상 깊이\(픽셀당 비트 포함\)와 Logo\_Color\_Depth에 해당하는 값은 아래 표에 나와 있습니다.

```text
                Color Depth          Logo Color
             (bits per pixel)        Depth Value

         4 (16 colors)            4

         8 (256 colors)           nothing

         24 (16 million colors)   24
```

로고 색상 심도를 생략하면 기본 색상 심도가 256색인 로고가 검색됩니다.

---
## **10.3 Logo Net Location Examples**

로고 네트워크 위치가 "ftp://logos.xzpay.com"으로 설정된 경우:

o "ftp://logos.xzpay.com/medium.gif"는 중간 크기의 256색 로고를 검색합니다.

o "http://logos.xzpay.com/small4.gif"는 작은 크기의 16색 로고를 검색합니다.

참고: IOTP와 함께 사용할 수 있는 로고를 만드는 조직은 항상 "소형" 및 "중형" 크기의 로고를 만들고 "gif" 형식을 사용해야 합니다.

---
## **11. Brands**

이 섹션에는 다음이 포함되어 있습니다.

o 브랜드 목록을 사용한 브랜드 정의 및 브랜드 선택 개요, 그리고

o 브랜드 목록의 일부 XML 예

---
## **11.1 Brand Definitions and Brand Selection**

IOTP의 주요 기능 중 하나는 판매자가 소비자가 선택할 수 있는 브랜드 목록을 제공하는 기능입니다. 이 섹션에서는 관련 내용에 대한 개요를 제공하고 소비자가 브랜드 및 관련 결제 수단을 선택하는 방법에 대한 지침을 제공합니다. 그것은 다음을 다룬다:

```text
   o  definitions of Payment Instruments and Brands - what are Payment
      Instruments and Brands in an IOTP context. Further categorises
      Brands as optionally a "Dual Brand" or a "Promotional Brand",
```

o 판촉 브랜드 식별 및 선택 - 판촉 브랜드는 소비자에게 로열티 포인트나 할인과 같은 추가 혜택을 제공합니다. 이는 소비자와 판매자 모두 유효한 판촉 브랜드가 사용되고 있음을 정확하게 식별할 수 있어야 함을 의미합니다.

다음 섹션도 참조하세요.

o 판매자가 소비자에게 제공하는 브랜드 목록을 포함하는 XML 요소의 정의를 포함하는 브랜드 목록 구성 요소\(섹션 7.7\)

o 소비자가 선택한 브랜드, 통화, 금액 및 결제 프로토콜을 기록하는 방법에 대한 자세한 내용은 브랜드 선택 구성요소\(섹션 7.8\)를 참조하세요.

---
### **11.1.1 Definition of Payment Instrument**

결제 수단은 판매자가 제공하는 상품이나 서비스에 대해 소비자가 비용을 지불하는 수단입니다. 예를 들면 다음과 같습니다.

```text
   o  a credit card such as MasterCard or Visa;

   o  a debit card such as MasterCard's Maestro;
```

o Mondex 카드, GeldKarte 카드 또는 Visa Cash 카드와 같은 스마트 카드 기반 전자 현금 결제 수단

o CyberCash 또는 DigiCash 계정과 같은 소프트웨어 기반 전자 지불 계정.

대부분의 결제 수단에는 결제 수단을 식별할 수 있는 번호\(일반적으로 계좌 번호\)가 있습니다.

---
### **11.1.2 Definition of Brand**

브랜드는 특정 유형의 결제 수단을 식별하는 표시입니다. 브랜드 목록은 판매자가 소비자에게 제시하고 소비자가 선택하는 결제 옵션입니다. 각 브랜드마다 다른 결제 처리자가 있을 수 있습니다. 브랜드의 예는 다음과 같습니다.

o 지불 협회 및 독점 브랜드\(예:

- MasterCard, Visa, American Express, Diners Club, Mondex, GeldKarte, CyberCash 등

```text
   o  promotional brands (see below). These include:

      -  store brands, where the Payment Instrument is issued to a
         Consumer by a particular Merchant, for example Walmart, Sears,
         or Marks and Spencer (UK)
```

- - 공동 브랜드\(예: 조직이 일반적으로 지불 협회 브랜드와 함께 자체 브랜드를 사용하는 American Advantage Visa\)

---
### **11.1.3 Definition of Dual Brand**

이중 브랜드란 하나의 결제 수단을 마치 두 개의 별도 브랜드인 것처럼 사용할 수 있음을 의미합니다. 예를 들어 UC 카드 또는 일반 MasterCard로 사용할 수 있는 단일 일본어 "UC" MasterCard가 있을 수 있습니다. UC 카드 브랜드와 MasterCard 브랜드는 각각 별도의 결제 처리기를 가질 수 있습니다. 이는 다음을 의미합니다.

o 판매자는 소비자에게 브랜드 목록을 제공할 때 예를 들어 "UC"와 "MasterCard"를 두 개의 별도 브랜드로 취급합니다.

o 소비자는 브랜드를 선택합니다\(예: "UC" 또는

- "마스터카드,

o 소비자 IOTP 인식 애플리케이션은 선택한 브랜드와 일치하는 결제 수단을 결정하고 아마도 사용자 지원을 통해 사용할 올바른 결제 수단을 선택합니다.

참고: 이중 브랜드는 판매자의 특별한 대우가 필요하지 않으므로 DTD에서는 이중 브랜드에 대해 명시적으로 언급하지 않습니다. 이는 판매자에 관한 한 이중 브랜드의 각 브랜드가 별도의 브랜드로 취급되기 때문입니다. 브랜드와 이중 브랜드 결제 수단의 매칭이 필요한 곳은 소비자입니다.

---
### **11.1.4 Definition of Promotional Brand**

프로모션 브랜드는 소비자가 해당 브랜드로 비용을 지불하면 소비자가 두 가지 방법으로 받을 수 있는 추가 혜택을 받게 된다는 것을 의미합니다.

o 구매 시. 예를 들어 소비자가 Walmart 웹사이트에서 "Walmart MasterCard"로 결제하는 경우 5% 할인이 적용될 수 있습니다. 이는 소비자가 실제로 더 적은 비용을 지불한다는 의미입니다.

o 명세서에 결제 내역이 표시되면 결제 수단\(카드\) 발급자로부터 받을 수 있습니다. 예를 들어, 상용 고객 제도의 로열티 포인트는 마지막 명세서가 발행된 이후 결제 수단으로 이루어진 총 결제 금액을 기준으로 부여될 수 있습니다.

```text
   Note that:
```

o 첫 번째 예\(구매 시 혜택 획득\)에는 다음이 필요합니다.

- - 해당 브랜드를 선택할 경우 발생하는 혜택에 대해 소비자에게 통보됩니다.

- - 브랜드를 선택한 경우 판매자는 지불할 정확한 금액을 반영하기 위해 제안 응답에서 관련 IOTP 구성 요소를 변경합니다.

o 두 번째\(결제 수단 발급자를 통해 혜택을 받는 경우\)에는 제안 응답을 변경할 필요가 없습니다.

o 각 프로모션 브랜드는 판매자가 제공하는 브랜드 목록에서 별도의 브랜드로 식별되어야 합니다. 예를 들어 "Walmart", "Sears", "Marks and Spencer" 및 "American Advantage Visa"는 각각 별도의 브랜드입니다.

---
### **11.1.5 Identifying Promotional Brands**

프로모션 브랜드를 식별하는 데에는 두 가지 문제를 처리해야 합니다.

o 판매자 또는 결제 담당자는 구매 시 사용 중인 판촉 브랜드를 어떻게 확실하게 식별합니까?

o 소비자는 판매자가 제시한 브랜드 목록에서 올바른 판촉 브랜드를 어떻게 확실하게 식별합니까?

다음은 이것이 어떻게 달성될 수 있는지에 대한 설명입니다.

참고: 여기에 설명된 접근 방식은 문제를 해결하는 모델 접근 방식이라는 점에 유의하세요. 다른 동등한 방법이 사용될 수 있습니다.

---
#### **11.1.5.1 Merchant/Payment Handler Identification of Promotional Brands**

소비자가 실제로는 그렇지 않은데도 할인된 결제 금액을 제공하는 프로모션 브랜드가 있다고 사기적으로 주장할 수 있으므로 소비자가 프로모션 브랜드를 사용하여 비용을 지불하고 있다는 정확한 식별이 중요합니다.

```text
   Two approaches seem possible:
```

o 결제 수단이나 결제 방법의 일부 기능을 사용하여 사용 중인 브랜드를 확실하게 식별합니다. 예를 들어, 브랜드에 대한 SET 인증서\(사용 가능한 경우\)를 사용할 수 있습니다.

o 결제 수단\(카드\) 번호를 사용하여 결제 수단 발행자 데이터베이스에서 결제 수단에 대한 정보를 검색하여 해당 결제 수단이 판촉용 브랜드인지 확인합니다.

```text
   Note that:
```

o 첫 번째는 SET이 사용 가능하다고 가정합니다.

o 두 번째는 판매자 또는 결제 처리자가 카드 발급자 정보에 접근할 수 있는 경우에만 가능합니다.

IOTP는 판매자에게 결제 수단 정보\(예: 카드 또는 계좌 번호\)를 제공하지 않습니다. 이는 캡슐화된 결제 프로토콜의 일부로만 결제 처리자에게 전송됩니다. 이는 다음을 의미합니다.

o 판매자는 선택한 결제 수단이 유효한 판촉 브랜드라고 가정해야 합니다.

o 결제 처리자는 결제가 완료되었는지 확인해야 합니다.

- 유효한 프로모션 브랜드를 위한 결제 수단이었으며 그렇지 않은 경우 결제가 실패합니다.

브랜드가 유효한 프로모션 브랜드인지 확인하는 결제 핸들러는 결제 핸들러가 카드 발급자이기도 한 경우 가능성이 높습니다.

---
#### **11.1.5.2 Consumer Selection of Promotional Brands**

소비자가 판촉 브랜드를 올바르게 선택할 수 있는 두 가지 방법은 다음과 같습니다.

o 소비자는 판매자가 소비자에게 제공한 판촉 브랜드 로고와 시각적으로 일치합니다.

o 판매자가 제공하는 브랜드 목록에 포함된 유사한 코드에 대해 애플리케이션이 등록한 프로모션 브랜드의 코드와 일치하는 소비자의 IOTP 인식 애플리케이션.

후자의 경우 소비자 지갑에 포함된 코드는 판매자가 제공한 목록의 코드와 정확히 일치해야 하며 그렇지 않으면 일치하는 코드가 발견되지 않습니다. 소비자의 IOTP 인식 애플리케이션이 이러한 코드를 얻을 수 있는 방법은 다음과 같습니다.

o 소비자가 코드를 직접 입력합니다. 이는 오류가 발생하기 쉽고 사용자 친화적이지 않으며 소비자에게 코드를 제공해야 합니다. 이 접근 방식은 권장되지 않습니다.

o IOTP에서 정의하고 지갑 개발자가 소비자 IOTP 인식 애플리케이션 또는 지갑에 미리 로드한 브랜드 식별자 중 하나를 사용합니다.

o 소프트웨어에 포함된 일부 정보나 결제수단과 관련된 기타 데이터를 사용하는 행위. 이는 다음과 같을 수 있습니다:

- - 이 결제 방법을 사용하는 브랜드에 대한 SET 인증서

- - 특정 결제 방법을 처리하는 결제 소프트웨어에서 제공하는 코드\(예: GeldKarte, Mondex, CyberCash 및 DigiCash에 적용될 수 있음\)

o 판매자가 제공하는 브랜드 목록에 있는 프로모션 브랜드와 개별 ​​결제 수단 사이에 초기 "수동" 링크를 만드는 소비자\(프로모션 브랜드를 처음 사용할 때\). 그러면 IOTP Aware 애플리케이션은 향후 구매에 사용할 프로모션 브랜드의 코드를 "기억"합니다.

---
#### **11.1.5.3 Consumer Software Brand Id recommendation**

새로운 브랜드 ID는 IANA 절차에 따라 할당됩니다\(섹션 12 IANA 고려사항 참조\). 여기에는 브랜드 식별자의 초기 목록도 포함되어 있습니다.

소비자 IOTP 인식 애플리케이션\(예: 소프트웨어 지갑\)의 구현자는 당시의 최신 브랜드 ID 세트로 소프트웨어를 사전 로드하고 업데이트할 수 있는 방법을 제공하는 것이 좋습니다. 예를 들어, 소프트웨어 개발자의 웹사이트로 이동합니다.

---
## **11.2 Brand List Examples**

이 예에는 브랜드 목록 구성 요소에 대한 XML의 세 가지 예가 포함되어 있습니다. 그것은 다음을 다룬다:

o 간단한 신용 카드 기반 예

o 판촉용 신용카드 브랜드를 포함한 신용카드 기반 브랜드 목록, 그리고

o 복잡한 전자 현금 기반 브랜드 목록

```text
   Note that:
```

o 브랜드 목록은 필요에 따라 복잡하거나 단순할 수 있습니다.

o 이 부록에 설명된 모든 예시 기술은 하나의 브랜드 목록에 포함될 수 있습니다.

---
### **11.2.1 Simple Credit Card Based Example**

이는 다음과 관련된 간단한 예입니다.

```text
   o  only major credit card payment brands
```

o 단일 통화로 된 단일 가격

o 단일 결제 핸들러, 그리고

o 단일 결제 프로토콜

```text
   <BrandList ID='M1.2'
     XML:Lang='us-en'
     ShortDesc='Purchase book including s&h'
     PayDirection='Debit' >
     <Brand ID ='M1.30'
       BrandId='MasterCard'
       BrandName='MasterCard Credit'
       BrandLogoNetLocn='ftp://otplogos.mastercard.com/mastercardcredit'
       ProtocolAmountRefs='M1.33'>
     </Brand>
     <Brand ID ='M.31'
       BrandId='Visa'
       BrandName='Visa Credit'
       BrandLogoNetLocn='ftp://otplogos.visa.com/visacredit'
       ProtocolAmountRefs='M1.33'>
     </Brand>
     <Brand ID ='M1.32'
       BrandId='AmericanExpress'
       BrandName='American Express'
       BrandLogoNetLocn='ftp://otplogos.amex.com'
       ProtocolAmountRefs ='M1.33' >
     </Brand >
     <ProtocolAmount ID ='M1.33'
       PayProtocolRef='M1.35'
       CurrencyAmountRefs='M1.34'>
     </ProtocolAmount>
     <CurrencyAmount ID ='M1.34'
       Amount='10.95'
       CurrCode='USD'/>
     <PayProtocol ID ='M1.35'
       ProtocolId='SCCD1.0'
       ProtocolName='Secure Channel Credit/Debit'
       PayReqNetLocn='http://www.example.com/etill/sccd1' >
     </PayProtocol>
   </BrandList>
```

---
### **11.2.2 Credit Card Brand List Including Promotional Brands**

신용카드 기반 브랜드 목록의 예는 다음과 같습니다. 여기에는 다음이 포함됩니다.

o 일반 카드 협회 브랜드 2개와 프로모션 신용카드 브랜드 2개. 프로모션 브랜드는 추가 로열티 포인트를 제공하는 로열티 기반\(British Airways MasterCard\)과 일정 금액 이상 구매 시 할인을 제공하는 매장 기반\(Walmart\)으로 구성됩니다.

```text
   o  two payment protocols:

      -  SET (Secure Electronic Transactions) see [SET], and

      -  SCCD (Secure Channel Credit Debit) see [SCCD].

 <BrandList ID='M1.2'
   XML:Lang='us-en'
   ShortDesc='Purchase ladies coat'
   PayDirection='Debit' >
   <Brand ID ='M1.3'
     BrandId='MasterCard'
     BrandName='MasterCard Credit'
     BrandLogoNetLocn='ftp://otplogos.mastercard.com'
     ProtocolAmountRefs='M1.7 M1.8'>
     <ProtocolBrand ProtocolId='SET1.0' ProtocolBrandId='MasterCard:'>
     </ProtocolBrand>
   </Brand>
   <Brand ID ='M1.4'
     BrandId='Visa'
     BrandName='Visa Credit'
     BrandLogoNetLocn='ftp://otplogos.visa.com'
     ProtocolAmountRefs='M1.7 M1.8'>
     <ProtocolBrand ProtocolId='SET1.0' ProtocolBrandId='Visa:'>
     </ProtocolBrand>
   </Brand>
   <Brand ID ='M1.5'
     BrandId='BritishAirwaysMC'
     BrandName='British Airways MasterCard'
     BrandLogoNetLocn='ftp://otplogos.britishairways.co.uk'
     BrandNarrative='Double air miles with British Airways MasterCard'
     ProtocolAmountRefs ='M1.7 M1.8' >
     <ProtocolBrand ProtocolId='SET1.0' ProtocolBrandId='MasterCard:BA'>
     </ProtocolBrand>
   </Brand >
   <Brand ID ='M1.6'
     BrandId='Walmart'
     BrandName='Walmart Store Card'

     BrandLogoNetLocn='ftp://otplogos.walmart.com'

     BrandNarrative='5% off with your Walmart Card
                   on purchases over $150'
     ProtocolAmountRefs='M1.8'>
   </Brand>
   <ProtocolAmount ID ='M1.7'
     PayProtocolRef='M1.10'
     CurrencyAmountRefs='M1.9' >
     <PackagedContent Transform="BASE64">
        238djqw1298erh18dhoire
     </PackagedContent>
   </ProtocolAmount>
   <ProtocolAmount ID ='M1.8'
     PayProtocolRef='M1.11'
     CurrencyAmountRefs='M1.9' >
     <PackagedContent Transform="BASE64">
        238djqw1298erh18dhoire
     </PackagedContent>
   </ProtocolAmount>
   <CurrencyAmount ID ='M1.9'
     Amount='157.53'
     CurrCode='USD'/>
   <PayProtocol ID ='M1.10'
     ProtocolId='SET1.0'
     ProtocolName='Secure Electronic Transaction Version 1.0'
     PayReqNetLocn='http://www.example.com/etill/set1' >
     <PackagedContent Transform="BASE64">
       8ueu26e482hd82he82
     </PackagedContent>
   </PayProtocol>
   <PayProtocol ID ='M1.11'
     ProtocolId='SCCD1.0'
     ProtocolName='Secure Channel Credit/Debit'
     PayReqNetLocn='http://www.example.com/etill/sccd1' >
     <PackagedContent Transform="BASE64">
        82hd82he8226e48ueu
     </PackagedContent>
   </PayProtocol>
  </BrandList>
```

---
### **11.2.3 Brand Selection Example**

위의 예를 사용하여 SET를 사용하여 '영국항공' MasterCard로 결제하고 항공 마일리지를 두 배로 받으려면 브랜드 선택은 다음과 같습니다.

```text
   <BrandSelection ID='C1.2'

     BrandListRef='M1.3'
     BrandRef='M1.5'
     ProtocolAmountRef='M1.7'
     CurrencyAmountRef='M1.9' >
   </BrandSelection>
```

---
### **11.2.4 Complex Electronic Cash Based Brand List**

다음은 다음을 포함하는 매우 복잡한 예입니다.

o Mondex, GeldKarte, CyberCash 또는 DigiCash를 사용한 결제

o 미국 달러, 영국 파운드, 이탈리아 리라, 독일 마르크 및 캐나다 달러를 포함한 통화로

o 영국 파운드나 미국 달러를 사용하여 Mondex에서 결제하는 경우 가격 할인, 그리고

o Mondex 또는 CyberCash와 관련된 결제에 둘 이상의 결제 처리자가 사용됩니다.

o CyberCash CyberCoin 결제 프로토콜의 두 가지 이상의 버전을 지원합니다.

```text
   <BrandList ID='M1.2'
     XML:Lang='us-en'
     ShortDesc='Company report on XYZ Co'
     PayDirection='Debit' >
     <Brand ID ='M1.13'
       BrandId='Mondex'
       BrandName='Mondex Electronic Cash'
       BrandLogoNetLocn='ftp://otplogos.mondex.com'
       ProtocolAmountRefs='M1.17 M1.18'>
     </Brand>
     <Brand ID ='M1.14'
       BrandId='GeldKarte'
       BrandName='GeldKarte Electronic Cash'
       BrandLogoNetLocn='ftp://otplogos.geldkarte.co.de'
       ProtocolAmountRefs='M1.19'>
     </Brand>
     <Brand ID ='M1.15'
       BrandId='CyberCoin'
       BrandName='CyberCoin Eletronic Cash'
       BrandLogoNetLocn='http://otplogos.cybercash.com'
       ProtocolAmountRefs ='M1.20' >
     </Brand >
     <Brand ID ='M1.16'
       BrandId='DigiCash'

       BrandName='DigiCash Electronic Cash'
       BrandLogoNetLocn='http://otplogos.digicash.com'
       BrandNarrative='5% off with your Walmart Card
                     on purchases over $150'
       ProtocolAmountRefs='M1.22'>
     </Brand>
     <ProtocolAmount ID ='M1.17'
       PayProtocolRef='M1.31'
       CurrencyAmountRefs='M1.25 M1.29'>
     </ProtocolAmount>
     <ProtocolAmount ID ='M1.18'
       PayProtocolRef='M1.32'
       CurrencyAmountRefs='M1.26 M1.27 M1.28 M1.30'>
     </ProtocolAmount>
     <ProtocolAmount ID ='M1.19'
       PayProtocolRef='M1.35'
       CurrencyAmountRefs='M1.28'>
     </ProtocolAmount>
     <ProtocolAmount ID ='M1.20'
       PayProtocolRef='M1.34 M1.33'
       CurrencyAmountRefs='M1.23 M1.24 M1.27 M1.28 M1.29 M1.30'>
     </ProtocolAmount>
     <ProtocolAmount ID ='M1.21'
       PayProtocolRef='M1.36'
       CurrencyAmountRefs='M1.23 M1.24 M1.27 M1.28 M1.29 M1.30'>
     </ProtocolAmount>
     <CurrencyAmount ID ='M1.23'
       Amount='20.00'
       CurrCode='USD'/>
     <CurrencyAmount ID ='M1.24'
       Amount='12.00'
       CurrCode='GBP'/>
     <CurrencyAmount ID ='M1.25'
       Amount='19.50'
       CurrCode='USD'/>
     <CurrencyAmount ID ='M1.26'
       Amount='11.75'
       CurrCode='GBP'/>
     <CurrencyAmount ID ='M1.27'
       Amount='36.00'
       CurrCode='DEM'/>
     <CurrencyAmount ID ='M1.28'
       Amount='100.00'
       CurrCode='FFR'/>
     <CurrencyAmount ID ='M1.29'
       Amount='22.00'
       CurrCode='CAD'/>
     <CurrencyAmount ID ='M1.30'

       Amount='15000'
       CurrCode='ITL'/>
     <PayProtocol ID ='M1.31'
       ProtocolId='MXv1.0'
       ProtocolName='Mondex IOTP Protocol Version 1.0'
       PayReqNetLocn='http://www.mxbankus.com/etill/mx' >
     </PayProtocol>
     <PayProtocol ID ='M1.32'
       ProtocolId='MXv1.0'
       ProtocolName='Mondex IOTP Protocol Version 1.0'
       PayReqNetLocn='http://www.mxbankuk.com/vserver' >
     </PayProtocol>
     <PayProtocol ID ='M1.33'
       ProtocolId='Ccashv1.0'
       ProtocolName='CyberCoin Version 1.0'
       PayReqNetLocn='http://www.cybercash.com/ccoin' >
     </PayProtocol>
     <PayProtocol ID ='M1.34'
       ProtocolId='CCashv2.0'
       ProtocolName='CyberCoin Version 2.0'
       PayReqNetLocn='http://www.cybercash.com/ccoin' >
     </PayProtocol>
     <PayProtocol ID ='M1.35'
       ProtocolId='GKv1.0'
       ProtocolName='GeldKarte Version 1.0'
       PayReqNetLocn='http://www.example.com/pgway' >
     </PayProtocol>
     <PayProtocol ID ='M1.36'
       ProtocolId='DCashv1.0'
       ProtocolName='DigiCash Protocol Version 1.0'
       PayReqNetLocn='http://www.example.com/digicash' >
     </PayProtocol>
     </BrandList>
```

---
## **12. IANA Considerations**

이 섹션에서는 IANA에서 관리하는 코드와 IANA에서 관리하지 않는 테스트 목적으로 새 코드를 생성하는 방법에 대해 설명합니다.

---
## **12.1 Codes Controlled by IANA**

상호 운용성을 보장하려면 IOTP에서 사용하는 코드를 통제된 환경에서 유지 관리하여 의미와 사용법을 잘 정의하고 중복 코드를 방지해야 합니다. \[IANA\]는 RFC 2434에 설명된 대로 이 목적으로 사용되는 메커니즘입니다.

이 절차가 적용되는 요소 유형 및 속성 이름은 이러한 속성에 유효한 초기 값과 함께 아래 표에 표시됩니다.

```text
   Note that:
```

o IETF Trade 메일링 리스트의 이메일 주소는 ietf-입니다.

- trade@elistx.com

o "지정 전문가"\(\[IANA\] 참조\)는 IESG가 임명합니다.

```text
     Element Type/                     Attribute Values
     Attribute Name

   Algorithm/         "sha1" - indicates that a [SHA1] authentication
   Name               will apply
   (When Algorithm
   is a child of an   "signature" - indicates that authentication
   AuthReq            consists of the generation of a digital signature.
   Component)
                      "Pay:ppp" where "ppp" may be set to any valid
                      value for "iotpbrand" (see below)
```

- "pay:"로 시작하는 알고리즘을 제외하고 IETF Trade 메일링 리스트 및 지정 전문가의 검토를 거쳐 새로운 값이 할당됩니다.

참고: Algorithm 요소는 결국 \[DSIG\] 이름 공간 내에서 정의될 가능성이 높습니다. DSIG 제안이 더 널리 채택됨에 따라 여기에 정의된 유지 관리 절차는 시간이 지남에 따라 달라져야 할 수도 있습니다.

```text
     Element Type/                     Attribute Values
     Attribute Name

   Brand/BrandId      The following list of initial BrandIds have been
                      taken from those Organisations that have applied
                      for SET certificates as at 1st June 1999:

                      "Amex" - American Express

                      "Dankort" - Dankort

                      "JCB" - JCB

                      "Maestro" - Maestro

                      "MasterCard" - MasterCard

                      "NICOS" - NICOS

                      "VISA" - Visa
```

- 또한 다음과 같은 브랜드 ID 값이 정의됩니다.

```text
                      "Mondex"

                      "GeldKarte"
```

- BrandId의 새로운 값은 IETF Trade 메일링 리스트에 공지되어야 하며, 3주 이내에 이의가 없으면 "선착순"으로 할당됩니다.

통화 금액/ 통화 코드는 CurrCodeType에 따라 다릅니다\(아래 CurrCode 참조\).

- CurrCodeType이 "ISO4217-A"인 경우 통화 코드는 \[ISO4217\]에 정의된 알파벳 통화 코드입니다.

- CurrCodeType이 "IOTP"인 경우 새 값은 IETF Trade 메일링 목록에 발표되어야 하며, 3주 이내에 이의가 없으면 "선착순" 기준으로 할당됩니다.

참고: IOTP의 통화 코드 유형은 로열티나 상용 고객 포인트와 같은 "새로운" 유사 통화를 지원할 수 있도록 설계되었습니다. 이 사양을 작성할 당시에는 이 유형의 통화 코드가 정의되지 않았습니다.

```text
     Element Type/                     Attribute Values
     Attribute Name

   CurrencyAmount/    "ISO4217-A"
   CurrCodeType
                      "IOTP"
```

- CurrCodeType 속성의 새로운 값은 IETF Trade 메일링 리스트 및 지정 전문가의 검토를 거쳐 할당됩니다.

```text
   DeliveryData/      "Post"
   DelivMethod

                      "Web"

                      "Email"
```

- 전달 방법 속성의 새로운 값은 IETF Trade 메일링 목록 검토 후 지정 전문가에 의해 할당됩니다. 이를 위해서는 전달 방법이 사용되는 방법을 설명하는 추가 문서의 출판이 필요할 수 있습니다.

```text
   PackagedContent/   "PCDATA"
   Content
                      "MIME"

                      "MIME:mimetype" (where mimetype must be the same
                      as content-type as defined by [MIME] )

                      "XML"
```

Content 속성이 다음 형식인 경우

- "MIME"mimetype"이면 "mimetype"에 대한 새 값의 제어는 \[MIME\]에 정의된 대로입니다.

- 그렇지 않으면 IETF Trade 메일링 목록과 지정 전문가의 검토를 거쳐 Content 속성의 새 값이 할당됩니다. 이를 위해서는 패키지 콘텐츠 요소 내에서 새 속성이 사용되는 방법을 설명하는 추가 문서를 게시해야 할 수도 있습니다.

```text
   RelatedTo/         "IotpTransaction"
   RelationshipType
                      "Reference"

                      New values of the RelationshipType attribute are
                      allocated following review on the IETF Trade
                      Working Group mailing list and by the Designated
                      Expert. This may require the publication of
                      additional documentation to describe how the
```

요소 유형/속성 값 속성 이름 전달 방법이 사용됩니다.

```text
   Status/            Offer
   StatusType
                      Payment

                      Delivery

                      Authentication

                      Unidentified
```

- 상태 유형 속성의 새로운 값은 다음과 같이 할당됩니다. o IETF 무역 작업 그룹에 대한 게시, 거래 교환, 거래 역할 및 상태와 관련된 관련 구성 요소를 설명하는 RFC o IETF 거래에 대한 문서 검토 메일링 리스트 및 지정 전문가에 의해.

참고: 상태 유형 속성에 대한 새로운 값을 설명하는 문서는 새로운 거래 역할 및 서명 유형을 설명하는 문서와 결합될 수 있습니다\(아래 참조\).

```text
   TradingRole/       "Consumer"
   TradingRole
                      "Merchant"

                      "PaymentHandler"

                      "DeliveryHandler"

                      "DelivTo"

                      "CustCare"
```

- 거래 역할 속성의 새로운 값은 다음과 같이 할당됩니다. o 거래 교환, 거래 역할 및 거래 역할과 관련된 관련 구성 요소를 설명하는 RFC를 IETF 무역 작업 그룹에 게시하고 o IETF에 대한 문서를 검토합니다. 무역 메일링 리스트 및 지정 전문가.

참고: 거래 역할 속성의 새 값을 설명하는 문서는 다음과 같을 수 있습니다.

요소 유형/속성 값 속성 이름은 새로운 상태 유형\(위 참조\) 및 서명 유형\(아래 참조\)을 설명하는 문서와 결합됩니다.

```text
   TransId/           "BaselineAuthentication"
   IotpTransType
                      "BaselineDeposit"

                      "BaselinePurchase"

                      "BaselineRefund"

                      "BaselineWithdrawal"

                      "BaselineValueExchange"

                      "BaselineInquiry"

                      "BaselinePing"
```

- IotpTransType 속성의 새로운 값은 다음과 같이 할당됩니다: o IETF Trade 메일링 리스트에 게시, 새로운 IOTP 트랜잭션을 설명하는 RFC, o IETF Trade Working Group 메일링 리스트 및 지정 전문가에 의한 문서 검토.

```text
   Attribute/ Content
   (see Signature
                      "OfferResponse"
   Component)         "PaymentResponse"

                      "DeliveryResponse"

                      "AuthenticationRequest"

                      "AuthenticationResponse"

                      "PingRequest"

                      "PingResponse"
```

- 서명 유형을 정의하는 코드의 새로운 값은 다음과 같이 할당됩니다. o IETF 무역 작업 그룹에 게시, 서명이 사용되는 거래소를 설명하는 RFC, o IETF 무역에 관한 문서 검토 메일링 리스트 및 지정 전문가에 의해.

```text
     Element Type/                     Attribute Values
     Attribute Name
```

참고: 서명 유형에 대한 새로운 값을 설명하는 문서는 새로운 상태 유형 및 거래 역할을 설명하는 문서와 결합될 수 있습니다\(위 참조\).

---
## **12.2 Codes not controlled by IANA**

위에서 설명한 코드의 정식 개발 및 등록 외에도 개발자가 새로운 IOTP 코드를 사용하여 실험해 볼 필요가 여전히 있습니다. 이러한 이유로 "사용자 정의 코드"는 IANA에 등록할 필요 없이 본 사양에 포함된 코드에 대한 추가 값을 식별하는 데 사용될 수 있습니다.

사용자 정의 코드의 정의는 다음과 같습니다.

```text
   user_defined_code ::= ( "x-" | "X-" ) NameChar (NameChar)*

     NameChar           NameChar has the same definition as the [XML]
                        definition of NameChar
```

사용자 정의 코드를 고유하게 만들기 위해 도메인 이름\(\[DNS\] 참조\)을 사용하는 것이 좋지만 이 방법을 신뢰할 수는 없습니다.

---
## **13. Internet Open Trading Protocol Data Type Definition**

이 섹션에는 인터넷 공개 거래 프로토콜에 대한 XML DTD가 포함되어 있습니다.

```text
   <!--
   ******************************************************
   *                                                    *
   * INTERNET OPEN TRADING PROTOCOL VERSION 1.0 DTD     *
   * Filename: ietf.org/rfc/rfc2801.dtd                 *
   *                                                    *
   * Changes from version 07 (iotp-v1.0-protocol-07.dtd)*
   *   - NO CHANGES                                     *
   *                                                    *
   *                                                    *
   *                                                    *
   *                                                    *
   * Copyright Internet Engineering Task Force 1998-2000*
   *                                                    *
   ******************************************************

   ******************************************************
   * IOTP MESSAGE DEFINITION                            *
   ******************************************************
    -->

   <!ELEMENT IotpMessage
      ( TransRefBlk,
        IotpSignatures?,
        ErrorBlk?,
        ( AuthReqBlk |
          AuthRespBlk |
          AuthStatusBlk |
          CancelBlk |
          DeliveryReqBlk |
          DeliveryRespBlk |
          InquiryReqBlk |
          InquiryRespBlk |
          OfferRespBlk |
          PayExchBlk |
          PayReqBlk |
          PayRespBlk |
          PingReqBlk |
          PingRespBlk |
          TpoBlk |
          TpoSelectionBlk
        )*
      ) >
   <!ATTLIST IotpMessage
     xmlns              CDATA
      'iotp:ietf.org/iotp-v1.0' >

   <!--
   ******************************************************
   * TRANSACTION REFERENCE BLOCK DEFINITION             *
   ******************************************************
    -->

   <!ELEMENT TransRefBlk (TransId, MsgId, RelatedTo*) >
   <!ATTLIST TransRefBlk
    ID                 ID      #REQUIRED >

   <!ELEMENT TransId EMPTY >
   <!ATTLIST TransId
    ID                 ID      #REQUIRED
    Version            NMTOKEN #FIXED '1.0'
    IotpTransId        CDATA   #REQUIRED
    IotpTransType      CDATA   #REQUIRED
    TransTimeStamp     CDATA   #REQUIRED >

   <!ELEMENT MsgId EMPTY >
   <!ATTLIST MsgId
    ID                 ID      #REQUIRED
    RespIotpMsg        NMTOKEN #IMPLIED
    xml:lang           NMTOKEN #REQUIRED
    LangPrefList       NMTOKENS #IMPLIED
    CharSetPrefList    NMTOKENS #IMPLIED
    SenderTradingRoleRef NMTOKEN #IMPLIED
    SoftwareId         CDATA   #REQUIRED
    TimeStamp          CDATA   #IMPLIED >

   <!ELEMENT RelatedTo (PackagedContent) >
   <!ATTLIST RelatedTo
    ID                 ID      #REQUIRED
    xml:lang           NMTOKEN #REQUIRED
    RelationshipType   NMTOKEN #REQUIRED
    Relation           CDATA   #REQUIRED
    RelnKeyWords       NMTOKENS #IMPLIED >

   <!--
   ******************************************************
   * Packaged Content Common Element                    *
   ******************************************************
    -->

   <!ELEMENT PackagedContent (#PCDATA) >
   <!ATTLIST PackagedContent
    Name             CDATA     #IMPLIED
    Content          NMTOKEN   "PCDATA"
    Transform (NONE|BASE64)    "NONE" >

   <!--
   ******************************************************
   * TRADING COMPONENTS                                 *
   ******************************************************
    -->
   <!-- PROTOCOL OPTIONS COMPONENT -->
   <!ELEMENT ProtocolOptions EMPTY >
   <!ATTLIST ProtocolOptions
    ID                 ID      #REQUIRED
    xml:lang           NMTOKEN #REQUIRED
    ShortDesc          CDATA   #REQUIRED
    SenderNetLocn      CDATA   #IMPLIED
    SecureSenderNetLocn CDATA  #IMPLIED
    SuccessNetLocn     CDATA   #REQUIRED >

   <!-- AUTHENTICATION DATA COMPONENT -->
   <!ELEMENT AuthReq (Algorithm, PackagedContent*)>
   <!ATTLIST AuthReq
    ID                 ID      #REQUIRED
    AuthenticationId   CDATA   #REQUIRED
    ContentSoftwareId  CDATA   #IMPLIED >

   <!-- AUTHENTICATION RESPONSE COMPONENT -->
   <!ELEMENT AuthResp (PackagedContent*) >
   <!ATTLIST AuthResp
    ID                 ID      #REQUIRED
    AuthenticationId   CDATA   #REQUIRED
    SelectedAlgorithmRef NMTOKEN #REQUIRED
    ContentSoftwareId  CDATA   #IMPLIED >

   <!-- TRADING ROLE INFO REQUEST COMPONENT -->
   <!ELEMENT TradingRoleInfoReq EMPTY>
   <!ATTLIST TradingRoleInfoReq
    ID                 ID      #REQUIRED
    TradingRoleList    NMTOKENS #REQUIRED >

   <!-- ORDER COMPONENT -->
   <!ELEMENT Order (PackagedContent*) >
   <!ATTLIST Order
    ID                 ID      #REQUIRED

    xml:lang           NMTOKEN #REQUIRED
    OrderIdentifier    CDATA   #REQUIRED
    ShortDesc          CDATA   #REQUIRED
    OkFrom             CDATA   #REQUIRED
    OkTo               CDATA   #REQUIRED
    ApplicableLaw      CDATA   #REQUIRED
    ContentSoftwareId  CDATA   #IMPLIED >

   <!-- ORGANISATION COMPONENT -->
   <!ELEMENT Org (TradingRole+, ContactInfo?,
        PersonName?, PostalAddress?)>
   <!ATTLIST Org
    ID                 ID      #REQUIRED
    xml:lang           NMTOKEN #REQUIRED
    OrgId              CDATA   #REQUIRED
    LegalName          CDATA   #IMPLIED
    ShortDesc          CDATA   #IMPLIED
    LogoNetLocn        CDATA   #IMPLIED >

   <!ELEMENT TradingRole EMPTY >
   <!ATTLIST TradingRole
    ID      ID#REQUIRED
    TradingRole        NMTOKEN #REQUIRED
    IotpMsgIdPrefix    NMTOKEN #REQUIRED
    CancelNetLocn      CDATA   #IMPLIED
    ErrorNetLocn       CDATA   #IMPLIED
    ErrorLogNetLocn  CDATA           #IMPLIED >

   <!ELEMENT ContactInfo EMPTY >
   <!ATTLIST ContactInfo
    xml:lang           NMTOKEN #IMPLIED
    Tel                CDATA   #IMPLIED
    Fax                CDATA   #IMPLIED
    Email              CDATA   #IMPLIED
    NetLocn            CDATA   #IMPLIED >

   <!ELEMENT PersonName EMPTY >
   <!ATTLIST PersonName
    xml:lang           NMTOKEN #IMPLIED
    Title              CDATA   #IMPLIED
    GivenName          CDATA   #IMPLIED
    Initials           CDATA   #IMPLIED
    FamilyName         CDATA   #IMPLIED >

   <!ELEMENT PostalAddress EMPTY >
   <!ATTLIST PostalAddress
    xml:lang           NMTOKEN #IMPLIED
    AddressLine1       CDATA   #IMPLIED
    AddressLine2       CDATA   #IMPLIED
    CityOrTown         CDATA   #IMPLIED
    StateOrRegion      CDATA   #IMPLIED
    PostalCode         CDATA   #IMPLIED
    Country            CDATA   #IMPLIED
    LegalLocation (True | False) 'False' >

   <!-- BRAND LIST COMPONENT -->
   <!ELEMENT BrandList (Brand+, ProtocolAmount+,
    CurrencyAmount+, PayProtocol+) >
   <!ATTLIST BrandList
    ID                 ID      #REQUIRED
    xml:lang           NMTOKEN #REQUIRED
    ShortDesc          CDATA   #REQUIRED
    PayDirection (Debit | Credit) #REQUIRED >

   <!ELEMENT Brand (ProtocolBrand*, PackagedContent*) >
   <!ATTLIST Brand
    ID                 ID      #REQUIRED
    xml:lang           NMTOKEN #IMPLIED
    BrandId            CDATA   #REQUIRED
    BrandName          CDATA   #REQUIRED
    BrandLogoNetLocn   CDATA   #REQUIRED
    BrandNarrative     CDATA   #IMPLIED
    ProtocolAmountRefs IDREFS  #REQUIRED
    ContentSoftwareId  CDATA   #IMPLIED >

   <!ELEMENT ProtocolBrand (PackagedContent*) >
   <!ATTLIST ProtocolBrand
    ProtocolId         CDATA   #REQUIRED
    ProtocolBrandId    CDATA   #REQUIRED >

   <!ELEMENT ProtocolAmount (PackagedContent*) >
   <!ATTLIST ProtocolAmount
    ID                 ID      #REQUIRED
    PayProtocolRef     IDREF   #REQUIRED
    CurrencyAmountRefs IDREFS  #REQUIRED
    ContentSoftwareId  CDATA   #IMPLIED >

   <!ELEMENT CurrencyAmount EMPTY >
   <!ATTLIST CurrencyAmount
    ID                 ID      #REQUIRED
    Amount             CDATA   #REQUIRED

    CurrCodeType       NMTOKEN 'ISO4217-A'
    CurrCode           CDATA   #REQUIRED >

   <!ELEMENT PayProtocol (PackagedContent*) >
   <!ATTLIST PayProtocol
    ID                 ID      #REQUIRED
    xml:lang           NMTOKEN #IMPLIED
    ProtocolId         NMTOKEN #REQUIRED
    ProtocolName       CDATA   #REQUIRED
    ActionOrgRef       NMTOKEN #REQUIRED
    PayReqNetLocn      CDATA   #IMPLIED
    SecPayReqNetLocn   CDATA   #IMPLIED
    ContentSoftwareId  CDATA   #IMPLIED >

   <!-- BRAND SELECTION COMPONENT -->
   <!ELEMENT BrandSelection (BrandSelBrandInfo?,
        BrandSelProtocolAmountInfo?,
        BrandSelCurrencyAmountInfo?) >
   <!ATTLIST BrandSelection
    ID                 ID      #REQUIRED
    BrandListRef       NMTOKEN #REQUIRED
    BrandRef           NMTOKEN #REQUIRED
    ProtocolAmountRef  NMTOKEN #REQUIRED
    CurrencyAmountRef  NMTOKEN #REQUIRED >

   <!ELEMENT BrandSelBrandInfo (PackagedContent+) >
   <!ATTLIST BrandSelBrandInfo
    ID                 ID      #REQUIRED
    ContentSoftwareId  CDATA   #IMPLIED >

   <!ELEMENT BrandSelProtocolAmountInfo (PackagedContent+) >
   <!ATTLIST BrandSelProtocolAmountInfo
    ID                 ID      #REQUIRED
    ContentSoftwareId  CDATA   #IMPLIED >

   <!ELEMENT BrandSelCurrencyAmountInfo (PackagedContent+) >
   <!ATTLIST BrandSelCurrencyAmountInfo
    ID                 ID      #REQUIRED
    ContentSoftwareId  CDATA   #IMPLIED >

   <!-- PAYMENT COMPONENT -->
   <!ELEMENT Payment EMPTY >
   <!ATTLIST Payment
    ID                 ID      #REQUIRED
    OkFrom             CDATA   #REQUIRED
    OkTo               CDATA   #REQUIRED
    BrandListRef       NMTOKEN #REQUIRED

    SignedPayReceipt (True | False) #REQUIRED
    StartAfterRefs     NMTOKENS #IMPLIED >

   <!-- PAYMENT SCHEME COMPONENT -->
   <!ELEMENT PaySchemeData (PackagedContent+) >
   <!ATTLIST PaySchemeData
    ID                 ID      #REQUIRED
    PaymentRef         NMTOKEN #IMPLIED
    ConsumerPaymentId  CDATA   #IMPLIED
    PaymentHandlerPayId CDATA  #IMPLIED
    ContentSoftwareId  CDATA   #IMPLIED >

   <!-- PAYMENT RECEIPT COMPONENT -->
   <!ELEMENT PayReceipt (PackagedContent*) >
   <!ATTLIST PayReceipt
    ID                 ID      #REQUIRED
    PaymentRef         NMTOKEN #REQUIRED
    PayReceiptNameRefs NMTOKENS #IMPLIED
    ContentSoftwareId  CDATA   #IMPLIED >

   <!-- PAYMENT NOTE COMPONENT -->
   <!ELEMENT PaymentNote (PackagedContent+) >
   <!ATTLIST PaymentNote
     ID                ID      #REQUIRED
     ContentSoftwareId CDATA   #IMPLIED >

   <!-- DELIVERY COMPONENT -->
   <!ELEMENT Delivery (DeliveryData?, PackagedContent*) >
   <!ATTLIST Delivery
    ID                 ID      #REQUIRED
    xml:lang           NMTOKEN #REQUIRED
    DelivExch          (True | False) #REQUIRED
    DelivAndPayResp    (True | False) #REQUIRED
    ActionOrgRef       NMTOKEN #IMPLIED >

   <!ELEMENT DeliveryData (PackagedContent*) >
   <!ATTLIST DeliveryData
    xml:lang           NMTOKEN #IMPLIED
    OkFrom             CDATA   #REQUIRED
    OkTo               CDATA   #REQUIRED
    DelivMethod        NMTOKEN #REQUIRED
    DelivToRef         NMTOKEN #REQUIRED
    DelivReqNetLocn    CDATA   #IMPLIED
    SecDelivReqNetLocn CDATA   #IMPLIED

    ContentSoftwareId  CDATA   #IMPLIED >

   <!-- CONSUMER DELIVERY DATA COMPONENT -->
   <!ELEMENT ConsumerDeliveryData EMPTY >
   <!ATTLIST ConsumerDeliveryData
    ID                 ID      #REQUIRED
    ConsumerDeliveryId CDATA   #REQUIRED >

   <!-- DELIVERY NOTE COMPONENT -->
   <!ELEMENT DeliveryNote (PackagedContent+) >
   <!ATTLIST DeliveryNote
    ID                 ID      #REQUIRED
    xml:lang           NMTOKEN #REQUIRED
    DelivHandlerDelivId CDATA  #IMPLIED
    ContentSoftwareId  CDATA   #IMPLIED >

   <!-- STATUS COMPONENT -->
   <!ELEMENT Status EMPTY >
   <!ATTLIST Status
    ID                 ID      #REQUIRED
    xml:lang           NMTOKEN #REQUIRED
    StatusType         NMTOKEN #REQUIRED
    ElRef              NMTOKEN #IMPLIED
    ProcessState (NotYetStarted | InProgress |
        CompletedOk | Failed | ProcessError) #REQUIRED
    CompletionCode     NMTOKEN #IMPLIED
    ProcessReference   CDATA   #IMPLIED
    StatusDesc         CDATA   #IMPLIED >

   <!-- TRADING ROLE DATA COMPONENT -->
   <!ELEMENT TradingRoleData (PackagedContent+) >
   <!ATTLIST TradingRoleData
     ID                ID      #REQUIRED
     OriginatorElRef   NMTOKEN #REQUIRED
     DestinationElRefs NMTOKENS #REQUIRED >

   <!-- INQUIRY TYPE COMPONENT -->
   <!ELEMENT InquiryType EMPTY >
   <!ATTLIST InquiryType
    ID                 ID      #REQUIRED
    Type               NMTOKEN #REQUIRED
    ElRef              NMTOKEN #IMPLIED
    ProcessReference   CDATA   #IMPLIED >

   <!-- ERROR COMPONENT -->
   <!ELEMENT ErrorComp (ErrorLocation+, PackagedContent*) >
   <!ATTLIST ErrorComp
    ID                 NMTOKEN #REQUIRED
    xml:lang           NMTOKEN #REQUIRED
    ErrorCode          NMTOKEN #REQUIRED
    ErrorDesc          CDATA   #REQUIRED
    Severity (Warning|TransientError|HardError) #REQUIRED
    MinRetrySecs       CDATA   #IMPLIED
    SwVendorErrorRef   CDATA   #IMPLIED >

   <!ELEMENT ErrorLocation EMPTY >
   <!ATTLIST ErrorLocation
    ElementType        NMTOKEN #REQUIRED
    IotpMsgRef         NMTOKEN #IMPLIED
    BlkRef             NMTOKEN #IMPLIED
    CompRef            NMTOKEN #IMPLIED
    ElementRef         NMTOKEN #IMPLIED
    AttName            NMTOKEN #IMPLIED >

   <!--
   ******************************************************
   * TRADING BLOCKS                                     *
   ******************************************************
    -->

   <!-- TRADING PROTOCOL OPTIONS BLOCK -->
   <!ELEMENT TpoBlk ( ProtocolOptions, BrandList*, Org* ) >
   <!ATTLIST TpoBlk
    ID                 ID      #REQUIRED >

   <!-- TPO SELECTION BLOCK -->
   <!ELEMENT TpoSelectionBlk (BrandSelection+) >
   <!ATTLIST TpoSelectionBlk
    ID                 ID      #REQUIRED >

   <!-- OFFER RESPONSE BLOCK -->
   <!ELEMENT OfferRespBlk (Status, Order?, Payment*,
                Delivery?, TradingRoleData*) >
   <!ATTLIST OfferRespBlk
    ID                 ID      #REQUIRED >

   <!-- AUTHENTICATION REQUEST BLOCK -->
   <!ELEMENT AuthReqBlk (AuthReq*, TradingRoleInfoReq?) >
   <!ATTLIST AuthReqBlk
    ID                 ID      #REQUIRED >

   <!-- AUTHENTICATION RESPONSE BLOCK -->
   <!ELEMENT AuthRespBlk (AuthResp?, Org*) >
   <!ATTLIST AuthRespBlk
    ID                 ID      #REQUIRED >

   <!-- AUTHENTICATION STATUS BLOCK -->
   <!ELEMENT AuthStatusBlk (Status) >
   <!ATTLIST AuthStatusBlk
    ID                 ID      #REQUIRED >

   <!-- PAYMENT REQUEST BLOCK -->
   <!ELEMENT PayReqBlk (Status+, BrandList, BrandSelection,
        Payment, PaySchemeData?, Org*, TradingRoleData*) >
   <!ATTLIST PayReqBlk
    ID                 ID      #REQUIRED >

   <!-- PAYMENT EXCHANGE BLOCK -->
   <!ELEMENT PayExchBlk (PaySchemeData) >
   <!ATTLIST PayExchBlk
    ID                 ID      #REQUIRED >

   <!-- PAYMENT RESPONSE BLOCK -->
   <!ELEMENT PayRespBlk (Status, PayReceipt?, PaySchemeData?,
        PaymentNote?, TradingRoleData*) >
   <!ATTLIST PayRespBlk
    ID                 ID      #REQUIRED >
   <!-- DELIVERY REQUEST BLOCK -->
   <!ELEMENT DeliveryReqBlk (Status+, Order, Org*, Delivery,
        ConsumerDeliveryData?, TradingRoleData*) >
   <!ATTLIST DeliveryReqBlk
    ID                 ID      #REQUIRED >

   <!-- DELIVERY RESPONSE BLOCK -->
   <!ELEMENT DeliveryRespBlk (Status, DeliveryNote) >
   <!ATTLIST DeliveryRespBlk
    ID                 ID      #REQUIRED >

   <!-- INQUIRY REQUEST BLOCK -->
   <!ELEMENT InquiryReqBlk ( InquiryType, PaySchemeData? ) >
   <!ATTLIST InquiryReqBlk
    ID                 ID      #REQUIRED >

   <!-- INQUIRY RESPONSE BLOCK -->
   <!ELEMENT InquiryRespBlk (Status, PaySchemeData?) >
   <!ATTLIST InquiryRespBlk
    ID                 ID      #REQUIRED
    LastReceivedIotpMsgRef NMTOKEN #IMPLIED
    LastSentIotpMsgRef NMTOKEN #IMPLIED >

   <!-- PING REQUEST BLOCK -->
   <!ELEMENT PingReqBlk (Org*)>
   <!ATTLIST PingReqBlk
    ID                 ID      #REQUIRED>

   <!-- PING RESPONSE BLOCK -->
   <!ELEMENT PingRespBlk (Org+)>
   <!ATTLIST PingRespBlk
    ID                 ID      #REQUIRED
    PingStatusCode (Ok | Busy | Down) #REQUIRED
    SigVerifyStatusCode (Ok | NotSupported | Fail) #IMPLIED
    xml:lang           NMTOKEN #IMPLIED
    PingStatusDesc     CDATA   #IMPLIED>

   <!-- ERROR BLOCK -->
   <!ELEMENT ErrorBlk (ErrorComp+, PaySchemeData*) >
   <!ATTLIST ErrorBlk
    ID                 ID      #REQUIRED >

   <!-- CANCEL BLOCK -->
   <!ELEMENT CancelBlk (Status) >
   <!ATTLIST CancelBlk
    ID                 ID      #REQUIRED >

   <!--
   ******************************************************
   * IOTP SIGNATURES BLOCK DEFINITION                   *
   ******************************************************
   -->

   <!ELEMENT IotpSignatures (Signature+ ,Certificate*) >
   <!ATTLIST IotpSignatures
       ID        ID        #IMPLIED
   >

   <!--
   ******************************************************
   * IOTP SIGNATURE COMPONENT DEFINITION                *
   ******************************************************
   -->

   <!ELEMENT Signature (Manifest, Value+) >
   <!ATTLIST Signature
       ID         ID        #IMPLIED
   >

   <!ELEMENT Manifest
       (       Algorithm+,
               Digest+,
               Attribute*,
               OriginatorInfo,
               RecipientInfo+
       )
   >

   <!ATTLIST Manifest
       LocatorHRefBase       CDATA             #IMPLIED
   >

   <!ELEMENT Algorithm (Parameter*) >
   <!ATTLIST Algorithm
       ID                     ID                #REQUIRED
       type            (digest|signature)      #IMPLIED
       name                  NMTOKEN           #REQUIRED
   >

   <!ELEMENT Digest (Locator, Value) >
   <!ATTLIST Digest
       DigestAlgorithmRef    IDREF             #REQUIRED
   >

   <!ELEMENT Attribute ( ANY ) >
   <!ATTLIST Attribute
       type                   NMTOKEN           #REQUIRED
       critical            ( true | false )     #REQUIRED
   >

   <!ELEMENT OriginatorInfo ANY >

   <!ATTLIST OriginatorInfo
       OriginatorRef           NMTOKEN          #IMPLIED
   >

   <!ELEMENT RecipientInfo ANY >
   <!ATTLIST RecipientInfo
       SignatureAlgorithmRef   IDREF            #REQUIRED
       SignatureValueRef       IDREF            #IMPLIED
       SignatureCertRef        IDREF            #IMPLIED
       RecipientRefs           NMTOKENS         #IMPLIED
   >

   <!ELEMENT KeyIdentifier EMPTY>
   <!ATTLIST KeyIdentifier
       value                    CDATA           #REQUIRED
   >

   <!ELEMENT Parameter ANY >
   <!ATTLIST Parameter
       type                     CDATA           #REQUIRED
   >

   <!--
   ******************************************************
   * IOTP CERTIFICATE COMPONENT DEFINITION              *
   ******************************************************
   -->

   <!ELEMENT Certificate
    (  IssuerAndSerialNumber,  ( Value | Locator ) )
   >

   <!ATTLIST Certificate
       ID                        ID                #IMPLIED
       type                      NMTOKEN           #REQUIRED
   >

   <!ELEMENT IssuerAndSerialNumber EMPTY >
   <!ATTLIST IssuerAndSerialNumber
       issuer                     CDATA            #REQUIRED
       number                     CDATA            #REQUIRED
   >

   <!--
   ******************************************************
   * IOTP SHARED COMPONENT DEFINITION                   *
   ******************************************************

   -->
   <!ELEMENT Value ( #PCDATA ) >
   <!ATTLIST Value
       ID               ID           #IMPLIED
       encoding    (base64|none)    'base64'
   >

   <!ELEMENT Locator EMPTY>
   <!ATTLIST Locator
       xml:link        CDATA         #FIXED        'simple'
       href            CDATA         #REQUIRED
   >
```

---
## **14. Glossary**

이 섹션에는 본 사양에서 사용되는 일부 용어에 대한 용어집이 알파벳순으로 포함되어 있습니다.

```text
          NAME                            DESCRIPTION

   Authenticator      The Organisation which is requesting the
                      authentication of another Organisation, and

   Authenticatee      The Organisation being authenticated by an
                      Authenticator

   Business Error     See Status Component.
```

브랜드 A 브랜드는 특정 유형의 결제 수단을 식별하는 표시입니다. 브랜드 목록은 판매자가 소비자에게 제시하고 소비자가 선택하는 결제 옵션입니다. 각 브랜드마다 다른 결제 처리자가 있을 수 있습니다. 브랜드의 예는 다음과 같습니다. o 결제 협회 및 독점 브랜드\(예: MasterCard, Visa, American Express, Diners Club, American Express, Mondex, GeldKarte, CyberCash 등\) o 프로모션 브랜드\(아래 참조\). 여기에는 다음이 포함됩니다. o 특정 판매자\(예: Walmart, Sears 또는 Marks and Spencer\(UK\)\)가 결제 수단을 소비자에게 발행하는 매장 브랜드 o 공동 브랜드\(예: American Advantage Visa\)\(회사가 자체 브랜드를 사용하는 경우\) 일반적으로 결제 협회 브랜드와 관련된 브랜드입니다.

소비자 상품이나 서비스의 혜택을 받고 일반적으로 비용을 지불하는 조직입니다.

ContentSoftwareId 여기에는 요소의 콘텐츠를 생성한 소프트웨어를 식별하는 정보가 포함됩니다. 그 목적은 서로 다른 소프트웨어에서 생성된 메시지 간의 비호환성으로 인해 발생할 수 있는 상호 운용성 문제를 해결하는 데 도움을 주는 것입니다. xml:lang에 의해 정의된 언어로 된 단일 텍스트 문자열입니다. 여기에는 최소한 다음이 포함되어야 합니다. o 소프트웨어 제조업체 이름 o 소프트웨어 이름 o 소프트웨어 버전 o 소프트웨어 빌드

```text
                      It is recommended that this attribute is included
                      whenever the software which generated the content
                      cannot be identified from the SoftwareId attribute
                      on the Message Id Component (see section 3.3.2)
```

고객 관리 일반적으로 판매자를 대신하여 고객 관리 제공자를 제공하는 조직입니다. 고객 관리의 예로는 소비자가 참여한 IOTP 거래로 인해 소비자가 제기한 문제에 대한 대응이 포함됩니다.

배송 처리자 판매자를 대신하여 소비자에게 상품이나 서비스를 직접 배송하는 조직입니다. 배송은 디지털 상품\(예: \[MIME\] 메시지\)의 형태이거나 우편이나 택배를 통해 물리적으로 배송될 수 있습니다.

문서 교환 문서 교환은 인터넷을 통해 전송되어야 하는 실제 IOTP 메시지 수를 최소화하기 위해 두 거래 교환의 일부 또는 전체를 동시에 구현하는 두 당사자 간에 교환되는 IOTP 메시지 세트로 구성됩니다.

- 문서 교환은 특정 IOTP 트랜잭션을 구현하기 위해 순서대로 결합됩니다.

```text
   Dual Brand         A Dual Brand means that a single Payment
                      Instrument may be used as if it were two separate
                      Brands. For example there could be a single
                      Japanese "UC" MasterCard which can be used as
```

- UC 카드 또는 일반 MasterCard 중 하나입니다. UC 카드 브랜드와 MasterCard 브랜드는 각각 별도의 결제 처리기를 가질 수 있습니다. 이는 다음을 의미합니다. o 판매자가 소비자에게 브랜드 목록을 제공할 때 예를 들어 "UC"와 "MasterCard"를 두 개의 별도 브랜드로 취급합니다. o 소비자가 브랜드\(예: "UC" 또는 "MasterCard\)를 선택합니다. o 소비자 IOTP 인식 애플리케이션은 선택한 브랜드와 일치하는 결제 수단을 결정하고 사용자 지원을 통해 사용할 올바른 결제 수단을 선택합니다.

오류 차단 오류 차단은 이전에 수신된 IOTP 메시지에서 기술적 오류가 발견되었음을 보고합니다. 일반적으로 기술적 오류는 수신된 XML의 오류 또는 IOTP 메시지 처리의 기술적 오류로 인해 발생합니다. 오류 블록이 생성되거나 수신되면 IOTP 트랜잭션이 실패하는 경우가 많습니다. 이는 IOTP 트랜잭션 실패를 일으킬 수도 있는 상태 구성 요소에 보고되는 비즈니스 오류와는 다릅니다.

교환 블록 교환 블록은 거래 교환에 관련된 두 거래 역할 간에 전송됩니다. 여기에는 하나 이상의 거래 구성요소가 포함되어 있습니다. 교환 블록은 항상 거래 교환에서 요청 블록 뒤와 응답 블록 앞에 전송됩니다. 교환 블록의 내용은 수행되는 거래 교환 유형에 따라 다릅니다.

```text
   IOTP Message       An IOTP Message is the outermost wrapper for the
                      document(s) which are sent between Trading Roles
                      that are taking part in a trade. It is a well
                      formed XML document. The documents it contains
                      consist of:
                       o a Transaction Reference Block to uniquely
                         identify the IOTP Transaction of which the IOTP
                         Message is part,
                       o an optional Signature Block to digitally sign
                         the Trading Blocks or Trading Components
                         associated with the IOTP Transaction
                       o an optional Error Block to report on technical
                         errors contained in a previously received IOTP
                         Message, and
```

- o IOTP 거래를 수행하는 데 필요한 데이터를 전달하는 IOTP 거래 블록 모음입니다.

IOTP 거래 인터넷 개방형 거래 프로토콜 거래의 인스턴스는 거래 역할 간에 전송되는 IOTP 메시지 세트로 구성됩니다. IOTP 메시지에 포함될 수 있는 내용에 대한 규칙은 IOTP 트랜잭션의 트랜잭션 유형에 의해 정의됩니다.

IOTP 트랜잭션 트랜잭션 유형은 IOTP 유형 트랜잭션의 유형을 식별합니다. 거래 유형의 예로는 구매, 환불, 인증, 출금, 입금\(전자화폐\)이 있습니다. 거래 유형은 IOTP 거래에 대해 다음을 지정합니다. o 거래에 포함될 수 있는 거래 교환 o 거래의 비즈니스 요구를 충족하기 위해 해당 거래 교환을 결합할 수 있는 방법 o 거래 블록이 IOTP 메시지에 포함될 수 있는 방법 o 각 거래 유형에 적용되는 규칙은 이 사양을 참조하세요.

```text
   Merchant           The Organisation from whom the service or goods
                      are being obtained, who is legally responsible for
                      providing the goods or services and receives the
                      benefit of any payment made

   Merchant Customer  The Organisation that is involved with customer
   Care Provider      dispute negotiation and resolution on behalf of
                      the Merchant

   Organisation       A company or individual that takes part in a Trade
                      as a Trading Role. The Organisations may take one
                      or more of the roles involved in the Trade

   Payment Handler    The Organisation that physically receives the
                      payment from the Consumer on behalf of the
                      Merchant

   Payment            A Payment Instrument is the means by which
   Instrument         Consumer pays for goods or services offered by a
                      Merchant. It can be, for example:
                       o a credit card such as MasterCard or Visa;
                       o a debit card such as MasterCard's Maestro;
                       o a smart card based electronic cash Payment
```

- Mondex 카드, GeldKarte 카드 또는 Visa Cash 카드와 같은 수단 또는 CyberCash의 CyberCoin 또는 DigiCash 계정과 같은 소프트웨어 기반 전자 결제 계정.

- 모든 결제 수단에는 결제 수단을 식별할 수 있는 번호\(일반적으로 계좌 번호\)가 있습니다.

판촉용 브랜드 판촉용 브랜드는 소비자가 해당 브랜드로 비용을 지불하면 소비자가 두 가지 방법으로 받을 수 있는 추가 혜택을 받게 된다는 의미입니다. o 구매 시. 예를 들어 소비자가 Walmart 웹사이트에서 "Walmart MasterCard"로 결제하는 경우 5% 할인이 적용될 수 있습니다. 이는 명세서에 결제 금액이 표시될 때 소비자가 실제로 결제 수단\(카드\) 발급자로부터 더 적은 금액을 지불한다는 의미입니다. . 예를 들어, 상용 고객 제도의 로열티 포인트는 마지막 명세서가 발행된 이후 결제 수단으로 이루어진 총 결제 금액을 기준으로 부여될 수 있습니다.

- 각 프로모션 브랜드는 판매자가 제공하는 브랜드 목록에서 별도의 브랜드로 식별되어야 합니다.

영수증 구성요소 영수증 구성요소는 거래 교환의 성공적인 완료에 대한 기록입니다. 영수증 구성 요소의 예로는 지불 영수증 및 배송 메모가 있습니다. 해당 콘텐츠는 거래 교환을 수행하는 데 사용되는 기술에 따라 달라질 수 있습니다. 예를 들어 SET\(Secure Electronic Transaction\) 결제 영수증은 결제 결과를 기록하는 SET 결제 메시지로 구성됩니다.

```text
   Request Block      A Request Block is Trading Block that contains a
                      request for a Trading Exchange to start. The
                      Trading Components in a Request Block may be
                      signed by a Signature Block so that their
                      authenticity may be checked and to determine that
                      the Trading Exchange being requested is
                      authorised. Authorisation for a Trading Exchange
                      to start can be provided by the signatures
                      contained on Receipt Components contained in

                      Response Blocks resulting from previously
                      completed Trading Exchanges.  Examples of Request
                      Blocks are Payment Request and Delivery Request
```

응답 블록 응답 블록은 거래 교환이 완료되었음을 나타내는 거래 블록입니다. 블록 요청을 받은 거래 역할이 블록 요청을 보낸 거래 역할로 전송됩니다. 응답 블록에는 거래 교환 완료에 대한 정보가 포함된 상태 구성 요소가 포함되어 있습니다. 예를 들어 거래 교환이 성공적으로 완료되었는지 여부를 나타냅니다. 일부 거래 거래소의 경우 응답 블록에는 거래 거래소의 기록을 형성하는 영수증 구성 요소가 포함되어 있습니다. 영수증 구성 요소는 서명 블록을 사용하여 디지털 방식으로 서명되어 완료를 반박할 수 없게 만들 수 있습니다. 응답 블록의 예로는 제안 응답, 지불 응답 및 배송 응답이 있습니다.

서명 블록 서명 블록은 서명 구성요소 형태의 하나 이상의 디지털 서명을 포함하는 거래 블록입니다. 서명 구성 요소는 동일한 IOTP 트랜잭션의 IOTP 메시지에 있는 모든 블록이나 구성 요소에 디지털 서명을 할 수 있습니다.

상태 구성 요소 상태 구성 요소에는 거래소의 상태를 설명하는 정보가 포함되어 있습니다.

- 거래소가 완료되기 전에 상태 구성요소는 거래소가 어떻게 진행되고 있는지에 대한 정보를 표시할 수 있습니다.

- 일단 거래 교환이 완료되면 상태 구성 요소는 거래 교환의 성공 또는 비즈니스 오류가 발생했음을 나타낼 수 있습니다.

- 비즈니스 오류는 IOTP 트랜잭션의 IOTP 메시지 내용이나 형식과 관련된 기술 오류가 아니라 일부 비즈니스 규칙이나 논리\(예: "사용 가능한 자금 부족"\)로 인해 Trading Exchange를 계속할 수 없음을 나타냅니다. .

```text
   Technical Error    See Error Block.

   Trading Block      A Trading Block consists of one or more Trading
                      Components. One or more Trading Blocks may be
                      contained within the IOTP Messages which are
                      physically sent in the form of [XML] documents
                      between the different Trading Roles that are
                      taking part in a trade. Trading Blocks are of
                      three main types:
                       o a Request Block,
                       o an Exchange Block, or a
                       o a Response Block
```

거래 구성요소 거래 구성요소는 XML 요소 및 속성의 모음입니다. 거래 구성요소는 거래 블록의 하위 요소입니다. 거래 구성요소의 예는 다음과 같습니다: 제안, 브랜드 목록, 결제 영수증, 배송\[정보\], 결제 금액\[정보\]

거래 교환 거래 교환은 두 거래 역할 간의 일련의 문서 교환으로 구성됩니다. 문서는 거래 블록의 형태일 수도 있고 웹 페이지에 데이터를 입력하는 등의 다른 수단을 통해 전송될 수도 있습니다. 각 거래 교환은 세 가지 주요 부분으로 구성됩니다. o 하나의 거래 역할\(개시자\)이 다른 거래 역할\(수신자\)에게 요청 블록을 보내는 것, o 수신자와 개시자 사이에 하나 이상의 교환 블록을 선택적으로 교환하는 것, 결국 요청 블록을 수신한 거래 역할은 개시자에게 응답 블록을 보냅니다.

- 무역 거래소는 일종의 유용한 서비스를 구현하도록 설계되었습니다. 거래 교환/서비스의 예는 다음과 같습니다. o 소비자가 판매자로부터 일종의 비즈니스 거래를 수행하라는 제안을 받도록 하는 제안 o 소비자가 지불 처리자에게 지불하는 결제 o 배송 소비자는 배송 핸들러로부터 상품이나 서비스의 배송을 요청하고 선택적으로 얻습니다. o 인증\(모든 거래 역할이 다른 거래 역할에 대한 정보를 요청하고 수신할 수 있음\).

거래 역할 거래 역할은 조직이 거래에 참여할 수 있는 다양한 방법을 식별합니다. 거래 역할에는 소비자, 판매자, 결제 처리자, 배송 처리자, 판매자 고객 관리 제공자의 다섯 가지 역할이 있습니다.

```text
   Transaction        A Transaction Reference Block identifies an IOTP
   Reference Block    Transaction. It contains data that identifies:
                       o the Transaction Type,
                       o the IOTP Transaction uniquely, through a
                         globally unique transaction identifier
                       o the IOTP Message uniquely within the IOTP
                         Transaction, through a message identifier

                      The Transaction Reference Block may also contain
                      references to other transactions which may or may
                      not be IOTP Transactions
```

---
## **15. References**

이 섹션에는 이 사양에 식별된 관련 문서에 대한 참조가 포함되어 있습니다.

\[Base64\] Freed, N. 및 N. Borenstein, "다목적 인터넷 메일 확장\(MIME\) 1부: 인터넷 메시지 본문 형식", RFC 2045, 1996년 11월.

\[DOM-HASH\] Maruyama, H., Tamura, K. 및 N. Uramoto, "DOMHASH\(DOMHASH\)에 대한 다이제스트 값", RFC 2803, 2000년 4월.

\[DNS\] Mockapetris, P., "도메인 이름 - 개념 및

- 시설", STD 13, RFC 1034, 1987년 11월.

\[DNS\] Mockapetris, P., "도메인 이름 - 구현 및 사양", STD 13, RFC 1035, 1987년 11월.

\[DSA\] 미국 정부의 캡스톤 프로젝트의 일환으로 미국 국립표준기술연구소\(NIST\)가 디지털 서명 표준\(DSS\)으로 발표한 디지털 서명 알고리즘\(DSA\)입니다.

\[ECCDSA\] 타원 곡선 암호 시스템 디지털 서명 알고리즘\(ECCDSA\). 타원 곡선 암호화 시스템은 모듈식 곱셈이 타원 곡선 추가 연산으로 대체되는 RSA와 같은 공개 키 암호화 시스템과 유사합니다. 참조: V. S. 밀러. 암호화에 타원 곡선을 사용합니다. In Advances in Cryptology - Crypto '85, 페이지 417-426, Springer-Verlag, 1986.

\[HMAC\] Krawczyk, H., Bellare, M. 및 R. Canetti, "HMAC: 메시지 인증을 위한 키 해싱", RFC 2104, 1997년 2월.

\[HTML\] Berners-Lee, T. 및 D. Connolly, "하이퍼텍스트 마크업 언어 - 2.0", RFC 1866, 1995년 11월.

```text
   [HTML]      Hyper Text Mark Up Language. The Hypertext Mark-up
               Language (HTML) is a simple mark-up language used to
               create hypertext documents that are platform independent.
               See the World Wide Web (W3C) consortium web site at:
               http://www.w3.org/MarkUp/
```

\[HTTP\] Berners-Lee, T., Fielding, R. 및 H. Frystyk, "하이퍼텍스트 전송 프로토콜 - HTTP/1.0", RFC 1945, 1996년 5월.

\[HTTP\] Fielding, R., Gettys, J., Mogul, J., Frystyk, T. 및 T. Berners-Lee, "하이퍼텍스트 전송 프로토콜 - HTTP/1.1.", RFC 2616, 1999년 6월.

```text
   [IANA]      The Internet Assigned Numbers Authority. The organisation
               responsible for co-ordinating the names and numbers
               associated with the Internet. See http://www.iana.org/
```

\[ISO4217\] ISO 4217: 통화 표시 코드. ANSI 또는 ISO에서 사용 가능합니다.

\[IOTPDSIG\] Davidson, K. 및 Y. Kawatsura, "v1.0 IOTP\(Internet Open Trading Protocol\)용 디지털 서명", RFC 2802, 2000년 4월.

```text
   [MD5]       Rivest, R., "The MD5 Message-Digest Algorithm", RFC 1321,
               April 1992.
```

\[MIME\] Crocker, D., "ARPA 인터넷 문자 메시지 형식에 대한 표준", STD 11, RFC 822, 1982년 8월.

\[MIME\] Freed, N. 및 N. Borenstein, "다목적 인터넷 메일 확장\(MIME\) 1부: 인터넷 메시지 본문 형식", RFC 2045, 1996년 11월.

\[MIME\] Freed, N. 및 N. Borenstein, "다목적 인터넷 메일 확장\(MIME\) 2부: 미디어 유형", RFC 2046, 1996년 11월.

\[MIME\] Moore, K., "MIME\(다목적 인터넷 메일 확장\) 3부: 비ASCII 텍스트에 대한 메시지 헤더 확장" RFC 2047, 1996년 11월.

\[MIME\] Freed, N., Klensin, J. 및 J. Postel, "다목적 인터넷 메일 확장\(MIME\) 4부: 등록 절차", RFC 2048, 1996년 11월.

\[MIME\] Freed, N. 및 N. Borenstein, "다목적 인터넷 메일 확장\(MIME\) 5부: 적합성 기준 및 예" RFC 2049, 1996년 11월.

\[OPS\] 오픈 프로파일링 표준. 개인과 웹 사이트 간의 신뢰할 수 있는 프로필 정보 교환을 위해 내장된 개인 정보 보호 장치가 있는 프레임워크를 제공하는 제안된 표준입니다. Netscape와 Microsoft에서 개발 중입니다.

\[RFC1738\] Berners-Lee, T., Masinter, L. 및 M. McCahill, "Uniform Resource Locators\(URL\)", RFC 1738, 1994년 12월.

\[RFC2434\] Narten, T. 및 H. Alvestrand, "RFC에서 IANA 고려 사항 섹션 작성 지침", BCP 26, RFC 2434, 1998년 10월.

\[RSA\] RSA는 RSA Data Security Inc.에서 지원하는 암호화 및 인증을 위한 공개 키 암호화 시스템입니다. 참조: R. L. Rivest, A. Shamir 및 L.M. Adleman. 디지털 서명 및 공개 키 암호화 시스템을 얻는 방법입니다. ACM 커뮤니케이션, 21\(2\): 120-126, 1978년 2월.

\[SCCD\] 보안 채널 신용 차변. SSL/TLS와 같은 보안 채널 전송 메커니즘을 사용하여 계정 정보에 대한 무단 액세스를 방지하는 신용 ​​카드 또는 직불 카드 결제를 수행하는 방법입니다. SCCD 작동 방식을 설명하는 IOTP 보충 자료가 개발 중입니다.

```text
   [SET]       Secure Electronic Transaction Specification, Version 1.0,
               May 31, 1997. Supports credit and debit card payments
               using certificates at the Consumer and Merchant to help
               ensure authenticity.  Download from:
               <http://www.setco.org>.
```

\[SSL/TLS\] Dierks, T. 및 C. Allen, "TLS 프로토콜 버전 1.0", RFC 2246, 1999년 1월.

\[SHA1\] \[FIPS-180-1\]"보안 해시 표준", 미국 상무부 국립 표준 기술 연구소, 1995년 4월.라고도 함: 59 Fed Reg. 35317\(1994\). http://www.itl.nist.gov/div897/pubs/fip180-1.htm을 참조하세요.

\[UTC\] 협정 세계시. 그리니치 표준시\(GMT\)를 절대적으로 기준으로 시간을 정의하는 방법입니다. 일반적으로 "CCYY-MM-DDTHH:MM:SS.sssZ+n" 형식입니다. 여기서 "+n"은 GMT 기준의 시간을 정의합니다. ISO DIS8601을 참조하십시오.

\[UTF16\] 유니코드 표준, 버전 2.0. 유니코드

- 컨소시엄, 레딩, 매사추세츠. ISO/IEC 10646 1 제안된 초안 수정안 1 참조

```text
   [X.509]     ITU Recommendation X.509 1993 | ISO/IEC 9594-8: 1995,
               Including Draft Amendment 1: Certificate Extensions
               (Version 3 Certificate)

   [XML        Recommendation for Namespaces in XML, World Wide Web
   Namespace]  Consortium, 14 January 1999, "http://www.w3.org/TR/REC-
               xml-names"
```

\[XML\] 확장 가능한 마크업 언어. W3C 권장 사항. 1998년 2월 10일 버전은 http://www.w3.org/TR/1998/REC-xml-19980210을 참조하세요.

---
## **16. Author's Address**

이 문서의 작성자는 다음과 같습니다.

```text
   David Burdett
   Commerce One
   4440 Rosewood Drive, Bldg 4
   Pleasanton
   California 94588
   USA

   Phone: +1 (925) 520 4422
   EMail: david.burdett@commerceone.com
```

이 문서의 저자는 특히 이 사양 개발의 형성 단계에서 제공한 엄청난 지원에 대해 Mondex International Limited\(www.mondex.com\)에게 감사의 말씀을 전하고 싶습니다.

또한 저자는 이 프로토콜이 없었다면 개발할 수 없었을 이 프로토콜\(회사의 알파벳 순서\)에 기여한 다음 분들께 감사드립니다.

```text
      -  Phillip Mullarkey, British Telecom plc
```

- - Andrew Marchewka, 캐나다 임페리얼 상업은행

```text
      -  Brian Boesch, CyberCash Inc.

      -  Tom Arnold, CyberSource

      -  Terry Allen, Commerce One (formally Veo Systems)

      -  Richard Brown, GlobeSet Inc.

      -  Peter Chang, Hewlett Packard

      -  Masaaki Hiroya, Hitachi Ltd

      -  Yoshiaki Kawatsura, Hitachi Ltd

      -  Mark Linehan, International Business Machines

      -  Jonathan Sowler, JCP Computer Services Ltd

      -  John Wankmueller, MasterCard International

      -  Steve Fabes, Mondex International Ltd

      -  Donald Eastlake 3rd, Motorola Inc (formerly International
         Business Machines Inc)

      -  Surendra Reddy, Oracle Corporation

      -  Akihiro Nakano, Plat Home, Inc. (ex Hitachi Ltd)
```

- - 크리스 스미스\(Chris Smith\), 캐나다 왕립은행

- - Hans Bernhard-Beykirch, SIZ\(IT 개발 및 조정

```text
         Centre of the German Savings Banks Organisation)

      -  W. Reid Carlisle, Spyrus (ex Citibank Universal Card Services,
         formally AT&T Universal Card Services)

      -  Efrem Lipkin, Sun Microsystems

      -  Tony Lewis, Visa International
```

저자는 또한 지원해 준 다음 기관들에도 감사의 말씀을 전하고 싶습니다.

```text
      -  Amino Communications

      -  DigiCash

      -  Fujitsu

      -  General Information Systems

      -  Globe Id Software

      -  Hyperion

      -  InterTrader

      -  Nobil I T Corp

      -  Mercantec

      -  Netscape
```

- - 일본전신전화주식회사

```text
      -  Oracle Corporation

      -  Smart Card Integrations Ltd.

      -  Spyrus

      -  Verifone

      -  Unisource nv

      -  Wells Fargo Bank
```

---
## **17. Full Copyright Statement**

저작권\(C\)인터넷학회\(2000\). 판권 소유.

이 문서와 그 번역본은 복사되어 타인에게 제공될 수 있으며, 이에 대해 설명하거나 설명하거나 구현을 지원하는 파생물은 어떤 종류의 제한 없이 전체적으로 또는 부분적으로 준비, 복사, 출판 및 배포될 수 있습니다. , 단, 위의 저작권 표시와 이 단락은 그러한 모든 사본 및 파생물에 포함됩니다. 그러나 이 문서 자체는 인터넷 표준 개발 목적으로 필요한 경우를 제외하고는 저작권 표시를 제거하거나 Internet Society 또는 기타 인터넷 조직에 대한 참조를 제거하는 등 어떤 식으로든 수정할 수 없습니다. 인터넷 표준 프로세스를 따르거나 영어 이외의 언어로 번역하는 데 필요한 대로 따라야 합니다.

위에서 부여된 제한된 권한은 영구적이며 Internet Society 또는 그 승계자 또는 양수인에 의해 취소되지 않습니다.

이 문서와 여기에 포함된 정보는 "있는 그대로" 제공되며 인터넷 사회 및 인터넷 공학 태스크포스는 여기에 포함된 정보의 사용이 상품성 또는 특정 목적에의 적합성에 대한 권리 또는 묵시적 보증을 침해하는 행위.

---
# **Acknowledgement**

RFC 편집기 기능에 대한 자금은 현재 Internet Society에서 제공하고 있습니다.