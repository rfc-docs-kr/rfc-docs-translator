

```text
Network Working Group                                    Y. Rekhter, Ed.
Request for Comments: 4271                                    T. Li, Ed.
Obsoletes: 1771                                            S. Hares, Ed.
Category: Standards Track                                   January 2006
```

- BGP-4\(Border Gateway Protocol 4\)

---
# **Status of This Memo**

본 문서는 인터넷 커뮤니티를 위한 인터넷 표준 트랙 프로토콜을 명시하고 개선을 위한 논의와 제안을 요청합니다. 이 프로토콜의 표준화 상태 및 상태에 대해서는 "인터넷 공식 프로토콜 표준"\(STD 1\) 최신판을 참조하세요. 이 메모의 배포는 무제한입니다.

---
# **Copyright Notice**

저작권\(C\)인터넷학회\(2006\).

---
# **Abstract**

이 문서에서는 자율 시스템 간 라우팅 프로토콜인 BGP\(Border Gateway Protocol\)에 대해 설명합니다.

BGP 말하기 시스템의 주요 기능은 다른 BGP 시스템과 네트워크 연결 가능성 정보를 교환하는 것입니다. 이 네트워크 도달성 정보에는 도달성 정보가 순회하는 자율 시스템\(AS\) 목록에 대한 정보가 포함됩니다. 이 정보는 라우팅 루프를 정리할 수 있는 연결 가능성에 대한 AS 연결 그래프를 구성하는 데 충분하며 AS 수준에서 일부 정책 결정이 시행될 수 있습니다.

BGP-4는 CIDR\(Classless Inter-Domain Routing\)을 지원하기 위한 일련의 메커니즘을 제공합니다. 이러한 메커니즘에는 대상 집합을 IP 접두사로 알리는 지원과 BGP 내에서 네트워크 "클래스" 개념을 제거하는 기능이 포함됩니다. BGP-4에는 AS 경로 집계를 포함하여 경로 집계를 허용하는 메커니즘도 도입되었습니다.

이 문서는 RFC 1771을 폐기합니다.

---
# **Table of Contents**

```text
   1. Introduction ....................................................4
      1.1. Definition of Commonly Used Terms ..........................4
      1.2. Specification of Requirements ..............................6
   2. Acknowledgements ................................................6
   3. Summary of Operation ............................................7
      3.1. Routes: Advertisement and Storage ..........................9
      3.2. Routing Information Base ..................................10
   4. Message Formats ................................................11
      4.1. Message Header Format .....................................12
      4.2. OPEN Message Format .......................................13
      4.3. UPDATE Message Format .....................................14
      4.4. KEEPALIVE Message Format ..................................21
      4.5. NOTIFICATION Message Format ...............................21
   5. Path Attributes ................................................23
      5.1. Path Attribute Usage ......................................25
           5.1.1. ORIGIN .............................................25
           5.1.2. AS_PATH ............................................25
           5.1.3. NEXT_HOP ...........................................26
           5.1.4. MULTI_EXIT_DISC ....................................28
           5.1.5. LOCAL_PREF .........................................29
           5.1.6. ATOMIC_AGGREGATE ...................................29
           5.1.7. AGGREGATOR .........................................30
   6. BGP Error Handling. ............................................30
      6.1. Message Header Error Handling .............................31
      6.2. OPEN Message Error Handling ...............................31
      6.3. UPDATE Message Error Handling .............................32
      6.4. NOTIFICATION Message Error Handling .......................34
      6.5. Hold Timer Expired Error Handling .........................34
      6.6. Finite State Machine Error Handling .......................35
      6.7. Cease .....................................................35
      6.8. BGP Connection Collision Detection ........................35
   7. BGP Version Negotiation ........................................36
   8. BGP Finite State Machine (FSM) .................................37
      8.1. Events for the BGP FSM ....................................38
           8.1.1. Optional Events Linked to Optional Session
                  Attributes .........................................38
           8.1.2. Administrative Events ..............................42
           8.1.3. Timer Events .......................................46
           8.1.4. TCP Connection-Based Events ........................47
           8.1.5. BGP Message-Based Events ...........................49
      8.2. Description of FSM ........................................51
           8.2.1. FSM Definition .....................................51
                  8.2.1.1. Terms "active" and "passive" ..............52
                  8.2.1.2. FSM and Collision Detection ...............52
                  8.2.1.3. FSM and Optional Session Attributes .......52
                  8.2.1.4. FSM Event Numbers .........................53
                  8.2.1.5. FSM Actions that are Implementation
                           Dependent .................................53
           8.2.2. Finite State Machine ...............................53
   9. UPDATE Message Handling ........................................75
      9.1. Decision Process ..........................................76
           9.1.1. Phase 1: Calculation of Degree of Preference .......77
           9.1.2. Phase 2: Route Selection ...........................77
                  9.1.2.1. Route Resolvability Condition .............79
                  9.1.2.2. Breaking Ties (Phase 2) ...................80
           9.1.3. Phase 3: Route Dissemination .......................82
           9.1.4. Overlapping Routes .................................83
      9.2. Update-Send Process .......................................84
           9.2.1. Controlling Routing Traffic Overhead ...............85
                  9.2.1.1. Frequency of Route Advertisement ..........85
                  9.2.1.2. Frequency of Route Origination ............85
           9.2.2. Efficient Organization of Routing Information ......86
                  9.2.2.1. Information Reduction .....................86
                  9.2.2.2. Aggregating Routing Information ...........87
      9.3. Route Selection Criteria ..................................89
      9.4. Originating BGP routes ....................................89
   10. BGP Timers ....................................................90
   Appendix A.  Comparison with RFC 1771 .............................92
   Appendix B.  Comparison with RFC 1267 .............................93
   Appendix C.  Comparison with RFC 1163 .............................93
   Appendix D.  Comparison with RFC 1105 .............................94
   Appendix E.  TCP Options that May Be Used with BGP ................94
   Appendix F.  Implementation Recommendations .......................95
                Appendix F.1.  Multiple Networks Per Message .........95
                Appendix F.2.  Reducing Route Flapping ...............96
                Appendix F.3.  Path Attribute Ordering ...............96
                Appendix F.4.  AS_SET Sorting ........................96
                Appendix F.5.  Control Over Version Negotiation ......96
                Appendix F.6.  Complex AS_PATH Aggregation ...........96
   Security Considerations ...........................................97
   IANA Considerations ...............................................99
   Normative References .............................................101
   Informative References ...........................................101
```

---
## **1.  Introduction**

BGP\(Border Gateway Protocol\)는 자율 시스템 간 라우팅 프로토콜입니다.

BGP 말하기 시스템의 주요 기능은 다른 BGP 시스템과 네트워크 연결 가능성 정보를 교환하는 것입니다. 이 네트워크 도달성 정보에는 도달성 정보가 순회하는 자율 시스템\(AS\) 목록에 대한 정보가 포함됩니다. 이 정보는 라우팅 루프를 제거하고 AS 수준에서 일부 정책 결정을 시행할 수 있는 연결 가능성에 대한 AS 연결 그래프를 구성하는 데 충분합니다.

BGP-4는 CIDR\(Classless Inter-Domain Routing\) \[RFC1518, RFC1519\]을 지원하기 위한 메커니즘 세트를 제공합니다. 이러한 메커니즘에는 대상 집합을 IP 접두사로 알리는 지원과 BGP 내에서 네트워크 "클래스" 개념을 제거하는 기능이 포함됩니다. BGP-4에는 AS 경로 집계를 포함하여 경로 집계를 허용하는 메커니즘도 도입되었습니다.

BGP를 통해 교환되는 라우팅 정보는 라우터가 패킷의 IP 헤더에 포함된 대상 주소만을 기반으로 패킷을 전달한다고 가정하는 대상 기반 전달 패러다임만 지원합니다. 이는 결국 BGP를 사용하여 시행할 수 있거나 시행할 수 없는 일련의 정책 결정을 반영합니다. BGP는 대상 기반 전달 패러다임을 준수하는 정책만 지원할 수 있습니다.

---
### **1.1.  Definition of Commonly Used Terms**

이 섹션에서는 BGP 프로토콜에 특정 의미가 있고 본문 전체에서 사용되는 용어에 대한 정의를 제공합니다.

Adj-RIB-In - Adj-RIBs-In에는 피어가 로컬 BGP 스피커에 광고한 처리되지 않은 라우팅 정보가 포함되어 있습니다.

Adj-RIB-Out - Adj-RIBs-Out에는 로컬 스피커의 UPDATE 메시지를 통해 특정 피어에게 광고하기 위한 경로가 포함되어 있습니다.

AS\(자율 시스템\) - 자율 시스템의 고전적인 정의는 내부 게이트웨이 프로토콜\(IGP\) 및 공통 메트릭을 사용하여 AS 내에서 패킷을 라우팅하는 방법을 결정하고 상호 연결을 사용하는 단일 기술 관리 하의 라우터 세트입니다. 패킷을 다른 AS로 라우팅하는 방법을 결정하는 AS 라우팅 프로토콜입니다. 이 고전적인 정의가 개발된 이후 단일 AS가 다음과 같은 일을 하는 것이 일반적이 되었습니다.

- 여러 IGP를 사용하고 때로는 AS 내에서 여러 메트릭 세트를 사용합니다. 자율 시스템이라는 용어의 사용은 여러 IGP와 메트릭이 사용되는 경우에도 AS 관리가 다른 AS에 일관된 단일 내부 라우팅 계획을 갖는 것으로 나타나고 도달 가능한 대상에 대한 일관된 그림을 제공한다는 사실을 강조합니다. 그것을 통해.

BGP 식별자 - BGP 메시지 발신자의 BGP 식별자를 나타내는 4옥텟의 부호 없는 정수입니다. 지정된 BGP 스피커는 BGP 식별자 값을 해당 BGP 스피커에 할당된 IP 주소로 설정합니다. BGP 식별자의 값은 시작 시 결정되며 모든 로컬 인터페이스 및 BGP 피어에 대해 동일합니다.

BGP 스피커 - BGP를 구현하는 라우터입니다.

EBGP - 외부 BGP\(외부 피어 간의 BGP 연결\)입니다.

외부 피어 - 로컬 시스템과 다른 자치 시스템에 있는 피어입니다.

실행 가능한 경로 - 수신자가 사용할 수 있는 공지된 경로입니다.

IBGP - 내부 BGP\(내부 피어 간의 BGP 연결\)입니다.

내부 피어 - 로컬 시스템과 동일한 자치 시스템에 있는 피어입니다.

IGP\(Interior Gateway Protocol\) - 단일 자치 시스템 내의 라우터 간에 라우팅 정보를 교환하는 데 사용되는 라우팅 프로토콜입니다.

Loc-RIB - Loc-RIB에는 로컬 BGP 스피커의 결정 프로세스에 의해 선택된 경로가 포함됩니다.

```text
   NLRI
      Network Layer Reachability Information.
```

경로\(Route\) - 목적지 세트를 해당 목적지에 대한 경로 속성과 쌍을 이루는 정보 단위입니다. 세트

- 목적지는 UPDATE 메시지의 NLRI\(Network Layer Reachability Information\) 필드에 전달되는 하나의 IP 주소 접두사에 IP 주소가 포함된 시스템입니다. 경로는 동일한 UPDATE 메시지의 경로 속성 필드에 보고된 정보입니다.

```text
   RIB
      Routing Information Base.
```

실행 불가능 경로 - 이전에 광고되었지만 더 이상 사용할 수 없는 실행 가능 경로입니다.

---
### **1.2.  Specification of Requirements**

이 문서의 핵심 단어 "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY" 및 "OPTIONAL"은 다음과 같습니다. RFC 2119 \[RFC2119\]에 설명된 대로 해석됩니다.

---
## **2.  Acknowledgements**

이 문서는 원래 Kirk Lougheed와 Yakov Rekhter가 공동으로 작성하여 1991년 10월에 \[RFC1267\]로 출판되었습니다.

이 문서의 이전 버전\(BGP-1\)에 기여한 Guy Almes, Len Bosack 및 Jeffrey C. Honig에게 감사의 말씀을 전하고 싶습니다.

우리는 이 문서의 이전 버전에 대한 Dennis Ferguson의 많은 기여에 특별히 감사를 표하고 싶습니다.

이 문서의 이전 버전\(BGP-2\)을 검토하고 건설적이고 귀중한 의견을 주신 Bob Braden에게 명시적으로 감사의 말씀을 전하고 싶습니다.

또한 인터넷 엔지니어링 운영 그룹의 라우팅 담당 이사인 Bob Hinden과 그가 이 문서의 이전 버전\(BGP-2\)을 검토하기 위해 구성한 검토자 팀에게도 감사의 말씀을 전하고 싶습니다. Deborah Estrin, Milo Medin, John Moy, Radia Perlman, Martha Steenstrup, Mike St. Johns 및 Paul Tsuchiya로 구성된 이 팀은 강인함, 전문성, 예의의 강력한 조합으로 행동했습니다.

문서의 특정 섹션은 BGP의 OSI 버전인 IDRP \[IS10747\]에서 많이 차용했습니다. 이에 대해서는 Lyman Chapin이 의장을 맡은 ANSI X3S3.3 그룹과 해당 그룹 내 IDRP 편집자였던 Charles Kunzinger에게 공을 돌립니다.

또한 Benjamin Abarbanel, Enke Chen, Edward Crabbe, Mike Craren, Vincent Gillet, Eric Gray, Jeffrey Haas, Dimitry Haskin, Stephen Kent, John Krawczyk, David LeRoy, Dan Massey, Jonathan Natale, Dan Pei, Mathew Richardson에게도 감사의 말씀을 전하고 싶습니다. , John Scudder, John Stewart III, Dave Thaler, Paul Traina, Russ White, Curtis Villamizar 및 Alex Zinin의 의견에 감사드립니다.

이 문서의 최종 버전을 준비하는 데 도움을 준 Andrew Lange에게 특별히 감사의 말씀을 전하고 싶습니다.

마지막으로, 이 문서에 대한 아이디어와 지원을 주신 IDR 실무 그룹의 모든 구성원에게 감사의 말씀을 전하고 싶습니다.

---
## **3.  Summary of Operation**

BGP\(Border Gateway Protocol\)는 자율 시스템 간 라우팅 프로토콜입니다. 이는 EGP\(\[RFC904\]에 정의됨\) 및 NSFNET 백본\(\[RFC1092\] 및 \[RFC1093\]에 설명됨\)에서 EGP 사용을 통해 얻은 경험을 기반으로 구축되었습니다. BGP 관련 자세한 내용은 \[RFC1772\], \[RFC1930\], \[RFC1997\] 및 \[RFC2858\]을 참조하세요.

BGP 말하기 시스템의 주요 기능은 다른 BGP 시스템과 네트워크 연결 가능성 정보를 교환하는 것입니다. 이 네트워크 도달성 정보에는 도달성 정보가 순회하는 자율 시스템\(AS\) 목록에 대한 정보가 포함됩니다. 이 정보는 라우팅 루프를 정리할 수 있는 AS 연결 그래프를 구성하는 데 충분하며 AS 수준에서 일부 정책 결정이 시행될 수 있습니다.

이 문서의 맥락에서 우리는 BGP 스피커가 자신이 사용하는 경로만 피어에게 알린다고 가정합니다. 이 맥락에서 BGP 스피커는 BGP 경로가 가장 선호되는 BGP 경로이고 BGP 경로를 "사용"한다고 합니다. 전달에 사용됩니다\). 다른 모든 경우는 이 문서의 범위를 벗어납니다.

이 문서의 맥락에서 "IP 주소"라는 용어는 IP 버전 4 주소 \[RFC791\]를 나타냅니다.

BGP를 통해 교환되는 라우팅 정보는 라우터가 패킷의 IP 헤더에 포함된 대상 주소만을 기반으로 패킷을 전달한다고 가정하는 대상 기반 전달 패러다임만 지원합니다. 이는 결국 BGP를 사용하여 시행할 수 있거나 시행할 수 없는 일련의 정책 결정을 반영합니다. 일부 정책은 대상 기반 전달 패러다임에서 지원될 수 없으므로 소스 라우팅\(명시적 라우팅이라고도 함\)과 같은 기술을 적용해야 합니다. 이러한 정책은 BGP를 사용하여 시행할 수도 없습니다. 예를 들어 BGP는 하나의 AS가 메시지를 보낼 수 있도록 허용하지 않습니다.

트래픽이 인접 AS를 넘어 일부 대상\(통해 도달 가능\)으로 전달되도록 인접 AS로 트래픽을 전달하고, 해당 트래픽이 인접 AS에서 시작된 트래픽\(동일한 대상에 대해\)이 취한 경로와 다른 경로를 취하도록 의도합니다. 반면 BGP는 대상 기반 전달 패러다임을 준수하는 모든 정책을 지원할 수 있습니다.

BGP-4는 CIDR\(Classless Inter-Domain Routing\) \[RFC1518, RFC1519\]을 지원하기 위한 새로운 메커니즘 세트를 제공합니다. 이러한 메커니즘에는 대상 집합을 IP 접두사로 광고하고 BGP 내에서 네트워크 "클래스" 개념을 제거하는 지원이 포함됩니다. BGP-4에는 AS 경로 집계를 포함하여 경로 집계를 허용하는 메커니즘도 도입되었습니다.

이 문서에서는 전체적으로 '자율 시스템'\(AS\)이라는 용어를 사용합니다. 자율 시스템의 고전적인 정의는 내부 게이트웨이 프로토콜\(IGP\)과 공통 메트릭을 사용하여 AS 내에서 패킷을 라우팅하는 방법을 결정하고 AS 간 라우팅 프로토콜을 사용하여 방법을 결정하는 단일 기술 관리 하의 라우터 세트입니다. 패킷을 다른 AS로 라우팅합니다. 이 고전적인 정의가 개발된 이후 단일 AS가 여러 IGP를 사용하고 경우에 따라 AS 내에서 여러 메트릭 세트를 사용하는 것이 일반적이 되었습니다. 자율 시스템이라는 용어의 사용은 여러 IGP와 메트릭이 사용되는 경우에도 AS 관리가 다른 AS에게 일관된 단일 내부 라우팅 계획을 갖는 것으로 나타나고 이를 통해 도달할 수 있는 대상에 대한 일관된 그림을 제공한다는 사실을 강조합니다. 그것.

BGP는 전송 프로토콜로 TCP \[RFC793\]를 사용합니다. 이렇게 하면 명시적인 업데이트 조각화, 재전송, 승인 및 순서 지정을 구현할 필요가 없습니다. BGP는 TCP 포트 179에서 수신 대기합니다. BGP에 사용되는 오류 알림 메커니즘은 TCP가 "정상적인" 닫기를 지원한다고 가정합니다\(즉, 모든 처리되지 않은 데이터가 연결이 닫기 전에 전달된다는 것\).

두 시스템 간에 TCP 연결이 형성됩니다. 그들은 메시지를 교환하여 연결 매개변수를 열고 확인합니다.

초기 데이터 흐름은 Adj-Ribs-Out\(3.2 참조\)이라고 하는 내보내기 정책에 의해 허용되는 BGP 라우팅 테이블의 일부입니다. 라우팅 테이블이 변경되면 증분 업데이트가 전송됩니다. BGP에서는 라우팅 테이블을 주기적으로 새로 고칠 필요가 없습니다. BGP 연결을 재설정하지 않고 로컬 정책 변경 사항이 올바른 효과를 갖도록 하려면 BGP 스피커는 \(a\) 연결 기간 동안 모든 피어가 광고한 경로의 현재 버전을 유지하거나 \(b\) Route Refresh 확장 \[RFC2918\]을 활용하세요.

연결이 활성화되었는지 확인하기 위해 KEEPALIVE 메시지가 주기적으로 전송될 수 있습니다. NOTIFICATION 메시지는 오류나 특수 조건에 대한 응답으로 전송됩니다. 연결에서 오류 조건이 발생하면 NOTIFICATION 메시지가 전송되고 연결이 닫힙니다.

다른 AS에 있는 피어를 외부 피어\(External Peer\)라고 하고, 같은 AS에 있는 피어를 내부 피어\(Internal Peer\)라고 합니다. 내부 BGP와 외부 BGP는 일반적으로 IBGP 및 EBGP로 축약됩니다.

특정 AS에 여러 개의 BGP 스피커가 있고 다른 AS에 대한 전송 서비스를 제공하는 경우 AS 내 라우팅에 대한 일관된 보기를 보장하기 위해 주의를 기울여야 합니다. AS 내부 경로에 대한 일관된 보기는 AS 내에서 사용되는 IGP에 의해 제공됩니다. 이 문서의 목적을 위해 AS 내의 모든 BGP 스피커가 서로 IBGP를 유지하도록 함으로써 AS 외부 경로에 대한 일관된 보기가 제공된다고 가정합니다.

이 문서에서는 BGP 프로토콜의 기본 동작을 지정합니다. 이 동작은 확장 사양에 따라 수정될 수 있으며 수정됩니다. 프로토콜이 확장되면 새로운 동작이 확장 사양에 완전히 문서화됩니다.

---
### **3.1.  Routes: Advertisement and Storage**

이 프로토콜의 목적에 따라 경로는 대상 집합과 해당 대상에 대한 경로 속성을 쌍으로 연결하는 정보 단위로 정의됩니다. 대상 세트는 UPDATE 메시지의 NLRI\(Network Layer Reachability Information\) 필드에 전달되는 하나의 IP 주소 접두사에 IP 주소가 포함되어 있는 시스템이며, 경로는 동일한 UPDATE의 경로 속성 필드에 보고된 정보입니다. 메시지.

UPDATE 메시지의 BGP 스피커 간에 경로가 공지됩니다. UPDATE 메시지의 NLRI 필드에 여러 접두사를 포함하면 동일한 경로 특성을 갖는 여러 경로를 단일 UPDATE 메시지에 알릴 수 있습니다.

경로는 섹션 3.2에 설명된 대로 RIB\(Routing Information Base\), 즉 Adj-RIBs-In, Loc-RIB 및 Adj-RIBs-Out에 저장됩니다.

BGP 스피커가 이전에 수신한 경로를 광고하기로 선택한 경우 피어에게 광고하기 전에 경로의 경로 속성을 추가하거나 수정할 수 있습니다.

BGP는 BGP 스피커가 이전에 공지된 경로를 더 이상 사용할 수 없음을 피어에게 알릴 수 있는 메커니즘을 제공합니다. 지정된 BGP 스피커가 경로가 서비스에서 철회되었음을 나타낼 수 있는 세 가지 방법이 있습니다.

- a\) 이전에 광고된 경로에 대한 목적지를 표현하는 IP 접두사는 UPDATE 메시지의 WITHDRAWN ROUTES 필드에 광고될 수 있으므로 관련 경로를 더 이상 사용할 수 없는 것으로 표시할 수 있습니다.

- b\) 동일한 NLRI를 갖는 대체 경로가 광고될 수 있습니다.

- c\) BGP 스피커 연결이 닫힐 수 있으며, 이는 스피커 쌍이 서비스에서 서로에게 광고한 모든 경로를 암시적으로 제거합니다.

경로의 속성 변경은 대체 경로를 광고하여 수행됩니다. 대체 경로는 새로운\(변경된\) 특성을 가지며 원래 경로와 동일한 주소 접두사를 갖습니다.

---
### **3.2.  Routing Information Base**

BGP 스피커 내의 RIB\(Routing Information Base\)는 세 가지 개별 부분으로 구성됩니다.

- a\) Adj-RIBs-In: Adj-RIBs-In은 다른 BGP 스피커로부터 수신된 인바운드 UPDATE 메시지로부터 학습된 라우팅 정보를 저장합니다. 해당 내용은 의사결정 프로세스에 대한 입력으로 사용할 수 있는 경로를 나타냅니다.

- b\) Loc-RIB: Loc-RIB에는 Adj-RIBs-In에 포함된 라우팅 정보에 로컬 정책을 적용하여 BGP 스피커가 선택한 로컬 라우팅 정보가 포함됩니다. 이는 로컬 BGP 스피커에서 사용되는 경로입니다. 이러한 각 경로에 대한 다음 홉은 로컬 BGP 스피커의 라우팅 테이블을 통해 확인할 수 있어야 합니다.

- c\) Adj-RIBs-Out: Adj-RIBs-Out은 피어에게 광고하기 위해 선택한 로컬 BGP 스피커 정보를 저장합니다. Adj-RIBs-Out에 저장된 라우팅 정보는 로컬 BGP 스피커의 UPDATE 메시지에 전달되어 피어에게 알려집니다.

요약하면 Adj-RIBs-In에는 피어가 로컬 BGP 스피커에 광고한 처리되지 않은 라우팅 정보가 포함되어 있습니다. Loc-RIB에는 로컬 BGP에서 선택한 경로가 포함되어 있습니다.

화자의 결정 과정; Adj-RIBs-Out은 특정 피어에 대한 광고 경로를 구성합니다\(로컬 스피커의 UPDATE 메시지를 통해\).

개념적 모델은 Adj-RIBs-In, Loc-RIB 및 Adj-RIBs-Out을 구별하지만 이는 구현이 라우팅 정보의 세 가지 별도 복사본을 유지해야 함을 의미하거나 요구하지 않습니다. 구현 선택\(예: 정보 복사본 3개 vs 포인터가 있는 복사본 1개\)은 프로토콜에 의해 제한되지 않습니다.

BGP 스피커가 패킷을 전달하기 위해\(또는 패킷 전달에 사용되는 전달 테이블을 구성하기 위해\) 사용하는 라우팅 정보는 라우팅 테이블에 유지됩니다. 라우팅 테이블에는 직접 연결된 네트워크에 대한 경로, 정적 경로, IGP 프로토콜에서 학습된 경로 및 BGP에서 학습된 경로가 누적됩니다. 라우팅 테이블에 특정 BGP 경로를 설치해야 하는지 여부와 BGP 경로가 다른 소스에 의해 설치된 동일한 대상에 대한 경로를 재정의해야 하는지 여부는 로컬 정책 결정이며 이 문서에서는 지정되지 않습니다. 실제 패킷 전달 외에도 라우팅 테이블은 BGP 업데이트에 지정된 다음 홉 주소를 확인하는 데 사용됩니다\(섹션 5.1.3 참조\).

---
## **4.  Message Formats**

이 섹션에서는 BGP에서 사용되는 메시지 형식을 설명합니다.

BGP 메시지는 TCP 연결을 통해 전송됩니다. 메시지는 완전히 수신된 후에만 처리됩니다. 최대 메시지 크기는 4096옥텟입니다. 모든 구현은 이 최대 메시지 크기를 지원해야 합니다. 전송될 수 있는 가장 작은 메시지는 데이터 부분\(19옥텟\)이 없는 BGP 헤더로 구성됩니다.

모든 다중 옥텟 필드는 네트워크 바이트 순서로 되어 있습니다.

---
### **4.1.  Message Header Format**

각 메시지에는 고정 크기 헤더가 있습니다. 메시지 유형에 따라 헤더 뒤에 데이터 부분이 있을 수도 있고 없을 수도 있습니다. 이러한 필드의 레이아웃은 아래와 같습니다.

```text
      0                   1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                                                               |
      +                                                               +
      |                                                               |
      +                                                               +
      |                           Marker                              |
      +                                                               +
      |                                                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |          Length               |      Type     |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      Marker:
```

- 이 16옥텟 필드는 호환성을 위해 포함되었습니다. 반드시 모두로 설정해야 합니다.

```text
      Length:
```

- 이 2옥텟 부호 없는 정수는 옥텟 단위의 헤더를 포함하여 메시지의 전체 길이를 나타냅니다. 따라서 TCP 스트림에서 다음 메시지\(의 마커 필드\)를 찾을 수 있습니다. 길이 필드의 값은 항상 19 이상 4096 이하여야 하며 메시지 유형에 따라 추가로 제한될 수 있습니다. 메시지 뒤의 추가 데이터 "패딩"은 허용되지 않습니다. 따라서 길이 필드는 메시지의 나머지 부분을 고려할 때 필요한 가장 작은 값을 가져야 합니다.

```text
      Type:
```

- 이 1옥텟 부호 없는 정수는 메시지의 유형 코드를 나타냅니다. 이 문서에서는 다음 유형 코드를 정의합니다.

```text
                              1 - OPEN
                              2 - UPDATE
                              3 - NOTIFICATION
                              4 - KEEPALIVE

         [RFC2918] defines one more type code.
```

---
### **4.2.  OPEN Message Format**

TCP 연결이 설정된 후 각 측에서 보낸 첫 번째 메시지는 OPEN 메시지입니다. OPEN 메시지가 승인되면 OPEN을 확인하는 KEEPALIVE 메시지가 다시 전송됩니다.

고정 크기 BGP 헤더 외에도 OPEN 메시지에는 다음 필드가 포함됩니다.

```text
       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+
       |    Version    |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |     My Autonomous System      |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |           Hold Time           |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                         BGP Identifier                        |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       | Opt Parm Len  |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                                                               |
       |             Optional Parameters (variable)                    |
       |                                                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      Version:
```

- 이 1옥텟 부호 없는 정수는 메시지의 프로토콜 버전 번호를 나타냅니다. 현재 BGP 버전 번호는 4입니다.

```text
      My Autonomous System:
```

- 이 2옥텟 부호 없는 정수는 보낸 사람의 자율 시스템 번호를 나타냅니다.

```text
      Hold Time:
```

- 이 2옥텟 부호 없는 정수는 발신자가 보류 타이머 값에 대해 제안한 초 수를 나타냅니다. OPEN 메시지를 수신한 BGP 스피커는 구성된 Hold Time과 OPEN 메시지에서 수신된 Hold Time 중 더 작은 값을 사용하여 Hold Timer의 값을 계산해야 합니다. 보류 시간은 0이거나 최소 3초여야 합니다. 구현은 보류를 기반으로 연결을 거부할 수 있습니다.

- 시간. 계산된 값은 발신자로부터 연속적인 KEEPALIVE 및/또는 UPDATE 메시지를 수신하는 사이에 경과될 수 있는 최대 시간\(초\)을 나타냅니다.

```text
      BGP Identifier:
```

- 이 4옥텟 부호 없는 정수는 보낸 사람의 BGP 식별자를 나타냅니다. 지정된 BGP 스피커는 BGP 식별자 값을 해당 BGP 스피커에 할당된 IP 주소로 설정합니다. BGP 식별자의 값은 시작 시 결정되며 모든 로컬 인터페이스 및 BGP 피어에 대해 동일합니다.

```text
      Optional Parameters Length:
```

- 이 1옥텟 부호 없는 정수는 선택적 매개변수 필드의 전체 길이를 옥텟 단위로 나타냅니다. 이 필드의 값이 0이면 선택적 매개변수가 존재하지 않는 것입니다.

```text
      Optional Parameters:
```

- 이 필드에는 선택적 매개변수 목록이 포함되어 있으며, 각 매개변수는 <매개변수 유형, 매개변수 길이, 매개변수 값\> 삼중항으로 인코딩됩니다.

```text
         0                   1
         0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...
         |  Parm. Type   | Parm. Length  |  Parameter Value (variable)
         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...
```

- 매개변수 유형은 개별 매개변수를 명확하게 식별하는 1옥텟 필드입니다. 매개변수 길이는 매개변수 값 필드의 길이를 옥텟 단위로 포함하는 1옥텟 필드입니다. 매개변수 값은 매개변수 유형 필드의 값에 따라 해석되는 가변 길이 필드입니다.

- \[RFC3392\]는 Capability Optional Parameter를 정의합니다.

OPEN 메시지의 최소 길이는 29옥텟\(메시지 헤더 포함\)입니다.

---
### **4.3.  UPDATE Message Format**

UPDATE 메시지는 BGP 피어 간에 라우팅 정보를 전송하는 데 사용됩니다. UPDATE 메시지의 정보는 다양한 자율 시스템의 관계를 설명하는 그래프를 구성하는 데 사용될 수 있습니다. 논의할 규칙을 적용하여 라우팅

정보 루프 및 기타 일부 예외 사항이 AS 간 라우팅에서 감지되고 제거될 수 있습니다.

UPDATE 메시지는 피어에게 공통 경로 속성을 공유하는 실행 가능한 경로를 알리거나 서비스에서 실행 불가능한 여러 경로를 철회하는 데 사용됩니다\(3.1 참조\). UPDATE 메시지는 동시에 가능한 경로를 광고하고 서비스에서 여러 개의 실행 불가능한 경로를 철회할 수 있습니다. UPDATE 메시지에는 항상 고정 크기 BGP 헤더가 포함되며, 아래와 같이 다른 필드도 포함됩니다\(참고: 표시된 필드 중 일부는 모든 UPDATE 메시지에 표시되지 않을 수 있습니다\).

```text
      +-----------------------------------------------------+
      |   Withdrawn Routes Length (2 octets)                |
      +-----------------------------------------------------+
      |   Withdrawn Routes (variable)                       |
      +-----------------------------------------------------+
      |   Total Path Attribute Length (2 octets)            |
      +-----------------------------------------------------+
      |   Path Attributes (variable)                        |
      +-----------------------------------------------------+
      |   Network Layer Reachability Information (variable) |
      +-----------------------------------------------------+

      Withdrawn Routes Length:
```

- 이 2옥텟 부호 없는 정수는 철회된 경로 필드의 전체 길이를 옥텟 단위로 나타냅니다. 해당 값을 사용하면 아래에 지정된 대로 네트워크 계층 연결 가능성 정보 필드의 길이를 결정할 수 있습니다.

- 0 값은 서비스에서 철회된 경로가 없으며 이 UPDATE 메시지에 WITHDRAWN ROUTES 필드가 없음을 나타냅니다.

```text
      Withdrawn Routes:
```

- 서비스에서 철회되는 경로에 대한 IP 주소 접두사 목록이 포함된 가변 길이 필드입니다. 각 IP 주소 접두사는 <length, prefix\> 형식의 2-튜플로 인코딩됩니다. 해당 필드는 아래에 설명되어 있습니다.

```text
                  +---------------------------+
                  |   Length (1 octet)        |
                  +---------------------------+
                  |   Prefix (variable)       |
                  +---------------------------+
```

- 해당 필드의 용도와 의미는 다음과 같습니다.

```text
         a) Length:

            The Length field indicates the length in bits of the IP
            address prefix.  A length of zero indicates a prefix that
            matches all IP addresses (with prefix, itself, of zero
            octets).

         b) Prefix:

            The Prefix field contains an IP address prefix, followed by
            the minimum number of trailing bits needed to make the end
            of the field fall on an octet boundary.  Note that the value
            of trailing bits is irrelevant.

      Total Path Attribute Length:
```

- 이 2옥텟 부호 없는 정수는 경로 속성 필드의 전체 길이를 옥텟 단위로 나타냅니다. 해당 값을 사용하면 네트워크 계층 연결 가능성 필드의 길이를 아래 지정된 대로 결정할 수 있습니다.

- 값 0은 이 업데이트 메시지에 네트워크 계층 도달성 정보 필드나 경로 속성 필드가 모두 존재하지 않음을 나타냅니다.

```text
      Path Attributes:
```

- 경로 속성의 가변 길이 시퀀스는 철회된 경로만 전달하는 UPDATE 메시지를 제외하고 모든 UPDATE 메시지에 존재합니다. 각 경로 속성은 가변 길이의 삼중 <속성 유형, 속성 길이, 속성 값\>입니다.

- 속성 유형은 속성 플래그 옥텟과 그 뒤에 오는 속성 유형 코드 옥텟으로 구성된 2옥텟 필드입니다.

```text
               0                   1
               0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
               |  Attr. Flags  |Attr. Type Code|
               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

- 속성 플래그 옥텟의 상위 비트\(비트 0\)는 옵션 비트입니다. 속성이 선택적\(1로 설정된 경우\)인지 또는 잘 알려진 속성\(0으로 설정된 경우\)인지 정의합니다.

- 속성 플래그 옥텟의 두 번째 상위 비트\(비트 1\)는 Transitive 비트입니다. 선택적 속성이 전이적\(1로 설정된 경우\)인지 비전이적\(0으로 설정된 경우\)인지 정의합니다.

- 잘 알려진 속성의 경우 전이적 비트를 1로 설정해야 합니다. \(전이적 속성에 대한 설명은 섹션 5를 참조하세요.\)

- 속성 플래그 옥텟의 세 번째 상위 비트\(비트 2\)는 부분 비트입니다. 선택적 전이적 속성에 포함된 정보가 부분적\(1로 설정된 경우\)인지 아니면 완전한\(0으로 설정된 경우\)인지 정의합니다. 잘 알려진 속성과 선택적인 비전이적 속성의 경우 부분 비트를 0으로 설정해야 합니다.

- 속성 플래그 옥텟의 네 번째 상위 비트\(비트 3\)는 확장 길이 비트입니다. 속성 길이가 1옥텟\(0으로 설정된 경우\)인지 2옥텟\(1로 설정된 경우\)인지 정의합니다.

- 속성 플래그 옥텟의 하위 4비트는 사용되지 않습니다. 전송 시 0이어야 하며 수신 시 무시되어야 합니다.

- 속성 유형 코드 옥텟에는 속성 유형 코드가 포함됩니다. 현재 정의된 속성 유형 코드는 섹션 5에서 논의됩니다.

- 속성 플래그 옥텟의 확장 길이 비트가 0으로 설정된 경우 경로 속성의 세 번째 옥텟에는 옥텟 단위의 속성 데이터 길이가 포함됩니다.

- 속성 플래그 옥텟의 확장 길이 비트가 1로 설정된 경우 경로 속성의 세 번째 및 네 번째 옥텟에는 옥텟 단위의 속성 데이터 길이가 포함됩니다.

- 경로 속성의 나머지 옥텟은 속성 값을 나타내며 속성 플래그 및 속성 유형 코드에 따라 해석됩니다. 지원되는 속성 유형 코드와 해당 속성 값 및 용도는 다음과 같습니다.

```text
         a) ORIGIN (Type Code 1):

            ORIGIN is a well-known mandatory attribute that defines the
            origin of the path information.  The data octet can assume
            the following values:

               Value      Meaning

               0         IGP - Network Layer Reachability Information
                            is interior to the originating AS

               1         EGP - Network Layer Reachability Information
                            learned via the EGP protocol [RFC904]

               2         INCOMPLETE - Network Layer Reachability
                            Information learned by some other means
```

- 이 속성의 사용법은 5.1.1에 정의되어 있습니다.

```text
         b) AS_PATH (Type Code 2):

            AS_PATH is a well-known mandatory attribute that is composed
            of a sequence of AS path segments.  Each AS path segment is
            represented by a triple <path segment type, path segment
            length, path segment value>.

            The path segment type is a 1-octet length field with the
            following values defined:

               Value      Segment Type

               1         AS_SET: unordered set of ASes a route in the
                            UPDATE message has traversed

               2         AS_SEQUENCE: ordered set of ASes a route in
                            the UPDATE message has traversed

            The path segment length is a 1-octet length field,
            containing the number of ASes (not the number of octets) in
            the path segment value field.

            The path segment value field contains one or more AS
            numbers, each encoded as a 2-octet length field.
```

- 이 속성의 사용법은 5.1.2에 정의되어 있습니다.

```text
         c) NEXT_HOP (Type Code 3):

            This is a well-known mandatory attribute that defines the
            (unicast) IP address of the router that SHOULD be used as
            the next hop to the destinations listed in the Network Layer
            Reachability Information field of the UPDATE message.
```

- 이 속성의 사용법은 5.1.3에 정의되어 있습니다.

```text
         d) MULTI_EXIT_DISC (Type Code 4):

            This is an optional non-transitive attribute that is a
            four-octet unsigned integer.  The value of this attribute
            MAY be used by a BGP speaker's Decision Process to
            discriminate among multiple entry points to a neighboring
            autonomous system.
```

- 이 속성의 사용법은 5.1.4에 정의되어 있습니다.

```text
         e) LOCAL_PREF (Type Code 5):

            LOCAL_PREF is a well-known attribute that is a four-octet
            unsigned integer.  A BGP speaker uses it to inform its other
            internal peers of the advertising speaker's degree of
            preference for an advertised route.
```

- 이 속성의 사용법은 5.1.5에 정의되어 있습니다.

```text
         f) ATOMIC_AGGREGATE (Type Code 6)

            ATOMIC_AGGREGATE is a well-known discretionary attribute of
            length 0.
```

- 이 속성의 사용법은 5.1.6에 정의되어 있습니다.

```text
         g) AGGREGATOR (Type Code 7)

            AGGREGATOR is an optional transitive attribute of length 6.
            The attribute contains the last AS number that formed the
            aggregate route (encoded as 2 octets), followed by the IP
            address of the BGP speaker that formed the aggregate route
            (encoded as 4 octets).  This SHOULD be the same address as
            the one used for the BGP Identifier of the speaker.
```

- 이 속성의 사용법은 5.1.7에 정의되어 있습니다.

```text
      Network Layer Reachability Information:
```

- 이 가변 길이 필드에는 IP 주소 접두사 목록이 포함됩니다. 네트워크 계층 도달 가능성 정보의 길이\(옥텟\)는 명시적으로 인코딩되지 않지만 다음과 같이 계산할 수 있습니다.

```text
               UPDATE message Length - 23 - Total Path Attributes Length
               - Withdrawn Routes Length
```

- 여기서 UPDATE 메시지 길이는 고정 크기 BGP 헤더에 인코딩된 값이고, 총 경로 속성 길이, 철회된 경로 길이는 UPDATE 메시지의 변수 부분에 인코딩된 값이며, 23은 고정 크기 BGP 헤더의 결합된 길이입니다. BGP 헤더, 총 경로 속성 길이 필드 및 철회된 경로 길이 필드.

- 연결 가능성 정보는 <length, prefix\> 형식의 하나 이상의 2-튜플로 인코딩됩니다. 해당 필드는 아래에 설명되어 있습니다.

```text
                  +---------------------------+
                  |   Length (1 octet)        |
                  +---------------------------+
                  |   Prefix (variable)       |
                  +---------------------------+
```

- 해당 필드의 용도와 의미는 다음과 같습니다.

```text
         a) Length:

            The Length field indicates the length in bits of the IP
            address prefix.  A length of zero indicates a prefix that
            matches all IP addresses (with prefix, itself, of zero
            octets).

         b) Prefix:

            The Prefix field contains an IP address prefix, followed by
            enough trailing bits to make the end of the field fall on an
            octet boundary.  Note that the value of the trailing bits is
            irrelevant.
```

UPDATE 메시지의 최소 길이는 23옥텟입니다. 고정 헤더의 경우 19옥텟 + 철회된 경로 길이의 경우 2옥텟 + 총 경로 속성 길이의 경우 2옥텟\(철회된 경로 길이의 값은 0이고 총 경로의 값은 0임\) 속성 길이는 0입니다\).

UPDATE 메시지는 최대 하나의 경로 속성 세트를 광고할 수 있지만 대상이 이러한 속성을 공유하는 경우 여러 대상을 광고할 수 있습니다. 주어진 UPDATE 메시지에 포함된 모든 경로 속성은 UPDATE 메시지의 NLRI 필드에 포함된 모든 대상에 적용됩니다.

UPDATE 메시지는 서비스에서 철회될 여러 경로를 나열할 수 있습니다. 이러한 각 경로는 대상\(IP 접두사로 표시\)으로 식별되며, 이는 이전에 알려진 BGP 스피커 연결인 BGP 스피커의 컨텍스트에서 경로를 명확하게 식별합니다.

UPDATE 메시지는 서비스에서 철회될 경로만 광고할 수 있으며, 이 경우 메시지에는 경로 속성이나 네트워크 계층 연결 가능성 정보가 포함되지 않습니다. 반대로, 가능한 경로만 광고할 수 있으며, 이 경우 WITHDRAWN ROUTES 필드가 존재할 필요가 없습니다.

업데이트 메시지는 WITHDRAWN ROUTES 및 네트워크 계층 연결 가능성 정보 필드에 동일한 주소 접두사를 포함해서는 안 됩니다. 그러나 BGP 스피커는 이 형식의 UPDATE 메시지를 처리할 수 있어야 합니다. BGP 스피커는 마치 WITHDRAWN ROUTES가 주소 접두어를 포함하지 않는 것처럼 이 형식의 업데이트 메시지를 처리해야 합니다.

---
### **4.4.  KEEPALIVE Message Format**

BGP는 피어에 연결할 수 있는지 확인하기 위해 TCP 기반의 연결 유지 메커니즘을 사용하지 않습니다. 대신 KEEPALIVE 메시지는 보류 타이머가 만료되지 않을 정도로 자주 피어 간에 교환됩니다. KEEPALIVE 메시지 간의 합리적인 최대 시간은 보류 시간 간격의 1/3입니다. KEEPALIVE 메시지는 초당 1개보다 더 자주 전송되어서는 안 됩니다. 구현은 유지 시간 간격의 함수로 KEEPALIVE 메시지를 보내는 속도를 조정할 수 있습니다.

협상된 보류 시간 간격이 0이면 주기적인 KEEPALIVE 메시지를 보내서는 안 됩니다.

KEEPALIVE 메시지는 메시지 헤더로만 구성되며 길이는 19옥텟입니다.

---
### **4.5.  NOTIFICATION Message Format**

오류 조건이 감지되면 알림 메시지가 전송됩니다. BGP 연결은 전송 직후 닫힙니다.

고정 크기 BGP 헤더 외에도 NOTIFICATION 메시지에는 다음 필드가 포함됩니다.

```text
      0                   1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      | Error code    | Error subcode |   Data (variable)             |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      Error Code:
```

- 이 1옥텟 부호 없는 정수는 NOTIFICATION 유형을 나타냅니다. 다음 오류 코드가 정의되었습니다.

```text
            Error Code       Symbolic Name               Reference

              1         Message Header Error             Section 6.1

              2         OPEN Message Error               Section 6.2

              3         UPDATE Message Error             Section 6.3

              4         Hold Timer Expired               Section 6.5

              5         Finite State Machine Error       Section 6.6

              6         Cease                            Section 6.7

      Error subcode:
```

- 이 1옥텟 부호 없는 정수는 보고된 오류의 성격에 대한 보다 구체적인 정보를 제공합니다. 각 오류 코드에는 하나 이상의 오류 하위 코드가 연결되어 있을 수 있습니다. 적절한 오류 하위 코드가 정의되지 않은 경우 오류 하위 코드 필드에 0\(특정하지 않음\) 값이 사용됩니다.

```text
      Message Header Error subcodes:

               1 - Connection Not Synchronized.
               2 - Bad Message Length.
               3 - Bad Message Type.

      OPEN Message Error subcodes:

               1 - Unsupported Version Number.
               2 - Bad Peer AS.
               3 - Bad BGP Identifier.
               4 - Unsupported Optional Parameter.
               5 - [Deprecated - see Appendix A].
               6 - Unacceptable Hold Time.

      UPDATE Message Error subcodes:

               1 - Malformed Attribute List.
               2 - Unrecognized Well-known Attribute.
               3 - Missing Well-known Attribute.
               4 - Attribute Flags Error.
               5 - Attribute Length Error.
               6 - Invalid ORIGIN Attribute.
               7 - [Deprecated - see Appendix A].
               8 - Invalid NEXT_HOP Attribute.
               9 - Optional Attribute Error.
              10 - Invalid Network Field.
              11 - Malformed AS_PATH.

      Data:
```

- NOTIFICATION의 이유를 진단하기 위해 사용되는 가변 길이 필드입니다. 데이터 필드의 내용은 오류 코드 및 오류 하위 코드에 따라 달라집니다. 자세한 내용은 섹션 6을 참조하세요.

- 데이터 필드의 길이는 다음 공식을 통해 메시지 길이 필드에서 결정될 수 있습니다.

```text
                  Message Length = 21 + Data Length
```

NOTIFICATION 메시지의 최소 길이는 21옥텟\(메시지 헤더 포함\)입니다.

---
## **5.  Path Attributes**

이 섹션에서는 UPDATE 메시지의 경로 속성에 대해 설명합니다.

경로 속성은 다음 네 가지 카테고리로 분류됩니다.

```text
         1. Well-known mandatory.
         2. Well-known discretionary.
         3. Optional transitive.
         4. Optional non-transitive.
```

BGP 구현은 잘 알려진 모든 속성을 인식해야 합니다\(MUST\). 이러한 속성 중 일부는 필수이며 NLRI가 포함된 모든 업데이트 메시지에 포함되어야 합니다. 다른 것들은 임의적이며 특정 업데이트 메시지로 전송될 수도 있고 전송되지 않을 수도 있습니다.

BGP 피어가 잘 알려진 속성을 업데이트한 후에는 전송하는 모든 업데이트에서 이러한 속성을 피어에 전달해야 합니다.

잘 알려진 속성 외에도 각 경로에는 하나 이상의 선택적 속성이 포함될 수 있습니다. 모든 BGP 구현이 모든 선택적 속성을 지원하는 것이 필수이거나 예상되는 것은 아닙니다. 인식할 수 없는 선택적 속성의 처리는 속성 플래그 옥텟의 전이 비트 설정에 따라 결정됩니다. 인식할 수 없는 전이적 선택적 속성이 있는 경로는 허용되어야 합니다. 인식되지 않는 전이적 선택적 속성이 있는 경로가 허용되어 다른 BGP 피어에 전달되는 경우 해당 경로의 인식되지 않는 전이적 선택적 속성은 경로와 함께 속성 플래그 옥텟 세트의 부분 비트를 사용하여 다른 BGP 피어에 전달되어야 합니다. 인식된 전이적 선택적 속성이 있는 경로가 허용되어 다른 BGP 피어에 전달되고 속성 플래그 옥텟의 부분 비트가 일부 이전 AS에 의해 1로 설정된 경우, 이는 다시 0으로 설정되어서는 안 됩니다. 현재 AS. 인식되지 않은 비전이적 선택적 속성은 조용히 무시되어야 하며 다른 BGP 피어에게 전달되어서는 안 됩니다.

새로운 전이적 선택적 속성은 발신자 또는 경로의 다른 BGP 스피커에 의해 경로에 첨부될 수 있습니다. 작성자가 첨부하지 않은 경우 속성 플래그 옥텟의 부분 비트는 1로 설정됩니다. 새로운 비전이적 선택적 속성을 첨부하는 규칙은 특정 속성의 특성에 따라 달라집니다. 각각의 새로운 비전이적 선택적 속성에 대한 문서에는 이러한 규칙이 포함될 것으로 예상됩니다\(MULTI\_EXIT\_DISC 속성에 대한 설명이 예를 제공합니다\). 모든 선택적 속성\(전이적 및 비전이적 모두\)은 경로의 BGP 스피커에 의해 업데이트될 수 있습니다\(해당하는 경우\).

UPDATE 메시지의 송신자는 속성 유형의 오름차순으로 UPDATE 메시지 내의 경로 속성을 정렬해야 합니다. UPDATE 메시지의 수신자는 순서가 잘못된 UPDATE 메시지 내의 경로 속성을 처리할 준비를 해야 합니다.

동일한 속성\(동일한 유형의 속성\)은 특정 업데이트 메시지의 경로 속성 필드 내에 두 번 이상 나타날 수 없습니다.

필수 카테고리는 NLRI가 UPDATE 메시지에 포함된 경우 IBGP 및 EBGP 교환 모두에 있어야 하는 속성을 나타냅니다. 프로토콜 확장 메커니즘의 목적에 따라 선택 사항으로 분류된 속성은 순전히 재량적이거나 재량적이거나 필수이거나 특정 상황에서 허용되지 않을 수 있습니다.

```text
        attribute           EBGP                    IBGP
         ORIGIN             mandatory               mandatory
         AS_PATH            mandatory               mandatory
         NEXT_HOP           mandatory               mandatory
         MULTI_EXIT_DISC    discretionary           discretionary
         LOCAL_PREF         see Section 5.1.5       required
         ATOMIC_AGGREGATE   see Section 5.1.6 and 9.1.4
         AGGREGATOR         discretionary           discretionary
```

---
### **5.1.  Path Attribute Usage**

각 BGP 경로 속성의 사용법은 다음 절에 설명되어 있습니다.

---
#### **5.1.1.  ORIGIN**

ORIGIN은 잘 알려진 필수 속성입니다. ORIGIN 속성은 연관된 라우팅 정보를 생성하는 스피커에 의해 생성됩니다. 그 값은 다른 스피커에 의해 변경되어서는 안 됩니다.

---
#### **5.1.2.  AS_PATH**

AS\_PATH는 잘 알려진 필수 속성입니다. 이 속성은 이 UPDATE 메시지에 포함된 라우팅 정보가 전달된 자율 시스템을 식별합니다. 이 목록의 구성요소는 AS\_SET 또는 AS\_SEQUENCE일 수 있습니다.

BGP 스피커가 다른 BGP 스피커의 UPDATE 메시지에서 학습한 경로를 전파할 때 경로가 전송될 BGP 스피커의 위치를 ​​기반으로 경로의 AS\_PATH 속성을 수정합니다.

- a\) 특정 BGP 스피커가 내부 피어에게 경로를 광고할 때 광고 스피커는 경로와 관련된 AS\_PATH 속성을 수정해서는 안 됩니다.

- b\) 특정 BGP 스피커가 경로를 외부 피어에 알리면 광고 스피커는 AS\_PATH 속성을 다음과 같이 업데이트합니다.

```text
         1) if the first path segment of the AS_PATH is of type
            AS_SEQUENCE, the local system prepends its own AS number as
            the last element of the sequence (put it in the leftmost
            position with respect to the position of octets in the
            protocol message).  If the act of prepending will cause an
            overflow in the AS_PATH segment (i.e., more than 255 ASes),
            it SHOULD prepend a new segment of type AS_SEQUENCE and
            prepend its own AS number to this new segment.

         2) if the first path segment of the AS_PATH is of type AS_SET,
            the local system prepends a new path segment of type
            AS_SEQUENCE to the AS_PATH, including its own AS number in
            that segment.

         3) if the AS_PATH is empty, the local system creates a path
            segment of type AS_SEQUENCE, places its own AS into that
            segment, and places that segment into the AS_PATH.
```

BGP 스피커가 경로를 시작하면 다음이 수행됩니다.

- a\) 발신 스피커는 외부 피어로 전송된 모든 UPDATE 메시지의 AS\_PATH 속성에 있는 AS\_SEQUENCE 유형의 경로 세그먼트에 자체 AS 번호를 포함합니다. 이 경우 발신 스피커의 자율 시스템의 AS 번호는 경로 세그먼트의 유일한 항목이 되며 이 경로 세그먼트는 AS\_PATH 속성의 유일한 세그먼트가 됩니다.

- b\) 발신 스피커는 내부 피어로 전송되는 모든 업데이트 메시지에 빈 AS\_PATH 속성을 포함합니다. \(빈 AS\_PATH 속성은 길이 필드의 값이 0인 속성입니다.\)

AS\_PATH 속성의 수정이 로컬 시스템의 AS 번호를 포함하거나 앞에 추가해야 할 때마다 로컬 시스템은 AS\_PATH 속성에 자체 AS 번호의 두 개 이상의 인스턴스를 포함/앞에 추가할 수 있습니다. 이는 로컬 구성을 통해 제어됩니다.

---
#### **5.1.3.  NEXT_HOP**

NEXT\_HOP은 UPDATE 메시지에 나열된 대상에 대한 다음 홉으로 사용해야 하는 라우터의 IP 주소를 정의하는 잘 알려진 필수 속성입니다. NEXT\_HOP 속성은 다음과 같이 계산됩니다.

- 1\) 내부 피어에게 메시지를 보낼 때 경로가 로컬에서 시작되지 않은 경우 BGP 스피커는 자신의 IP 주소를 NEXT\_HOP으로 알리도록 명시적으로 구성되지 않은 한 NEXT\_HOP 속성을 수정해서는 안 됩니다. 발표할 때

- 내부 피어에 대한 로컬에서 시작된 경로인 경우, BGP 스피커는 발표된 네트워크가 스피커에 도달할 수 있는 라우터의 인터페이스 주소를 NEXT\_HOP으로 사용해야 합니다. 경로가 스피커에 직접 연결되거나 스피커에 대해 공지된 네트워크에 연결할 수 있는 라우터의 인터페이스 주소가 내부 피어의 주소인 경우 BGP 스피커는 NEXT\_HOP 속성에 대해 자체 IP 주소를 사용해야 합니다\( 피어에 연결하는 데 사용되는 인터페이스의 주소\).

- 2\) 외부 피어 X에게 메시지를 보낼 때, 해당 피어는 스피커에서 한 IP 홉 떨어져 있습니다.

```text
         - If the route being announced was learned from an internal
           peer or is locally originated, the BGP speaker can use an
           interface address of the internal peer router (or the
           internal router) through which the announced network is
           reachable for the speaker for the NEXT_HOP attribute,
           provided that peer X shares a common subnet with this
           address.  This is a form of "third party" NEXT_HOP attribute.

         - Otherwise, if the route being announced was learned from an
           external peer, the speaker can use an IP address of any
           adjacent router (known from the received NEXT_HOP attribute)
           that the speaker itself uses for local route calculation in
           the NEXT_HOP attribute, provided that peer X shares a common
           subnet with this address.  This is a second form of "third
           party" NEXT_HOP attribute.

         - Otherwise, if the external peer to which the route is being
           advertised shares a common subnet with one of the interfaces
           of the announcing BGP speaker, the speaker MAY use the IP
           address associated with such an interface in the NEXT_HOP
           attribute.  This is known as a "first party" NEXT_HOP
           attribute.

         - By default (if none of the above conditions apply), the BGP
           speaker SHOULD use the IP address of the interface that the
           speaker uses to establish the BGP connection to peer X in the
           NEXT_HOP attribute.
```

- 3\) 외부 피어 X에 메시지를 보내고 해당 피어가 스피커에서 여러 IP 홉 떨어져 있는 경우\(일명 "멀티홉 EBGP"\):

```text
         - The speaker MAY be configured to propagate the NEXT_HOP
           attribute.  In this case, when advertising a route that the
           speaker learned from one of its peers, the NEXT_HOP attribute
           of the advertised route is exactly the same as the NEXT_HOP

           attribute of the learned route (the speaker does not modify
           the NEXT_HOP attribute).

         - By default, the BGP speaker SHOULD use the IP address of the
           interface that the speaker uses in the NEXT_HOP attribute to
           establish the BGP connection to peer X.
```

일반적으로 NEXT\_HOP 속성은 사용 가능한 가장 짧은 경로가 선택되도록 선택됩니다. BGP 스피커는 불완전하게 브리지된 미디어를 처리하기 위해 타사 NEXT\_HOP 속성의 비활성화 알림을 지원할 수 있어야 합니다.

BGP 스피커에 의해 시작된 경로는 해당 피어의 주소를 NEXT\_HOP으로 사용하여 피어에 광고되어서는 안 됩니다. BGP 스피커는 자신을 다음 홉으로 사용하여 경로를 설치해서는 안 됩니다.

NEXT\_HOP 속성은 BGP 스피커에서 전송 패킷을 관련 대상으로 전달하는 데 사용해야 하는 실제 아웃바운드 인터페이스와 바로 다음 홉 주소를 결정하는 데 사용됩니다.

바로 다음 홉 주소는 라우팅 테이블의 내용을 사용하여 NEXT\_HOP 속성의 IP 주소에 대해 재귀 경로 조회 작업을 수행하고 동일한 비용의 항목이 여러 개 있는 경우 하나의 항목을 선택하여 결정됩니다. NEXT\_HOP 속성에서 IP 주소를 확인하는 라우팅 테이블 항목은 항상 아웃바운드 인터페이스를 지정합니다. 항목이 연결된 서브넷을 지정하지만 다음 홉 주소를 지정하지 않은 경우 NEXT\_HOP 속성의 주소를 바로 다음 홉 주소로 사용해야 합니다. 항목이 다음 홉 주소도 지정하는 경우 이 주소는 패킷 전달을 위한 바로 다음 홉 주소로 사용되어야 합니다.

---
#### **5.1.4.  MULTI_EXIT_DISC**

MULTI\_EXIT\_DISC는 동일한 이웃 AS에 대한 여러 종료 또는 진입점을 구별하기 위해 외부\(AS 간\) 링크에서 사용되는 선택적 비전이적 속성입니다. MULTI\_EXIT\_DISC 속성의 값은 메트릭이라고 하는 4옥텟의 부호 없는 숫자입니다. 다른 모든 요소가 동일하다면 측정항목이 더 낮은 종료점이 선호되어야 합니다. EBGP를 통해 수신된 경우 MULTI\_EXIT\_DISC 속성은 IBGP를 통해 동일한 AS 내의 다른 BGP 스피커로 전파될 수 있습니다\(9.1.2.2 참조\). 이웃 AS로부터 수신된 MULTI\_EXIT\_DISC 속성은 다른 이웃 AS로 전파되어서는 안 됩니다.

BGP 스피커는 경로에서 MULTI\_EXIT\_DISC 속성을 제거할 수 있도록 허용하는 메커니즘\(로컬 구성 기반\)을 구현해야 합니다. BGP 스피커가 제거되도록 구성된 경우

경로에서 MULTI\_EXIT\_DISC 속성을 제거한 경우 경로 선호도를 결정하기 전과 경로 선택\(결정 프로세스 1단계 및 2단계\)을 수행하기 전에 이 제거를 수행해야 합니다.

구현은 또한 \(로컬 구성을 기반으로\) EBGP를 통해 수신된 MULTI\_EXIT\_DISC 속성의 값을 변경할 수 있습니다. BGP 스피커가 EBGP를 통해 수신된 MULTI\_EXIT\_DISC 속성 값을 변경하도록 구성된 경우 경로 선호도를 결정하기 전과 경로 선택\(결정 프로세스 1단계 및 2단계\)을 수행하기 전에 값 변경을 수행해야 합니다. 이에 대한 필수 제한 사항은 섹션 9.1.2.2를 참조하세요.

---
#### **5.1.5.  LOCAL_PREF**

LOCAL\_PREF는 특정 BGP 스피커가 다른 내부 피어에게 보내는 모든 업데이트 메시지에 포함되어야 하는 잘 알려진 속성입니다. BGP 스피커는 로컬로 구성된 정책을 기반으로 각 외부 경로에 대한 선호도를 계산해야 하며 내부 피어에게 경로를 광고할 때 선호도를 포함해야 합니다. 선호도가 높을수록 선호되어야 합니다. BGP 스피커는 결정 프로세스에서 LOCAL\_PREF를 통해 학습된 선호도를 사용합니다\(섹션 9.1.1 참조\).

BGP 스피커는 BGP Confederations \[RFC3065\]의 경우를 제외하고 외부 피어에게 보내는 업데이트 메시지에 이 속성을 포함해서는 안 됩니다. 외부 피어로부터 수신된 업데이트 메시지에 포함된 경우 BGP Confederations \[RFC3065\]의 경우를 제외하고 수신 스피커는 이 속성을 무시해야 합니다.

---
#### **5.1.6.  ATOMIC_AGGREGATE**

ATOMIC\_AGGREGATE는 잘 알려진 임의 속성입니다.

BGP 스피커가 특정 피어에 대한 광고를 목적으로 여러 경로를 집계하는 경우 집계된 경로의 AS\_PATH에는 일반적으로 집계가 형성된 AS 세트로 구성된 AS\_SET이 포함됩니다. 대부분의 경우 네트워크 관리자는 AS\_SET 없이 경로 루프를 형성하지 않고 집계를 안전하게 광고할 수 있는지 확인할 수 있습니다.

AS\_SET 삭제의 결과로 집계된 경로의 AS\_PATH에 있는 AS 번호 중 적어도 일부를 집계에서 제외하는 경우 집계된 경로는 피어에 광고될 때 ATOMIC\_AGGREGATE 속성을 포함해야 합니다.

ATOMIC\_AGGREGATE 속성이 있는 경로를 수신하는 BGP 스피커는 경로를 다른 스피커에 전파할 때 속성을 제거해서는 안 됩니다.

ATOMIC\_AGGREGATE 속성이 있는 경로를 수신하는 BGP 스피커는 이 경로를 다른 BGP 스피커에 광고할 때 해당 경로의 NLRI를 더 구체적으로 만들어서는 안 됩니다\(9.1.4에 정의된 대로\).

ATOMIC\_AGGREGATE 속성이 있는 경로를 수신하는 BGP 스피커는 루프 프리 속성을 가지면서 경로의 NLRI에 지정된 대상에 대한 실제 경로가 NLRI에 지정된 경로가 아닐 수 있다는 사실을 인식해야 합니다. 경로의 AS\_PATH 속성입니다.

---
#### **5.1.7.  AGGREGATOR**

AGGREGATOR는 선택적인 전이 속성으로, 집계에 의해 형성된 업데이트에 포함될 수 있습니다\(섹션 9.2.2.2 참조\). 경로 집계를 수행하는 BGP 스피커는 자체 AS 번호와 IP 주소를 포함하는 AGGREGATOR 속성을 추가할 수 있습니다. IP 주소는 스피커의 BGP 식별자와 동일해야 합니다.

---
## **6.  BGP Error Handling.**

이 섹션에서는 BGP 메시지를 처리하는 동안 오류가 감지될 경우 취해야 할 조치에 대해 설명합니다.

여기에 설명된 조건 중 하나라도 감지되면 표시된 오류 코드, 오류 하위 코드 및 데이터 필드가 포함된 NOTIFICATION 메시지가 전송되고 BGP 연결이 닫힙니다\(NOTIFICATION 메시지가 전송되지 않는다고 명시적으로 명시되지 않는 한\). BGP 연결은 닫히지 않습니다\). 오류 하위 코드가 지정되지 않은 경우 0을 사용해야 합니다.

"BGP 연결이 닫혔습니다"라는 문구는 TCP 연결이 닫혔고, 연결된 Adj-RIB-In이 지워졌으며, 해당 BGP 연결에 대한 모든 리소스가 할당 취소되었음을 의미합니다. 원격 피어와 연결된 Loc-RIB의 항목은 유효하지 않은 것으로 표시됩니다. 로컬 시스템은 유효하지 않은 것으로 표시된 경로의 목적지에 대한 최적의 경로를 다시 계산합니다. 유효하지 않은 경로가 시스템에서 삭제되기 전에 유효하지 않은 것으로 표시된 경로에 대해 철회하거나 유효하지 않은 경로가 시스템에서 삭제되기 전에 새로운 최상의 경로를 동료에게 알립니다.

명시적으로 지정하지 않는 한 오류를 나타내기 위해 전송되는 NOTIFICATION 메시지의 데이터 필드는 비어 있습니다.

---
### **6.1.  Message Header Error Handling**

메시지 헤더를 처리하는 동안 감지된 모든 오류는 오류 코드 메시지 헤더 오류와 함께 NOTIFICATION 메시지를 전송하여 표시되어야 합니다. 오류 하위 코드는 오류의 구체적인 성격을 자세히 설명합니다.

메시지 헤더의 Marker 필드의 예상 값은 모두 1입니다. 메시지 헤더의 마커 필드가 예상과 다른 경우 동기화 오류가 발생한 것이며 오류 하위 코드를 연결이 동기화되지 않음으로 설정해야 합니다.

다음 중 하나라도 해당되는 경우:

- 메시지 헤더의 길이 필드가 19보다 작거나 4096보다 큰 경우, 또는

- OPEN 메시지의 길이 필드가 OPEN 메시지의 최소 길이보다 작은 경우, 또는

- UPDATE 메시지의 길이 필드가 UPDATE 메시지의 최소 길이보다 작은 경우, 또는

- KEEPALIVE 메시지의 길이 필드가 19와 같지 않은 경우, 또는

- NOTIFICATION 메시지의 길이 필드가 NOTIFICATION 메시지의 최소 길이보다 작은 경우,

그런 다음 오류 하위 코드를 잘못된 메시지 길이로 설정해야 합니다. 데이터 필드에는 잘못된 길이 필드가 포함되어야 합니다.

메시지 헤더의 유형 필드가 인식되지 않으면 오류 하위 코드를 잘못된 메시지 유형으로 설정해야 합니다. 데이터 필드에는 잘못된 유형 필드가 포함되어야 합니다.

---
### **6.2.  OPEN Message Error Handling**

OPEN 메시지를 처리하는 동안 감지된 모든 오류는 오류 코드 OPEN 메시지 오류와 함께 NOTIFICATION 메시지를 전송하여 표시되어야 합니다. 오류 하위 코드는 오류의 구체적인 성격을 자세히 설명합니다.

수신된 OPEN 메시지의 버전 필드에 있는 버전 번호가 지원되지 않는 경우 오류 하위 코드는 지원되지 않는 버전 번호로 설정되어야 합니다. 데이터 필드는 2옥텟의 부호 없는 정수로, 원격 BGP 피어 입찰 버전보다 작은 로컬에서 지원되는 가장 큰 버전 번호를 나타냅니다.

수신된 OPEN 메시지\) 또는 로컬에서 지원되는 가장 작은 버전 번호가 원격 BGP 피어 입찰 버전보다 큰 경우 로컬에서 지원되는 가장 작은 버전 번호입니다.

OPEN 메시지의 자율 시스템 필드가 허용되지 않는 경우 오류 하위 코드는 Bad Peer AS로 설정되어야 합니다. 허용 가능한 자율 시스템 번호의 결정은 이 프로토콜의 범위를 벗어납니다.

OPEN 메시지의 보류 시간 필드가 허용되지 않는 경우 오류 하위 코드는 허용되지 않는 보류 시간으로 설정되어야 합니다. 구현에서는 1초 또는 2초의 유지 시간 값을 거부해야 합니다\(MUST\). 구현에서는 제안된 보류 시간을 거부할 수 있습니다. 보류 시간을 허용하는 구현은 보류 시간에 대해 협상된 값을 사용해야 합니다.

OPEN 메시지의 BGP 식별자 필드가 구문적으로 잘못된 경우 오류 하위 코드를 잘못된 BGP 식별자로 설정해야 합니다. 구문 정확성은 BGP 식별자 필드가 유효한 유니캐스트 IP 호스트 주소를 나타냄을 의미합니다.

OPEN 메시지의 선택적 매개변수 중 하나가 인식되지 않으면 오류 하위 코드를 지원되지 않는 선택적 매개변수로 설정해야 합니다.

OPEN 메시지의 선택적 매개변수 중 하나가 인식되었지만 형식이 잘못된 경우 오류 하위 코드는 0\(특정 없음\)으로 설정되어야 합니다.

---
### **6.3.  UPDATE Message Error Handling**

UPDATE 메시지를 처리하는 동안 발견된 모든 오류는 오류 코드 UPDATE 메시지 오류와 함께 NOTIFICATION 메시지를 전송하여 표시되어야 합니다. 오류 하위 코드는 오류의 구체적인 성격을 자세히 설명합니다.

UPDATE 메시지의 오류 검사는 경로 속성을 검사하는 것으로 시작됩니다. 철회된 경로 길이 또는 총 속성 길이가 너무 큰 경우\(즉, 철회된 경로 길이 + 총 속성 길이 + 23이 메시지 길이를 초과하는 경우\) 오류 하위 코드를 잘못된 속성 목록으로 설정해야 합니다.

인식된 속성에 속성 유형 코드와 충돌하는 속성 플래그가 있는 경우 오류 하위 코드는 속성 플래그 오류로 설정되어야 합니다. 데이터 필드에는 잘못된 속성\(유형, 길이 및 값\)이 포함되어야 합니다.

인식된 속성에 예상 길이\(속성 유형 코드 기반\)와 충돌하는 속성 길이가 있는 경우 오류 하위 코드는 속성 길이 오류로 설정되어야 합니다. 데이터 필드에는 잘못된 속성\(유형, 길이 및 값\)이 포함되어야 합니다.

잘 알려진 필수 속성 중 하나라도 존재하지 않는 경우 오류 하위 코드는 잘 알려진 속성 누락으로 설정되어야 합니다. 데이터 필드에는 누락된 잘 알려진 속성의 속성 유형 코드가 포함되어야 합니다.

잘 알려진 필수 속성 중 하나라도 인식되지 않으면 오류 하위 코드를 인식되지 않는 잘 알려진 속성으로 설정해야 합니다. 데이터 필드에는 인식할 수 없는 속성\(유형, 길이 및 값\)이 포함되어야 합니다.

ORIGIN 속성에 정의되지 않은 값이 있으면 오류 하위 코드를 잘못된 원본 속성으로 설정해야 합니다. 데이터 필드에는 인식할 수 없는 속성\(유형, 길이 및 값\)이 포함되어야 합니다.

NEXT\_HOP 속성 필드가 구문적으로 잘못된 경우 오류 하위 코드를 잘못된 NEXT\_HOP 속성으로 설정해야 합니다. 데이터 필드에는 잘못된 속성\(유형, 길이 및 값\)이 포함되어야 합니다. 구문 정확성은 NEXT\_HOP 속성이 유효한 IP 호스트 주소를 나타냄을 의미합니다.

NEXT\_HOP의 IP 주소는 의미상 올바른 것으로 간주되기 위해 다음 기준을 충족해야 합니다.

- a\) 수신 스피커의 IP 주소가 아니어야 합니다.

- b\) 발신자와 수신자가 서로 하나의 IP 홉 떨어져 있는 EBGP의 경우 NEXT\_HOP의 IP 주소는 BGP 연결을 설정하는 데 사용되는 발신자의 IP 주소이거나 연결된 인터페이스여야 합니다. NEXT\_HOP IP 주소를 사용하는 경우 수신 BGP 스피커와 공통 서브넷을 공유해야 합니다.

NEXT\_HOP 속성이 의미상 올바르지 않은 경우 오류를 기록해야 하며 경로를 무시해야 합니다. 이 경우 NOTIFICATION 메시지는 전송되어서는 안 되며 연결이 종료되어서도 안 됩니다.

AS\_PATH 속성의 구문 정확성이 검사됩니다. 경로가 구문적으로 잘못된 경우 오류 하위 코드를 Malformed AS\_PATH로 설정해야 합니다.

UPDATE 메시지가 외부 피어로부터 수신되면 로컬 시스템은 AS\_PATH 속성의 가장 왼쪽 AS\(프로토콜 메시지의 옥텟 위치와 관련하여\)가 보낸 피어의 자율 시스템 번호와 동일한지 확인할 수 있습니다. 메시지. 검사 결과 이것이 사실이 아니라고 판단되면 오류 하위 코드를 Malformed AS\_PATH로 설정해야 합니다.

선택적 속성이 인식되면 이 속성의 값을 확인해야 합니다. 오류가 감지되면 속성을 폐기해야 하며 오류 하위 코드를 선택적 속성 오류로 설정해야 합니다. 데이터 필드에는 속성\(유형, 길이 및 값\)이 포함되어야 합니다.

업데이트 메시지에 속성이 두 번 이상 나타나면 오류 하위 코드를 잘못된 속성 목록으로 설정해야 합니다.

UPDATE 메시지의 NLRI 필드는 구문 유효성을 검사합니다. 필드의 구문이 잘못된 경우 오류 하위 코드를 잘못된 네트워크 필드로 설정해야 합니다.

NLRI 필드의 접두사가 의미상 잘못된 경우\(예: 예상치 못한 멀티캐스트 IP 주소\) 오류는 로컬로 기록되어야 하며 접두사는 무시되어야 합니다.

올바른 경로 속성을 포함하지만 NLRI가 없는 UPDATE 메시지는 유효한 UPDATE 메시지로 처리되어야 합니다.

---
### **6.4.  NOTIFICATION Message Error Handling**

피어가 NOTIFICATION 메시지를 보내고 메시지 수신자가 해당 메시지에서 오류를 감지한 경우 수신자는 NOTIFICATION 메시지를 사용하여 이 오류를 피어에게 다시 보고할 수 없습니다. 이러한 오류\(예: 인식할 수 없는 오류 코드 또는 오류 하위 코드\)는 모두 인지하고, 로컬로 기록하고, 피어 관리팀에 알려야 합니다. 그러나 이를 수행하는 방법은 이 문서의 범위를 벗어납니다.

---
### **6.5.  Hold Timer Expired Error Handling**

시스템이 OPEN 메시지의 Hold Time 필드에 지정된 기간 내에 연속적인 KEEPALIVE, UPDATE 및/또는 NOTIFICATION 메시지를 수신하지 못하는 경우 Hold Timer Expired 오류 코드가 포함된 NOTIFICATION 메시지가 전송되고 BGP 연결이 닫힙니다.

---
### **6.6.  Finite State Machine Error Handling**

BGP 유한 상태 머신에서 감지한 모든 오류\(예: 예상치 못한 이벤트 수신\)는 오류 코드 유한 상태 머신 오류와 함께 알림 메시지를 전송하여 표시됩니다.

---
### **6.7.  Cease**

\(이 섹션에 표시된\) 치명적인 오류가 없는 경우 BGP 피어는 언제든지 오류 코드 중지와 함께 NOTIFICATION 메시지를 전송하여 BGP 연결을 닫을 수 있습니다. 그러나 이 섹션에 표시된 치명적인 오류가 존재할 때는 Cease NOTIFICATION 메시지를 사용해서는 안 됩니다.

BGP 스피커는 스피커가 이웃으로부터 기꺼이 받아들이는 주소 접두사의 수에 대해 로컬로 구성된 상한을 적용하는 기능을 지원할 수 있습니다. 상한에 도달하면 스피커는 로컬 구성의 제어를 받아 \(a\) 이웃과의 BGP 연결을 유지하면서 이웃의 새 주소 접두사를 삭제하거나 \(b\) 이웃과의 BGP 연결을 종료합니다. 이웃으로부터 수신된 주소 접두사의 수가 로컬로 구성된 상한을 초과하여 BGP 스피커가 이웃과의 BGP 연결을 종료하기로 결정한 경우 스피커는 오류 코드 중지와 함께 알림 메시지를 이웃에 보내야 합니다. 발표자는 이를 로컬로 기록할 수도 있습니다.

---
### **6.8.  BGP Connection Collision Detection**

한 쌍의 BGP 스피커가 동시에 서로 BGP 연결을 설정하려고 하면 두 개의 병렬 연결이 형성됩니다. 이러한 연결 중 하나에서 사용되는 소스 IP 주소가 다른 연결에서 사용되는 대상 IP 주소와 동일하고 첫 번째 연결에서 사용되는 대상 IP 주소가 다른 연결에서 사용되는 소스 IP 주소와 동일한 경우 연결 충돌이 발생합니다. 발생했습니다. 연결 충돌이 발생하면 연결 중 하나를 닫아야 합니다.

BGP 식별자 값을 기반으로 충돌이 발생할 때 어떤 BGP 연결을 유지해야 하는지 감지하기 위한 규칙이 설정됩니다. 규칙은 충돌과 관련된 피어의 BGP 식별자를 비교하고 더 높은 값의 BGP 식별자를 사용하여 BGP 스피커에 의해 시작된 연결만 유지하는 것입니다.

OPEN 메시지를 수신하면 로컬 시스템은 OpenConfirm 상태에 있는 모든 연결을 검사해야 합니다. BGP 스피커는 프로토콜 외부를 통해 피어의 BGP 식별자를 알고 있는 경우 OpenSent 상태의 연결을 검사할 수도 있습니다. 이러한 연결 중 원격 BGP 스피커에 대한 연결이 있는 경우

BGP 식별자가 OPEN 메시지의 것과 동일하고 이 연결이 OPEN 메시지가 수신된 연결과 충돌하면 로컬 시스템은 다음 충돌 해결 절차를 수행합니다.

- 1\) 로컬 시스템의 BGP 식별자는 원격 시스템의 BGP 식별자와 비교됩니다\(OPEN 메시지에 지정됨\). BGP 식별자 비교는 호스트 바이트 순서로 변환하고 4옥텟 부호 없는 정수로 처리하여 수행됩니다.

- 2\) 로컬 BGP 식별자 값이 원격 시스템의 값보다 작을 경우 로컬 시스템은 이미 존재하는 BGP 연결\(이미 OpenConfirm 상태인 연결\)을 종료하고 원격 시스템이 시작한 BGP 연결을 수락합니다. .

- 3\) 그렇지 않으면 로컬 시스템은 새로 생성된 BGP 연결\(새로 수신된 OPEN 메시지와 관련된 연결\)을 닫고 기존 연결\(이미 OpenConfirm 상태에 있는 연결\)을 계속 사용합니다.

구성을 통해 허용되지 않는 한, 설정됨 상태에 있는 기존 BGP 연결과의 연결 충돌로 인해 새로 생성된 연결이 닫힙니다.

Idle, Connect 또는 Active 상태의 연결에서는 연결 충돌을 감지할 수 없습니다.

충돌 해결 절차의 결과인 BGP 연결 닫기는 오류 코드 중지와 함께 NOTIFICATION 메시지를 전송하여 수행됩니다.

---
## **7.  BGP Version Negotiation**

BGP 스피커는 각 BGP 스피커가 지원하는 가장 높은 버전 번호부터 시작하여 BGP 연결을 열려고 여러 번 시도하여 프로토콜 버전을 협상할 수 있습니다. 오류 코드, OPEN 메시지 오류 및 오류 하위 코드, 지원되지 않는 버전 번호와 함께 열기 시도가 실패하는 경우 BGP 스피커는 시도한 버전 번호, 피어가 시도한 버전 번호, 피어가 전달한 버전 번호를 사용할 수 있습니다. NOTIFICATION 메시지 및 지원하는 버전 번호. 두 피어가 하나 이상의 공통 버전을 지원하는 경우 이를 통해 가장 높은 공통 버전을 신속하게 결정할 수 있습니다. BGP 버전 협상을 지원하려면 향후 BGP 버전에서는 OPEN 및 NOTIFICATION 메시지 형식을 유지해야 합니다.

---
## **8.  BGP Finite State Machine (FSM)**

이 문서에 설명된 데이터 구조와 FSM은 개념적이며 구현이 설명된 기능을 지원하고 외부에서 동일한 동작을 보이는 한 여기에 설명된 대로 정확하게 구현될 필요는 없습니다.

이 섹션에서는 FSM\(Finite State Machine\) 측면에서 BGP 작업을 지정합니다. 이 섹션은 두 부분으로 나뉩니다.

- 1\) 상태 머신에 대한 이벤트 설명\(8.1절\) 2\) FSM에 대한 설명\(8.2절\)

각 연결에 필요한\(필수\) 세션 속성은 다음과 같습니다.

```text
      1) State
      2) ConnectRetryCounter
      3) ConnectRetryTimer
      4) ConnectRetryTime
      5) HoldTimer
      6) HoldTime
      7) KeepaliveTimer
      8) KeepaliveTime
```

상태 세션 속성은 BGP FSM의 현재 상태를 나타냅니다. ConnectRetryCounter는 BGP 피어가 피어 세션 설정을 시도한 횟수를 나타냅니다.

타이머와 관련된 필수 속성은 섹션 10에 설명되어 있습니다. 각 타이머에는 "타이머"와 "시간"\(초기 값\)이 있습니다.

선택적 세션 속성이 아래에 나열되어 있습니다. 이러한 선택적 속성은 연결별 또는 로컬 시스템별로 지원될 수 있습니다.

```text
      1) AcceptConnectionsUnconfiguredPeers
      2) AllowAutomaticStart
      3) AllowAutomaticStop
      4) CollisionDetectEstablishedState
      5) DampPeerOscillations
      6) DelayOpen
      7) DelayOpenTime
      8) DelayOpenTimer
      9) IdleHoldTime
     10) IdleHoldTimer
     11) PassiveTcpEstablishment
     12) SendNOTIFICATIONwithoutOPEN
     13) TrackTcpState
```

선택적 세션 속성은 BGP FSM 상태 전환에 영향을 미치는 BGP 기능의 다양한 기능을 지원합니다. 타이머와 관련된 두 가지 속성 그룹은 다음과 같습니다.

```text
      group 1: DelayOpen, DelayOpenTime, DelayOpenTimer
      group 2: DampPeerOscillations, IdleHoldTime, IdleHoldTimer
```

첫 번째 매개변수\(DelayOpen, DampPeerOscillations\)는 타이머 기능이 활성화되었음을 나타내는 선택적 속성입니다. "Time" 값은 "Timer"\(DelayOpenTime, IdleHoldTime\)의 초기 값을 지정합니다. "타이머"는 실제 타이머를 지정합니다.

이러한 선택적 속성과 상태 머신에 신호를 보내는 이벤트 간의 상호 작용에 대한 설명은 섹션 8.1.1을 참조하세요. 섹션 8.2.1.3에서는 다양한 유형의 선택적 속성\(플래그 또는 타이머\)에 대한 간략한 개요도 제공합니다.

---
### **8.1.  Events for the BGP FSM**
---
#### **8.1.1.  Optional Events Linked to Optional Session Attributes**

BGP FSM에 대한 입력은 이벤트입니다. 이벤트는 필수이거나 선택 사항일 수 있습니다. 일부 선택적 이벤트는 선택적 세션 속성에 연결됩니다. 선택적 세션 속성은 여러 FSM 기능 그룹을 활성화합니다.

FSM 기능, 이벤트 및 선택적 세션 속성 간의 연결은 아래에 설명되어 있습니다.

```text
      Group 1: Automatic Administrative Events (Start/Stop)

         Optional Session Attributes: AllowAutomaticStart,
                                      AllowAutomaticStop,
                                      DampPeerOscillations,
                                      IdleHoldTime, IdleHoldTimer

         Option 1:    AllowAutomaticStart

         Description: A BGP peer connection can be started and stopped
                      by administrative control.  This administrative
                      control can either be manual, based on operator
                      intervention, or under the control of logic that
                      is specific to a BGP implementation.  The term
                      "automatic" refers to a start being issued to the
                      BGP peer connection FSM when such logic determines
                      that the BGP peer connection should be restarted.

                      The AllowAutomaticStart attribute specifies that
                      this BGP connection supports automatic starting of
                      the BGP connection.

                      If the BGP implementation supports
                      AllowAutomaticStart, the peer may be repeatedly
                      restarted.  Three other options control the rate
                      at which the automatic restart occurs:
                      DampPeerOscillations, IdleHoldTime, and the
                      IdleHoldTimer.

                      The DampPeerOscillations option specifies that the
                      implementation engages additional logic to damp
                      the oscillations of BGP peers in the face of
                      sequences of automatic start and automatic stop.
                      IdleHoldTime specifies the length of time the BGP
                      peer is held in the Idle state prior to allowing
                      the next automatic restart.  The IdleHoldTimer is
                      the timer that holds the peer in Idle state.

                      An example of DampPeerOscillations logic is an
                      increase of the IdleHoldTime value if a BGP peer
                      oscillates connectivity (connected/disconnected)
                      repeatedly within a time period.  To engage this
                      logic, a peer could connect and disconnect 10
                      times within 5 minutes.  The IdleHoldTime value
                      would be reset from 0 to 120 seconds.
```

- 값: TRUE 또는 FALSE

```text
         Option 2:    AllowAutomaticStop

         Description: This BGP peer session optional attribute indicates
                      that the BGP connection allows "automatic"
                      stopping of the BGP connection.  An "automatic"
                      stop is defined as a stop under the control of
                      implementation-specific logic.  The
                      implementation-specific logic is outside the scope
                      of this specification.
```

- 값: TRUE 또는 FALSE

```text
         Option 3:    DampPeerOscillations

         Description: The DampPeerOscillations optional session
                      attribute indicates that the BGP connection is
                      using logic that damps BGP peer oscillations in
                      the Idle State.
```

- 값: TRUE 또는 FALSE

```text
         Option 4:    IdleHoldTime

         Description: The IdleHoldTime is the value that is set in the
                      IdleHoldTimer.
```

- 값: 시간\(초\)

```text
         Option 5:    IdleHoldTimer

         Description: The IdleHoldTimer aids in controlling BGP peer
                      oscillation.  The IdleHoldTimer is used to keep
                      the BGP peer in Idle for a particular duration.
                      The IdleHoldTimer_Expires event is described in
                      Section 8.1.3.
```

- 값: 시간\(초\)

```text
      Group 2: Unconfigured Peers

         Optional Session Attributes: AcceptConnectionsUnconfiguredPeers

         Option 1:    AcceptConnectionsUnconfiguredPeers

         Description: The BGP FSM optionally allows the acceptance of
                      BGP peer connections from neighbors that are not
                      pre-configured.  The
                      "AcceptConnectionsUnconfiguredPeers" optional
                      session attribute allows the FSM to support the
                      state transitions that allow the implementation to
                      accept or reject these unconfigured peers.

                      The AcceptConnectionsUnconfiguredPeers has
                      security implications.  Please refer to the BGP
                      Vulnerabilities document [RFC4272] for details.
```

- 값: 참 또는 거짓

```text
      Group 3: TCP processing

         Optional Session Attributes: PassiveTcpEstablishment,
                                      TrackTcpState

         Option 1:    PassiveTcpEstablishment

         Description: This option indicates that the BGP FSM will
                      passively wait for the remote BGP peer to
                      establish the BGP TCP connection.
```

- 값: TRUE 또는 FALSE

```text
         Option 2:    TrackTcpState

         Description: The BGP FSM normally tracks the end result of a
                      TCP connection attempt rather than individual TCP
                      messages.  Optionally, the BGP FSM can support
                      additional interaction with the TCP connection
                      negotiation.  The interaction with the TCP events
                      may increase the amount of logging the BGP peer
                      connection requires and the number of BGP FSM
                      changes.
```

- 값: TRUE 또는 FALSE

```text
      Group 4:  BGP Message Processing

         Optional Session Attributes: DelayOpen, DelayOpenTime,
                                      DelayOpenTimer,
                                      SendNOTIFICATIONwithoutOPEN,
                                      CollisionDetectEstablishedState

         Option 1:     DelayOpen

         Description: The DelayOpen optional session attribute allows
                      implementations to be configured to delay sending
                      an OPEN message for a specific time period
                      (DelayOpenTime).  The delay allows the remote BGP
                      Peer time to send the first OPEN message.
```

- 값: TRUE 또는 FALSE

```text
         Option 2:    DelayOpenTime

         Description: The DelayOpenTime is the initial value set in the
                      DelayOpenTimer.
```

- 값: 시간\(초\)

```text
         Option 3:    DelayOpenTimer

         Description: The DelayOpenTimer optional session attribute is
                      used to delay the sending of an OPEN message on a

                      connection.  The DelayOpenTimer_Expires event
                      (Event 12) is described in Section 8.1.3.
```

- 값: 시간\(초\)

```text
         Option 4:    SendNOTIFICATIONwithoutOPEN

         Description: The SendNOTIFICATIONwithoutOPEN allows a peer to
                      send a NOTIFICATION without first sending an OPEN
                      message.  Without this optional session attribute,
                      the BGP connection assumes that an OPEN message
                      must be sent by a peer prior to the peer sending a
                      NOTIFICATION message.
```

- 값: 참 또는 거짓

```text
         Option 5:    CollisionDetectEstablishedState

         Description: Normally, a Detect Collision (see Section 6.8)
                      will be ignored in the Established state.  This
                      optional session attribute indicates that this BGP
                      connection processes collisions in the Established
                      state.
```

- 값: 참 또는 거짓

```text
      Note: The optional session attributes clarify the BGP FSM
            description for existing features of BGP implementations.
            The optional session attributes may be pre-defined for an
            implementation and not readable via management interfaces
            for existing correct implementations.  As newer BGP MIBs
            (version 2 and beyond) are supported, these fields will be
            accessible via a management interface.
```

---
#### **8.1.2.  Administrative Events**

관리 이벤트는 운영자 인터페이스와 BGP 정책 엔진이 BGP 유한 상태 머신에 신호를 보내 BGP 상태 머신을 시작하거나 중지하는 이벤트입니다. 기본 시작 및 중지 표시는 BGP FSM에 특정 유형의 시작 또는 중지 메커니즘을 알리는 선택적 연결 속성으로 보강됩니다. 이 조합의 예로는 이벤트 5, AutomatingStart\_with\_PassiveTcpSetupment가 있습니다. 이 이벤트를 통해 BGP 구현은 수동 TCP 설정을 사용하는 옵션과 함께 자동 시작을 사용하고 있음을 BGP FSM에 알립니다. 수동 TCP 설정은 이 BGP FSM이 원격 측에서 TCP 설정을 시작할 때까지 기다릴 것이라는 신호를 보냅니다.

이벤트 1\(ManualStart\)과 이벤트 2\(ManualStop\)만 필수 관리 이벤트입니다. 다른 모든 관리 이벤트는 선택 사항입니다\(이벤트 3-8\). 아래의 각 이벤트에는 이름, 정의, 상태\(필수 또는 선택\) 및 각 단계에서 설정해야 하는 선택적 세션 속성이 있습니다. BGP FSM에 대해 이벤트 1부터 이벤트 8까지 생성할 때 "선택적 특성 상태" 섹션에 지정된 조건이 확인됩니다. 이러한 조건 중 하나라도 충족되지 않으면 로컬 시스템은 FSM 오류를 기록해야 합니다.

선택적 세션 속성의 설정은 일부 구현에서 암시적일 수 있으므로 외부 운영자 작업에 의해 명시적으로 설정되지 않을 수 있습니다. 섹션 8.2.1.5에서는 선택적 세션 속성의 이러한 암시적 설정을 설명합니다. 아래에 설명된 관리 상태는 일부 구현에서 암시적일 수도 있으며 외부 운영자가 직접 구성할 수 없습니다.

```text
      Event 1: ManualStart

         Definition: Local system administrator manually starts the peer
                     connection.

         Status:     Mandatory

         Optional
         Attribute
         Status:     The PassiveTcpEstablishment attribute SHOULD be set
                     to FALSE.

      Event 2: ManualStop

         Definition: Local system administrator manually stops the peer
                     connection.

         Status:     Mandatory
```

- 선택 속성 상태: 선택 속성과 상호작용이 없습니다.

```text
      Event 3: AutomaticStart

         Definition: Local system automatically starts the BGP
                     connection.
```

- 상태: 선택 사항, 로컬 시스템에 따라 다름

```text
         Optional
         Attribute
         Status:     1) The AllowAutomaticStart attribute SHOULD be set
                        to TRUE if this event occurs.
                     2) If the PassiveTcpEstablishment optional session
                        attribute is supported, it SHOULD be set to
                        FALSE.
                     3) If the DampPeerOscillations is supported, it
                        SHOULD be set to FALSE when this event occurs.

      Event 4: ManualStart_with_PassiveTcpEstablishment

         Definition: Local system administrator manually starts the peer
                     connection, but has PassiveTcpEstablishment
                     enabled.  The PassiveTcpEstablishment optional
                     attribute indicates that the peer will listen prior
                     to establishing the connection.
```

- 상태: 선택 사항, 로컬 시스템에 따라 다름

```text
         Optional
         Attribute
         Status:     1) The PassiveTcpEstablishment attribute SHOULD be
                        set to TRUE if this event occurs.
                     2) The DampPeerOscillations attribute SHOULD be set
                        to FALSE when this event occurs.

      Event 5: AutomaticStart_with_PassiveTcpEstablishment

         Definition: Local system automatically starts the BGP
                     connection with the PassiveTcpEstablishment
                     enabled.  The PassiveTcpEstablishment optional
                     attribute indicates that the peer will listen prior
                     to establishing a connection.
```

- 상태: 선택 사항, 로컬 시스템에 따라 다름

```text
         Optional
         Attribute
         Status:     1) The AllowAutomaticStart attribute SHOULD be set
                        to TRUE.
                     2) The PassiveTcpEstablishment attribute SHOULD be
                        set to TRUE.
                     3) If the DampPeerOscillations attribute is
                        supported, the DampPeerOscillations SHOULD be
                        set to FALSE.

      Event 6: AutomaticStart_with_DampPeerOscillations

         Definition: Local system automatically starts the BGP peer
                     connection with peer oscillation damping enabled.
                     The exact method of damping persistent peer
                     oscillations is determined by the implementation
                     and is outside the scope of this document.
```

- 상태: 선택 사항이며 로컬 시스템에 따라 다릅니다.

```text
         Optional
         Attribute
         Status:     1) The AllowAutomaticStart attribute SHOULD be set
                        to TRUE.
                     2) The DampPeerOscillations attribute SHOULD be set
                        to TRUE.
                     3) The PassiveTcpEstablishment attribute SHOULD be
                        set to FALSE.

      Event 7: AutomaticStart_with_DampPeerOscillations_and_
      PassiveTcpEstablishment

         Definition: Local system automatically starts the BGP peer
                     connection with peer oscillation damping enabled
                     and PassiveTcpEstablishment enabled.  The exact
                     method of damping persistent peer oscillations is
                     determined by the implementation and is outside the
                     scope of this document.
```

- 상태: 선택 사항, 로컬 시스템에 따라 다름

```text
         Optional
         Attributes
         Status:     1) The AllowAutomaticStart attribute SHOULD be set
                        to TRUE.
                     2) The DampPeerOscillations attribute SHOULD be set
                        to TRUE.
                     3) The PassiveTcpEstablishment attribute SHOULD be
                        set to TRUE.

      Event 8: AutomaticStop

         Definition: Local system automatically stops the BGP
                     connection.

                     An example of an automatic stop event is exceeding
                     the number of prefixes for a given peer and the
                     local system automatically disconnecting the peer.
```

- 상태: 선택 사항, 로컬 시스템에 따라 다름

- 선택적 속성 상태: 1\) AllowAutomaticStop 속성은 TRUE여야 합니다.

---
#### **8.1.3.  Timer Events**

```text
      Event 9: ConnectRetryTimer_Expires

         Definition: An event generated when the ConnectRetryTimer
                     expires.

         Status:     Mandatory

      Event 10: HoldTimer_Expires
```

- 정의: HoldTimer가 만료될 때 생성되는 이벤트입니다.

```text
         Status:     Mandatory

      Event 11: KeepaliveTimer_Expires
```

- 정의: KeepaliveTimer가 만료될 때 생성되는 이벤트입니다.

```text
         Status:     Mandatory

      Event 12: DelayOpenTimer_Expires
```

- 정의 : DelayOpenTimer가 만료될 때 생성되는 이벤트입니다.

```text
                     Status:     Optional

         Optional
         Attribute
         Status:     If this event occurs,
                     1) DelayOpen attribute SHOULD be set to TRUE,
                     2) DelayOpenTime attribute SHOULD be supported,
                     3) DelayOpenTimer SHOULD be supported.

      Event 13: IdleHoldTimer_Expires

         Definition: An event generated when the IdleHoldTimer expires,
                     indicating that the BGP connection has completed
                     waiting for the back-off period to prevent BGP peer
                     oscillation.

                     The IdleHoldTimer is only used when the persistent
                     peer oscillation damping function is enabled by
                     setting the DampPeerOscillations optional attribute
                     to TRUE.

                     Implementations not implementing the persistent
                     peer oscillation damping function may not have the
                     IdleHoldTimer.

         Status:     Optional

         Optional
         Attribute
         Status:     If this event occurs:
                     1) DampPeerOscillations attribute SHOULD be set to
                        TRUE.
                     2) IdleHoldTimer SHOULD have just expired.
```

---
#### **8.1.4.  TCP Connection-Based Events**

```text
      Event 14: TcpConnection_Valid

         Definition: Event indicating the local system reception of a
                     TCP connection request with a valid source IP
                     address, TCP port, destination IP address, and TCP
                     Port.  The definition of invalid source and invalid
                     destination IP address is determined by the
                     implementation.

                     BGP's destination port SHOULD be port 179, as
                     defined by IANA.

                     TCP connection request is denoted by the local
                     system receiving a TCP SYN.

         Status:     Optional

         Optional
         Attribute
         Status:     1) The TrackTcpState attribute SHOULD be set to
                        TRUE if this event occurs.

      Event 15: Tcp_CR_Invalid

         Definition: Event indicating the local system reception of a
                     TCP connection request with either an invalid
                     source address or port number, or an invalid
                     destination address or port number.

                     BGP destination port number SHOULD be 179, as
                     defined by IANA.

                     A TCP connection request occurs when the local
                     system receives a TCP SYN.

         Status:     Optional

         Optional
         Attribute
         Status:     1) The TrackTcpState attribute should be set to
                        TRUE if this event occurs.

      Event 16: Tcp_CR_Acked

         Definition: Event indicating the local system's request to
                     establish a TCP connection to the remote peer.

                     The local system's TCP connection sent a TCP SYN,
                     received a TCP SYN/ACK message, and sent a TCP ACK.

         Status:     Mandatory

      Event 17: TcpConnectionConfirmed

         Definition: Event indicating that the local system has received
                     a confirmation that the TCP connection has been
                     established by the remote site.

                     The remote peer's TCP engine sent a TCP SYN.  The
                     local peer's TCP engine sent a SYN, ACK message and
                     now has received a final ACK.

         Status:     Mandatory

      Event 18: TcpConnectionFails

         Definition: Event indicating that the local system has received
                     a TCP connection failure notice.

                     The remote BGP peer's TCP machine could have sent a
                     FIN.  The local peer would respond with a FIN-ACK.
                     Another possibility is that the local peer
                     indicated a timeout in the TCP connection and
                     downed the connection.

         Status:     Mandatory
```

---
#### **8.1.5.  BGP Message-Based Events**

```text
      Event 19: BGPOpen

         Definition: An event is generated when a valid OPEN message has
                     been received.

         Status:     Mandatory

         Optional
         Attribute
         Status:     1) The DelayOpen optional attribute SHOULD be set
                        to FALSE.
                     2) The DelayOpenTimer SHOULD not be running.
```

- 이벤트 20: DelayOpenTimer가 실행 중인 BGPOpen

```text
         Definition: An event is generated when a valid OPEN message has
                     been received for a peer that has a successfully
                     established transport connection and is currently
                     delaying the sending of a BGP open message.

         Status:     Optional

         Optional
         Attribute
         Status:     1) The DelayOpen attribute SHOULD be set to TRUE.
                     2) The DelayOpenTimer SHOULD be running.

      Event 21: BGPHeaderErr

         Definition: An event is generated when a received BGP message
                     header is not valid.

         Status:     Mandatory

      Event 22: BGPOpenMsgErr

         Definition: An event is generated when an OPEN message has been
                     received with errors.

         Status:     Mandatory

      Event 23: OpenCollisionDump

         Definition: An event generated administratively when a
                     connection collision has been detected while
                     processing an incoming OPEN message and this

                     connection has been selected to be disconnected.
                     See Section 6.8 for more information on collision
                     detection.

                     Event 23 is an administrative action generated by
                     implementation logic that determines whether this
                     connection needs to be dropped per the rules in
                     Section 6.8.  This event may occur if the FSM is
                     implemented as two linked state machines.

         Status:     Optional

         Optional
         Attribute
         Status:     If the state machine is to process this event in
                     the Established state,
                     1) CollisionDetectEstablishedState optional
                        attribute SHOULD be set to TRUE.

                     Please note: The OpenCollisionDump event can occur
                     in Idle, Connect, Active, OpenSent, and OpenConfirm
                     without any optional attributes being set.

      Event 24: NotifMsgVerErr

         Definition: An event is generated when a NOTIFICATION message
                     with "version error" is received.

         Status:     Mandatory

      Event 25: NotifMsg

         Definition: An event is generated when a NOTIFICATION message
                     is received and the error code is anything but
                     "version error".

         Status:     Mandatory

      Event 26: KeepAliveMsg

         Definition: An event is generated when a KEEPALIVE message is
                     received.

         Status:     Mandatory

      Event 27: UpdateMsg

         Definition: An event is generated when a valid UPDATE message
                     is received.

         Status:     Mandatory

      Event 28: UpdateMsgErr

         Definition: An event is generated when an invalid UPDATE
                     message is received.

         Status:     Mandatory
```

---
### **8.2.  Description of FSM**
---
#### **8.2.1.  FSM Definition**

BGP는 구성된 각 피어에 대해 별도의 FSM을 유지해야 합니다. 잠재적인 연결에 쌍을 이루는 각 BGP 피어는 유휴 상태를 유지하도록 구성되거나 수동 상태를 유지하도록 구성되지 않는 한 다른 BGP 피어에 연결을 시도합니다. 이 설명의 목적에 따라 TCP 연결의 활성 또는 연결 측\(첫 번째 TCP SYN 패킷을 보내는 TCP 연결 측\)을 발신이라고 합니다. 수동적 또는 수신측\(첫 번째 SYN/ACK의 송신자\)을 수신 연결이라고 합니다. \(아래에 사용된 능동 및 수동 용어에 대한 정보는 섹션 8.2.1.1을 참조하십시오.\)

BGP 구현은 피어에 연결을 시도하는 것 외에도 TCP 포트 179에 연결하고 수신 연결을 수신해야 합니다. 들어오는 각 연결에 대해 상태 머신을 인스턴스화해야 합니다. 들어오는 연결의 다른 쪽 끝에 있는 피어의 ID는 알려져 있지만 BGP 식별자는 알려지지 않는 기간이 있습니다. 이 시간 동안 동일한 구성된 피어링에 대해 들어오고 나가는 연결이 모두 존재할 수 있습니다. 이를 연결 충돌이라고 합니다\(6.8절 참조\).

BGP 구현에는 구성된 각 피어링에 대해 최대 하나의 FSM과 피어가 아직 식별되지 않은 각 수신 TCP 연결에 대해 하나의 FSM이 있습니다. 각 FSM은 정확히 하나의 TCP 연결에 해당합니다.

연결이 다른 IP 주소 쌍을 사용하도록 구성된 경우 피어 쌍 사이에 둘 이상의 연결이 있을 수 있습니다. 이를 동일한 피어에 대한 여러 "구성된 피어링"이라고 합니다.

---
##### **8.2.1.1.  Terms "active" and "passive"**

능동 및 수동이라는 용어는 거의 10년 동안 인터넷 운영자의 어휘에 사용되었으며 유용한 것으로 입증되었습니다. 활성 및 수동이라는 단어는 TCP 연결이나 피어에 적용될 때 약간 다른 의미를 갖습니다. 위의 정의와 아래의 상태 머신에 따라 하나의 TCP 연결에는 하나의 활성 측과 하나의 수동 측만 있습니다. BGP 스피커가 활성으로 구성되면 최종적으로 설정되는 연결의 활성 또는 수동 측에서 종료될 수 있습니다. TCP 연결이 완료되면 어느 쪽이 활성이고 어느 쪽이 수동인지는 중요하지 않습니다. 유일한 차이점은 TCP 연결의 어느 쪽에 포트 번호가 179인지입니다.

---
##### **8.2.1.2.  FSM and Collision Detection**

BGP 연결당 하나의 FSM이 있습니다. 연결이 어떤 피어와 연관되어 있는지 결정하기 전에 연결 충돌이 발생하면 하나의 피어에 대해 두 개의 연결이 있을 수 있습니다. 연결 충돌이 해결된 후\(섹션 6.8 참조\) 닫힌 연결에 대한 FSM은 삭제되어야 합니다.

---
##### **8.2.1.3.  FSM and Optional Session Attributes**

선택적 세션 속성은 플래그\(TRUE 또는 FALSE\) 또는 선택적 타이머 역할을 하는 속성을 지정합니다. 플래그 역할을 하는 선택적 속성의 경우 선택적 세션 속성이 시스템에서 TRUE로 설정될 수 있으면 해당 BGP FSM 작업이 지원되어야 합니다. 예를 들어, BGP 구현에서 AutoStart 및 PassiveTcpSetupment 옵션을 설정할 수 있는 경우 이벤트 3, 4 및 5가 지원되어야 합니다. 선택적 세션 속성을 TRUE로 설정할 수 없는 경우 해당 옵션 세트를 지원하는 이벤트는 지원될 필요가 없습니다.

각 선택적 타이머\(DelayOpenTimer 및 IdleHoldTimer\)에는 다음과 같은 속성 그룹이 있습니다.

- 지원을 나타내는 플래그,
- 타이머에 설정된 시간
- 타이머.

두 개의 선택적 타이머는 다음 형식을 보여줍니다.

```text
      DelayOpenTimer: DelayOpen, DelayOpenTime, DelayOpenTimer
      IdleHoldTimer:  DampPeerOscillations, IdleHoldTime,
                      IdleHoldTimer
```

선택적 타이머\(DelayOpen 또는 DampPeerOscillations\)에 대한 지원을 나타내는 플래그를 TRUE로 설정할 수 없는 경우 해당 옵션을 지원하는 타이머 및 이벤트는 지원될 필요가 없습니다.

---
##### **8.2.1.4.  FSM Event Numbers**

이 상태 머신 설명에 활용되는 이벤트 번호\(1-28\)는 BGP 상태 머신의 동작을 지정하는 데 도움이 됩니다. 구현에서는 이러한 번호를 사용하여 네트워크 관리 정보를 제공할 수 있습니다. FSM 또는 FSM 이벤트의 정확한 형식은 각 구현에 따라 다릅니다.

---
##### **8.2.1.5.  FSM Actions that are Implementation Dependent**

특정 지점에서 BGP FSM은 BGP 초기화가 발생하거나 BGP 리소스가 삭제되도록 지정합니다. BGP FSM 및 관련 리소스의 초기화는 BGP 구현의 정책 부분에 따라 달라집니다. 이러한 작업의 세부 사항은 FSM 문서의 범위를 벗어납니다.

---
#### **8.2.2.  Finite State Machine**

```text
   Idle state:
```

- 처음에는 BGP 피어 FSM이 Idle 상태입니다. 이후에는 BGP 피어 FSM이 BGP FSM으로 단축됩니다.

- 이 상태에서 BGP FSM은 이 피어에 대해 들어오는 모든 BGP 연결을 거부합니다. 피어에 리소스가 할당되지 않습니다. ManualStart 이벤트\(이벤트 1\) 또는 AutomaticStart 이벤트\(이벤트 3\)에 대한 응답으로 로컬 시스템은 다음을 수행합니다.

- - 피어 연결을 위한 모든 BGP 리소스를 초기화합니다.

- - ConnectRetryCounter를 0으로 설정합니다.

- - 초기 값으로 ConnectRetryTimer를 시작합니다.

- - 다른 BGP 피어에 대한 TCP 연결을 시작합니다.

```text
        - listens for a connection that may be initiated by the remote
          BGP peer, and
```

- - 상태를 연결로 변경합니다.

- Idle 상태에서는 ManualStop 이벤트\(이벤트 2\)와 AutoStop\(이벤트 8\) 이벤트가 무시됩니다.

- ManualStart\_with\_PassiveTcpSetupment 이벤트\(이벤트 4\) 또는 AutomaticStart\_with\_PassiveTcpSetupment 이벤트\(이벤트 5\)에 대한 응답으로 로컬 시스템은 다음을 수행합니다.

```text
        - initializes all BGP resources,
```

- - ConnectRetryCounter를 0으로 설정합니다.

- - 초기 값으로 ConnectRetryTimer를 시작합니다.

```text
        - listens for a connection that may be initiated by the remote
          peer, and
```

- - 상태를 활성으로 변경합니다.

- ConnectRetryTimer의 정확한 값은 로컬 문제이지만 TCP 초기화를 허용할 만큼 충분히 커야 합니다.

- DampPeerOscillations 속성이 TRUE로 설정된 경우 유휴 상태 내에서 다음 세 가지 추가 이벤트가 발생할 수 있습니다.

```text
        - AutomaticStart_with_DampPeerOscillations (Event 6),

        - AutomaticStart_with_DampPeerOscillations_and_
          PassiveTcpEstablishment (Event 7),

        - IdleHoldTimer_Expires (Event 13).
```

- 이 3가지 이벤트를 수신하면 로컬 시스템은 이러한 이벤트를 사용하여 피어 진동을 방지합니다. 지속적인 피어 진동을 방지하는 방법은 이 문서의 범위를 벗어납니다.

- Idle 상태에서 수신된 다른 이벤트\(이벤트 9-12, 15-28\)는 로컬 시스템의 상태에 변화를 일으키지 않습니다.

```text
   Connect State:
```

- 이 상태에서 BGP FSM은 TCP 연결이 완료되기를 기다리고 있습니다.

- 연결 상태에서는 시작 이벤트\(이벤트 1, 3\~7\)가 무시됩니다.

- ManualStop 이벤트\(이벤트 2\)에 대한 응답으로 로컬 시스템은 다음을 수행합니다.

- - TCP 연결을 끊습니다.

```text
        - releases all BGP resources,
```

- - ConnectRetryCounter를 0으로 설정합니다.

```text
        - stops the ConnectRetryTimer and sets ConnectRetryTimer to
          zero, and
```

- - 상태를 유휴 상태로 변경합니다.

- ConnectRetryTimer\_Expires 이벤트\(이벤트 9\)에 대한 응답으로 로컬 시스템은 다음을 수행합니다.

- - TCP 연결을 끊습니다.

- - ConnectRetryTimer를 다시 시작합니다.

- - DelayOpenTimer를 중지하고 타이머를 0으로 재설정합니다.

- - 다른 BGP 피어에 대한 TCP 연결을 시작합니다.

```text
        - continues to listen for a connection that may be initiated by
          the remote BGP peer, and
```

- - 연결 상태를 유지합니다.

- Connect 상태에서 DelayOpenTimer\_Expires 이벤트\(이벤트 12\)가 발생하면 로컬 시스템은 다음을 수행합니다.

- - 피어에게 OPEN 메시지를 보냅니다.

- - HoldTimer를 큰 값으로 설정하고

- - 상태를 OpenSent로 변경합니다.

- BGP FSM이 TcpConnection\_Valid 이벤트\(이벤트 14\)를 수신하면 TCP 연결이 처리되고 연결은 Connect 상태로 유지됩니다.

- BGP FSM이 Tcp\_CR\_Invalid 이벤트\(이벤트 15\)를 수신하면 로컬 시스템은 TCP 연결을 거부하고 연결은 Connect 상태로 유지됩니다.

- TCP 연결이 성공하면\(이벤트 16 또는 이벤트 17\) 로컬 시스템은 처리 전에 DelayOpen 속성을 확인합니다. DelayOpen 속성이 TRUE로 설정된 경우 로컬 시스템은 다음을 수행합니다.

```text
        - stops the ConnectRetryTimer (if running) and sets the
          ConnectRetryTimer to zero,
```

- - DelayOpenTimer를 초기 값으로 설정하고

- - 연결 상태를 유지합니다.

- DelayOpen 속성이 FALSE로 설정된 경우 로컬 시스템은 다음을 수행합니다.

```text
        - stops the ConnectRetryTimer (if running) and sets the
          ConnectRetryTimer to zero,

        - completes BGP initialization
```

- - 피어에게 OPEN 메시지를 보냅니다.

- - HoldTimer를 큰 값으로 설정하고

- - 상태를 OpenSent로 변경합니다.

- HoldTimer 값은 4분을 권장합니다.

- TCP 연결이 실패하면\(이벤트 18\) 로컬 시스템이 DelayOpenTimer를 확인합니다. DelayOpenTimer가 실행 중인 경우 로컬 시스템은 다음을 수행합니다.

- - ConnectRetryTimer를 초기 값으로 다시 시작합니다.

- - DelayOpenTimer를 중지하고 해당 값을 0으로 재설정합니다.

```text
        - continues to listen for a connection that may be initiated by
          the remote BGP peer, and
```

- - 상태를 활성으로 변경합니다.

- DelayOpenTimer가 실행되고 있지 않은 경우 로컬 시스템은 다음을 수행합니다.

- - ConnectRetryTimer를 0으로 중지합니다.

- - TCP 연결을 끊습니다.

```text
        - releases all BGP resources, and
```

- - 상태를 유휴 상태로 변경합니다.

- DelayOpenTimer가 실행되는 동안\(이벤트 20\) OPEN 메시지가 수신되면 로컬 시스템은 다음을 수행합니다.

```text
        - stops the ConnectRetryTimer (if running) and sets the
          ConnectRetryTimer to zero,
```

- - BGP 초기화를 완료합니다.

- - DelayOpenTimer를 중지하고 지웁니다\(값을 0으로 설정\).

- - OPEN 메시지를 보냅니다.

- - KEEPALIVE 메시지를 보냅니다.

- - HoldTimer 초기값이 0이 아닌 경우,

- - 초기 값으로 KeepaliveTimer를 시작하고

- - HoldTimer를 협상된 값으로 재설정합니다.

```text
          else, if the HoldTimer initial value is zero,
```

- - KeepaliveTimer를 재설정하고

- - HoldTimer 값을 0으로 재설정합니다.

- - 상태를 OpenConfirm으로 변경합니다.

- 자율 시스템 필드의 값이 로컬 자율 시스템 번호와 동일한 경우 연결 상태를 내부 연결로 설정합니다. 그렇지 않으면 "외부"가 됩니다.

- BGP 메시지 헤더 검사\(이벤트 21\) 또는 OPEN 메시지 검사에서 오류\(이벤트 22\)가 감지되면\(섹션 6.2 참조\) 로컬 시스템은 다음을 수행합니다.

```text
        - (optionally) If the SendNOTIFICATIONwithoutOPEN attribute is
          set to TRUE, then the local system first sends a NOTIFICATION
          message with the appropriate error code, and then

        - stops the ConnectRetryTimer (if running) and sets the
          ConnectRetryTimer to zero,

        - releases all BGP resources,
```

- - TCP 연결을 끊습니다.

- - ConnectRetryCounter를 1씩 증가시킵니다.

```text
        - (optionally) performs peer oscillation damping if the
          DampPeerOscillations attribute is set to TRUE, and
```

- - 상태를 유휴 상태로 변경합니다.

- 버전 오류\(Event 24\)와 함께 NOTIFICATION 메시지가 수신되면 로컬 시스템은 DelayOpenTimer를 확인합니다. DelayOpenTimer가 실행 중인 경우 로컬 시스템은 다음을 수행합니다.

```text
        - stops the ConnectRetryTimer (if running) and sets the
          ConnectRetryTimer to zero,
```

- - DelayOpenTimer를 중지하고 재설정합니다\(0으로 설정\).

```text
        - releases all BGP resources,
```

- - TCP 연결을 끊고,

- - 상태를 유휴 상태로 변경합니다.

- DelayOpenTimer가 실행되고 있지 않은 경우 로컬 시스템은 다음을 수행합니다.

```text
        - stops the ConnectRetryTimer and sets the ConnectRetryTimer to
          zero,

        - releases all BGP resources,
```

- - TCP 연결을 끊습니다.

- - ConnectRetryCounter를 1씩 증가시킵니다.

```text
        - performs peer oscillation damping if the DampPeerOscillations
          attribute is set to True, and
```

- - 상태를 유휴 상태로 변경합니다.

- 기타 이벤트\(이벤트 8, 10-11, 13, 19, 23, 25-28\)에 대한 응답으로 로컬 시스템은 다음을 수행합니다.

```text
        - if the ConnectRetryTimer is running, stops and resets the
          ConnectRetryTimer (sets to zero),

        - if the DelayOpenTimer is running, stops and resets the
          DelayOpenTimer (sets to zero),

        - releases all BGP resources,
```

- - TCP 연결을 끊습니다.

- - ConnectRetryCounter를 1씩 증가시킵니다.

```text
        - performs peer oscillation damping if the DampPeerOscillations
          attribute is set to True, and
```

- - 상태를 유휴 상태로 변경합니다.

```text
   Active State:
```

- 이 상태에서 BGP FSM은 TCP 연결을 수신하고 수락하여 피어를 획득하려고 합니다.

- 활성 상태에서는 시작 이벤트\(이벤트 1, 3\~7\)가 무시됩니다.

- ManualStop 이벤트\(이벤트 2\)에 대한 응답으로 로컬 시스템은 다음을 수행합니다.

```text
        - If the DelayOpenTimer is running and the
          SendNOTIFICATIONwithoutOPEN session attribute is set, the
          local system sends a NOTIFICATION with a Cease,

        - releases all BGP resources including stopping the
          DelayOpenTimer
```

- - TCP 연결을 끊습니다.

- - ConnectRetryCounter를 0으로 설정합니다.

```text
        - stops the ConnectRetryTimer and sets the ConnectRetryTimer to
          zero, and
```

- - 상태를 유휴 상태로 변경합니다.

- ConnectRetryTimer\_Expires 이벤트\(이벤트 9\)에 대한 응답으로 로컬 시스템은 다음을 수행합니다.

- - ConnectRetryTimer를 다시 시작합니다\(초기값으로\).

- - 다른 BGP 피어에 대한 TCP 연결을 시작합니다.

```text
        - continues to listen for a TCP connection that may be initiated
          by a remote BGP peer, and
```

- - 상태를 연결로 변경합니다.

- 로컬 시스템이 DelayOpenTimer\_Expires 이벤트\(이벤트 12\)를 수신하는 경우 로컬 시스템은 다음을 수행합니다.

- - ConnectRetryTimer를 0으로 설정합니다.

- - DelayOpenTimer를 중지하고 지웁니다\(0으로 설정\).

- - BGP 초기화를 완료합니다.

- - 원격 피어에게 OPEN 메시지를 보냅니다.

- - 보류 타이머를 큰 값으로 설정하고

- - 상태를 OpenSent로 변경합니다.

- 이 상태 전환에는 HoldTimer 값 4분도 제안됩니다.

- 로컬 시스템이 TcpConnection\_Valid 이벤트\(이벤트 14\)를 수신하면 로컬 시스템은 TCP 연결 플래그를 처리하고 Active 상태를 유지합니다.

- 로컬 시스템이 Tcp\_CR\_Invalid 이벤트\(이벤트 15\)를 수신하면 로컬 시스템은 TCP 연결을 거부하고 활성 상태를 유지합니다.

- TCP 연결 성공\(이벤트 16 또는 이벤트 17\)에 대한 응답으로 로컬 시스템은 처리 전에 DelayOpen 선택적 속성을 확인합니다.

- DelayOpen 속성이 TRUE로 설정된 경우 로컬 시스템은 다음을 수행합니다.

```text
          - stops the ConnectRetryTimer and sets the ConnectRetryTimer
            to zero,

          - sets the DelayOpenTimer to the initial value
            (DelayOpenTime), and
```

- - 활성 상태를 유지합니다.

- DelayOpen 속성이 FALSE로 설정된 경우 로컬 시스템은 다음을 수행합니다.

- - ConnectRetryTimer를 0으로 설정합니다.

- - BGP 초기화를 완료합니다.

- - 피어에게 OPEN 메시지를 보냅니다.

- - HoldTimer를 큰 값으로 설정하고

- - 상태를 OpenSent로 변경합니다.

- HoldTimer의 "큰 값"으로 HoldTimer 값 4분이 제안됩니다.

- 로컬 시스템이 TcpConnectionFails 이벤트\(이벤트 18\)를 수신하는 경우 로컬 시스템은 다음을 수행합니다.

- - ConnectRetryTimer를 다시 시작합니다\(초기 값으로\).

- - DelayOpenTimer를 중지하고 지웁니다\(값을 0으로 설정\).

```text
        - releases all BGP resource,
```

- - ConnectRetryCounter를 1씩 증가시킵니다.

```text
        - optionally performs peer oscillation damping if the
          DampPeerOscillations attribute is set to TRUE, and
```

- - 상태를 유휴 상태로 변경합니다.

- OPEN 메시지가 수신되고 DelayOpenTimer가 실행 중인 경우\(이벤트 20\) 로컬 시스템은 다음을 수행합니다.

```text
        - stops the ConnectRetryTimer (if running) and sets the
          ConnectRetryTimer to zero,
```

- - DelayOpenTimer를 중지하고 지웁니다\(0으로 설정\).

- - BGP 초기화를 완료합니다.

- - OPEN 메시지를 보냅니다.

- - KEEPALIVE 메시지를 보냅니다.

- - HoldTimer 값이 0이 아닌 경우

- - KeepaliveTimer를 초기 값으로 시작합니다.

- - HoldTimer를 협상된 값으로 재설정합니다.

```text
          else if the HoldTimer is zero
```

- - KeepaliveTimer를 재설정합니다\(0으로 설정\).

- - HoldTimer를 0으로 재설정하고

- - 상태를 OpenConfirm으로 변경합니다.

- 자율 시스템 필드의 값이 로컬 자율 시스템 번호와 동일한 경우 연결 상태를 내부 연결로 설정합니다. 그렇지 않으면 외부적일 것입니다.

- BGP 메시지 헤더 검사\(이벤트 21\) 또는 OPEN 메시지 검사에서 오류\(이벤트 22\)가 감지되면\(섹션 6.2 참조\) 로컬 시스템은 다음을 수행합니다.

```text
        - (optionally) sends a NOTIFICATION message with the appropriate
          error code if the SendNOTIFICATIONwithoutOPEN attribute is set
          to TRUE,
```

- - ConnectRetryTimer를 0으로 설정합니다.

```text
        - releases all BGP resources,
```

- - TCP 연결을 끊습니다.

- - ConnectRetryCounter를 1씩 증가시킵니다.

```text
        - (optionally) performs peer oscillation damping if the
          DampPeerOscillations attribute is set to TRUE, and
```

- - 상태를 유휴 상태로 변경합니다.

- 버전 오류\(Event 24\)와 함께 NOTIFICATION 메시지가 수신되면 로컬 시스템은 DelayOpenTimer를 확인합니다. DelayOpenTimer가 실행 중인 경우 로컬 시스템은 다음을 수행합니다.

```text
        - stops the ConnectRetryTimer (if running) and sets the
          ConnectRetryTimer to zero,
```

- - DelayOpenTimer를 중지하고 재설정합니다\(0으로 설정\).

```text
        - releases all BGP resources,
```

- - TCP 연결을 끊고,

- - 상태를 유휴 상태로 변경합니다.

- DelayOpenTimer가 실행되고 있지 않은 경우 로컬 시스템은 다음을 수행합니다.

- - ConnectRetryTimer를 0으로 설정합니다.

```text
        - releases all BGP resources,
```

- - TCP 연결을 끊습니다.

- - ConnectRetryCounter를 1씩 증가시킵니다.

```text
        - (optionally) performs peer oscillation damping if the
          DampPeerOscillations attribute is set to TRUE, and
```

- - 상태를 유휴 상태로 변경합니다.

- 기타 이벤트\(이벤트 8, 10-11, 13, 19, 23, 25-28\)에 대한 응답으로 로컬 시스템은 다음을 수행합니다.

- - ConnectRetryTimer를 0으로 설정합니다.

```text
        - releases all BGP resources,
```

- - TCP 연결을 끊습니다.

- - ConnectRetryCounter를 1씩 증가시킵니다.

```text
        - (optionally) performs peer oscillation damping if the
          DampPeerOscillations attribute is set to TRUE, and
```

- - 상태를 유휴 상태로 변경합니다.

```text
   OpenSent:
```

- 이 상태에서 BGP FSM은 피어로부터 OPEN 메시지를 기다립니다.

- OpenSent 상태에서는 시작 이벤트\(이벤트 1, 3\~7\)가 무시됩니다.

- OpenSent 상태에서 ManualStop 이벤트\(이벤트 2\)가 발생하면 로컬 시스템은 다음을 수행합니다.

- - 중지와 함께 알림을 보냅니다.

- - ConnectRetryTimer를 0으로 설정합니다.

```text
        - releases all BGP resources,
```

- - TCP 연결을 끊습니다.

- - ConnectRetryCounter를 0으로 설정하고

- - 상태를 유휴 상태로 변경합니다.

- OpenSent 상태에서 AutomaticStop 이벤트\(이벤트 8\)가 발생하면 로컬 시스템은 다음을 수행합니다.

- - 중지와 함께 알림을 보냅니다.

- - ConnectRetryTimer를 0으로 설정합니다.

- - 모든 BGP 리소스를 해제합니다.

- - TCP 연결을 끊습니다.

- - ConnectRetryCounter를 1씩 증가시킵니다.

```text
        - (optionally) performs peer oscillation damping if the
          DampPeerOscillations attribute is set to TRUE, and
```

- - 상태를 유휴 상태로 변경합니다.

- HoldTimer\_Expires\(이벤트 10\)인 경우 로컬 시스템은 다음을 수행합니다.

```text
        - sends a NOTIFICATION message with the error code Hold Timer
          Expired,
```

- - ConnectRetryTimer를 0으로 설정합니다.

```text
        - releases all BGP resources,
```

- - TCP 연결을 끊습니다.

- - ConnectRetryCounter를 증가시킵니다.

```text
        - (optionally) performs peer oscillation damping if the
          DampPeerOscillations attribute is set to TRUE, and
```

- - 상태를 유휴 상태로 변경합니다.

- TcpConnection\_Valid\(이벤트 14\), Tcp\_CR\_Acked\(이벤트 16\) 또는 TcpConnectionConfirmed 이벤트\(이벤트 17\)가 수신되면 두 번째 TCP 연결이 진행 중일 수 있습니다. 이 두 번째 TCP 연결은 OPEN 메시지가 수신될 때까지 연결 충돌 처리\(6.8절\)별로 추적됩니다.

- 잘못된 포트\(Tcp\_CR\_Invalid\(이벤트 15\)\)에 대한 TCP 연결 요청은 무시됩니다.

- TcpConnectionFails 이벤트\(이벤트 18\)가 수신되면 로컬 시스템은 다음을 수행합니다.

- - BGP 연결을 닫습니다.

- - ConnectRetryTimer를 다시 시작합니다.

```text
        - continues to listen for a connection that may be initiated by
          the remote BGP peer, and
```

- - 상태를 활성으로 변경합니다.

- OPEN 메시지가 수신되면 모든 필드의 정확성을 검사합니다. OPEN 메시지\(이벤트 19\)에 오류가 없으면 로컬 시스템은 다음을 수행합니다.

- - DelayOpenTimer를 0으로 재설정합니다.

- - BGP ConnectRetryTimer를 0으로 설정합니다.

- - KEEPALIVE 메시지를 보냅니다. 그리고

- - KeepaliveTimer를 설정합니다\(아래 텍스트를 통해\).

```text
        - sets the HoldTimer according to the negotiated value (see
          Section 4.2),
```

- - 상태를 OpenConfirm으로 변경합니다.

- 협상된 보류 시간 값이 0이면 HoldTimer 및 KeepaliveTimer가 시작되지 않습니다. 자율 시스템 필드의 값이 로컬 자율 시스템 번호와 동일한 경우 연결은 "내부" 연결입니다. 그렇지 않으면 "외부" 연결입니다. \(이것은 아래에 설명된 대로 UPDATE 처리에 영향을 미칩니다.\)

- BGP 메시지 헤더 검사\(이벤트 21\) 또는 OPEN 메시지 검사에서 오류\(이벤트 22\)가 감지되면\(섹션 6.2 참조\) 로컬 시스템은 다음을 수행합니다.

- - 적절한 오류 코드와 함께 알림 메시지를 보냅니다.

- - ConnectRetryTimer를 0으로 설정합니다.

```text
        - releases all BGP resources,
```

- - TCP 연결을 끊습니다.

- - ConnectRetryCounter를 1씩 증가시킵니다.

```text
        - (optionally) performs peer oscillation damping if the
          DampPeerOscillations attribute is TRUE, and
```

- - 상태를 유휴 상태로 변경합니다.

- 유효한 BGP OPEN 메시지가 수신되면\(이벤트 19 또는 이벤트 20\) 충돌 감지 메커니즘\(Section 6.8\)을 적용해야 합니다. 자세한 비교 내용은 섹션 6.8을 참조하세요. ㅏ

- CollisionDetectDump 이벤트는 BGP 구현이 이 문서의 범위를 벗어나 연결 충돌이 발생했음을 확인할 때 발생합니다.

- OpenSent 상태의 연결이 닫혀야 하는 연결로 판단되면 OpenCollisionDump\(이벤트 23\)가 상태 머신에 신호를 보냅니다. OpenSent 상태에서 이러한 이벤트가 수신되면 로컬 시스템은 다음을 수행합니다.

- - 중지와 함께 알림을 보냅니다.

- - ConnectRetryTimer를 0으로 설정합니다.

```text
        - releases all BGP resources,
```

- - TCP 연결을 끊습니다.

- - ConnectRetryCounter를 1씩 증가시킵니다.

```text
        - (optionally) performs peer oscillation damping if the
          DampPeerOscillations attribute is set to TRUE, and
```

- - 상태를 유휴 상태로 변경합니다.

- 버전 오류\(이벤트 24\)와 함께 NOTIFICATION 메시지가 수신되면 로컬 시스템은 다음을 수행합니다.

- - ConnectRetryTimer를 0으로 설정합니다.

```text
        - releases all BGP resources,
```

- - TCP 연결을 끊고,

- - 상태를 유휴 상태로 변경합니다.

- 기타 이벤트\(이벤트 9, 11-13, 20, 25-28\)에 대한 응답으로 로컬 시스템은 다음을 수행합니다.

```text
        - sends the NOTIFICATION with the Error Code Finite State
          Machine Error,
```

- - ConnectRetryTimer를 0으로 설정합니다.

```text
        - releases all BGP resources,
```

- - TCP 연결을 끊습니다.

- - ConnectRetryCounter를 1씩 증가시킵니다.

```text
        - (optionally) performs peer oscillation damping if the
          DampPeerOscillations attribute is set to TRUE, and
```

- - 상태를 유휴 상태로 변경합니다.

```text
   OpenConfirm State:
```

- 이 상태에서 BGP는 KEEPALIVE 또는 NOTIFICATION 메시지를 기다립니다.

- OpenConfirm 상태에서는 모든 시작 이벤트\(이벤트 1, 3-7\)가 무시됩니다.

- 운영자가 시작한 ManualStop 이벤트\(이벤트 2\)에 대한 응답으로 로컬 시스템은 다음을 수행합니다.

- - 중지와 함께 NOTIFICATION 메시지를 보냅니다.

```text
        - releases all BGP resources,
```

- - TCP 연결을 끊습니다.

- - ConnectRetryCounter를 0으로 설정합니다.

- - ConnectRetryTimer를 0으로 설정하고

- - 상태를 유휴 상태로 변경합니다.

- 시스템에 의해 시작된 AutomaticStop 이벤트\(이벤트 8\)에 대한 응답으로 로컬 시스템은 다음을 수행합니다.

- - 중지와 함께 NOTIFICATION 메시지를 보냅니다.

- - ConnectRetryTimer를 0으로 설정합니다.

```text
        - releases all BGP resources,
```

- - TCP 연결을 끊습니다.

- - ConnectRetryCounter를 1씩 증가시킵니다.

```text
        - (optionally) performs peer oscillation damping if the
          DampPeerOscillations attribute is set to TRUE, and
```

- - 상태를 유휴 상태로 변경합니다.

- KEEPALIVE 메시지가 수신되기 전에 HoldTimer\_Expires 이벤트\(이벤트 10\)가 발생하면 로컬 시스템은 다음을 수행합니다.

```text
        - sends the NOTIFICATION message with the Error Code Hold Timer
          Expired,
```

- - ConnectRetryTimer를 0으로 설정합니다.

```text
        - releases all BGP resources,
```

- - TCP 연결을 끊습니다.

- - ConnectRetryCounter를 1씩 증가시킵니다.

```text
        - (optionally) performs peer oscillation damping if the
          DampPeerOscillations attribute is set to TRUE, and
```

- - 상태를 유휴 상태로 변경합니다.

- 로컬 시스템이 KeepaliveTimer\_Expires 이벤트\(이벤트 11\)를 수신하는 경우 로컬 시스템은 다음을 수행합니다.

- - KEEPALIVE 메시지를 보냅니다.

- - KeepaliveTimer를 다시 시작하고

- - OpenConfirmed 상태로 유지됩니다.

- OpenConfirm에서 TcpConnection\_Valid 이벤트\(이벤트 14\)가 발생하거나 TCP 연결\(이벤트 16 또는 이벤트 17\)이 성공하는 경우 로컬 시스템은 두 번째 연결을 추적해야 합니다.

- 잘못된 포트로 TCP 연결을 시도하는 경우\(이벤트 15\) 로컬 시스템은 두 번째 연결 시도를 무시합니다.

- 로컬 시스템이 기본 TCP에서 TcpConnectionFails 이벤트\(이벤트 18\) 또는 NOTIFICATION 메시지\(이벤트 25\)를 수신하는 경우 로컬 시스템은 다음을 수행합니다.

- - ConnectRetryTimer를 0으로 설정합니다.

```text
        - releases all BGP resources,
```

- - TCP 연결을 끊습니다.

- - ConnectRetryCounter를 1씩 증가시킵니다.

```text
        - (optionally) performs peer oscillation damping if the
          DampPeerOscillations attribute is set to TRUE, and
```

- - 상태를 유휴 상태로 변경합니다.

- 로컬 시스템이 버전 오류\(NotifMsgVerErr\(이벤트 24\)\)와 함께 알림 메시지를 수신하는 경우 로컬 시스템은 다음을 수행합니다.

- - ConnectRetryTimer를 0으로 설정합니다.

```text
        - releases all BGP resources,
```

- - TCP 연결을 끊고,

- - 상태를 유휴 상태로 변경합니다.

- 로컬 시스템이 유효한 OPEN 메시지\(BGPOpen \(Event 19\)\)를 수신하면 6.8절에 따라 충돌 감지 기능이 처리된다. 연결 충돌로 인해 이 연결이 끊어지는 경우 로컬 시스템은 다음을 수행합니다.

- - 중지와 함께 알림을 보냅니다.

- - ConnectRetryTimer를 0으로 설정합니다.

```text
        - releases all BGP resources,
```

- - TCP 연결을 끊습니다\(TCP FIN 전송\).

- - ConnectRetryCounter를 1씩 증가시킵니다.

```text
        - (optionally) performs peer oscillation damping if the
          DampPeerOscillations attribute is set to TRUE, and
```

- - 상태를 유휴 상태로 변경합니다.

- OPEN 메시지가 수신되면 모든 필드의 정확성을 확인합니다. BGP 메시지 헤더 검사\(BGPHeaderErr\(이벤트 21\)\) 또는 OPEN 메시지 검사에서 오류\(섹션 6.2 참조\)\(BGPOpenMsgErr\(이벤트 22\)\)를 감지하면 로컬 시스템은 다음을 수행합니다.

- - 적절한 오류 코드와 함께 알림 메시지를 보냅니다.

- - ConnectRetryTimer를 0으로 설정합니다.

```text
        - releases all BGP resources,
```

- - TCP 연결을 끊습니다.

- - ConnectRetryCounter를 1씩 증가시킵니다.

```text
        - (optionally) performs peer oscillation damping if the
          DampPeerOscillations attribute is set to TRUE, and
```

- - 상태를 유휴 상태로 변경합니다.

- 다른 OPEN 메시지를 처리하는 동안 BGP 구현이 이 문서의 범위를 벗어나는 방법으로 연결 충돌이 발생했고 이 연결이 닫혀야 한다고 결정하면 로컬 시스템은 OpenCollisionDump 이벤트\(이벤트\)를 발행합니다. 23\). 로컬 시스템이 OpenCollisionDump 이벤트\(이벤트 23\)를 수신하면 로컬 시스템은 다음을 수행합니다.

- - 중지와 함께 알림을 보냅니다.

- - ConnectRetryTimer를 0으로 설정합니다.

```text
        - releases all BGP resources
```

- - TCP 연결을 끊습니다.

- - ConnectRetryCounter를 1씩 증가시킵니다.

```text
        - (optionally) performs peer oscillation damping if the
          DampPeerOscillations attribute is set to TRUE, and
```

- - 상태를 유휴 상태로 변경합니다.

- 로컬 시스템이 KEEPALIVE 메시지\(KeepAliveMsg\(이벤트 26\)\)를 수신하는 경우 로컬 시스템은 다음을 수행합니다.

- - HoldTimer를 다시 시작하고

- - 상태를 설정됨으로 변경합니다.

- 기타 이벤트\(이벤트 9, 12-13, 20, 27-28\)에 대한 응답으로 로컬 시스템은 다음을 수행합니다.

```text
        - sends a NOTIFICATION with a code of Finite State Machine
          Error,
```

- - ConnectRetryTimer를 0으로 설정합니다.

```text
        - releases all BGP resources,
```

- - TCP 연결을 끊습니다.

- - ConnectRetryCounter를 1씩 증가시킵니다.

```text
        - (optionally) performs peer oscillation damping if the
          DampPeerOscillations attribute is set to TRUE, and
```

- - 상태를 유휴 상태로 변경합니다.

```text
   Established State:
```

- 확립된 상태에서 BGP FSM은 피어와 UPDATE, NOTIFICATION 및 KEEPALIVE 메시지를 교환할 수 있습니다.

- 모든 시작 이벤트\(이벤트 1, 3-7\)는 설정됨 상태에서 무시됩니다.

- ManualStop 이벤트\(운영자가 시작한\)\(이벤트 2\)에 대한 응답으로 로컬 시스템은 다음을 수행합니다.

- - 중지와 함께 NOTIFICATION 메시지를 보냅니다.

- - ConnectRetryTimer를 0으로 설정합니다.

- - 이 연결과 관련된 모든 경로를 삭제합니다.

```text
        - releases BGP resources,
```

- - TCP 연결을 끊습니다.

- - ConnectRetryCounter를 0으로 설정하고

- - 상태를 유휴 상태로 변경합니다.

- AutomaticStop 이벤트\(이벤트 8\)에 대한 응답으로 로컬 시스템은 다음을 수행합니다.

- - 중지와 함께 알림을 보냅니다.

- - ConnectRetryTimer를 0으로 설정합니다.

- - 이 연결과 관련된 모든 경로를 삭제합니다.

```text
        - releases all BGP resources,
```

- - TCP 연결을 끊습니다.

- - ConnectRetryCounter를 1씩 증가시킵니다.

```text
        - (optionally) performs peer oscillation damping if the
          DampPeerOscillations attribute is set to TRUE, and
```

- - 상태를 유휴 상태로 변경합니다.

- AutomaticStop 이벤트의 한 가지 이유는 다음과 같습니다. BGP는 수신된 총 접두사가 구성된 최대 접두사 수를 초과하는 특정 피어에 대한 여러 접두사가 포함된 업데이트 메시지를 수신합니다. 로컬 시스템은 자동으로 피어 연결을 끊습니다.

- HoldTimer\_Expires 이벤트가 발생하면\(이벤트 10\) 로컬 시스템은 다음을 수행합니다.

```text
        - sends a NOTIFICATION message with the Error Code Hold Timer
          Expired,
```

- - ConnectRetryTimer를 0으로 설정합니다.

```text
        - releases all BGP resources,
```

- - TCP 연결을 끊습니다.

- - ConnectRetryCounter를 1씩 증가시킵니다.

```text
        - (optionally) performs peer oscillation damping if the
          DampPeerOscillations attribute is set to TRUE, and
```

- - 상태를 유휴 상태로 변경합니다.

- KeepaliveTimer\_Expires 이벤트가 발생하면\(이벤트 11\) 로컬 시스템은 다음을 수행합니다.

- - KEEPALIVE 메시지를 보냅니다. 그리고

```text
        - restarts its KeepaliveTimer, unless the negotiated HoldTime
          value is zero.
```

- 로컬 시스템이 KEEPALIVE 또는 UPDATE 메시지를 보낼 때마다 협상된 HoldTime 값이 0이 아닌 한 KeepaliveTimer를 다시 시작합니다.

- 유효한 포트에 대해 수신된 TcpConnection\_Valid\(이벤트 14\)는 두 번째 연결을 추적하게 합니다.

- 잘못된 TCP 연결\(Tcp\_CR\_Invalid 이벤트\(이벤트 15\)\)은 무시됩니다.

- TCP 연결이 성공적으로 설정되었다는 표시\(이벤트 16 또는 이벤트 17\)에 대한 응답으로 두 번째 연결은 OPEN 메시지를 보낼 때까지 추적되어야 합니다.

- 유효한 OPEN 메시지\(BGPOpen\(이벤트 19\)\)가 수신되고 CollisionDetectUsedState 선택적 속성이 TRUE인 경우 OPEN 메시지가 다른 연결과 충돌하는지\(6.8절\) 확인합니다. BGP 구현에서 이 연결을 종료해야 한다고 판단하면 OpenCollisionDump 이벤트\(이벤트 23\)를 처리합니다. 이 연결을 종료해야 하는 경우 로컬 시스템은 다음을 수행합니다.

- - 중지와 함께 알림을 보냅니다.

- - ConnectRetryTimer를 0으로 설정합니다.

- - 이 연결과 관련된 모든 경로를 삭제합니다.

```text
        - releases all BGP resources,
```

- - TCP 연결을 끊습니다.

- - ConnectRetryCounter를 1씩 증가시킵니다.

```text
        - (optionally) performs peer oscillation damping if the
          DampPeerOscillations is set to TRUE, and
```

- - 상태를 유휴 상태로 변경합니다.

- 로컬 시스템이 기본 TCP로부터 NOTIFICATION 메시지\(이벤트 24 또는 이벤트 25\) 또는 TcpConnectionFails\(이벤트 18\)를 수신하는 경우 로컬 시스템은 다음을 수행합니다.

- - ConnectRetryTimer를 0으로 설정합니다.

- - 이 연결과 관련된 모든 경로를 삭제합니다.

- - 모든 BGP 리소스를 해제합니다.

- - TCP 연결을 끊습니다.

- - ConnectRetryCounter를 1씩 증가시킵니다.

- - 상태를 유휴 상태로 변경합니다.

- 로컬 시스템이 KEEPALIVE 메시지\(이벤트 26\)를 수신하면 로컬 시스템은 다음을 수행합니다.

```text
        - restarts its HoldTimer, if the negotiated HoldTime value is
          non-zero, and
```

- - 설정됨 상태로 유지됩니다.

- 로컬 시스템이 UPDATE 메시지\(이벤트 27\)를 수신하면 로컬 시스템은 다음을 수행합니다.

- - 메시지를 처리합니다.

```text
        - restarts its HoldTimer, if the negotiated HoldTime value is
          non-zero, and
```

- - 설정됨 상태로 유지됩니다.

- 로컬 시스템이 UPDATE 메시지를 수신하고 UPDATE 메시지 오류 처리 절차\(섹션 6.3 참조\)에서 오류\(이벤트 28\)를 감지하면 로컬 시스템은 다음을 수행합니다.

- - 업데이트 오류와 함께 알림 메시지를 보냅니다.

- - ConnectRetryTimer를 0으로 설정합니다.

- - 이 연결과 관련된 모든 경로를 삭제합니다.

```text
        - releases all BGP resources,
```

- - TCP 연결을 끊습니다.

- - ConnectRetryCounter를 1씩 증가시킵니다.

```text
        - (optionally) performs peer oscillation damping if the
          DampPeerOscillations attribute is set to TRUE, and
```

- - 상태를 유휴 상태로 변경합니다.

- 다른 이벤트\(이벤트 9, 12-13, 20-22\)에 대한 응답으로 로컬 시스템은 다음을 수행합니다.

```text
        - sends a NOTIFICATION message with the Error Code Finite State
          Machine Error,
```

- - 이 연결과 관련된 모든 경로를 삭제합니다.

- - ConnectRetryTimer를 0으로 설정합니다.

```text
        - releases all BGP resources,
```

- - TCP 연결을 끊습니다.

- - ConnectRetryCounter를 1씩 증가시킵니다.

```text
        - (optionally) performs peer oscillation damping if the
          DampPeerOscillations attribute is set to TRUE, and
```

- - 상태를 유휴 상태로 변경합니다.

---
## **9.  UPDATE Message Handling**

UPDATE 메시지는 설치됨 상태에서만 수신될 수 있습니다. 다른 상태에서 UPDATE 메시지를 받는 것은 오류입니다. UPDATE 메시지가 수신되면 섹션 6.3에 지정된 대로 각 필드의 유효성이 검사됩니다.

선택적 비전이적 속성이 인식되지 않으면 조용히 무시됩니다. 선택적 전이적 속성이 인식되지 않으면 속성 플래그 옥텟의 부분 비트\(세 번째 상위 비트\)가 1로 설정되고 해당 속성은 다른 BGP 스피커로 전파될 수 있도록 유지됩니다.

선택적 속성이 인식되고 유효한 값을 갖는 경우 선택적 속성의 유형에 따라 로컬에서 처리되고 유지되며 필요한 경우 다른 BGP 스피커로 전파될 수 있도록 업데이트됩니다.

UPDATE 메시지가 비어 있지 않은 WITHDRAWN ROUTES 필드를 포함하는 경우, 목적지\(IP 접두사로 표현됨\)가 이 필드에 포함되어 있는 이전에 광고된 경로는 Adj-RIB-In에서 제거되어야 합니다. 이전에 광고된 경로를 더 이상 사용할 수 없기 때문에 이 BGP 스피커는 결정 프로세스를 실행해야 합니다.

UPDATE 메시지에 실행 가능한 경로가 포함되어 있으면 Adj-RIB-In은 다음과 같이 이 경로로 업데이트됩니다. 새 경로의 NLRI가 경로가 현재 Adj-RIB-In에 저장된 것과 동일하면 새로운 경로는 Adj-RIB-In의 이전 경로를 대체해야 하며, 따라서 서비스에서 이전 경로를 암시적으로 철회해야 합니다. 그렇지 않고 Adj-RIB-In에 새 경로와 동일한 NLRI가 있는 경로가 없으면 새 경로는 Adj-RIB-In에 배치되어야 합니다.

BGP 스피커가 Adj-RIB-In을 업데이트하면 스피커는 결정 프로세스를 실행해야 합니다.

---
### **9.1.  Decision Process**

결정 프로세스는 로컬 PIB\(Policy Information Base\)의 정책을 Adj-RIBs-In에 저장된 경로에 적용하여 후속 광고를 위한 경로를 선택합니다. 결정 프로세스의 출력은 피어에게 광고될 경로 세트입니다. 선택한 경로는 정책에 따라 로컬 스피커의 Adj-RIBs-Out에 저장됩니다.

여기에 설명된 BGP 결정 프로세스는 개념적이며 구현이 설명된 기능을 지원하고 외부에서 동일한 동작을 보이는 한 설명된 대로 정확하게 구현될 필요는 없습니다.

선택 프로세스는 주어진 경로의 속성을 인수로 사용하고 \(a\) 경로에 대한 선호도를 나타내는 음수가 아닌 정수 또는 \(b\) 이 경로를 나타내는 값을 반환하는 함수를 정의하여 형식화됩니다. Loc-RIB 설치 대상이 아니며, 다음 단계의 경로 선정에서 제외됩니다.

주어진 경로에 대한 선호도를 계산하는 함수는 다음 중 어떤 것도 입력으로 사용해서는 안 됩니다: 다른 경로의 존재, 다른 경로의 부재 또는 다른 경로의 경로 속성. 경로 선택은 각 실행 가능한 경로에 선호도 함수를 개별적으로 적용한 다음 선호도가 가장 높은 경로를 선택하는 것으로 구성됩니다.

결정 프로세스는 Adj-RIBs-In에 포함된 경로에서 작동하며 다음을 담당합니다.

- 화자가 로컬에서 사용할 경로 선택

- 다른 BGP 피어에게 광고할 경로 선택

- 경로 집합 및 경로 정보 축소

결정 프로세스는 서로 다른 세 가지 단계로 이루어지며 각 단계는 서로 다른 이벤트에 의해 실행됩니다.

- a\) 1단계에서는 피어로부터 수신된 각 경로에 대한 선호도를 계산합니다.

- b\) 2단계는 1단계가 완료되면 호출됩니다. 각 목적지에 대해 사용 가능한 모든 경로 중에서 최상의 경로를 선택하고 선택한 각 경로를 Loc-RIB에 설치하는 역할을 담당합니다.

- c\) Loc-RIB가 수정된 후 3단계가 호출됩니다. PIB에 포함된 정책에 따라 Loc-RIB의 경로를 각 피어에게 전파하는 역할을 담당합니다. 이 단계에서는 경로 집계 및 정보 축소를 선택적으로 수행할 수 있습니다.

---
#### **9.1.1.  Phase 1: Calculation of Degree of Preference**

1단계 결정 기능은 로컬 BGP 스피커가 피어로부터 새 경로, 대체 경로 또는 철회된 경로를 알리는 UPDATE 메시지를 수신할 때마다 호출됩니다.

1단계 결정 기능은 별도의 프로세스로, 더 이상 수행할 작업이 없을 때 완료됩니다.

1단계 결정 기능은 Adj-RIB-In이 포함된 경로에서 작동하기 전에 이를 잠그고, 그 안에 포함된 모든 새롭거나 실행 불가능한 경로에서 작동한 후에 잠금을 해제합니다.

새로 수신되거나 대체 가능한 경로 각각에 대해 로컬 BGP 스피커는 다음과 같이 선호도를 결정합니다.

- 내부 피어로부터 경로를 학습한 경우 LOCAL\_PREF 속성의 값을 선호도로 사용하거나, 로컬 시스템이 미리 구성된 정책 정보를 기반으로 경로의 선호도를 계산합니다. 후자의 경우 지속적인 라우팅 루프가 형성될 수 있습니다.

- 외부 피어로부터 경로를 학습한 경우 로컬 BGP 스피커는 미리 구성된 정책 정보를 기반으로 선호도를 계산합니다. 반환 값이 경로가 부적격함을 나타내는 경우 경로는 경로 선택의 다음 단계에 대한 입력 역할을 할 수 없습니다. 그렇지 않은 경우 반환 값은 모든 IBGP 읽기 광고에서 LOCAL\_PREF 값으로 사용해야 합니다.

- 이 정책 정보의 정확한 성격과 관련된 계산은 지역적 문제입니다.

---
#### **9.1.2.  Phase 2: Route Selection**

2단계 결정 기능은 1단계가 완료되면 호출됩니다. 2단계 기능은 추가 작업이 없을 때 완료되는 별도의 프로세스입니다. 2단계 프로세스에서는 Adj-RIBs-In에 적합한 모든 경로를 고려합니다.

3단계 결정 기능이 진행 중인 동안에는 2단계 결정 기능의 실행이 차단됩니다. 2단계 기능은 기능을 시작하기 전에 모든 Adj-RIBs-In을 잠그고 완료되면 잠금을 해제합니다.

BGP 경로의 NEXT\_HOP 속성이 확인할 수 없는 주소를 나타내는 경우 또는 경로가 라우팅 테이블에 설치된 경우 확인할 수 없게 되는 경우 BGP 경로는 2단계 결정 기능에서 제외되어야 합니다.

BGP 경로의 AS\_PATH 속성에 AS 루프가 포함된 경우 BGP 경로는 2단계 결정 기능에서 제외되어야 합니다. AS 루프 감지는 전체 AS 경로\(AS\_PATH 속성에 지정된 대로\)를 스캔하고 로컬 시스템의 자율 시스템 번호가 AS 경로에 나타나지 않는지 확인하여 수행됩니다. AS 경로에서 자체 자율 시스템 번호가 있는 경로를 허용하도록 구성된 BGP 스피커의 작동은 이 문서의 범위를 벗어납니다.

AS 내의 BGP 스피커는 전달 루프를 발생시키는 경로 선택과 관련하여 상충되는 결정을 내리지 않는 것이 중요합니다.

Adj-RIBs-In에 실행 가능한 경로가 존재하는 각 대상 세트에 대해 로컬 BGP 스피커는 다음을 포함하는 경로를 식별합니다.

- a\) 동일한 목적지 세트에 대한 모든 경로의 선호도가 가장 높은 것, 또는

- b\) 해당 목적지까지의 유일한 경로이거나

- c\) 섹션 9.1.2.2에 명시된 2단계 타이 브레이킹 규칙의 결과로 선택됩니다.

그러면 로컬 스피커는 Loc-RIB에 해당 경로를 설치해야 하며, 현재 Loc-RIB에 보관되어 있는 동일한 대상으로의 모든 경로를 대체해야 합니다. 새 BGP 경로가 라우팅 테이블에 설치되면 현재 유효하지 않은 것으로 간주되는 동일한 대상에 대한 기존 경로가 라우팅 테이블에서 제거되도록 주의해야 합니다. 새 BGP 경로가 라우팅 테이블의 기존 비BGP 경로를 대체하는지 여부는 BGP 스피커에 구성된 정책에 따라 다릅니다.

로컬 스피커는 선택한 경로의 NEXT\_HOP 속성에서 바로 다음 홉 주소를 결정해야 합니다\(섹션 5.1.3 참조\). NEXT\_HOP\(NEXT\_HOP이 IGP 경로를 통해 확인되는\)에 대한 IGP 비용 또는 즉각적인 다음 홉이 변경되면 2단계 경로 선택을 다시 수행해야 합니다.

BGP 경로가 바로 다음 홉이 있는 라우팅 테이블에 설치될 필요는 없지만 구현에서는 패킷이 BGP 경로를 따라 전달되기 전에 연관된 NEXT\_HOP 주소가 다음으로 확인되도록 주의해야 합니다. 즉시\(직접 연결된\) 다음 홉 주소이며, 이 주소\(또는 여러 주소\)가 최종적으로 실제 패킷 전달에 사용됩니다.

해결 불가능한 경로는 Loc-RIB 및 라우팅 테이블에서 제거되어야 합니다. 그러나 해결 불가능한 해당 경로는 Adj-RIBs-In에 보관되어야 합니다\(해결 가능한 경우에 대비\).

---
##### **9.1.2.1.  Route Resolvability Condition**

섹션 9.1.2에 표시된 대로 BGP 스피커는 2단계 결정에서 확인할 수 없는 경로를 제외해야 합니다. 이렇게 하면 Loc-RIB 및 라우팅 테이블에 유효한 경로만 설치됩니다.

경로 해석 가능성 조건은 다음과 같이 정의됩니다.

- 1\) 중간 네트워크 주소만 참조하는 경로 Rte1은 라우팅 테이블에 Rte1의 중간 네트워크 주소와 일치하는 확인 가능한 경로 Rte2가 하나 이상 포함되어 있고 Rte1을 통해 반복적으로\(직접 또는 간접적으로\) 확인되지 않는 경우 확인 가능한 것으로 간주됩니다. 일치하는 경로가 여러 개 있는 경우 일치하는 가장 긴 경로만 고려해야 합니다.

- 2\) 인터페이스\(중간 주소 유무에 관계없이\)를 참조하는 경로는 참조된 인터페이스의 상태가 작동 중이고 이 인터페이스에서 IP 처리가 활성화된 경우 확인 가능한 것으로 간주됩니다.

BGP 경로는 인터페이스를 참조하지 않지만 두 가지 유형\(인터페이스를 지정하는 유형 또는 지정하지 않는 유형\)일 수 있는 라우팅 테이블의 경로를 통해 확인할 수 있습니다. IGP 경로와 직접 연결된 네트워크에 대한 경로는 아웃바운드 인터페이스를 지정해야 합니다. 정적 경로는 아웃바운드 인터페이스, 중간 주소 또는 둘 다를 지정할 수 있습니다.

BGP 스피커의 라우팅 테이블에 BGP 경로의 NEXT\_HOP과 일치하는 경로가 없는 상황에서는 BGP 경로를 확인할 수 없는 것으로 간주됩니다. 상호 재귀 경로\(서로 또는 자체적으로 확인되는 경로\)도 확인 가능성 검사에 실패합니다.

또한 라우팅 테이블의 현재 내용을 사용하여 NEXT\_HOP을 확인할 수 있더라도 라우팅 테이블에 설치된 경우 확인할 수 없는 실행 가능한 경로를 구현에서 고려하지 않는 것도 중요합니다\(이러한 경로의 예\).

상호 재귀 경로가 됩니다\). 이 검사를 통해 BGP 스피커는 제거되어 스피커에서 사용되지 않는 라우팅 테이블에 경로를 설치하지 않도록 합니다. 따라서 이 검사는 로컬 라우팅 테이블 안정성 외에도 네트워크의 프로토콜 동작도 개선합니다.

BGP 스피커가 상호 재귀로 인해 해결 가능성 검사에 실패한 경로를 식별할 때마다 오류 메시지가 기록되어야 합니다.

---
##### **9.1.2.2.  Breaking Ties (Phase 2)**

Adj-RIBs-In에서 BGP 스피커는 동일한 선호도를 가진 동일한 대상에 대한 여러 경로를 가질 수 있습니다. 로컬 스피커는 연결된 Loc-RIB에 포함하기 위해 이러한 경로 중 하나만 선택할 수 있습니다. 로컬 스피커는 내부 피어로부터 수신된 경로와 외부 피어로부터 수신된 경로 모두 동일한 선호도를 가진 모든 경로를 고려합니다.

다음 타이 브레이킹 절차에서는 각 후보 경로에 대해 자율 시스템 내의 모든 BGP 스피커가 경로의 NEXT\_HOP 속성에 표시된 주소에 대한 경로 비용\(내부 거리\)을 확인하고 동일한 경로를 따를 수 있다고 가정합니다. 선택 알고리즘.

타이 브레이킹 알고리즘은 동일한 대상에 대해 동일하게 선호되는 모든 경로를 고려한 다음 고려 사항에서 제거할 경로를 선택하는 것으로 시작됩니다. 고려 중인 경로가 하나만 남으면 즉시 알고리즘이 종료됩니다. 기준은 지정된 순서대로 적용되어야 합니다.

몇 가지 기준은 의사 코드를 사용하여 설명됩니다. 표시된 의사 코드는 효율성이 아닌 명확성을 위해 선택되었습니다. 특정 구현을 지정하려는 의도는 없습니다. BGP 구현은 여기에 설명된 것과 동일한 결과를 생성하는 모든 알고리즘을 사용할 수 있습니다.

- a\) AS\_PATH 속성에 존재하는 AS 번호 수가 가장 적기 때문에 연결되지 않은 모든 경로를 고려 대상에서 제거합니다. 이 숫자를 계산할 때 AS\_SET은 세트에 AS가 몇 개 있든 상관없이 1로 계산됩니다.

- b\) 출발지 속성에서 가장 낮은 출발지 번호를 갖는 것으로 연결되지 않은 모든 경로를 고려 대상에서 제거합니다.

- c\) 덜 선호되는 MULTI\_EXIT\_DISC 속성이 있는 고려 경로에서 제거합니다. MULTI\_EXIT\_DISC는 동일한 인접 AS에서 학습된 경로 간에만 비교할 수 있습니다\(인접 AS는 AS\_PATH 속성에서 결정됨\). MULTI\_EXIT\_DISC 속성이 없는 경로는 가능한 가장 낮은 MULTI\_EXIT\_DISC 값을 갖는 것으로 간주됩니다.

- 이는 다음 절차에서도 설명됩니다.

```text
       for m = all routes still under consideration
           for n = all routes still under consideration
               if (neighborAS(m) == neighborAS(n)) and (MED(n) < MED(m))
                   remove route m from consideration
```

- 위의 의사 코드에서 MED\(n\)은 경로 n의 MULTI\_EXIT\_DISC 속성 값을 반환하는 함수입니다. 경로 n에 MULTI\_EXIT\_DISC 속성이 없으면 함수는 가능한 가장 낮은 MULTI\_EXIT\_DISC 값\(예: 0\)을 반환합니다.

- 마찬가지로 neighborAS\(n\)은 경로를 수신한 Neighbor AS를 반환하는 함수입니다. 경로가 IBGP를 통해 학습되고 다른 IBGP 스피커가 경로를 시작하지 않은 경우 다른 IBGP 스피커가 경로를 학습한 것은 이웃 AS입니다. 경로가 IBGP를 통해 학습되고 다른 IBGP 스피커가 \(a\) 경로를 시작했거나 \(b\) 집계로 경로를 생성했으며 집계 경로의 AS\_PATH 속성이 비어 있거나 AS\_SET로 시작하는 경우 로컬 AS.

- 경로를 IBGP로 다시 광고하기 전에 MULTI\_EXIT\_DISC 속성이 제거된 경우 수신된 EBGP MULTI\_EXIT\_DISC 속성을 기반으로 한 비교가 계속 수행될 수 있습니다. 구현이 MULTI\_EXIT\_DISC를 제거하기로 선택한 경우 MULTI\_EXIT\_DISC에 대한 선택적 비교가 수행되는 경우 EBGP 학습 경로 중에서만 수행되어야 합니다. MULTI\_EXIT\_DISC 속성을 제거한 후 최상의 EBGP 학습 경로를 IBGP 학습 경로와 비교할 수 있습니다. MULTI\_EXIT\_DISC가 EBGP 학습 경로의 하위 집합에서 제거되고 선택된 "최상의" EBGP 학습 경로에서 MULTI\_EXIT\_DISC가 제거되지 않는 경우 IBGP 학습 경로와 비교할 때 MULTI\_EXIT\_DISC를 사용해야 합니다. IBGP 학습 경로의 경우 결정 프로세스의 이 단계에 도달하는 경로 비교에 MULTI\_EXIT\_DISC를 사용해야 합니다. IBGP에서 학습한 경로와 비교할 때 EBGP에서 학습한 경로의 MULTI\_EXIT\_DISC를 포함시킨 다음 MULTI\_EXIT\_DISC 속성을 제거하고 경로를 광고하면 경로 루프가 발생하는 것으로 입증되었습니다.

- d\) 후보 경로 중 하나 이상이 EBGP를 통해 수신된 경우 IBGP를 통해 수신된 모든 경로를 고려 대상에서 제거합니다.

- e\) 선호도가 낮은 인테리어 비용이 포함된 노선은 고려 대상에서 제외됩니다. 경로의 내부 비용은 라우팅 테이블을 사용하여 경로에 대한 NEXT\_HOP에 대한 메트릭을 계산하여 결정됩니다. 경로의 NEXT\_HOP 홉에 도달할 수 있지만 비용을 결정할 수 없는 경우 이 단계를 건너뛰어야 합니다\(동일하게 모든 경로의 비용이 동일하다고 간주\).

- 이에 대해서는 다음 절차에서도 설명합니다.

```text
         for m = all routes still under consideration
             for n = all routes in still under consideration
                 if (cost(n) is lower than cost(m))
                     remove m from consideration
```

- 위 의사 코드에서 cost\(n\)은 경로의 NEXT\_HOP 속성에 지정된 주소까지의 경로 비용\(내부 거리\)을 반환하는 함수입니다.

- f\) BGP 식별자 값이 가장 낮은 BGP 스피커가 광고한 경로 이외의 모든 경로를 고려 대상에서 제거합니다.

- g\) 가장 낮은 Peer 주소로부터 수신된 경로를 선호합니다.

---
#### **9.1.3.  Phase 3: Route Dissemination**

3단계 결정 기능은 2단계가 완료되거나 다음 이벤트 중 하나가 발생할 때 호출됩니다.

- a\) Loc-RIB에서 로컬 목적지까지의 경로가 변경된 경우

- b\) BGP 외부 수단을 통해 학습된 로컬 생성 경로가 변경된 경우

- c\) 새로운 BGP 스피커 연결이 설정된 경우

3단계 기능은 더 이상 수행할 작업이 없을 때 완료되는 별도의 프로세스입니다. 3단계 라우팅 결정 기능은 2단계 결정 기능이 진행되는 동안 실행이 차단됩니다.

Loc-RIB의 모든 경로는 구성된 정책에 따라 Adj-RIBs-Out으로 처리됩니다. 이 정책은 Loc-RIB의 경로가 특정 Adj-RIB-Out에 설치되는 것을 제외할 수 있습니다. 경로는 다음과 같습니다.

이 경로에 의해 설명된 대상 및 NEXT\_HOP이 라우팅 테이블에 의해 적절하게 전달되지 않는 한 Adj-Rib-Out에 설치됩니다. Loc-RIB의 경로가 특정 Adj-RIB-Out에서 제외되는 경우 해당 Adj-RIB-Out에서 이전에 광고된 경로는 UPDATE 메시지\(9.2 참조\)를 통해 서비스에서 철회되어야 합니다.

경로 집합 및 정보 감소 기술\(섹션 9.2.2.1 참조\)이 선택적으로 적용될 수 있습니다.

경로가 로컬 BGP 스피커의 전달 테이블에 추가되지 않고 Adj-RIB-Out에 추가되는 로컬 정책은 이 문서의 범위를 벗어납니다.

Adj-RIBs-Out 및 라우팅 테이블의 업데이트가 완료되면 로컬 BGP 스피커는 9.2의 업데이트-전송 프로세스를 실행합니다.

---
#### **9.1.4.  Overlapping Routes**

BGP 스피커는 NLRI\(Network Layer Reachability Information\)가 겹치는 경로를 다른 BGP 스피커로 전송할 수 있습니다. NLRI 중복은 일치하지 않는 여러 경로에서 일련의 대상이 식별될 때 발생합니다. BGP는 IP 접두사를 사용하여 NLRI를 인코딩하므로 중복은 항상 하위 집합 관계를 나타냅니다. 더 작은 목적지 집합\(긴 접두사\)을 설명하는 경로는 더 큰 목적지 집합\(더 짧은 접두사\)을 설명하는 경로보다 더 구체적이라고 합니다. 마찬가지로, 더 큰 목적지 세트를 설명하는 경로는 더 작은 목적지 세트를 설명하는 경로보다 덜 구체적이라고 합니다.

우선순위 관계는 덜 구체적인 경로를 두 부분으로 효과적으로 분해합니다.

- 덜 구체적인 경로로만 설명되는 목적지 세트

- 덜 구체적인 경로와 더 구체적인 경로의 중첩으로 설명되는 일련의 목적지

중복으로 설명된 목적지 집합은 실행 가능하지만 현재 사용되지 않는 덜 구체적인 경로의 일부를 나타냅니다. 나중에 더 구체적인 경로가 철회되는 경우 중복으로 설명되는 목적지 집합은 덜 구체적인 경로를 사용하여 계속 도달할 수 있습니다.

BGP 스피커가 중복되는 경로를 수신하는 경우 결정 프로세스에서는 구성된 수락 정책을 기반으로 두 경로를 모두 고려해야 합니다. 더 적은 경로와 더 구체적인 경로가 모두 허용되는 경우 결정 프로세스는 Loc-RIB에 더 적은 경로와 더 구체적인 경로를 모두 설치해야 합니다.

더 구체적인 경로를 사용하거나 두 경로를 집계하고 두 경로 모두 NEXT\_HOP 속성의 동일한 값을 갖는 경우 Loc-RIB에 집계된 경로를 설치합니다.

BGP 스피커가 집계를 선택하는 경우 AS\_SET에 집계를 구성하는 데 사용된 모든 AS를 포함하거나 ATOMIC\_AGGREGATE 속성을 경로에 추가해야 합니다. 이 속성은 이제 주로 정보 제공용입니다. 클래스 없는 라우팅을 지원하지 않는 IP 라우팅 프로토콜을 제거하고 클래스 없는 라우팅을 지원하지 않는 라우터 및 호스트 구현을 제거하면 더 이상 집계를 해제할 필요가 없습니다. 경로는 분리되어서는 안 됩니다. 특히 ATOMIC\_AGGREGATE 속성을 전달하는 경로는 분리되어서는 안 됩니다. 즉, 이 경로의 NLRI는 더 구체적일 수 없습니다. 이러한 경로를 따라 전달한다고 해서 IP 패킷이 실제로 경로의 AS\_PATH 속성에 나열된 AS만 통과한다는 보장은 없습니다.

---
### **9.2.  Update-Send Process**

업데이트-전송 프로세스는 모든 피어에게 업데이트 메시지를 알리는 역할을 담당합니다. 예를 들어, 결정 프로세스에서 선택한 경로를 동일한 자율 시스템이나 이웃 자율 시스템에 위치할 수 있는 다른 BGP 스피커에 배포합니다.

BGP 스피커가 내부 피어로부터 UPDATE 메시지를 수신하면 수신 BGP 스피커는 해당 UPDATE 메시지에 포함된 라우팅 정보를 다른 내부 피어에게 재배포해서는 안 됩니다\(스피커가 BGP 경로 반사기\[RFC2796\]로 작동하지 않는 한\).

경로 선택 프로세스의 3단계의 일부로 BGP 스피커는 Adj-RIBs-Out을 업데이트했습니다. 새로 설치된 모든 경로와 대체 경로가 없는 새로 실행 불가능한 모든 경로는 UPDATE 메시지를 통해 피어에게 광고되어야 합니다.

BGP 스피커는 이전에 광고된 것과 동일한 BGP 경로를 포함하는 UPDATE 메시지를 생성하는 경우 Adj-RIB-Out에서 주어진 실행 가능한 BGP 경로를 광고해서는 안 됩니다.

실행 불가능하다고 표시된 Loc-RIB의 모든 경로는 제거되어야 합니다. 자체 자율 시스템 내에서 도달 가능한 대상에 대한 변경 사항도 UPDATE 메시지로 알려야 합니다.

UPDATE 메시지의 최대 크기 제한\(섹션 4 참조\)으로 인해 단일 경로가 메시지에 맞지 않는 경우 BGP 스피커는 해당 경로를 피어에게 알리지 않아야 하며 로컬에서 오류를 기록하도록 선택할 수 있습니다. .

---
#### **9.2.1.  Controlling Routing Traffic Overhead**

BGP 프로토콜은 UPDATE 메시지를 알리는 데 필요한 링크 대역폭과 UPDATE 메시지에 포함된 정보를 소화하기 위해 의사결정 프로세스에 필요한 처리 능력을 모두 제한하기 위해 라우팅 트래픽\(즉, UPDATE 메시지\)의 양을 제한합니다.

---
##### **9.2.1.1.  Frequency of Route Advertisement**

MinRouteAdvertisementIntervalTimer 매개변수는 BGP 스피커가 피어에게 특정 대상으로의 경로를 광고 및/또는 철회하는 사이에 경과해야 하는 최소 시간을 결정합니다. 이 속도 제한 절차는 대상별로 적용되지만 MinRouteAdvertisementIntervalTimer 값은 BGP 피어별로 설정됩니다.

일부 공통 대상 집합에 대한 실행 가능한 경로 및/또는 실행 불가능한 경로의 철회를 광고하는 피어에게 BGP 스피커가 보낸 두 개의 UPDATE 메시지는 최소한 MinRouteAdvertisementIntervalTimer로 구분되어야 합니다. 이는 각각의 공통 목적지 세트에 대해 별도의 타이머를 유지해야만 달성할 수 있습니다. 이는 부당한 오버헤드입니다. BGP 스피커에서 실행 가능한 경로 및/또는 일부 공통 대상 집합에 대한 실행 불가능한 경로의 철회를 알리는 피어로 전송되는 두 개의 UPDATE 메시지 사이의 간격이 최소한 MinRouteAdvertisementIntervalTimer가 되도록 보장하는 모든 기술은 또한 상수 상위를 보장합니다. 간격에 바인딩된 것이 허용됩니다.

자율 시스템 내에서는 빠른 수렴이 필요하므로 \(a\) 내부 피어에 사용되는 MinRouteAdvertisementIntervalTimer는 외부 피어에 사용되는 MinRouteAdvertisementIntervalTimer보다 짧아야 하거나 \(b\) 이 섹션에 설명된 절차는 내부 피어에 전송된 경로에 적용되어서는 안 됩니다. .

이 절차는 경로 선택 속도를 제한하지 않고 경로 알림 속도만 제한합니다. MinRouteAdvertisementIntervalTimer의 만료를 기다리는 동안 새 경로가 여러 번 선택되면 마지막으로 선택한 경로가 MinRouteAdvertisementIntervalTimer 끝에 광고됩니다.

---
##### **9.2.1.2.  Frequency of Route Origination**

MinASOriginationIntervalTimer 매개변수는 광고 BGP 스피커의 자체 자율 시스템 내에서 변경 사항을 보고하는 UPDATE 메시지의 연속 광고 사이에 경과해야 하는 최소 시간을 결정합니다.

---
#### **9.2.2.  Efficient Organization of Routing Information**

광고할 라우팅 정보를 선택한 후 BGP 스피커는 이 정보를 효율적인 방식으로 구성하기 위해 여러 가지 방법을 사용할 수 있습니다.

---
##### **9.2.2.1.  Information Reduction**

정보 감소는 정책 제어의 세분성 감소를 의미할 수 있습니다. 정보가 축소된 후에는 동일한 정책이 동등 클래스의 모든 대상 및 경로에 적용됩니다.

결정 프로세스는 다음 방법 중 하나를 사용하여 Adj-RIBs-Out에 배치할 정보의 양을 선택적으로 줄일 수 있습니다.

```text
      a) Network Layer Reachability Information (NLRI):
```

- 대상 IP 주소는 IP 주소 접두사로 표시될 수 있습니다. 주소 구조와 자율 시스템 관리자가 제어하는 ​​시스템 사이에 대응이 있는 경우 UPDATE 메시지에 포함된 NLRI의 크기를 줄이는 것이 가능합니다.

```text
      b) AS_PATHs:
```

- AS 경로 정보는 순서가 있는 AS\_SEQUENCE 또는 순서가 없는 AS\_SET으로 표현될 수 있습니다. AS\_SET은 섹션 9.2.2.2에 설명된 경로 집합 알고리즘에 사용됩니다. 집계된 여러 AS\_PATH에 나타나는 횟수에 관계없이 각 AS 번호를 한 번만 나열하여 AS\_PATH 정보의 크기를 줄입니다.

- AS\_SET은 NLRI에 나열된 목적지가 구성 자율 시스템 중 적어도 일부를 통과하는 경로를 통해 도달할 수 있음을 의미합니다. AS\_SET은 라우팅 정보 루프를 방지하는 데 충분한 정보를 제공합니다. 그러나 이러한 경로는 더 이상 AS\_SEQUENCE 형식으로 개별적으로 나열되지 않으므로 이를 사용하면 잠재적으로 실행 가능한 경로가 정리될 수 있습니다. 실제로 IP 패킷이 자율 시스템 그룹의 가장자리에 도착하면 BGP 스피커가 더 자세한 경로 정보를 갖고 개별 경로를 대상과 구별할 수 있기 때문에 이는 문제가 될 가능성이 없습니다.

---
##### **9.2.2.2.  Aggregating Routing Information**

집계는 단일 경로를 알릴 수 있는 방식으로 여러 다른 경로의 특성을 결합하는 프로세스입니다. Adj-RIBs-Out에 배치될 라우팅 정보의 양을 줄이기 위해 결정 프로세스의 일부로 집계가 발생할 수 있습니다.

집계는 BGP 스피커가 저장하고 다른 BGP 스피커와 교환해야 하는 정보의 양을 줄입니다. 동일한 유형의 경로 속성과 네트워크 계층 연결 정보에 대해 다음 절차를 별도로 적용하여 경로를 집계할 수 있습니다.

다양한 MULTI\_EXIT\_DISC 속성을 가진 경로는 집계되지 않습니다.

집계된 경로에 AS\_PATH 속성의 첫 번째 요소로 AS\_SET이 있는 경우 경로를 시작하는 라우터는 이 경로로 MULTI\_EXIT\_DISC 속성을 광고해서는 안 됩니다.

유형 코드가 다른 경로 속성은 함께 집계될 수 없습니다. 동일한 유형 코드의 경로 속성은 다음 규칙에 따라 집계될 수 있습니다.

- NEXT\_HOP: 서로 다른 NEXT\_HOP 속성을 가진 경로를 집계할 때 집계된 경로의 NEXT\_HOP 속성은 집계를 수행하는 BGP 스피커의 인터페이스를 식별해야 합니다.

- ORIGIN 속성: 집계된 경로 중 하나 이상의 경로에 INCOMPLETE 값이 있는 ORIGIN이 있는 경우 집계된 경로에는 INCOMPLETE 값이 있는 ORIGIN 속성이 있어야 합니다. 그렇지 않고, 집계된 경로 중 하나 이상의 경로에 EGP 값이 있는 ORIGIN이 있는 경우 집계된 경로에는 EGP 값이 있는 ORIGIN 속성이 있어야 합니다. 다른 모든 경우에는 집계된 경로의 ORIGIN 속성 값이 IGP입니다.

- AS\_PATH 속성: 집계할 경로에 동일한 AS\_PATH 속성이 있는 경우 집계된 경로는 각 개별 경로와 동일한 AS\_PATH 속성을 갖습니다.

- AS\_PATH 속성을 집계하기 위해 AS\_PATH 속성 내의 각 AS를 튜플 <type, value\>로 모델링합니다. 여기서 "type"은 AS 경로 세그먼트의 유형을 식별합니다.

- \(예: AS\_SEQUENCE, AS\_SET\)에 속하며 "값"은 AS 번호를 식별합니다. 집계될 경로에 서로 다른 AS\_PATH 속성이 있는 경우 집계된 AS\_PATH 속성은 다음 조건을 모두 충족해야 합니다.

```text
           - all tuples of type AS_SEQUENCE in the aggregated AS_PATH
             SHALL appear in all of the AS_PATHs in the initial set of
             routes to be aggregated.

           - all tuples of type AS_SET in the aggregated AS_PATH SHALL
             appear in at least one of the AS_PATHs in the initial set
             (they may appear as either AS_SET or AS_SEQUENCE types).

           - for any tuple X of type AS_SEQUENCE in the aggregated
             AS_PATH, which precedes tuple Y in the aggregated AS_PATH,
             X precedes Y in each AS_PATH in the initial set, which
             contains Y, regardless of the type of Y.

           - No tuple of type AS_SET with the same value SHALL appear
             more than once in the aggregated AS_PATH.

           - Multiple tuples of type AS_SEQUENCE with the same value may
             appear in the aggregated AS_PATH only when adjacent to
             another tuple of the same type and value.
```

- 구현에서는 이러한 규칙을 준수하는 알고리즘을 선택할 수 있습니다. 최소한, 적합한 구현은 위의 모든 조건을 충족하는 다음 알고리즘을 수행할 수 있어야 합니다.

```text
           - determine the longest leading sequence of tuples (as
             defined above) common to all the AS_PATH attributes of the
             routes to be aggregated.  Make this sequence the leading
             sequence of the aggregated AS_PATH attribute.

           - set the type of the rest of the tuples from the AS_PATH
             attributes of the routes to be aggregated to AS_SET, and
             append them to the aggregated AS_PATH attribute.

           - if the aggregated AS_PATH has more than one tuple with the
             same value (regardless of tuple's type), eliminate all but
             one such tuple by deleting tuples of the type AS_SET from
             the aggregated AS_PATH attribute.

           - for each pair of adjacent tuples in the aggregated AS_PATH,
             if both tuples have the same type, merge them together, as
             long as doing so will not cause a segment with a length
             greater than 255 to be generated.
```

- 부록 F, 섹션 F.6에서는 조건을 충족하고 보다 복잡한 정책 구성을 허용하는 또 다른 알고리즘을 제시합니다.

- ATOMIC\_AGGREGATE: 집계할 경로 중 최소한 하나가 ATOMIC\_AGGREGATE 경로 속성을 갖는 경우 집계된 경로도 이 속성을 가져야 합니다.

- AGGREGATOR: 집계될 경로의 모든 AGGREGATOR 속성은 집계된 경로에 포함되어서는 안 됩니다. 경로 집계를 수행하는 BGP 스피커는 새로운 AGGREGATOR 속성을 첨부할 수 있습니다\(섹션 5.1.7 참조\).

---
### **9.3.  Route Selection Criteria**

일반적으로 여러 대안 간의 경로를 비교하기 위한 추가 규칙은 이 문서의 범위를 벗어납니다. 두 가지 예외가 있습니다.

- 고려 중인 새 경로의 AS 경로에 로컬 AS가 나타나면 해당 새 경로는 다른 경로보다 더 나은 것으로 볼 수 없습니다\(스피커가 이러한 경로를 허용하도록 구성되어 있는 경우\). 이러한 경로가 사용된 경우 라우팅 루프가 발생할 수 있습니다.

- 성공적인 분산 운영을 위해서는 안정성이 확보된 경로만 선택할 수 있습니다. 따라서 AS는 불안정한 경로 사용을 피해야 하며 경로 선택을 신속하고 자발적으로 변경해서는 안 됩니다. "불안정한" 및 "빠른"이라는 용어\(이전 문장에서\)를 정량화하려면 경험이 필요하지만 원칙은 분명합니다. 불안정한 경로는 "페널티"를 받을 수 있습니다\(예: \[RFC2439\]에 설명된 절차를 사용하여\).

---
### **9.4.  Originating BGP routes**

BGP 스피커는 다른 수단\(예: IGP를 통해\)으로 획득한 라우팅 정보를 BGP에 주입하여 BGP 경로를 시작할 수 있습니다. BGP 경로를 시작하는 BGP 스피커는 결정 프로세스\(섹션 9.1 참조\)를 통해 이러한 경로에 선호도\(예: 로컬 구성에 따라\)를 할당합니다. 이러한 경로는 업데이트 프로세스의 일부로 로컬 AS 내의 다른 BGP 스피커에도 배포될 수 있습니다\(섹션 9.2 참조\). BGP를 통해 AS 내에서 BGP가 아닌 획득 경로를 배포할지 여부에 대한 결정은 AS 내 환경\(예: IGP 유형\)에 따라 다르며 구성을 통해 제어되어야 합니다.

---
## **10.  BGP Timers**

BGP는 ConnectRetryTimer\(섹션 8 참조\), HoldTimer\(섹션 4.2 참조\), KeepaliveTimer\(섹션 8 참조\), MinASOriginationIntervalTimer\(섹션 9.2.1.2 참조\) 및 MinRouteAdvertisementIntervalTimer\(섹션 9.2.1.1 참조\)의 다섯 가지 타이머를 사용합니다.

두 개의 선택적 타이머가 지원될 수 있습니다: DelayOpenTimer, BGP에 의한 IdleHoldTimer\(섹션 8 참조\). 섹션 8에서는 그 사용법을 설명합니다. 이러한 선택적 타이머의 전체 작동은 이 문서의 범위를 벗어납니다.

ConnectRetryTime은 ConnectRetryTimer의 초기 값을 저장하는 필수 FSM 속성입니다. ConnectRetryTime에 대해 제안된 기본값은 120초입니다.

HoldTime은 HoldTimer의 초기 값을 저장하는 필수 FSM 속성입니다. HoldTime에 대해 제안된 기본값은 90초입니다.

상태 기계의 일부 부분\(섹션 8 참조\) 동안 HoldTimer는 큰 값으로 설정됩니다. 이 큰 값에 대해 제안되는 기본값은 4분입니다.

KeepaliveTime은 KeepaliveTimer의 초기 값을 저장하는 필수 FSM 속성입니다. KeepaliveTime에 대해 제안된 기본값은 HoldTime의 1/3입니다.

MinASOriginationIntervalTimer에 대해 제안된 기본값은 15초입니다.

EBGP 연결에서 MinRouteAdvertisementIntervalTimer에 대해 제안되는 기본값은 30초입니다.

IBGP 연결에서 MinRouteAdvertisementIntervalTimer에 대해 제안되는 기본값은 5초입니다.

BGP의 구현은 HoldTimer가 피어별로 구성 가능하도록 허용해야 하며\(MUST\) 다른 타이머도 구성 가능하도록 허용할 수 있습니다\(MAY\).

지정된 BGP 스피커에 의한 BGP 메시지 배포에 피크가 포함될 가능성을 최소화하려면 MinASOriginationIntervalTimer, KeepaliveTimer, MinRouteAdvertisementIntervalTimer 및 ConnectRetryTimer와 관련된 타이머에 지터를 적용해야 합니다. 특정 BGP 스피커는 업데이트가 전송되는 대상에 관계없이 이러한 수량 각각에 동일한 지터를 적용할 수 있습니다. 즉, 피어별로 지터를 구성할 필요가 없습니다.

제안된 기본 지터 양은 적절한 타이머의 기본 값에 0.75에서 1.0 범위에 균일하게 분포된 무작위 요소를 곱하여 결정됩니다. 타이머가 설정될 때마다 새로운 무작위 값을 선택해야 합니다. 지터의 무작위 값 범위는 구성 가능합니다.

---
# **Appendix A.  Comparison with RFC 1771**

\[RFC1771\]과 비교하여 수많은 편집 변경 사항이 있습니다\(여기에 나열하기에는 너무 많습니다\).

다음은 기술적인 변경 사항을 나열한 것입니다.

- TCP MD5 \[RFC2385\], BGP Route Reflectors \[RFC2796\], BGP Confederations \[RFC3065\], BGP Route Refresh \[RFC2918\] 등의 기능 사용을 반영하도록 변경되었습니다.

- AGGREGATOR 속성에서 BGP 식별자 사용을 명확히 했습니다.

- BGP 스피커가 피어로부터 수락할 접두사 수에 상한을 적용하는 절차입니다.

- AS 간 트래픽 엔지니어링을 위해 AS\_PATH 속성에 자체 AS 인스턴스를 두 개 이상 포함하는 BGP 스피커의 기능입니다.

- NEXT\_HOP의 다양한 유형을 명확하게 설명합니다.

- ATOMIC\_AGGREGATE 속성의 사용을 명확히 했습니다.

- NEXT\_HOP 경로 속성에 지정된 대로 바로 다음 홉과 다음 홉 간의 관계입니다.

- 동점 결정 절차를 명확히 합니다.

- 경로 광고 빈도를 명확히 합니다.

- 선택적 매개변수 유형 1\(인증 정보\)은 더 이상 사용되지 않습니다.

- 업데이트 메시지 오류 하위 코드 7\(AS 라우팅 루프\)이 더 이상 사용되지 않습니다.

- OPEN 메시지 오류 하위 코드 5\(인증 실패\)가 더 이상 사용되지 않습니다.

- 인증을 위한 마커 필드 사용이 더 이상 사용되지 않습니다.

- 구현은 인증을 위해 TCP MD5 \[RFC2385\]를 지원해야 합니다.

- BGP FSM의 설명.

---
# **Appendix B.  Comparison with RFC 1267**

부록 A에 나열된 모든 변경 사항과 다음 사항.

BGP-4는 도달 가능한 대상 집합이 단일 IP 접두사를 통해 표현될 수 있는 환경에서 작동할 수 있습니다. 네트워크 클래스 또는 서브넷 개념은 BGP-4와는 다릅니다. 이러한 기능을 수용하기 위해 BGP-4는 AS\_PATH 속성과 관련된 의미 및 인코딩을 변경합니다. IP 접두사와 관련된 의미를 정의하기 위해 새로운 텍스트가 추가되었습니다. 이러한 기능을 통해 BGP-4는 제안된 슈퍼네팅 체계\[RFC1518, RFC1519\]를 지원할 수 있습니다.

구성을 단순화하기 위해 이 버전에는 경로 선택 절차를 용이하게 하는 새로운 속성 LOCAL\_PREF가 도입되었습니다.

INTER\_AS\_METRIC 속성의 이름이 MULTI\_EXIT\_DISC로 변경되었습니다.

특정 집계가 분리되지 않도록 하기 위해 새로운 속성인 ATOMIC\_AGGREGATE가 도입되었습니다. 또 다른 새로운 속성인 AGGREGATOR를 집계 경로에 추가하여 어떤 AS와 해당 AS 내의 어떤 BGP 스피커가 집계를 발생시켰는지 알릴 수 있습니다.

보류 타이머가 대칭이 되도록 하기 위해 이제 보류 타이머는 연결별로 협상됩니다. 이제 0의 보류 타이머가 지원됩니다.

---
# **Appendix C.  Comparison with RFC 1163**

부록 A 및 B에 나열된 모든 변경 사항과 다음 사항.

BGP 연결 충돌을 감지하고 복구하기 위해 OPEN 메시지에 새로운 필드\(BGP 식별자\)가 추가되었습니다. 충돌을 감지하고 복구하는 절차를 지정하기 위해 새로운 텍스트\(6.8절\)가 추가되었습니다.

새 문서에서는 더 이상 NEXT\_HOP 경로 속성에 전달되는 라우터가 BGP 스피커와 동일한 자치 시스템의 일부가 되도록 제한하지 않습니다.

새 문서는 이전에 도달할 수 있었던 경로에 대한 정보 교환을 최적화하고 단순화합니다.

---
# **Appendix D.  Comparison with RFC 1105**

부록 A, B, C에 나열된 모든 변경 사항과 다음 사항.

BSD 버전 4.3에서 제공하는 TCP 사용자 인터페이스를 수용하려면 \[RFC1105\] Finite State Machine에 대한 사소한 변경이 필요했습니다.

RFC 1105에 제시된 Up/Down/Horizontal 관계 개념이 프로토콜에서 제거되었습니다.

RFC 1105의 메시지 형식 변경 사항은 다음과 같습니다.

1. Hold Time 필드가 BGP 헤더에서 제거되고 OPEN 메시지에 추가되었습니다.

1. 버전 필드가 BGP 헤더에서 제거되고 OPEN 메시지에 추가되었습니다.

1. OPEN 메시지에서 Link Type 필드가 제거되었습니다.

1. OPEN CONFIRM 메시지가 제거되고 KEEPALIVE 메시지가 제공하는 암시적 확인으로 대체되었습니다.

1. UPDATE 메시지의 형식이 크게 변경되었습니다. 여러 경로 속성을 지원하기 위해 UPDATE 메시지에 새 필드가 추가되었습니다.

1. 마커\(Marker\) 필드가 확장되어 인증 지원을 위한 역할이 확대되었습니다.

RFC 1105에 지정된 대로 BGP는 BGP-1로 참조되는 경우가 많습니다. \[RFC1163\]에 지정된 BGP는 BGP-2라고 합니다. RFC 1267에 지정된 BGP는 BGP-3이라고 합니다. 이 문서에서는 BGP를 BGP-4라고 합니다.

---
# **Appendix E.  TCP Options that May Be Used with BGP**

로컬 시스템 TCP 사용자 인터페이스가 TCP PUSH 기능을 지원하는 경우 각 BGP 메시지는 PUSH 플래그가 설정된 상태로 전송되어야 합니다. PUSH 플래그를 설정하면 BGP 메시지가 수신자에게 즉시 전송됩니다.

로컬 시스템 TCP 사용자 인터페이스가 TCP 연결을 위한 DSCP 필드\[RFC2474\] 설정을 지원하는 경우 BGP에서 사용하는 TCP 연결은 DSCP 필드의 비트 0-2를 110\(이진\)으로 설정하여 열어야 합니다.

구현은 TCP MD5 옵션 \[RFC2385\]을 지원해야 합니다.

---
# **Appendix F.  Implementation Recommendations**

이 섹션에서는 몇 가지 구현 권장 사항을 제시합니다.

---
# **Appendix F.1.  Multiple Networks Per Message**

BGP 프로토콜을 사용하면 동일한 경로 속성을 가진 여러 주소 접두사를 하나의 메시지에 지정할 수 있습니다. 이 기능을 사용하는 것이 좋습니다. 메시지당 하나의 주소 접두어를 사용하면 수신자의 오버헤드가 상당히 증가합니다. 여러 메시지 수신으로 인해 시스템 오버헤드가 증가할 뿐만 아니라 BGP 피어 및 기타 라우팅 프로토콜에 대한 업데이트를 위해 라우팅 테이블을 검색하고 관련 메시지를 보내는 오버헤드도 여러 번 발생합니다.

경로별 속성 집합 기반으로 구성되지 않은 라우팅 테이블에서 경로 속성 집합별로 많은 주소 접두사를 포함하는 메시지를 작성하는 한 가지 방법은 라우팅 테이블을 검색할 때 많은 메시지를 작성하는 것입니다. 각 주소 접두사가 처리될 때 연관된 경로 속성 세트에 대한 메시지가 할당되고\(존재하지 않는 경우\) 새 주소 접두사가 추가됩니다. 그러한 메시지가 있으면 새 주소 접두사가 추가됩니다. 메시지에 새 주소 접두사를 저장할 공간이 부족한 경우 메시지가 전송되고 새 메시지가 할당되며 새 주소 접두사가 새 메시지에 삽입됩니다. 전체 라우팅 테이블이 검색되면 할당된 모든 메시지가 전송되고 해당 리소스가 해제됩니다. 주소 접두사가 포함된 모든 대상이 공통 경로 속성 세트를 공유할 때 최대 압축이 달성되어 하나의 4096바이트 메시지에 많은 주소 접두사를 보낼 수 있습니다.

여러 주소 접두사를 하나의 메시지로 압축하지 않는 BGP 구현과 피어링하는 경우 피어를 획득하거나 중요한 네트워크 토폴로지가 변경될 때 수신되는 데이터의 홍수로 인한 오버헤드를 줄이기 위한 조치를 취해야 할 수 있습니다. 이를 수행하는 한 가지 방법은 업데이트 속도를 제한하는 것입니다. 이렇게 하면 BGP 피어 및 기타 라우팅 프로토콜에 대한 플래시 업데이트를 제공하기 위해 라우팅 테이블의 중복 검색이 제거됩니다. 이 접근 방식의 단점은 라우팅 정보의 전파 대기 시간이 증가한다는 것입니다. 여러 메시지를 처리하는 데 걸리는 시간보다 훨씬 크지 않은 최소 플래시 업데이트 간격을 선택하면 이 대기 시간이 최소화됩니다. 더 나은 방법은 업데이트를 보내기 전에 수신된 모든 메시지를 읽는 것입니다.

---
# **Appendix F.2.  Reducing Route Flapping**

과도한 경로 플래핑을 방지하려면 대상을 철회하고 보다 구체적이거나 덜 구체적인 경로에 대한 업데이트를 보내야 하는 BGP 스피커는 이를 동일한 UPDATE 메시지로 결합해야 합니다.

---
# **Appendix F.3.  Path Attribute Ordering**

업데이트 메시지를 결합하는 구현\(위의 섹션 6.1에서 설명\)은 알려진 순서로 표시된 모든 경로 속성을 보는 것을 선호할 수 있습니다. 이를 통해 의미상 동일한 다양한 업데이트 메시지의 속성 세트를 신속하게 식별할 수 있습니다. 이를 용이하게 하기 위해 유형 코드에 따라 경로 속성의 순서를 지정하는 것이 유용한 최적화입니다. 이 최적화는 전적으로 선택 사항입니다.

---
# **Appendix F.4.  AS_SET Sorting**

이 상황을 단순화하기 위해 수행할 수 있는 또 다른 유용한 최적화는 AS\_SET에 있는 AS 번호를 정렬하는 것입니다. 이 최적화는 전적으로 선택 사항입니다.

---
# **Appendix F.5.  Control Over Version Negotiation**

BGP-4는 BGP-3에서 적절하게 표현할 수 없는 집계된 경로를 전달할 수 있기 때문에 BGP-4 및 다른 BGP 버전을 지원하는 구현에서는 피어별로 BGP-4만 말할 수 있는 기능을 제공해야 합니다.

---
# **Appendix F.6.  Complex AS_PATH Aggregation**

상당한 양의 경로 정보를 유지하는 경로 집계 알고리즘을 제공하기로 선택한 구현에서는 다음 절차를 사용할 수 있습니다.

- 두 경로의 AS\_PATH 속성을 집계하기 위해 각 AS를 튜플 <type, value\>로 모델링합니다. 여기서 "type"은 AS가 속한 경로 세그먼트의 유형\(예: AS\_SEQUENCE, AS\_SET\)을 식별하고 " 값"은 AS 번호입니다. 해당 <type, value\> 튜플이 동일한 경우 두 AS는 동일하다고 합니다.

- 두 개의 AS\_PATH 속성을 집계하는 알고리즘은 다음과 같이 작동합니다.

```text
         a) Identify the same ASes (as defined above) within each
            AS_PATH attribute that are in the same relative order within
            both AS_PATH attributes.  Two ASes, X and Y, are said to be
            in the same order if either:

              - X precedes Y in both AS_PATH attributes, or
              - Y precedes X in both AS_PATH attributes.

         b) The aggregated AS_PATH attribute consists of ASes identified
            in (a), in exactly the same order as they appear in the
            AS_PATH attributes to be aggregated.  If two consecutive
            ASes identified in (a) do not immediately follow each other
            in both of the AS_PATH attributes to be aggregated, then the
            intervening ASes (ASes that are between the two consecutive
            ASes that are the same) in both attributes are combined into
            an AS_SET path segment that consists of the intervening ASes
            from both AS_PATH attributes.  This segment is then placed
            between the two consecutive ASes identified in (a) of the
            aggregated attribute.  If two consecutive ASes identified in
            (a) immediately follow each other in one attribute, but do
            not follow in another, then the intervening ASes of the
            latter are combined into an AS_SET path segment.  This
            segment is then placed between the two consecutive ASes
            identified in (a) of the aggregated attribute.

         c) For each pair of adjacent tuples in the aggregated AS_PATH,
            if both tuples have the same type, merge them together if
            doing so will not cause a segment of a length greater than
            255 to be generated.
```

- 위 절차의 결과로 특정 AS 번호가 집계된 AS\_PATH 속성 내에 두 번 이상 나타나는 경우 해당 AS 번호의 마지막 인스턴스\(가장 오른쪽 항목\)를 제외한 모든 항목을 집계된 AS\_PATH 속성에서 제거해야 합니다.

---
# **Security Considerations**

BGP 구현은 RFC 2385 \[RFC2385\]에 지정된 인증 메커니즘을 지원해야 합니다. 이 메커니즘이 제공하는 인증은 피어별로 수행될 수 있습니다.

BGP는 피어 라우터 간의 트래픽을 안정적으로 전송하기 위해 TCP를 사용합니다. 연결 지향 무결성 및 데이터 원본 인증을 지점 간 기반으로 제공하기 위해 BGP는 RFC 2385에 정의된 메커니즘의 사용을 지정합니다. 이러한 서비스는 라우터 간 TCP 연결에 대한 활성 도청 공격을 탐지하고 거부하기 위한 것입니다. 이러한 보안 서비스에 영향을 미치는 메커니즘을 사용하지 않으면 공격자는 이러한 TCP 연결을 중단하거나 합법적인 피어 라우터로 가장할 수 있습니다. RFC에 정의된 메커니즘은 피어 엔터티 인증을 제공하지 않기 때문에 이러한 연결은 TCP 계층에서 감지되지 않는 일부 형태의 재생 공격을 받을 수 있습니다. 이러한 공격으로 인해 TCP에서 "깨진" 또는 "스푸핑된" BGP 메시지가 전달될 수 있습니다.

RFC 2385에 정의된 메커니즘은 TCP 체크섬과 동일한 데이터에 대해 계산되는 16바이트 MAC\(메시지 인증 코드\)로 일반 TCP 체크섬을 확장합니다. 이 MAC는 단방향 해시 함수\(MD5\)와 비밀 키 사용을 기반으로 합니다. 키는 피어 라우터 간에 공유되며 키에 액세스할 수 없는 공격자가 쉽게 계산할 수 없는 MAC 값을 생성하는 데 사용됩니다. 규정을 준수하는 구현은 이 메커니즘을 지원해야 하며 네트워크 관리자가 피어별로 이를 활성화할 수 있도록 허용해야 합니다.

RFC 2385는 MAC 계산에 사용되는 키를 관리하는 방법\(예: 생성, 배포 및 교체\)을 지정하지 않습니다. RFC 3562 \[RFC3562\]\(정보 문서\)는 이 영역에 대한 몇 가지 지침을 제공하고 이 지침을 뒷받침하는 근거를 제공합니다. 보호되는 각 피어와의 통신에는 고유한 키를 사용해야 합니다. 여러 피어에 동일한 키가 사용되는 경우, 예를 들어 한 라우터에서 다른 라우터에 부정적인 영향을 미치는 손상 위험이 증가하여 제공되는 보안 서비스가 저하될 수 있습니다.

MAC 계산에 사용되는 키는 키 손상이나 성공적인 암호 분석 공격의 영향을 최소화하기 위해 주기적으로 변경되어야 합니다. RFC 3562에서는 최대 90일의 암호화 기간\(키가 사용되는 간격\)을 제안합니다. 키를 더 자주 변경하면 위에서 설명한 대로 재생 공격이 발생할 가능성이 줄어듭니다. 그러나 피어 간에 조정된 방식으로 이러한 변경을 적용하기 위한 표준 메커니즘이 없으면 이 RFC를 준수하는 BGP-4 구현이 빈번한 주요 변경을 지원할 것이라고 가정할 수 없습니다.

당연히 각 키는 공격자가 추측하기 어렵게 선택되어야 합니다. 난수 생성을 위해 RFC 1750에 지정된 기술은 키로 사용할 수 있는 값 생성에 대한 지침을 제공합니다. RFC 2385에서는 "80바이트 이하의 인쇄 가능한 ASCII 문자열로 구성된" 키를 지원하는 구현을 요구합니다. RFC 3562에서는 이 컨텍스트에서 사용되는 키가 12\~24바이트의 무작위\(의사 무작위\) 비트일 것을 제안합니다. 이는 일반적으로 16\~20바이트 범위의 키를 사용하는 유사한 MAC 알고리즘에 대한 제안과 상당히 일치합니다. 이 범위의 낮은 끝에서 충분한 임의 비트를 제공하기 위해 RFC 3562는 일반적인 ACSII 텍스트 문자열이 RFC 2385에 지정된 키 길이의 상한에 가까워야 한다는 점도 관찰합니다.

BGP 취약점 분석은 \[RFC4272\]에서 논의됩니다.

---
# **IANA Considerations**

모든 BGP 메시지에는 IANA가 "BGP 메시지 유형"이라는 레지스트리를 생성하고 유지 관리하는 8비트 메시지 유형이 포함되어 있습니다. 이 문서에서는 다음과 같은 메시지 유형을 정의합니다.

```text
         Name             Value       Definition
         ----             -----       ----------
         OPEN             1           See Section 4.2
         UPDATE           2           See Section 4.3
         NOTIFICATION     3           See Section 4.5
         KEEPALIVE        4           See Section 4.4
```

향후 할당은 \[RFC2434\]에 정의된 표준 조치 프로세스 또는 \[RFC4020\]에 정의된 초기 IANA 할당 프로세스를 사용하여 수행됩니다. 할당은 이름과 값으로 구성됩니다.

BGP UPDATE 메시지는 하나 이상의 경로 속성을 전달할 수 있으며, 각 속성에는 8비트 속성 유형 코드가 포함되어 있습니다. IANA는 이미 "BGP 경로 속성"이라는 레지스트리를 유지 관리하고 있습니다. 이 문서는 다음과 같은 경로 속성 유형 코드를 정의합니다.

```text
        Name               Value       Definition
        ----               -----       ----------
        ORIGIN              1          See Section 5.1.1
        AS_PATH             2          See Section 5.1.2
        NEXT_HOP            3          See Section 5.1.3
        MULTI_EXIT_DISC     4          See Section 5.1.4
        LOCAL_PREF          5          See Section 5.1.5
        ATOMIC_AGGREGATE    6          See Section 5.1.6
        AGGREGATOR          7          See Section 5.1.7
```

향후 할당은 \[RFC2434\]에 정의된 표준 조치 프로세스 또는 \[RFC4020\]에 정의된 초기 IANA 할당 프로세스를 사용하여 수행됩니다. 할당은 이름과 값으로 구성됩니다.

BGP NOTIFICATION 메시지에는 8비트 오류 코드가 포함되어 있으며 IANA는 "BGP 오류 코드"라는 레지스트리를 생성하고 유지 관리하고 있습니다. 이 문서에서는 다음 오류 코드를 정의합니다.

```text
         Name                       Value      Definition
         ------------               -----      ----------
         Message Header Error       1          Section 6.1
         OPEN Message Error         2          Section 6.2
         UPDATE Message Error       3          Section 6.3
         Hold Timer Expired         4          Section 6.5
         Finite State Machine Error 5          Section 6.6
         Cease                      6          Section 6.7
```

향후 할당은 \[RFC2434\]에 정의된 표준 조치 프로세스 또는 \[RFC4020\]에 정의된 초기 IANA 할당 프로세스를 사용하여 수행됩니다. 할당은 이름과 값으로 구성됩니다.

BGP NOTIFICATION 메시지는 8비트 오류 하위 코드를 전달합니다. 여기서 각 하위 코드는 특정 오류 코드의 컨텍스트 내에서 정의되어야 하므로 해당 컨텍스트 내에서만 고유해야 합니다.

IANA는 각 BGP 오류 코드에 대한 별도의 레지스트리가 있는 "오류 하위 코드"라는 레지스트리 세트를 생성하고 유지 관리하고 있습니다. 향후 할당은 \[RFC2434\]에 정의된 표준 조치 프로세스 또는 \[RFC4020\]에 정의된 초기 IANA 할당 프로세스를 사용하여 수행됩니다. 할당은 이름과 값으로 구성됩니다.

이 문서는 다음과 같은 메시지 헤더 오류 하위 코드를 정의합니다.

```text
         Name                         Value        Definition
         --------------------         -----        ----------
         Connection Not Synchronized   1           See Section 6.1
         Bad Message Length            2           See Section 6.1
         Bad Message Type              3           See Section 6.1
```

이 문서는 다음과 같은 OPEN 메시지 오류 하위 코드를 정의합니다.

```text
         Name                         Value        Definition
         --------------------         -----        ----------
         Unsupported Version Number     1          See Section 6.2
         Bad Peer AS                    2          See Section 6.2
         Bad BGP Identifier             3          See Section 6.2
         Unsupported Optional Parameter 4          See Section 6.2
         [Deprecated]                   5          See Appendix A
         Unacceptable Hold Time         6          See Section 6.2
```

이 문서는 다음 업데이트 메시지 오류 하위 코드를 정의합니다.

```text
         Name                             Value    Definition
         --------------------              ---     ----------
         Malformed Attribute List           1      See Section 6.3
         Unrecognized Well-known Attribute  2      See Section 6.3
         Missing Well-known Attribute       3      See Section 6.3
         Attribute Flags Error              4      See Section 6.3
         Attribute Length Error             5      See Section 6.3
         Invalid ORIGIN Attribute           6      See Section 6.3
         [Deprecated]                       7      See Appendix A
         Invalid NEXT_HOP Attribute         8      See Section 6.3
         Optional Attribute Error           9      See Section 6.3
         Invalid Network Field             10      See Section 6.3
         Malformed AS_PATH                 11      See Section 6.3
```

---
# **Normative References**

```text
   [RFC791]  Postel, J., "Internet Protocol", STD 5, RFC 791, September
             1981.

   [RFC793]  Postel, J., "Transmission Control Protocol", STD 7, RFC
             793, September 1981.

   [RFC2119] Bradner, S., "Key words for use in RFCs to Indicate
             Requirement Levels", BCP 14, RFC 2119, March 1997.

   [RFC2385] Heffernan, A., "Protection of BGP Sessions via the TCP MD5
             Signature Option", RFC 2385, August 1998.

   [RFC2434] Narten, T. and H. Alvestrand, "Guidelines for Writing an
             IANA Considerations Section in RFCs", BCP 26, RFC 2434,
             October 1998.
```

---
# **Informative References**

```text
   [RFC904]  Mills, D., "Exterior Gateway Protocol formal
             specification", RFC 904, April 1984.

   [RFC1092] Rekhter, J., "EGP and policy based routing in the new
             NSFNET backbone", RFC 1092, February 1989.

   [RFC1093] Braun, H., "NSFNET routing architecture", RFC 1093,
             February 1989.

   [RFC1105] Lougheed, K. and Y. Rekhter, "Border Gateway Protocol
             (BGP)", RFC 1105, June 1989.

   [RFC1163] Lougheed, K. and Y. Rekhter, "Border Gateway Protocol
             (BGP)", RFC 1163, June 1990.

   [RFC1267] Lougheed, K. and Y. Rekhter, "Border Gateway Protocol 3
             (BGP-3)", RFC 1267, October 1991.

   [RFC1771] Rekhter, Y. and T. Li, "A Border Gateway Protocol 4 (BGP-
             4)", RFC 1771, March 1995.

   [RFC1772] Rekhter, Y. and P. Gross, "Application of the Border
             Gateway Protocol in the Internet", RFC 1772, March 1995.

   [RFC1518] Rekhter, Y. and T. Li, "An Architecture for IP Address
             Allocation with CIDR", RFC 1518, September 1993.

   [RFC1519] Fuller, V., Li, T., Yu, J., and K. Varadhan, "Classless
             Inter-Domain Routing (CIDR): an Address Assignment and
             Aggregation Strategy", RFC 1519, September 1993.

   [RFC1930] Hawkinson, J. and T. Bates, "Guidelines for creation,
             selection, and registration of an Autonomous System (AS)",
             BCP 6, RFC 1930, March 1996.

   [RFC1997] Chandra, R., Traina, P., and T. Li, "BGP Communities
             Attribute", RFC 1997, August 1996.

   [RFC2439] Villamizar, C., Chandra, R., and R. Govindan, "BGP Route
             Flap Damping", RFC 2439, November 1998.

   [RFC2474] Nichols, K., Blake, S., Baker, F., and D. Black,
             "Definition of the Differentiated Services Field (DS Field)
             in the IPv4 and IPv6 Headers", RFC 2474, December 1998.

   [RFC2796] Bates, T., Chandra, R., and E. Chen, "BGP Route Reflection
             - An Alternative to Full Mesh IBGP", RFC 2796, April 2000.

   [RFC2858] Bates, T., Rekhter, Y., Chandra, R., and D. Katz,
             "Multiprotocol Extensions for BGP-4", RFC 2858, June 2000.

   [RFC3392] Chandra, R. and J. Scudder, "Capabilities Advertisement
             with BGP-4", RFC 3392, November 2002.

   [RFC2918] Chen, E., "Route Refresh Capability for BGP-4", RFC 2918,
             September 2000.

   [RFC3065] Traina, P., McPherson, D., and J. Scudder, "Autonomous
             System Confederations for BGP", RFC 3065, February 2001.

   [RFC3562] Leech, M., "Key Management Considerations for the TCP MD5
             Signature Option", RFC 3562, July 2003.

   [IS10747] "Information Processing Systems - Telecommunications and
             Information Exchange between Systems - Protocol for
             Exchange of Inter-domain Routeing Information among
             Intermediate Systems to Support Forwarding of ISO 8473
             PDUs", ISO/IEC IS10747, 1993.

   [RFC4272] Murphy, S., "BGP Security Vulnerabilities Analysis", RFC
             4272, January 2006

   [RFC4020] Kompella, K. and A. Zinin, "Early IANA Allocation of
             Standards Track Code Points", BCP 100, RFC 4020, February
             2005.
```

---
# **Editors' Addresses**

```text
   Yakov Rekhter
   Juniper Networks

   EMail: yakov@juniper.net

   Tony Li

   EMail: tony.li@tony.li

   Susan Hares
   NextHop Technologies, Inc.
   825 Victors Way
   Ann Arbor, MI 48108

   Phone: (734)222-1610
   EMail: skh@nexthop.com
```

---
# **Full Copyright Statement**

저작권\(C\)인터넷학회\(2006\).

이 문서에는 BCP 78에 포함된 권리, 라이선스 및 제한 사항이 적용되며, 여기에 명시된 경우를 제외하고 작성자는 모든 권리를 보유합니다.

이 문서와 여기에 포함된 정보는 "있는 그대로" 제공되며 기여자, 그가 대표하거나 후원하는 조직\(있는 경우\), 인터넷 사회 및 인터넷 엔지니어링 태스크 포스는 모든 명시적 또는 명시적 보증을 부인합니다. 여기에 포함된 정보의 사용이 상품성이나 특정 목적에의 적합성에 대한 묵시적인 보증이나 권리를 침해하지 않는다는 보증을 포함하되 이에 국한되지 않습니다.

---
# **Intellectual Property**

IETF는 이 문서에 설명된 기술의 구현이나 사용과 관련이 있다고 주장될 수 있는 지적 재산권 또는 기타 권리의 유효성이나 범위, 그러한 권리에 따른 라이선스가 적용되거나 적용되지 않을 수 있는 범위에 대해 어떠한 입장도 취하지 않습니다. 는 가능하다; 또한 그러한 권리를 확인하기 위해 독립적인 노력을 했다는 것을 나타내지도 않습니다. RFC 문서의 권리와 관련된 절차에 대한 정보는 BCP 78 및 BCP 79에서 확인할 수 있습니다.

IETF 사무국에 제출된 IPR 공개 사본 및 사용 가능한 라이센스에 대한 보증, 또는 이 사양의 구현자 또는 사용자가 해당 독점적 권리 사용에 대한 일반 라이센스 또는 허가를 얻으려는 시도의 결과를 얻을 수 있습니다. IETF 온라인 IPR 저장소\(http://www.ietf.org/ipr\)에서.

IETF는 이 표준을 구현하는 데 필요할 수 있는 기술에 적용될 수 있는 모든 저작권, 특허, 특허 출원 또는 기타 독점권에 관심을 갖도록 관심 있는 당사자를 초대합니다. IETF\(ietf-ipr@ietf.org\)에 해당 정보를 보내주십시오.

---
# **Acknowledgement**

RFC 편집기 기능에 대한 자금은 IETF 관리 지원 활동\(IASA\)에서 제공됩니다.