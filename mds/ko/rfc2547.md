

```text
Network Working Group                                           E. Rosen
Request for Comments: 2547                                    Y. Rekhter
Category: Informational                              Cisco Systems, Inc.
                                                              March 1999

                             BGP/MPLS VPNs
```

---
# **Status of this Memo**

이 메모는 인터넷 커뮤니티에 대한 정보를 제공합니다. 어떤 종류의 인터넷 표준도 지정하지 않습니다. 이 메모의 배포는 무제한입니다.

---
# **Copyright Notice**

저작권\(C\)인터넷학회\(1999\). 판권 소유.

---
# **Abstract**

이 문서에서는 IP 백본이 있는 서비스 제공자가 고객에게 VPN\(가상 사설망\)을 제공하는 방법을 설명합니다. MPLS\(Multiprotocol Label Switching\)는 백본을 통해 패킷을 전달하는 데 사용되고 BGP\(Border Gateway Protocol\)는 백본을 통해 경로를 분배하는 데 사용됩니다. 이 방법의 주요 목표는 엔터프라이즈 네트워크를 위한 IP 백본 서비스의 아웃소싱을 지원하는 것입니다. 이는 엔터프라이즈에 간단한 방식으로, 서비스 제공자에게는 확장 가능하고 유연하면서도 서비스 제공자가 가치를 추가할 수 있도록 합니다. 이러한 기술은 고객에게 IP 서비스를 제공하는 VPN을 제공하는 데에도 사용할 수 있습니다.

---
# **Table of Contents**

```text
   1          Introduction  .......................................   2
   1.1        Virtual Private Networks  ...........................   2
   1.2        Edge Devices  .......................................   3
   1.3        VPNs with Overlapping Address Spaces  ...............   4
   1.4        VPNs with Different Routes to the Same System  ......   4
   1.5        Multiple Forwarding Tables in PEs  ..................   5
   1.6        SP Backbone Routers  ................................   5
   1.7        Security  ...........................................   5
   2          Sites and CEs  ......................................   6
   3          Per-Site Forwarding Tables in the PEs  ..............   6
   3.1        Virtual Sites  ......................................   8
   4          VPN Route Distribution via BGP  .....................   8
   4.1        The VPN-IPv4 Address Family  ........................   9
   4.2        Controlling Route Distribution  .....................  10
   4.2.1      The Target VPN Attribute  ...........................  10
   4.2.2      Route Distribution Among PEs by BGP  ................  12
   4.2.3      The VPN of Origin Attribute  ........................  13
   4.2.4      Building VPNs using Target and Origin Attributes  ...  14
   5          Forwarding Across the Backbone  .....................  15
   6          How PEs Learn Routes from CEs  ......................  16
   7          How CEs learn Routes from PEs  ......................  19
   8          What if the CE Supports MPLS?  ......................  19
   8.1        Virtual Sites  ......................................  19
   8.2        Representing an ISP VPN as a Stub VPN  ..............  20
   9          Security  ...........................................  20
   9.1        Point-to-Point Security Tunnels between CE Routers  .  21
   9.2        Multi-Party Security Associations  ..................  21
   10         Quality of Service  .................................  22
   11         Scalability  ........................................  22
   12         Intellectual Property Considerations  ...............  23
   13         Security Considerations  ............................  23
   14         Acknowledgments  ....................................  23
   15         Authors' Addresses  .................................  24
   16         References  .........................................  24
   17         Full Copyright Statement.............................  25
```

---
## **1. Introduction**
---
### **1.1. Virtual Private Networks**

"백본"이라고 부를 수 있는 공통 네트워크에 연결된 "사이트" 집합을 고려합니다. 해당 집합의 여러 하위 집합을 만들기 위해 몇 가지 정책을 적용하고 다음 규칙을 부과해 보겠습니다. 두 사이트는 이러한 하위 집합 중 적어도 하나에 두 사이트가 모두 포함된 경우에만 해당 백본을 통해 IP 상호 연결성을 가질 수 있습니다.

우리가 만든 하위 집합은 "가상 사설망"\(VPN\)입니다. 두 사이트는 두 사이트를 모두 포함하는 VPN이 있는 경우에만 공통 백본을 통해 IP 연결이 있습니다. 공통 VPN이 없는 두 사이트는 해당 백본을 통해 연결이 없습니다.

VPN의 모든 사이트가 같은 기업 소유인 경우 VPN은 기업 "인트라넷"입니다. VPN의 다양한 사이트가 다른 기업 소유인 경우 VPN은 "엑스트라넷"입니다. 사이트는 두 개 이상의 VPN에 있을 수 있습니다. 예를 들어, 인트라넷과 여러 엑스트라넷에 있을 수 있습니다. 우리는 인트라넷과 엑스트라넷을 모두 VPN으로 간주합니다. 일반적으로 VPN이라는 용어를 사용할 때 인트라넷과 엑스트라넷을 구별하지 않습니다.

백본이 하나 이상의 서비스 제공자\(SP\)에 의해 소유되고 운영되는 경우를 고려하고자 합니다. 사이트 소유자는 SP의 "고객"입니다. 결정하는 정책

특정 사이트 모음이 VPN인지 여부는 고객의 정책입니다. 일부 고객은 이러한 정책의 구현을 전적으로 SP의 책임으로 하기를 원할 것입니다. 다른 고객은 이러한 정책을 직접 구현하거나 이러한 정책 구현에 대한 책임을 SP와 공유하기를 원할 수 있습니다. 이 문서에서는 주로 이러한 정책을 구현하는 데 사용할 수 있는 메커니즘에 대해 설명합니다. 설명하는 메커니즘은 SP 단독으로 또는 VPN 고객이 SP와 함께 이러한 정책을 구현할 수 있을 만큼 일반적입니다. 그러나 대부분의 논의는 전자의 경우에 집중되어 있습니다.

이 문서에서 논의하는 메커니즘은 광범위한 정책을 구현할 수 있게 해줍니다. 예를 들어, 주어진 VPN 내에서 모든 사이트가 다른 모든 사이트로 직접 경로를 갖도록 허용할 수 있습니다\("풀 메시"\). 또는 특정 사이트 쌍이 서로 직접 경로를 갖는 것을 제한할 수 있습니다\("파셜 메시"\).

이 문서에서 우리는 공통 백본이 IP 서비스를 제공하는 경우에 특히 관심이 있습니다. 우리는 주로 기업이 백본을 서비스 제공자 또는 계약 관계를 유지하는 서비스 제공자 집합에 아웃소싱하는 경우에 관심이 있습니다. 우리는 공공 인터넷을 통한 VPN 제공에 초점을 맞추지 않습니다.

이 소개의 나머지 부분에서는 VPN이 가져야 하는 몇 가지 속성을 지정합니다. 이 문서의 나머지 부분에서는 이러한 모든 속성을 갖는 VPN 모델을 설명합니다. 이 문서의 VPN 모델은 \[4\]에 설명된 프레임워크의 인스턴스인 것으로 보입니다.

---
### **1.2. Edge Devices**

각 사이트에 하나 이상의 고객 에지\(CE\) 장치가 있고, 각 장치는 일종의 데이터 링크\(예: PPP, ATM, 이더넷, 프레임 릴레이, GRE 터널 등\)를 통해 하나 이상의 공급자 에지\(PE\) 라우터에 연결되어 있다고 가정합니다.

특정 사이트에 호스트가 하나뿐인 경우 해당 호스트는 CE 장치일 수 있습니다. 특정 사이트에 서브넷이 하나뿐인 경우 해당 CE 장치는 스위치일 수 있습니다. 일반적으로 CE 장치는 CE 라우터라고 하는 라우터일 것으로 예상할 수 있습니다.

PE 라우터가 특정 VPN에 연결된 것은 해당 VPN에 있는 CE 장치에 연결되어 있는 경우입니다. 마찬가지로 PE 라우터가 특정 사이트에 연결된 것은 해당 사이트에 있는 CE 장치에 연결되어 있는 경우입니다.

CE 장치가 라우터인 경우 연결된 PE의 라우팅 피어이지만 CE 라우터의 라우팅 피어는 아닙니다.

다른 사이트. 다른 사이트의 라우터는 서로 라우팅 정보를 직접 교환하지 않습니다. 사실, 서로를 알 필요조차 없습니다\(보안 목적으로 필요한 경우를 제외하고, 섹션 9 참조\). 결과적으로 매우 큰 VPN\(즉, 매우 많은 수의 사이트가 있는 VPN\)을 쉽게 지원할 수 있으며, 각 개별 사이트의 라우팅 전략이 크게 간소화됩니다.

SP와 고객 간에 명확한 관리 경계를 유지하는 것이 중요합니다\(참조 \[4\]\). PE 및 P 라우터는 SP에서만 관리해야 하며 SP 고객은 이에 대한 관리 액세스 권한이 없어야 합니다. CE 장치는 고객에서만 관리해야 합니다\(고객이 SP에 관리 서비스를 계약한 경우는 제외\).

---
### **1.3. VPNs with Overlapping Address Spaces**

우리는 두 개의 교차하지 않는 VPN\(즉, 공통 사이트가 없는 VPN\)이 겹치는 주소 공간을 가질 수 있다고 가정합니다. 동일한 주소가 다른 VPN에서 다른 시스템에 재사용될 수 있습니다. 주어진 엔드시스템이 속한 VPN 범위 내에서 고유한 주소를 갖는 한, 엔드시스템 자체는 VPN에 대해 아무것도 알 필요가 없습니다.

이 모델에서 VPN 소유자는 관리할 백본이 없고, "가상 백본"도 없습니다. SP도 각 VPN에 대해 별도의 백본이나 "가상 백본"을 관리할 필요가 없습니다. 백본의 사이트 간 라우팅은 최적\(VPN을 형성하는 데 사용된 정책의 제약 내에서\)이며, 터널의 인공적인 "가상 토폴로지"에 의해 어떤 식으로든 제약을 받지 않습니다.

---
### **1.4. VPNs with Different Routes to the Same System**

사이트가 여러 VPN에 있을 수 있지만 해당 사이트의 주어진 시스템으로 가는 경로가 모든 VPN에서 동일해야 하는 것은 아닙니다. 예를 들어, 사이트 A, B, C로 구성된 인트라넷과 A, B, C, "외부" 사이트 D로 구성된 엑스트라넷이 있다고 가정해 보겠습니다. 사이트 A에 서버가 있고 B, C 또는 D의 클라이언트가 해당 서버를 사용할 수 있기를 원한다고 가정해 보겠습니다. 또한 사이트 B에 방화벽이 있다고 가정해 보겠습니다. 사이트 D에서 서버로 가는 모든 트래픽이 방화벽을 통과하도록 하여 엑스트라넷의 트래픽을 액세스 제어할 수 있도록 하려고 합니다. 그러나 C에서 서버로 가는 트래픽이 방화벽을 통과하도록 하려고 하지 않습니다. 이는 인트라넷 트래픽이기 때문입니다.

이는 서버에 두 개의 경로를 설정할 수 있어야 함을 의미합니다. 사이트 B와 C에서 사용하는 한 경로는 트래픽을 사이트 A로 직접 보냅니다. 사이트 D에서 사용하는 두 번째 경로는 트래픽을 보냅니다.

대신 사이트 B의 방화벽으로 이동합니다. 방화벽이 트래픽 통과를 허용하면 해당 트래픽은 사이트 B에서 오는 트래픽으로 표시되고 사이트 A로 가는 경로를 따릅니다.

---
### **1.5. Multiple Forwarding Tables in PEs**

각 PE 라우터는 여러 개의 별도 포워딩 테이블을 유지 관리해야 합니다. PE가 연결된 모든 사이트는 해당 포워딩 테이블 중 하나에 매핑되어야 합니다. 특정 사이트에서 패킷을 수신하면 해당 사이트와 연관된 포워딩 테이블을 참조하여 패킷을 라우팅하는 방법을 결정합니다. 특정 사이트 S와 연관된 포워딩 테이블은 S와 공통된 VPN이 하나 이상 있는 다른 사이트로 이어지는 경로로만 채워집니다. 이렇게 하면 공통된 VPN이 없는 사이트 간의 통신이 방지되고 공통된 사이트가 없는 두 VPN이 서로 겹치는 주소 공간을 사용할 수 있습니다.

---
### **1.6. SP Backbone Routers**

SP의 백본은 PE 라우터와 CE 장치에 연결되지 않은 다른 라우터\(P 라우터\)로 구성됩니다.

SP의 백본에 있는 모든 라우터가 SP에서 지원하는 모든 VPN에 대한 라우팅 정보를 유지해야 한다면, 이 모델은 심각한 확장성 문제가 있을 것입니다. 지원할 수 있는 사이트 수는 단일 라우터에 보관할 수 있는 라우팅 정보의 양에 따라 제한될 것입니다. 따라서 특정 VPN에 대한 라우팅 정보가 해당 VPN에 연결된 PE 라우터에만 존재하도록 요구하는 것이 중요합니다. 특히, P 라우터는 VPN당 라우팅 정보가 전혀 없어야 합니다.

VPN은 여러 서비스 제공자를 포함할 수 있습니다. 그러나 PE 라우터 간 경로가 SP 네트워크 간 경계를 교차할 때는 두 제공자 간에 상호 신뢰가 존재하는 개인 피어링 배열을 통해 교차한다고 가정합니다. 특히 각 제공자는 다른 제공자가 올바른 라우팅 정보만 전달하고 신뢰할 수 있는 소스에서 레이블이 지정된 패킷만 레이블이 지정된\(MPLS \[9\]의 의미에서\) 패킷을 전달하도록 신뢰해야 합니다. 또한 레이블이 전환된 경로가 서비스 제공자 간 경계를 교차할 수 있다고 가정합니다.

---
### **1.7. Security**

VPN 모델은 암호화 보안 조치를 사용하지 않더라도 레벨 2 백본\(예: 프레임 릴레이\)을 사용할 때 얻을 수 있는 것과 동일한 수준의 보안을 제공해야 합니다. 즉, 잘못된 구성이나 의도적인 상호 연결이 없는 경우

서로 다른 VPN을 사용하는 경우 한 VPN에 속한 시스템이 다른 VPN에 속한 시스템에 접근하는 것이 불가능해야 합니다.

표준 보안 절차를 구축하는 것도 가능해야 합니다.

---
## **2. Sites and CEs**

특정 백본 네트워크의 관점에서 IP 시스템 집합은 해당 시스템에 상호 IP 상호 연결성이 있고 백본을 사용하지 않고도 통신이 이루어지는 경우 사이트를 구성합니다. 일반적으로 사이트는 지리적으로 인접한 시스템 집합으로 구성됩니다. 그러나 이는 보편적으로 사실이 아닙니다. OSPF가 실행되는 임대 회선을 통해 연결된 두 지리적 위치는 두 위치 간의 통신에 백본을 사용하지 않기 때문에 단일 사이트를 구성합니다.

CE 장치는 항상 단일 사이트에 있는 것으로 간주됩니다\(하지만 우리가 볼 수 있듯이 사이트는 여러 "가상 사이트"로 구성될 수 있음\). 그러나 사이트는 여러 VPN에 속할 수 있습니다.

PE 라우터는 동일한 VPN 또는 다른 VPN에 있든, 여러 다른 사이트에 있는 CE 장치에 연결할 수 있습니다. CE 장치는 견고성을 위해 동일하거나 다른 서비스 제공자의 여러 PE 라우터에 연결할 수 있습니다. CE 장치가 라우터인 경우 PE 라우터와 CE 라우터는 서로에 대한 라우터 인접성으로 나타납니다.

상호 연결의 기본 단위는 사이트이지만, 여기에 설명된 아키텍처는 상호 연결성 제어에 있어 더 세밀한 수준의 세분성을 허용합니다. 예를 들어, 사이트의 특정 시스템은 인트라넷의 멤버일 뿐만 아니라 하나 이상의 엑스트라넷의 멤버일 수 있지만, 같은 사이트의 다른 시스템은 인트라넷의 멤버로만 제한될 수 있습니다.

---
## **3. Per-Site Forwarding Tables in the PEs**

각 PE 라우터는 하나 이상의 "사이트별 포워딩 테이블"을 유지합니다. PE 라우터가 연결된 모든 사이트는 이러한 테이블 중 하나와 연관됩니다. 특정 패킷의 IP 대상 주소는 해당 패킷이 해당 테이블과 연관된 사이트에서 직접 도착한 경우에만 특정 사이트별 포워딩 테이블에서 조회됩니다.

사이트별 전달 테이블은 어떻게 채워집니까?

예를 들어, PE1, PE2, PE3가 세 개의 PE 라우터이고 CE1, CE2, CE3가 세 개의 CE 라우터라고 합시다. PE1이 CE1에서 CE1의 사이트에서 도달할 수 있는 경로를 학습한다고 가정합니다. PE2와 PE3가 각각 CE2와 CE3에 연결되어 있고 CE1, CE2, CE3을 포함하는 VPN V가 있는 경우 PE1은 BGP를 사용하여 CE1에서 학습한 경로를 PE2와 PE3에 배포합니다. PE2와 PE3는 이러한 경로를 사용하여 각각 CE2와 CE3의 사이트와 연결하는 전달 테이블을 채웁니다. VPN V에 없는 사이트의 경로는 이러한 전달 테이블에 나타나지 않으므로 CE2 또는 CE3의 패킷은 VPN V에 없는 사이트로 보낼 수 없습니다.

사이트가 여러 VPN에 속해 있는 경우 해당 사이트와 연결된 전달 테이블에는 사이트가 구성원으로 속한 전체 VPN 세트의 경로가 포함될 수 있습니다.

PE는 일반적으로 사이트당 하나의 포워딩 테이블만 유지하는데, 해당 사이트에 여러 개 연결되어 있더라도 마찬가지입니다. 또한, 서로 다른 사이트가 정확히 동일한 경로 집합을 사용하도록 되어 있는 경우 동일한 포워딩 테이블을 공유할 수 있습니다.

패킷이 특정 직접 연결된 사이트에서 PE 라우터에 수신되었지만 패킷의 대상 주소가 해당 사이트와 관련된 전달 테이블의 어떤 항목과도 일치하지 않는다고 가정합니다. SP가 해당 사이트에 인터넷 액세스를 제공하지 않는 경우 패킷은 전달 불가로 삭제됩니다. SP가 해당 사이트에 인터넷 액세스를 제공하는 경우 PE의 인터넷 전달 테이블이 참조됩니다. 즉, 일반적으로 인터넷 액세스가 제공되더라도 PE당 하나의 전달 테이블만 인터넷 경로를 포함하면 됩니다.

한 VPN을 다른 VPN에서 적절히 격리하려면 백본의 라우터가 \(a\) 레이블 스택의 맨 위에 있는 레이블이 백본 라우터에서 실제로 백본이 아닌 장치로 분배된 경우, \(b\) 백본 라우터가 해당 레이블을 사용하면 스택의 맨 아래에 있는 레이블이 검사되고 IP 헤더가 검사되기 전에 패킷이 백본을 떠날 것이라고 판단할 수 있는 경우를 제외하고는 인접한 비백본 장치에서 레이블이 지정된 패킷을 수락하지 않는 것이 중요합니다. 이러한 제한은 패킷이 속하지 않는 VPN에 들어가는 것을 방지하기 위해 필요합니다.

PE의 사이트별 전달 테이블은 PE에 직접 연결된 사이트에서 도착하는 패킷에만 사용됩니다. SP 백본에 속하는 다른 라우터에서 도착하는 패킷을 라우팅하는 데는 사용되지 않습니다. 결과적으로 동일한 시스템에 대한 여러 개의 다른 경로가 있을 수 있으며, 주어진 패킷이 따르는 경로는 패킷이 백본에 들어오는 사이트에 따라 결정됩니다. 예를 들어, 주어진 시스템에 대한 경로가 하나 있을 수 있습니다.

엑스트라넷\(경로가 방화벽으로 이어지는 경우\)에서 온 패킷과 인트라넷\(이미 방화벽을 통과한 패킷 포함\)에서 온 패킷에 대해 동일한 시스템으로 가는 다른 경로가 있습니다.

---
### **3.1. Virtual Sites**

어떤 경우에는 특정 사이트가 VLAN을 사용하여 고객에 의해 여러 가상 사이트로 나뉘기도 합니다. 각 가상 사이트는 다른 VPN 세트의 멤버가 될 수 있습니다. 그런 다음 PE는 각 가상 사이트에 대해 별도의 전달 테이블을 포함해야 합니다. 예를 들어 CE가 VLAN을 지원하고 각 VLAN을 별도의 VPN에 매핑하려는 경우 CE와 PE 간에 전송된 패킷은 사이트의 VLAN 캡슐화에 포함될 수 있으며, 이는 패킷을 수신한 인터페이스와 함께 PE에서 패킷을 특정 가상 사이트에 할당하는 데 사용될 수 있습니다.

또는 인터페이스를 여러 개의 "하위 인터페이스"\(특히 인터페이스가 프레임 릴레이 또는 ATM인 경우\)로 분할하고 패킷이 도착하는 하위 인터페이스에 따라 VPN에 할당할 수 있습니다. 또는 각 가상 사이트에 대해 다른 인터페이스를 사용할 수도 있습니다. 어떤 경우든 여러 가상 사이트가 있더라도 사이트당 하나의 CE 라우터만 필요합니다. 물론 원하는 경우 각 가상 사이트에 대해 다른 CE 라우터를 사용할 수 있습니다.

이러한 모든 경우에 어떤 트래픽이 어떤 VPN에 속하는지 제어하는 메커니즘과 정책은 모두 고객의 손에 달려 있습니다.

특정 호스트가 여러 가상 사이트에 있기를 원하는 경우 해당 호스트는 각 패킷에 대해 패킷이 연결된 가상 사이트를 결정해야 합니다. 예를 들어, 다른 VLAN의 다른 가상 사이트에서 패킷을 보내거나 다른 네트워크 인터페이스에서 패킷을 보내는 방식으로 이를 수행할 수 있습니다.

이러한 계획은 CE가 MPLS를 지원할 것을 요구하지 않습니다. 섹션 8에는 CE가 MPLS를 지원하는 경우 여러 가상 사이트를 지원할 수 있는 방법에 대한 간략한 설명이 포함되어 있습니다.

---
## **4. VPN Route Distribution via BGP**

PE 라우터는 BGP를 사용하여 VPN 경로를 서로 분산합니다\(더 정확하게는 VPN 경로가 서로 분산되도록 합니다\).

BGP 스피커는 주어진 주소 접두사로 하나의 경로만 설치하고 배포할 수 있습니다. 그러나 우리는 각 VPN이 자체 주소 공간을 갖도록 허용합니다. 즉, 동일한 주소가 아무리 많은 VPN에서나 사용될 수 있으며, 각 VPN에서 주소는 다른 시스템을 나타냅니다. 다음과 같습니다.

BGP가 단일 IP 주소 접두사에 여러 경로를 설치하고 배포할 수 있도록 허용해야 합니다. 또한 POLICY를 사용하여 어떤 사이트가 어떤 경로를 사용할 수 있는지 확인해야 합니다. 이러한 경로가 여러 개 BGP에 의해 설치되므로 특정 사이트별 전달 테이블에는 하나만 나타나야 합니다.

이러한 목표는 아래에 명시된 대로 새로운 주소 계열을 사용하여 달성됩니다.

---
### **4.1. The VPN-IPv4 Address Family**

BGP 멀티프로토콜 확장\[3\]을 사용하면 BGP가 여러 "주소 패밀리"에서 경로를 전송할 수 있습니다. "VPN-IPv4 주소 패밀리"라는 개념을 소개합니다. VPN-IPv4 주소는 8바이트 "경로 구분자\(RD\)"로 시작하여 4바이트 IPv4 주소로 끝나는 12바이트 수량입니다. 두 VPN이 동일한 IPv4 주소 접두사를 사용하는 경우 PE는 이를 고유한 VPN-IPv4 주소 접두사로 변환합니다. 이렇게 하면 두 개의 다른 VPN에서 동일한 주소를 사용하는 경우 각 VPN에 대해 하나씩 해당 주소로 완전히 다른 두 개의 경로를 설치할 수 있습니다.

RD 자체는 어떠한 의미론도 부과하지 않습니다. 경로의 원점이나 경로가 배포될 VPN 집합에 대한 정보를 포함하지 않습니다. RD의 목적은 공통 IPv4 주소 접두사로의 고유한 경로를 만들 수 있도록 하는 것입니다. 경로를 재배포할 위치를 결정하는 데는 다른 수단이 사용됩니다\(4.2절 참조\).

RD는 또한 동일한 시스템으로 가는 여러 다른 경로를 만드는 데 사용될 수 있습니다. 섹션 3에서 특정 서버로 가는 경로가 인트라넷 트래픽과 엑스트라넷 트래픽에서 달라야 하는 예를 들었습니다. 이는 동일한 IPv4 부분이 있지만 RD가 다른 두 개의 다른 VPN-IPv4 경로를 만들어서 달성할 수 있습니다. 이를 통해 BGP는 동일한 시스템으로 가는 여러 다른 경로를 설치할 수 있으며, 정책을 사용하여\(섹션 4.2.3 참조\) 어떤 패킷이 어떤 경로를 사용하는지 결정할 수 있습니다.

RD는 모든 서비스 제공자가 다른 서비스 제공자가 만든 RD 할당과 충돌하지 않고 자체 "번호 공간"\(즉, 자체 RD 할당을 할 수 있음\)을 관리할 수 있도록 구조화되어 있습니다. RD는 2바이트 유형 필드, 관리자 필드, 할당된 번호 필드로 구성됩니다. 유형 필드의 값은 다른 두 필드의 길이와 관리자 필드의 의미를 결정합니다. 관리자 필드는 할당된 번호 기관을 식별하고 할당된 번호 필드에는 식별된 기관이 특정 목적을 위해 할당한 번호가 포함됩니다. 예를 들어, 관리자 필드에 자율 시스템 번호가 포함된 RD가 있을 수 있습니다.

\(ASN\)이며, \(4바이트\) 숫자 필드에는 IANA가 해당 ASN을 할당한 SP가 할당한 숫자가 포함됩니다. RD는 VPN 백본 서비스를 제공하는 SP가 필요할 때 항상 고유한 RD를 생성할 수 있도록 이 구조가 제공됩니다. 그러나 구조화는 의미를 제공하지 않습니다. BGP가 이러한 두 주소 접두사를 비교할 때 구조를 완전히 무시합니다.

VPN-IPv4 주소의 관리자 하위 필드와 할당된 번호 하위 필드가 모두 모두 0으로 설정된 경우, VPN-IPv4 주소는 해당 전역적으로 고유한 IPv4 주소와 정확히 동일한 의미를 갖는 것으로 간주됩니다. 특히, 이 VPN-IPv4 주소와 해당 전역적으로 고유한 IPv4 주소는 BGP에서 비교 가능한 것으로 간주됩니다. 다른 모든 경우에는 VPN-IPv4 주소와 해당 전역적으로 고유한 IPv4 주소는 BGP에서 비교 불가능한 것으로 간주됩니다.

주어진 사이트별 전달 테이블에는 주어진 IPv4 주소 접두사에 대해 하나의 VPN-IPv4 경로만 있습니다. 패킷의 대상 주소가 VPN-IPv4 경로와 일치하면 실제로는 IPv4 부분만 일치합니다.

PE는 특정 CE로 이어지는 경로를 특정 RD와 연관시키도록 구성되어야 합니다. PE는 동일한 CE로 이어지는 모든 경로를 동일한 RD와 연관시키도록 구성될 수 있으며, 동일한 CE로 이어지는 경우에도 다른 경로를 다른 RD와 연관시키도록 구성될 수 있습니다.

---
### **4.2. Controlling Route Distribution**

이 섹션에서는 VPN-IPv4 경로의 분배가 제어되는 방식에 대해 설명합니다.

---
#### **4.2.1. The Target VPN Attribute**

모든 사이트별 전달 테이블은 하나 이상의 "대상 VPN" 속성과 연결됩니다.

PE 라우터가 VPN-IPv4 경로를 만들면 하나 이상의 "대상 VPN" 속성과 연결됩니다. 이는 경로의 속성으로 BGP에 전달됩니다.

Target VPN T와 연관된 모든 경로는 Target VPN T와 연관된 포워딩 테이블이 있는 모든 PE 라우터에 배포되어야 합니다. 이러한 경로가 PE 라우터에 수신되면 Target VPN T와 연관된 각 PE의 사이트별 포워딩 테이블에 설치될 수 있습니다. \(실제로 설치되는지 여부는 BGP 결정 프로세스의 결과에 따라 달라집니다.\)

본질적으로 Target VPN 속성은 사이트 집합을 식별합니다. 특정 Target VPN 속성을 경로와 연관시키면 해당 경로를 해당 사이트에서 수신된 트래픽을 라우팅하는 데 사용되는 사이트별 전달 테이블에 배치할 수 있습니다.

PE 라우터가 사이트 S에서 수신한 경로에 연결하는 대상 VPN 세트가 있습니다. 그리고 PE 라우터가 다른 PE 라우터에서 수신한 경로를 사이트 S와 연관된 포워딩 테이블에 넣을 수 있는지 여부를 확인하는 데 사용하는 대상 VPN 세트가 있습니다. 두 세트는 서로 다르며 동일할 필요는 없습니다.

Target VPN 속성이 수행하는 기능은 BGP 커뮤니티 속성이 수행하는 기능과 유사합니다. 그러나 후자의 형식은 2바이트 번호 매기기 공간만 허용하기 때문에 부적절합니다. BGP 커뮤니티 속성을 확장하여 더 큰 번호 매기기 공간을 제공하는 것은 상당히 간단할 것입니다. RD에 대해 설명한 것과 유사하게 형식을 구조화하여 유형 필드가 관리자 필드의 길이를 정의하고 속성의 나머지는 지정된 관리자의 번호 매기기 공간의 숫자가 되도록 할 수도 있어야 합니다\(섹션 4.1 참조\).

BGP 스피커가 동일한 VPN-IPv4 접두사에 대한 두 개의 경로를 수신한 경우 경로 선호도에 대한 BGP 규칙에 따라 하나를 선택합니다.

경로에는 RD가 하나만 있을 수 있지만 여러 개의 대상 VPN이 있을 수 있습니다. BGP에서 여러 경로가 있는 단일 경로가 있는 경우 확장성이 향상되는 반면 여러 경로가 있는 경우 확장성이 향상됩니다. 더 많은 경로를 생성하여\(즉, 더 많은 RD 사용\) 대상 VPN 속성을 제거할 수 있지만 확장 속성은 덜 유리할 것입니다.

PE는 주어진 경로와 연결할 대상 VPN 속성을 어떻게 결정합니까? 가능한 방법은 여러 가지가 있습니다. PE는 특정 사이트로 이어지는 모든 경로를 특정 대상 VPN과 연결하도록 구성될 수 있습니다. 또는 PE는 특정 사이트로 이어지는 특정 경로를 하나의 대상 VPN과 연결하고 특정 경로를 다른 대상 VPN과 연결하도록 구성될 수 있습니다. 또는 CE 라우터는 이러한 경로를 PE에 배포할 때\(섹션 6 참조\) 각 경로에 대해 하나 이상의 대상 VPN을 지정할 수 있습니다. 후자의 방법은 VPN 정책을 구현하는 데 사용되는 메커니즘의 제어를 SP에서 고객에게 넘깁니다. 이 방법을 사용하는 경우 PE가 자체 구성에 따라 허용되지 않는 대상 VPN을 제거하거나 자체 구성에 따라 필수적인 일부 대상 VPN을 추가하는 것이 여전히 바람직할 수 있습니다.

이 속성을 "VPN 대상" 속성 대신 "경로 대상" 속성이라고 부르는 것이 덜 암시적이기는 하지만 더 정확할 수 있습니다. 실제로는 경로를 사용할 수 있는 사이트 집합만 식별하며, 해당 사이트가 직관적으로 VPN이라고 부를 수 있는 것을 구성하는지 여부에 대한 편견은 없습니다.

---
#### **4.2.2. Route Distribution Among PEs by BGP**

VPN의 두 사이트가 동일한 자율 시스템에 있는 PE에 연결된 경우 PE는 VPN-IPv4 경로를 서로 IBGP 연결을 통해 분배할 수 있습니다. 또는 각각 경로 리플렉터에 대한 IBGP 연결을 가질 수 있습니다.

두 개의 VPN 사이트가 서로 다른 자율 시스템에 있는 경우\(예: 서로 다른 SP에 연결되어 있기 때문\), PE 라우터는 IBGP를 사용하여 VPN-IPv4 경로를 자율 시스템 경계 라우터\(ASBR\) 또는 ASBR이 클라이언트인 경로 리플렉터로 재배포해야 합니다. 그런 다음 ASBR은 EBGP를 사용하여 해당 경로를 다른 AS의 ASBR로 재배포해야 합니다. 이를 통해 서로 다른 VPN 사이트를 서로 다른 서비스 공급자에 연결할 수 있습니다. 그러나 VPN-IPv4 경로는 SP 간의 신뢰할 수 있는 계약의 일부로 개인 피어링 지점에서 EBGP 연결에서만 허용해야 합니다. VPN-IPv4 경로는 공개 인터넷에 배포되거나 공개 인터넷에서 허용되어서는 안 됩니다.

여러 VPN이 서로 다른 자율 시스템에 연결된 경우, 두 AS 사이에 모든 VPN에 대한 모든 경로를 보유하는 단일 ASBR이 필요하지 않습니다. 특정 VPN 하위 집합에 대한 경로만 보유하는 여러 ASBR이 있을 수 있습니다.

PE 라우터가 BGP를 통해 VPN-IPv4 경로를 분배할 때, 자체 주소를 "BGP 다음 홉"으로 사용합니다. 또한 MPLS 레이블을 할당하고 분배합니다. \(기본적으로 PE 라우터는 VPN-IPv4 경로가 아니라 레이블이 지정된 VPN-IPv4 경로를 분배합니다. \[8\] 참조\) PE가 스택 맨 위에 이 레이블이 있는 수신 패킷을 처리할 때, PE는 스택을 팝하고 경로가 시작되는 사이트로 직접 패킷을 보냅니다. 이는 일반적으로 경로를 학습한 CE 라우터로 패킷을 보내는 것을 의미합니다. 레이블은 또한 데이터 링크 캡슐화를 결정할 수 있습니다.

대부분의 경우 PE가 할당한 레이블은 패킷이 CE로 직접 전송되도록 하며 레이블이 지정된 패킷을 수신한 PE는 어떤 전달 테이블에서도 패킷의 대상 주소를 찾지 않습니다. 그러나 PE가 특정 전달 테이블을 암묵적으로 식별하는 레이블을 할당할 수도 있습니다. 이 경우 레이블이 지정된 패킷을 수신한 PE는 전달 테이블 중 하나에서 패킷의 대상 주소를 찾습니다. 이것은 가능하지만

특정 상황에서는 매우 유용할 수 있지만, 이 논문에서는 이에 대해 더 이상 고려하지 않습니다.

이런 방식으로 배포되는 MPLS 레이블은 경로를 설치하는 라우터와 해당 경로의 BGP 다음 홉 사이에 레이블이 전환된 경로가 있는 경우에만 사용할 수 있습니다. 해당 레이블이 전환된 경로를 설정하는 데 사용된 절차에 대해서는 어떠한 가정도 하지 않습니다. 사전 설정된 기준에 따라 설정되거나 해당 경로가 필요한 경로가 설치될 때 설정될 수 있습니다. "최선의 노력" 경로일 수도 있고 트래픽 엔지니어링 경로일 수도 있습니다. 특정 PE 라우터와 특정 경로의 BGP 다음 홉 사이에는 하나의 LSP가 있거나 여러 개가 있을 수 있으며, QoS 특성이 다를 수 있습니다. VPN 아키텍처에 중요한 것은 라우터와 BGP 다음 홉 사이에 레이블이 전환된 경로가 존재한다는 것입니다.

확장성을 개선하기 위해 경로 리플렉터\[2\]를 사용하는 일반적인 기술\(예: 경로 리플렉터 계층\)을 모두 사용할 수 있습니다. 경로 리플렉터를 사용하는 경우 백본에서 지원하는 모든 VPN에 대한 모든 VPN-IPv4 경로를 알 수 있는 경로 리플렉터가 필요하지 않습니다. 서로 통신하지 않는 별도의 경로 리플렉터를 사용할 수 있으며, 각각은 전체 VPN 세트의 하위 세트를 지원합니다.

주어진 PE 라우터가 특정 경로의 대상 VPN에 연결되어 있지 않으면 해당 경로를 수신해서는 안 됩니다. 경로를 배포하는 다른 PE 또는 경로 리플렉터는 불필요한 경로를 보내지 않도록 아웃바운드 필터링을 적용해야 합니다. 물론 PE 라우터가 BGP를 통해 경로를 수신하고 해당 PE가 경로의 대상 VPN에 연결되어 있지 않으면 PE는 경로에 인바운드 필터링을 적용해야 하며 설치하거나 재배포해서는 안 됩니다.

VPN에 연결되지 않은 라우터, 즉 P 라우터는 VPN-IPv4 경로를 전혀 설치하지 않습니다.

이러한 분배 규칙은 백본을 통해 지원되는 모든 VPN-IPv4 경로를 알아야 하는 단일 상자가 없도록 보장합니다. 결과적으로 백본을 통해 지원될 수 있는 이러한 경로의 총 수는 단일 장치의 용량에 의해 제한되지 않으므로 사실상 제한 없이 증가할 수 있습니다.

---
#### **4.2.3. The VPN of Origin Attribute**

VPN-IPv4 경로는 선택적으로 VPN of Origin 속성과 연관될 수 있습니다. 이 속성은 사이트 집합을 고유하게 식별하고 해당 경로가 해당 집합의 사이트 중 하나에서 온 것으로 식별합니다. 이 속성의 일반적인 용도는 다음과 같습니다.

경로가 이어지는 사이트를 소유한 기업을 식별하거나 사이트의 인트라넷을 식별합니다. 그러나 다른 용도도 가능합니다. 이 속성은 확장된 BGP 커뮤니티 속성으로 인코딩될 수 있습니다.

경로의 소스를 식별해야 하는 상황에서는 RD가 아니라 이 속성을 사용해야 합니다. 이 속성은 아래에 설명된 대로 VPN을 "구축"할 때 사용할 수 있습니다.

이 속성을 "VPN of Origin" 속성 대신 "Route Origin" 속성이라고 부르는 것이 더 정확할 수 있지만, 암시적이지는 않습니다. 이는 특정 사이트 집합 중 하나에서 온 경로만 식별하며, 해당 특정 사이트 집합이 실제로 VPN을 구성하는지 여부에 대한 편견은 없습니다.

---
#### **4.2.4. Building VPNs using Target and Origin Attributes**

대상 VPN과 원본 VPN 속성을 올바르게 설정하면 다양한 종류의 VPN을 구성할 수 있습니다.

특정 사이트 집합을 포함하는 폐쇄 사용자 그룹\(CUG\)을 만들고자 한다고 가정해 보겠습니다. 이는 CUG를 나타내는 특정 대상 VPN 속성 값을 만들어서 수행할 수 있습니다. 그런 다음 이 값을 CUG의 각 사이트에 대한 사이트별 전달 테이블과 연결해야 하며 CUG의 사이트에서 학습한 모든 경로와 연결해야 합니다. 이 대상 VPN 속성이 있는 모든 경로는 CUG의 사이트 중 하나에 연결된 모든 PE 라우터에 도달하도록 재배포해야 합니다.

또는 어떤 이유에서든 "허브 앤 스포크" 유형의 VPN을 만들고 싶다고 가정해 보겠습니다. 이는 두 개의 대상 속성 값을 사용하여 수행할 수 있는데, 하나는 "허브"를 의미하고 다른 하나는 "스포크"를 의미합니다. 그러면 스포크에서 허브로 경로를 분배할 수 있으며, 허브에서 스포크로 경로가 분배되지 않습니다.

인트라넷과 엑스트라넷에 있는 여러 사이트와 인트라넷에만 있는 여러 사이트가 있다고 가정해 보겠습니다. 그러면 전체 사이트 집합을 식별하는 대상 VPN이 있는 인트라넷과 엑스트라넷 경로가 모두 있을 수 있습니다. 인트라넷 경로만 있는 사이트는 "잘못된" Origin VPN이 있는 모든 경로를 필터링할 수 있습니다.

이 두 가지 속성은 다양한 사이트 집합 간에 라우팅 정보 분배를 제어할 수 있는 뛰어난 유연성을 제공하며, 이는 다시 VPN을 구성하는 데 뛰어난 유연성을 제공합니다.

---
## **5. Forwarding Across the Backbone**

백본의 중간 경로에 VPN 경로에 대한 정보가 없다면, 패킷은 어떻게 한 VPN 사이트에서 다른 VPN 사이트로 전달될까요?

이 작업은 2단계 라벨 스택을 갖춘 MPLS를 통해 수행됩니다.

PE 라우터\(및 VPN-IPv4 주소를 재분배하는 ASBR\)는 백본의 IGP 라우팅 테이블에 자체적으로 /32 주소 접두사를 삽입해야 합니다. 이를 통해 백본 네트워크의 각 노드에서 MPLS가 각 PE 라우터에 경로에 해당하는 레이블을 할당할 수 있습니다. \(백본에서 레이블 교환 경로를 설정하는 특정 절차에는 /32 주소 접두사가 필요하지 않을 수 있습니다.\)

PE가 CE 장치로부터 패킷을 받으면 패킷의 대상 주소를 조회할 특정 사이트별 전달 테이블을 선택합니다. 일치 항목이 발견되었다고 가정합니다.

패킷이 같은 PE에 연결된 CE 장치로 전송되는 경우, 패킷은 해당 CE 장치로 직접 전송됩니다.

패킷이 이 동일한 PE에 연결된 CE 장치로 전송되지 않는 경우, 패킷의 "BGP Next Hop"과 패킷의 대상 주소에 할당된 BGP Next Hop 레이블이 발견됩니다. 이 레이블은 패킷의 레이블 스택에 푸시되어 최하위 레이블이 됩니다. 그런 다음 PE는 BGP Next Hop으로 가는 IGP 경로를 조회하여 IGP Next Hop과 IGP Next Hop이 BGP Next Hop의 주소에 할당한 레이블을 확인합니다. 이 레이블은 패킷의 최상위 레이블로 푸시되고 패킷은 IGP Next Hop으로 전달됩니다. \(BGP Next Hop이 IGP Next Hop과 동일한 경우 두 번째 레이블을 푸시할 필요가 없을 수 있습니다.\)

이 시점에서 MPLS는 패킷을 백본을 거쳐 적절한 CE 장치로 전달합니다. 즉, P 라우터와 PE 라우터의 모든 전달 결정은 이제 MPLS를 통해 이루어지며 패킷의 IP 헤더는 패킷이 CE 장치에 도달할 때까지 다시 확인되지 않습니다. 최종 PE 라우터는 패킷을 CE 장치로 보내기 전에 MPLS 레이블 스택에서 마지막 레이블을 팝하므로 CE 장치는 일반 IP 패킷만 보게 됩니다. \(하지만 CE가 레이블이 지정된 패킷을 수신하려는 경우에 대한 논의는 섹션 8을 참조하세요.\)

패킷이 특정 PE 라우터를 통해 특정 사이트에서 백본으로 들어오면 패킷의 경로는 해당 PE 라우터가 해당 사이트와 연관시킨 전달 테이블의 내용에 따라 결정됩니다. 패킷이 있는 PE 라우터의 전달 테이블

백본을 떠나는 것은 관련이 없습니다. 결과적으로, 특정 패킷에 대해 선택된 특정 경로가 패킷이 백본에 들어오는 사이트를 기반으로 하는 동일한 시스템에 대한 여러 경로가 있을 수 있습니다.

모든 VPN 경로를 P 라우터에서 제외할 수 있게 해주는 것은 2단계 라벨링이며, 이는 모델의 확장성을 보장하는 데 중요합니다. 백본은 PE로 가는 경로만 있으면 되고 CE로 가는 경로는 필요하지 않습니다.

---
## **6. How PEs Learn Routes from CEs**

특정 VPN에 연결된 PE 라우터는 해당 VPN의 각 사이트에 대해 해당 VPN의 어떤 주소가 각 사이트에 있는지 알아야 합니다.

CE 장치가 호스트나 스위치인 경우, 이 주소 세트는 일반적으로 해당 장치에 연결된 PE 라우터에 구성됩니다. CE 장치가 라우터인 경우, PE 라우터가 이 주소 세트를 얻을 수 있는 여러 가지 방법이 있습니다.

PE는 구성된 RD를 사용하여 이러한 주소를 VPN-IPv4 주소로 변환합니다. 그런 다음 PE는 이러한 VPN-IPv4 경로를 BGP에 대한 입력으로 처리합니다. 어떠한 경우에도 사이트의 경로가 백본의 IGP로 누출되지 않습니다.

정확히 어떤 PE/CE 경로 분배 기술이 가능한지는 특정 CE가 "트랜짓 VPN"에 있는지 여부에 따라 달라집니다. "트랜짓 VPN"은 "제3자"\(즉, VPN에 없지만 PE 라우터가 아닌 라우터\)로부터 경로를 수신하고 해당 경로를 PE 라우터로 재분배하는 라우터를 포함하는 VPN입니다. 트랜짓 VPN이 아닌 VPN은 "스텁 VPN"입니다. 거의 모든 기업 네트워크를 포함한 대부분의 VPN은 이런 의미에서 "스텁"일 것으로 예상됩니다.

가능한 PE/CE 배포 기술은 다음과 같습니다.

1. 정적 라우팅\(즉, 구성\)을 사용할 수 있습니다. \(이것은 스텁 VPN에서만 유용할 가능성이 높습니다.\)

1. PE 및 CE 라우터는 RIP 피어일 수 있으며, CE는 RIP를 사용하여 PE 라우터에 CE 라우터 사이트에서 도달할 수 있는 주소 접두사 세트를 알릴 수 있습니다. RIP가 CE에서 구성된 경우 다른 사이트의 주소 접두사\(즉, CE 라우터가 PE 라우터에서 학습한 주소 접두사\)가 PE에 광고되지 않도록 주의해야 합니다. 보다 정확하게 말해서 PE 라우터\(예: PE1\)가 VPN-IPv4 경로를 수신하는 경우

- R1이 IPv4 경로 R2를 CE에 배포하는 경우, PE2가 R2를 해당 CE 사이트에서 PE 라우터\(예: PE2\)로 다시 배포되어서는 안 됩니다\(PE1과 PE2는 같은 라우터이거나 다른 라우터일 수 있음\). 단, PE2가 R2를 R1과 다른\(즉, 다른 RD를 포함하는\) VPN-IPv4 경로에 매핑하는 경우는 예외입니다.

1. PE 및 CE 라우터는 OSPF 피어일 수 있습니다. 이 경우 사이트는 단일 OSPF 영역이어야 하고, CE는 해당 영역의 ABR이어야 하며, PE는 해당 영역에 없는 ABR이어야 합니다. 또한 PE는 동일한 사이트에 있는 CE에 대한 라우터 링크 외에는 라우터 링크를 보고하지 않아야 합니다. \(이 기술은 스텁 VPN에서만 사용해야 합니다.\)

1. PE 및 CE 라우터는 BGP 피어일 수 있으며, CE 라우터는 BGP\(특히 EBGP\)를 사용하여 PE 라우터에 CE 라우터 사이트에 있는 주소 접두사 집합을 알릴 수 있습니다. \(이 기술은 스텁 VPN 또는 트랜짓 VPN에서 사용할 수 있습니다.\)

- 순전히 기술적인 관점에서 볼 때, 이것은 지금까지 최고의 기술입니다.

```text
              a) Unlike the IGP alternatives, this does not require the
                 PE to run multiple routing algorithm instances in order
                 to talk to multiple CEs

              b) BGP is explicitly designed for just this function:
                 passing routing information between systems run by
                 different administrations

              c) If the site contains "BGP backdoors", i.e., routers
                 with BGP connections to routers other than PE routers,
                 this procedure will work correctly in all
                 circumstances.  The other procedures may or may not
                 work, depending on the precise circumstances.

              d) Use of BGP makes it easy for the CE to pass attributes
                 of the routes to the PE.  For example, the CE may
                 suggest a particular Target for each route, from among
                 the Target attributes that the PE is authorized to
                 attach to the route.

          On the other hand, using BGP is likely to be something new for
          the CE administrators, except in the case where the customer
          itself is already an Internet Service Provider (ISP).

          If a site is not in a transit VPN, note that it need not have
          a unique Autonomous System Number (ASN).  Every CE whose site
          which is not in a transit VPN can use the same ASN.  This can
          be chosen from the private ASN space, and it will be stripped
          out by the PE.  Routing loops are prevented by use of the Site
          of Origin Attribute (see below).

          If a set of sites constitute a transit VPN, it is convenient
          to represent them as a BGP Confederation, so that the internal
          structure of the VPN is hidden from any router which is not
          within the VPN.  In this case, each site in the VPN would need
          two BGP connections to the backbone, one which is internal to
          the confederation and one which is external to it.  The usual
          intra-confederation procedures would have to be slightly
          modified in order to take account for the fact that the
          backbone and the sites may have different policies.  The
          backbone is a member of the confederation on one of the
          connections, but is not a member on the other.  These
          techniques may be useful if the customer for the VPN service
          is an ISP.  This technique allows a customer that is an ISP to
          obtain VPN backbone service from one of its ISP peers.

          (However, if a VPN customer is itself an ISP, and its CE
          routers support MPLS, a much simpler technique can be used,
          wherein the ISP is regarded as a stub VPN.  See section 8.)
```

주어진 사이트에 존재하는 주소 접두사를 PE에 알리는 다양한 방법을 구별할 필요가 없을 때, PE가 해당 사이트에서 경로를 "학습"했다고 간단히 말합니다.

PE가 사이트에서 학습한 VPN-IPv4 경로를 재배포하려면 경로에 특정 속성을 지정해야 합니다. 이러한 속성은 세 가지가 있습니다.

- 원산지

- 이 속성은 PE 라우터가 경로를 학습한 사이트를 고유하게 식별합니다. 특정 사이트에서 학습한 모든 경로는 사이트가 단일 PE에 여러 개 연결되어 있거나 여러 PE에 연결되어 있더라도 동일한 Site of Origin 속성을 지정해야 합니다. 고유한 Site of Origin 속성은 고유한 사이트에 사용해야 합니다. 이 속성은 확장된 BGP 커뮤니티 속성\(섹션 4.2.1\)으로 인코딩될 수 있습니다.

- 원점 VPN

```text
        See section 4.2.1.

      - Target VPN

        See section 4.2.1.
```

---
## **7. How CEs learn Routes from PEs**

이 섹션에서는 CE 장치가 라우터라고 가정합니다.

일반적으로 PE는 PE가 해당 CE에서 패킷을 라우팅하는 데 사용하는 전달 테이블에 배치한 모든 경로를 CE에 배포할 수 있습니다. 한 가지 예외가 있습니다. 경로의 Site of Origin 속성이 특정 사이트를 식별하는 경우 해당 경로는 해당 사이트의 어떤 CE에도 재배포되어서는 안 됩니다.

그러나 대부분의 경우 PE가 CE에 기본 경로를 배포하는 것으로 충분합니다. \(어떤 경우에는 CE가 PE를 가리키는 기본 경로로 구성되는 것으로 충분할 수도 있습니다.\) 이는 일반적으로 다른 사이트에 기본 경로를 배포할 필요가 없는 모든 사이트에서 작동합니다. \(예: 기업 VPN의 한 사이트가 기업의 인터넷 액세스 권한을 가지고 있는 경우 해당 사이트는 다른 사이트에 기본 경로를 배포해야 할 수 있지만, 해당 사이트 자체에 기본 경로를 배포할 수는 없습니다.\)

CE에서 PE로 가는 경로를 분배하는 데 사용된 절차는 PE에서 CE로 가는 경로를 분배하는 데에도 사용됩니다.

---
## **8. What if the CE Supports MPLS?**

CE가 MPLS를 지원하고 VPN에서 전체 경로 세트를 가져오려는 경우 PE는 이러한 각 경로에 대한 레이블을 배포할 수 있습니다. PE가 이러한 레이블이 있는 CE로부터 패킷을 수신하면 \(a\) 해당 레이블을 BGP를 통해 학습한 해당 레이블로 대체하고 \(b\) 해당 경로에 대한 BGP 다음 홉에 해당하는 레이블을 푸시합니다.

---
### **8.1. Virtual Sites**

CE/PE 경로 분배가 BGP를 통해 수행되는 경우 CE는 MPLS를 사용하여 여러 가상 사이트를 지원할 수 있습니다. CE는 각 가상 사이트에 대한 별도의 전달 테이블을 포함할 수 있으며, PE에서 수신한 경로의 VPN 원본 및 대상 VPN 속성에 따라 채워집니다. CE가 PE에서 전체 경로 세트를 수신하는 경우 PE는 CE에서 수신한 패킷에 대해 주소 조회를 전혀 수행할 필요가 없습니다. 또는 PE는 경우에 따라 각 VPN에 대해 단일\(레이블이 지정된\) 기본 경로를 CE에 분배할 수 있습니다. 그런 다음 PE가 다음에서 레이블이 지정된 패킷을 수신하면

CE는 어떤 전달 테이블을 살펴봐야 할지 알 수 있고, CE가 패킷에 붙인 라벨은 패킷이 온 가상 사이트만 식별할 수 있습니다.

---
### **8.2. Representing an ISP VPN as a Stub VPN**

특정 VPN이 실제로 ISP이지만 CE 라우터가 MPLS를 지원하는 경우 VPN은 실제로 스텁 VPN으로 처리될 수 있습니다. CE 및 PE 라우터는 VPN 내부에 있는 경로만 교환하면 됩니다. PE 라우터는 이러한 경로 각각에 대한 레이블을 CE 라우터에 배포합니다. 그러면 VPN의 다른 사이트에 있는 라우터가 BGP 피어가 될 수 있습니다. CE 라우터가 패킷의 대상 주소를 조회할 때 라우팅 조회는 항상 내부 주소, 일반적으로 패킷의 BGP 다음 홉의 주소로 확인됩니다. CE는 패킷에 적절한 레이블을 지정하고 패킷을 PE로 보냅니다.

---
## **9. Security**

다음과 같은 조건에서:

- a\) 신뢰할 수 없거나 신뢰할 수 없는 소스에서 온 레이블이 지정된 패킷은 IP 헤더나 스택의 하위 레이블이 검사되기 전에 해당 패킷이 백본을 떠날 것이라는 사실이 알려진 경우를 제외하고는 백본 라우터에서 수락되지 않습니다.

- b\) 신뢰할 수 없거나 안정적이지 않은 소스에서 레이블이 지정된 VPN-IPv4 경로가 허용되지 않습니다.

이 아키텍처가 제공하는 보안은 프레임 릴레이나 ATM 백본이 VPN에 제공하는 보안과 사실상 동일합니다.

MPLS를 사용하면 MPLS 대신 IP 내 IP 터널링을 사용하려고 시도하는 경우보다 이 수준의 보안을 제공하는 것이 훨씬 간단해진다는 점에 주목할 가치가 있습니다. 위의 조건 중 첫 번째 조건이 적용되지 않는 한 레이블이 지정된 패킷을 수락하지 않는 것은 간단한 문제입니다. 해당 패킷이 "잘못된" 위치로 가는 IP 내 IP 터널링 패킷인 경우 라우터가 IP 패킷을 수락하지 않도록 구성하는 것은 훨씬 더 어렵습니다.

MPLS를 사용하면 VPN이 IPv4 라우팅 정보의 도메인 간 배포에 전혀 의존하지 않고 여러 SP에 걸쳐 확장될 수 있습니다.

VPN 사용자는 터널 모드 IPSEC\[5\]를 사용하여 향상된 보안을 제공할 수도 있습니다. 이에 대해서는 이 섹션의 나머지 부분에서 설명합니다.

---
### **9.1. Point-to-Point Security Tunnels between CE Routers**

보안을 중시하는 VPN 사용자는 백본을 통과하는 패킷 중 일부 또는 전부가 인증 및/또는 암호화되었는지 확인하고 싶어할 수 있습니다. 오늘날 이 기능을 얻는 표준적인 방법은 IPSEC 터널 모드를 사용하여 VPN의 모든 CE 라우터 쌍 사이에 "보안 터널"을 만드는 것입니다.

그러나 지금까지 설명한 절차는 패킷을 전송하는 CE 라우터가 패킷이 통과할 다음 CE 라우터의 식별자를 결정할 수 있도록 하지 않습니다. 그러나 그 정보는 터널 모드 IPSEC을 사용하기 위해 필요합니다. 따라서 우리는 이 정보를 사용할 수 있도록 해당 절차를 확장해야 합니다.

이를 수행하는 방법은 \[6\]에 제안되어 있습니다. 모든 VPN-IPv4 경로에는 해당 경로가 따라갈 경우 통과할 다음 CE 라우터를 식별하는 속성이 있을 수 있습니다. 이 정보가 VPN의 모든 CE 라우터에 제공되는 경우 표준 IPSEC 터널 모드를 사용할 수 있습니다.

CE와 PE가 BGP 피어인 경우 이 정보를 BGP 속성으로 표시하는 것이 자연스럽습니다.

IPSEC을 사용할 각 CE는 주소 접두사 집합으로 구성되어야 하며, 해당 주소 중 어느 주소에도 안전하지 않은 트래픽을 보내는 것이 금지되어야 합니다. 이렇게 하면 어떤 이유로든 필요한 정보를 얻지 못하는 경우 CE가 안전하지 않은 트래픽을 보내는 것을 방지할 수 있습니다.

MPLS가 IPSEC 터널의 두 엔드포인트 간에 패킷을 전달하는 데 사용될 때 IPSEC 외부 헤더는 실제로 어떤 기능도 수행하지 않습니다. MPLS를 사용할 때 외부 헤더를 생략할 수 있는 IPSEC 터널 모드의 형태를 개발하는 것이 유익할 수 있습니다.

---
### **9.2. Multi-Party Security Associations**

각 CE 라우터 쌍 사이에 보안 터널을 설정하는 대신, 단일의 다중 당사자 보안 연결을 설정하는 것이 유리할 수 있습니다. 이러한 보안 연결에서 특정 VPN에 있는 모든 CE 라우터는 동일한 보안 매개변수\(예: 동일한 비밀, 동일한 알고리즘 등\)를 공유합니다. 그러면 인그레스 CE는 다음에 데이터를 수신할 CE가 누구인지 알 필요가 없고, 데이터가 어느 VPN으로 가는지만 알면 됩니다. 여러 VPN에 있는 CE는 각각에 대해 다른 보안 매개변수를 사용하여, 예를 들어 인트라넷 패킷이 엑스트라넷에 노출되는 것을 방지할 수 있습니다.

이러한 방식을 사용하면 표준 터널 모드 IPSEC을 사용할 수 없습니다. "외부 헤더"의 IP 대상 주소 필드를 채울 방법이 없기 때문입니다. 그러나 MPLS를 포워딩에 사용하는 경우 이 외부 헤더가 실제로 필요하지 않습니다. PE 라우터는 MPLS를 사용하여 해당 엔드포인트의 IP 주소를 알지 않고도 패킷을 터널 엔드포인트로 가져올 수 있습니다. "내부 헤더"의 IP 대상 주소만 보면 됩니다.

이와 같은 계획의 중요한 이점은 라우팅 변경\(특히 특정 주소 접두사에 대한 이그레스 CE 변경\)을 보안 메커니즘에 투명하게 만든다는 것입니다. 이는 다중 공급자 VPN의 경우 특히 중요할 수 있는데, 보안 메커니즘을 지원하기 위해 이러한 라우팅 변경에 대한 정보를 배포해야 하는 경우 확장성 문제가 발생할 수 있습니다.

또 다른 장점은 MPLS 캡슐화가 그 역할을 수행하므로 외부 IP 헤더가 필요 없다는 것입니다.

---
## **10. Quality of Service**

이 논문의 초점은 아니지만 서비스 품질은 모든 VPN 서비스의 핵심 구성 요소입니다.MPLS/BGP VPN에서 기존 L3 QoS 기능은 shim 헤더의 "실험적" 비트\[10\]를 사용하거나 ATM이 백본으로 사용되는 경우 ATM QoS 기능을 사용하여 레이블이 지정된 패킷에 적용할 수 있습니다.\[1\]에서 논의된 트래픽 엔지니어링 작업도 MPLS/BGP VPN에 직접 적용할 수 있습니다.트래픽 엔지니어링은 원하는 경우 특정 사이트 쌍 간에 특정 QoS 특성을 가진 LSP를 설정하는 데 사용될 수도 있습니다.MPLS/BGP VPN이 여러 SP에 걸쳐 있는 경우 \[7\]에 설명된 아키텍처가 유용할 수 있습니다.SP는 적절한 경우 특정 VPN에 intserv 또는 diffserv 기능을 적용할 수 있습니다.

---
## **11. Scalability**

이 논문 전반에 걸쳐 확장성 문제를 논의했습니다. 이 섹션에서는 확장성과 관련하여 우리 모델의 주요 특징을 간략하게 요약합니다.

서비스 제공자 백본 네트워크는 \(a\) PE 라우터, \(b\) BGP 경로 리플렉터, \(c\) P 라우터\(PE 라우터도 경로 리플렉터도 아님\) 및 다중 제공자 VPN의 경우 \(d\) ASBR로 구성됩니다.

P 라우터는 VPN 경로를 유지하지 않습니다. VPN 트래픽을 제대로 전달하기 위해 P 라우터는 PE 라우터와 ASBR로의 경로만 유지하면 됩니다. 두 가지 레벨의 라벨링을 사용하면 VPN 경로를 P 라우터 밖에 둘 수 있습니다.

PE 라우터는 VPN 경로를 유지 관리하지만 직접 연결된 VPN에 대해서만 경로를 유지합니다.

경로 리플렉터와 ASBR은 VPN 간에 분할될 수 있으므로 각 분할은 서비스 제공자가 제공하는 VPN의 하위 집합에 대한 경로만 전달합니다. 따라서 모든 VPN에 대한 경로를 유지하는 데 단일 경로 리플렉터나 ASBR이 필요하지 않습니다.

결과적으로 서비스 제공자 네트워크 내의 단일 구성 요소는 모든 VPN에 대한 모든 경로를 유지할 필요가 없습니다. 따라서 증가하는 수의 VPN을 지원하기 위한 네트워크의 총 용량은 개별 구성 요소의 용량에 의해 제한되지 않습니다.

---
## **12. Intellectual Property Considerations**

Cisco Systems는 이 문서에 공개된 모든 기술 중 일부에 대한 특허 또는 기타 지적 재산권 보호를 추구할 수 있습니다. 이 문서에서 발생하는 표준이 Cisco Systems에 할당된 하나 이상의 특허로 보호되거나 보호되는 경우 Cisco는 해당 특허를 공개하고 합리적이고 차별 없는 조건으로 라이선스를 부여할 의도가 있습니다.

---
## **13. Security Considerations**

보안 문제는 이 메모 전체에서 논의됩니다.

---
## **14. Acknowledgments**

이 작업에 큰 기여를 한 사람은 라비 찬드라, 댄 타판, 밥 토마스입니다.

---
## **15. Authors' Addresses**

```text
   Eric C. Rosen
   Cisco Systems, Inc.
   250 Apollo Drive
   Chelmsford, MA, 01824

   EMail: erosen@cisco.com

   Yakov Rekhter
   Cisco Systems, Inc.
   170 Tasman Drive
   San Jose, CA, 95134

   EMail: yakov@cisco.com
```

---
## **16. References**

\[1\] Awduche, Berger, Gan, Li, Swallow 및 Srinavasan, "LSP 터널을 위한 RSVP 확장", 진행 중인 작업.

\[2\] Bates, T. 및 R. Chandrasekaran, "BGP 경로 반사: 전체 메시 IBGP에 대한 대안", RFC 1966, 1996년 6월.

\[3\] Bates, T., Chandra, R., Katz, D. 및 Y. Rekhter, "BGP4에 대한 다중 프로토콜 확장", RFC 2283, 1998년 2월.

\[4\] Gleeson, Heinanen 및 Armitage, "IP 기반 가상 사설망을 위한 프레임워크", 진행 중인 작업.

\[5\] Kent 및 Atkinson, "인터넷을 위한 보안 아키텍처 - 프로토콜", RFC 2401, 1998년 11월.

\[6\] Li, "MPLS를 사용하는 CPE 기반 VPN", 1998년 10월, 진행 중.

\[7\] Li, T. 및 Y. Rekhter, "차별화된 서비스 및 트래픽 엔지니어링\(PASTE\)을 위한 공급자 아키텍처", RFC 2430, 1998년 10월.

\[8\] Rekhter 및 Rosen, "BGP4에서 레이블 정보 전달", 작업 진행 중.

\[9\] Rosen, Viswanathan 및 Callon, "다중 프로토콜 레이블 전환 - 아키텍처", 진행 중인 작업.

\[10\] Rosen, Rekhter, Tappan, Farinacci, Fedorkow, Li 및 Conta, "MPLS 레이블 스택 인코딩", 진행 중인 작업.

---
## **17.  Full Copyright Statement**

저작권\(C\)인터넷학회\(1999\). 판권 소유.

본 문서와 그 번역본은 다른 사람에게 복사 및 제공될 수 있으며, 본 문서에 대해 논평하거나 설명하거나 구현을 지원하는 파생 저작물은 어떤 종류의 제한 없이 전체 또는 일부를 준비, 복사, 출판 및 배포할 수 있습니다. 단, 위의 저작권 표시와 이 단락은 모든 사본과 파생물에 포함되어 있어야 합니다. 그러나 이 문서 자체는 저작권 표시를 제거하거나 인터넷 협회 또는 기타 인터넷 조직에 대한 참조를 제거하는 등 어떠한 방식으로도 수정할 수 없습니다. 단, 인터넷 표준을 개발할 목적으로 필요한 경우는 제외됩니다. 이 경우 저작권에 대한 절차는 인터넷 표준 프로세스를 따라야 하거나 영어 이외의 언어로 번역하려면 필요한 대로 따라야 합니다.

위에 부여된 제한된 권한은 영구적이며 Internet Society 또는 그 승계자 또는 양수인에 의해 취소되지 않습니다.

이 문서와 여기에 포함된 정보는 "있는 그대로" 제공되며 인터넷 사회와 인터넷 엔지니어링 태스크 포스는 여기에 있는 정보의 사용으로 인해 발생하지 않는 모든 보증을 포함하되 이에 국한되지 않고 명시적이든 묵시적이든 모든 보증을 부인합니다. 특정 목적에 대한 상품성이나 적합성에 대한 권리나 묵시적인 보증을 침해하는 행위.