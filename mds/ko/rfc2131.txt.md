

```text
Network Working Group                                           R. Droms
Request for Comments: 2131                           Bucknell University
Obsoletes: 1541                                               March 1997
Category: Standards Track

                  Dynamic Host Configuration Protocol
```

---
# **Status of this memo**

이 문서는 인터넷 커뮤니티를 위한 인터넷 표준 추적 프로토콜을 지정하고 개선을 위한 토론 및 제안을 요청합니다. 이 프로토콜의 표준화 상태 및 상태에 대해서는 "Internet Official Protocol Standards"\(STD 1\) 최신판을 참조하십시오. 이 메모의 배포는 무제한입니다.

---
# **Abstract**

DHCP\(동적 호스트 구성 프로토콜\)는 TCPIP 네트워크의 호스트에 구성 정보를 전달하기 위한 프레임워크를 제공합니다. DHCP는 BOOTP\(Bootstrap Protocol\)\[7\]를 기반으로 하며 재사용 가능한 네트워크 주소의 자동 할당 기능과 추가 구성 옵션\[19\]을 추가합니다. DHCP는 BOOTP 중계 에이전트의 동작을 캡처하며\[7, 21\], DHCP 참가자는 BOOTP 참가자와 상호 운용할 수 있습니다\[9\].

---
# **Table of Contents**

```text
   1.  Introduction. . . . . . . . . . . . . . . . . . . . . . . . .  2
   1.1 Changes to RFC1541. . . . . . . . . . . . . . . . . . . . . .  3
   1.2 Related Work. . . . . . . . . . . . . . . . . . . . . . . . .  4
   1.3 Problem definition and issues . . . . . . . . . . . . . . . .  4
   1.4 Requirements. . . . . . . . . . . . . . . . . . . . . . . . .  5
   1.5 Terminology . . . . . . . . . . . . . . . . . . . . . . . . .  6
   1.6 Design goals. . . . . . . . . . . . . . . . . . . . . . . . .  6
   2.  Protocol Summary. . . . . . . . . . . . . . . . . . . . . . .  8
   2.1 Configuration parameters repository . . . . . . . . . . . . . 11
   2.2 Dynamic allocation of network addresses . . . . . . . . . . . 12
   3.  The Client-Server Protocol. . . . . . . . . . . . . . . . . . 13
   3.1 Client-server interaction - allocating a network address. . . 13
   3.2 Client-server interaction - reusing a  previously allocated
       network address . . . . . . . . . . . . . . . . . . . . . . . 17
   3.3 Interpretation and representation of time values. . . . . . . 20
   3.4 Obtaining parameters with externally configured network
       address . . . . . . . . . . . . . . . . . . . . . . . . . . . 20
   3.5 Client parameters in DHCP . . . . . . . . . . . . . . . . . . 21
   3.6 Use of DHCP in clients with multiple interfaces . . . . . . . 22
   3.7 When clients should use DHCP. . . . . . . . . . . . . . . . . 22
   4.  Specification of the DHCP client-server protocol. . . . . . . 22
   4.1 Constructing and sending DHCP messages. . . . . . . . . . . . 22
   4.2 DHCP server administrative controls . . . . . . . . . . . . . 25
   4.3 DHCP server behavior. . . . . . . . . . . . . . . . . . . . . 26
   4.4 DHCP client behavior. . . . . . . . . . . . . . . . . . . . . 34
   5.  Acknowledgments. . . . . . . . . . . . . . . . . . . . . . . .42
   6.  References . . . . . . . . . . . . . . . . . . . . . . . . . .42
   7.  Security Considerations. . . . . . . . . . . . . . . . . . . .43
   8.  Author's Address . . . . . . . . . . . . . . . . . . . . . . .44
   A.  Host Configuration Parameters  . . . . . . . . . . . . . . . .45
List of Figures
   1. Format of a DHCP message . . . . . . . . . . . . . . . . . . .  9
   2. Format of the 'flags' field. . . . . . . . . . . . . . . . . . 11
   3. Timeline diagram of messages exchanged between DHCP client and
      servers when allocating a new network address. . . . . . . . . 15
   4. Timeline diagram of messages exchanged between DHCP client and
      servers when reusing a previously allocated network address. . 18
   5. State-transition diagram for DHCP clients. . . . . . . . . . . 34
List of Tables
   1. Description of fields in a DHCP message. . . . . . . . . . . . 10
   2. DHCP messages. . . . . . . . . . . . . . . . . . . . . . . . . 14
   3. Fields and options used by DHCP servers. . . . . . . . . . . . 28
   4. Client messages from various states. . . . . . . . . . . . . . 33
   5. Fields and options used by DHCP clients. . . . . . . . . . . . 37
```

---
## **1. Introduction**

DHCP\(동적 호스트 구성 프로토콜\)는 인터넷 호스트에 구성 매개변수를 제공합니다. DHCP는 두 가지 구성요소, 즉 DHCP 서버에서 호스트로 호스트별 구성 매개변수를 전달하기 위한 프로토콜과 호스트에 네트워크 주소를 할당하기 위한 메커니즘으로 구성됩니다.

DHCP는 지정된 DHCP 서버 호스트가 네트워크 주소를 할당하고 동적으로 구성된 호스트에 구성 매개변수를 전달하는 클라이언트-서버 모델을 기반으로 구축되었습니다. 이 문서의 나머지 부분에서 "서버"라는 용어는 DHCP를 통해 초기화 매개변수를 제공하는 호스트를 의미하고, "클라이언트"라는 용어는 DHCP 서버에 초기화 매개변수를 요청하는 호스트를 의미합니다.

시스템 관리자가 명시적으로 구성하지 않는 한 호스트는 DHCP 서버 역할을 해서는 안 됩니다. 인터넷의 하드웨어 및 프로토콜 구현의 다양성으로 인해 임의의 호스트가 DHCP 요청에 응답하도록 허용되면 안정적인 작동이 불가능해집니다. 예를 들어 IP의 경우 프로토콜 구현 소프트웨어 내에서 많은 매개변수 설정이 필요합니다. IP는 다양한 종류의 네트워크 하드웨어에서 사용될 수 있으므로 해당 매개변수의 값을 추측하거나 올바른 기본값을 가지고 있다고 가정할 수 없습니다. 또한 분산 주소 할당 방식은 폴링/방어에 따라 달라집니다.

이미 사용 중인 주소를 검색하는 메커니즘입니다. IP 호스트는 자신의 네트워크 주소를 항상 방어할 수 있는 것은 아니므로 이러한 분산 주소 할당 방식은 중복된 네트워크 주소 할당을 방지할 수 있다고 보장할 수 없습니다.

DHCP는 IP 주소 할당을 위한 세 가지 메커니즘을 지원합니다. "자동 할당"에서는 DHCP가 클라이언트에 영구 IP 주소를 할당합니다. "동적 할당"에서 DHCP는 제한된 기간 동안\(또는 클라이언트가 명시적으로 주소를 포기할 때까지\) 클라이언트에 IP 주소를 할당합니다. "수동 할당"에서는 네트워크 관리자가 클라이언트의 IP 주소를 할당하고 DHCP는 단순히 할당된 주소를 클라이언트에 전달하는 데 사용됩니다. 특정 네트워크는 네트워크 관리자의 정책에 따라 이러한 메커니즘 중 하나 이상을 사용합니다.

동적 할당은 주소가 할당된 클라이언트에 더 이상 필요하지 않은 주소의 자동 재사용을 허용하는 세 가지 메커니즘 중 유일한 것입니다. 따라서 동적 할당은 일시적으로만 네트워크에 연결될 클라이언트에 주소를 할당하거나 영구 IP 주소가 필요하지 않은 클라이언트 그룹 간에 제한된 IP 주소 풀을 공유하는 데 특히 유용합니다. 동적 할당은 IP 주소가 충분히 부족하여 기존 클라이언트가 폐기될 때 이를 회수하는 것이 중요한 네트워크에 영구적으로 연결된 새 클라이언트에 IP 주소를 할당하는 데에도 좋은 선택이 될 수 있습니다. 수동 할당을 사용하면 어떤 이유로든 DHCP 메커니즘 외부에서 IP 주소 할당을 관리하는 것이 바람직한 환경에서 IP 주소로 호스트를 수동으로 구성하는 오류가 발생하기 쉬운 프로세스를 제거하기 위해 DHCP를 사용할 수 있습니다.

DHCP 메시지의 형식은 BOOTP 사양\[7, 21\]의 일부로 설명된 BOOTP 중계 에이전트 동작을 캡처하고 기존 BOOTP 클라이언트와 DHCP 서버의 상호 운용성을 허용하기 위해 BOOTP 메시지 형식을 기반으로 합니다. BOOTP 릴레이 에이전트를 사용하면 각 물리적 네트워크 세그먼트에 DHCP 서버가 필요하지 않습니다.

---
## **1.1 Changes to RFC 1541**

이 문서는 RFC1541에 나타나는 DHCP 프로토콜 사양을 업데이트합니다. 새로운 DHCP 메시지 유형인 DHCPINFORM이 추가되었습니다. 자세한 내용은 섹션 3.4, 4.3 및 4.4를 참조하세요. DHCP 서버에 대해 DHCP 클라이언트를 식별하는 클래스 메커니즘은 섹션 4.2 및 4.3에 정의된 "공급업체" 클래스를 포함하도록 확장되었습니다. 최소 임대 시간 제한이 제거되었습니다. 마지막으로, DHCP 상호 운용성 테스트에서 얻은 경험을 바탕으로 텍스트를 명확하게 하기 위해 많은 편집 변경이 이루어졌습니다.

---
## **1.2 Related Work**

동적 호스트 구성 문제의 일부를 해결하는 여러 가지 인터넷 프로토콜 및 관련 메커니즘이 있습니다. 역방향 주소 확인 프로토콜\(RARP\)\[10\]\(동적 RARP\(DRARP\)\[5\]에 정의된 확장을 통해\)은 네트워크 주소 검색 문제를 명시적으로 해결하고 자동 IP 주소 할당 메커니즘을 포함합니다. TFTP\(Trivial File Transfer Protocol\)\[20\]는 부팅 서버에서 부팅 이미지를 전송하는 기능을 제공합니다. ICMP\(Internet Control Message Protocol\)\[16\]는 "ICMP 리디렉션" 메시지를 통해 호스트에 추가 라우터를 알리는 기능을 제공합니다. ICMP는 또한 "ICMP 마스크 요청" 메시지를 통해 서브넷 마스크 정보를 제공하고 \(구식\) "ICMP 정보 요청" 메시지를 통해 기타 정보를 제공할 수 있습니다. 호스트는 ICMP 라우터 검색 메커니즘을 통해 라우터를 찾을 수 있습니다\[8\].

BOOTP는 구성 정보 수집을 위한 전송 메커니즘입니다. BOOTP는 확장 가능하며 여러 구성 매개변수에 대해 공식 확장\[17\]이 정의되었습니다. Morgan은 동적 IP 주소 할당을 위해 BOOTP 확장을 제안했습니다\[15\]. MIT의 Athena 프로젝트에서 사용하는 NIP\(Network Information Protocol\)는 동적 IP 주소 할당을 위한 분산 메커니즘입니다\[19\]. 리소스 위치 프로토콜\(Resource Location Protocol\) RLP\[1\]는 더 높은 수준의 서비스 위치를 제공합니다. Sun Microsystems의 디스크 없는 워크스테이션은 구성 정보와 운영 체제 코드를 디스크 없는 호스트에 전달하기 위해 RARP, TFTP 및 "bootparams"라는 RPC 메커니즘을 사용하는 부팅 절차를 사용합니다. \(Sun Microsystems, Sun Workstation 및 SunOS는 Sun Microsystems, Inc.의 상표입니다.\) 또한 일부 Sun 네트워크는 DRARP 및 자동 설치 메커니즘을 사용하여 기존 네트워크에서 새 호스트 구성을 자동화합니다.

다른 관련 작업에서는 경로 최소 전송 단위\(MTU\) 검색 알고리즘이 임의의 인터넷 경로의 MTU를 결정할 수 있습니다\[14\]. 자원 위치 및 선택을 위한 전송 프로토콜로 ARP\(Address Resolution Protocol\)가 제안되었습니다\[6\]. 마지막으로 호스트 요구 사항 RFC \[3, 4\]에서는 호스트 재구성을 위한 특정 요구 사항을 언급하고 디스크 없는 호스트의 초기 구성에 대한 시나리오를 제안합니다.

---
## **1.3 Problem definition and issues**

DHCP는 호스트 요구 사항 RFC에 정의된 구성 매개 변수를 DHCP 클라이언트에 제공하도록 설계되었습니다. DHCP를 통해 매개변수를 얻은 후 DHCP 클라이언트는 인터넷의 다른 호스트와 패킷을 교환할 수 있어야 합니다. DHCP가 제공하는 TCP/IP 스택 매개변수는 부록 A에 나열되어 있습니다.

새로 초기화된 클라이언트에 이러한 매개변수가 모두 필요한 것은 아닙니다. 클라이언트와 서버는 클라이언트가 필요로 하거나 특정 서브넷에 특정한 매개변수만 전송하도록 협상할 수 있습니다.

DHCP는 IP 프로토콜과 직접적으로 관련되지 않은 클라이언트 매개변수의 구성을 허용하지만 요구하지는 않습니다. 또한 DHCP는 DNS\(Domain Name System\)를 사용하여 새로 구성된 클라이언트의 등록을 처리하지 않습니다\[12, 13\].

DHCP는 라우터 구성에 사용하기 위한 것이 아닙니다.

---
## **1.4 Requirements**

이 문서 전체에서 특정 요구 사항의 중요성을 정의하는 데 사용되는 단어는 대문자로 표시됩니다. 이 단어들은 다음과 같습니다:

```text
      o "MUST"
```

이 단어 또는 형용사 "필수"는 다음을 의미합니다.

- 항목은 본 사양의 절대 요구 사항입니다.\(MUST\)

```text
      o "MUST NOT"
```

- 이 문구는 해당 품목이 본 사양에 절대 금지됨을 의미합니다.

```text
      o "SHOULD"
```

- 이 단어 또는 형용사 "권장"은 특정 상황에서 이 항목을 무시할 타당한 이유가 있을 수 있지만 다른 과정을 선택하기 전에 전체 의미를 이해하고 사례를 신중하게 검토해야 함을 의미합니다.\(SHOULD\)

```text
      o "SHOULD NOT"
```

이 문구는 타당한 이유가 있을 수 있음을 의미합니다.

- 나열된 동작이 허용 가능하거나 유용할 수도 있지만, 이 레이블로 설명된 동작을 구현하기 전에 전체 의미를 이해하고 사례를 주의 깊게 평가해야 하는 특정 상황입니다.

```text
      o "MAY"
```

- 이 단어나 "OPTIONAL"이라는 형용사는 이 항목이 실제로 선택 사항임을 의미합니다. 한 공급업체는 특정 시장에서 요구하거나 제품을 향상시키기 때문에 해당 항목을 포함하도록 선택할 수 있습니다. 다른 판매자가 동일한 항목을 생략할 수 있습니다.\(MAY\)

---
## **1.5 Terminology**

이 문서에서는 다음 용어를 사용합니다.

```text
      o "DHCP client"
```

DHCP 클라이언트는 DHCP를 사용하여 정보를 얻는 인터넷 호스트입니다.

- 네트워크 주소와 같은 구성 매개변수.

```text
      o "DHCP server"
```

- DHCP 서버는 DHCP 클라이언트에 구성 매개변수를 반환하는 인터넷 호스트입니다.

```text
      o "BOOTP relay agent"
```

- BOOTP 릴레이 에이전트 또는 릴레이 에이전트는 DHCP 클라이언트와 DHCP 서버 간에 DHCP 메시지를 전달하는 인터넷 호스트 또는 라우터입니다. DHCP는 BOOTP 프로토콜 사양에 지정된 것과 동일한 릴레이 에이전트 동작을 사용하도록 설계되었습니다.

```text
      o "binding"
```

- 바인딩은 DHCP 클라이언트와 연결되거나 "바인딩"되는 최소한 IP 주소를 포함하는 구성 매개변수의 모음입니다. 바인딩은 DHCP 서버에 의해 관리됩니다.

---
## **1.6 Design goals**

다음 목록은 DHCP의 일반적인 설계 목표를 제공합니다.

- o DHCP는 정책이라기보다는 메커니즘이어야 합니다. DHCP는 원하는 경우 로컬 시스템 관리자가 구성 매개변수를 제어할 수 있도록 허용해야 합니다. 예를 들어, 로컬 시스템 관리자는 원하는 경우 로컬 리소스 할당 및 액세스에 관한 로컬 정책을 시행할 수 있어야 합니다.

- o 클라이언트에는 수동 구성이 필요하지 않습니다. 각 클라이언트는 사용자 개입 없이 적절한 로컬 구성 매개변수를 검색하고 해당 매개변수를 자체 구성에 통합할 수 있어야 합니다.

- o 네트워크는 개별 클라이언트에 대해 수동 구성을 요구하지 않아야 합니다. 일반적인 상황에서는 네트워크 관리자가 클라이언트별 구성 매개변수를 입력할 필요가 없습니다.

- o DHCP는 각 서브넷에 서버를 요구해서는 안 됩니다. 규모와 경제성을 고려하려면 DHCP는 라우터 전반에서 작동하거나 BOOTP 중계 에이전트의 개입을 통해 작동해야 합니다.

- o DHCP 클라이언트는 구성 매개변수 요청에 대한 다중 응답을 수신할 준비가 되어 있어야 합니다. 일부 설치에는 안정성을 높이고 성능을 높이기 위해 여러 개의 겹치는 DHCP 서버가 포함될 수 있습니다.

- o DHCP는 정적으로 구성된 비참여 호스트 및 기존 네트워크 프로토콜 구현과 공존해야 합니다.

- o DHCP는 RFC 951 및 RFC 1542\[21\]에 설명된 대로 BOOTP 중계 에이전트 동작과 상호 운용되어야 합니다.

- o DHCP는 기존 BOOTP 클라이언트에 서비스를 제공해야 합니다.

다음 목록은 네트워크 계층 매개변수 전송과 관련된 설계 목표를 제공합니다. DHCP는 다음을 수행해야 합니다.

- o 특정 네트워크 주소가 한 번에 둘 이상의 DHCP 클라이언트에서 사용되지 않도록 보장합니다.

- o DHCP 클라이언트 재부팅 시에도 DHCP 클라이언트 구성을 유지합니다. DHCP 클라이언트는 가능할 때마다 각 요청에 대한 응답으로 동일한 구성 매개변수\(예: 네트워크 주소\)를 할당받아야 합니다.

- o 서버 재부팅 시에도 DHCP 클라이언트 구성을 유지하고, 가능한 경우 DHCP 메커니즘을 다시 시작해도 DHCP 클라이언트에 동일한 구성 매개변수를 할당해야 합니다.

- o 새 클라이언트에 대한 수동 구성을 방지하기 위해 새 클라이언트에 구성 매개변수 자동 할당을 허용합니다.

o 고정 또는 영구 구성 할당 지원

- 특정 클라이언트에 대한 매개변수입니다.

---
## **2. Protocol Summary**

클라이언트의 관점에서 보면 DHCP는 BOOTP 메커니즘의 확장입니다. 이 동작을 통해 기존 BOOTP 클라이언트는 클라이언트의 초기화 소프트웨어를 변경하지 않고도 DHCP 서버와 상호 운용할 수 있습니다. RFC 1542\[2\]는 BOOTP와 DHCP 클라이언트 및 서버 사이의 상호 작용을 자세히 설명합니다\[9\]. 섹션 3과 4에 설명된 DHCP 클라이언트와 서버 간의 상호 작용을 최적화하는 몇 가지 새로운 선택적 트랜잭션이 있습니다.

그림 1은 DHCP 메시지의 형식을 제공하고 표 1은 DHCP 메시지의 각 필드를 설명합니다. 괄호 안의 숫자는 각 필드의 크기\(옥텟\)를 나타냅니다. 그림에 제공된 필드 이름은 이 문서 전체에서 DHCP 메시지의 필드를 참조하는 데 사용됩니다.

DHCP와 BOOTP에는 두 가지 주요 차이점이 있습니다. 첫째, DHCP는 유한 임대를 위해 클라이언트에 네트워크 주소를 할당할 수 있는 메커니즘을 정의하여 다른 클라이언트에 네트워크 주소를 직렬로 재할당할 수 있도록 합니다. 둘째, DHCP는 클라이언트가 작동하는 데 필요한 모든 IP 구성 매개변수를 획득할 수 있는 메커니즘을 제공합니다.

```text
   DHCP introduces a small change in terminology intended to clarify the
   meaning of one of the fields.  What was the "vendor extensions" field
   in BOOTP has been re-named the "options" field in DHCP. Similarly,
   the tagged data items that were used inside the BOOTP "vendor
   extensions" field, which were formerly referred to as "vendor
   extensions," are now termed simply "options."

   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     op (1)    |   htype (1)   |   hlen (1)    |   hops (1)    |
   +---------------+---------------+---------------+---------------+
   |                            xid (4)                            |
   +-------------------------------+-------------------------------+
   |           secs (2)            |           flags (2)           |
   +-------------------------------+-------------------------------+
   |                          ciaddr  (4)                          |
   +---------------------------------------------------------------+
   |                          yiaddr  (4)                          |
   +---------------------------------------------------------------+
   |                          siaddr  (4)                          |
   +---------------------------------------------------------------+
   |                          giaddr  (4)                          |
   +---------------------------------------------------------------+
   |                                                               |
   |                          chaddr  (16)                         |
   |                                                               |
   |                                                               |
   +---------------------------------------------------------------+
   |                                                               |
   |                          sname   (64)                         |
   +---------------------------------------------------------------+
   |                                                               |
   |                          file    (128)                        |
   +---------------------------------------------------------------+
   |                                                               |
   |                          options (variable)                   |
   +---------------------------------------------------------------+
```

- 그림 1: DHCP 메시지 형식

DHCP는 명시적인 클라이언트 식별자를 DHCP 서버에 전달하는 데 사용되는 새로운 '클라이언트 식별자' 옵션을 정의합니다. 이 변경으로 인해 BOOTP 메시지에서 'chaddr' 필드의 오버로드가 제거됩니다. 여기서 'chaddr'은 BOOTP 응답 메시지 전송을 위한 하드웨어 주소와 클라이언트 식별자로 모두 사용됩니다. '클라이언트 식별자'는 불투명한 키이므로 서버에서 해석할 수 없습니다. 예를 들어 '클라이언트 식별자'에는 'chaddr' 필드의 내용과 동일한 하드웨어 주소가 포함될 수도 있고, DNS 이름과 같은 다른 유형의 식별자가 포함될 수도 있습니다. DHCP 클라이언트가 선택한 '클라이언트 식별자'는 클라이언트가 연결된 서브넷 내에서 해당 클라이언트에 대해 고유해야 합니다. 클라이언트가 하나의 메시지에서 '클라이언트 식별자'를 사용하는 경우 모든 서버가 클라이언트를 올바르게 식별하도록 보장하기 위해 모든 후속 메시지에서 동일한 식별자를 사용해야 합니다.\(MUST, MUST\)

DHCP는 클라이언트 부트스트랩 프로세스의 다음 단계에서 사용할 서버 주소로 'siaddr' 필드의 해석을 명확히 합니다. 서버가 다음 부트스트랩 서비스\(예: 운영 체제 실행 가능 이미지 전달\)를 제공할 준비가 된 경우 DHCP 서버는 'siaddr' 필드에 자체 주소를 반환할 수 있습니다. DHCP 서버는 항상 '서버 식별자' 옵션에 자신의 주소를 반환합니다.

```text
   FIELD      OCTETS       DESCRIPTION
   -----      ------       -----------
```

op 1 메시지 op 코드/메시지 유형.

- 1 = BOOTREQUEST, 2 = BOOTREPLY htype 1 하드웨어 주소 유형, "할당된 번호" RFC의 ARP 섹션을 참조하세요. 예: '1' = 10MB 이더넷. hlen 1 하드웨어 주소 길이\(예: 10MB 이더넷의 경우 '6'\). hops 1 클라이언트는 0으로 설정되며 선택적으로 릴레이 에이전트를 통해 부팅할 때 릴레이 에이전트에 의해 사용됩니다. xid 4 클라이언트가 선택한 임의의 숫자인 트랜잭션 ID는 클라이언트와 서버가 클라이언트와 서버 간의 메시지와 응답을 연결하는 데 사용됩니다. secs 2 클라이언트가 입력한 값으로, 클라이언트가 주소 획득 또는 갱신 프로세스를 시작한 이후 경과된 시간\(초\)입니다. 플래그 2 플래그\(그림 2 참조\). ciaddr 4 클라이언트 IP 주소; 클라이언트가 BOUND, RENEW 또는 REBINDING 상태이고 ARP 요청에 응답할 수 있는 경우에만 채워집니다. yiaddr 4 '귀하의'\(클라이언트\) IP 주소. siaddr 4 부트스트랩에 사용할 다음 서버의 IP 주소; 서버에 의해 DHCPOFFER, DHCPACK로 반환되었습니다. giaddr 4 릴레이 에이전트를 통한 부팅에 사용되는 릴레이 에이전트 IP 주소입니다. chaddr 16 클라이언트 하드웨어 주소입니다. sname 64 선택적 서버 호스트 이름, null로 끝나는 문자열. file 128 부팅 파일 이름, null로 끝나는 문자열; "일반" 이름 또는 DHCPDISCOVER의 null, DHCPOFFER의 정규화된 디렉터리 경로 이름입니다. options var 선택적 매개변수 필드입니다. 정의된 옵션 목록은 옵션 문서를 참조하세요.

```text
           Table 1:  Description of fields in a DHCP message
```

이제 '옵션' 필드는 가변 길이입니다. DHCP 클라이언트는 길이가 312 옥텟 이상인 '옵션' 필드가 포함된 DHCP 메시지를 수신할 준비가 되어 있어야 합니다. 이 요구 사항은 DHCP 클라이언트가 최소 IP 주소인 최대 576옥텟의 메시지를 수신할 준비가 되어 있어야 함을 의미합니다.

IP 호스트는 데이터그램 크기를 수용할 수 있도록 준비해야 합니다 \[3\]. DHCP 클라이언트는 '최대 DHCP 메시지 크기' 옵션을 통해 더 큰 DHCP 메시지 사용을 협상할 수 있습니다. 옵션 필드는 'file' 및 'sname' 필드로 더 확장될 수 있습니다.

클라이언트가 초기 구성을 위해 DHCP를 사용하는 경우\(클라이언트의 TCP/IP 소프트웨어가 완전히 구성되기 전\) DHCP는 클라이언트의 TCP/IP 소프트웨어를 창의적으로 사용하고 RFC 1122를 자유롭게 해석해야 합니다. TCP/IP 소프트웨어는 허용해야 합니다. IP 주소가 구성되기 전에 클라이언트의 하드웨어 주소로 전달된 모든 IP 패킷을 IP 계층으로 전달합니다. DHCP 서버와 BOOTP 중계 에이전트는 TCP/IP 소프트웨어가 구성되기 전에 하드웨어 유니캐스트 데이터그램을 받아들일 수 없는 클라이언트에 DHCP 메시지를 전달하지 못할 수도 있습니다.\(SHOULD\)

이전 단락에서 설명한 대로 TCP/IP 소프트웨어가 구성되기 전에 IP 유니캐스트 데이터그램을 수락할 수 없는 일부 클라이언트를 해결하기 위해 DHCP는 '플래그' 필드를 사용합니다\[21\]. 가장 왼쪽 비트는 BROADCAST\(B\) 플래그로 정의됩니다. 이 플래그의 의미는 이 문서의 섹션 4.1에서 논의됩니다. 플래그 필드의 나머지 비트는 향후 사용을 위해 예약되어 있습니다. 클라이언트는 이를 0으로 설정해야 하며 서버 및 릴레이 에이전트는 이를 무시해야 합니다. 그림 2는 '플래그' 필드의 형식을 보여줍니다.\(MUST\)

```text
                                    1 1 1 1 1 1
                0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
                +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                |B|             MBZ             |
                +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                B:  BROADCAST flag

                MBZ:  MUST BE ZERO (reserved for future use)

                Figure 2:  Format of the 'flags' field
```

---
## **2.1 Configuration parameters repository**

DHCP가 제공하는 첫 번째 서비스는 네트워크 클라이언트에 대한 네트워크 매개변수의 영구 저장소를 제공하는 것입니다. DHCP 영구 저장소 모델은 DHCP 서비스가 각 클라이언트에 대한 키-값 항목을 저장하는 것입니다. 여기서 키는 고유 식별자\(예: IP 서브넷 번호 및 서브넷 내의 고유 식별자\)이고 값에는 구성이 포함됩니다. 클라이언트에 대한 매개변수입니다.

예를 들어 키는 쌍\(IP-서브넷-번호, 하드웨어-주소\)일 수 있습니다\("하드웨어-주소"는 다음과 같이 입력해야 합니다\).

혼합 미디어, 브리지 네트워크에서 비트 순서 문제로 인해 발생할 수 있는 하드웨어 주소의 중복을 수용하기 위한 하드웨어 유형\) 서로 다른 서브넷에서 하드웨어 주소의 직렬 또는 동시 재사용을 허용하고 전역적으로 고유하지 않을 수 있는 하드웨어 주소를 허용합니다. 또는 키가 쌍\(IP-서브넷-번호, 호스트 이름\)일 수 있으며, 이를 통해 서버는 다른 서브넷으로 이동했거나 하드웨어 주소가 변경된 DHCP 클라이언트에 지능적으로 매개변수를 할당할 수 있습니다\(아마도 네트워크 인터페이스가 실패하고 교체되었습니다\). 프로토콜은 클라이언트가 '클라이언트 식별자' 옵션을 사용하여 식별자를 명시적으로 제공하지 않는 한 키가 \(IP-서브넷-번호, 하드웨어-주소\)가 되도록 정의합니다. 클라이언트는 DHCP 서비스에 쿼리하여 해당 구성 매개변수를 검색할 수 있습니다. 구성 매개변수 저장소에 대한 클라이언트 인터페이스는 구성 매개변수를 요청하는 프로토콜 메시지와 구성 매개변수를 전달하는 서버의 응답으로 구성됩니다.

---
## **2.2 Dynamic allocation of network addresses**

DHCP가 제공하는 두 번째 서비스는 임시 또는 영구 네트워크\(IP\) 주소를 클라이언트에 할당하는 것입니다. 네트워크 주소의 동적 할당을 위한 기본 메커니즘은 간단합니다. 즉, 클라이언트가 일정 기간 동안 주소 사용을 요청합니다. 할당 메커니즘\(DHCP 서버 모음\)은 요청된 시간 내에 해당 주소를 재할당하지 않도록 보장하고 클라이언트가 주소를 요청할 때마다 동일한 네트워크 주소를 반환하려고 시도합니다. 본 문서에서는 클라이언트에게 네트워크 주소가 할당되는 기간을 '임대'라고 합니다\[11\]. 클라이언트는 후속 요청을 통해 임대를 연장할 수 있습니다. 클라이언트는 더 이상 주소가 필요하지 않을 때 주소를 서버에 다시 해제하라는 메시지를 발행할 수 있습니다. 클라이언트는 무한 임대를 요청하여 영구 할당을 요청할 수 있습니다. "영구" 주소를 할당하는 경우에도 서버는 클라이언트가 폐기되었다는 사실을 감지할 수 있도록 길지만 무한하지 않은 임대를 제공하도록 선택할 수 있습니다.

일부 환경에서는 사용 가능한 주소가 고갈되어 네트워크 주소를 다시 할당해야 합니다. 이러한 환경에서는 할당 메커니즘이 임대가 만료된 주소를 재사용합니다. 서버는 구성 정보 저장소에서 사용할 수 있는 모든 정보를 사용하여 재사용할 주소를 선택해야 합니다. 예를 들어, 서버는 가장 최근에 할당된 주소를 선택할 수 있습니다. 일관성 검사로서 할당 서버는 주소를 할당하기 전에 재사용된 주소를 조사해야 합니다\(예: ICMP 에코 요청\). 클라이언트는 새로 수신된 주소\(예: ARP\)를 조사해야 합니다.\(SHOULD\)

---
## **3. The Client-Server Protocol**

DHCP는 RFC 951에 정의되어 있고 표 1과 그림 1에 나와 있는 BOOTP 메시지 형식을 사용합니다. 클라이언트에서 서버로 전송되는 각 DHCP 메시지의 'op' 필드에는 BOOTREQUEST가 포함되어 있습니다. BOOTREPLY는 서버에서 클라이언트로 전송되는 각 DHCP 메시지의 'op' 필드에 사용됩니다.

DHCP 메시지 '옵션' 필드의 처음 4개 옥텟에는 각각 \(10진수\) 값 99, 130, 83 및 99가 포함됩니다\(이것은 RFC 1497\[17\]에 정의된 것과 동일한 매직 쿠키입니다\). '옵션' 필드의 나머지 부분은 '옵션'이라는 태그가 지정된 매개변수 목록으로 구성됩니다. RFC 1497에 나열된 모든 "공급업체 확장"도 DHCP 옵션입니다. RFC 1533은 DHCP와 함께 사용하도록 정의된 전체 옵션 세트를 제공합니다.

지금까지 몇 가지 옵션이 정의되었습니다. 모든 DHCP 메시지에는 특정 옵션인 "DHCP 메시지 유형" 옵션이 포함되어야 합니다. 이 옵션은 DHCP 메시지의 "유형"을 정의합니다. DHCP 메시지 유형에 따라 추가 옵션이 허용되거나 필수이거나 허용되지 않을 수 있습니다.

이 문서 전체에서 'DHCP 메시지 유형' 옵션을 포함하는 DHCP 메시지는 메시지 유형으로 참조됩니다. 예를 들어, 'DHCP 메시지 유형' 옵션 유형 1을 갖는 DHCP 메시지는 "DHCPDISCOVER" 메시지로 참조됩니다.

---
## **3.1 Client-server interaction - allocating a network address**

클라이언트와 서버 간의 프로토콜 교환에 대한 다음 요약은 표 2에 설명된 DHCP 메시지를 참조합니다. 그림 3의 타임라인 다이어그램은 일반적인 클라이언트-서버 상호 작용의 타이밍 관계를 보여줍니다. 클라이언트가 이미 해당 주소를 알고 있는 경우 일부 단계가 생략될 수 있습니다. 이 축약된 상호 작용은 섹션 3.2에 설명되어 있습니다.

1. 클라이언트는 로컬 물리적 서브넷에서 DHCPDISCOVER 메시지를 브로드캐스트합니다. DHCPDISCOVER 메시지에는 네트워크 주소 및 임대 기간에 대한 값을 제안하는 옵션이 포함될 수 있습니다. BOOTP 릴레이 에이전트는 동일한 물리적 서브넷에 있지 않은 DHCP 서버에 메시지를 전달할 수 있습니다.\(MAY\)

2. 각 서버는 'yiaddr' 필드\(및 DHCP 옵션의 기타 구성 매개변수\)에 사용 가능한 네트워크 주소가 포함된 DHCPOFFER 메시지로 응답할 수 있습니다. 서버는 제공된 네트워크 주소를 예약할 필요가 없지만, 서버가 제공된 네트워크 주소를 다른 클라이언트에 할당하지 않으면 프로토콜이 더 효율적으로 작동합니다. 새 주소를 할당할 때 서버는 제공된 네트워크 주소가 아닌지 확인해야 합니다.\(SHOULD\)

- 이미 사용 중입니다. 예를 들어 서버는 ICMP 에코 요청을 통해 제공된 주소를 조사할 수 있습니다. 네트워크 관리자가 새로 할당된 주소의 프로브를 비활성화하도록 선택할 수 있도록 서버를 구현해야 합니다. 서버는 필요한 경우 BOOTP 중계 에이전트를 사용하여 클라이언트에게 DHCPOFFER 메시지를 전송합니다.\(SHOULD\)

```text
   Message         Use
   -------         ---
```

DHCPDISCOVER - 클라이언트가 사용 가능한 서버를 찾기 위해 브로드캐스트합니다.

DHCPOFFER - 구성 매개변수를 제공하는 DHCPDISCOVER에 대한 응답으로 서버에서 클라이언트로.

DHCPREQUEST - 서버에 대한 클라이언트 메시지는 \(a\) 한 서버에서 제공된 매개변수를 요청하고 다른 모든 서버의 제안을 암시적으로 거부하거나, \(b\) 시스템 재부팅 후 이전에 할당된 주소의 정확성을 확인하거나, \(c\) 특정 서버에 대한 임대를 연장합니다. 네트워크 주소.

DHCPACK - 커밋된 네트워크 주소를 포함한 구성 매개변수가 있는 서버에서 클라이언트로.

```text
   DHCPNAK      -  Server to client indicating client's notion of network
                   address is incorrect (e.g., client has moved to new
                   subnet) or client's lease as expired
```

DHCPDECLINE - 네트워크 주소가 이미 사용 중임을 나타내는 클라이언트-서버입니다.

DHCPRELEASE - 클라이언트에서 서버로 네트워크 주소를 포기하고 남은 임대를 취소합니다.

DHCPINFORM - 클라이언트에서 서버로, 로컬 구성 매개변수만 요청합니다. 클라이언트에는 이미 외부적으로 구성된 네트워크 주소가 있습니다.

```text
                          Table 2:  DHCP messages

                Server          Client          Server
            (not selected)                    (selected)

                  v               v               v
                  |               |               |
                  |     Begins initialization     |
                  |               |               |
                  | _____________/|\____________  |
                  |/DHCPDISCOVER | DHCPDISCOVER  \|
                  |               |               |
              Determines          |          Determines
             configuration        |         configuration
                  |               |               |
                  |\             |  ____________/ |
                  | \________    | /DHCPOFFER     |
                  | DHCPOFFER\   |/               |
                  |           \  |                |
                  |       Collects replies        |
                  |             \|                |
                  |     Selects configuration     |
                  |               |               |
                  | _____________/|\____________  |
                  |/ DHCPREQUEST  |  DHCPREQUEST\ |
                  |               |               |
                  |               |     Commits configuration
                  |               |               |
                  |               | _____________/|
                  |               |/ DHCPACK      |
                  |               |               |
                  |    Initialization complete    |
                  |               |               |
                  .               .               .
                  .               .               .
                  |               |               |
                  |      Graceful shutdown        |
                  |               |               |
                  |               |\ ____________ |
                  |               | DHCPRELEASE  \|
                  |               |               |
                  |               |        Discards lease
                  |               |               |
                  v               v               v
     Figure 3: Timeline diagram of messages exchanged between DHCP
               client and servers when allocating a new network address
```

3. 클라이언트는 하나 이상의 서버로부터 하나 이상의 DHCPOFFER 메시지를 받습니다. 클라이언트는 여러 응답을 기다리도록 선택할 수 있습니다. 클라이언트는 DHCPOFFER 메시지에 제공된 구성 매개변수를 기반으로 구성 매개변수를 요청할 서버 하나를 선택합니다. 클라이언트는 선택한 서버를 나타내기 위해 '서버 식별자' 옵션을 포함해야 하며 원하는 구성 값을 지정하는 다른 옵션을 포함할 수 있는 DHCPREQUEST 메시지를 브로드캐스트합니다. '요청된 IP 주소' 옵션은 서버에서 보내는 DHCPOFFER 메시지의 'yiaddr' 값으로 설정되어야 합니다. 이 DHCPREQUEST 메시지는 DHCP/BOOTP 중계 에이전트를 통해 브로드캐스트 및 중계됩니다. BOOTP 중계 에이전트가 원래 DHCPDISCOVER 메시지를 수신한 동일한 DHCP 서버 세트로 DHCPREQUEST 메시지를 전달하도록 하려면 DHCPREQUEST 메시지가 DHCP 메시지 헤더의 'secs' 필드에서 동일한 값을 사용해야 하며 동일한 IP로 전송되어야 합니다. 브로드캐스트 주소를 원래 DHCPDISCOVER 메시지로 사용합니다. 클라이언트가 DHCPOFFER 메시지를 받지 못하면 시간이 초과되어 DHCPDISCOVER 메시지를 다시 전송합니다.\(MUST, MUST, MUST\)

4. 서버는 클라이언트로부터 DHCPREQUEST 브로드캐스트를 수신합니다. DHCPREQUEST 메시지에 의해 선택되지 않은 서버는 클라이언트가 해당 서버의 제안을 거부했다는 알림으로 메시지를 사용합니다. DHCPREQUEST 메시지에서 선택된 서버는 클라이언트에 대한 바인딩을 영구 저장소에 커밋하고 요청 클라이언트에 대한 구성 매개변수가 포함된 DHCPACK 메시지로 응답합니다. '클라이언트 식별자' 또는 'chaddr'과 할당된 네트워크 주소의 조합은 클라이언트 임대에 대한 고유 식별자를 구성하며 클라이언트와 서버 모두 DHCP 메시지에서 참조되는 임대를 식별하는 데 사용됩니다. DHCPACK 메시지의 모든 구성 매개변수는 클라이언트가 응답하는 이전 DHCPOFFER 메시지의 구성 매개변수와 충돌해서는 안 됩니다. 서버는 이 시점에서 제공된 네트워크 주소를 확인해서는 안 됩니다. DHCPACK 메시지의 'yiaddr' 필드는 선택한 네트워크 주소로 채워집니다.\(SHOULD NOT, SHOULD NOT\)

선택된 서버가 DHCPREQUEST 메시지를 만족할 수 없는 경우\(예: 요청된 네트워크 주소가 할당됨\) 서버는 DHCPNAK 메시지로 응답해야 합니다.\(SHOULD\)

서버는 DHCPOFFER 메시지에서 클라이언트에게 제공되는 주소를 사용할 수 없는 것으로 표시하도록 선택할 수 있습니다. 서버는 클라이언트로부터 DHCPREQUEST 메시지를 받지 못한 경우 DHCPOFFER 메시지에서 클라이언트에 제공된 주소를 사용 가능한 것으로 표시해야 합니다.\(MAY, SHOULD\)

5. 클라이언트는 구성 매개변수가 포함된 DHCPACK 메시지를 수신합니다. 클라이언트는 매개변수\(예: 할당된 네트워크 주소에 대한 ARP\)에 대한 최종 확인을 수행하고 DHCPACK 메시지에 지정된 임대 기간을 기록해야 합니다. 이것에\(SHOULD\)

포인트, 클라이언트가 구성됩니다. 클라이언트가 주소가 이미 사용 중임을 감지하면\(예: ARP 사용을 통해\) 클라이언트는 DHCPDECLINE 메시지를 서버에 보내고 구성 프로세스를 다시 시작해야 합니다. 클라이언트는 루핑 시 과도한 네트워크 트래픽을 피하기 위해 구성 프로세스를 다시 시작하기 전에 최소 10초를 기다려야 합니다.\(MUST, SHOULD\)

클라이언트가 DHCPNAK 메시지를 받으면 구성 프로세스를 다시 시작합니다.

클라이언트가 DHCPACK나 DHCPNAK 메시지를 모두 받지 못한 경우 시간이 초과되어 DHCPREQUEST 메시지를 다시 전송합니다. 클라이언트는 4.1절의 재전송 알고리즘에 따라 DHCPREQUEST를 재전송합니다. 클라이언트는 클라이언트\(및 해당 클라이언트의 사용자\)가 포기하기 전에 지나치게 오래 기다리지 않고 서버에 연결할 수 있는 적절한 가능성을 제공할 수 있을 만큼 충분한 시간 동안 DHCPREQUEST를 재전송하도록 선택해야 합니다. 예를 들어, 섹션 4.1에 설명된 대로 재전송하는 클라이언트는 초기화 절차를 다시 시작하기 전에 총 60초의 지연 동안 DHCPREQUEST 메시지를 네 번 재전송할 수 있습니다. 클라이언트가 재전송 알고리즘을 사용한 후 DHCPACK 또는 DHCPNAK 메시지를 모두 수신하지 못한 경우 클라이언트는 INIT 상태로 돌아가 초기화 프로세스를 다시 시작합니다. 클라이언트는 초기화 프로세스가 실패했고 다시 시작 중임을 사용자에게 알려야 합니다.\(SHOULD\)

6. 클라이언트는 서버에 DHCPRELEASE 메시지를 보내 네트워크 주소에 대한 임대를 포기하도록 선택할 수 있습니다. 클라이언트는 DHCPRELEASE 메시지의 '클라이언트 식별자' 또는 'chaddr' 및 네트워크 주소를 사용하여 해제할 임대를 식별합니다. 클라이언트가 임대를 획득할 때 '클라이언트 식별자'를 사용한 경우 DHCPRELEASE 메시지에서 동일한 '클라이언트 식별자'를 사용해야 합니다.\(MUST\)

3.2 클라이언트-서버 상호 작용 - 이전에 할당된 네트워크 주소 재사용

클라이언트가 이전에 할당된 네트워크 주소를 기억하고 재사용하려는 경우 클라이언트는 이전 섹션에서 설명한 일부 단계를 생략하도록 선택할 수 있습니다. 그림 4의 타임라인 다이어그램은 이전에 할당된 네트워크 주소를 재사용하는 클라이언트에 대한 일반적인 클라이언트-서버 상호 작용의 타이밍 관계를 보여줍니다.

1. 클라이언트는 로컬 서브넷에서 DHCPREQUEST 메시지를 브로드캐스트합니다. 메시지에는 '요청된 IP 주소' 옵션에 클라이언트의 네트워크 주소가 포함됩니다. 클라이언트가 네트워크 주소를 수신하지 않았으므로 'ciaddr' 필드를 채워서는 안 됩니다. BOOTP 릴레이 에이전트는 동일한 서브넷에 있지 않은 DHCP 서버에 메시지를 전달합니다. 클라이언트가 주소를 얻기 위해 '클라이언트 식별자'를 사용한 경우 클라이언트는 DHCPREQUEST 메시지에서 동일한 '클라이언트 식별자'를 사용해야 합니다.\(MUST NOT, MUST\)

2. 클라이언트의 구성 매개변수를 알고 있는 서버는 DHCPACK 메시지로 클라이언트에 응답합니다. 서버는 클라이언트의 네트워크 주소가 이미 사용 중인지 확인해서는 안 됩니다. 클라이언트는 이 시점에서 ICMP 에코 요청 메시지에 응답할 수 있습니다.\(SHOULD NOT\)

```text
                Server          Client          Server

                  v               v               v
                  |                |               |
                  |              Begins            |
                  |          initialization        |
                  |                |               |
                  |                /|\             |
                  |   _________ __/ | \__________  |
                  | /DHCPREQU EST  |  DHCPREQUEST\ |
                  |/               |              \|
                  |                |               |
               Locates             |            Locates
            configuration          |         configuration
                  |                |               |
                  |\               |              /|
                  | \              |  ___________/ |
                  |  \             | /  DHCPACK    |
                  |   \ _______    |/              |
                  |     DHCPACK\   |               |
                  |          Initialization        |
                  |             complete           |
                  |               \|               |
                  |                |               |
                  |           (Subsequent          |
                  |             DHCPACKS           |
                  |             ignored)           |
                  |                |               |
                  |                |               |
                  v                v               v

     Figure 4: Timeline diagram of messages exchanged between DHCP
               client and servers when reusing a previously allocated
               network address
```

- 클라이언트의 요청이 유효하지 않은 경우\(예: 클라이언트가 새 서브넷으로 이동한 경우\) 서버는 DHCPNAK 메시지로 클라이언트에 응답해야 합니다. 정보의 정확성이 보장되지 않는 경우 서버는 응답해서는 안 됩니다. 예를 들어, 다른 서버가 소유한 만료된 바인딩에 대한 요청을 식별하는 서버는 서버가 서버 간의 일관성을 유지하기 위해 명시적인 메커니즘을 사용하지 않는 한 DHCPNAK로 응답해서는 안 됩니다.\(SHOULD, SHOULD NOT, SHOULD NOT\)

- DHCPREQUEST 메시지에서 'giaddr'이 0x0이면 클라이언트는 서버와 동일한 서브넷에 있는 것입니다. 클라이언트가 올바른 네트워크 주소나 서브넷 마스크를 갖고 있지 않을 수 있고 클라이언트가 ARP 요청에 응답하지 않을 수 있으므로 서버는 DHCPNAK 메시지를 0xffffffff 브로드캐스트 주소로 브로드캐스트해야 합니다. 그렇지 않으면 서버는 'giaddr'에 기록된 대로 BOOTP 중계 에이전트의 IP 주소로 DHCPNAK 메시지를 보내야 합니다. 그러면 릴레이 에이전트는 메시지를 클라이언트의 하드웨어 주소로 직접 전달하므로 클라이언트가 새로운 네트워크로 이동한 경우에도 DHCPNAK가 배달될 수 있습니다.\(MUST, MUST\)

3. 클라이언트는 구성 매개변수가 포함된 DHCPACK 메시지를 수신합니다. 클라이언트는 매개변수에 대한 최종 확인을 수행하고\(섹션 3.1 참조\) DHCPACK 메시지에 지정된 임대 기간을 기록합니다. 특정 임대는 '클라이언트 식별자' 또는 'chaddr' 및 네트워크 주소로 암시적으로 식별됩니다. 이 시점에서 클라이언트가 구성됩니다.

- 클라이언트가 DHCPACK 메시지의 IP 주소가 이미 사용 중임을 감지한 경우 클라이언트는 DHCPDECLINE 메시지를 서버에 보내고 새 네트워크 주소를 요청하여 구성 프로세스를 다시 시작해야 합니다. 이 작업은 섹션 4.4에 설명된 DHCP 상태 다이어그램에서 클라이언트가 INIT 상태로 이동하는 것에 해당합니다.\(MUST\)

- 클라이언트가 DHCPNAK 메시지를 수신하면 기억된 네트워크 주소를 재사용할 수 없습니다. 대신 이번에는 섹션 3.1에 설명된 \(축약되지 않은\) 절차를 사용하여 구성 프로세스를 다시 시작하여 새 주소를 요청해야 합니다. 이 작업은 클라이언트가 DHCP 상태 다이어그램에서 INIT 상태로 이동하는 것과도 일치합니다.

- 클라이언트가 DHCPACK나 DHCPNAK 메시지를 모두 받지 못한 경우 클라이언트는 시간 초과되어 DHCPREQUEST 메시지를 다시 전송합니다. 클라이언트는 4.1절의 재전송 알고리즘에 따라 DHCPREQUEST를 재전송합니다. 클라이언트는 클라이언트\(및 해당 클라이언트의 사용자\)가 포기하기 전에 지나치게 오래 기다리지 않고 서버에 연결할 수 있는 적절한 가능성을 제공할 수 있을 만큼 충분한 시간 동안 DHCPREQUEST를 재전송하도록 선택해야 합니다. 예를 들어, 섹션 4.1에 설명된 대로 재전송하는 클라이언트는

- 초기화 절차를 다시 시작하기 전에 총 60초 동안 DHCPREQUEST 메시지가 4번 나타납니다. 클라이언트가 재전송 알고리즘을 사용한 후 DHCPACK 또는 DHCPNAK 메시지를 모두 수신하지 못한 경우 클라이언트는 만료되지 않은 임대의 나머지 기간 동안 이전에 할당된 네트워크 주소와 구성 매개변수를 사용하도록 선택할 수 있습니다. 이는 그림 5에 표시된 클라이언트 상태 전이 다이어그램에서 BOUND 상태로 이동하는 것에 해당합니다.\(MAY\)

4. 클라이언트는 서버에 DHCPRELEASE 메시지를 보내 네트워크 주소에 대한 임대를 포기하도록 선택할 수 있습니다. 클라이언트는 DHCPRELEASE 메시지의 '클라이언트 식별자' 또는 'chaddr' 및 네트워크 주소를 사용하여 해제할 임대를 식별합니다.

- 이 경우 클라이언트가 네트워크 주소를 로컬로 유지하는 경우 클라이언트는 일반적으로 정상적인 종료 중에 임대를 포기하지 않습니다. 클라이언트가 명시적으로 임대를 포기해야 하는 경우\(예: 클라이언트가 다른 서브넷으로 이동하려고 하는 경우\)에만 클라이언트는 DHCPRELEASE 메시지를 보냅니다.

---
## **3.3 Interpretation and representation of time values**

클라이언트는 고정된 기간\(무한일 수 있음\) 동안 네트워크 주소에 대한 임대를 획득합니다. 프로토콜 전체에서 시간은 초 단위로 표시됩니다. 0xffffffff의 시간 값은 "무한대"를 나타내기 위해 예약되어 있습니다.

클라이언트와 서버의 시계가 동기화되지 않았을 수 있으므로 시간은 DHCP 메시지에 상대 시간으로 표시되어 클라이언트의 로컬 시계를 기준으로 해석됩니다. 부호 없는 32비트 워드에서 상대 시간을 초 단위로 표현하면 0년에서 약 100년까지의 상대 시간 범위가 제공되며, 이는 DHCP를 사용하여 상대 시간을 측정하는 데 충분합니다.

이전 단락에 제공된 임대 기간 해석 알고리즘은 클라이언트와 서버 시계가 서로 상대적으로 안정적이라고 가정합니다. 두 시계 사이에 드리프트가 있는 경우 서버는 클라이언트가 만료되기 전에 임대가 만료된 것으로 간주할 수 있습니다. 이를 보완하기 위해 서버는 클라이언트 정보의 로컬 데이터베이스에 커밋하는 것보다 더 짧은 임대 기간을 클라이언트에 반환할 수 있습니다.

---
## **3.4 Obtaining parameters with externally configured network address**

클라이언트가 다른 수단\(예: 수동 구성\)을 통해 네트워크 주소를 얻은 경우 DHCPINFORM 요청 메시지를 사용할 수 있습니다.

다른 로컬 구성 매개변수를 얻으려면 DHCPINFORM 메시지를 수신하는 서버는 새 주소 할당, 기존 바인딩 확인, 'yiaddr' 채우기 또는 임대 시간 매개변수 포함 없이 클라이언트에 적합한 로컬 구성 매개변수를 사용하여 DHCPACK 메시지를 구성합니다. 서버는 DHCPINFORM 메시지의 'ciaddr' 필드에 제공된 주소로 DHCPACK 응답을 유니캐스트해야 합니다.\(SHOULD\)

서버는 일관성을 위해 DHCPINFORM 메시지의 네트워크 주소를 확인해야 하지만 기존 임대를 확인해서는 안 됩니다. 서버는 요청 클라이언트에 대한 구성 매개변수를 포함하는 DHCPACK 메시지를 구성하고 DHCPACK 메시지를 클라이언트에 직접 보냅니다.\(MUST NOT\)

---
## **3.5 Client parameters in DHCP**

모든 클라이언트가 부록 A에 나열된 모든 매개변수의 초기화를 요구하는 것은 아닙니다. 서버에서 클라이언트로 전송되는 매개변수 수를 줄이기 위해 두 가지 기술이 사용됩니다. 첫째, 대부분의 매개 변수에는 호스트 요구 사항 RFC에 정의된 기본값이 있습니다. 클라이언트가 서버로부터 기본값을 대체하는 매개변수를 수신하지 않으면 클라이언트는 해당 기본값을 사용합니다. 둘째, 초기 DHCPDISCOVER 또는 DHCPREQUEST 메시지에서 클라이언트는 클라이언트가 관심 있는 특정 매개변수 목록을 서버에 제공할 수 있습니다. 클라이언트가 DHCPDISCOVER 메시지에 매개변수 목록을 포함하는 경우 후속 DHCPREQUEST에 해당 목록을 포함해야 합니다. 메시지.\(MUST\)

클라이언트는 서버가 DHCP 메시지를 만들 수 있는 크기를 서버에 알릴 수 있도록 '최대 DHCP 메시지 크기' 옵션을 포함해야 합니다. 클라이언트에 반환된 매개변수는 여전히 DHCP 메시지의 옵션에 할당된 공간을 초과할 수 있습니다. 이 경우 두 개의 추가 옵션 플래그\(메시지의 'options' 필드에 나타나야 함\)는 'file' 및 'sname' 필드가 옵션에 사용됨을 나타냅니다.\(SHOULD\)

클라이언트는 '매개변수 요청 목록' 옵션을 포함하여 클라이언트가 관심 있는 구성 매개변수가 무엇인지 서버에 알릴 수 있습니다. 이 옵션의 데이터 부분에는 태그 번호로 요청된 옵션이 명시적으로 나열됩니다.

또한 클라이언트는 DHCPDISCOVER 메시지에서 네트워크 주소 및 임대 시간에 대한 값을 제안할 수도 있습니다. 클라이언트는 특정 IP 주소 할당을 제안하는 '요청 IP 주소' 옵션을 포함할 수 있고, 원하는 임대 시간을 제안하는 'IP 주소 임대 시간' 옵션을 포함할 수 있다. 구성 매개변수에서 "힌트"를 나타내는 다른 옵션은 DHCPDISCOVER 또는 DHCPREQUEST 메시지에서 허용됩니다. 그러나 추가 옵션은

서버에서는 무시되므로 여러 서버가 일부 옵션에 대해 동일한 값을 반환하지 않을 수 있습니다. '요청된 IP 주소' 옵션은 클라이언트가 이전에 얻은 네트워크 매개변수를 확인할 때 DHCPREQUEST 메시지에만 채워집니다. 클라이언트는 BOUND, RENEWING 또는 REBINDING 상태의 IP 주소로 올바르게 구성된 경우에만 'ciaddr' 필드를 채웁니다.

서버가 유효하지 않은 '요청된 IP 주소'가 포함된 DHCPREQUEST 메시지를 수신한 경우 서버는 DHCPNAK 메시지로 클라이언트에 응답해야 하며 시스템 관리자에게 문제를 보고하도록 선택할 수 있습니다. 서버의 '메시지' 옵션에 오류 메시지가 포함될 수 있습니다.\(SHOULD\)

---
## **3.6 Use of DHCP in clients with multiple interfaces**

여러 네트워크 인터페이스가 있는 클라이언트는 각 인터페이스를 통해 DHCP를 독립적으로 사용하여 해당 개별 인터페이스에 대한 구성 정보 매개변수를 가져와야 합니다.

---
## **3.7 When clients should use DHCP**

클라이언트는 로컬 네트워크 매개변수가 변경될 때마다 IP 주소와 네트워크 매개변수를 다시 획득하거나 확인하기 위해 DHCP를 사용해야 합니다. 예를 들어, 시스템 부팅 시 또는 로컬 네트워크와의 연결이 끊어진 후 로컬 네트워크 구성이 클라이언트나 사용자가 모르는 사이에 변경될 수 있습니다.\(SHOULD\)

클라이언트가 이전 네트워크 주소를 알고 있고 로컬 DHCP 서버에 연결할 수 없는 경우 클라이언트는 해당 주소에 대한 임대가 만료될 때까지 이전 네트워크 주소를 계속 사용할 수 있습니다. 클라이언트가 DHCP 서버에 접속하기 전에 임대가 만료되면 클라이언트는 즉시 이전 네트워크 주소의 사용을 중단해야 하며 로컬 사용자에게 문제를 알릴 수 있습니다.

---
## **4. Specification of the DHCP client-server protocol**

이 섹션에서는 DHCP 서버에 새 주소에 대한 요청을 충족할 수 있는 네트워크 주소 블록이 있다고 가정합니다. 또한 각 서버는 로컬 영구 저장소에 할당된 주소 및 임대 데이터베이스를 유지 관리합니다.

---
## **4.1 Constructing and sending DHCP messages**

DHCP 클라이언트와 서버는 모두 메시지의 고정 형식 섹션에 있는 필드를 채우고 가변 길이 옵션 영역에 태그가 지정된 데이터 항목을 추가하여 DHCP 메시지를 구성합니다. 옵션 영역에는 먼저 4옥텟 '마법 쿠키'\(섹션 3에서 설명\)가 포함되어 있고 그 뒤에 옵션이 있습니다. 마지막 옵션은 항상

'끝' 옵션이 됩니다.

DHCP는 UDP를 전송 프로토콜로 사용합니다. 클라이언트에서 서버로 보내는 DHCP 메시지는 'DHCP 서버' 포트\(67\)로 전송되고, 서버에서 클라이언트로 보내는 DHCP 메시지는 'DHCP 클라이언트' 포트\(68\)로 전송됩니다. 여러 네트워크 주소를 가진 서버\(예: 멀티 홈 호스트\)는 나가는 DHCP 메시지에서 네트워크 주소 중 하나를 사용할 수 있습니다.\(MAY\)

'서버 식별자' 필드는 DHCP 메시지에서 DHCP 서버를 식별하는 데 사용되며 클라이언트에서 서버로의 대상 주소로도 사용됩니다. 여러 네트워크 주소를 가진 서버는 DHCP 메시지에서 해당 서버를 식별하는 네트워크 주소를 수락할 준비를 해야 합니다. 잠재적으로 불완전할 수 있는 네트워크 연결을 수용하려면 서버는 서버가 아는 한 클라이언트에서 연결할 수 있는 주소를 '서버 식별자'로 선택해야 합니다. 예를 들어, DHCP 서버와 DHCP 클라이언트가 동일한 서브넷에 연결되어 있는 경우\(즉, 클라이언트에서 보낸 메시지의 'giaddr' 필드가 0인 경우\) 서버는 서버가 통신에 사용하는 IP 주소를 선택해야 합니다. 서브넷을 '서버 식별자'로 사용합니다. 서버가 해당 서브넷에서 여러 IP 주소를 사용하는 경우 해당 주소를 사용할 수 있습니다. 서버가 DHCP 릴레이 에이전트를 통해 메시지를 수신한 경우 서버는 메시지가 수신된 인터페이스에서 '서버 식별자'로 주소를 선택해야 합니다\(서버가 선택할 수 있는 다른 더 나은 정보가 있는 경우 제외\). . DHCP 클라이언트는 DHCP 서버에 대한 유니캐스트 요청에 대해 '서버 식별자' 옵션에 제공된 IP 주소를 사용해야 합니다.\(MUST, MUST, SHOULD, SHOULD, MUST\)

클라이언트가 IP 주소를 얻기 전에 클라이언트가 브로드캐스트하는 DHCP 메시지에는 IP 헤더의 소스 주소 필드가 0으로 설정되어 있어야 합니다.

클라이언트의 DHCP 메시지에 있는 'giaddr' 필드가 0이 아닌 경우 서버는 주소가 'giaddr'에 나타나는 BOOTP 중계 에이전트의 'DHCP 서버' 포트로 반환 메시지를 보냅니다. 'giaddr' 필드가 0이고 'ciaddr' 필드가 0이 아닌 경우 서버는 DHCPOFFER 및 DHCPACK 메시지를 'ciaddr'의 주소로 유니캐스트합니다. 'giaddr'이 0이고 'ciaddr'이 0이고 브로드캐스트 비트가 설정된 경우 서버는 DHCPOFFER 및 DHCPACK 메시지를 0xffffffff로 브로드캐스트합니다. 브로드캐스트 비트가 설정되지 않고 'giaddr'이 0이고 'ciaddr'이 0인 경우 서버는 DHCPOFFER 및 DHCPACK 메시지를 클라이언트의 하드웨어 주소와 'yiaddr' 주소로 유니캐스트합니다. 모든 경우에 'giaddr'이 0이면 서버는 모든 DHCPNAK 메시지를 0xffffffff로 브로드캐스트합니다.

DHCP 메시지의 옵션이 'sname' 및 'file' 필드로 확장되는 경우 '옵션 오버로드' 옵션은 RFC 1533에 지정된 대로 값 1, 2 또는 3으로 '옵션' 필드에 나타나야 합니다.\(MUST\)

'옵션 오버로드' 옵션이 '옵션' 필드에 있고 '옵션' 필드의 옵션은 'end' 옵션으로 종료되어야 하며 옵션 필드를 채우기 위해 하나 이상의 '패드' 옵션을 포함할 수 있습니다. 'sname' 및 'file' 필드의 옵션\('optionsoverload' 옵션에 표시된 대로 사용 중인 경우\)은 필드의 첫 번째 옥텟으로 시작해야 하고 'end' 옵션으로 끝나야 하며 따라야 합니다. 필드의 나머지 부분을 채우려면 '패드' 옵션을 사용하세요. 'options', 'sname' 및 'file' 필드의 모든 개별 옵션은 해당 필드에 완전히 포함되어야 합니다. 모든 '옵션 오버로드' 옵션이 해석될 수 있도록 '옵션' 필드의 옵션을 먼저 해석해야 합니다. 'file' 필드는 다음으로 해석되어야 하며\('optionoverload' 옵션이 'file' 필드에 DHCP 옵션이 포함되어 있음을 나타내는 경우\) 'sname' 필드가 뒤따릅니다.\(MUST, MUST, MUST, MUST, MUST\)

'옵션' 태그에 전달되는 값은 너무 길어서 단일 옵션에 사용할 수 있는 255옥텟에 맞지 않을 수 있습니다\(예: '라우터' 옵션의 라우터 목록\[21\]\). 옵션 문서에 별도로 지정하지 않는 한 옵션은 한 번만 나타날 수 있습니다. 클라이언트는 구성을 위해 동일한 옵션의 여러 인스턴스 값을 단일 매개변수 목록으로 연결합니다.

DHCP 클라이언트는 모든 메시지 재전송을 담당합니다. 클라이언트는 재전송 간의 지연을 결정하기 위해 무작위 지수 백오프 알고리즘을 통합하는 재전송 전략을 채택해야 합니다. 재전송 간의 지연은 클라이언트와 서버 간의 인터네트워크 특성을 기반으로 서버의 응답이 전달되는 데 충분한 시간을 허용하도록 선택해야 합니다. 예를 들어, 10Mb/초 이더넷 인터네트워크에서 첫 번째 재전송 전 지연은 -1에서 +1 범위에서 선택한 균일한 난수 값에 의해 무작위화되는 4초여야 합니다. 1초 미만의 해상도 세분성을 제공하는 시계를 사용하는 클라이언트는 정수가 아닌 무작위 값을 선택할 수 있습니다. 다음 재전송 전의 지연은 -1에서 +1 범위에서 선택된 균일한 숫자 값에 의해 무작위로 추출된 8초여야 합니다. 재전송 지연은 후속 재전송이 최대 64초까지 두 배로 늘어나야 합니다. 클라이언트는 구성 프로세스의 진행 상황을 표시하기 위해 사용자에게 재전송 시도 표시를 제공할 수 있습니다.\(MUST, SHOULD, SHOULD, SHOULD, SHOULD, MAY\)

'xid' 필드는 클라이언트가 들어오는 DHCP 메시지를 보류 중인 요청과 일치시키기 위해 사용됩니다. DHCP 클라이언트는 다른 클라이언트가 사용하는 것과 동일한 'xid'를 사용할 가능성을 최소화하는 방식으로 'xid'를 선택해야 합니다. 예를 들어, 클라이언트는 재부팅될 때마다 다른 무작위 초기 'xid'를 선택한 후 다음 재부팅 때까지 순차적인 'xid'를 사용할 수 있습니다. 각 재전송에 대해 새로운 'xid'를 선택하는 것은 구현 결정입니다. 클라이언트는 동일한 'xid'를 재사용하거나 재전송된 각 메시지에 대해 새 'xid'를 선택할 수 있습니다.\(MUST\)

일반적으로 DHCP 서버와 BOOTP 릴레이 에이전트는 uicast 전달을 사용하여 DHCPOFFER, DHCPACK 및 DHCPNAK 메시지를 클라이언트에 직접 전달하려고 시도합니다. IP 대상 주소\(IP 헤더에 있음\)는 DHCP 'yiaddr' 주소로 설정되고 링크 계층 대상 주소는 DHCP 'chaddr' 주소로 설정됩니다. 안타깝게도 일부 클라이언트 구현에서는 구현이 유효한 IP 주소로 구성될 때까지 이러한 유니캐스트 IP 데이터그램을 수신할 수 없습니다\(클라이언트가 IP 주소로 구성될 때까지 클라이언트의 IP 주소를 전달할 수 없는 교착 상태가 발생함\).

프로토콜 소프트웨어가 IP 주소로 구성될 때까지 유니캐스트 IP 데이터그램을 수신할 수 없는 클라이언트는 클라이언트가 보내는 모든 DHCPDISCOVER 또는 DHCPREQUEST 메시지에서 '플래그' 필드의 BROADCAST 비트를 1로 설정해야 합니다. BROADCAST 비트는 DHCP 서버와 BOOTP 중계 에이전트에 힌트를 제공하여 클라이언트 서브넷의 클라이언트에 메시지를 브로드캐스트합니다. 프로토콜 소프트웨어가 구성되기 전에 유니캐스트 IP 데이터그램을 수신할 수 있는 클라이언트는 BROADCAST 비트를 0으로 지워야 합니다. BOOTP 설명 문서는 BROADCAST 비트 사용의 결과를 논의합니다\[21\].\(SHOULD, SHOULD\)

DHCP 메시지를 DHCP 클라이언트\(즉, 'giaddr' 필드에 지정된 릴레이 에이전트가 아닌\)로 직접 보내거나 릴레이하는 서버나 릴레이 에이전트는 'flags' 필드의 BROADCAST 비트를 검사해야 합니다. 이 비트가 1로 설정되면 DHCP 메시지는 IP 브로드캐스트 주소\(바람직하게는 0xffffffff\)를 IP 대상 주소로 사용하고 링크 계층 브로드캐스트 주소를 링크 계층 대상 주소로 사용하여 IP 브로드캐스트로 전송되어야 합니다. BROADCAST 비트가 0으로 지워지면 메시지는 'yiaddr' 필드에 지정된 IP 주소와 'chaddr' 필드에 지정된 링크 계층 주소에 IP 유니캐스트로 전송되어야 합니다. 유니캐스팅이 가능하지 않은 경우 메시지는 IP 브로드캐스트 주소\(바람직하게는 0xffffffff\)를 IP 대상 주소로 사용하고 링크 계층 브로드캐스트 주소를 링크 계층 대상 주소로 사용하여 IP 브로드캐스트로 전송될 수 있습니다.\(SHOULD, SHOULD, SHOULD, MAY\)

---
## **4.2 DHCP server administrative controls**

DHCP 서버는 수신하는 모든 DHCPDISCOVER 및 DHCPREQUEST 메시지에 응답할 필요가 없습니다. 예를 들어, 네트워크 관리자는 네트워크에 연결된 클라이언트에 대한 엄격한 제어를 유지하기 위해 일부 외부 메커니즘을 통해 이전에 등록된 클라이언트에만 응답하도록 DHCP 서버를 구성하도록 선택할 수 있습니다. DHCP 사양은 클라이언트와 서버가 상호 작용하기로 선택한 경우 클라이언트와 서버 간의 상호 작용만 설명합니다. 시스템 관리자가 사용하려는 모든 관리 제어를 설명하는 것은 DHCP 사양의 범위를 벗어납니다. 특정 DHCP 서버

구현에는 네트워크 관리자가 원하는 모든 제어 또는 정책이 통합될 수 있습니다.

일부 환경에서는 DHCP 서버가 특정 클라이언트에 대한 올바른 매개변수를 결정할 때 DHCPDISCOVER 또는 DHCPREQUEST 메시지에 포함된 공급업체 클래스 옵션 값을 고려해야 합니다.

DHCP 서버는 클라이언트를 해당 임대와 연결하기 위해 고유한 식별자를 사용해야 합니다. 클라이언트는 '클라이언트 식별자' 옵션을 통해 식별자를 명시적으로 제공하도록 선택할 수 있습니다. 클라이언트가 '클라이언트 식별자'를 제공하는 경우 클라이언트는 모든 후속 메시지에서 동일한 '클라이언트 식별자'를 사용해야 하며 서버는 해당 식별자를 사용하여 클라이언트를 식별해야 합니다. 클라이언트가 '클라이언트 식별자' 옵션을 제공하지 않는 경우 서버는 'chaddr' 필드의 내용을 사용하여 클라이언트를 식별해야 합니다. DHCP 클라이언트는 '클라이언트 식별자' 옵션에서 클라이언트가 연결된 서브넷 내에서 고유한 식별자를 사용하는 것이 중요합니다. 클라이언트의 고유 식별자로 'chaddr'을 사용하면 해당 식별자가 새 클라이언트로 이동될 수 있는 하드웨어 인터페이스와 연결될 수 있으므로 예기치 않은 결과가 발생할 수 있습니다. 일부 사이트에서는 컴퓨터 간 하드웨어 인터페이스 전송으로 인해 클라이언트 네트워크 주소가 예기치 않게 변경되는 것을 방지하기 위해 제조업체의 일련 번호를 '클라이언트 식별자'로 사용하도록 선택할 수 있습니다. 사이트에서는 DNS 이름을 '클라이언트 식별자'로 사용하여 주소 임대가 특정 하드웨어 상자가 아닌 DNS 이름과 연결되도록 선택할 수도 있습니다.\(MAY, MUST, MUST\)

DHCP 클라이언트는 클라이언트가 DHCPOFFER 메시지를 수신하는 서버 중에서 DHCP 서버를 선택할 때 어떤 전략이든 자유롭게 사용할 수 있습니다. DHCP의 클라이언트 구현은 사용자가 '공급업체 클래스 식별자' 값을 직접 선택할 수 있는 메커니즘을 제공해야 합니다.\(SHOULD\)

---
## **4.3 DHCP server behavior**

DHCP 서버는 해당 클라이언트에 대한 바인딩의 현재 상태를 기반으로 클라이언트로부터 들어오는 DHCP 메시지를 처리합니다. DHCP 서버는 클라이언트로부터 다음 메시지를 받을 수 있습니다.

```text
      o DHCPDISCOVER

      o DHCPREQUEST

      o DHCPDECLINE

      o DHCPRELEASE

      o DHCPINFORM
```

표 3은 서버에 의한 DHCP 메시지의 필드와 옵션 사용을 제공합니다. 이 섹션의 나머지 부분에서는 가능한 각 수신 메시지에 대한 DHCP 서버의 작업을 설명합니다.

---
### **4.3.1 DHCPDISCOVER message**

서버가 클라이언트로부터 DHCPDISCOVER 메시지를 받으면 서버는 요청 클라이언트에 대한 네트워크 주소를 선택합니다. 사용 가능한 주소가 없으면 서버는 시스템 관리자에게 문제를 보고하도록 선택할 수 있습니다. 주소를 사용할 수 있는 경우 새 주소를 다음과 같이 선택해야 합니다.\(SHOULD\)

- o 클라이언트의 현재 바인딩 ELSE에 기록된 클라이언트의 현재 주소

- o 클라이언트의 바인딩\(현재 만료되었거나 해제됨\)에 기록된 클라이언트의 이전 주소\(해당 주소가 서버의 사용 가능한 주소 풀에 있고 아직 할당되지 않은 경우\) ELSE

- o '요청된 IP 주소' 옵션에서 요청한 주소\(해당 주소가 유효하고 아직 할당되지 않은 경우 ELSE\)

- o 서버의 사용 가능한 주소 풀에서 할당된 새 주소. 주소는 메시지가 수신된 서브넷\('giaddr'이 0인 경우\) 또는 메시지를 전달한 릴레이 에이전트의 주소\(0이 아닌 경우 'giaddr'\)를 기반으로 선택됩니다.

섹션 4.2에 설명된 대로 서버는 관리상의 이유로 요청한 주소 이외의 주소를 할당할 수 있으며, 무료 주소가 사용 가능한 경우에도 특정 클라이언트에 대한 주소 할당을 거부할 수 있습니다.\(MAY\)

일부 네트워크 아키텍처\(예: 물리적 네트워크 세그먼트에 둘 이상의 IP 서브넷이 할당된 인터넷\)에서는 DHCP 클라이언트에 'giaddr'에 기록된 주소와 다른 서브넷의 주소가 할당되어야 하는 경우가 있습니다. '. 따라서 DHCP는 클라이언트가 'giaddr'의 서브넷 주소로 할당되도록 요구하지 않습니다. 서버는 다른 서브넷을 자유롭게 선택할 수 있으며 할당된 IP 주소를 선택하는 방법을 설명하는 것은 DHCP 사양의 범위를 벗어납니다.

DHCP의 올바른 작동에 필요하지는 않지만 클라이언트가 서버의 DHCPOFFER 메시지에 응답하기 전에 서버는 선택한 네트워크 주소를 재사용해서는 안 됩니다. 서버는 클라이언트에 제공된 주소를 기록하도록 선택할 수 있습니다.\(SHOULD NOT\)

서버는 또한 다음과 같이 임대 만료 시간을 선택해야 합니다.

o 클라이언트가 DHCPDISCOVER 메시지에서 특정 임대를 요청하지 않았고 클라이언트에 이미 할당된 네트워크 주소가 있는 경우 서버는 이전에 해당 주소에 할당된 임대 만료 시간을 반환합니다. 이전에 할당된 주소의 만료 시간\), ELSE

o 클라이언트가 DHCPDISCOVER 메시지에서 특정 임대를 요청하지 않았고 클라이언트에 할당된 네트워크 주소가 없는 경우 서버는 로컬로 구성된 기본 임대 시간 ELSE를 할당합니다.

o 클라이언트가 DHCPDISCOVER 메시지에서 특정 임대를 요청한 경우\(클라이언트에게 할당된 네트워크 주소가 있는지 여부에 관계없이\) 서버는 요청된 임대를 반환하거나\(임대가 로컬 정책에 허용되는 경우\) 다른 임대를 선택할 수 있습니다. .

```text
Field      DHCPOFFER            DHCPACK             DHCPNAK
-----      ---------            -------             -------
'op'       BOOTREPLY            BOOTREPLY           BOOTREPLY
'htype'    (From "Assigned Numbers" RFC)
'hlen'     (Hardware address length in octets)
'hops'     0                    0                   0
'xid'      'xid' from client    'xid' from client   'xid' from client
           DHCPDISCOVER         DHCPREQUEST         DHCPREQUEST
           message              message             message
'secs'     0                    0                   0
'ciaddr'   0                    'ciaddr' from       0
                                DHCPREQUEST or 0
'yiaddr'   IP address offered   IP address          0
           to client            assigned to client
'siaddr'   IP address of next   IP address of next  0
           bootstrap server     bootstrap server
'flags'    'flags' from         'flags' from        'flags' from
           client DHCPDISCOVER  client DHCPREQUEST  client DHCPREQUEST
           message              message             message
'giaddr'   'giaddr' from        'giaddr' from       'giaddr' from
           client DHCPDISCOVER  client DHCPREQUEST  client DHCPREQUEST
           message              message             message
'chaddr'   'chaddr' from        'chaddr' from       'chaddr' from
           client DHCPDISCOVER  client DHCPREQUEST  client DHCPREQUEST
           message              message             message
'sname'    Server host name     Server host name    (unused)
           or options           or options
'file'     Client boot file     Client boot file    (unused)
           name or options      name or options
'options'  options              options

Option                    DHCPOFFER    DHCPACK            DHCPNAK
------                    ---------    -------            -------
Requested IP address      MUST NOT     MUST NOT           MUST NOT
IP address lease time     MUST         MUST (DHCPREQUEST) MUST NOT
                                       MUST NOT (DHCPINFORM)
Use 'file'/'sname' fields MAY          MAY                MUST NOT
DHCP message type         DHCPOFFER    DHCPACK            DHCPNAK
Parameter request list    MUST NOT     MUST NOT           MUST NOT
Message                   SHOULD       SHOULD             SHOULD
Client identifier         MUST NOT     MUST NOT           MAY
Vendor class identifier   MAY          MAY                MAY
Server identifier         MUST         MUST               MUST
Maximum message size      MUST NOT     MUST NOT           MUST NOT
All others                MAY          MAY                MUST NOT

           Table 3:  Fields and options used by DHCP servers
```

네트워크 주소와 임대가 결정되면 서버는 제공된 구성 매개변수를 사용하여 DHCPOFFER 메시지를 구성합니다. 클라이언트가 선택하는 서버에 관계없이 예측 가능한 클라이언트 동작을 보장하려면 모든 DHCP 서버가 동일한 매개변수\(새로 할당된 네트워크 주소를 제외하고\)를 반환하는 것이 중요합니다. 구성 매개변수는 아래 주어진 순서대로 다음 규칙을 적용하여 선택해야 합니다. 네트워크 관리자는 여러 DHCP 서버를 구성하여 해당 서버의 균일한 응답을 보장해야 합니다. 서버는 클라이언트에게 다음을 반환해야 합니다.\(MUST, MUST\)

o 이 섹션 앞부분에 제공된 규칙에 따라 결정된 클라이언트의 네트워크 주소,

o 이 섹션의 앞부분에 제공된 규칙에 따라 결정된 고객의 임대 만료 시간,

o 다음 규칙에 따라 클라이언트가 요청한 매개변수:

- -- 서버가 매개변수의 기본값으로 명시적으로 구성된 경우 서버는 '옵션' 필드 ELSE의 적절한 옵션에 해당 값을 포함해야 합니다.\(MUST\)

- -- 서버가 해당 매개변수를 호스트 요구사항 문서에 정의된 매개변수로 인식하는 경우, 서버는 '옵션' 필드 ELSE의 적절한 옵션에 호스트 요구사항 문서에 제공된 해당 매개변수의 기본값을 포함해야 합니다.\(MUST\)

- -- 서버는 해당 매개변수에 대한 값을 반환해서는 안 됩니다.\(MUST NOT\)

서버는 요청된 매개변수를 최대한 많이 제공해야 하며, 제공할 수 없는 매개변수는 생략해야 합니다. 서버는 DHCP 옵션 및 BOOTP 공급업체 확장 문서에서 명시적으로 허용되지 않는 한 요청된 각 매개변수를 한 번만 포함해야 합니다.\(MUST, MUST\)

o 호스트 요구 사항 문서 기본값과 다른 기존 바인딩의 모든 매개 변수,

o 이 클라이언트에 특정한 매개변수\(DHCPDISCOVER 또는 DHCPREQUEST 메시지의 'chaddr' 또는 '클라이언트 식별자'의 내용으로 식별됨\), 예를 들어 네트워크 관리자가 구성한 매개변수

o 이 클라이언트 클래스에 특정한 매개변수\(DHCPDISCOVER 또는 DHCPREQUEST 메시지의 '공급업체 클래스 식별자' 옵션 내용으로 식별됨\), 예를 들어 네트워크 관리자가 구성한 매개변수 매개변수는 클라이언트의 벤더 클래스 식별자와 서버에서 식별된 클라이언트 클래스 간의 정확한 일치로 식별되어야 합니다.\(MUST\)

o 클라이언트 서브넷에 기본값이 아닌 값이 있는 매개변수.

서버는 클라이언트가 수락할 DHCPOFFER를 선택하는 데 도움을 주기 위해 DHCPOFFER 메시지의 매개변수를 결정하는 데 사용되는 '공급업체 클래스 식별자'를 반환하도록 선택할 수 있습니다. 서버는 DHCPDISCOVER 메시지의 'xid' 필드를 DHCPOFFER 메시지의 'xid' 필드에 삽입하고 DHCPOFFER 메시지를 요청 클라이언트로 보냅니다.\(MAY\)

---
### **4.3.2 DHCPREQUEST message**

DHCPREQUEST 메시지는 서버의 DHCPOFFER 메시지에 응답하는 클라이언트, 이전에 할당된 IP 주소를 확인하는 클라이언트 또는 네트워크 주소에 대한 임대를 연장하는 클라이언트로부터 올 수 있습니다. DHCPREQUEST 메시지에 '서버 식별자' 옵션이 포함되어 있으면 해당 메시지는 DHCPOFFER 메시지에 대한 응답입니다. 그렇지 않은 경우 메시지는 기존 임대를 확인하거나 연장하라는 요청입니다. 클라이언트가 DHCPREQUEST 메시지에서 '클라이언트 식별자'를 사용하는 경우 모든 후속 메시지에서 동일한 '클라이언트 식별자'를 사용해야 합니다. 클라이언트가 DHCPDISCOVER 메시지에 요청된 매개변수 목록을 포함했다면 모든 후속 메시지에 해당 목록을 포함해야 합니다.\(MUST, MUST\)

DHCPACK 메시지의 모든 구성 매개변수는 클라이언트가 응답하는 이전 DHCPOFFER 메시지의 구성 매개변수와 충돌해서는 안 됩니다. 클라이언트는 구성을 위해 DHCPACK 메시지의 매개변수를 사용해야 합니다.\(SHOULD NOT, SHOULD\)

클라이언트는 다음과 같이 DHCPREQUEST 메시지를 보냅니다.

o SELECTING 상태 중에 생성된 DHCPREQUEST:

- 클라이언트는 '서버 식별자'에 선택한 서버의 주소를 삽입합니다. 'ciaddr'은 0이어야 하며, '요청된 IP 주소'는 선택한 DHCPOFFER의 yiaddr 값으로 채워져야 합니다.\(MUST\)

- 클라이언트는 여러 DHCPOFFER 메시지를 수집하고 "최상의" 제안을 선택할 수 있습니다. 클라이언트는 DHCPREQUEST 메시지에서 제공 서버를 식별하여 선택을 나타냅니다. 클라이언트가 수락 가능한 제안을 받지 못한 경우 클라이언트는 다른 DHCPDISCOVER 메시지를 시도하도록 선택할 수 있습니다. 따라서 서버는 클라이언트가 제안을 수락했는지 여부를 결정할 수 있는 특정 DHCPREQUEST를 받지 못할 수 있습니다. 서버는 DHCPOFFER를 기반으로 네트워크 주소 할당을 커밋하지 않았기 때문에 서버는 후속 요청에 대한 응답으로 제공된 네트워크 주소를 자유롭게 재사용할 수 있습니다. 구현 세부 사항으로서 서버는 제공된 주소를 재사용해서는 안 되며 구현별 시간 초과 메커니즘을 사용하여 제공된 주소를 재사용할 시기를 결정할 수 있습니다.\(SHOULD NOT\)

o INIT-REBOOT 상태 중에 생성된 DHCPREQUEST:

- '서버 식별자'는 반드시 입력해서는 안 되며, '요청된 IP 주소' 옵션은 클라이언트가 이전에 할당한 주소에 대한 개념으로 입력해야 합니다. 'ciaddr'은 0이어야 합니다. 클라이언트는 이전에 할당되고 캐시된 구성을 확인하려고 합니다. 서버는 '요청된 IP 주소'가 올바르지 않거나 잘못된 네트워크에 있는 경우 클라이언트에 DHCPNAK 메시지를 보내야 합니다.\(MUST NOT, MUST, SHOULD\)

- INIT-REBOOT 상태의 클라이언트가 올바른 네트워크에 있는지 여부는 'giaddr'의 내용, '요청된 IP 주소' 옵션 및 데이터베이스 조회를 통해 확인됩니다. DHCP 서버가 클라이언트가 잘못된 네트워크에 있음을 감지한 경우\(즉, 로컬 서브넷 마스크나 원격 서브넷 마스크\('giaddr'이 0이 아닌 경우\)를 '요청한 IP 주소' 옵션 값에 적용한 결과가 현실과 일치하지 않는 경우\) \), 그러면 서버는 클라이언트에 DHCPNAK 메시지를 보내야 합니다.\(SHOULD\)

- 네트워크가 올바른 경우 DHCP 서버는 클라이언트의 IP 주소 개념이 올바른지 확인해야 합니다. 그렇지 않은 경우 서버는 클라이언트에 DHCPNAK 메시지를 보내야 합니다. DHCP 서버에 이 클라이언트에 대한 기록이 없으면 침묵 상태를 유지해야 하며 네트워크 관리자에게 경고를 출력할 수 있습니다. 이 동작은 동일한 회선에서 통신하지 않는 DHCP 서버가 평화롭게 공존하는 데 필요합니다.\(SHOULD, MUST\)

- DHCPREQUEST 메시지에서 'giaddr'이 0x0이면 클라이언트는 서버와 동일한 서브넷에 있는 것입니다. 클라이언트가 올바른 네트워크 주소나 서브넷 마스크를 갖고 있지 않을 수 있고 클라이언트가 ARP 요청에 응답하지 않을 수 있으므로 서버는 DHCPNAK 메시지를 0xffffffff 브로드캐스트 주소로 브로드캐스트해야 합니다.\(MUST\)

- DHCPREQUEST 메시지에 'giaddr'이 설정된 경우 클라이언트는 다른 서브넷에 있는 것입니다. 클라이언트가 올바른 네트워크 주소나 서브넷 마스크를 갖고 있지 않고 클라이언트가 ARP 요청에 응답하지 않을 수 있으므로 서버는 중계 에이전트가 DHCPNAK를 클라이언트에 브로드캐스트할 수 있도록 DHCPNAK에 브로드캐스트 비트를 설정해야 합니다.\(MUST\)

o RENEWING 상태 중에 생성된 DHCPREQUEST:

- '서버 식별자'는 입력하면 안 되고, '요청된 IP 주소' 옵션은 입력하면 안 되며, 'ciaddr'은 클라이언트의 IP 주소로 입력되어야 합니다. 이 상황에서는 클라이언트가 완전히 구성되었으며 임대를 연장하려고 합니다. 이 메시지는 유니캐스트이므로 전송에 릴레이 에이전트가 관여하지 않습니다. 따라서 'giaddr'은 채워지지 않으므로 DHCP 서버는 'ciaddr'의 값을 신뢰하고 클라이언트에 응답할 때 이를 사용합니다.\(MUST NOT\)

- 클라이언트는 T1 이전에 임대를 갱신하거나 연장하도록 선택할 수 있습니다. 서버는 \(네트워크 관리자의 정책 결정에 따라\) 임대 연장을 선택하지 않을 수도 있지만 이에 관계없이 DHCPACK 메시지를 반환해야 합니다.\(MAY\)

o REBINDING 상태 중에 생성된 DHCPREQUEST:

- '서버 식별자'는 입력하면 안 되고, '요청된 IP 주소' 옵션은 입력하면 안 되며, 'ciaddr'은 클라이언트의 IP 주소로 입력되어야 합니다. 이 상황에서는 클라이언트가 완전히 구성되었으며 임대를 연장하려고 합니다. 이 메시지는 0xffffffff IP 브로드캐스트 주소로 브로드캐스트되어야 합니다. DHCP 서버는 DHCPREQUEST에 응답하기 전에 'ciaddr'의 정확성을 확인해야 합니다.\(MUST NOT, MUST, SHOULD\)

- REBINDING 클라이언트의 DHCPREQUEST는 여러 DHCP 서버가 있는 사이트와 여러 서버에서 관리하는 임대 간의 일관성을 유지하기 위한 메커니즘을 수용하기 위한 것입니다. DHCP 서버는 로컬 관리 권한이 있는 경우에만 클라이언트의 임대를 연장할 수 있습니다.\(MAY\)

---
### **4.3.3 DHCPDECLINE message**

서버가 DHCPDECLINE 메시지를 받으면 클라이언트는 제안된 네트워크 주소가 이미 사용 중임을 다른 방법을 통해 발견한 것입니다. 서버는 네트워크 주소를 사용할 수 없는 것으로 표시해야 하며\(MUST\) 가능한 구성 문제를 로컬 시스템 관리자에게 알려야 합니다\(SHOULD\).\(MUST\)

---
### **4.3.4 DHCPRELEASE message**

DHCPRELEASE 메시지를 받으면 서버는 네트워크 주소를 할당되지 않은 것으로 표시합니다. 서버는 클라이언트의 후속 요청에 대한 응답으로 재사용이 가능하도록 클라이언트의 초기화 매개변수 기록을 유지해야 합니다\(SHOULD\).\(SHOULD\)

---
### **4.3.5 DHCPINFORM message**

서버는 DHCPINFORM 메시지의 'ciaddr' 필드에 지정된 주소로 DHCPACK 메시지를 직접 보냄으로써 DHCPINFORM 메시지에 응답합니다. 서버는 임대 만료 시간을 클라이언트에 보내서는 안 되며 'yiaddr'을 채워서는 안 됩니다. 서버는 섹션 4.3.1에 정의된 대로 DHCPACK 메시지에 다른 매개변수를 포함합니다.\(MUST NOT\)

---
### **4.3.6 Client messages**

표 4에서는 다양한 상태의 클라이언트 메시지 간의 차이점을 자세히 설명합니다.

```text
   ---------------------------------------------------------------------
   |              |INIT-REBOOT  |SELECTING    |RENEWING     |REBINDING |
   ---------------------------------------------------------------------
   |broad/unicast |broadcast    |broadcast    |unicast      |broadcast |
   |server-ip     |MUST NOT     |MUST         |MUST NOT     |MUST NOT  |
   |requested-ip  |MUST         |MUST         |MUST NOT     |MUST NOT  |
   |ciaddr        |zero         |zero         |IP address   |IP address|
   ---------------------------------------------------------------------

              Table 4: Client messages from different states
```

---
## **4.4 DHCP client behavior**

그림 5는 DHCP 클라이언트의 상태 전이 다이어그램을 보여줍니다. 클라이언트는 서버로부터 다음 메시지를 받을 수 있습니다.

```text
         o DHCPOFFER

         o DHCPACK

         o DHCPNAK
```

DHCPINFORM 메시지는 그림 5에 표시되지 않습니다. 클라이언트는 단순히 DHCPINFORM을 보내고 DHCPACK 메시지를 기다립니다. 클라이언트가 해당 매개변수를 선택하면 구성 프로세스가 완료됩니다.

표 5는 클라이언트가 DHCP 메시지에서 필드와 옵션을 사용하는 방법을 보여줍니다. 이 섹션의 나머지 부분에서는 가능한 각 수신 메시지에 대한 DHCP 클라이언트의 작업을 설명합니다. 다음 섹션의 설명은 이전에 섹션 3.1에 설명된 전체 구성 절차에 해당하고, 다음 섹션의 텍스트는 섹션 3.2에 설명된 축약된 구성 절차에 해당합니다.

```text
 --------                               -------
|        | +-------------------------->|       |<-------------------+
| INIT-  | |     +-------------------->| INIT  |                    |
| REBOOT |DHCPNAK/         +---------->|       |<---+               |
|        |Restart|         |            -------     |               |
 --------  |  DHCPNAK/     |               |                        |
    |      Discard offer   |      -/Send DHCPDISCOVER               |
-/Send DHCPREQUEST         |               |                        |
    |      |     |      DHCPACK            v        |               |
 -----------     |   (not accept.)/   -----------   |               |
|           |    |  Send DHCPDECLINE |           |                  |
| REBOOTING |    |         |         | SELECTING |<----+            |
|           |    |        /          |           |     |DHCPOFFER/  |
 -----------     |       /            -----------   |  |Collect     |
    |            |      /                  |   |       |  replies   |
DHCPACK/         |     /  +----------------+   +-------+            |
Record lease, set|    |   v   Select offer/                         |
timers T1, T2   ------------  send DHCPREQUEST      |               |
    |   +----->|            |             DHCPNAK, Lease expired/   |
    |   |      | REQUESTING |                  Halt network         |
    DHCPOFFER/ |            |                       |               |
    Discard     ------------                        |               |
    |   |        |        |                   -----------           |
    |   +--------+     DHCPACK/              |           |          |
    |              Record lease, set    -----| REBINDING |          |
    |                timers T1, T2     /     |           |          |
    |                     |        DHCPACK/   -----------           |
    |                     v     Record lease, set   ^               |
    +----------------> -------      /timers T1,T2   |               |
               +----->|       |<---+                |               |
               |      | BOUND |<---+                |               |
  DHCPOFFER, DHCPACK, |       |    |            T2 expires/   DHCPNAK/
   DHCPNAK/Discard     -------     |             Broadcast  Halt network
               |       | |         |            DHCPREQUEST         |
               +-------+ |        DHCPACK/          |               |
                    T1 expires/   Record lease, set |               |
                 Send DHCPREQUEST timers T1, T2     |               |
                 to leasing server |                |               |
                         |   ----------             |               |
                         |  |          |------------+               |
                         +->| RENEWING |                            |
                            |          |----------------------------+
                             ----------
          Figure 5:  State-transition diagram for DHCP clients
```

---
### **4.4.1 Initialization and allocation of network address**

클라이언트는 INIT 상태에서 시작하여 DHCPDISCOVER 메시지를 형성합니다. 클라이언트는 시작 시 DHCP 사용을 비동기화하기 위해 1\~10초 사이의 임의 시간을 기다려야 합니다. 클라이언트는 'ciaddr'을 0x00000000으로 설정합니다. 클라이언트는 '매개변수 요청 목록' 옵션을 포함하여 특정 매개변수를 요청할 수 있습니다. 클라이언트는 '요청된 IP 주소' 및 'IP 주소 임대 시간' 옵션을 포함하여 네트워크 주소 및/또는 임대 시간을 제안할 수 있습니다. 클라이언트는 DHCP 응답 메시지 전달에 필요한 경우 'chaddr' 필드에 하드웨어 주소를 포함해야 합니다. 클라이언트는 섹션 4.2에서 설명한 대로 '클라이언트 식별자' 옵션에 다른 고유 식별자를 포함할 수 있습니다. 클라이언트가 DHCPDISCOVER 메시지에 요청된 매개변수 목록을 포함했다면 모든 후속 메시지에 해당 목록을 포함해야 합니다.\(SHOULD, MAY, MAY, MUST, MAY, MUST\)

클라이언트는 임의의 트랜잭션 식별자를 생성 및 기록하고 해당 식별자를 'xid' 필드에 삽입합니다. 클라이언트는 나중에 임대 만료 계산에 사용할 수 있도록 자체 현지 시간을 기록합니다. 그런 다음 클라이언트는 로컬 하드웨어 브로드캐스트 주소의 DHCPDISCOVER를 0xffffffff IP 브로드캐스트 주소 및 'DHCP 서버' UDP 포트로 브로드캐스트합니다.

도착하는 DHCPOFFER 메시지의 'xid'가 가장 최근 DHCPDISCOVER 메시지의 'xid'와 일치하지 않는 경우 DHCPOFFER 메시지는 자동으로 삭제되어야 합니다. 도착하는 모든 DHCPACK 메시지는 자동으로 삭제되어야 합니다.

클라이언트는 일정 기간 동안 DHCPOFFER 메시지를 수집하고, 들어오는 DHCPOFFER 메시지\(예: 첫 번째 DHCPOFFER 메시지 또는 이전에 사용된 서버의 DHCPOFFER 메시지\)에서 하나의 DHCPOFFER 메시지를 선택하고 '서버'에서 서버 주소를 추출합니다. DHCPOFFER 메시지의 식별자' 옵션. 클라이언트가 메시지를 수집하는 시간과 하나의 DHCPOFFER를 선택하는 데 사용되는 메커니즘은 구현에 따라 다릅니다.

```text
Field      DHCPDISCOVER          DHCPREQUEST           DHCPDECLINE,
           DHCPINFORM                                  DHCPRELEASE
-----      ------------          -----------           -----------
'op'       BOOTREQUEST           BOOTREQUEST           BOOTREQUEST
'htype'    (From "Assigned Numbers" RFC)
'hlen'     (Hardware address length in octets)
'hops'     0                     0                     0
'xid'      selected by client    'xid' from server     selected by
                                 DHCPOFFER message     client
'secs'     0 or seconds since    0 or seconds since    0
           DHCP process started  DHCP process started
'flags'    Set 'BROADCAST'       Set 'BROADCAST'       0
           flag if client        flag if client
           requires broadcast    requires broadcast
           reply                 reply
'ciaddr'   0 (DHCPDISCOVER)      0 or client's         0 (DHCPDECLINE)
           client's              network address       client's network
           network address       (BOUND/RENEW/REBIND)  address
           (DHCPINFORM)                                (DHCPRELEASE)
'yiaddr'   0                     0                     0
'siaddr'   0                     0                     0
'giaddr'   0                     0                     0
'chaddr'   client's hardware     client's hardware     client's hardware
           address               address               address
'sname'    options, if           options, if           (unused)
           indicated in          indicated in
           'sname/file'          'sname/file'
           option; otherwise     option; otherwise
           unused                unused
'file'     options, if           options, if           (unused)
           indicated in          indicated in
           'sname/file'          'sname/file'
           option; otherwise     option; otherwise
           unused                unused
'options'  options               options               (unused)

Option                     DHCPDISCOVER  DHCPREQUEST      DHCPDECLINE,
                           DHCPINFORM                     DHCPRELEASE
------                     ------------  -----------      -----------
Requested IP address       MAY           MUST (in         MUST
                           (DISCOVER)    SELECTING or     (DHCPDECLINE),
                           MUST NOT      INIT-REBOOT)     MUST NOT
                           (INFORM)      MUST NOT (in     (DHCPRELEASE)
                                         BOUND or
                                         RENEWING)
IP address lease time      MAY           MAY              MUST NOT
                           (DISCOVER)
                           MUST NOT
                           (INFORM)
Use 'file'/'sname' fields  MAY           MAY              MAY
DHCP message type          DHCPDISCOVER/ DHCPREQUEST      DHCPDECLINE/
                           DHCPINFORM                     DHCPRELEASE
Client identifier          MAY           MAY              MAY
Vendor class identifier    MAY           MAY              MUST NOT
Server identifier          MUST NOT      MUST (after      MUST
                                         SELECTING)
                                         MUST NOT (after
                                         INIT-REBOOT,
                                         BOUND, RENEWING
                                         or REBINDING)
Parameter request list     MAY           MAY              MUST NOT
Maximum message size       MAY           MAY              MUST NOT
Message                    SHOULD NOT    SHOULD NOT       SHOULD
Site-specific              MAY           MAY              MUST NOT
All others                 MAY           MAY              MUST NOT

             Table 5:  Fields and options used by DHCP clients
```

매개변수가 허용 가능한 경우 클라이언트는 '서버 식별자' 필드에서 매개변수를 제공한 서버의 주소를 기록하고 DHCPREQUEST 브로드캐스트 메시지의 '서버 식별자' 필드에 해당 주소를 보냅니다. 서버로부터 DHCPACK 메시지가 도착하면 클라이언트는 초기화되고 BOUND 상태로 이동합니다. DHCPREQUEST 메시지에는 DHCPOFFER 메시지와 동일한 'xid'가 포함되어 있습니다. 클라이언트는 원래 요청이 전송된 시간과 DHCPACK 메시지의 임대 기간을 합산하여 임대 만료 시간을 기록합니다. 클라이언트는 제안된 주소에 대해 검사를 수행하여 주소가 이미 사용 중이 아닌지 확인해야 합니다. 예를 들어 클라이언트가 ARP를 지원하는 네트워크에 있는 경우 클라이언트는 제안된 요청에 대해 ARP 요청을 발행할 수 있습니다. 제안된 주소에 대한 ARP 요청을 브로드캐스트할 때 클라이언트는 동일한 서브넷에 있는 다른 호스트의 ARP 캐시를 혼동하지 않도록 자신의 하드웨어 주소를 보낸 사람의 하드웨어 주소로 입력하고 보낸 사람의 IP 주소로 0을 입력해야 합니다. 만약\(SHOULD\)

네트워크 주소가 사용 중인 것으로 나타나면 클라이언트는 DHCPDECLINE 메시지를 서버에 보내야 합니다. 클라이언트는 클라이언트의 새 IP 주소를 알리고 클라이언트 서브넷의 호스트에서 오래된 ARP 캐시 항목을 삭제하기 위해 ARP 응답을 브로드캐스트해야 합니다\(SHOULD\).\(MUST, SHOULD\)

---
### **4.4.2 Initialization with known network address**

클라이언트는 INIT-REBOOT 상태에서 시작하여 DHCPREQUEST 메시지를 보냅니다. 클라이언트는 알려진 네트워크 주소를 DHCPREQUEST 메시지의 '요청된 IP 주소' 옵션으로 삽입해야 합니다. 클라이언트는 '매개변수 요청 목록' 옵션을 포함하여 특정 구성 매개변수를 요청할 수 있습니다. 클라이언트는 임의의 트랜잭션 식별자를 생성 및 기록하고 해당 식별자를 'xid' 필드에 삽입합니다. 클라이언트는 나중에 임대 만료 계산에 사용할 수 있도록 자체 현지 시간을 기록합니다. 클라이언트는 DHCPREQUEST 메시지에 '서버 식별자'를 포함해서는 안 됩니다. 그런 다음 클라이언트는 로컬 하드웨어 브로드캐스트 주소의 DHCPREQUEST를 'DHCP 서버' UDP 포트로 브로드캐스트합니다.\(MUST, MUST NOT\)

클라이언트의 DHCPREQUEST 메시지와 일치하는 'xid' 필드가 있는 DHCPACK 메시지가 임의의 서버로부터 도착하면 클라이언트는 초기화되고 BOUND 상태로 이동합니다. 클라이언트는 DHCPREQUEST 메시지가 전송된 시간과 DHCPACK 메시지의 임대 기간을 합산하여 임대 만료 시간을 기록합니다.

---
### **4.4.3 Initialization with an externally assigned network address**

클라이언트는 DHCPINFORM 메시지를 보냅니다. 클라이언트는 '매개변수 요청 목록' 옵션을 포함하여 특정 구성 매개변수를 요청할 수 있습니다. 클라이언트는 임의의 트랜잭션 식별자를 생성 및 기록하고 해당 식별자를 'xid' 필드에 삽입합니다. 클라이언트는 'ciaddr' 필드에 자체 네트워크 주소를 입력합니다. 클라이언트는 임대 시간 매개변수를 요청해서는 안 됩니다.\(SHOULD NOT\)

그런 다음 클라이언트는 서버의 주소를 알고 있으면 DHCPINFORM을 DHCP 서버로 유니캐스트하고, 그렇지 않으면 제한된\(모두 1\) 브로드캐스트 주소로 메시지를 브로드캐스트합니다. DHCPINFORM 메시지는 'DHCP 서버' UDP 포트로 전달되어야 합니다.\(MUST\)

클라이언트의 DHCPINFORM 메시지와 일치하는 'xid' 필드가 있는 DHCPACK 메시지가 서버로부터 도착하면 클라이언트가 초기화됩니다.

클라이언트가 합리적인 시간\(60초 또는 섹션 4.1에서 제안된 제한 시간을 사용하는 경우 4회 시도\) 내에 DHCPACK를 수신하지 못한 경우 사용자에게 문제를 알리는 메시지를 표시한 다음 적절한 방법을 사용하여 네트워크 처리를 시작해야 합니다.\(SHOULD\)

부록 A에 따른 기본값입니다.

---
### **4.4.4 Use of broadcast and unicast**

클라이언트가 DHCP 서버의 주소를 모르는 경우 DHCP 클라이언트는 DHCPDISCOVER, DHCPREQUEST 및 DHCPINFORM 메시지를 브로드캐스트합니다. 클라이언트는 DHCPRELEASE 메시지를 서버에 유니캐스트합니다. 클라이언트는 서버에서 제공한 IP 주소의 사용을 거부하기 때문에 DHCPDECLINE 메시지를 브로드캐스트합니다.

DHCP 클라이언트가 INIT 또는 REBOOTING 상태에서 DHCP 서버의 주소를 알고 있는 경우 클라이언트는 IP 브로드캐스트 주소 대신 DHCPDISCOVER 또는 DHCPREQUEST에서 해당 주소를 사용할 수 있습니다. 클라이언트는 유니캐스트를 사용하여 알려진 DHCP 서버에 DHCPINFORM 메시지를 보낼 수도 있습니다. 클라이언트가 알려진 DHCP 서버의 IP 주소로 전송된 DHCP 메시지에 대한 응답을 받지 못하면 DHCP 클라이언트는 IP 브로드캐스트 주소를 사용하도록 되돌아갑니다.

---
### **4.4.5 Reacquisition and expiration**

클라이언트는 클라이언트가 네트워크 주소에서 임대를 연장하려고 시도하는 시간을 지정하는 두 번 T1과 T2를 유지 관리합니다. T1은 클라이언트가 RENEWING 상태에 진입하고 원래 클라이언트의 네트워크 주소를 발급한 서버에 연결을 시도하는 시간입니다. T2는 클라이언트가 REBINDING 상태에 들어가고 서버에 접속을 시도하는 시간입니다. T1은 T2보다 빨라야 하며, 이는 클라이언트의 임대가 만료되는 시간보다 빨라야 합니다.\(MUST\)

동기화된 클럭의 필요성을 피하기 위해 T1과 T2는 옵션에서 상대 시간으로 표현됩니다\[2\].

T1 시간에 클라이언트는 RENEWING 상태로 이동하고 임대를 연장하기 위해 서버에 DHCPREQUEST 메시지를 \(유니캐스트를 통해\) 보냅니다. 클라이언트는 DHCPREQUEST의 'ciaddr' 필드를 현재 네트워크 주소로 설정합니다. 클라이언트는 임대 만료 시간 계산을 위해 DHCPREQUEST 메시지가 전송되는 현지 시간을 기록합니다. 클라이언트는 DHCPREQUEST 메시지에 '서버 식별자'를 포함해서는 안 됩니다.\(MUST NOT\)

클라이언트 DHCPREQUEST 메시지의 'xid'와 일치하지 않는 'xid'와 함께 도착하는 모든 DHCPACK 메시지는 자동으로 삭제됩니다. 클라이언트는 서버로부터 DHCPACK를 수신하면 클라이언트가 DHCPREQUEST 메시지를 보낸 시간과 DHCPACK 메시지의 임대 기간을 합산하여 임대 만료 시간을 계산합니다. 클라이언트는 네트워크 주소를 성공적으로 다시 획득하고 BOUND 상태로 돌아가 네트워크 처리를 계속할 수 있습니다.

T2 시간 이전에 DHCPACK가 도착하지 않으면 클라이언트는 REBINDING 상태로 이동하고 브로드캐스트를 통해 DHCPREQUEST 메시지를 보내 임대를 연장합니다. 클라이언트는 DHCPREQUEST의 'ciaddr' 필드를 현재 네트워크 주소로 설정합니다. 클라이언트는 DHCPREQUEST 메시지에 '서버 식별자'를 포함해서는 안 됩니다.\(MUST NOT\)

시간 T1 및 T2는 옵션을 통해 서버에서 구성할 수 있습니다. T1의 기본값은 \(0.5 \* Duration\_of\_lease\)입니다. T2의 기본값은 \(0.875 \* Duration\_of\_lease\)입니다. 클라이언트 재획득의 동기화를 방지하려면 고정 값 주위에 임의의 "퍼즈"를 사용하여 시간 T1 및 T2를 선택해야 합니다.\(SHOULD\)

클라이언트는 T1 이전에 임대를 갱신하거나 연장하도록 선택할 수 있습니다. 서버는 네트워크 관리자가 설정한 정책에 따라 클라이언트의 임대를 연장하도록 선택할 수 있습니다. 서버는 T1 및 T2를 반환해야 하며 해당 값은 임대에 남은 시간을 고려하여 원래 값에서 조정되어야 합니다.\(MAY, MAY, SHOULD\)

RENEWING 및 REBINDING 상태 모두에서 클라이언트가 DHCPREQUEST 메시지에 대한 응답을 받지 못한 경우 클라이언트는 T2\(RENEWING 상태\)까지 남은 시간의 절반을 기다려야 하고, REBINDING 상태에서 남은 임대 시간의 절반을 기다려야 합니다. , DHCPREQUEST 메시지를 재전송하기 전에 최소 60초로 줄였습니다.\(SHOULD\)

클라이언트가 DHCPACK를 수신하기 전에 임대가 만료되면 클라이언트는 INIT 상태로 이동하고 다른 네트워크 처리를 즉시 중지해야 하며 클라이언트가 초기화되지 않은 것처럼 네트워크 초기화 매개변수를 요청해야 합니다. 클라이언트가 이전 네트워크 주소를 할당하는 DHCPACK를 수신하면 클라이언트는 네트워크 처리를 계속해야 합니다. 클라이언트에 새 네트워크 주소가 제공되면 이전 네트워크 주소를 계속 사용해서는 안 되며 로컬 사용자에게 문제를 알려야 합니다.\(MUST, SHOULD, MUST NOT\)

---
### **4.4.6 DHCPRELEASE**

클라이언트가 할당된 네트워크 주소를 더 이상 사용할 필요가 없으면\(예: 클라이언트가 정상적으로 종료된 경우\) 클라이언트는 DHCPRELEASE 메시지를 서버에 보냅니다. DHCP의 올바른 작동은 DHCPRELEASE 메시지의 전송에 달려 있지 않습니다.

---
## **5. Acknowledgments**

저자는 DHCP와 이 문서 개발에 지칠 줄 모르고 지속적인 노력을 기울인 DHC WG의 많은\(그리고 언급하기에는 너무 많습니다!\) 구성원에게 감사드립니다.

DHCP 상호 운용성 테스트 세션을 조직한 J Allard, Mike Carney, Dave Lapp, Fred Lien 및 John Mendonca의 노력에 감사드립니다.

이 문서의 개발은 CNRI\(Corporation for National Research Initiatives\), Bucknell University 및 Sun Microsystems의 보조금에 의해 부분적으로 지원되었습니다.

---
## **6. References**

```text
   [1] Acetta, M., "Resource Location Protocol", RFC 887, CMU, December
       1983.
```

\[2\] Alexander, S. 및 R. Droms, "DHCP 옵션 및 BOOTP 공급업체 확장", RFC 1533, Lachman Technology, Inc., Bucknell University, 1993년 10월.

\[3\] Braden, R., 편집자, "인터넷 호스트 요구 사항 --

- 통신 계층", STD 3, RFC 1122, USC/정보 과학 연구소, 1989년 10월.

\[4\] Braden, R., 편집자, "인터넷 호스트 요구 사항 --

- 응용 프로그램 및 지원, STD 3, RFC 1123, USC/정보 과학 연구소, 1989년 10월.

\[5\] Brownell, D, "DRARP\(동적 역방향 주소 확인 프로토콜\)", 작업 진행 중.

\[6\] Comer, D. 및 R. Droms, "인터넷 디렉토리 서비스에 대한 균일한 액세스", Proc. ACM SIGCOMM '90\(Computer Communications Review 특별호\), 20\(4\):50-59, 1990.

\[7\] Croft, B. 및 J. Gilmore, "부트스트랩 프로토콜\(BOOTP\)", RFC 951, Stanford 및 SUN Microsystems, 1985년 9월.

```text
   [8] Deering, S., "ICMP Router Discovery Messages", RFC 1256, Xerox
       PARC, September 1991.
```

\[9\] Droms, D., "DHCP와 BOOTP 간의 상호 운용", RFC 1534, Bucknell University, 1993년 10월.

\[10\] Finlayson, R., Mann, T., Mogul, J. 및 M. Theimer, "역방향 주소 확인 프로토콜", RFC 903, 스탠포드, 1984년 6월.

\[11\] Gray C. 및 D. Cheriton, "임대: 분산 파일 캐시 일관성을 위한 효율적인 내결함성 메커니즘", Proc. 운영 체제 설계에 관한 제12차 ACM 심포지엄, 1989년.

\[12\] Mockapetris, P., "도메인 이름 - 개념 및 시설", STD 13, RFC 1034, USC/정보 과학 연구소, 1987년 11월.

\[13\] Mockapetris, P., "도메인 이름 - 구현 및

- 사양", STD 13, RFC 1035, USC/정보 과학 연구소, 1987년 11월.

\[14\] Mogul J. 및 S. Deering, "Path MTU Discovery", RFC 1191, 1990년 11월.

\[15\] Morgan, R., "이더넷 연결 호스트에 대한 동적 IP 주소 할당", 작업 진행 중.

```text
   [16] Postel, J., "Internet Control Message Protocol", STD 5, RFC 792,
        USC/Information Sciences Institute, September 1981.

   [17] Reynolds, J., "BOOTP Vendor Information Extensions", RFC 1497,
        USC/Information Sciences Institute, August 1993.
```

\[18\] Reynolds, J. 및 J. Postel, "할당된 번호", STD 2, RFC 1700, USC/정보 과학 연구소, 1994년 10월.

\[19\] 제프리 쉴러와 마크 로젠스타인. 이더넷에서 사용하기 위한 IP 주소의 동적 할당을 위한 프로토콜입니다. \(MIT 아테나 프로젝트에서 이용 가능\), 1989.

```text
   [20] Sollins, K., "The TFTP Protocol (Revision 2)",  RFC 783, NIC,
        June 1981.
```

\[21\] Wimer, W., "부트스트랩 프로토콜에 대한 설명 및 확장", RFC 1542, Carnegie Mellon University, 1993년 10월.

---
## **7. Security Considerations**

DHCP는 아직 본질적으로 안전하지 않은 UDP 및 IP에 직접 구축됩니다. 게다가 DHCP는 일반적으로 원격 호스트 및/또는 디스크 없는 호스트의 유지 관리를 더 쉽게 만들기 위한 것입니다. 불가능하지는 않지만 비밀번호나 키로 호스트를 구성하는 것은 어렵고 불편할 수 있습니다. 따라서 현재 형태의 DHCP는 매우 안전하지 않습니다.

승인되지 않은 DHCP 서버가 쉽게 설정될 수 있습니다. 그러면 이러한 서버는 부정확하거나 중복된 IP 주소, 잘못된 라우팅 정보\(스푸핑 라우터 등 포함\), 잘못된 도메인 이름 서버 주소\(예: 스푸핑 이름 서버\) 등과 같은 허위 정보와 잠재적으로 방해가 되는 정보를 클라이언트에 보낼 수 있습니다. 분명히 이러한 시드 정보가 확보되면 공격자는 영향을 받는 시스템을 더욱 손상시킬 수 있습니다.

악의적인 DHCP 클라이언트는 합법적인 클라이언트로 가장하여 합법적인 클라이언트를 위한 정보를 검색할 수 있습니다. 리소스의 동적 할당이 사용되는 경우 악의적인 클라이언트는 모든 리소스를 자체적으로 요구할 수 있으므로 합법적인 클라이언트에 대한 리소스를 거부할 수 있습니다.

---
## **8. Author's Address**

```text
      Ralph Droms
      Computer Science Department
      323 Dana Engineering
      Bucknell University
      Lewisburg, PA 17837

      Phone: (717) 524-1145
      EMail: droms@bucknell.edu
```

---
## **A. Host Configuration Parameters**

```text
   IP-layer_parameters,_per_host:_

   Be a router                     on/off                 HRC 3.1
   Non-local source routing        on/off                 HRC 3.3.5
   Policy filters for
   non-local source routing        (list)                 HRC 3.3.5
   Maximum reassembly size         integer                HRC 3.3.2
   Default TTL                     integer                HRC 3.2.1.7
   PMTU aging timeout              integer                MTU 6.6
   MTU plateau table               (list)                 MTU 7
   IP-layer_parameters,_per_interface:_
   IP address                      (address)              HRC 3.3.1.6
   Subnet mask                     (address mask)         HRC 3.3.1.6
   MTU                             integer                HRC 3.3.3
   All-subnets-MTU                 on/off                 HRC 3.3.3
   Broadcast address flavor        0x00000000/0xffffffff  HRC 3.3.6
   Perform mask discovery          on/off                 HRC 3.2.2.9
   Be a mask supplier              on/off                 HRC 3.2.2.9
   Perform router discovery        on/off                 RD 5.1
   Router solicitation address     (address)              RD 5.1
   Default routers, list of:
           router address          (address)              HRC 3.3.1.6
           preference level        integer                HRC 3.3.1.6
   Static routes, list of:
           destination             (host/subnet/net)      HRC 3.3.1.2
           destination mask        (address mask)         HRC 3.3.1.2
           type-of-service         integer                HRC 3.3.1.2
           first-hop router        (address)              HRC 3.3.1.2
           ignore redirects        on/off                 HRC 3.3.1.2
           PMTU                    integer                MTU 6.6
           perform PMTU discovery  on/off                 MTU 6.6

   Link-layer_parameters,_per_interface:_
   Trailers                       on/off                 HRC 2.3.1
   ARP cache timeout              integer                HRC 2.3.2.1
   Ethernet encapsulation         (RFC 894/RFC 1042)     HRC 2.3.3

   TCP_parameters,_per_host:_
   TTL                            integer                HRC 4.2.2.19
   Keep-alive interval            integer                HRC 4.2.3.6
   Keep-alive data size           0/1                    HRC 4.2.3.6
```

---
# **Key:**

```text
   MTU = Path MTU Discovery (RFC 1191, Proposed Standard)
   RD = Router Discovery (RFC 1256, Proposed Standard)
```